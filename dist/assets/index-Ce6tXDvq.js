function Nj(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function RP(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function A_(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var TS={exports:{}},kp={},_S={exports:{}},gt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WR;function $j(){if(WR)return gt;WR=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),d=Symbol.iterator;function p(j){return j===null||typeof j!="object"?null:(j=d&&j[d]||j["@@iterator"],typeof j=="function"?j:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,v={};function w(j,Z,he){this.props=j,this.context=Z,this.refs=v,this.updater=he||m}w.prototype.isReactComponent={},w.prototype.setState=function(j,Z){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,Z,"setState")},w.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function b(){}b.prototype=w.prototype;function S(j,Z,he){this.props=j,this.context=Z,this.refs=v,this.updater=he||m}var C=S.prototype=new b;C.constructor=S,y(C,w.prototype),C.isPureReactComponent=!0;var T=Array.isArray,O=Object.prototype.hasOwnProperty,V={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function $(j,Z,he){var ve,we={},Se=null,Ne=null;if(Z!=null)for(ve in Z.ref!==void 0&&(Ne=Z.ref),Z.key!==void 0&&(Se=""+Z.key),Z)O.call(Z,ve)&&!k.hasOwnProperty(ve)&&(we[ve]=Z[ve]);var Ae=arguments.length-2;if(Ae===1)we.children=he;else if(1<Ae){for(var Pe=Array(Ae),qe=0;qe<Ae;qe++)Pe[qe]=arguments[qe+2];we.children=Pe}if(j&&j.defaultProps)for(ve in Ae=j.defaultProps,Ae)we[ve]===void 0&&(we[ve]=Ae[ve]);return{$$typeof:n,type:j,key:Se,ref:Ne,props:we,_owner:V.current}}function N(j,Z){return{$$typeof:n,type:j.type,key:Z,ref:j.ref,props:j.props,_owner:j._owner}}function R(j){return typeof j=="object"&&j!==null&&j.$$typeof===n}function E(j){var Z={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(he){return Z[he]})}var L=/\/+/g;function F(j,Z){return typeof j=="object"&&j!==null&&j.key!=null?E(""+j.key):Z.toString(36)}function G(j,Z,he,ve,we){var Se=typeof j;(Se==="undefined"||Se==="boolean")&&(j=null);var Ne=!1;if(j===null)Ne=!0;else switch(Se){case"string":case"number":Ne=!0;break;case"object":switch(j.$$typeof){case n:case e:Ne=!0}}if(Ne)return Ne=j,we=we(Ne),j=ve===""?"."+F(Ne,0):ve,T(we)?(he="",j!=null&&(he=j.replace(L,"$&/")+"/"),G(we,Z,he,"",function(qe){return qe})):we!=null&&(R(we)&&(we=N(we,he+(!we.key||Ne&&Ne.key===we.key?"":(""+we.key).replace(L,"$&/")+"/")+j)),Z.push(we)),1;if(Ne=0,ve=ve===""?".":ve+":",T(j))for(var Ae=0;Ae<j.length;Ae++){Se=j[Ae];var Pe=ve+F(Se,Ae);Ne+=G(Se,Z,he,Pe,we)}else if(Pe=p(j),typeof Pe=="function")for(j=Pe.call(j),Ae=0;!(Se=j.next()).done;)Se=Se.value,Pe=ve+F(Se,Ae++),Ne+=G(Se,Z,he,Pe,we);else if(Se==="object")throw Z=String(j),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.");return Ne}function Y(j,Z,he){if(j==null)return j;var ve=[],we=0;return G(j,ve,"","",function(Se){return Z.call(he,Se,we++)}),ve}function q(j){if(j._status===-1){var Z=j._result;Z=Z(),Z.then(function(he){(j._status===0||j._status===-1)&&(j._status=1,j._result=he)},function(he){(j._status===0||j._status===-1)&&(j._status=2,j._result=he)}),j._status===-1&&(j._status=0,j._result=Z)}if(j._status===1)return j._result.default;throw j._result}var se={current:null},X={transition:null},re={ReactCurrentDispatcher:se,ReactCurrentBatchConfig:X,ReactCurrentOwner:V};function ie(){throw Error("act(...) is not supported in production builds of React.")}return gt.Children={map:Y,forEach:function(j,Z,he){Y(j,function(){Z.apply(this,arguments)},he)},count:function(j){var Z=0;return Y(j,function(){Z++}),Z},toArray:function(j){return Y(j,function(Z){return Z})||[]},only:function(j){if(!R(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},gt.Component=w,gt.Fragment=t,gt.Profiler=s,gt.PureComponent=S,gt.StrictMode=r,gt.Suspense=l,gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=re,gt.act=ie,gt.cloneElement=function(j,Z,he){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var ve=y({},j.props),we=j.key,Se=j.ref,Ne=j._owner;if(Z!=null){if(Z.ref!==void 0&&(Se=Z.ref,Ne=V.current),Z.key!==void 0&&(we=""+Z.key),j.type&&j.type.defaultProps)var Ae=j.type.defaultProps;for(Pe in Z)O.call(Z,Pe)&&!k.hasOwnProperty(Pe)&&(ve[Pe]=Z[Pe]===void 0&&Ae!==void 0?Ae[Pe]:Z[Pe])}var Pe=arguments.length-2;if(Pe===1)ve.children=he;else if(1<Pe){Ae=Array(Pe);for(var qe=0;qe<Pe;qe++)Ae[qe]=arguments[qe+2];ve.children=Ae}return{$$typeof:n,type:j.type,key:we,ref:Se,props:ve,_owner:Ne}},gt.createContext=function(j){return j={$$typeof:o,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:i,_context:j},j.Consumer=j},gt.createElement=$,gt.createFactory=function(j){var Z=$.bind(null,j);return Z.type=j,Z},gt.createRef=function(){return{current:null}},gt.forwardRef=function(j){return{$$typeof:a,render:j}},gt.isValidElement=R,gt.lazy=function(j){return{$$typeof:h,_payload:{_status:-1,_result:j},_init:q}},gt.memo=function(j,Z){return{$$typeof:u,type:j,compare:Z===void 0?null:Z}},gt.startTransition=function(j){var Z=X.transition;X.transition={};try{j()}finally{X.transition=Z}},gt.unstable_act=ie,gt.useCallback=function(j,Z){return se.current.useCallback(j,Z)},gt.useContext=function(j){return se.current.useContext(j)},gt.useDebugValue=function(){},gt.useDeferredValue=function(j){return se.current.useDeferredValue(j)},gt.useEffect=function(j,Z){return se.current.useEffect(j,Z)},gt.useId=function(){return se.current.useId()},gt.useImperativeHandle=function(j,Z,he){return se.current.useImperativeHandle(j,Z,he)},gt.useInsertionEffect=function(j,Z){return se.current.useInsertionEffect(j,Z)},gt.useLayoutEffect=function(j,Z){return se.current.useLayoutEffect(j,Z)},gt.useMemo=function(j,Z){return se.current.useMemo(j,Z)},gt.useReducer=function(j,Z,he){return se.current.useReducer(j,Z,he)},gt.useRef=function(j){return se.current.useRef(j)},gt.useState=function(j){return se.current.useState(j)},gt.useSyncExternalStore=function(j,Z,he){return se.current.useSyncExternalStore(j,Z,he)},gt.useTransition=function(){return se.current.useTransition()},gt.version="18.3.1",gt}var jR;function D_(){return jR||(jR=1,_S.exports=$j()),_S.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GR;function Rj(){if(GR)return kp;GR=1;var n=D_(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var h,d={},p=null,m=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(m=l.ref);for(h in l)r.call(l,h)&&!i.hasOwnProperty(h)&&(d[h]=l[h]);if(a&&a.defaultProps)for(h in l=a.defaultProps,l)d[h]===void 0&&(d[h]=l[h]);return{$$typeof:e,type:a,key:p,ref:m,props:d,_owner:s.current}}return kp.Fragment=t,kp.jsx=o,kp.jsxs=o,kp}var HR;function Aj(){return HR||(HR=1,TS.exports=Rj()),TS.exports}var Ce=Aj(),ye=D_();const Ku=RP(ye);var Y0={},CS={exports:{}},ys={},ES={exports:{}},kS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qR;function Dj(){return qR||(qR=1,function(n){function e(X,re){var ie=X.length;X.push(re);e:for(;0<ie;){var j=ie-1>>>1,Z=X[j];if(0<s(Z,re))X[j]=re,X[ie]=Z,ie=j;else break e}}function t(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var re=X[0],ie=X.pop();if(ie!==re){X[0]=ie;e:for(var j=0,Z=X.length,he=Z>>>1;j<he;){var ve=2*(j+1)-1,we=X[ve],Se=ve+1,Ne=X[Se];if(0>s(we,ie))Se<Z&&0>s(Ne,we)?(X[j]=Ne,X[Se]=ie,j=Se):(X[j]=we,X[ve]=ie,j=ve);else if(Se<Z&&0>s(Ne,ie))X[j]=Ne,X[Se]=ie,j=Se;else break e}}return re}function s(X,re){var ie=X.sortIndex-re.sortIndex;return ie!==0?ie:X.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,d=null,p=3,m=!1,y=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(X){for(var re=t(u);re!==null;){if(re.callback===null)r(u);else if(re.startTime<=X)r(u),re.sortIndex=re.expirationTime,e(l,re);else break;re=t(u)}}function T(X){if(v=!1,C(X),!y)if(t(l)!==null)y=!0,q(O);else{var re=t(u);re!==null&&se(T,re.startTime-X)}}function O(X,re){y=!1,v&&(v=!1,b($),$=-1),m=!0;var ie=p;try{for(C(re),d=t(l);d!==null&&(!(d.expirationTime>re)||X&&!E());){var j=d.callback;if(typeof j=="function"){d.callback=null,p=d.priorityLevel;var Z=j(d.expirationTime<=re);re=n.unstable_now(),typeof Z=="function"?d.callback=Z:d===t(l)&&r(l),C(re)}else r(l);d=t(l)}if(d!==null)var he=!0;else{var ve=t(u);ve!==null&&se(T,ve.startTime-re),he=!1}return he}finally{d=null,p=ie,m=!1}}var V=!1,k=null,$=-1,N=5,R=-1;function E(){return!(n.unstable_now()-R<N)}function L(){if(k!==null){var X=n.unstable_now();R=X;var re=!0;try{re=k(!0,X)}finally{re?F():(V=!1,k=null)}}else V=!1}var F;if(typeof S=="function")F=function(){S(L)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Y=G.port2;G.port1.onmessage=L,F=function(){Y.postMessage(null)}}else F=function(){w(L,0)};function q(X){k=X,V||(V=!0,F())}function se(X,re){$=w(function(){X(n.unstable_now())},re)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(X){X.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,q(O))},n.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<X?Math.floor(1e3/X):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(X){switch(p){case 1:case 2:case 3:var re=3;break;default:re=p}var ie=p;p=re;try{return X()}finally{p=ie}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(X,re){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var ie=p;p=X;try{return re()}finally{p=ie}},n.unstable_scheduleCallback=function(X,re,ie){var j=n.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?j+ie:j):ie=j,X){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=ie+Z,X={id:h++,callback:re,priorityLevel:X,startTime:ie,expirationTime:Z,sortIndex:-1},ie>j?(X.sortIndex=ie,e(u,X),t(l)===null&&X===t(u)&&(v?(b($),$=-1):v=!0,se(T,ie-j))):(X.sortIndex=Z,e(l,X),y||m||(y=!0,q(O))),X},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(X){var re=p;return function(){var ie=p;p=re;try{return X.apply(this,arguments)}finally{p=ie}}}}(kS)),kS}var KR;function Oj(){return KR||(KR=1,ES.exports=Dj()),ES.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XR;function Pj(){if(XR)return ys;XR=1;var n=D_(),e=Oj();function t(c){for(var f="https://reactjs.org/docs/error-decoder.html?invariant="+c,g=1;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+c+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function i(c,f){o(c,f),o(c+"Capture",f)}function o(c,f){for(s[c]=f,c=0;c<f.length;c++)r.add(f[c])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},d={};function p(c){return l.call(d,c)?!0:l.call(h,c)?!1:u.test(c)?d[c]=!0:(h[c]=!0,!1)}function m(c,f,g,I){if(g!==null&&g.type===0)return!1;switch(typeof f){case"function":case"symbol":return!0;case"boolean":return I?!1:g!==null?!g.acceptsBooleans:(c=c.toLowerCase().slice(0,5),c!=="data-"&&c!=="aria-");default:return!1}}function y(c,f,g,I){if(f===null||typeof f>"u"||m(c,f,g,I))return!0;if(I)return!1;if(g!==null)switch(g.type){case 3:return!f;case 4:return f===!1;case 5:return isNaN(f);case 6:return isNaN(f)||1>f}return!1}function v(c,f,g,I,_,D,z){this.acceptsBooleans=f===2||f===3||f===4,this.attributeName=I,this.attributeNamespace=_,this.mustUseProperty=g,this.propertyName=c,this.type=f,this.sanitizeURL=D,this.removeEmptyString=z}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(c){w[c]=new v(c,0,!1,c,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(c){var f=c[0];w[f]=new v(f,1,!1,c[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(c){w[c]=new v(c,2,!1,c.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(c){w[c]=new v(c,2,!1,c,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(c){w[c]=new v(c,3,!1,c.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(c){w[c]=new v(c,3,!0,c,null,!1,!1)}),["capture","download"].forEach(function(c){w[c]=new v(c,4,!1,c,null,!1,!1)}),["cols","rows","size","span"].forEach(function(c){w[c]=new v(c,6,!1,c,null,!1,!1)}),["rowSpan","start"].forEach(function(c){w[c]=new v(c,5,!1,c.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function S(c){return c[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(c){var f=c.replace(b,S);w[f]=new v(f,1,!1,c,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(c){var f=c.replace(b,S);w[f]=new v(f,1,!1,c,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(c){var f=c.replace(b,S);w[f]=new v(f,1,!1,c,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(c){w[c]=new v(c,1,!1,c.toLowerCase(),null,!1,!1)}),w.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(c){w[c]=new v(c,1,!1,c.toLowerCase(),null,!0,!0)});function C(c,f,g,I){var _=w.hasOwnProperty(f)?w[f]:null;(_!==null?_.type!==0:I||!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(y(f,g,_,I)&&(g=null),I||_===null?p(f)&&(g===null?c.removeAttribute(f):c.setAttribute(f,""+g)):_.mustUseProperty?c[_.propertyName]=g===null?_.type===3?!1:"":g:(f=_.attributeName,I=_.attributeNamespace,g===null?c.removeAttribute(f):(_=_.type,g=_===3||_===4&&g===!0?"":""+g,I?c.setAttributeNS(I,f,g):c.setAttribute(f,g))))}var T=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.element"),V=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),E=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),se=Symbol.for("react.offscreen"),X=Symbol.iterator;function re(c){return c===null||typeof c!="object"?null:(c=X&&c[X]||c["@@iterator"],typeof c=="function"?c:null)}var ie=Object.assign,j;function Z(c){if(j===void 0)try{throw Error()}catch(g){var f=g.stack.trim().match(/\n( *(at )?)/);j=f&&f[1]||""}return`
`+j+c}var he=!1;function ve(c,f){if(!c||he)return"";he=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(f)if(f=function(){throw Error()},Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(pe){var I=pe}Reflect.construct(c,[],f)}else{try{f.call()}catch(pe){I=pe}c.call(f.prototype)}else{try{throw Error()}catch(pe){I=pe}c()}}catch(pe){if(pe&&I&&typeof pe.stack=="string"){for(var _=pe.stack.split(`
`),D=I.stack.split(`
`),z=_.length-1,H=D.length-1;1<=z&&0<=H&&_[z]!==D[H];)H--;for(;1<=z&&0<=H;z--,H--)if(_[z]!==D[H]){if(z!==1||H!==1)do if(z--,H--,0>H||_[z]!==D[H]){var te=`
`+_[z].replace(" at new "," at ");return c.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",c.displayName)),te}while(1<=z&&0<=H);break}}}finally{he=!1,Error.prepareStackTrace=g}return(c=c?c.displayName||c.name:"")?Z(c):""}function we(c){switch(c.tag){case 5:return Z(c.type);case 16:return Z("Lazy");case 13:return Z("Suspense");case 19:return Z("SuspenseList");case 0:case 2:case 15:return c=ve(c.type,!1),c;case 11:return c=ve(c.type.render,!1),c;case 1:return c=ve(c.type,!0),c;default:return""}}function Se(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case k:return"Fragment";case V:return"Portal";case N:return"Profiler";case $:return"StrictMode";case F:return"Suspense";case G:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case E:return(c.displayName||"Context")+".Consumer";case R:return(c._context.displayName||"Context")+".Provider";case L:var f=c.render;return c=c.displayName,c||(c=f.displayName||f.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case Y:return f=c.displayName||null,f!==null?f:Se(c.type)||"Memo";case q:f=c._payload,c=c._init;try{return Se(c(f))}catch{}}return null}function Ne(c){var f=c.type;switch(c.tag){case 24:return"Cache";case 9:return(f.displayName||"Context")+".Consumer";case 10:return(f._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=f.render,c=c.displayName||c.name||"",f.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return f;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Se(f);case 8:return f===$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f}return null}function Ae(c){switch(typeof c){case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Pe(c){var f=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function qe(c){var f=Pe(c)?"checked":"value",g=Object.getOwnPropertyDescriptor(c.constructor.prototype,f),I=""+c[f];if(!c.hasOwnProperty(f)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var _=g.get,D=g.set;return Object.defineProperty(c,f,{configurable:!0,get:function(){return _.call(this)},set:function(z){I=""+z,D.call(this,z)}}),Object.defineProperty(c,f,{enumerable:g.enumerable}),{getValue:function(){return I},setValue:function(z){I=""+z},stopTracking:function(){c._valueTracker=null,delete c[f]}}}}function tt(c){c._valueTracker||(c._valueTracker=qe(c))}function wt(c){if(!c)return!1;var f=c._valueTracker;if(!f)return!0;var g=f.getValue(),I="";return c&&(I=Pe(c)?c.checked?"true":"false":c.value),c=I,c!==g?(f.setValue(c),!0):!1}function bt(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}function Pt(c,f){var g=f.checked;return ie({},f,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??c._wrapperState.initialChecked})}function Nt(c,f){var g=f.defaultValue==null?"":f.defaultValue,I=f.checked!=null?f.checked:f.defaultChecked;g=Ae(f.value!=null?f.value:g),c._wrapperState={initialChecked:I,initialValue:g,controlled:f.type==="checkbox"||f.type==="radio"?f.checked!=null:f.value!=null}}function Tt(c,f){f=f.checked,f!=null&&C(c,"checked",f,!1)}function Ft(c,f){Tt(c,f);var g=Ae(f.value),I=f.type;if(g!=null)I==="number"?(g===0&&c.value===""||c.value!=g)&&(c.value=""+g):c.value!==""+g&&(c.value=""+g);else if(I==="submit"||I==="reset"){c.removeAttribute("value");return}f.hasOwnProperty("value")?Rr(c,f.type,g):f.hasOwnProperty("defaultValue")&&Rr(c,f.type,Ae(f.defaultValue)),f.checked==null&&f.defaultChecked!=null&&(c.defaultChecked=!!f.defaultChecked)}function Lt(c,f,g){if(f.hasOwnProperty("value")||f.hasOwnProperty("defaultValue")){var I=f.type;if(!(I!=="submit"&&I!=="reset"||f.value!==void 0&&f.value!==null))return;f=""+c._wrapperState.initialValue,g||f===c.value||(c.value=f),c.defaultValue=f}g=c.name,g!==""&&(c.name=""),c.defaultChecked=!!c._wrapperState.initialChecked,g!==""&&(c.name=g)}function Rr(c,f,g){(f!=="number"||bt(c.ownerDocument)!==c)&&(g==null?c.defaultValue=""+c._wrapperState.initialValue:c.defaultValue!==""+g&&(c.defaultValue=""+g))}var jt=Array.isArray;function rr(c,f,g,I){if(c=c.options,f){f={};for(var _=0;_<g.length;_++)f["$"+g[_]]=!0;for(g=0;g<c.length;g++)_=f.hasOwnProperty("$"+c[g].value),c[g].selected!==_&&(c[g].selected=_),_&&I&&(c[g].defaultSelected=!0)}else{for(g=""+Ae(g),f=null,_=0;_<c.length;_++){if(c[_].value===g){c[_].selected=!0,I&&(c[_].defaultSelected=!0);return}f!==null||c[_].disabled||(f=c[_])}f!==null&&(f.selected=!0)}}function Bn(c,f){if(f.dangerouslySetInnerHTML!=null)throw Error(t(91));return ie({},f,{value:void 0,defaultValue:void 0,children:""+c._wrapperState.initialValue})}function us(c,f){var g=f.value;if(g==null){if(g=f.children,f=f.defaultValue,g!=null){if(f!=null)throw Error(t(92));if(jt(g)){if(1<g.length)throw Error(t(93));g=g[0]}f=g}f==null&&(f=""),g=f}c._wrapperState={initialValue:Ae(g)}}function sr(c,f){var g=Ae(f.value),I=Ae(f.defaultValue);g!=null&&(g=""+g,g!==c.value&&(c.value=g),f.defaultValue==null&&c.defaultValue!==g&&(c.defaultValue=g)),I!=null&&(c.defaultValue=""+I)}function Xr(c){var f=c.textContent;f===c._wrapperState.initialValue&&f!==""&&f!==null&&(c.value=f)}function Gt(c){switch(c){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ht(c,f){return c==null||c==="http://www.w3.org/1999/xhtml"?Gt(f):c==="http://www.w3.org/2000/svg"&&f==="foreignObject"?"http://www.w3.org/1999/xhtml":c}var ir,wi=function(c){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(f,g,I,_){MSApp.execUnsafeLocalFunction(function(){return c(f,g,I,_)})}:c}(function(c,f){if(c.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in c)c.innerHTML=f;else{for(ir=ir||document.createElement("div"),ir.innerHTML="<svg>"+f.valueOf().toString()+"</svg>",f=ir.firstChild;c.firstChild;)c.removeChild(c.firstChild);for(;f.firstChild;)c.appendChild(f.firstChild)}});function Js(c,f){if(f){var g=c.firstChild;if(g&&g===c.lastChild&&g.nodeType===3){g.nodeValue=f;return}}c.textContent=f}var vi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uo=["Webkit","ms","Moz","O"];Object.keys(vi).forEach(function(c){Uo.forEach(function(f){f=f+c.charAt(0).toUpperCase()+c.substring(1),vi[f]=vi[c]})});function no(c,f,g){return f==null||typeof f=="boolean"||f===""?"":g||typeof f!="number"||f===0||vi.hasOwnProperty(c)&&vi[c]?(""+f).trim():f+"px"}function ou(c,f){c=c.style;for(var g in f)if(f.hasOwnProperty(g)){var I=g.indexOf("--")===0,_=no(g,f[g],I);g==="float"&&(g="cssFloat"),I?c.setProperty(g,_):c[g]=_}}var au=ie({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Uf(c,f){if(f){if(au[c]&&(f.children!=null||f.dangerouslySetInnerHTML!=null))throw Error(t(137,c));if(f.dangerouslySetInnerHTML!=null){if(f.children!=null)throw Error(t(60));if(typeof f.dangerouslySetInnerHTML!="object"||!("__html"in f.dangerouslySetInnerHTML))throw Error(t(61))}if(f.style!=null&&typeof f.style!="object")throw Error(t(62))}}function Wf(c,f){if(c.indexOf("-")===-1)return typeof f.is=="string";switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lu=null;function Wc(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var jc=null,Zs=null,ro=null;function Gc(c){if(c=fp(c)){if(typeof jc!="function")throw Error(t(280));var f=c.stateNode;f&&(f=d0(f),jc(c.stateNode,c.type,f))}}function so(c){Zs?ro?ro.push(c):ro=[c]:Zs=c}function jf(){if(Zs){var c=Zs,f=ro;if(ro=Zs=null,Gc(c),f)for(c=0;c<f.length;c++)Gc(f[c])}}function uu(c,f){return c(f)}function Gf(){}var Wo=!1;function Hf(c,f,g){if(Wo)return c(f,g);Wo=!0;try{return uu(c,f,g)}finally{Wo=!1,(Zs!==null||ro!==null)&&(Gf(),jf())}}function Tn(c,f){var g=c.stateNode;if(g===null)return null;var I=d0(g);if(I===null)return null;g=I[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(c=c.type,I=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!I;break e;default:c=!1}if(c)return null;if(g&&typeof g!="function")throw Error(t(231,f,typeof g));return g}var Hc=!1;if(a)try{var xi={};Object.defineProperty(xi,"passive",{get:function(){Hc=!0}}),window.addEventListener("test",xi,xi),window.removeEventListener("test",xi,xi)}catch{Hc=!1}function cu(c,f,g,I,_,D,z,H,te){var pe=Array.prototype.slice.call(arguments,3);try{f.apply(g,pe)}catch(_e){this.onError(_e)}}var hu=!1,qc=null,bi=!1,qf=null,J1={onError:function(c){hu=!0,qc=c}};function Kc(c,f,g,I,_,D,z,H,te){hu=!1,qc=null,cu.apply(J1,arguments)}function Ly(c,f,g,I,_,D,z,H,te){if(Kc.apply(this,arguments),hu){if(hu){var pe=qc;hu=!1,qc=null}else throw Error(t(198));bi||(bi=!0,qf=pe)}}function Ii(c){var f=c,g=c;if(c.alternate)for(;f.return;)f=f.return;else{c=f;do f=c,f.flags&4098&&(g=f.return),c=f.return;while(c)}return f.tag===3?g:null}function du(c){if(c.tag===13){var f=c.memoizedState;if(f===null&&(c=c.alternate,c!==null&&(f=c.memoizedState)),f!==null)return f.dehydrated}return null}function Si(c){if(Ii(c)!==c)throw Error(t(188))}function My(c){var f=c.alternate;if(!f){if(f=Ii(c),f===null)throw Error(t(188));return f!==c?null:c}for(var g=c,I=f;;){var _=g.return;if(_===null)break;var D=_.alternate;if(D===null){if(I=_.return,I!==null){g=I;continue}break}if(_.child===D.child){for(D=_.child;D;){if(D===g)return Si(_),c;if(D===I)return Si(_),f;D=D.sibling}throw Error(t(188))}if(g.return!==I.return)g=_,I=D;else{for(var z=!1,H=_.child;H;){if(H===g){z=!0,g=_,I=D;break}if(H===I){z=!0,I=_,g=D;break}H=H.sibling}if(!z){for(H=D.child;H;){if(H===g){z=!0,g=D,I=_;break}if(H===I){z=!0,I=D,g=_;break}H=H.sibling}if(!z)throw Error(t(189))}}if(g.alternate!==I)throw Error(t(190))}if(g.tag!==3)throw Error(t(188));return g.stateNode.current===g?c:f}function Kf(c){return c=My(c),c!==null?Xc(c):null}function Xc(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var f=Xc(c);if(f!==null)return f;c=c.sibling}return null}var Qc=e.unstable_scheduleCallback,Xf=e.unstable_cancelCallback,Vy=e.unstable_shouldYield,Z1=e.unstable_requestPaint,Jt=e.unstable_now,zy=e.unstable_getCurrentPriorityLevel,fu=e.unstable_ImmediatePriority,Va=e.unstable_UserBlockingPriority,ei=e.unstable_NormalPriority,Qf=e.unstable_LowPriority,By=e.unstable_IdlePriority,pu=null,As=null;function Uy(c){if(As&&typeof As.onCommitFiberRoot=="function")try{As.onCommitFiberRoot(pu,c,void 0,(c.current.flags&128)===128)}catch{}}var Qr=Math.clz32?Math.clz32:jy,Yf=Math.log,Wy=Math.LN2;function jy(c){return c>>>=0,c===0?32:31-(Yf(c)/Wy|0)|0}var Yc=64,Jc=4194304;function za(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function mu(c,f){var g=c.pendingLanes;if(g===0)return 0;var I=0,_=c.suspendedLanes,D=c.pingedLanes,z=g&268435455;if(z!==0){var H=z&~_;H!==0?I=za(H):(D&=z,D!==0&&(I=za(D)))}else z=g&~_,z!==0?I=za(z):D!==0&&(I=za(D));if(I===0)return 0;if(f!==0&&f!==I&&!(f&_)&&(_=I&-I,D=f&-f,_>=D||_===16&&(D&4194240)!==0))return f;if(I&4&&(I|=g&16),f=c.entangledLanes,f!==0)for(c=c.entanglements,f&=I;0<f;)g=31-Qr(f),_=1<<g,I|=c[g],f&=~_;return I}function eI(c,f){switch(c){case 1:case 2:case 4:return f+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jo(c,f){for(var g=c.suspendedLanes,I=c.pingedLanes,_=c.expirationTimes,D=c.pendingLanes;0<D;){var z=31-Qr(D),H=1<<z,te=_[z];te===-1?(!(H&g)||H&I)&&(_[z]=eI(H,f)):te<=f&&(c.expiredLanes|=H),D&=~H}}function Ds(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function gu(){var c=Yc;return Yc<<=1,!(Yc&4194240)&&(Yc=64),c}function Ba(c){for(var f=[],g=0;31>g;g++)f.push(c);return f}function Ua(c,f,g){c.pendingLanes|=f,f!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,f=31-Qr(f),c[f]=g}function Kt(c,f){var g=c.pendingLanes&~f;c.pendingLanes=f,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=f,c.mutableReadLanes&=f,c.entangledLanes&=f,f=c.entanglements;var I=c.eventTimes;for(c=c.expirationTimes;0<g;){var _=31-Qr(g),D=1<<_;f[_]=0,I[_]=-1,c[_]=-1,g&=~D}}function Wa(c,f){var g=c.entangledLanes|=f;for(c=c.entanglements;g;){var I=31-Qr(g),_=1<<I;_&f|c[I]&f&&(c[I]|=f),g&=~_}}var _t=0;function ja(c){return c&=-c,1<c?4<c?c&268435455?16:536870912:4:1}var Gy,Zc,Hy,qy,Ky,Jf=!1,io=[],Ir=null,Ti=null,_i=null,Ga=new Map,ti=new Map,oo=[],tI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xy(c,f){switch(c){case"focusin":case"focusout":Ir=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":_i=null;break;case"pointerover":case"pointerout":Ga.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":ti.delete(f.pointerId)}}function cs(c,f,g,I,_,D){return c===null||c.nativeEvent!==D?(c={blockedOn:f,domEventName:g,eventSystemFlags:I,nativeEvent:D,targetContainers:[_]},f!==null&&(f=fp(f),f!==null&&Zc(f)),c):(c.eventSystemFlags|=I,f=c.targetContainers,_!==null&&f.indexOf(_)===-1&&f.push(_),c)}function nI(c,f,g,I,_){switch(f){case"focusin":return Ir=cs(Ir,c,f,g,I,_),!0;case"dragenter":return Ti=cs(Ti,c,f,g,I,_),!0;case"mouseover":return _i=cs(_i,c,f,g,I,_),!0;case"pointerover":var D=_.pointerId;return Ga.set(D,cs(Ga.get(D)||null,c,f,g,I,_)),!0;case"gotpointercapture":return D=_.pointerId,ti.set(D,cs(ti.get(D)||null,c,f,g,I,_)),!0}return!1}function Qy(c){var f=bu(c.target);if(f!==null){var g=Ii(f);if(g!==null){if(f=g.tag,f===13){if(f=du(g),f!==null){c.blockedOn=f,Ky(c.priority,function(){Hy(g)});return}}else if(f===3&&g.stateNode.current.memoizedState.isDehydrated){c.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}c.blockedOn=null}function Go(c){if(c.blockedOn!==null)return!1;for(var f=c.targetContainers;0<f.length;){var g=eh(c.domEventName,c.eventSystemFlags,f[0],c.nativeEvent);if(g===null){g=c.nativeEvent;var I=new g.constructor(g.type,g);lu=I,g.target.dispatchEvent(I),lu=null}else return f=fp(g),f!==null&&Zc(f),c.blockedOn=g,!1;f.shift()}return!0}function yu(c,f,g){Go(c)&&g.delete(f)}function Yy(){Jf=!1,Ir!==null&&Go(Ir)&&(Ir=null),Ti!==null&&Go(Ti)&&(Ti=null),_i!==null&&Go(_i)&&(_i=null),Ga.forEach(yu),ti.forEach(yu)}function Ci(c,f){c.blockedOn===f&&(c.blockedOn=null,Jf||(Jf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Yy)))}function Ei(c){function f(_){return Ci(_,c)}if(0<io.length){Ci(io[0],c);for(var g=1;g<io.length;g++){var I=io[g];I.blockedOn===c&&(I.blockedOn=null)}}for(Ir!==null&&Ci(Ir,c),Ti!==null&&Ci(Ti,c),_i!==null&&Ci(_i,c),Ga.forEach(f),ti.forEach(f),g=0;g<oo.length;g++)I=oo[g],I.blockedOn===c&&(I.blockedOn=null);for(;0<oo.length&&(g=oo[0],g.blockedOn===null);)Qy(g),g.blockedOn===null&&oo.shift()}var Ho=T.ReactCurrentBatchConfig,Ha=!0;function sn(c,f,g,I){var _=_t,D=Ho.transition;Ho.transition=null;try{_t=1,Zf(c,f,g,I)}finally{_t=_,Ho.transition=D}}function rI(c,f,g,I){var _=_t,D=Ho.transition;Ho.transition=null;try{_t=4,Zf(c,f,g,I)}finally{_t=_,Ho.transition=D}}function Zf(c,f,g,I){if(Ha){var _=eh(c,f,g,I);if(_===null)pI(c,f,I,wu,g),Xy(c,I);else if(nI(_,c,f,g,I))I.stopPropagation();else if(Xy(c,I),f&4&&-1<tI.indexOf(c)){for(;_!==null;){var D=fp(_);if(D!==null&&Gy(D),D=eh(c,f,g,I),D===null&&pI(c,f,I,wu,g),D===_)break;_=D}_!==null&&I.stopPropagation()}else pI(c,f,I,null,g)}}var wu=null;function eh(c,f,g,I){if(wu=null,c=Wc(I),c=bu(c),c!==null)if(f=Ii(c),f===null)c=null;else if(g=f.tag,g===13){if(c=du(f),c!==null)return c;c=null}else if(g===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;c=null}else f!==c&&(c=null);return wu=c,null}function ep(c){switch(c){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zy()){case fu:return 1;case Va:return 4;case ei:case Qf:return 16;case By:return 536870912;default:return 16}default:return 16}}var Os=null,th=null,hs=null;function tp(){if(hs)return hs;var c,f=th,g=f.length,I,_="value"in Os?Os.value:Os.textContent,D=_.length;for(c=0;c<g&&f[c]===_[c];c++);var z=g-c;for(I=1;I<=z&&f[g-I]===_[D-I];I++);return hs=_.slice(c,1<I?1-I:void 0)}function nh(c){var f=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&f===13&&(c=13)):c=f,c===10&&(c=13),32<=c||c===13?c:0}function ao(){return!0}function np(){return!1}function Sr(c){function f(g,I,_,D,z){this._reactName=g,this._targetInst=_,this.type=I,this.nativeEvent=D,this.target=z,this.currentTarget=null;for(var H in c)c.hasOwnProperty(H)&&(g=c[H],this[H]=g?g(D):D[H]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?ao:np,this.isPropagationStopped=np,this}return ie(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=ao)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=ao)},persist:function(){},isPersistent:ao}),f}var ki={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rh=Sr(ki),lo=ie({},ki,{view:0,detail:0}),sI=Sr(lo),sh,qo,qa,vu=ie({},lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uo,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==qa&&(qa&&c.type==="mousemove"?(sh=c.screenX-qa.screenX,qo=c.screenY-qa.screenY):qo=sh=0,qa=c),sh)},movementY:function(c){return"movementY"in c?c.movementY:qo}}),ih=Sr(vu),rp=ie({},vu,{dataTransfer:0}),Jy=Sr(rp),oh=ie({},lo,{relatedTarget:0}),ah=Sr(oh),Zy=ie({},ki,{animationName:0,elapsedTime:0,pseudoElement:0}),Ko=Sr(Zy),e0=ie({},ki,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),t0=Sr(e0),n0=ie({},ki,{data:0}),sp=Sr(n0),lh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Yr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},r0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function s0(c){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(c):(c=r0[c])?!!f[c]:!1}function uo(){return s0}var x=ie({},lo,{key:function(c){if(c.key){var f=lh[c.key]||c.key;if(f!=="Unidentified")return f}return c.type==="keypress"?(c=nh(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Yr[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uo,charCode:function(c){return c.type==="keypress"?nh(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?nh(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),A=Sr(x),M=ie({},vu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),W=Sr(M),ue=ie({},lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uo}),ge=Sr(ue),De=ie({},ki,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bt=Sr(De),Un=ie({},vu,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),$t=Sr(Un),or=[9,13,27,32],An=a&&"CompositionEvent"in window,ni=null;a&&"documentMode"in document&&(ni=document.documentMode);var Ps=a&&"TextEvent"in window&&!ni,xu=a&&(!An||ni&&8<ni&&11>=ni),uh=" ",L2=!1;function M2(c,f){switch(c){case"keyup":return or.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function V2(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var ch=!1;function CW(c,f){switch(c){case"compositionend":return V2(f);case"keypress":return f.which!==32?null:(L2=!0,uh);case"textInput":return c=f.data,c===uh&&L2?null:c;default:return null}}function EW(c,f){if(ch)return c==="compositionend"||!An&&M2(c,f)?(c=tp(),hs=th=Os=null,ch=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return xu&&f.locale!=="ko"?null:f.data;default:return null}}var kW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function z2(c){var f=c&&c.nodeName&&c.nodeName.toLowerCase();return f==="input"?!!kW[c.type]:f==="textarea"}function B2(c,f,g,I){so(I),f=u0(f,"onChange"),0<f.length&&(g=new rh("onChange","change",null,g,I),c.push({event:g,listeners:f}))}var ip=null,op=null;function NW(c){i$(c,0)}function i0(c){var f=mh(c);if(wt(f))return c}function $W(c,f){if(c==="change")return f}var U2=!1;if(a){var iI;if(a){var oI="oninput"in document;if(!oI){var W2=document.createElement("div");W2.setAttribute("oninput","return;"),oI=typeof W2.oninput=="function"}iI=oI}else iI=!1;U2=iI&&(!document.documentMode||9<document.documentMode)}function j2(){ip&&(ip.detachEvent("onpropertychange",G2),op=ip=null)}function G2(c){if(c.propertyName==="value"&&i0(op)){var f=[];B2(f,op,c,Wc(c)),Hf(NW,f)}}function RW(c,f,g){c==="focusin"?(j2(),ip=f,op=g,ip.attachEvent("onpropertychange",G2)):c==="focusout"&&j2()}function AW(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return i0(op)}function DW(c,f){if(c==="click")return i0(f)}function OW(c,f){if(c==="input"||c==="change")return i0(f)}function PW(c,f){return c===f&&(c!==0||1/c===1/f)||c!==c&&f!==f}var Ni=typeof Object.is=="function"?Object.is:PW;function ap(c,f){if(Ni(c,f))return!0;if(typeof c!="object"||c===null||typeof f!="object"||f===null)return!1;var g=Object.keys(c),I=Object.keys(f);if(g.length!==I.length)return!1;for(I=0;I<g.length;I++){var _=g[I];if(!l.call(f,_)||!Ni(c[_],f[_]))return!1}return!0}function H2(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function q2(c,f){var g=H2(c);c=0;for(var I;g;){if(g.nodeType===3){if(I=c+g.textContent.length,c<=f&&I>=f)return{node:g,offset:f-c};c=I}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=H2(g)}}function K2(c,f){return c&&f?c===f?!0:c&&c.nodeType===3?!1:f&&f.nodeType===3?K2(c,f.parentNode):"contains"in c?c.contains(f):c.compareDocumentPosition?!!(c.compareDocumentPosition(f)&16):!1:!1}function X2(){for(var c=window,f=bt();f instanceof c.HTMLIFrameElement;){try{var g=typeof f.contentWindow.location.href=="string"}catch{g=!1}if(g)c=f.contentWindow;else break;f=bt(c.document)}return f}function aI(c){var f=c&&c.nodeName&&c.nodeName.toLowerCase();return f&&(f==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||f==="textarea"||c.contentEditable==="true")}function FW(c){var f=X2(),g=c.focusedElem,I=c.selectionRange;if(f!==g&&g&&g.ownerDocument&&K2(g.ownerDocument.documentElement,g)){if(I!==null&&aI(g)){if(f=I.start,c=I.end,c===void 0&&(c=f),"selectionStart"in g)g.selectionStart=f,g.selectionEnd=Math.min(c,g.value.length);else if(c=(f=g.ownerDocument||document)&&f.defaultView||window,c.getSelection){c=c.getSelection();var _=g.textContent.length,D=Math.min(I.start,_);I=I.end===void 0?D:Math.min(I.end,_),!c.extend&&D>I&&(_=I,I=D,D=_),_=q2(g,D);var z=q2(g,I);_&&z&&(c.rangeCount!==1||c.anchorNode!==_.node||c.anchorOffset!==_.offset||c.focusNode!==z.node||c.focusOffset!==z.offset)&&(f=f.createRange(),f.setStart(_.node,_.offset),c.removeAllRanges(),D>I?(c.addRange(f),c.extend(z.node,z.offset)):(f.setEnd(z.node,z.offset),c.addRange(f)))}}for(f=[],c=g;c=c.parentNode;)c.nodeType===1&&f.push({element:c,left:c.scrollLeft,top:c.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<f.length;g++)c=f[g],c.element.scrollLeft=c.left,c.element.scrollTop=c.top}}var LW=a&&"documentMode"in document&&11>=document.documentMode,hh=null,lI=null,lp=null,uI=!1;function Q2(c,f,g){var I=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;uI||hh==null||hh!==bt(I)||(I=hh,"selectionStart"in I&&aI(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),lp&&ap(lp,I)||(lp=I,I=u0(lI,"onSelect"),0<I.length&&(f=new rh("onSelect","select",null,f,g),c.push({event:f,listeners:I}),f.target=hh)))}function o0(c,f){var g={};return g[c.toLowerCase()]=f.toLowerCase(),g["Webkit"+c]="webkit"+f,g["Moz"+c]="moz"+f,g}var dh={animationend:o0("Animation","AnimationEnd"),animationiteration:o0("Animation","AnimationIteration"),animationstart:o0("Animation","AnimationStart"),transitionend:o0("Transition","TransitionEnd")},cI={},Y2={};a&&(Y2=document.createElement("div").style,"AnimationEvent"in window||(delete dh.animationend.animation,delete dh.animationiteration.animation,delete dh.animationstart.animation),"TransitionEvent"in window||delete dh.transitionend.transition);function a0(c){if(cI[c])return cI[c];if(!dh[c])return c;var f=dh[c],g;for(g in f)if(f.hasOwnProperty(g)&&g in Y2)return cI[c]=f[g];return c}var J2=a0("animationend"),Z2=a0("animationiteration"),e$=a0("animationstart"),t$=a0("transitionend"),n$=new Map,r$="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ka(c,f){n$.set(c,f),i(f,[c])}for(var hI=0;hI<r$.length;hI++){var dI=r$[hI],MW=dI.toLowerCase(),VW=dI[0].toUpperCase()+dI.slice(1);Ka(MW,"on"+VW)}Ka(J2,"onAnimationEnd"),Ka(Z2,"onAnimationIteration"),Ka(e$,"onAnimationStart"),Ka("dblclick","onDoubleClick"),Ka("focusin","onFocus"),Ka("focusout","onBlur"),Ka(t$,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var up="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zW=new Set("cancel close invalid load scroll toggle".split(" ").concat(up));function s$(c,f,g){var I=c.type||"unknown-event";c.currentTarget=g,Ly(I,f,void 0,c),c.currentTarget=null}function i$(c,f){f=(f&4)!==0;for(var g=0;g<c.length;g++){var I=c[g],_=I.event;I=I.listeners;e:{var D=void 0;if(f)for(var z=I.length-1;0<=z;z--){var H=I[z],te=H.instance,pe=H.currentTarget;if(H=H.listener,te!==D&&_.isPropagationStopped())break e;s$(_,H,pe),D=te}else for(z=0;z<I.length;z++){if(H=I[z],te=H.instance,pe=H.currentTarget,H=H.listener,te!==D&&_.isPropagationStopped())break e;s$(_,H,pe),D=te}}}if(bi)throw c=qf,bi=!1,qf=null,c}function en(c,f){var g=f[xI];g===void 0&&(g=f[xI]=new Set);var I=c+"__bubble";g.has(I)||(o$(f,c,2,!1),g.add(I))}function fI(c,f,g){var I=0;f&&(I|=4),o$(g,c,I,f)}var l0="_reactListening"+Math.random().toString(36).slice(2);function cp(c){if(!c[l0]){c[l0]=!0,r.forEach(function(g){g!=="selectionchange"&&(zW.has(g)||fI(g,!1,c),fI(g,!0,c))});var f=c.nodeType===9?c:c.ownerDocument;f===null||f[l0]||(f[l0]=!0,fI("selectionchange",!1,f))}}function o$(c,f,g,I){switch(ep(f)){case 1:var _=sn;break;case 4:_=rI;break;default:_=Zf}g=_.bind(null,f,g,c),_=void 0,!Hc||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(_=!0),I?_!==void 0?c.addEventListener(f,g,{capture:!0,passive:_}):c.addEventListener(f,g,!0):_!==void 0?c.addEventListener(f,g,{passive:_}):c.addEventListener(f,g,!1)}function pI(c,f,g,I,_){var D=I;if(!(f&1)&&!(f&2)&&I!==null)e:for(;;){if(I===null)return;var z=I.tag;if(z===3||z===4){var H=I.stateNode.containerInfo;if(H===_||H.nodeType===8&&H.parentNode===_)break;if(z===4)for(z=I.return;z!==null;){var te=z.tag;if((te===3||te===4)&&(te=z.stateNode.containerInfo,te===_||te.nodeType===8&&te.parentNode===_))return;z=z.return}for(;H!==null;){if(z=bu(H),z===null)return;if(te=z.tag,te===5||te===6){I=D=z;continue e}H=H.parentNode}}I=I.return}Hf(function(){var pe=D,_e=Wc(g),ke=[];e:{var Te=n$.get(c);if(Te!==void 0){var Me=rh,We=c;switch(c){case"keypress":if(nh(g)===0)break e;case"keydown":case"keyup":Me=A;break;case"focusin":We="focus",Me=ah;break;case"focusout":We="blur",Me=ah;break;case"beforeblur":case"afterblur":Me=ah;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Me=ih;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Me=Jy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Me=ge;break;case J2:case Z2:case e$:Me=Ko;break;case t$:Me=Bt;break;case"scroll":Me=sI;break;case"wheel":Me=$t;break;case"copy":case"cut":case"paste":Me=t0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Me=W}var He=(f&4)!==0,_n=!He&&c==="scroll",ce=He?Te!==null?Te+"Capture":null:Te;He=[];for(var oe=pe,de;oe!==null;){de=oe;var $e=de.stateNode;if(de.tag===5&&$e!==null&&(de=$e,ce!==null&&($e=Tn(oe,ce),$e!=null&&He.push(hp(oe,$e,de)))),_n)break;oe=oe.return}0<He.length&&(Te=new Me(Te,We,null,g,_e),ke.push({event:Te,listeners:He}))}}if(!(f&7)){e:{if(Te=c==="mouseover"||c==="pointerover",Me=c==="mouseout"||c==="pointerout",Te&&g!==lu&&(We=g.relatedTarget||g.fromElement)&&(bu(We)||We[Xo]))break e;if((Me||Te)&&(Te=_e.window===_e?_e:(Te=_e.ownerDocument)?Te.defaultView||Te.parentWindow:window,Me?(We=g.relatedTarget||g.toElement,Me=pe,We=We?bu(We):null,We!==null&&(_n=Ii(We),We!==_n||We.tag!==5&&We.tag!==6)&&(We=null)):(Me=null,We=pe),Me!==We)){if(He=ih,$e="onMouseLeave",ce="onMouseEnter",oe="mouse",(c==="pointerout"||c==="pointerover")&&(He=W,$e="onPointerLeave",ce="onPointerEnter",oe="pointer"),_n=Me==null?Te:mh(Me),de=We==null?Te:mh(We),Te=new He($e,oe+"leave",Me,g,_e),Te.target=_n,Te.relatedTarget=de,$e=null,bu(_e)===pe&&(He=new He(ce,oe+"enter",We,g,_e),He.target=de,He.relatedTarget=_n,$e=He),_n=$e,Me&&We)t:{for(He=Me,ce=We,oe=0,de=He;de;de=fh(de))oe++;for(de=0,$e=ce;$e;$e=fh($e))de++;for(;0<oe-de;)He=fh(He),oe--;for(;0<de-oe;)ce=fh(ce),de--;for(;oe--;){if(He===ce||ce!==null&&He===ce.alternate)break t;He=fh(He),ce=fh(ce)}He=null}else He=null;Me!==null&&a$(ke,Te,Me,He,!1),We!==null&&_n!==null&&a$(ke,_n,We,He,!0)}}e:{if(Te=pe?mh(pe):window,Me=Te.nodeName&&Te.nodeName.toLowerCase(),Me==="select"||Me==="input"&&Te.type==="file")var Ke=$W;else if(z2(Te))if(U2)Ke=OW;else{Ke=AW;var Je=RW}else(Me=Te.nodeName)&&Me.toLowerCase()==="input"&&(Te.type==="checkbox"||Te.type==="radio")&&(Ke=DW);if(Ke&&(Ke=Ke(c,pe))){B2(ke,Ke,g,_e);break e}Je&&Je(c,Te,pe),c==="focusout"&&(Je=Te._wrapperState)&&Je.controlled&&Te.type==="number"&&Rr(Te,"number",Te.value)}switch(Je=pe?mh(pe):window,c){case"focusin":(z2(Je)||Je.contentEditable==="true")&&(hh=Je,lI=pe,lp=null);break;case"focusout":lp=lI=hh=null;break;case"mousedown":uI=!0;break;case"contextmenu":case"mouseup":case"dragend":uI=!1,Q2(ke,g,_e);break;case"selectionchange":if(LW)break;case"keydown":case"keyup":Q2(ke,g,_e)}var Ze;if(An)e:{switch(c){case"compositionstart":var st="onCompositionStart";break e;case"compositionend":st="onCompositionEnd";break e;case"compositionupdate":st="onCompositionUpdate";break e}st=void 0}else ch?M2(c,g)&&(st="onCompositionEnd"):c==="keydown"&&g.keyCode===229&&(st="onCompositionStart");st&&(xu&&g.locale!=="ko"&&(ch||st!=="onCompositionStart"?st==="onCompositionEnd"&&ch&&(Ze=tp()):(Os=_e,th="value"in Os?Os.value:Os.textContent,ch=!0)),Je=u0(pe,st),0<Je.length&&(st=new sp(st,c,null,g,_e),ke.push({event:st,listeners:Je}),Ze?st.data=Ze:(Ze=V2(g),Ze!==null&&(st.data=Ze)))),(Ze=Ps?CW(c,g):EW(c,g))&&(pe=u0(pe,"onBeforeInput"),0<pe.length&&(_e=new sp("onBeforeInput","beforeinput",null,g,_e),ke.push({event:_e,listeners:pe}),_e.data=Ze))}i$(ke,f)})}function hp(c,f,g){return{instance:c,listener:f,currentTarget:g}}function u0(c,f){for(var g=f+"Capture",I=[];c!==null;){var _=c,D=_.stateNode;_.tag===5&&D!==null&&(_=D,D=Tn(c,g),D!=null&&I.unshift(hp(c,D,_)),D=Tn(c,f),D!=null&&I.push(hp(c,D,_))),c=c.return}return I}function fh(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5);return c||null}function a$(c,f,g,I,_){for(var D=f._reactName,z=[];g!==null&&g!==I;){var H=g,te=H.alternate,pe=H.stateNode;if(te!==null&&te===I)break;H.tag===5&&pe!==null&&(H=pe,_?(te=Tn(g,D),te!=null&&z.unshift(hp(g,te,H))):_||(te=Tn(g,D),te!=null&&z.push(hp(g,te,H)))),g=g.return}z.length!==0&&c.push({event:f,listeners:z})}var BW=/\r\n?/g,UW=/\u0000|\uFFFD/g;function l$(c){return(typeof c=="string"?c:""+c).replace(BW,`
`).replace(UW,"")}function c0(c,f,g){if(f=l$(f),l$(c)!==f&&g)throw Error(t(425))}function h0(){}var mI=null,gI=null;function yI(c,f){return c==="textarea"||c==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var wI=typeof setTimeout=="function"?setTimeout:void 0,WW=typeof clearTimeout=="function"?clearTimeout:void 0,u$=typeof Promise=="function"?Promise:void 0,jW=typeof queueMicrotask=="function"?queueMicrotask:typeof u$<"u"?function(c){return u$.resolve(null).then(c).catch(GW)}:wI;function GW(c){setTimeout(function(){throw c})}function vI(c,f){var g=f,I=0;do{var _=g.nextSibling;if(c.removeChild(g),_&&_.nodeType===8)if(g=_.data,g==="/$"){if(I===0){c.removeChild(_),Ei(f);return}I--}else g!=="$"&&g!=="$?"&&g!=="$!"||I++;g=_}while(g);Ei(f)}function Xa(c){for(;c!=null;c=c.nextSibling){var f=c.nodeType;if(f===1||f===3)break;if(f===8){if(f=c.data,f==="$"||f==="$!"||f==="$?")break;if(f==="/$")return null}}return c}function c$(c){c=c.previousSibling;for(var f=0;c;){if(c.nodeType===8){var g=c.data;if(g==="$"||g==="$!"||g==="$?"){if(f===0)return c;f--}else g==="/$"&&f++}c=c.previousSibling}return null}var ph=Math.random().toString(36).slice(2),co="__reactFiber$"+ph,dp="__reactProps$"+ph,Xo="__reactContainer$"+ph,xI="__reactEvents$"+ph,HW="__reactListeners$"+ph,qW="__reactHandles$"+ph;function bu(c){var f=c[co];if(f)return f;for(var g=c.parentNode;g;){if(f=g[Xo]||g[co]){if(g=f.alternate,f.child!==null||g!==null&&g.child!==null)for(c=c$(c);c!==null;){if(g=c[co])return g;c=c$(c)}return f}c=g,g=c.parentNode}return null}function fp(c){return c=c[co]||c[Xo],!c||c.tag!==5&&c.tag!==6&&c.tag!==13&&c.tag!==3?null:c}function mh(c){if(c.tag===5||c.tag===6)return c.stateNode;throw Error(t(33))}function d0(c){return c[dp]||null}var bI=[],gh=-1;function Qa(c){return{current:c}}function tn(c){0>gh||(c.current=bI[gh],bI[gh]=null,gh--)}function Zt(c,f){gh++,bI[gh]=c.current,c.current=f}var Ya={},Ar=Qa(Ya),ds=Qa(!1),Iu=Ya;function yh(c,f){var g=c.type.contextTypes;if(!g)return Ya;var I=c.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===f)return I.__reactInternalMemoizedMaskedChildContext;var _={},D;for(D in g)_[D]=f[D];return I&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=f,c.__reactInternalMemoizedMaskedChildContext=_),_}function fs(c){return c=c.childContextTypes,c!=null}function f0(){tn(ds),tn(Ar)}function h$(c,f,g){if(Ar.current!==Ya)throw Error(t(168));Zt(Ar,f),Zt(ds,g)}function d$(c,f,g){var I=c.stateNode;if(f=f.childContextTypes,typeof I.getChildContext!="function")return g;I=I.getChildContext();for(var _ in I)if(!(_ in f))throw Error(t(108,Ne(c)||"Unknown",_));return ie({},g,I)}function p0(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||Ya,Iu=Ar.current,Zt(Ar,c),Zt(ds,ds.current),!0}function f$(c,f,g){var I=c.stateNode;if(!I)throw Error(t(169));g?(c=d$(c,f,Iu),I.__reactInternalMemoizedMergedChildContext=c,tn(ds),tn(Ar),Zt(Ar,c)):tn(ds),Zt(ds,g)}var Qo=null,m0=!1,II=!1;function p$(c){Qo===null?Qo=[c]:Qo.push(c)}function KW(c){m0=!0,p$(c)}function Ja(){if(!II&&Qo!==null){II=!0;var c=0,f=_t;try{var g=Qo;for(_t=1;c<g.length;c++){var I=g[c];do I=I(!0);while(I!==null)}Qo=null,m0=!1}catch(_){throw Qo!==null&&(Qo=Qo.slice(c+1)),Qc(fu,Ja),_}finally{_t=f,II=!1}}return null}var wh=[],vh=0,g0=null,y0=0,ri=[],si=0,Su=null,Yo=1,Jo="";function Tu(c,f){wh[vh++]=y0,wh[vh++]=g0,g0=c,y0=f}function m$(c,f,g){ri[si++]=Yo,ri[si++]=Jo,ri[si++]=Su,Su=c;var I=Yo;c=Jo;var _=32-Qr(I)-1;I&=~(1<<_),g+=1;var D=32-Qr(f)+_;if(30<D){var z=_-_%5;D=(I&(1<<z)-1).toString(32),I>>=z,_-=z,Yo=1<<32-Qr(f)+_|g<<_|I,Jo=D+c}else Yo=1<<D|g<<_|I,Jo=c}function SI(c){c.return!==null&&(Tu(c,1),m$(c,1,0))}function TI(c){for(;c===g0;)g0=wh[--vh],wh[vh]=null,y0=wh[--vh],wh[vh]=null;for(;c===Su;)Su=ri[--si],ri[si]=null,Jo=ri[--si],ri[si]=null,Yo=ri[--si],ri[si]=null}var Fs=null,Ls=null,on=!1,$i=null;function g$(c,f){var g=li(5,null,null,0);g.elementType="DELETED",g.stateNode=f,g.return=c,f=c.deletions,f===null?(c.deletions=[g],c.flags|=16):f.push(g)}function y$(c,f){switch(c.tag){case 5:var g=c.type;return f=f.nodeType!==1||g.toLowerCase()!==f.nodeName.toLowerCase()?null:f,f!==null?(c.stateNode=f,Fs=c,Ls=Xa(f.firstChild),!0):!1;case 6:return f=c.pendingProps===""||f.nodeType!==3?null:f,f!==null?(c.stateNode=f,Fs=c,Ls=null,!0):!1;case 13:return f=f.nodeType!==8?null:f,f!==null?(g=Su!==null?{id:Yo,overflow:Jo}:null,c.memoizedState={dehydrated:f,treeContext:g,retryLane:1073741824},g=li(18,null,null,0),g.stateNode=f,g.return=c,c.child=g,Fs=c,Ls=null,!0):!1;default:return!1}}function _I(c){return(c.mode&1)!==0&&(c.flags&128)===0}function CI(c){if(on){var f=Ls;if(f){var g=f;if(!y$(c,f)){if(_I(c))throw Error(t(418));f=Xa(g.nextSibling);var I=Fs;f&&y$(c,f)?g$(I,g):(c.flags=c.flags&-4097|2,on=!1,Fs=c)}}else{if(_I(c))throw Error(t(418));c.flags=c.flags&-4097|2,on=!1,Fs=c}}}function w$(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;Fs=c}function w0(c){if(c!==Fs)return!1;if(!on)return w$(c),on=!0,!1;var f;if((f=c.tag!==3)&&!(f=c.tag!==5)&&(f=c.type,f=f!=="head"&&f!=="body"&&!yI(c.type,c.memoizedProps)),f&&(f=Ls)){if(_I(c))throw v$(),Error(t(418));for(;f;)g$(c,f),f=Xa(f.nextSibling)}if(w$(c),c.tag===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(t(317));e:{for(c=c.nextSibling,f=0;c;){if(c.nodeType===8){var g=c.data;if(g==="/$"){if(f===0){Ls=Xa(c.nextSibling);break e}f--}else g!=="$"&&g!=="$!"&&g!=="$?"||f++}c=c.nextSibling}Ls=null}}else Ls=Fs?Xa(c.stateNode.nextSibling):null;return!0}function v$(){for(var c=Ls;c;)c=Xa(c.nextSibling)}function xh(){Ls=Fs=null,on=!1}function EI(c){$i===null?$i=[c]:$i.push(c)}var XW=T.ReactCurrentBatchConfig;function pp(c,f,g){if(c=g.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(t(309));var I=g.stateNode}if(!I)throw Error(t(147,c));var _=I,D=""+c;return f!==null&&f.ref!==null&&typeof f.ref=="function"&&f.ref._stringRef===D?f.ref:(f=function(z){var H=_.refs;z===null?delete H[D]:H[D]=z},f._stringRef=D,f)}if(typeof c!="string")throw Error(t(284));if(!g._owner)throw Error(t(290,c))}return c}function v0(c,f){throw c=Object.prototype.toString.call(f),Error(t(31,c==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":c))}function x$(c){var f=c._init;return f(c._payload)}function b$(c){function f(ce,oe){if(c){var de=ce.deletions;de===null?(ce.deletions=[oe],ce.flags|=16):de.push(oe)}}function g(ce,oe){if(!c)return null;for(;oe!==null;)f(ce,oe),oe=oe.sibling;return null}function I(ce,oe){for(ce=new Map;oe!==null;)oe.key!==null?ce.set(oe.key,oe):ce.set(oe.index,oe),oe=oe.sibling;return ce}function _(ce,oe){return ce=ol(ce,oe),ce.index=0,ce.sibling=null,ce}function D(ce,oe,de){return ce.index=de,c?(de=ce.alternate,de!==null?(de=de.index,de<oe?(ce.flags|=2,oe):de):(ce.flags|=2,oe)):(ce.flags|=1048576,oe)}function z(ce){return c&&ce.alternate===null&&(ce.flags|=2),ce}function H(ce,oe,de,$e){return oe===null||oe.tag!==6?(oe=wS(de,ce.mode,$e),oe.return=ce,oe):(oe=_(oe,de),oe.return=ce,oe)}function te(ce,oe,de,$e){var Ke=de.type;return Ke===k?_e(ce,oe,de.props.children,$e,de.key):oe!==null&&(oe.elementType===Ke||typeof Ke=="object"&&Ke!==null&&Ke.$$typeof===q&&x$(Ke)===oe.type)?($e=_(oe,de.props),$e.ref=pp(ce,oe,de),$e.return=ce,$e):($e=W0(de.type,de.key,de.props,null,ce.mode,$e),$e.ref=pp(ce,oe,de),$e.return=ce,$e)}function pe(ce,oe,de,$e){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==de.containerInfo||oe.stateNode.implementation!==de.implementation?(oe=vS(de,ce.mode,$e),oe.return=ce,oe):(oe=_(oe,de.children||[]),oe.return=ce,oe)}function _e(ce,oe,de,$e,Ke){return oe===null||oe.tag!==7?(oe=Au(de,ce.mode,$e,Ke),oe.return=ce,oe):(oe=_(oe,de),oe.return=ce,oe)}function ke(ce,oe,de){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=wS(""+oe,ce.mode,de),oe.return=ce,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case O:return de=W0(oe.type,oe.key,oe.props,null,ce.mode,de),de.ref=pp(ce,null,oe),de.return=ce,de;case V:return oe=vS(oe,ce.mode,de),oe.return=ce,oe;case q:var $e=oe._init;return ke(ce,$e(oe._payload),de)}if(jt(oe)||re(oe))return oe=Au(oe,ce.mode,de,null),oe.return=ce,oe;v0(ce,oe)}return null}function Te(ce,oe,de,$e){var Ke=oe!==null?oe.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return Ke!==null?null:H(ce,oe,""+de,$e);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case O:return de.key===Ke?te(ce,oe,de,$e):null;case V:return de.key===Ke?pe(ce,oe,de,$e):null;case q:return Ke=de._init,Te(ce,oe,Ke(de._payload),$e)}if(jt(de)||re(de))return Ke!==null?null:_e(ce,oe,de,$e,null);v0(ce,de)}return null}function Me(ce,oe,de,$e,Ke){if(typeof $e=="string"&&$e!==""||typeof $e=="number")return ce=ce.get(de)||null,H(oe,ce,""+$e,Ke);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case O:return ce=ce.get($e.key===null?de:$e.key)||null,te(oe,ce,$e,Ke);case V:return ce=ce.get($e.key===null?de:$e.key)||null,pe(oe,ce,$e,Ke);case q:var Je=$e._init;return Me(ce,oe,de,Je($e._payload),Ke)}if(jt($e)||re($e))return ce=ce.get(de)||null,_e(oe,ce,$e,Ke,null);v0(oe,$e)}return null}function We(ce,oe,de,$e){for(var Ke=null,Je=null,Ze=oe,st=oe=0,ur=null;Ze!==null&&st<de.length;st++){Ze.index>st?(ur=Ze,Ze=null):ur=Ze.sibling;var Ot=Te(ce,Ze,de[st],$e);if(Ot===null){Ze===null&&(Ze=ur);break}c&&Ze&&Ot.alternate===null&&f(ce,Ze),oe=D(Ot,oe,st),Je===null?Ke=Ot:Je.sibling=Ot,Je=Ot,Ze=ur}if(st===de.length)return g(ce,Ze),on&&Tu(ce,st),Ke;if(Ze===null){for(;st<de.length;st++)Ze=ke(ce,de[st],$e),Ze!==null&&(oe=D(Ze,oe,st),Je===null?Ke=Ze:Je.sibling=Ze,Je=Ze);return on&&Tu(ce,st),Ke}for(Ze=I(ce,Ze);st<de.length;st++)ur=Me(Ze,ce,st,de[st],$e),ur!==null&&(c&&ur.alternate!==null&&Ze.delete(ur.key===null?st:ur.key),oe=D(ur,oe,st),Je===null?Ke=ur:Je.sibling=ur,Je=ur);return c&&Ze.forEach(function(al){return f(ce,al)}),on&&Tu(ce,st),Ke}function He(ce,oe,de,$e){var Ke=re(de);if(typeof Ke!="function")throw Error(t(150));if(de=Ke.call(de),de==null)throw Error(t(151));for(var Je=Ke=null,Ze=oe,st=oe=0,ur=null,Ot=de.next();Ze!==null&&!Ot.done;st++,Ot=de.next()){Ze.index>st?(ur=Ze,Ze=null):ur=Ze.sibling;var al=Te(ce,Ze,Ot.value,$e);if(al===null){Ze===null&&(Ze=ur);break}c&&Ze&&al.alternate===null&&f(ce,Ze),oe=D(al,oe,st),Je===null?Ke=al:Je.sibling=al,Je=al,Ze=ur}if(Ot.done)return g(ce,Ze),on&&Tu(ce,st),Ke;if(Ze===null){for(;!Ot.done;st++,Ot=de.next())Ot=ke(ce,Ot.value,$e),Ot!==null&&(oe=D(Ot,oe,st),Je===null?Ke=Ot:Je.sibling=Ot,Je=Ot);return on&&Tu(ce,st),Ke}for(Ze=I(ce,Ze);!Ot.done;st++,Ot=de.next())Ot=Me(Ze,ce,st,Ot.value,$e),Ot!==null&&(c&&Ot.alternate!==null&&Ze.delete(Ot.key===null?st:Ot.key),oe=D(Ot,oe,st),Je===null?Ke=Ot:Je.sibling=Ot,Je=Ot);return c&&Ze.forEach(function(kj){return f(ce,kj)}),on&&Tu(ce,st),Ke}function _n(ce,oe,de,$e){if(typeof de=="object"&&de!==null&&de.type===k&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case O:e:{for(var Ke=de.key,Je=oe;Je!==null;){if(Je.key===Ke){if(Ke=de.type,Ke===k){if(Je.tag===7){g(ce,Je.sibling),oe=_(Je,de.props.children),oe.return=ce,ce=oe;break e}}else if(Je.elementType===Ke||typeof Ke=="object"&&Ke!==null&&Ke.$$typeof===q&&x$(Ke)===Je.type){g(ce,Je.sibling),oe=_(Je,de.props),oe.ref=pp(ce,Je,de),oe.return=ce,ce=oe;break e}g(ce,Je);break}else f(ce,Je);Je=Je.sibling}de.type===k?(oe=Au(de.props.children,ce.mode,$e,de.key),oe.return=ce,ce=oe):($e=W0(de.type,de.key,de.props,null,ce.mode,$e),$e.ref=pp(ce,oe,de),$e.return=ce,ce=$e)}return z(ce);case V:e:{for(Je=de.key;oe!==null;){if(oe.key===Je)if(oe.tag===4&&oe.stateNode.containerInfo===de.containerInfo&&oe.stateNode.implementation===de.implementation){g(ce,oe.sibling),oe=_(oe,de.children||[]),oe.return=ce,ce=oe;break e}else{g(ce,oe);break}else f(ce,oe);oe=oe.sibling}oe=vS(de,ce.mode,$e),oe.return=ce,ce=oe}return z(ce);case q:return Je=de._init,_n(ce,oe,Je(de._payload),$e)}if(jt(de))return We(ce,oe,de,$e);if(re(de))return He(ce,oe,de,$e);v0(ce,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,oe!==null&&oe.tag===6?(g(ce,oe.sibling),oe=_(oe,de),oe.return=ce,ce=oe):(g(ce,oe),oe=wS(de,ce.mode,$e),oe.return=ce,ce=oe),z(ce)):g(ce,oe)}return _n}var bh=b$(!0),I$=b$(!1),x0=Qa(null),b0=null,Ih=null,kI=null;function NI(){kI=Ih=b0=null}function $I(c){var f=x0.current;tn(x0),c._currentValue=f}function RI(c,f,g){for(;c!==null;){var I=c.alternate;if((c.childLanes&f)!==f?(c.childLanes|=f,I!==null&&(I.childLanes|=f)):I!==null&&(I.childLanes&f)!==f&&(I.childLanes|=f),c===g)break;c=c.return}}function Sh(c,f){b0=c,kI=Ih=null,c=c.dependencies,c!==null&&c.firstContext!==null&&(c.lanes&f&&(ps=!0),c.firstContext=null)}function ii(c){var f=c._currentValue;if(kI!==c)if(c={context:c,memoizedValue:f,next:null},Ih===null){if(b0===null)throw Error(t(308));Ih=c,b0.dependencies={lanes:0,firstContext:c}}else Ih=Ih.next=c;return f}var _u=null;function AI(c){_u===null?_u=[c]:_u.push(c)}function S$(c,f,g,I){var _=f.interleaved;return _===null?(g.next=g,AI(f)):(g.next=_.next,_.next=g),f.interleaved=g,Zo(c,I)}function Zo(c,f){c.lanes|=f;var g=c.alternate;for(g!==null&&(g.lanes|=f),g=c,c=c.return;c!==null;)c.childLanes|=f,g=c.alternate,g!==null&&(g.childLanes|=f),g=c,c=c.return;return g.tag===3?g.stateNode:null}var Za=!1;function DI(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function T$(c,f){c=c.updateQueue,f.updateQueue===c&&(f.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function ea(c,f){return{eventTime:c,lane:f,tag:0,payload:null,callback:null,next:null}}function el(c,f,g){var I=c.updateQueue;if(I===null)return null;if(I=I.shared,Dt&2){var _=I.pending;return _===null?f.next=f:(f.next=_.next,_.next=f),I.pending=f,Zo(c,g)}return _=I.interleaved,_===null?(f.next=f,AI(I)):(f.next=_.next,_.next=f),I.interleaved=f,Zo(c,g)}function I0(c,f,g){if(f=f.updateQueue,f!==null&&(f=f.shared,(g&4194240)!==0)){var I=f.lanes;I&=c.pendingLanes,g|=I,f.lanes=g,Wa(c,g)}}function _$(c,f){var g=c.updateQueue,I=c.alternate;if(I!==null&&(I=I.updateQueue,g===I)){var _=null,D=null;if(g=g.firstBaseUpdate,g!==null){do{var z={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};D===null?_=D=z:D=D.next=z,g=g.next}while(g!==null);D===null?_=D=f:D=D.next=f}else _=D=f;g={baseState:I.baseState,firstBaseUpdate:_,lastBaseUpdate:D,shared:I.shared,effects:I.effects},c.updateQueue=g;return}c=g.lastBaseUpdate,c===null?g.firstBaseUpdate=f:c.next=f,g.lastBaseUpdate=f}function S0(c,f,g,I){var _=c.updateQueue;Za=!1;var D=_.firstBaseUpdate,z=_.lastBaseUpdate,H=_.shared.pending;if(H!==null){_.shared.pending=null;var te=H,pe=te.next;te.next=null,z===null?D=pe:z.next=pe,z=te;var _e=c.alternate;_e!==null&&(_e=_e.updateQueue,H=_e.lastBaseUpdate,H!==z&&(H===null?_e.firstBaseUpdate=pe:H.next=pe,_e.lastBaseUpdate=te))}if(D!==null){var ke=_.baseState;z=0,_e=pe=te=null,H=D;do{var Te=H.lane,Me=H.eventTime;if((I&Te)===Te){_e!==null&&(_e=_e.next={eventTime:Me,lane:0,tag:H.tag,payload:H.payload,callback:H.callback,next:null});e:{var We=c,He=H;switch(Te=f,Me=g,He.tag){case 1:if(We=He.payload,typeof We=="function"){ke=We.call(Me,ke,Te);break e}ke=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=He.payload,Te=typeof We=="function"?We.call(Me,ke,Te):We,Te==null)break e;ke=ie({},ke,Te);break e;case 2:Za=!0}}H.callback!==null&&H.lane!==0&&(c.flags|=64,Te=_.effects,Te===null?_.effects=[H]:Te.push(H))}else Me={eventTime:Me,lane:Te,tag:H.tag,payload:H.payload,callback:H.callback,next:null},_e===null?(pe=_e=Me,te=ke):_e=_e.next=Me,z|=Te;if(H=H.next,H===null){if(H=_.shared.pending,H===null)break;Te=H,H=Te.next,Te.next=null,_.lastBaseUpdate=Te,_.shared.pending=null}}while(!0);if(_e===null&&(te=ke),_.baseState=te,_.firstBaseUpdate=pe,_.lastBaseUpdate=_e,f=_.shared.interleaved,f!==null){_=f;do z|=_.lane,_=_.next;while(_!==f)}else D===null&&(_.shared.lanes=0);ku|=z,c.lanes=z,c.memoizedState=ke}}function C$(c,f,g){if(c=f.effects,f.effects=null,c!==null)for(f=0;f<c.length;f++){var I=c[f],_=I.callback;if(_!==null){if(I.callback=null,I=g,typeof _!="function")throw Error(t(191,_));_.call(I)}}}var mp={},ho=Qa(mp),gp=Qa(mp),yp=Qa(mp);function Cu(c){if(c===mp)throw Error(t(174));return c}function OI(c,f){switch(Zt(yp,f),Zt(gp,c),Zt(ho,mp),c=f.nodeType,c){case 9:case 11:f=(f=f.documentElement)?f.namespaceURI:Ht(null,"");break;default:c=c===8?f.parentNode:f,f=c.namespaceURI||null,c=c.tagName,f=Ht(f,c)}tn(ho),Zt(ho,f)}function Th(){tn(ho),tn(gp),tn(yp)}function E$(c){Cu(yp.current);var f=Cu(ho.current),g=Ht(f,c.type);f!==g&&(Zt(gp,c),Zt(ho,g))}function PI(c){gp.current===c&&(tn(ho),tn(gp))}var fn=Qa(0);function T0(c){for(var f=c;f!==null;){if(f.tag===13){var g=f.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if(f.flags&128)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var FI=[];function LI(){for(var c=0;c<FI.length;c++)FI[c]._workInProgressVersionPrimary=null;FI.length=0}var _0=T.ReactCurrentDispatcher,MI=T.ReactCurrentBatchConfig,Eu=0,pn=null,Wn=null,ar=null,C0=!1,wp=!1,vp=0,QW=0;function Dr(){throw Error(t(321))}function VI(c,f){if(f===null)return!1;for(var g=0;g<f.length&&g<c.length;g++)if(!Ni(c[g],f[g]))return!1;return!0}function zI(c,f,g,I,_,D){if(Eu=D,pn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,_0.current=c===null||c.memoizedState===null?ej:tj,c=g(I,_),wp){D=0;do{if(wp=!1,vp=0,25<=D)throw Error(t(301));D+=1,ar=Wn=null,f.updateQueue=null,_0.current=nj,c=g(I,_)}while(wp)}if(_0.current=N0,f=Wn!==null&&Wn.next!==null,Eu=0,ar=Wn=pn=null,C0=!1,f)throw Error(t(300));return c}function BI(){var c=vp!==0;return vp=0,c}function fo(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ar===null?pn.memoizedState=ar=c:ar=ar.next=c,ar}function oi(){if(Wn===null){var c=pn.alternate;c=c!==null?c.memoizedState:null}else c=Wn.next;var f=ar===null?pn.memoizedState:ar.next;if(f!==null)ar=f,Wn=c;else{if(c===null)throw Error(t(310));Wn=c,c={memoizedState:Wn.memoizedState,baseState:Wn.baseState,baseQueue:Wn.baseQueue,queue:Wn.queue,next:null},ar===null?pn.memoizedState=ar=c:ar=ar.next=c}return ar}function xp(c,f){return typeof f=="function"?f(c):f}function UI(c){var f=oi(),g=f.queue;if(g===null)throw Error(t(311));g.lastRenderedReducer=c;var I=Wn,_=I.baseQueue,D=g.pending;if(D!==null){if(_!==null){var z=_.next;_.next=D.next,D.next=z}I.baseQueue=_=D,g.pending=null}if(_!==null){D=_.next,I=I.baseState;var H=z=null,te=null,pe=D;do{var _e=pe.lane;if((Eu&_e)===_e)te!==null&&(te=te.next={lane:0,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),I=pe.hasEagerState?pe.eagerState:c(I,pe.action);else{var ke={lane:_e,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null};te===null?(H=te=ke,z=I):te=te.next=ke,pn.lanes|=_e,ku|=_e}pe=pe.next}while(pe!==null&&pe!==D);te===null?z=I:te.next=H,Ni(I,f.memoizedState)||(ps=!0),f.memoizedState=I,f.baseState=z,f.baseQueue=te,g.lastRenderedState=I}if(c=g.interleaved,c!==null){_=c;do D=_.lane,pn.lanes|=D,ku|=D,_=_.next;while(_!==c)}else _===null&&(g.lanes=0);return[f.memoizedState,g.dispatch]}function WI(c){var f=oi(),g=f.queue;if(g===null)throw Error(t(311));g.lastRenderedReducer=c;var I=g.dispatch,_=g.pending,D=f.memoizedState;if(_!==null){g.pending=null;var z=_=_.next;do D=c(D,z.action),z=z.next;while(z!==_);Ni(D,f.memoizedState)||(ps=!0),f.memoizedState=D,f.baseQueue===null&&(f.baseState=D),g.lastRenderedState=D}return[D,I]}function k$(){}function N$(c,f){var g=pn,I=oi(),_=f(),D=!Ni(I.memoizedState,_);if(D&&(I.memoizedState=_,ps=!0),I=I.queue,jI(A$.bind(null,g,I,c),[c]),I.getSnapshot!==f||D||ar!==null&&ar.memoizedState.tag&1){if(g.flags|=2048,bp(9,R$.bind(null,g,I,_,f),void 0,null),lr===null)throw Error(t(349));Eu&30||$$(g,f,_)}return _}function $$(c,f,g){c.flags|=16384,c={getSnapshot:f,value:g},f=pn.updateQueue,f===null?(f={lastEffect:null,stores:null},pn.updateQueue=f,f.stores=[c]):(g=f.stores,g===null?f.stores=[c]:g.push(c))}function R$(c,f,g,I){f.value=g,f.getSnapshot=I,D$(f)&&O$(c)}function A$(c,f,g){return g(function(){D$(f)&&O$(c)})}function D$(c){var f=c.getSnapshot;c=c.value;try{var g=f();return!Ni(c,g)}catch{return!0}}function O$(c){var f=Zo(c,1);f!==null&&Oi(f,c,1,-1)}function P$(c){var f=fo();return typeof c=="function"&&(c=c()),f.memoizedState=f.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xp,lastRenderedState:c},f.queue=c,c=c.dispatch=ZW.bind(null,pn,c),[f.memoizedState,c]}function bp(c,f,g,I){return c={tag:c,create:f,destroy:g,deps:I,next:null},f=pn.updateQueue,f===null?(f={lastEffect:null,stores:null},pn.updateQueue=f,f.lastEffect=c.next=c):(g=f.lastEffect,g===null?f.lastEffect=c.next=c:(I=g.next,g.next=c,c.next=I,f.lastEffect=c)),c}function F$(){return oi().memoizedState}function E0(c,f,g,I){var _=fo();pn.flags|=c,_.memoizedState=bp(1|f,g,void 0,I===void 0?null:I)}function k0(c,f,g,I){var _=oi();I=I===void 0?null:I;var D=void 0;if(Wn!==null){var z=Wn.memoizedState;if(D=z.destroy,I!==null&&VI(I,z.deps)){_.memoizedState=bp(f,g,D,I);return}}pn.flags|=c,_.memoizedState=bp(1|f,g,D,I)}function L$(c,f){return E0(8390656,8,c,f)}function jI(c,f){return k0(2048,8,c,f)}function M$(c,f){return k0(4,2,c,f)}function V$(c,f){return k0(4,4,c,f)}function z$(c,f){if(typeof f=="function")return c=c(),f(c),function(){f(null)};if(f!=null)return c=c(),f.current=c,function(){f.current=null}}function B$(c,f,g){return g=g!=null?g.concat([c]):null,k0(4,4,z$.bind(null,f,c),g)}function GI(){}function U$(c,f){var g=oi();f=f===void 0?null:f;var I=g.memoizedState;return I!==null&&f!==null&&VI(f,I[1])?I[0]:(g.memoizedState=[c,f],c)}function W$(c,f){var g=oi();f=f===void 0?null:f;var I=g.memoizedState;return I!==null&&f!==null&&VI(f,I[1])?I[0]:(c=c(),g.memoizedState=[c,f],c)}function j$(c,f,g){return Eu&21?(Ni(g,f)||(g=gu(),pn.lanes|=g,ku|=g,c.baseState=!0),f):(c.baseState&&(c.baseState=!1,ps=!0),c.memoizedState=g)}function YW(c,f){var g=_t;_t=g!==0&&4>g?g:4,c(!0);var I=MI.transition;MI.transition={};try{c(!1),f()}finally{_t=g,MI.transition=I}}function G$(){return oi().memoizedState}function JW(c,f,g){var I=sl(c);if(g={lane:I,action:g,hasEagerState:!1,eagerState:null,next:null},H$(c))q$(f,g);else if(g=S$(c,f,g,I),g!==null){var _=Zr();Oi(g,c,I,_),K$(g,f,I)}}function ZW(c,f,g){var I=sl(c),_={lane:I,action:g,hasEagerState:!1,eagerState:null,next:null};if(H$(c))q$(f,_);else{var D=c.alternate;if(c.lanes===0&&(D===null||D.lanes===0)&&(D=f.lastRenderedReducer,D!==null))try{var z=f.lastRenderedState,H=D(z,g);if(_.hasEagerState=!0,_.eagerState=H,Ni(H,z)){var te=f.interleaved;te===null?(_.next=_,AI(f)):(_.next=te.next,te.next=_),f.interleaved=_;return}}catch{}finally{}g=S$(c,f,_,I),g!==null&&(_=Zr(),Oi(g,c,I,_),K$(g,f,I))}}function H$(c){var f=c.alternate;return c===pn||f!==null&&f===pn}function q$(c,f){wp=C0=!0;var g=c.pending;g===null?f.next=f:(f.next=g.next,g.next=f),c.pending=f}function K$(c,f,g){if(g&4194240){var I=f.lanes;I&=c.pendingLanes,g|=I,f.lanes=g,Wa(c,g)}}var N0={readContext:ii,useCallback:Dr,useContext:Dr,useEffect:Dr,useImperativeHandle:Dr,useInsertionEffect:Dr,useLayoutEffect:Dr,useMemo:Dr,useReducer:Dr,useRef:Dr,useState:Dr,useDebugValue:Dr,useDeferredValue:Dr,useTransition:Dr,useMutableSource:Dr,useSyncExternalStore:Dr,useId:Dr,unstable_isNewReconciler:!1},ej={readContext:ii,useCallback:function(c,f){return fo().memoizedState=[c,f===void 0?null:f],c},useContext:ii,useEffect:L$,useImperativeHandle:function(c,f,g){return g=g!=null?g.concat([c]):null,E0(4194308,4,z$.bind(null,f,c),g)},useLayoutEffect:function(c,f){return E0(4194308,4,c,f)},useInsertionEffect:function(c,f){return E0(4,2,c,f)},useMemo:function(c,f){var g=fo();return f=f===void 0?null:f,c=c(),g.memoizedState=[c,f],c},useReducer:function(c,f,g){var I=fo();return f=g!==void 0?g(f):f,I.memoizedState=I.baseState=f,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:f},I.queue=c,c=c.dispatch=JW.bind(null,pn,c),[I.memoizedState,c]},useRef:function(c){var f=fo();return c={current:c},f.memoizedState=c},useState:P$,useDebugValue:GI,useDeferredValue:function(c){return fo().memoizedState=c},useTransition:function(){var c=P$(!1),f=c[0];return c=YW.bind(null,c[1]),fo().memoizedState=c,[f,c]},useMutableSource:function(){},useSyncExternalStore:function(c,f,g){var I=pn,_=fo();if(on){if(g===void 0)throw Error(t(407));g=g()}else{if(g=f(),lr===null)throw Error(t(349));Eu&30||$$(I,f,g)}_.memoizedState=g;var D={value:g,getSnapshot:f};return _.queue=D,L$(A$.bind(null,I,D,c),[c]),I.flags|=2048,bp(9,R$.bind(null,I,D,g,f),void 0,null),g},useId:function(){var c=fo(),f=lr.identifierPrefix;if(on){var g=Jo,I=Yo;g=(I&~(1<<32-Qr(I)-1)).toString(32)+g,f=":"+f+"R"+g,g=vp++,0<g&&(f+="H"+g.toString(32)),f+=":"}else g=QW++,f=":"+f+"r"+g.toString(32)+":";return c.memoizedState=f},unstable_isNewReconciler:!1},tj={readContext:ii,useCallback:U$,useContext:ii,useEffect:jI,useImperativeHandle:B$,useInsertionEffect:M$,useLayoutEffect:V$,useMemo:W$,useReducer:UI,useRef:F$,useState:function(){return UI(xp)},useDebugValue:GI,useDeferredValue:function(c){var f=oi();return j$(f,Wn.memoizedState,c)},useTransition:function(){var c=UI(xp)[0],f=oi().memoizedState;return[c,f]},useMutableSource:k$,useSyncExternalStore:N$,useId:G$,unstable_isNewReconciler:!1},nj={readContext:ii,useCallback:U$,useContext:ii,useEffect:jI,useImperativeHandle:B$,useInsertionEffect:M$,useLayoutEffect:V$,useMemo:W$,useReducer:WI,useRef:F$,useState:function(){return WI(xp)},useDebugValue:GI,useDeferredValue:function(c){var f=oi();return Wn===null?f.memoizedState=c:j$(f,Wn.memoizedState,c)},useTransition:function(){var c=WI(xp)[0],f=oi().memoizedState;return[c,f]},useMutableSource:k$,useSyncExternalStore:N$,useId:G$,unstable_isNewReconciler:!1};function Ri(c,f){if(c&&c.defaultProps){f=ie({},f),c=c.defaultProps;for(var g in c)f[g]===void 0&&(f[g]=c[g]);return f}return f}function HI(c,f,g,I){f=c.memoizedState,g=g(I,f),g=g==null?f:ie({},f,g),c.memoizedState=g,c.lanes===0&&(c.updateQueue.baseState=g)}var $0={isMounted:function(c){return(c=c._reactInternals)?Ii(c)===c:!1},enqueueSetState:function(c,f,g){c=c._reactInternals;var I=Zr(),_=sl(c),D=ea(I,_);D.payload=f,g!=null&&(D.callback=g),f=el(c,D,_),f!==null&&(Oi(f,c,_,I),I0(f,c,_))},enqueueReplaceState:function(c,f,g){c=c._reactInternals;var I=Zr(),_=sl(c),D=ea(I,_);D.tag=1,D.payload=f,g!=null&&(D.callback=g),f=el(c,D,_),f!==null&&(Oi(f,c,_,I),I0(f,c,_))},enqueueForceUpdate:function(c,f){c=c._reactInternals;var g=Zr(),I=sl(c),_=ea(g,I);_.tag=2,f!=null&&(_.callback=f),f=el(c,_,I),f!==null&&(Oi(f,c,I,g),I0(f,c,I))}};function X$(c,f,g,I,_,D,z){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(I,D,z):f.prototype&&f.prototype.isPureReactComponent?!ap(g,I)||!ap(_,D):!0}function Q$(c,f,g){var I=!1,_=Ya,D=f.contextType;return typeof D=="object"&&D!==null?D=ii(D):(_=fs(f)?Iu:Ar.current,I=f.contextTypes,D=(I=I!=null)?yh(c,_):Ya),f=new f(g,D),c.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=$0,c.stateNode=f,f._reactInternals=c,I&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=_,c.__reactInternalMemoizedMaskedChildContext=D),f}function Y$(c,f,g,I){c=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(g,I),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(g,I),f.state!==c&&$0.enqueueReplaceState(f,f.state,null)}function qI(c,f,g,I){var _=c.stateNode;_.props=g,_.state=c.memoizedState,_.refs={},DI(c);var D=f.contextType;typeof D=="object"&&D!==null?_.context=ii(D):(D=fs(f)?Iu:Ar.current,_.context=yh(c,D)),_.state=c.memoizedState,D=f.getDerivedStateFromProps,typeof D=="function"&&(HI(c,f,D,g),_.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(f=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),f!==_.state&&$0.enqueueReplaceState(_,_.state,null),S0(c,g,_,I),_.state=c.memoizedState),typeof _.componentDidMount=="function"&&(c.flags|=4194308)}function _h(c,f){try{var g="",I=f;do g+=we(I),I=I.return;while(I);var _=g}catch(D){_=`
Error generating stack: `+D.message+`
`+D.stack}return{value:c,source:f,stack:_,digest:null}}function KI(c,f,g){return{value:c,source:null,stack:g??null,digest:f??null}}function XI(c,f){try{console.error(f.value)}catch(g){setTimeout(function(){throw g})}}var rj=typeof WeakMap=="function"?WeakMap:Map;function J$(c,f,g){g=ea(-1,g),g.tag=3,g.payload={element:null};var I=f.value;return g.callback=function(){L0||(L0=!0,cS=I),XI(c,f)},g}function Z$(c,f,g){g=ea(-1,g),g.tag=3;var I=c.type.getDerivedStateFromError;if(typeof I=="function"){var _=f.value;g.payload=function(){return I(_)},g.callback=function(){XI(c,f)}}var D=c.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(g.callback=function(){XI(c,f),typeof I!="function"&&(nl===null?nl=new Set([this]):nl.add(this));var z=f.stack;this.componentDidCatch(f.value,{componentStack:z!==null?z:""})}),g}function eR(c,f,g){var I=c.pingCache;if(I===null){I=c.pingCache=new rj;var _=new Set;I.set(f,_)}else _=I.get(f),_===void 0&&(_=new Set,I.set(f,_));_.has(g)||(_.add(g),c=yj.bind(null,c,f,g),f.then(c,c))}function tR(c){do{var f;if((f=c.tag===13)&&(f=c.memoizedState,f=f!==null?f.dehydrated!==null:!0),f)return c;c=c.return}while(c!==null);return null}function nR(c,f,g,I,_){return c.mode&1?(c.flags|=65536,c.lanes=_,c):(c===f?c.flags|=65536:(c.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(f=ea(-1,1),f.tag=2,el(g,f,1))),g.lanes|=1),c)}var sj=T.ReactCurrentOwner,ps=!1;function Jr(c,f,g,I){f.child=c===null?I$(f,null,g,I):bh(f,c.child,g,I)}function rR(c,f,g,I,_){g=g.render;var D=f.ref;return Sh(f,_),I=zI(c,f,g,I,D,_),g=BI(),c!==null&&!ps?(f.updateQueue=c.updateQueue,f.flags&=-2053,c.lanes&=~_,ta(c,f,_)):(on&&g&&SI(f),f.flags|=1,Jr(c,f,I,_),f.child)}function sR(c,f,g,I,_){if(c===null){var D=g.type;return typeof D=="function"&&!yS(D)&&D.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(f.tag=15,f.type=D,iR(c,f,D,I,_)):(c=W0(g.type,null,I,f,f.mode,_),c.ref=f.ref,c.return=f,f.child=c)}if(D=c.child,!(c.lanes&_)){var z=D.memoizedProps;if(g=g.compare,g=g!==null?g:ap,g(z,I)&&c.ref===f.ref)return ta(c,f,_)}return f.flags|=1,c=ol(D,I),c.ref=f.ref,c.return=f,f.child=c}function iR(c,f,g,I,_){if(c!==null){var D=c.memoizedProps;if(ap(D,I)&&c.ref===f.ref)if(ps=!1,f.pendingProps=I=D,(c.lanes&_)!==0)c.flags&131072&&(ps=!0);else return f.lanes=c.lanes,ta(c,f,_)}return QI(c,f,g,I,_)}function oR(c,f,g){var I=f.pendingProps,_=I.children,D=c!==null?c.memoizedState:null;if(I.mode==="hidden")if(!(f.mode&1))f.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zt(Eh,Ms),Ms|=g;else{if(!(g&1073741824))return c=D!==null?D.baseLanes|g:g,f.lanes=f.childLanes=1073741824,f.memoizedState={baseLanes:c,cachePool:null,transitions:null},f.updateQueue=null,Zt(Eh,Ms),Ms|=c,null;f.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=D!==null?D.baseLanes:g,Zt(Eh,Ms),Ms|=I}else D!==null?(I=D.baseLanes|g,f.memoizedState=null):I=g,Zt(Eh,Ms),Ms|=I;return Jr(c,f,_,g),f.child}function aR(c,f){var g=f.ref;(c===null&&g!==null||c!==null&&c.ref!==g)&&(f.flags|=512,f.flags|=2097152)}function QI(c,f,g,I,_){var D=fs(g)?Iu:Ar.current;return D=yh(f,D),Sh(f,_),g=zI(c,f,g,I,D,_),I=BI(),c!==null&&!ps?(f.updateQueue=c.updateQueue,f.flags&=-2053,c.lanes&=~_,ta(c,f,_)):(on&&I&&SI(f),f.flags|=1,Jr(c,f,g,_),f.child)}function lR(c,f,g,I,_){if(fs(g)){var D=!0;p0(f)}else D=!1;if(Sh(f,_),f.stateNode===null)A0(c,f),Q$(f,g,I),qI(f,g,I,_),I=!0;else if(c===null){var z=f.stateNode,H=f.memoizedProps;z.props=H;var te=z.context,pe=g.contextType;typeof pe=="object"&&pe!==null?pe=ii(pe):(pe=fs(g)?Iu:Ar.current,pe=yh(f,pe));var _e=g.getDerivedStateFromProps,ke=typeof _e=="function"||typeof z.getSnapshotBeforeUpdate=="function";ke||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(H!==I||te!==pe)&&Y$(f,z,I,pe),Za=!1;var Te=f.memoizedState;z.state=Te,S0(f,I,z,_),te=f.memoizedState,H!==I||Te!==te||ds.current||Za?(typeof _e=="function"&&(HI(f,g,_e,I),te=f.memoizedState),(H=Za||X$(f,g,H,I,Te,te,pe))?(ke||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(f.flags|=4194308)):(typeof z.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=I,f.memoizedState=te),z.props=I,z.state=te,z.context=pe,I=H):(typeof z.componentDidMount=="function"&&(f.flags|=4194308),I=!1)}else{z=f.stateNode,T$(c,f),H=f.memoizedProps,pe=f.type===f.elementType?H:Ri(f.type,H),z.props=pe,ke=f.pendingProps,Te=z.context,te=g.contextType,typeof te=="object"&&te!==null?te=ii(te):(te=fs(g)?Iu:Ar.current,te=yh(f,te));var Me=g.getDerivedStateFromProps;(_e=typeof Me=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(H!==ke||Te!==te)&&Y$(f,z,I,te),Za=!1,Te=f.memoizedState,z.state=Te,S0(f,I,z,_);var We=f.memoizedState;H!==ke||Te!==We||ds.current||Za?(typeof Me=="function"&&(HI(f,g,Me,I),We=f.memoizedState),(pe=Za||X$(f,g,pe,I,Te,We,te)||!1)?(_e||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(I,We,te),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(I,We,te)),typeof z.componentDidUpdate=="function"&&(f.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof z.componentDidUpdate!="function"||H===c.memoizedProps&&Te===c.memoizedState||(f.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||H===c.memoizedProps&&Te===c.memoizedState||(f.flags|=1024),f.memoizedProps=I,f.memoizedState=We),z.props=I,z.state=We,z.context=te,I=pe):(typeof z.componentDidUpdate!="function"||H===c.memoizedProps&&Te===c.memoizedState||(f.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||H===c.memoizedProps&&Te===c.memoizedState||(f.flags|=1024),I=!1)}return YI(c,f,g,I,D,_)}function YI(c,f,g,I,_,D){aR(c,f);var z=(f.flags&128)!==0;if(!I&&!z)return _&&f$(f,g,!1),ta(c,f,D);I=f.stateNode,sj.current=f;var H=z&&typeof g.getDerivedStateFromError!="function"?null:I.render();return f.flags|=1,c!==null&&z?(f.child=bh(f,c.child,null,D),f.child=bh(f,null,H,D)):Jr(c,f,H,D),f.memoizedState=I.state,_&&f$(f,g,!0),f.child}function uR(c){var f=c.stateNode;f.pendingContext?h$(c,f.pendingContext,f.pendingContext!==f.context):f.context&&h$(c,f.context,!1),OI(c,f.containerInfo)}function cR(c,f,g,I,_){return xh(),EI(_),f.flags|=256,Jr(c,f,g,I),f.child}var JI={dehydrated:null,treeContext:null,retryLane:0};function ZI(c){return{baseLanes:c,cachePool:null,transitions:null}}function hR(c,f,g){var I=f.pendingProps,_=fn.current,D=!1,z=(f.flags&128)!==0,H;if((H=z)||(H=c!==null&&c.memoizedState===null?!1:(_&2)!==0),H?(D=!0,f.flags&=-129):(c===null||c.memoizedState!==null)&&(_|=1),Zt(fn,_&1),c===null)return CI(f),c=f.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?(f.mode&1?c.data==="$!"?f.lanes=8:f.lanes=1073741824:f.lanes=1,null):(z=I.children,c=I.fallback,D?(I=f.mode,D=f.child,z={mode:"hidden",children:z},!(I&1)&&D!==null?(D.childLanes=0,D.pendingProps=z):D=j0(z,I,0,null),c=Au(c,I,g,null),D.return=f,c.return=f,D.sibling=c,f.child=D,f.child.memoizedState=ZI(g),f.memoizedState=JI,c):eS(f,z));if(_=c.memoizedState,_!==null&&(H=_.dehydrated,H!==null))return ij(c,f,z,I,H,_,g);if(D){D=I.fallback,z=f.mode,_=c.child,H=_.sibling;var te={mode:"hidden",children:I.children};return!(z&1)&&f.child!==_?(I=f.child,I.childLanes=0,I.pendingProps=te,f.deletions=null):(I=ol(_,te),I.subtreeFlags=_.subtreeFlags&14680064),H!==null?D=ol(H,D):(D=Au(D,z,g,null),D.flags|=2),D.return=f,I.return=f,I.sibling=D,f.child=I,I=D,D=f.child,z=c.child.memoizedState,z=z===null?ZI(g):{baseLanes:z.baseLanes|g,cachePool:null,transitions:z.transitions},D.memoizedState=z,D.childLanes=c.childLanes&~g,f.memoizedState=JI,I}return D=c.child,c=D.sibling,I=ol(D,{mode:"visible",children:I.children}),!(f.mode&1)&&(I.lanes=g),I.return=f,I.sibling=null,c!==null&&(g=f.deletions,g===null?(f.deletions=[c],f.flags|=16):g.push(c)),f.child=I,f.memoizedState=null,I}function eS(c,f){return f=j0({mode:"visible",children:f},c.mode,0,null),f.return=c,c.child=f}function R0(c,f,g,I){return I!==null&&EI(I),bh(f,c.child,null,g),c=eS(f,f.pendingProps.children),c.flags|=2,f.memoizedState=null,c}function ij(c,f,g,I,_,D,z){if(g)return f.flags&256?(f.flags&=-257,I=KI(Error(t(422))),R0(c,f,z,I)):f.memoizedState!==null?(f.child=c.child,f.flags|=128,null):(D=I.fallback,_=f.mode,I=j0({mode:"visible",children:I.children},_,0,null),D=Au(D,_,z,null),D.flags|=2,I.return=f,D.return=f,I.sibling=D,f.child=I,f.mode&1&&bh(f,c.child,null,z),f.child.memoizedState=ZI(z),f.memoizedState=JI,D);if(!(f.mode&1))return R0(c,f,z,null);if(_.data==="$!"){if(I=_.nextSibling&&_.nextSibling.dataset,I)var H=I.dgst;return I=H,D=Error(t(419)),I=KI(D,I,void 0),R0(c,f,z,I)}if(H=(z&c.childLanes)!==0,ps||H){if(I=lr,I!==null){switch(z&-z){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(I.suspendedLanes|z)?0:_,_!==0&&_!==D.retryLane&&(D.retryLane=_,Zo(c,_),Oi(I,c,_,-1))}return gS(),I=KI(Error(t(421))),R0(c,f,z,I)}return _.data==="$?"?(f.flags|=128,f.child=c.child,f=wj.bind(null,c),_._reactRetry=f,null):(c=D.treeContext,Ls=Xa(_.nextSibling),Fs=f,on=!0,$i=null,c!==null&&(ri[si++]=Yo,ri[si++]=Jo,ri[si++]=Su,Yo=c.id,Jo=c.overflow,Su=f),f=eS(f,I.children),f.flags|=4096,f)}function dR(c,f,g){c.lanes|=f;var I=c.alternate;I!==null&&(I.lanes|=f),RI(c.return,f,g)}function tS(c,f,g,I,_){var D=c.memoizedState;D===null?c.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:I,tail:g,tailMode:_}:(D.isBackwards=f,D.rendering=null,D.renderingStartTime=0,D.last=I,D.tail=g,D.tailMode=_)}function fR(c,f,g){var I=f.pendingProps,_=I.revealOrder,D=I.tail;if(Jr(c,f,I.children,g),I=fn.current,I&2)I=I&1|2,f.flags|=128;else{if(c!==null&&c.flags&128)e:for(c=f.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&dR(c,g,f);else if(c.tag===19)dR(c,g,f);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===f)break e;for(;c.sibling===null;){if(c.return===null||c.return===f)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}I&=1}if(Zt(fn,I),!(f.mode&1))f.memoizedState=null;else switch(_){case"forwards":for(g=f.child,_=null;g!==null;)c=g.alternate,c!==null&&T0(c)===null&&(_=g),g=g.sibling;g=_,g===null?(_=f.child,f.child=null):(_=g.sibling,g.sibling=null),tS(f,!1,_,g,D);break;case"backwards":for(g=null,_=f.child,f.child=null;_!==null;){if(c=_.alternate,c!==null&&T0(c)===null){f.child=_;break}c=_.sibling,_.sibling=g,g=_,_=c}tS(f,!0,g,null,D);break;case"together":tS(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function A0(c,f){!(f.mode&1)&&c!==null&&(c.alternate=null,f.alternate=null,f.flags|=2)}function ta(c,f,g){if(c!==null&&(f.dependencies=c.dependencies),ku|=f.lanes,!(g&f.childLanes))return null;if(c!==null&&f.child!==c.child)throw Error(t(153));if(f.child!==null){for(c=f.child,g=ol(c,c.pendingProps),f.child=g,g.return=f;c.sibling!==null;)c=c.sibling,g=g.sibling=ol(c,c.pendingProps),g.return=f;g.sibling=null}return f.child}function oj(c,f,g){switch(f.tag){case 3:uR(f),xh();break;case 5:E$(f);break;case 1:fs(f.type)&&p0(f);break;case 4:OI(f,f.stateNode.containerInfo);break;case 10:var I=f.type._context,_=f.memoizedProps.value;Zt(x0,I._currentValue),I._currentValue=_;break;case 13:if(I=f.memoizedState,I!==null)return I.dehydrated!==null?(Zt(fn,fn.current&1),f.flags|=128,null):g&f.child.childLanes?hR(c,f,g):(Zt(fn,fn.current&1),c=ta(c,f,g),c!==null?c.sibling:null);Zt(fn,fn.current&1);break;case 19:if(I=(g&f.childLanes)!==0,c.flags&128){if(I)return fR(c,f,g);f.flags|=128}if(_=f.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),Zt(fn,fn.current),I)break;return null;case 22:case 23:return f.lanes=0,oR(c,f,g)}return ta(c,f,g)}var pR,nS,mR,gR;pR=function(c,f){for(var g=f.child;g!==null;){if(g.tag===5||g.tag===6)c.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return;g=g.return}g.sibling.return=g.return,g=g.sibling}},nS=function(){},mR=function(c,f,g,I){var _=c.memoizedProps;if(_!==I){c=f.stateNode,Cu(ho.current);var D=null;switch(g){case"input":_=Pt(c,_),I=Pt(c,I),D=[];break;case"select":_=ie({},_,{value:void 0}),I=ie({},I,{value:void 0}),D=[];break;case"textarea":_=Bn(c,_),I=Bn(c,I),D=[];break;default:typeof _.onClick!="function"&&typeof I.onClick=="function"&&(c.onclick=h0)}Uf(g,I);var z;g=null;for(pe in _)if(!I.hasOwnProperty(pe)&&_.hasOwnProperty(pe)&&_[pe]!=null)if(pe==="style"){var H=_[pe];for(z in H)H.hasOwnProperty(z)&&(g||(g={}),g[z]="")}else pe!=="dangerouslySetInnerHTML"&&pe!=="children"&&pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&pe!=="autoFocus"&&(s.hasOwnProperty(pe)?D||(D=[]):(D=D||[]).push(pe,null));for(pe in I){var te=I[pe];if(H=_!=null?_[pe]:void 0,I.hasOwnProperty(pe)&&te!==H&&(te!=null||H!=null))if(pe==="style")if(H){for(z in H)!H.hasOwnProperty(z)||te&&te.hasOwnProperty(z)||(g||(g={}),g[z]="");for(z in te)te.hasOwnProperty(z)&&H[z]!==te[z]&&(g||(g={}),g[z]=te[z])}else g||(D||(D=[]),D.push(pe,g)),g=te;else pe==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,H=H?H.__html:void 0,te!=null&&H!==te&&(D=D||[]).push(pe,te)):pe==="children"?typeof te!="string"&&typeof te!="number"||(D=D||[]).push(pe,""+te):pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&(s.hasOwnProperty(pe)?(te!=null&&pe==="onScroll"&&en("scroll",c),D||H===te||(D=[])):(D=D||[]).push(pe,te))}g&&(D=D||[]).push("style",g);var pe=D;(f.updateQueue=pe)&&(f.flags|=4)}},gR=function(c,f,g,I){g!==I&&(f.flags|=4)};function Ip(c,f){if(!on)switch(c.tailMode){case"hidden":f=c.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?c.tail=null:g.sibling=null;break;case"collapsed":g=c.tail;for(var I=null;g!==null;)g.alternate!==null&&(I=g),g=g.sibling;I===null?f||c.tail===null?c.tail=null:c.tail.sibling=null:I.sibling=null}}function Or(c){var f=c.alternate!==null&&c.alternate.child===c.child,g=0,I=0;if(f)for(var _=c.child;_!==null;)g|=_.lanes|_.childLanes,I|=_.subtreeFlags&14680064,I|=_.flags&14680064,_.return=c,_=_.sibling;else for(_=c.child;_!==null;)g|=_.lanes|_.childLanes,I|=_.subtreeFlags,I|=_.flags,_.return=c,_=_.sibling;return c.subtreeFlags|=I,c.childLanes=g,f}function aj(c,f,g){var I=f.pendingProps;switch(TI(f),f.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Or(f),null;case 1:return fs(f.type)&&f0(),Or(f),null;case 3:return I=f.stateNode,Th(),tn(ds),tn(Ar),LI(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(c===null||c.child===null)&&(w0(f)?f.flags|=4:c===null||c.memoizedState.isDehydrated&&!(f.flags&256)||(f.flags|=1024,$i!==null&&(fS($i),$i=null))),nS(c,f),Or(f),null;case 5:PI(f);var _=Cu(yp.current);if(g=f.type,c!==null&&f.stateNode!=null)mR(c,f,g,I,_),c.ref!==f.ref&&(f.flags|=512,f.flags|=2097152);else{if(!I){if(f.stateNode===null)throw Error(t(166));return Or(f),null}if(c=Cu(ho.current),w0(f)){I=f.stateNode,g=f.type;var D=f.memoizedProps;switch(I[co]=f,I[dp]=D,c=(f.mode&1)!==0,g){case"dialog":en("cancel",I),en("close",I);break;case"iframe":case"object":case"embed":en("load",I);break;case"video":case"audio":for(_=0;_<up.length;_++)en(up[_],I);break;case"source":en("error",I);break;case"img":case"image":case"link":en("error",I),en("load",I);break;case"details":en("toggle",I);break;case"input":Nt(I,D),en("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!D.multiple},en("invalid",I);break;case"textarea":us(I,D),en("invalid",I)}Uf(g,D),_=null;for(var z in D)if(D.hasOwnProperty(z)){var H=D[z];z==="children"?typeof H=="string"?I.textContent!==H&&(D.suppressHydrationWarning!==!0&&c0(I.textContent,H,c),_=["children",H]):typeof H=="number"&&I.textContent!==""+H&&(D.suppressHydrationWarning!==!0&&c0(I.textContent,H,c),_=["children",""+H]):s.hasOwnProperty(z)&&H!=null&&z==="onScroll"&&en("scroll",I)}switch(g){case"input":tt(I),Lt(I,D,!0);break;case"textarea":tt(I),Xr(I);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(I.onclick=h0)}I=_,f.updateQueue=I,I!==null&&(f.flags|=4)}else{z=_.nodeType===9?_:_.ownerDocument,c==="http://www.w3.org/1999/xhtml"&&(c=Gt(g)),c==="http://www.w3.org/1999/xhtml"?g==="script"?(c=z.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild)):typeof I.is=="string"?c=z.createElement(g,{is:I.is}):(c=z.createElement(g),g==="select"&&(z=c,I.multiple?z.multiple=!0:I.size&&(z.size=I.size))):c=z.createElementNS(c,g),c[co]=f,c[dp]=I,pR(c,f,!1,!1),f.stateNode=c;e:{switch(z=Wf(g,I),g){case"dialog":en("cancel",c),en("close",c),_=I;break;case"iframe":case"object":case"embed":en("load",c),_=I;break;case"video":case"audio":for(_=0;_<up.length;_++)en(up[_],c);_=I;break;case"source":en("error",c),_=I;break;case"img":case"image":case"link":en("error",c),en("load",c),_=I;break;case"details":en("toggle",c),_=I;break;case"input":Nt(c,I),_=Pt(c,I),en("invalid",c);break;case"option":_=I;break;case"select":c._wrapperState={wasMultiple:!!I.multiple},_=ie({},I,{value:void 0}),en("invalid",c);break;case"textarea":us(c,I),_=Bn(c,I),en("invalid",c);break;default:_=I}Uf(g,_),H=_;for(D in H)if(H.hasOwnProperty(D)){var te=H[D];D==="style"?ou(c,te):D==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,te!=null&&wi(c,te)):D==="children"?typeof te=="string"?(g!=="textarea"||te!=="")&&Js(c,te):typeof te=="number"&&Js(c,""+te):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(s.hasOwnProperty(D)?te!=null&&D==="onScroll"&&en("scroll",c):te!=null&&C(c,D,te,z))}switch(g){case"input":tt(c),Lt(c,I,!1);break;case"textarea":tt(c),Xr(c);break;case"option":I.value!=null&&c.setAttribute("value",""+Ae(I.value));break;case"select":c.multiple=!!I.multiple,D=I.value,D!=null?rr(c,!!I.multiple,D,!1):I.defaultValue!=null&&rr(c,!!I.multiple,I.defaultValue,!0);break;default:typeof _.onClick=="function"&&(c.onclick=h0)}switch(g){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(f.flags|=4)}f.ref!==null&&(f.flags|=512,f.flags|=2097152)}return Or(f),null;case 6:if(c&&f.stateNode!=null)gR(c,f,c.memoizedProps,I);else{if(typeof I!="string"&&f.stateNode===null)throw Error(t(166));if(g=Cu(yp.current),Cu(ho.current),w0(f)){if(I=f.stateNode,g=f.memoizedProps,I[co]=f,(D=I.nodeValue!==g)&&(c=Fs,c!==null))switch(c.tag){case 3:c0(I.nodeValue,g,(c.mode&1)!==0);break;case 5:c.memoizedProps.suppressHydrationWarning!==!0&&c0(I.nodeValue,g,(c.mode&1)!==0)}D&&(f.flags|=4)}else I=(g.nodeType===9?g:g.ownerDocument).createTextNode(I),I[co]=f,f.stateNode=I}return Or(f),null;case 13:if(tn(fn),I=f.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(on&&Ls!==null&&f.mode&1&&!(f.flags&128))v$(),xh(),f.flags|=98560,D=!1;else if(D=w0(f),I!==null&&I.dehydrated!==null){if(c===null){if(!D)throw Error(t(318));if(D=f.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(t(317));D[co]=f}else xh(),!(f.flags&128)&&(f.memoizedState=null),f.flags|=4;Or(f),D=!1}else $i!==null&&(fS($i),$i=null),D=!0;if(!D)return f.flags&65536?f:null}return f.flags&128?(f.lanes=g,f):(I=I!==null,I!==(c!==null&&c.memoizedState!==null)&&I&&(f.child.flags|=8192,f.mode&1&&(c===null||fn.current&1?jn===0&&(jn=3):gS())),f.updateQueue!==null&&(f.flags|=4),Or(f),null);case 4:return Th(),nS(c,f),c===null&&cp(f.stateNode.containerInfo),Or(f),null;case 10:return $I(f.type._context),Or(f),null;case 17:return fs(f.type)&&f0(),Or(f),null;case 19:if(tn(fn),D=f.memoizedState,D===null)return Or(f),null;if(I=(f.flags&128)!==0,z=D.rendering,z===null)if(I)Ip(D,!1);else{if(jn!==0||c!==null&&c.flags&128)for(c=f.child;c!==null;){if(z=T0(c),z!==null){for(f.flags|=128,Ip(D,!1),I=z.updateQueue,I!==null&&(f.updateQueue=I,f.flags|=4),f.subtreeFlags=0,I=g,g=f.child;g!==null;)D=g,c=I,D.flags&=14680066,z=D.alternate,z===null?(D.childLanes=0,D.lanes=c,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=z.childLanes,D.lanes=z.lanes,D.child=z.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=z.memoizedProps,D.memoizedState=z.memoizedState,D.updateQueue=z.updateQueue,D.type=z.type,c=z.dependencies,D.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),g=g.sibling;return Zt(fn,fn.current&1|2),f.child}c=c.sibling}D.tail!==null&&Jt()>kh&&(f.flags|=128,I=!0,Ip(D,!1),f.lanes=4194304)}else{if(!I)if(c=T0(z),c!==null){if(f.flags|=128,I=!0,g=c.updateQueue,g!==null&&(f.updateQueue=g,f.flags|=4),Ip(D,!0),D.tail===null&&D.tailMode==="hidden"&&!z.alternate&&!on)return Or(f),null}else 2*Jt()-D.renderingStartTime>kh&&g!==1073741824&&(f.flags|=128,I=!0,Ip(D,!1),f.lanes=4194304);D.isBackwards?(z.sibling=f.child,f.child=z):(g=D.last,g!==null?g.sibling=z:f.child=z,D.last=z)}return D.tail!==null?(f=D.tail,D.rendering=f,D.tail=f.sibling,D.renderingStartTime=Jt(),f.sibling=null,g=fn.current,Zt(fn,I?g&1|2:g&1),f):(Or(f),null);case 22:case 23:return mS(),I=f.memoizedState!==null,c!==null&&c.memoizedState!==null!==I&&(f.flags|=8192),I&&f.mode&1?Ms&1073741824&&(Or(f),f.subtreeFlags&6&&(f.flags|=8192)):Or(f),null;case 24:return null;case 25:return null}throw Error(t(156,f.tag))}function lj(c,f){switch(TI(f),f.tag){case 1:return fs(f.type)&&f0(),c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 3:return Th(),tn(ds),tn(Ar),LI(),c=f.flags,c&65536&&!(c&128)?(f.flags=c&-65537|128,f):null;case 5:return PI(f),null;case 13:if(tn(fn),c=f.memoizedState,c!==null&&c.dehydrated!==null){if(f.alternate===null)throw Error(t(340));xh()}return c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 19:return tn(fn),null;case 4:return Th(),null;case 10:return $I(f.type._context),null;case 22:case 23:return mS(),null;case 24:return null;default:return null}}var D0=!1,Pr=!1,uj=typeof WeakSet=="function"?WeakSet:Set,Be=null;function Ch(c,f){var g=c.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(I){wn(c,f,I)}else g.current=null}function rS(c,f,g){try{g()}catch(I){wn(c,f,I)}}var yR=!1;function cj(c,f){if(mI=Ha,c=X2(),aI(c)){if("selectionStart"in c)var g={start:c.selectionStart,end:c.selectionEnd};else e:{g=(g=c.ownerDocument)&&g.defaultView||window;var I=g.getSelection&&g.getSelection();if(I&&I.rangeCount!==0){g=I.anchorNode;var _=I.anchorOffset,D=I.focusNode;I=I.focusOffset;try{g.nodeType,D.nodeType}catch{g=null;break e}var z=0,H=-1,te=-1,pe=0,_e=0,ke=c,Te=null;t:for(;;){for(var Me;ke!==g||_!==0&&ke.nodeType!==3||(H=z+_),ke!==D||I!==0&&ke.nodeType!==3||(te=z+I),ke.nodeType===3&&(z+=ke.nodeValue.length),(Me=ke.firstChild)!==null;)Te=ke,ke=Me;for(;;){if(ke===c)break t;if(Te===g&&++pe===_&&(H=z),Te===D&&++_e===I&&(te=z),(Me=ke.nextSibling)!==null)break;ke=Te,Te=ke.parentNode}ke=Me}g=H===-1||te===-1?null:{start:H,end:te}}else g=null}g=g||{start:0,end:0}}else g=null;for(gI={focusedElem:c,selectionRange:g},Ha=!1,Be=f;Be!==null;)if(f=Be,c=f.child,(f.subtreeFlags&1028)!==0&&c!==null)c.return=f,Be=c;else for(;Be!==null;){f=Be;try{var We=f.alternate;if(f.flags&1024)switch(f.tag){case 0:case 11:case 15:break;case 1:if(We!==null){var He=We.memoizedProps,_n=We.memoizedState,ce=f.stateNode,oe=ce.getSnapshotBeforeUpdate(f.elementType===f.type?He:Ri(f.type,He),_n);ce.__reactInternalSnapshotBeforeUpdate=oe}break;case 3:var de=f.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch($e){wn(f,f.return,$e)}if(c=f.sibling,c!==null){c.return=f.return,Be=c;break}Be=f.return}return We=yR,yR=!1,We}function Sp(c,f,g){var I=f.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var _=I=I.next;do{if((_.tag&c)===c){var D=_.destroy;_.destroy=void 0,D!==void 0&&rS(f,g,D)}_=_.next}while(_!==I)}}function O0(c,f){if(f=f.updateQueue,f=f!==null?f.lastEffect:null,f!==null){var g=f=f.next;do{if((g.tag&c)===c){var I=g.create;g.destroy=I()}g=g.next}while(g!==f)}}function sS(c){var f=c.ref;if(f!==null){var g=c.stateNode;switch(c.tag){case 5:c=g;break;default:c=g}typeof f=="function"?f(c):f.current=c}}function wR(c){var f=c.alternate;f!==null&&(c.alternate=null,wR(f)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(f=c.stateNode,f!==null&&(delete f[co],delete f[dp],delete f[xI],delete f[HW],delete f[qW])),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function vR(c){return c.tag===5||c.tag===3||c.tag===4}function xR(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||vR(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function iS(c,f,g){var I=c.tag;if(I===5||I===6)c=c.stateNode,f?g.nodeType===8?g.parentNode.insertBefore(c,f):g.insertBefore(c,f):(g.nodeType===8?(f=g.parentNode,f.insertBefore(c,g)):(f=g,f.appendChild(c)),g=g._reactRootContainer,g!=null||f.onclick!==null||(f.onclick=h0));else if(I!==4&&(c=c.child,c!==null))for(iS(c,f,g),c=c.sibling;c!==null;)iS(c,f,g),c=c.sibling}function oS(c,f,g){var I=c.tag;if(I===5||I===6)c=c.stateNode,f?g.insertBefore(c,f):g.appendChild(c);else if(I!==4&&(c=c.child,c!==null))for(oS(c,f,g),c=c.sibling;c!==null;)oS(c,f,g),c=c.sibling}var Tr=null,Ai=!1;function tl(c,f,g){for(g=g.child;g!==null;)bR(c,f,g),g=g.sibling}function bR(c,f,g){if(As&&typeof As.onCommitFiberUnmount=="function")try{As.onCommitFiberUnmount(pu,g)}catch{}switch(g.tag){case 5:Pr||Ch(g,f);case 6:var I=Tr,_=Ai;Tr=null,tl(c,f,g),Tr=I,Ai=_,Tr!==null&&(Ai?(c=Tr,g=g.stateNode,c.nodeType===8?c.parentNode.removeChild(g):c.removeChild(g)):Tr.removeChild(g.stateNode));break;case 18:Tr!==null&&(Ai?(c=Tr,g=g.stateNode,c.nodeType===8?vI(c.parentNode,g):c.nodeType===1&&vI(c,g),Ei(c)):vI(Tr,g.stateNode));break;case 4:I=Tr,_=Ai,Tr=g.stateNode.containerInfo,Ai=!0,tl(c,f,g),Tr=I,Ai=_;break;case 0:case 11:case 14:case 15:if(!Pr&&(I=g.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){_=I=I.next;do{var D=_,z=D.destroy;D=D.tag,z!==void 0&&(D&2||D&4)&&rS(g,f,z),_=_.next}while(_!==I)}tl(c,f,g);break;case 1:if(!Pr&&(Ch(g,f),I=g.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=g.memoizedProps,I.state=g.memoizedState,I.componentWillUnmount()}catch(H){wn(g,f,H)}tl(c,f,g);break;case 21:tl(c,f,g);break;case 22:g.mode&1?(Pr=(I=Pr)||g.memoizedState!==null,tl(c,f,g),Pr=I):tl(c,f,g);break;default:tl(c,f,g)}}function IR(c){var f=c.updateQueue;if(f!==null){c.updateQueue=null;var g=c.stateNode;g===null&&(g=c.stateNode=new uj),f.forEach(function(I){var _=vj.bind(null,c,I);g.has(I)||(g.add(I),I.then(_,_))})}}function Di(c,f){var g=f.deletions;if(g!==null)for(var I=0;I<g.length;I++){var _=g[I];try{var D=c,z=f,H=z;e:for(;H!==null;){switch(H.tag){case 5:Tr=H.stateNode,Ai=!1;break e;case 3:Tr=H.stateNode.containerInfo,Ai=!0;break e;case 4:Tr=H.stateNode.containerInfo,Ai=!0;break e}H=H.return}if(Tr===null)throw Error(t(160));bR(D,z,_),Tr=null,Ai=!1;var te=_.alternate;te!==null&&(te.return=null),_.return=null}catch(pe){wn(_,f,pe)}}if(f.subtreeFlags&12854)for(f=f.child;f!==null;)SR(f,c),f=f.sibling}function SR(c,f){var g=c.alternate,I=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:if(Di(f,c),po(c),I&4){try{Sp(3,c,c.return),O0(3,c)}catch(He){wn(c,c.return,He)}try{Sp(5,c,c.return)}catch(He){wn(c,c.return,He)}}break;case 1:Di(f,c),po(c),I&512&&g!==null&&Ch(g,g.return);break;case 5:if(Di(f,c),po(c),I&512&&g!==null&&Ch(g,g.return),c.flags&32){var _=c.stateNode;try{Js(_,"")}catch(He){wn(c,c.return,He)}}if(I&4&&(_=c.stateNode,_!=null)){var D=c.memoizedProps,z=g!==null?g.memoizedProps:D,H=c.type,te=c.updateQueue;if(c.updateQueue=null,te!==null)try{H==="input"&&D.type==="radio"&&D.name!=null&&Tt(_,D),Wf(H,z);var pe=Wf(H,D);for(z=0;z<te.length;z+=2){var _e=te[z],ke=te[z+1];_e==="style"?ou(_,ke):_e==="dangerouslySetInnerHTML"?wi(_,ke):_e==="children"?Js(_,ke):C(_,_e,ke,pe)}switch(H){case"input":Ft(_,D);break;case"textarea":sr(_,D);break;case"select":var Te=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!D.multiple;var Me=D.value;Me!=null?rr(_,!!D.multiple,Me,!1):Te!==!!D.multiple&&(D.defaultValue!=null?rr(_,!!D.multiple,D.defaultValue,!0):rr(_,!!D.multiple,D.multiple?[]:"",!1))}_[dp]=D}catch(He){wn(c,c.return,He)}}break;case 6:if(Di(f,c),po(c),I&4){if(c.stateNode===null)throw Error(t(162));_=c.stateNode,D=c.memoizedProps;try{_.nodeValue=D}catch(He){wn(c,c.return,He)}}break;case 3:if(Di(f,c),po(c),I&4&&g!==null&&g.memoizedState.isDehydrated)try{Ei(f.containerInfo)}catch(He){wn(c,c.return,He)}break;case 4:Di(f,c),po(c);break;case 13:Di(f,c),po(c),_=c.child,_.flags&8192&&(D=_.memoizedState!==null,_.stateNode.isHidden=D,!D||_.alternate!==null&&_.alternate.memoizedState!==null||(uS=Jt())),I&4&&IR(c);break;case 22:if(_e=g!==null&&g.memoizedState!==null,c.mode&1?(Pr=(pe=Pr)||_e,Di(f,c),Pr=pe):Di(f,c),po(c),I&8192){if(pe=c.memoizedState!==null,(c.stateNode.isHidden=pe)&&!_e&&c.mode&1)for(Be=c,_e=c.child;_e!==null;){for(ke=Be=_e;Be!==null;){switch(Te=Be,Me=Te.child,Te.tag){case 0:case 11:case 14:case 15:Sp(4,Te,Te.return);break;case 1:Ch(Te,Te.return);var We=Te.stateNode;if(typeof We.componentWillUnmount=="function"){I=Te,g=Te.return;try{f=I,We.props=f.memoizedProps,We.state=f.memoizedState,We.componentWillUnmount()}catch(He){wn(I,g,He)}}break;case 5:Ch(Te,Te.return);break;case 22:if(Te.memoizedState!==null){CR(ke);continue}}Me!==null?(Me.return=Te,Be=Me):CR(ke)}_e=_e.sibling}e:for(_e=null,ke=c;;){if(ke.tag===5){if(_e===null){_e=ke;try{_=ke.stateNode,pe?(D=_.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(H=ke.stateNode,te=ke.memoizedProps.style,z=te!=null&&te.hasOwnProperty("display")?te.display:null,H.style.display=no("display",z))}catch(He){wn(c,c.return,He)}}}else if(ke.tag===6){if(_e===null)try{ke.stateNode.nodeValue=pe?"":ke.memoizedProps}catch(He){wn(c,c.return,He)}}else if((ke.tag!==22&&ke.tag!==23||ke.memoizedState===null||ke===c)&&ke.child!==null){ke.child.return=ke,ke=ke.child;continue}if(ke===c)break e;for(;ke.sibling===null;){if(ke.return===null||ke.return===c)break e;_e===ke&&(_e=null),ke=ke.return}_e===ke&&(_e=null),ke.sibling.return=ke.return,ke=ke.sibling}}break;case 19:Di(f,c),po(c),I&4&&IR(c);break;case 21:break;default:Di(f,c),po(c)}}function po(c){var f=c.flags;if(f&2){try{e:{for(var g=c.return;g!==null;){if(vR(g)){var I=g;break e}g=g.return}throw Error(t(160))}switch(I.tag){case 5:var _=I.stateNode;I.flags&32&&(Js(_,""),I.flags&=-33);var D=xR(c);oS(c,D,_);break;case 3:case 4:var z=I.stateNode.containerInfo,H=xR(c);iS(c,H,z);break;default:throw Error(t(161))}}catch(te){wn(c,c.return,te)}c.flags&=-3}f&4096&&(c.flags&=-4097)}function hj(c,f,g){Be=c,TR(c)}function TR(c,f,g){for(var I=(c.mode&1)!==0;Be!==null;){var _=Be,D=_.child;if(_.tag===22&&I){var z=_.memoizedState!==null||D0;if(!z){var H=_.alternate,te=H!==null&&H.memoizedState!==null||Pr;H=D0;var pe=Pr;if(D0=z,(Pr=te)&&!pe)for(Be=_;Be!==null;)z=Be,te=z.child,z.tag===22&&z.memoizedState!==null?ER(_):te!==null?(te.return=z,Be=te):ER(_);for(;D!==null;)Be=D,TR(D),D=D.sibling;Be=_,D0=H,Pr=pe}_R(c)}else _.subtreeFlags&8772&&D!==null?(D.return=_,Be=D):_R(c)}}function _R(c){for(;Be!==null;){var f=Be;if(f.flags&8772){var g=f.alternate;try{if(f.flags&8772)switch(f.tag){case 0:case 11:case 15:Pr||O0(5,f);break;case 1:var I=f.stateNode;if(f.flags&4&&!Pr)if(g===null)I.componentDidMount();else{var _=f.elementType===f.type?g.memoizedProps:Ri(f.type,g.memoizedProps);I.componentDidUpdate(_,g.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var D=f.updateQueue;D!==null&&C$(f,D,I);break;case 3:var z=f.updateQueue;if(z!==null){if(g=null,f.child!==null)switch(f.child.tag){case 5:g=f.child.stateNode;break;case 1:g=f.child.stateNode}C$(f,z,g)}break;case 5:var H=f.stateNode;if(g===null&&f.flags&4){g=H;var te=f.memoizedProps;switch(f.type){case"button":case"input":case"select":case"textarea":te.autoFocus&&g.focus();break;case"img":te.src&&(g.src=te.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(f.memoizedState===null){var pe=f.alternate;if(pe!==null){var _e=pe.memoizedState;if(_e!==null){var ke=_e.dehydrated;ke!==null&&Ei(ke)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Pr||f.flags&512&&sS(f)}catch(Te){wn(f,f.return,Te)}}if(f===c){Be=null;break}if(g=f.sibling,g!==null){g.return=f.return,Be=g;break}Be=f.return}}function CR(c){for(;Be!==null;){var f=Be;if(f===c){Be=null;break}var g=f.sibling;if(g!==null){g.return=f.return,Be=g;break}Be=f.return}}function ER(c){for(;Be!==null;){var f=Be;try{switch(f.tag){case 0:case 11:case 15:var g=f.return;try{O0(4,f)}catch(te){wn(f,g,te)}break;case 1:var I=f.stateNode;if(typeof I.componentDidMount=="function"){var _=f.return;try{I.componentDidMount()}catch(te){wn(f,_,te)}}var D=f.return;try{sS(f)}catch(te){wn(f,D,te)}break;case 5:var z=f.return;try{sS(f)}catch(te){wn(f,z,te)}}}catch(te){wn(f,f.return,te)}if(f===c){Be=null;break}var H=f.sibling;if(H!==null){H.return=f.return,Be=H;break}Be=f.return}}var dj=Math.ceil,P0=T.ReactCurrentDispatcher,aS=T.ReactCurrentOwner,ai=T.ReactCurrentBatchConfig,Dt=0,lr=null,Dn=null,_r=0,Ms=0,Eh=Qa(0),jn=0,Tp=null,ku=0,F0=0,lS=0,_p=null,ms=null,uS=0,kh=1/0,na=null,L0=!1,cS=null,nl=null,M0=!1,rl=null,V0=0,Cp=0,hS=null,z0=-1,B0=0;function Zr(){return Dt&6?Jt():z0!==-1?z0:z0=Jt()}function sl(c){return c.mode&1?Dt&2&&_r!==0?_r&-_r:XW.transition!==null?(B0===0&&(B0=gu()),B0):(c=_t,c!==0||(c=window.event,c=c===void 0?16:ep(c.type)),c):1}function Oi(c,f,g,I){if(50<Cp)throw Cp=0,hS=null,Error(t(185));Ua(c,g,I),(!(Dt&2)||c!==lr)&&(c===lr&&(!(Dt&2)&&(F0|=g),jn===4&&il(c,_r)),gs(c,I),g===1&&Dt===0&&!(f.mode&1)&&(kh=Jt()+500,m0&&Ja()))}function gs(c,f){var g=c.callbackNode;jo(c,f);var I=mu(c,c===lr?_r:0);if(I===0)g!==null&&Xf(g),c.callbackNode=null,c.callbackPriority=0;else if(f=I&-I,c.callbackPriority!==f){if(g!=null&&Xf(g),f===1)c.tag===0?KW(NR.bind(null,c)):p$(NR.bind(null,c)),jW(function(){!(Dt&6)&&Ja()}),g=null;else{switch(ja(I)){case 1:g=fu;break;case 4:g=Va;break;case 16:g=ei;break;case 536870912:g=By;break;default:g=ei}g=LR(g,kR.bind(null,c))}c.callbackPriority=f,c.callbackNode=g}}function kR(c,f){if(z0=-1,B0=0,Dt&6)throw Error(t(327));var g=c.callbackNode;if(Nh()&&c.callbackNode!==g)return null;var I=mu(c,c===lr?_r:0);if(I===0)return null;if(I&30||I&c.expiredLanes||f)f=U0(c,I);else{f=I;var _=Dt;Dt|=2;var D=RR();(lr!==c||_r!==f)&&(na=null,kh=Jt()+500,$u(c,f));do try{mj();break}catch(H){$R(c,H)}while(!0);NI(),P0.current=D,Dt=_,Dn!==null?f=0:(lr=null,_r=0,f=jn)}if(f!==0){if(f===2&&(_=Ds(c),_!==0&&(I=_,f=dS(c,_))),f===1)throw g=Tp,$u(c,0),il(c,I),gs(c,Jt()),g;if(f===6)il(c,I);else{if(_=c.current.alternate,!(I&30)&&!fj(_)&&(f=U0(c,I),f===2&&(D=Ds(c),D!==0&&(I=D,f=dS(c,D))),f===1))throw g=Tp,$u(c,0),il(c,I),gs(c,Jt()),g;switch(c.finishedWork=_,c.finishedLanes=I,f){case 0:case 1:throw Error(t(345));case 2:Ru(c,ms,na);break;case 3:if(il(c,I),(I&130023424)===I&&(f=uS+500-Jt(),10<f)){if(mu(c,0)!==0)break;if(_=c.suspendedLanes,(_&I)!==I){Zr(),c.pingedLanes|=c.suspendedLanes&_;break}c.timeoutHandle=wI(Ru.bind(null,c,ms,na),f);break}Ru(c,ms,na);break;case 4:if(il(c,I),(I&4194240)===I)break;for(f=c.eventTimes,_=-1;0<I;){var z=31-Qr(I);D=1<<z,z=f[z],z>_&&(_=z),I&=~D}if(I=_,I=Jt()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*dj(I/1960))-I,10<I){c.timeoutHandle=wI(Ru.bind(null,c,ms,na),I);break}Ru(c,ms,na);break;case 5:Ru(c,ms,na);break;default:throw Error(t(329))}}}return gs(c,Jt()),c.callbackNode===g?kR.bind(null,c):null}function dS(c,f){var g=_p;return c.current.memoizedState.isDehydrated&&($u(c,f).flags|=256),c=U0(c,f),c!==2&&(f=ms,ms=g,f!==null&&fS(f)),c}function fS(c){ms===null?ms=c:ms.push.apply(ms,c)}function fj(c){for(var f=c;;){if(f.flags&16384){var g=f.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var I=0;I<g.length;I++){var _=g[I],D=_.getSnapshot;_=_.value;try{if(!Ni(D(),_))return!1}catch{return!1}}}if(g=f.child,f.subtreeFlags&16384&&g!==null)g.return=f,f=g;else{if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function il(c,f){for(f&=~lS,f&=~F0,c.suspendedLanes|=f,c.pingedLanes&=~f,c=c.expirationTimes;0<f;){var g=31-Qr(f),I=1<<g;c[g]=-1,f&=~I}}function NR(c){if(Dt&6)throw Error(t(327));Nh();var f=mu(c,0);if(!(f&1))return gs(c,Jt()),null;var g=U0(c,f);if(c.tag!==0&&g===2){var I=Ds(c);I!==0&&(f=I,g=dS(c,I))}if(g===1)throw g=Tp,$u(c,0),il(c,f),gs(c,Jt()),g;if(g===6)throw Error(t(345));return c.finishedWork=c.current.alternate,c.finishedLanes=f,Ru(c,ms,na),gs(c,Jt()),null}function pS(c,f){var g=Dt;Dt|=1;try{return c(f)}finally{Dt=g,Dt===0&&(kh=Jt()+500,m0&&Ja())}}function Nu(c){rl!==null&&rl.tag===0&&!(Dt&6)&&Nh();var f=Dt;Dt|=1;var g=ai.transition,I=_t;try{if(ai.transition=null,_t=1,c)return c()}finally{_t=I,ai.transition=g,Dt=f,!(Dt&6)&&Ja()}}function mS(){Ms=Eh.current,tn(Eh)}function $u(c,f){c.finishedWork=null,c.finishedLanes=0;var g=c.timeoutHandle;if(g!==-1&&(c.timeoutHandle=-1,WW(g)),Dn!==null)for(g=Dn.return;g!==null;){var I=g;switch(TI(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&f0();break;case 3:Th(),tn(ds),tn(Ar),LI();break;case 5:PI(I);break;case 4:Th();break;case 13:tn(fn);break;case 19:tn(fn);break;case 10:$I(I.type._context);break;case 22:case 23:mS()}g=g.return}if(lr=c,Dn=c=ol(c.current,null),_r=Ms=f,jn=0,Tp=null,lS=F0=ku=0,ms=_p=null,_u!==null){for(f=0;f<_u.length;f++)if(g=_u[f],I=g.interleaved,I!==null){g.interleaved=null;var _=I.next,D=g.pending;if(D!==null){var z=D.next;D.next=_,I.next=z}g.pending=I}_u=null}return c}function $R(c,f){do{var g=Dn;try{if(NI(),_0.current=N0,C0){for(var I=pn.memoizedState;I!==null;){var _=I.queue;_!==null&&(_.pending=null),I=I.next}C0=!1}if(Eu=0,ar=Wn=pn=null,wp=!1,vp=0,aS.current=null,g===null||g.return===null){jn=1,Tp=f,Dn=null;break}e:{var D=c,z=g.return,H=g,te=f;if(f=_r,H.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){var pe=te,_e=H,ke=_e.tag;if(!(_e.mode&1)&&(ke===0||ke===11||ke===15)){var Te=_e.alternate;Te?(_e.updateQueue=Te.updateQueue,_e.memoizedState=Te.memoizedState,_e.lanes=Te.lanes):(_e.updateQueue=null,_e.memoizedState=null)}var Me=tR(z);if(Me!==null){Me.flags&=-257,nR(Me,z,H,D,f),Me.mode&1&&eR(D,pe,f),f=Me,te=pe;var We=f.updateQueue;if(We===null){var He=new Set;He.add(te),f.updateQueue=He}else We.add(te);break e}else{if(!(f&1)){eR(D,pe,f),gS();break e}te=Error(t(426))}}else if(on&&H.mode&1){var _n=tR(z);if(_n!==null){!(_n.flags&65536)&&(_n.flags|=256),nR(_n,z,H,D,f),EI(_h(te,H));break e}}D=te=_h(te,H),jn!==4&&(jn=2),_p===null?_p=[D]:_p.push(D),D=z;do{switch(D.tag){case 3:D.flags|=65536,f&=-f,D.lanes|=f;var ce=J$(D,te,f);_$(D,ce);break e;case 1:H=te;var oe=D.type,de=D.stateNode;if(!(D.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(nl===null||!nl.has(de)))){D.flags|=65536,f&=-f,D.lanes|=f;var $e=Z$(D,H,f);_$(D,$e);break e}}D=D.return}while(D!==null)}DR(g)}catch(Ke){f=Ke,Dn===g&&g!==null&&(Dn=g=g.return);continue}break}while(!0)}function RR(){var c=P0.current;return P0.current=N0,c===null?N0:c}function gS(){(jn===0||jn===3||jn===2)&&(jn=4),lr===null||!(ku&268435455)&&!(F0&268435455)||il(lr,_r)}function U0(c,f){var g=Dt;Dt|=2;var I=RR();(lr!==c||_r!==f)&&(na=null,$u(c,f));do try{pj();break}catch(_){$R(c,_)}while(!0);if(NI(),Dt=g,P0.current=I,Dn!==null)throw Error(t(261));return lr=null,_r=0,jn}function pj(){for(;Dn!==null;)AR(Dn)}function mj(){for(;Dn!==null&&!Vy();)AR(Dn)}function AR(c){var f=FR(c.alternate,c,Ms);c.memoizedProps=c.pendingProps,f===null?DR(c):Dn=f,aS.current=null}function DR(c){var f=c;do{var g=f.alternate;if(c=f.return,f.flags&32768){if(g=lj(g,f),g!==null){g.flags&=32767,Dn=g;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{jn=6,Dn=null;return}}else if(g=aj(g,f,Ms),g!==null){Dn=g;return}if(f=f.sibling,f!==null){Dn=f;return}Dn=f=c}while(f!==null);jn===0&&(jn=5)}function Ru(c,f,g){var I=_t,_=ai.transition;try{ai.transition=null,_t=1,gj(c,f,g,I)}finally{ai.transition=_,_t=I}return null}function gj(c,f,g,I){do Nh();while(rl!==null);if(Dt&6)throw Error(t(327));g=c.finishedWork;var _=c.finishedLanes;if(g===null)return null;if(c.finishedWork=null,c.finishedLanes=0,g===c.current)throw Error(t(177));c.callbackNode=null,c.callbackPriority=0;var D=g.lanes|g.childLanes;if(Kt(c,D),c===lr&&(Dn=lr=null,_r=0),!(g.subtreeFlags&2064)&&!(g.flags&2064)||M0||(M0=!0,LR(ei,function(){return Nh(),null})),D=(g.flags&15990)!==0,g.subtreeFlags&15990||D){D=ai.transition,ai.transition=null;var z=_t;_t=1;var H=Dt;Dt|=4,aS.current=null,cj(c,g),SR(g,c),FW(gI),Ha=!!mI,gI=mI=null,c.current=g,hj(g),Z1(),Dt=H,_t=z,ai.transition=D}else c.current=g;if(M0&&(M0=!1,rl=c,V0=_),D=c.pendingLanes,D===0&&(nl=null),Uy(g.stateNode),gs(c,Jt()),f!==null)for(I=c.onRecoverableError,g=0;g<f.length;g++)_=f[g],I(_.value,{componentStack:_.stack,digest:_.digest});if(L0)throw L0=!1,c=cS,cS=null,c;return V0&1&&c.tag!==0&&Nh(),D=c.pendingLanes,D&1?c===hS?Cp++:(Cp=0,hS=c):Cp=0,Ja(),null}function Nh(){if(rl!==null){var c=ja(V0),f=ai.transition,g=_t;try{if(ai.transition=null,_t=16>c?16:c,rl===null)var I=!1;else{if(c=rl,rl=null,V0=0,Dt&6)throw Error(t(331));var _=Dt;for(Dt|=4,Be=c.current;Be!==null;){var D=Be,z=D.child;if(Be.flags&16){var H=D.deletions;if(H!==null){for(var te=0;te<H.length;te++){var pe=H[te];for(Be=pe;Be!==null;){var _e=Be;switch(_e.tag){case 0:case 11:case 15:Sp(8,_e,D)}var ke=_e.child;if(ke!==null)ke.return=_e,Be=ke;else for(;Be!==null;){_e=Be;var Te=_e.sibling,Me=_e.return;if(wR(_e),_e===pe){Be=null;break}if(Te!==null){Te.return=Me,Be=Te;break}Be=Me}}}var We=D.alternate;if(We!==null){var He=We.child;if(He!==null){We.child=null;do{var _n=He.sibling;He.sibling=null,He=_n}while(He!==null)}}Be=D}}if(D.subtreeFlags&2064&&z!==null)z.return=D,Be=z;else e:for(;Be!==null;){if(D=Be,D.flags&2048)switch(D.tag){case 0:case 11:case 15:Sp(9,D,D.return)}var ce=D.sibling;if(ce!==null){ce.return=D.return,Be=ce;break e}Be=D.return}}var oe=c.current;for(Be=oe;Be!==null;){z=Be;var de=z.child;if(z.subtreeFlags&2064&&de!==null)de.return=z,Be=de;else e:for(z=oe;Be!==null;){if(H=Be,H.flags&2048)try{switch(H.tag){case 0:case 11:case 15:O0(9,H)}}catch(Ke){wn(H,H.return,Ke)}if(H===z){Be=null;break e}var $e=H.sibling;if($e!==null){$e.return=H.return,Be=$e;break e}Be=H.return}}if(Dt=_,Ja(),As&&typeof As.onPostCommitFiberRoot=="function")try{As.onPostCommitFiberRoot(pu,c)}catch{}I=!0}return I}finally{_t=g,ai.transition=f}}return!1}function OR(c,f,g){f=_h(g,f),f=J$(c,f,1),c=el(c,f,1),f=Zr(),c!==null&&(Ua(c,1,f),gs(c,f))}function wn(c,f,g){if(c.tag===3)OR(c,c,g);else for(;f!==null;){if(f.tag===3){OR(f,c,g);break}else if(f.tag===1){var I=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(nl===null||!nl.has(I))){c=_h(g,c),c=Z$(f,c,1),f=el(f,c,1),c=Zr(),f!==null&&(Ua(f,1,c),gs(f,c));break}}f=f.return}}function yj(c,f,g){var I=c.pingCache;I!==null&&I.delete(f),f=Zr(),c.pingedLanes|=c.suspendedLanes&g,lr===c&&(_r&g)===g&&(jn===4||jn===3&&(_r&130023424)===_r&&500>Jt()-uS?$u(c,0):lS|=g),gs(c,f)}function PR(c,f){f===0&&(c.mode&1?(f=Jc,Jc<<=1,!(Jc&130023424)&&(Jc=4194304)):f=1);var g=Zr();c=Zo(c,f),c!==null&&(Ua(c,f,g),gs(c,g))}function wj(c){var f=c.memoizedState,g=0;f!==null&&(g=f.retryLane),PR(c,g)}function vj(c,f){var g=0;switch(c.tag){case 13:var I=c.stateNode,_=c.memoizedState;_!==null&&(g=_.retryLane);break;case 19:I=c.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(f),PR(c,g)}var FR;FR=function(c,f,g){if(c!==null)if(c.memoizedProps!==f.pendingProps||ds.current)ps=!0;else{if(!(c.lanes&g)&&!(f.flags&128))return ps=!1,oj(c,f,g);ps=!!(c.flags&131072)}else ps=!1,on&&f.flags&1048576&&m$(f,y0,f.index);switch(f.lanes=0,f.tag){case 2:var I=f.type;A0(c,f),c=f.pendingProps;var _=yh(f,Ar.current);Sh(f,g),_=zI(null,f,I,c,_,g);var D=BI();return f.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(f.tag=1,f.memoizedState=null,f.updateQueue=null,fs(I)?(D=!0,p0(f)):D=!1,f.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,DI(f),_.updater=$0,f.stateNode=_,_._reactInternals=f,qI(f,I,c,g),f=YI(null,f,I,!0,D,g)):(f.tag=0,on&&D&&SI(f),Jr(null,f,_,g),f=f.child),f;case 16:I=f.elementType;e:{switch(A0(c,f),c=f.pendingProps,_=I._init,I=_(I._payload),f.type=I,_=f.tag=bj(I),c=Ri(I,c),_){case 0:f=QI(null,f,I,c,g);break e;case 1:f=lR(null,f,I,c,g);break e;case 11:f=rR(null,f,I,c,g);break e;case 14:f=sR(null,f,I,Ri(I.type,c),g);break e}throw Error(t(306,I,""))}return f;case 0:return I=f.type,_=f.pendingProps,_=f.elementType===I?_:Ri(I,_),QI(c,f,I,_,g);case 1:return I=f.type,_=f.pendingProps,_=f.elementType===I?_:Ri(I,_),lR(c,f,I,_,g);case 3:e:{if(uR(f),c===null)throw Error(t(387));I=f.pendingProps,D=f.memoizedState,_=D.element,T$(c,f),S0(f,I,null,g);var z=f.memoizedState;if(I=z.element,D.isDehydrated)if(D={element:I,isDehydrated:!1,cache:z.cache,pendingSuspenseBoundaries:z.pendingSuspenseBoundaries,transitions:z.transitions},f.updateQueue.baseState=D,f.memoizedState=D,f.flags&256){_=_h(Error(t(423)),f),f=cR(c,f,I,g,_);break e}else if(I!==_){_=_h(Error(t(424)),f),f=cR(c,f,I,g,_);break e}else for(Ls=Xa(f.stateNode.containerInfo.firstChild),Fs=f,on=!0,$i=null,g=I$(f,null,I,g),f.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(xh(),I===_){f=ta(c,f,g);break e}Jr(c,f,I,g)}f=f.child}return f;case 5:return E$(f),c===null&&CI(f),I=f.type,_=f.pendingProps,D=c!==null?c.memoizedProps:null,z=_.children,yI(I,_)?z=null:D!==null&&yI(I,D)&&(f.flags|=32),aR(c,f),Jr(c,f,z,g),f.child;case 6:return c===null&&CI(f),null;case 13:return hR(c,f,g);case 4:return OI(f,f.stateNode.containerInfo),I=f.pendingProps,c===null?f.child=bh(f,null,I,g):Jr(c,f,I,g),f.child;case 11:return I=f.type,_=f.pendingProps,_=f.elementType===I?_:Ri(I,_),rR(c,f,I,_,g);case 7:return Jr(c,f,f.pendingProps,g),f.child;case 8:return Jr(c,f,f.pendingProps.children,g),f.child;case 12:return Jr(c,f,f.pendingProps.children,g),f.child;case 10:e:{if(I=f.type._context,_=f.pendingProps,D=f.memoizedProps,z=_.value,Zt(x0,I._currentValue),I._currentValue=z,D!==null)if(Ni(D.value,z)){if(D.children===_.children&&!ds.current){f=ta(c,f,g);break e}}else for(D=f.child,D!==null&&(D.return=f);D!==null;){var H=D.dependencies;if(H!==null){z=D.child;for(var te=H.firstContext;te!==null;){if(te.context===I){if(D.tag===1){te=ea(-1,g&-g),te.tag=2;var pe=D.updateQueue;if(pe!==null){pe=pe.shared;var _e=pe.pending;_e===null?te.next=te:(te.next=_e.next,_e.next=te),pe.pending=te}}D.lanes|=g,te=D.alternate,te!==null&&(te.lanes|=g),RI(D.return,g,f),H.lanes|=g;break}te=te.next}}else if(D.tag===10)z=D.type===f.type?null:D.child;else if(D.tag===18){if(z=D.return,z===null)throw Error(t(341));z.lanes|=g,H=z.alternate,H!==null&&(H.lanes|=g),RI(z,g,f),z=D.sibling}else z=D.child;if(z!==null)z.return=D;else for(z=D;z!==null;){if(z===f){z=null;break}if(D=z.sibling,D!==null){D.return=z.return,z=D;break}z=z.return}D=z}Jr(c,f,_.children,g),f=f.child}return f;case 9:return _=f.type,I=f.pendingProps.children,Sh(f,g),_=ii(_),I=I(_),f.flags|=1,Jr(c,f,I,g),f.child;case 14:return I=f.type,_=Ri(I,f.pendingProps),_=Ri(I.type,_),sR(c,f,I,_,g);case 15:return iR(c,f,f.type,f.pendingProps,g);case 17:return I=f.type,_=f.pendingProps,_=f.elementType===I?_:Ri(I,_),A0(c,f),f.tag=1,fs(I)?(c=!0,p0(f)):c=!1,Sh(f,g),Q$(f,I,_),qI(f,I,_,g),YI(null,f,I,!0,c,g);case 19:return fR(c,f,g);case 22:return oR(c,f,g)}throw Error(t(156,f.tag))};function LR(c,f){return Qc(c,f)}function xj(c,f,g,I){this.tag=c,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function li(c,f,g,I){return new xj(c,f,g,I)}function yS(c){return c=c.prototype,!(!c||!c.isReactComponent)}function bj(c){if(typeof c=="function")return yS(c)?1:0;if(c!=null){if(c=c.$$typeof,c===L)return 11;if(c===Y)return 14}return 2}function ol(c,f){var g=c.alternate;return g===null?(g=li(c.tag,f,c.key,c.mode),g.elementType=c.elementType,g.type=c.type,g.stateNode=c.stateNode,g.alternate=c,c.alternate=g):(g.pendingProps=f,g.type=c.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=c.flags&14680064,g.childLanes=c.childLanes,g.lanes=c.lanes,g.child=c.child,g.memoizedProps=c.memoizedProps,g.memoizedState=c.memoizedState,g.updateQueue=c.updateQueue,f=c.dependencies,g.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},g.sibling=c.sibling,g.index=c.index,g.ref=c.ref,g}function W0(c,f,g,I,_,D){var z=2;if(I=c,typeof c=="function")yS(c)&&(z=1);else if(typeof c=="string")z=5;else e:switch(c){case k:return Au(g.children,_,D,f);case $:z=8,_|=8;break;case N:return c=li(12,g,f,_|2),c.elementType=N,c.lanes=D,c;case F:return c=li(13,g,f,_),c.elementType=F,c.lanes=D,c;case G:return c=li(19,g,f,_),c.elementType=G,c.lanes=D,c;case se:return j0(g,_,D,f);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case R:z=10;break e;case E:z=9;break e;case L:z=11;break e;case Y:z=14;break e;case q:z=16,I=null;break e}throw Error(t(130,c==null?c:typeof c,""))}return f=li(z,g,f,_),f.elementType=c,f.type=I,f.lanes=D,f}function Au(c,f,g,I){return c=li(7,c,I,f),c.lanes=g,c}function j0(c,f,g,I){return c=li(22,c,I,f),c.elementType=se,c.lanes=g,c.stateNode={isHidden:!1},c}function wS(c,f,g){return c=li(6,c,null,f),c.lanes=g,c}function vS(c,f,g){return f=li(4,c.children!==null?c.children:[],c.key,f),f.lanes=g,f.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},f}function Ij(c,f,g,I,_){this.tag=f,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ba(0),this.expirationTimes=Ba(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ba(0),this.identifierPrefix=I,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function xS(c,f,g,I,_,D,z,H,te){return c=new Ij(c,f,g,H,te),f===1?(f=1,D===!0&&(f|=8)):f=0,D=li(3,null,null,f),c.current=D,D.stateNode=c,D.memoizedState={element:I,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},DI(D),c}function Sj(c,f,g){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:I==null?null:""+I,children:c,containerInfo:f,implementation:g}}function MR(c){if(!c)return Ya;c=c._reactInternals;e:{if(Ii(c)!==c||c.tag!==1)throw Error(t(170));var f=c;do{switch(f.tag){case 3:f=f.stateNode.context;break e;case 1:if(fs(f.type)){f=f.stateNode.__reactInternalMemoizedMergedChildContext;break e}}f=f.return}while(f!==null);throw Error(t(171))}if(c.tag===1){var g=c.type;if(fs(g))return d$(c,g,f)}return f}function VR(c,f,g,I,_,D,z,H,te){return c=xS(g,I,!0,c,_,D,z,H,te),c.context=MR(null),g=c.current,I=Zr(),_=sl(g),D=ea(I,_),D.callback=f??null,el(g,D,_),c.current.lanes=_,Ua(c,_,I),gs(c,I),c}function G0(c,f,g,I){var _=f.current,D=Zr(),z=sl(_);return g=MR(g),f.context===null?f.context=g:f.pendingContext=g,f=ea(D,z),f.payload={element:c},I=I===void 0?null:I,I!==null&&(f.callback=I),c=el(_,f,z),c!==null&&(Oi(c,_,z,D),I0(c,_,z)),z}function H0(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return c.child.stateNode;default:return c.child.stateNode}}function zR(c,f){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var g=c.retryLane;c.retryLane=g!==0&&g<f?g:f}}function bS(c,f){zR(c,f),(c=c.alternate)&&zR(c,f)}function Tj(){return null}var BR=typeof reportError=="function"?reportError:function(c){console.error(c)};function IS(c){this._internalRoot=c}q0.prototype.render=IS.prototype.render=function(c){var f=this._internalRoot;if(f===null)throw Error(t(409));G0(c,f,null,null)},q0.prototype.unmount=IS.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var f=c.containerInfo;Nu(function(){G0(null,c,null,null)}),f[Xo]=null}};function q0(c){this._internalRoot=c}q0.prototype.unstable_scheduleHydration=function(c){if(c){var f=qy();c={blockedOn:null,target:c,priority:f};for(var g=0;g<oo.length&&f!==0&&f<oo[g].priority;g++);oo.splice(g,0,c),g===0&&Qy(c)}};function SS(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function K0(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11&&(c.nodeType!==8||c.nodeValue!==" react-mount-point-unstable "))}function UR(){}function _j(c,f,g,I,_){if(_){if(typeof I=="function"){var D=I;I=function(){var pe=H0(z);D.call(pe)}}var z=VR(f,I,c,0,null,!1,!1,"",UR);return c._reactRootContainer=z,c[Xo]=z.current,cp(c.nodeType===8?c.parentNode:c),Nu(),z}for(;_=c.lastChild;)c.removeChild(_);if(typeof I=="function"){var H=I;I=function(){var pe=H0(te);H.call(pe)}}var te=xS(c,0,!1,null,null,!1,!1,"",UR);return c._reactRootContainer=te,c[Xo]=te.current,cp(c.nodeType===8?c.parentNode:c),Nu(function(){G0(f,te,g,I)}),te}function X0(c,f,g,I,_){var D=g._reactRootContainer;if(D){var z=D;if(typeof _=="function"){var H=_;_=function(){var te=H0(z);H.call(te)}}G0(f,z,c,_)}else z=_j(g,f,c,_,I);return H0(z)}Gy=function(c){switch(c.tag){case 3:var f=c.stateNode;if(f.current.memoizedState.isDehydrated){var g=za(f.pendingLanes);g!==0&&(Wa(f,g|1),gs(f,Jt()),!(Dt&6)&&(kh=Jt()+500,Ja()))}break;case 13:Nu(function(){var I=Zo(c,1);if(I!==null){var _=Zr();Oi(I,c,1,_)}}),bS(c,1)}},Zc=function(c){if(c.tag===13){var f=Zo(c,134217728);if(f!==null){var g=Zr();Oi(f,c,134217728,g)}bS(c,134217728)}},Hy=function(c){if(c.tag===13){var f=sl(c),g=Zo(c,f);if(g!==null){var I=Zr();Oi(g,c,f,I)}bS(c,f)}},qy=function(){return _t},Ky=function(c,f){var g=_t;try{return _t=c,f()}finally{_t=g}},jc=function(c,f,g){switch(f){case"input":if(Ft(c,g),f=g.name,g.type==="radio"&&f!=null){for(g=c;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+f)+'][type="radio"]'),f=0;f<g.length;f++){var I=g[f];if(I!==c&&I.form===c.form){var _=d0(I);if(!_)throw Error(t(90));wt(I),Ft(I,_)}}}break;case"textarea":sr(c,g);break;case"select":f=g.value,f!=null&&rr(c,!!g.multiple,f,!1)}},uu=pS,Gf=Nu;var Cj={usingClientEntryPoint:!1,Events:[fp,mh,d0,so,jf,pS]},Ep={findFiberByHostInstance:bu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ej={bundleType:Ep.bundleType,version:Ep.version,rendererPackageName:Ep.rendererPackageName,rendererConfig:Ep.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=Kf(c),c===null?null:c.stateNode},findFiberByHostInstance:Ep.findFiberByHostInstance||Tj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Q0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Q0.isDisabled&&Q0.supportsFiber)try{pu=Q0.inject(Ej),As=Q0}catch{}}return ys.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Cj,ys.createPortal=function(c,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!SS(f))throw Error(t(200));return Sj(c,f,null,g)},ys.createRoot=function(c,f){if(!SS(c))throw Error(t(299));var g=!1,I="",_=BR;return f!=null&&(f.unstable_strictMode===!0&&(g=!0),f.identifierPrefix!==void 0&&(I=f.identifierPrefix),f.onRecoverableError!==void 0&&(_=f.onRecoverableError)),f=xS(c,1,!1,null,null,g,!1,I,_),c[Xo]=f.current,cp(c.nodeType===8?c.parentNode:c),new IS(f)},ys.findDOMNode=function(c){if(c==null)return null;if(c.nodeType===1)return c;var f=c._reactInternals;if(f===void 0)throw typeof c.render=="function"?Error(t(188)):(c=Object.keys(c).join(","),Error(t(268,c)));return c=Kf(f),c=c===null?null:c.stateNode,c},ys.flushSync=function(c){return Nu(c)},ys.hydrate=function(c,f,g){if(!K0(f))throw Error(t(200));return X0(null,c,f,!0,g)},ys.hydrateRoot=function(c,f,g){if(!SS(c))throw Error(t(405));var I=g!=null&&g.hydratedSources||null,_=!1,D="",z=BR;if(g!=null&&(g.unstable_strictMode===!0&&(_=!0),g.identifierPrefix!==void 0&&(D=g.identifierPrefix),g.onRecoverableError!==void 0&&(z=g.onRecoverableError)),f=VR(f,null,c,1,g??null,_,!1,D,z),c[Xo]=f.current,cp(c),I)for(c=0;c<I.length;c++)g=I[c],_=g._getVersion,_=_(g._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[g,_]:f.mutableSourceEagerHydrationData.push(g,_);return new q0(f)},ys.render=function(c,f,g){if(!K0(f))throw Error(t(200));return X0(null,c,f,!1,g)},ys.unmountComponentAtNode=function(c){if(!K0(c))throw Error(t(40));return c._reactRootContainer?(Nu(function(){X0(null,null,c,!1,function(){c._reactRootContainer=null,c[Xo]=null})}),!0):!1},ys.unstable_batchedUpdates=pS,ys.unstable_renderSubtreeIntoContainer=function(c,f,g,I){if(!K0(g))throw Error(t(200));if(c==null||c._reactInternals===void 0)throw Error(t(38));return X0(c,f,g,!1,I)},ys.version="18.3.1-next-f1338f8080-20240426",ys}var QR;function Fj(){if(QR)return CS.exports;QR=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),CS.exports=Pj(),CS.exports}var YR;function Lj(){if(YR)return Y0;YR=1;var n=Fj();return Y0.createRoot=n.createRoot,Y0.hydrateRoot=n.hydrateRoot,Y0}var Mj=Lj(),Np={},JR;function Vj(){if(JR)return Np;JR=1,Object.defineProperty(Np,"__esModule",{value:!0}),Np.parse=o,Np.serialize=u;const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,s=Object.prototype.toString,i=(()=>{const p=function(){};return p.prototype=Object.create(null),p})();function o(p,m){const y=new i,v=p.length;if(v<2)return y;const w=(m==null?void 0:m.decode)||h;let b=0;do{const S=p.indexOf("=",b);if(S===-1)break;const C=p.indexOf(";",b),T=C===-1?v:C;if(S>T){b=p.lastIndexOf(";",S-1)+1;continue}const O=a(p,b,S),V=l(p,S,O),k=p.slice(O,V);if(y[k]===void 0){let $=a(p,S+1,T),N=l(p,T,$);const R=w(p.slice($,N));y[k]=R}b=T+1}while(b<v);return y}function a(p,m,y){do{const v=p.charCodeAt(m);if(v!==32&&v!==9)return m}while(++m<y);return y}function l(p,m,y){for(;m>y;){const v=p.charCodeAt(--m);if(v!==32&&v!==9)return m+1}return y}function u(p,m,y){const v=(y==null?void 0:y.encode)||encodeURIComponent;if(!n.test(p))throw new TypeError(`argument name is invalid: ${p}`);const w=v(m);if(!e.test(w))throw new TypeError(`argument val is invalid: ${m}`);let b=p+"="+w;if(!y)return b;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);b+="; Max-Age="+y.maxAge}if(y.domain){if(!t.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);b+="; Domain="+y.domain}if(y.path){if(!r.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);b+="; Path="+y.path}if(y.expires){if(!d(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);b+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(b+="; HttpOnly"),y.secure&&(b+="; Secure"),y.partitioned&&(b+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return b}function h(p){if(p.indexOf("%")===-1)return p;try{return decodeURIComponent(p)}catch{return p}}function d(p){return s.call(p)==="[object Date]"}return Np}Vj();/**
 * react-router v7.0.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var ZR="popstate";function zj(n={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return uT("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:sm(s)}return Uj(e,t,null,n)}function gn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Hl(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Bj(){return Math.random().toString(36).substring(2,10)}function eA(n,e){return{usr:n.state,key:n.key,idx:e}}function uT(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?gd(e):e,state:t,key:e&&e.key||r||Bj()}}function sm({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function gd(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function Uj(n,e,t,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,u=h();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function h(){return(o.state||{idx:null}).idx}function d(){a="POP";let w=h(),b=w==null?null:w-u;u=w,l&&l({action:a,location:v.location,delta:b})}function p(w,b){a="PUSH";let S=uT(v.location,w,b);u=h()+1;let C=eA(S,u),T=v.createHref(S);try{o.pushState(C,"",T)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;s.location.assign(T)}i&&l&&l({action:a,location:v.location,delta:1})}function m(w,b){a="REPLACE";let S=uT(v.location,w,b);u=h();let C=eA(S,u),T=v.createHref(S);o.replaceState(C,"",T),i&&l&&l({action:a,location:v.location,delta:0})}function y(w){let b=s.location.origin!=="null"?s.location.origin:s.location.href,S=typeof w=="string"?w:sm(w);return S=S.replace(/ $/,"%20"),gn(b,`No window.location.(origin|href) available to create URL for href: ${S}`),new URL(S,b)}let v={get action(){return a},get location(){return n(s,o)},listen(w){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(ZR,d),l=w,()=>{s.removeEventListener(ZR,d),l=null}},createHref(w){return e(s,w)},createURL:y,encodeLocation(w){let b=y(w);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:m,go(w){return o.go(w)}};return v}function AP(n,e,t="/"){return Wj(n,e,t,!1)}function Wj(n,e,t,r){let s=typeof e=="string"?gd(e):e,i=Nl(s.pathname||"/",t);if(i==null)return null;let o=DP(n);jj(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=tG(i);a=Zj(o[l],u,r)}return a}function DP(n,e=[],t=[],r=""){let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(gn(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let u=ha([r,l.relativePath]),h=t.concat(l);i.children&&i.children.length>0&&(gn(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),DP(i.children,e,h,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:Yj(u,i.index),routesMeta:h})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of OP(i.path))s(i,o,l)}),e}function OP(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=OP(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function jj(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Jj(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var Gj=/^:[\w-]+$/,Hj=3,qj=2,Kj=1,Xj=10,Qj=-2,tA=n=>n==="*";function Yj(n,e){let t=n.split("/"),r=t.length;return t.some(tA)&&(r+=Qj),e&&(r+=qj),t.filter(s=>!tA(s)).reduce((s,i)=>s+(Gj.test(i)?Hj:i===""?Kj:Xj),r)}function Jj(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function Zj(n,e,t=!1){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",d=lv({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},h),p=l.route;if(!d&&u&&t&&!r[r.length-1].route.index&&(d=lv({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!d)return null;Object.assign(s,d.params),o.push({params:s,pathname:ha([i,d.pathname]),pathnameBase:iG(ha([i,d.pathnameBase])),route:p}),d.pathnameBase!=="/"&&(i=ha([i,d.pathnameBase]))}return o}function lv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=eG(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,{paramName:h,isOptional:d},p)=>{if(h==="*"){let y=a[p]||"";o=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const m=a[p];return d&&!m?u[h]=void 0:u[h]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:n}}function eG(n,e=!1,t=!0){Hl(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function tG(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Hl(!1,`The URL path "${n}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Nl(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function nG(n,e="/"){let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?gd(n):n;return{pathname:t?t.startsWith("/")?t:rG(t,e):e,search:oG(r),hash:aG(s)}}function rG(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function NS(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sG(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function PP(n){let e=sG(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function FP(n,e,t,r=!1){let s;typeof n=="string"?s=gd(n):(s={...n},gn(!s.pathname||!s.pathname.includes("?"),NS("?","pathname","search",s)),gn(!s.pathname||!s.pathname.includes("#"),NS("#","pathname","hash",s)),gn(!s.search||!s.search.includes("#"),NS("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),d-=1;s.pathname=p.join("/")}a=d>=0?e[d]:"/"}let l=nG(s,a),u=o&&o!=="/"&&o.endsWith("/"),h=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||h)&&(l.pathname+="/"),l}var ha=n=>n.join("/").replace(/\/\/+/g,"/"),iG=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),oG=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,aG=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function lG(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var LP=["POST","PUT","PATCH","DELETE"];new Set(LP);var uG=["GET",...LP];new Set(uG);var yd=ye.createContext(null);yd.displayName="DataRouter";var ix=ye.createContext(null);ix.displayName="DataRouterState";var MP=ye.createContext({isTransitioning:!1});MP.displayName="ViewTransition";var cG=ye.createContext(new Map);cG.displayName="Fetchers";var hG=ye.createContext(null);hG.displayName="Await";var Vo=ye.createContext(null);Vo.displayName="Navigation";var Om=ye.createContext(null);Om.displayName="Location";var Ea=ye.createContext({outlet:null,matches:[],isDataRoute:!1});Ea.displayName="Route";var O_=ye.createContext(null);O_.displayName="RouteError";function dG(n,{relative:e}={}){gn(Pm(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=ye.useContext(Vo),{hash:s,pathname:i,search:o}=Lm(n,{relative:e}),a=i;return t!=="/"&&(a=i==="/"?t:ha([t,i])),r.createHref({pathname:a,search:o,hash:s})}function Pm(){return ye.useContext(Om)!=null}function Tc(){return gn(Pm(),"useLocation() may be used only in the context of a <Router> component."),ye.useContext(Om).location}var VP="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function zP(n){ye.useContext(Vo).static||ye.useLayoutEffect(n)}function Fm(){let{isDataRoute:n}=ye.useContext(Ea);return n?_G():fG()}function fG(){gn(Pm(),"useNavigate() may be used only in the context of a <Router> component.");let n=ye.useContext(yd),{basename:e,navigator:t}=ye.useContext(Vo),{matches:r}=ye.useContext(Ea),{pathname:s}=Tc(),i=JSON.stringify(PP(r)),o=ye.useRef(!1);return zP(()=>{o.current=!0}),ye.useCallback((l,u={})=>{if(Hl(o.current,VP),!o.current)return;if(typeof l=="number"){t.go(l);return}let h=FP(l,JSON.parse(i),s,u.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:ha([e,h.pathname])),(u.replace?t.replace:t.push)(h,u.state,u)},[e,t,i,s,n])}ye.createContext(null);function Lm(n,{relative:e}={}){let{matches:t}=ye.useContext(Ea),{pathname:r}=Tc(),s=JSON.stringify(PP(t));return ye.useMemo(()=>FP(n,JSON.parse(s),r,e==="path"),[n,s,r,e])}function pG(n,e){return BP(n,e)}function BP(n,e,t,r){var v;gn(Pm(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=ye.useContext(Vo),{matches:i}=ye.useContext(Ea),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=Tc(),h;if(e){let w=typeof e=="string"?gd(e):e;gn(l==="/"||((v=w.pathname)==null?void 0:v.startsWith(l)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${l}" but pathname "${w.pathname}" was given in the \`location\` prop.`),h=w}else h=u;let d=h.pathname||"/",p=d;if(l!=="/"){let w=l.replace(/^\//,"").split("/");p="/"+d.replace(/^\//,"").split("/").slice(w.length).join("/")}let m=AP(n,{pathname:p}),y=vG(m&&m.map(w=>Object.assign({},w,{params:Object.assign({},a,w.params),pathname:ha([l,s.encodeLocation?s.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:ha([l,s.encodeLocation?s.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),i,t,r);return e&&y?ye.createElement(Om.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...h},navigationType:"POP"}},y):y}function mG(){let n=TG(),e=lG(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ye.createElement(ye.Fragment,null,ye.createElement("h2",null,"Unexpected Application Error!"),ye.createElement("h3",{style:{fontStyle:"italic"}},e),t?ye.createElement("pre",{style:s},t):null,null)}var gG=ye.createElement(mG,null),yG=class extends ye.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?ye.createElement(Ea.Provider,{value:this.props.routeContext},ye.createElement(O_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function wG({routeContext:n,match:e,children:t}){let r=ye.useContext(yd);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),ye.createElement(Ea.Provider,{value:n},t)}function vG(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let s=n,i=t==null?void 0:t.errors;if(i!=null){let l=s.findIndex(u=>u.route.id&&(i==null?void 0:i[u.route.id])!==void 0);gn(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),s=s.slice(0,Math.min(s.length,l+1))}let o=!1,a=-1;if(t)for(let l=0;l<s.length;l++){let u=s[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=l),u.route.id){let{loaderData:h,errors:d}=t,p=u.route.loader&&!h.hasOwnProperty(u.route.id)&&(!d||d[u.route.id]===void 0);if(u.route.lazy||p){o=!0,a>=0?s=s.slice(0,a+1):s=[s[0]];break}}}return s.reduceRight((l,u,h)=>{let d,p=!1,m=null,y=null;t&&(d=i&&u.route.id?i[u.route.id]:void 0,m=u.route.errorElement||gG,o&&(a<0&&h===0?(CG("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,y=null):a===h&&(p=!0,y=u.route.hydrateFallbackElement||null)));let v=e.concat(s.slice(0,h+1)),w=()=>{let b;return d?b=m:p?b=y:u.route.Component?b=ye.createElement(u.route.Component,null):u.route.element?b=u.route.element:b=l,ye.createElement(wG,{match:u,routeContext:{outlet:l,matches:v,isDataRoute:t!=null},children:b})};return t&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?ye.createElement(yG,{location:t.location,revalidation:t.revalidation,component:m,error:d,children:w(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):w()},null)}function P_(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function xG(n){let e=ye.useContext(yd);return gn(e,P_(n)),e}function bG(n){let e=ye.useContext(ix);return gn(e,P_(n)),e}function IG(n){let e=ye.useContext(Ea);return gn(e,P_(n)),e}function F_(n){let e=IG(n),t=e.matches[e.matches.length-1];return gn(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function SG(){return F_("useRouteId")}function TG(){var r;let n=ye.useContext(O_),e=bG("useRouteError"),t=F_("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function _G(){let{router:n}=xG("useNavigate"),e=F_("useNavigate"),t=ye.useRef(!1);return zP(()=>{t.current=!0}),ye.useCallback(async(s,i={})=>{Hl(t.current,VP),t.current&&(typeof s=="number"?n.navigate(s):await n.navigate(s,{fromRouteId:e,...i}))},[n,e])}var nA={};function CG(n,e,t){nA[n]||(nA[n]=!0,Hl(!1,t))}ye.memo(EG);function EG({routes:n,future:e,state:t}){return BP(n,void 0,t,e)}function Ah(n){gn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function kG({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:s,static:i=!1}){gn(!Pm(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=ye.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof t=="string"&&(t=gd(t));let{pathname:l="/",search:u="",hash:h="",state:d=null,key:p="default"}=t,m=ye.useMemo(()=>{let y=Nl(l,o);return y==null?null:{location:{pathname:y,search:u,hash:h,state:d,key:p},navigationType:r}},[o,l,u,h,d,p,r]);return Hl(m!=null,`<Router basename="${o}"> is not able to match the URL "${l}${u}${h}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:ye.createElement(Vo.Provider,{value:a},ye.createElement(Om.Provider,{children:e,value:m}))}function NG({children:n,location:e}){return pG(cT(n),e)}function cT(n,e=[]){let t=[];return ye.Children.forEach(n,(r,s)=>{if(!ye.isValidElement(r))return;let i=[...e,s];if(r.type===ye.Fragment){t.push.apply(t,cT(r.props.children,i));return}gn(r.type===Ah,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),gn(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=cT(r.props.children,i)),t.push(o)}),t}var xw="get",bw="application/x-www-form-urlencoded";function ox(n){return n!=null&&typeof n.tagName=="string"}function $G(n){return ox(n)&&n.tagName.toLowerCase()==="button"}function RG(n){return ox(n)&&n.tagName.toLowerCase()==="form"}function AG(n){return ox(n)&&n.tagName.toLowerCase()==="input"}function DG(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function OG(n,e){return n.button===0&&(!e||e==="_self")&&!DG(n)}var J0=null;function PG(){if(J0===null)try{new FormData(document.createElement("form"),0),J0=!1}catch{J0=!0}return J0}var FG=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function $S(n){return n!=null&&!FG.has(n)?(Hl(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${bw}"`),null):n}function LG(n,e){let t,r,s,i,o;if(RG(n)){let a=n.getAttribute("action");r=a?Nl(a,e):null,t=n.getAttribute("method")||xw,s=$S(n.getAttribute("enctype"))||bw,i=new FormData(n)}else if($G(n)||AG(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||a.getAttribute("action");if(r=l?Nl(l,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||xw,s=$S(n.getAttribute("formenctype"))||$S(a.getAttribute("enctype"))||bw,i=new FormData(a,n),!PG()){let{name:u,type:h,value:d}=n;if(h==="image"){let p=u?`${u}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else u&&i.append(u,d)}}else{if(ox(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=xw,r=null,s=bw,o=n}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:t.toLowerCase(),encType:s,formData:i,body:o}}function L_(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}async function MG(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function VG(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function zG(n,e,t){let r=await Promise.all(n.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await MG(i,t);return o.links?o.links():[]}return[]}));return jG(r.flat(1).filter(VG).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function rA(n,e,t,r,s,i){let o=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,a=(l,u)=>{var h;return t[u].pathname!==l.pathname||((h=t[u].route.path)==null?void 0:h.endsWith("*"))&&t[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var d;let h=r.routes[l.route.id];if(!h||!h.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((d=t[0])==null?void 0:d.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function BG(n,e){return UG(n.map(t=>{let r=e.routes[t.route.id];if(!r)return[];let s=[r.module];return r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function UG(n){return[...new Set(n)]}function WG(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function jG(n,e){let t=new Set;return new Set(e),n.reduce((r,s)=>{let i=JSON.stringify(WG(s));return t.has(i)||(t.add(i),r.push({key:i,link:s})),r},[])}function GG(n){let e=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function HG(){let n=ye.useContext(yd);return L_(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function qG(){let n=ye.useContext(ix);return L_(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var M_=ye.createContext(void 0);M_.displayName="FrameworkContext";function UP(){let n=ye.useContext(M_);return L_(n,"You must render this element inside a <HydratedRouter> element"),n}function KG(n,e){let t=ye.useContext(M_),[r,s]=ye.useState(!1),[i,o]=ye.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:h,onTouchStart:d}=e,p=ye.useRef(null);ye.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let v=b=>{b.forEach(S=>{o(S.isIntersecting)})},w=new IntersectionObserver(v,{threshold:.5});return p.current&&w.observe(p.current),()=>{w.disconnect()}}},[n]),ye.useEffect(()=>{if(r){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[r]);let m=()=>{s(!0)},y=()=>{s(!1),o(!1)};return t?n!=="intent"?[i,p,{}]:[i,p,{onFocus:$p(a,m),onBlur:$p(l,y),onMouseEnter:$p(u,m),onMouseLeave:$p(h,y),onTouchStart:$p(d,m)}]:[!1,p,{}]}function $p(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function XG({page:n,...e}){let{router:t}=HG(),r=ye.useMemo(()=>AP(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?ye.createElement(YG,{page:n,matches:r,...e}):(console.warn(`Tried to prefetch ${n} but no routes matched.`),null)}function QG(n){let{manifest:e,routeModules:t}=UP(),[r,s]=ye.useState([]);return ye.useEffect(()=>{let i=!1;return zG(n,e,t).then(o=>{i||s(o)}),()=>{i=!0}},[n,e,t]),r}function YG({page:n,matches:e,...t}){let r=Tc(),{manifest:s,routeModules:i}=UP(),{loaderData:o,matches:a}=qG(),l=ye.useMemo(()=>rA(n,e,a,s,r,"data"),[n,e,a,s,r]),u=ye.useMemo(()=>rA(n,e,a,s,r,"assets"),[n,e,a,s,r]),h=ye.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let m=new Set,y=!1;if(e.forEach(w=>{var S;let b=s.routes[w.route.id];!b||!b.hasLoader||(!l.some(C=>C.route.id===w.route.id)&&w.route.id in o&&((S=i[w.route.id])!=null&&S.shouldRevalidate)||b.hasClientLoader?y=!0:m.add(w.route.id))}),m.size===0)return[];let v=GG(n);return y&&m.size>0&&v.searchParams.set("_routes",e.filter(w=>m.has(w.route.id)).map(w=>w.route.id).join(",")),[v.pathname+v.search]},[o,r,s,l,e,n,i]),d=ye.useMemo(()=>BG(u,s),[u,s]),p=QG(u);return ye.createElement(ye.Fragment,null,h.map(m=>ye.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...t})),d.map(m=>ye.createElement("link",{key:m,rel:"modulepreload",href:m,...t})),p.map(({key:m,link:y})=>ye.createElement("link",{key:m,...y})))}function JG(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var WP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{WP&&(window.__reactRouterVersion="7.0.1")}catch{}function ZG({basename:n,children:e,window:t}){let r=ye.useRef();r.current==null&&(r.current=zj({window:t,v5Compat:!0}));let s=r.current,[i,o]=ye.useState({action:s.action,location:s.location}),a=ye.useCallback(l=>{ye.startTransition(()=>o(l))},[o]);return ye.useLayoutEffect(()=>s.listen(a),[s,a]),ye.createElement(kG,{basename:n,children:e,location:i.location,navigationType:i.action,navigator:s})}var jP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wo=ye.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:h,viewTransition:d,...p},m){let{basename:y}=ye.useContext(Vo),v=typeof u=="string"&&jP.test(u),w,b=!1;if(typeof u=="string"&&v&&(w=u,WP))try{let N=new URL(window.location.href),R=u.startsWith("//")?new URL(N.protocol+u):new URL(u),E=Nl(R.pathname,y);R.origin===N.origin&&E!=null?u=E+R.search+R.hash:b=!0}catch{Hl(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let S=dG(u,{relative:s}),[C,T,O]=KG(r,p),V=rH(u,{replace:o,state:a,target:l,preventScrollReset:h,relative:s,viewTransition:d});function k(N){e&&e(N),N.defaultPrevented||V(N)}let $=ye.createElement("a",{...p,...O,href:w||S,onClick:b||i?e:k,ref:JG(m,T),target:l,"data-discover":!v&&t==="render"?"true":void 0});return C&&!v?ye.createElement(ye.Fragment,null,$,ye.createElement(XG,{page:S})):$});wo.displayName="Link";var eH=ye.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},h){let d=Lm(o,{relative:u.relative}),p=Tc(),m=ye.useContext(ix),{navigator:y,basename:v}=ye.useContext(Vo),w=m!=null&&lH(d)&&a===!0,b=y.encodeLocation?y.encodeLocation(d).pathname:d.pathname,S=p.pathname,C=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;t||(S=S.toLowerCase(),C=C?C.toLowerCase():null,b=b.toLowerCase()),C&&v&&(C=Nl(C,v)||C);const T=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let O=S===b||!s&&S.startsWith(b)&&S.charAt(T)==="/",V=C!=null&&(C===b||!s&&C.startsWith(b)&&C.charAt(b.length)==="/"),k={isActive:O,isPending:V,isTransitioning:w},$=O?e:void 0,N;typeof r=="function"?N=r(k):N=[r,O?"active":null,V?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let R=typeof i=="function"?i(k):i;return ye.createElement(wo,{...u,"aria-current":$,className:N,ref:h,style:R,to:o,viewTransition:a},typeof l=="function"?l(k):l)});eH.displayName="NavLink";var tH=ye.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:s,state:i,method:o=xw,action:a,onSubmit:l,relative:u,preventScrollReset:h,viewTransition:d,...p},m)=>{let y=oH(),v=aH(a,{relative:u}),w=o.toLowerCase()==="get"?"get":"post",b=typeof a=="string"&&jP.test(a),S=C=>{if(l&&l(C),C.defaultPrevented)return;C.preventDefault();let T=C.nativeEvent.submitter,O=(T==null?void 0:T.getAttribute("formmethod"))||o;y(T||C.currentTarget,{fetcherKey:e,method:O,navigate:t,replace:s,state:i,relative:u,preventScrollReset:h,viewTransition:d})};return ye.createElement("form",{ref:m,method:w,action:v,onSubmit:r?l:S,...p,"data-discover":!b&&n==="render"?"true":void 0})});tH.displayName="Form";function nH(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function GP(n){let e=ye.useContext(yd);return gn(e,nH(n)),e}function rH(n,{target:e,replace:t,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let a=Fm(),l=Tc(),u=Lm(n,{relative:i});return ye.useCallback(h=>{if(OG(h,e)){h.preventDefault();let d=t!==void 0?t:sm(l)===sm(u);a(n,{replace:d,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[l,a,u,t,r,e,n,s,i,o])}var sH=0,iH=()=>`__${String(++sH)}__`;function oH(){let{router:n}=GP("useSubmit"),{basename:e}=ye.useContext(Vo),t=SG();return ye.useCallback(async(r,s={})=>{let{action:i,method:o,encType:a,formData:l,body:u}=LG(r,e);if(s.navigate===!1){let h=s.fetcherKey||iH();await n.fetch(h,t,s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||o,formEncType:s.encType||a,flushSync:s.flushSync})}else await n.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||o,formEncType:s.encType||a,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,e,t])}function aH(n,{relative:e}={}){let{basename:t}=ye.useContext(Vo),r=ye.useContext(Ea);gn(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Lm(n||".",{relative:e})},o=Tc();if(n==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(h=>h==="")){a.delete("index"),l.filter(d=>d).forEach(d=>a.append("index",d));let h=a.toString();i.search=h?`?${h}`:""}}return(!n||n===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:ha([t,i.pathname])),sm(i)}function lH(n,e={}){let t=ye.useContext(MP);gn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=GP("useViewTransitionState"),s=Lm(n,{relative:e.relative});if(!t.isTransitioning)return!1;let i=Nl(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=Nl(t.nextLocation.pathname,r)||t.nextLocation.pathname;return lv(s.pathname,o)!=null||lv(s.pathname,i)!=null}new TextEncoder;var sA={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},uH=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},qP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,d=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,m=u&63;l||(m=64,o||(p=64)),r.push(t[h],t[d],t[p],t[m])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(HP(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):uH(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const d=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||d==null)throw new cH;const p=i<<2|a>>4;if(r.push(p),u!==64){const m=a<<4&240|u>>2;if(r.push(m),d!==64){const y=u<<6&192|d;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class cH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hH=function(n){const e=HP(n);return qP.encodeByteArray(e,!0)},uv=function(n){return hH(n).replace(/\./g,"")},KP=function(n){try{return qP.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dH(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fH=()=>dH().__FIREBASE_DEFAULTS__,pH=()=>{if(typeof process>"u"||typeof sA>"u")return;const n=sA.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},mH=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&KP(n[1]);return e&&JSON.parse(e)},ax=()=>{try{return fH()||pH()||mH()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},XP=n=>{var e,t;return(t=(e=ax())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},gH=n=>{const e=XP(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},QP=()=>{var n;return(n=ax())===null||n===void 0?void 0:n.config},YP=n=>{var e;return(e=ax())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wH(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[uv(JSON.stringify(t)),uv(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function vH(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wr())}function xH(){var n;const e=(n=ax())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bH(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function IH(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function SH(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TH(){const n=Wr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function _H(){return!xH()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function CH(){try{return typeof indexedDB=="object"}catch{return!1}}function EH(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kH="FirebaseError";class ka extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=kH,Object.setPrototypeOf(this,ka.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Mm.prototype.create)}}class Mm{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?NH(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ka(s,a,r)}}function NH(n,e){return n.replace($H,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const $H=/\{\$([^}]+)}/g;function RH(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function cv(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(iA(i)&&iA(o)){if(!cv(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function iA(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vm(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Lp(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Mp(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function AH(n,e){const t=new DH(n,e);return t.subscribe.bind(t)}class DH{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");OH(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=RS),s.error===void 0&&(s.error=RS),s.complete===void 0&&(s.complete=RS);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function OH(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function RS(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(n){return n&&n._delegate?n._delegate:n}class nc{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PH{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new yH;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(LH(e))try{this.getOrInitializeService({instanceIdentifier:Lu})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Lu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Lu){return this.instances.has(e)}getOptions(e=Lu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:FH(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Lu){return this.component?this.component.multipleInstances?e:Lu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FH(n){return n===Lu?void 0:n}function LH(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MH{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new PH(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(It||(It={}));const VH={debug:It.DEBUG,verbose:It.VERBOSE,info:It.INFO,warn:It.WARN,error:It.ERROR,silent:It.SILENT},zH=It.INFO,BH={[It.DEBUG]:"log",[It.VERBOSE]:"log",[It.INFO]:"info",[It.WARN]:"warn",[It.ERROR]:"error"},UH=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=BH[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let V_=class{constructor(e){this.name=e,this._logLevel=zH,this._logHandler=UH,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in It))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?VH[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,It.DEBUG,...e),this._logHandler(this,It.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,It.VERBOSE,...e),this._logHandler(this,It.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,It.INFO,...e),this._logHandler(this,It.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,It.WARN,...e),this._logHandler(this,It.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,It.ERROR,...e),this._logHandler(this,It.ERROR,...e)}};const WH=(n,e)=>e.some(t=>n instanceof t);let oA,aA;function jH(){return oA||(oA=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function GH(){return aA||(aA=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const JP=new WeakMap,hT=new WeakMap,ZP=new WeakMap,AS=new WeakMap,z_=new WeakMap;function HH(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(xl(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&JP.set(t,n)}).catch(()=>{}),z_.set(e,n),e}function qH(n){if(hT.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});hT.set(n,e)}let dT={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return hT.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ZP.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return xl(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function KH(n){dT=n(dT)}function XH(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(DS(this),e,...t);return ZP.set(r,e.sort?e.sort():[e]),xl(r)}:GH().includes(n)?function(...e){return n.apply(DS(this),e),xl(JP.get(this))}:function(...e){return xl(n.apply(DS(this),e))}}function QH(n){return typeof n=="function"?XH(n):(n instanceof IDBTransaction&&qH(n),WH(n,jH())?new Proxy(n,dT):n)}function xl(n){if(n instanceof IDBRequest)return HH(n);if(AS.has(n))return AS.get(n);const e=QH(n);return e!==n&&(AS.set(n,e),z_.set(e,n)),e}const DS=n=>z_.get(n);function YH(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=xl(o);return r&&o.addEventListener("upgradeneeded",l=>{r(xl(o.result),l.oldVersion,l.newVersion,xl(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const JH=["get","getKey","getAll","getAllKeys","count"],ZH=["put","add","delete","clear"],OS=new Map;function lA(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(OS.get(e))return OS.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=ZH.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||JH.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return OS.set(e,i),i}KH(n=>({...n,get:(e,t,r)=>lA(e,t)||n.get(e,t,r),has:(e,t)=>!!lA(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(t6(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function t6(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const fT="@firebase/app",uA="0.10.16";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ma=new V_("@firebase/app"),n6="@firebase/app-compat",r6="@firebase/analytics-compat",s6="@firebase/analytics",i6="@firebase/app-check-compat",o6="@firebase/app-check",a6="@firebase/auth",l6="@firebase/auth-compat",u6="@firebase/database",c6="@firebase/data-connect",h6="@firebase/database-compat",d6="@firebase/functions",f6="@firebase/functions-compat",p6="@firebase/installations",m6="@firebase/installations-compat",g6="@firebase/messaging",y6="@firebase/messaging-compat",w6="@firebase/performance",v6="@firebase/performance-compat",x6="@firebase/remote-config",b6="@firebase/remote-config-compat",I6="@firebase/storage",S6="@firebase/storage-compat",T6="@firebase/firestore",_6="@firebase/vertexai",C6="@firebase/firestore-compat",E6="firebase",k6="11.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pT="[DEFAULT]",N6={[fT]:"fire-core",[n6]:"fire-core-compat",[s6]:"fire-analytics",[r6]:"fire-analytics-compat",[o6]:"fire-app-check",[i6]:"fire-app-check-compat",[a6]:"fire-auth",[l6]:"fire-auth-compat",[u6]:"fire-rtdb",[c6]:"fire-data-connect",[h6]:"fire-rtdb-compat",[d6]:"fire-fn",[f6]:"fire-fn-compat",[p6]:"fire-iid",[m6]:"fire-iid-compat",[g6]:"fire-fcm",[y6]:"fire-fcm-compat",[w6]:"fire-perf",[v6]:"fire-perf-compat",[x6]:"fire-rc",[b6]:"fire-rc-compat",[I6]:"fire-gcs",[S6]:"fire-gcs-compat",[T6]:"fire-fst",[C6]:"fire-fst-compat",[_6]:"fire-vertex","fire-js":"fire-js",[E6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv=new Map,$6=new Map,mT=new Map;function cA(n,e){try{n.container.addComponent(e)}catch(t){ma.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function qh(n){const e=n.name;if(mT.has(e))return ma.debug(`There were multiple attempts to register component ${e}.`),!1;mT.set(e,n);for(const t of hv.values())cA(t,n);for(const t of $6.values())cA(t,n);return!0}function B_(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ui(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R6={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},bl=new Mm("app","Firebase",R6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A6{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new nc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw bl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd=k6;function eF(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:pT,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw bl.create("bad-app-name",{appName:String(s)});if(t||(t=QP()),!t)throw bl.create("no-options");const i=hv.get(s);if(i){if(cv(t,i.options)&&cv(r,i.config))return i;throw bl.create("duplicate-app",{appName:s})}const o=new MH(s);for(const l of mT.values())o.addComponent(l);const a=new A6(t,r,o);return hv.set(s,a),a}function tF(n=pT){const e=hv.get(n);if(!e&&n===pT&&QP())return eF();if(!e)throw bl.create("no-app",{appName:n});return e}function Il(n,e,t){var r;let s=(r=N6[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ma.warn(a.join(" "));return}qh(new nc(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D6="firebase-heartbeat-database",O6=1,im="firebase-heartbeat-store";let PS=null;function nF(){return PS||(PS=YH(D6,O6,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(im)}catch(t){console.warn(t)}}}}).catch(n=>{throw bl.create("idb-open",{originalErrorMessage:n.message})})),PS}async function P6(n){try{const t=(await nF()).transaction(im),r=await t.objectStore(im).get(rF(n));return await t.done,r}catch(e){if(e instanceof ka)ma.warn(e.message);else{const t=bl.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ma.warn(t.message)}}}async function hA(n,e){try{const r=(await nF()).transaction(im,"readwrite");await r.objectStore(im).put(e,rF(n)),await r.done}catch(t){if(t instanceof ka)ma.warn(t.message);else{const r=bl.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ma.warn(r.message)}}}function rF(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F6=1024,L6=30*24*60*60*1e3;class M6{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new z6(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=dA();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=L6}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ma.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=dA(),{heartbeatsToSend:r,unsentEntries:s}=V6(this._heartbeatsCache.heartbeats),i=uv(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ma.warn(t),""}}}function dA(){return new Date().toISOString().substring(0,10)}function V6(n,e=F6){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),fA(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),fA(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class z6{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return CH()?EH().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await P6(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return hA(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return hA(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function fA(n){return uv(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B6(n){qh(new nc("platform-logger",e=>new e6(e),"PRIVATE")),qh(new nc("heartbeat",e=>new M6(e),"PRIVATE")),Il(fT,uA,n),Il(fT,uA,"esm2017"),Il("fire-js","")}B6("");var U6="firebase",W6="11.0.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Il(U6,W6,"app");function U_(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function sF(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const j6=sF,iF=new Mm("auth","Firebase",sF());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dv=new V_("@firebase/auth");function G6(n,...e){dv.logLevel<=It.WARN&&dv.warn(`Auth (${wd}): ${n}`,...e)}function Iw(n,...e){dv.logLevel<=It.ERROR&&dv.error(`Auth (${wd}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qi(n,...e){throw W_(n,...e)}function bo(n,...e){return W_(n,...e)}function oF(n,e,t){const r=Object.assign(Object.assign({},j6()),{[e]:t});return new Mm("auth","Firebase",r).create(e,{appName:n.name})}function Io(n){return oF(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function W_(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return iF.create(n,...e)}function rt(n,e,...t){if(!n)throw W_(e,...t)}function la(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Iw(e),new Error(e)}function ga(n,e){n||la(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gT(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function H6(){return pA()==="http:"||pA()==="https:"}function pA(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q6(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(H6()||IH()||"connection"in navigator)?navigator.onLine:!0}function K6(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(e,t){this.shortDelay=e,this.longDelay=t,ga(t>e,"Short delay should be less than long delay!"),this.isMobile=vH()||SH()}get(){return q6()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j_(n,e){ga(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aF{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;la("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;la("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;la("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X6={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q6=new zm(3e4,6e4);function ql(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Na(n,e,t,r,s={}){return lF(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Vm(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u=Object.assign({method:e,headers:l},i);return bH()||(u.referrerPolicy="no-referrer"),aF.fetch()(uF(n,n.config.apiHost,t,a),u)})}async function lF(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},X6),e);try{const s=new J6(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Z0(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Z0(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Z0(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Z0(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw oF(n,h,u);qi(n,h)}}catch(s){if(s instanceof ka)throw s;qi(n,"network-request-failed",{message:String(s)})}}async function Bm(n,e,t,r,s={}){const i=await Na(n,e,t,r,s);return"mfaPendingCredential"in i&&qi(n,"multi-factor-auth-required",{_serverResponse:i}),i}function uF(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?j_(n.config,s):`${n.config.apiScheme}://${s}`}function Y6(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class J6{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(bo(this.auth,"network-request-failed")),Q6.get())})}}function Z0(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=bo(n,e,r);return s.customData._tokenResponse=t,s}function mA(n){return n!==void 0&&n.enterprise!==void 0}class Z6{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Y6(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function eq(n,e){return Na(n,"GET","/v2/recaptchaConfig",ql(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tq(n,e){return Na(n,"POST","/v1/accounts:delete",e)}async function cF(n,e){return Na(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jp(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function nq(n,e=!1){const t=Yn(n),r=await t.getIdToken(e),s=G_(r);rt(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Jp(FS(s.auth_time)),issuedAtTime:Jp(FS(s.iat)),expirationTime:Jp(FS(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function FS(n){return Number(n)*1e3}function G_(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Iw("JWT malformed, contained fewer than 3 sections"),null;try{const s=KP(t);return s?JSON.parse(s):(Iw("Failed to decode base64 JWT payload"),null)}catch(s){return Iw("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function gA(n){const e=G_(n);return rt(e,"internal-error"),rt(typeof e.exp<"u","internal-error"),rt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kh(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ka&&rq(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function rq({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jp(this.lastLoginAt),this.creationTime=Jp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fv(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Kh(n,cF(t,{idToken:r}));rt(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?hF(i.providerUserInfo):[],a=oq(n.providerData,o),l=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?u:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new yT(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,d)}async function iq(n){const e=Yn(n);await fv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function oq(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function hF(n){return n.map(e=>{var{providerId:t}=e,r=U_(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aq(n,e){const t=await lF(n,{},async()=>{const r=Vm({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=uF(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",aF.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function lq(n,e){return Na(n,"POST","/v2/accounts:revokeToken",ql(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){rt(e.idToken,"internal-error"),rt(typeof e.idToken<"u","internal-error"),rt(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):gA(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){rt(e.length!==0,"internal-error");const t=gA(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(rt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await aq(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new zh;return r&&(rt(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(rt(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(rt(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zh,this.toJSON())}_performRefresh(){return la("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(n,e){rt(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ua{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=U_(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new sq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new yT(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Kh(this,this.stsTokenManager.getToken(this.auth,e));return rt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return nq(this,e)}reload(){return iq(this)}_assign(e){this!==e&&(rt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ua(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){rt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await fv(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ui(this.auth.app))return Promise.reject(Io(this.auth));const e=await this.getIdToken();return await Kh(this,tq(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,u,h;const d=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,m=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,y=(o=t.photoURL)!==null&&o!==void 0?o:void 0,v=(a=t.tenantId)!==null&&a!==void 0?a:void 0,w=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,b=(u=t.createdAt)!==null&&u!==void 0?u:void 0,S=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:C,emailVerified:T,isAnonymous:O,providerData:V,stsTokenManager:k}=t;rt(C&&k,e,"internal-error");const $=zh.fromJSON(this.name,k);rt(typeof C=="string",e,"internal-error"),ll(d,e.name),ll(p,e.name),rt(typeof T=="boolean",e,"internal-error"),rt(typeof O=="boolean",e,"internal-error"),ll(m,e.name),ll(y,e.name),ll(v,e.name),ll(w,e.name),ll(b,e.name),ll(S,e.name);const N=new ua({uid:C,auth:e,email:p,emailVerified:T,displayName:d,isAnonymous:O,photoURL:y,phoneNumber:m,tenantId:v,stsTokenManager:$,createdAt:b,lastLoginAt:S});return V&&Array.isArray(V)&&(N.providerData=V.map(R=>Object.assign({},R))),w&&(N._redirectEventId=w),N}static async _fromIdTokenResponse(e,t,r=!1){const s=new zh;s.updateFromServerResponse(t);const i=new ua({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await fv(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];rt(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?hF(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new zh;a.updateFromIdToken(r);const l=new ua({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new yT(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yA=new Map;function ca(n){ga(n instanceof Function,"Expected a class definition");let e=yA.get(n);return e?(ga(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,yA.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dF{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}dF.type="NONE";const wA=dF;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sw(n,e,t){return`firebase:${n}:${e}:${t}`}class Bh{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Sw(this.userKey,s.apiKey,i),this.fullPersistenceKey=Sw("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ua._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Bh(ca(wA),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||ca(wA);const o=Sw(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){const d=ua._fromJSON(e,h);u!==i&&(a=d),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Bh(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Bh(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vA(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(gF(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(fF(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wF(e))return"Blackberry";if(vF(e))return"Webos";if(pF(e))return"Safari";if((e.includes("chrome/")||mF(e))&&!e.includes("edge/"))return"Chrome";if(yF(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function fF(n=Wr()){return/firefox\//i.test(n)}function pF(n=Wr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mF(n=Wr()){return/crios\//i.test(n)}function gF(n=Wr()){return/iemobile/i.test(n)}function yF(n=Wr()){return/android/i.test(n)}function wF(n=Wr()){return/blackberry/i.test(n)}function vF(n=Wr()){return/webos/i.test(n)}function H_(n=Wr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function uq(n=Wr()){var e;return H_(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function cq(){return TH()&&document.documentMode===10}function xF(n=Wr()){return H_(n)||yF(n)||vF(n)||wF(n)||/windows phone/i.test(n)||gF(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bF(n,e=[]){let t;switch(n){case"Browser":t=vA(Wr());break;case"Worker":t=`${vA(Wr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${wd}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hq{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dq(n,e={}){return Na(n,"GET","/v2/passwordPolicy",ql(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fq=6;class pq{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:fq,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mq{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xA(this),this.idTokenSubscription=new xA(this),this.beforeStateQueue=new hq(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=iF,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ca(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Bh.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cF(this,{idToken:e}),r=await ua._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ui(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return rt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await fv(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=K6()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ui(this.app))return Promise.reject(Io(this));const t=e?Yn(e):null;return t&&rt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&rt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ui(this.app)?Promise.reject(Io(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ui(this.app)?Promise.reject(Io(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ca(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await dq(this),t=new pq(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Mm("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await lq(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ca(e)||this._popupRedirectResolver;rt(t,this,"argument-error"),this.redirectPersistenceManager=await Bh.create(this,[ca(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(rt(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return rt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=bF(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&G6(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function _c(n){return Yn(n)}class xA{constructor(e){this.auth=e,this.observer=null,this.addObserver=AH(t=>this.observer=t)}get next(){return rt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gq(n){lx=n}function IF(n){return lx.loadJS(n)}function yq(){return lx.recaptchaEnterpriseScript}function wq(){return lx.gapiScript}function vq(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class xq{constructor(){this.enterprise=new bq}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class bq{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Iq="recaptcha-enterprise",SF="NO_RECAPTCHA";class Sq{constructor(e){this.type=Iq,this.auth=_c(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{eq(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new Z6(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;mA(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(SF)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new xq().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&mA(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=yq();l.length!==0&&(l+=a),IF(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function bA(n,e,t,r=!1,s=!1){const i=new Sq(n);let o;if(s)o=SF;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function wT(n,e,t,r,s){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await bA(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await bA(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tq(n,e){const t=B_(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(cv(i,e??{}))return s;qi(s,"already-initialized")}return t.initialize({options:e})}function _q(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ca);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Cq(n,e,t){const r=_c(n);rt(r._canInitEmulator,r,"emulator-config-failed"),rt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=TF(e),{host:o,port:a}=Eq(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),kq()}function TF(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Eq(n){const e=TF(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:IA(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:IA(o)}}}function IA(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function kq(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return la("not implemented")}_getIdTokenResponse(e){return la("not implemented")}_linkToIdToken(e,t){return la("not implemented")}_getReauthenticationResolver(e){return la("not implemented")}}async function Nq(n,e){return Na(n,"POST","/v1/accounts:update",e)}async function $q(n,e){return Na(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rq(n,e){return Bm(n,"POST","/v1/accounts:signInWithPassword",ql(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Aq(n,e){return Bm(n,"POST","/v1/accounts:signInWithEmailLink",ql(n,e))}async function Dq(n,e){return Bm(n,"POST","/v1/accounts:signInWithEmailLink",ql(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om extends q_{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new om(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new om(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wT(e,t,"signInWithPassword",Rq);case"emailLink":return Aq(e,{email:this._email,oobCode:this._password});default:qi(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wT(e,r,"signUpPassword",$q);case"emailLink":return Dq(e,{idToken:t,email:this._email,oobCode:this._password});default:qi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uh(n,e){return Bm(n,"POST","/v1/accounts:signInWithIdp",ql(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oq="http://localhost";class rc extends q_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new rc(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=U_(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new rc(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Uh(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Uh(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Uh(e,t)}buildRequest(){const e={requestUri:Oq,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Vm(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pq(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Fq(n){const e=Lp(Mp(n)).link,t=e?Lp(Mp(e)).deep_link_id:null,r=Lp(Mp(n)).deep_link_id;return(r?Lp(Mp(r)).link:null)||r||t||e||n}class K_{constructor(e){var t,r,s,i,o,a;const l=Lp(Mp(e)),u=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,d=Pq((s=l.mode)!==null&&s!==void 0?s:null);rt(u&&h&&d,"argument-error"),this.apiKey=u,this.operation=d,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=Fq(e);try{return new K_(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(){this.providerId=vd.PROVIDER_ID}static credential(e,t){return om._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=K_.parseLink(t);return rt(r,"argument-error"),om._fromEmailAndCode(e,r.code,r.tenantId)}}vd.PROVIDER_ID="password";vd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";vd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um extends _F{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl extends Um{constructor(){super("facebook.com")}static credential(e){return rc._fromParams({providerId:hl.PROVIDER_ID,signInMethod:hl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return hl.credentialFromTaggedObject(e)}static credentialFromError(e){return hl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return hl.credential(e.oauthAccessToken)}catch{return null}}}hl.FACEBOOK_SIGN_IN_METHOD="facebook.com";hl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl extends Um{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return rc._fromParams({providerId:dl.PROVIDER_ID,signInMethod:dl.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return dl.credentialFromTaggedObject(e)}static credentialFromError(e){return dl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return dl.credential(t,r)}catch{return null}}}dl.GOOGLE_SIGN_IN_METHOD="google.com";dl.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl extends Um{constructor(){super("github.com")}static credential(e){return rc._fromParams({providerId:fl.PROVIDER_ID,signInMethod:fl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fl.credentialFromTaggedObject(e)}static credentialFromError(e){return fl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fl.credential(e.oauthAccessToken)}catch{return null}}}fl.GITHUB_SIGN_IN_METHOD="github.com";fl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl extends Um{constructor(){super("twitter.com")}static credential(e,t){return rc._fromParams({providerId:pl.PROVIDER_ID,signInMethod:pl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return pl.credentialFromTaggedObject(e)}static credentialFromError(e){return pl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return pl.credential(t,r)}catch{return null}}}pl.TWITTER_SIGN_IN_METHOD="twitter.com";pl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lq(n,e){return Bm(n,"POST","/v1/accounts:signUp",ql(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ua._fromIdTokenResponse(e,r,s),o=SA(r);return new sc({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=SA(r);return new sc({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function SA(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv extends ka{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,pv.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new pv(e,t,r,s)}}function CF(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?pv._fromErrorAndOperation(n,i,e,r):i})}async function Mq(n,e,t=!1){const r=await Kh(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return sc._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vq(n,e,t=!1){const{auth:r}=n;if(Ui(r.app))return Promise.reject(Io(r));const s="reauthenticate";try{const i=await Kh(n,CF(r,s,e,n),t);rt(i.idToken,r,"internal-error");const o=G_(i.idToken);rt(o,r,"internal-error");const{sub:a}=o;return rt(n.uid===a,r,"user-mismatch"),sc._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&qi(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EF(n,e,t=!1){if(Ui(n.app))return Promise.reject(Io(n));const r="signIn",s=await CF(n,r,e),i=await sc._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function zq(n,e){return EF(_c(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kF(n){const e=_c(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Bq(n,e,t){if(Ui(n.app))return Promise.reject(Io(n));const r=_c(n),o=await wT(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Lq).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&kF(n),l}),a=await sc._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function Uq(n,e,t){return Ui(n.app)?Promise.reject(Io(n)):zq(Yn(n),vd.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kF(n),r})}function Wq(n,e){const t=Yn(n);return Ui(t.auth.app)?Promise.reject(Io(t.auth)):NF(t,e,null)}function jq(n,e){return NF(Yn(n),null,e)}async function NF(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Kh(n,Nq(r,i));await n._updateTokensIfNecessary(o,!0)}function Gq(n,e,t,r){return Yn(n).onIdTokenChanged(e,t,r)}function Hq(n,e,t){return Yn(n).beforeAuthStateChanged(e,t)}function qq(n,e,t,r){return Yn(n).onAuthStateChanged(e,t,r)}function $F(n){return Yn(n).signOut()}const mv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(mv,"1"),this.storage.removeItem(mv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kq=1e3,Xq=10;class AF extends RF{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xF(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);cq()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Xq):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Kq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}AF.type="LOCAL";const Qq=AF;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF extends RF{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}DF.type="SESSION";const OF=DF;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yq(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ux(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await Yq(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ux.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X_(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jq{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=X_("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(d){const p=d;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function So(){return window}function Zq(n){So().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PF(){return typeof So().WorkerGlobalScope<"u"&&typeof So().importScripts=="function"}async function e5(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function t5(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function n5(){return PF()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FF="firebaseLocalStorageDb",r5=1,gv="firebaseLocalStorage",LF="fbase_key";class Wm{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function cx(n,e){return n.transaction([gv],e?"readwrite":"readonly").objectStore(gv)}function s5(){const n=indexedDB.deleteDatabase(FF);return new Wm(n).toPromise()}function vT(){const n=indexedDB.open(FF,r5);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(gv,{keyPath:LF})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(gv)?e(r):(r.close(),await s5(),e(await vT()))})})}async function TA(n,e,t){const r=cx(n,!0).put({[LF]:e,value:t});return new Wm(r).toPromise()}async function i5(n,e){const t=cx(n,!1).get(e),r=await new Wm(t).toPromise();return r===void 0?null:r.value}function _A(n,e){const t=cx(n,!0).delete(e);return new Wm(t).toPromise()}const o5=800,a5=3;class MF{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await vT(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>a5)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return PF()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ux._getInstance(n5()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await e5(),!this.activeServiceWorker)return;this.sender=new Jq(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||t5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await vT();return await TA(e,mv,"1"),await _A(e,mv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>TA(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>i5(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>_A(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=cx(s,!1).getAll();return new Wm(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),o5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}MF.type="LOCAL";const l5=MF;new zm(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u5(n,e){return e?ca(e):(rt(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_ extends q_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Uh(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Uh(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Uh(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function c5(n){return EF(n.auth,new Q_(n),n.bypassAuthState)}function h5(n){const{auth:e,user:t}=n;return rt(t,e,"internal-error"),Vq(t,new Q_(n),n.bypassAuthState)}async function d5(n){const{auth:e,user:t}=n;return rt(t,e,"internal-error"),Mq(t,new Q_(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return c5;case"linkViaPopup":case"linkViaRedirect":return d5;case"reauthViaPopup":case"reauthViaRedirect":return h5;default:qi(this.auth,"internal-error")}}resolve(e){ga(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ga(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5=new zm(2e3,1e4);class Vh extends VF{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Vh.currentPopupAction&&Vh.currentPopupAction.cancel(),Vh.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return rt(e,this.auth,"internal-error"),e}async onExecution(){ga(this.filter.length===1,"Popup operations only handle one event");const e=X_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(bo(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(bo(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vh.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(bo(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,f5.get())};e()}}Vh.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5="pendingRedirect",Tw=new Map;class m5 extends VF{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Tw.get(this.auth._key());if(!e){try{const r=await g5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Tw.set(this.auth._key(),e)}return this.bypassAuthState||Tw.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function g5(n,e){const t=v5(e),r=w5(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function y5(n,e){Tw.set(n._key(),e)}function w5(n){return ca(n._redirectPersistence)}function v5(n){return Sw(p5,n.config.apiKey,n.name)}async function x5(n,e,t=!1){if(Ui(n.app))return Promise.reject(Io(n));const r=_c(n),s=u5(r,e),o=await new m5(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5=10*60*1e3;class I5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!S5(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!zF(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(bo(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=b5&&this.cachedEventUids.clear(),this.cachedEventUids.has(CA(e))}saveEventToCache(e){this.cachedEventUids.add(CA(e)),this.lastProcessedEventTime=Date.now()}}function CA(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function zF({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function S5(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return zF(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T5(n,e={}){return Na(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,C5=/^https?/;async function E5(n){if(n.config.emulator)return;const{authorizedDomains:e}=await T5(n);for(const t of e)try{if(k5(t))return}catch{}qi(n,"unauthorized-domain")}function k5(n){const e=gT(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!C5.test(t))return!1;if(_5.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N5=new zm(3e4,6e4);function EA(){const n=So().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function $5(n){return new Promise((e,t)=>{var r,s,i;function o(){EA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{EA(),t(bo(n,"network-request-failed"))},timeout:N5.get()})}if(!((s=(r=So().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=So().gapi)===null||i===void 0)&&i.load)o();else{const a=vq("iframefcb");return So()[a]=()=>{gapi.load?o():t(bo(n,"network-request-failed"))},IF(`${wq()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw _w=null,e})}let _w=null;function R5(n){return _w=_w||$5(n),_w}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A5=new zm(5e3,15e3),D5="__/auth/iframe",O5="emulator/auth/iframe",P5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},F5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function L5(n){const e=n.config;rt(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?j_(e,O5):`https://${n.config.authDomain}/${D5}`,r={apiKey:e.apiKey,appName:n.name,v:wd},s=F5.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Vm(r).slice(1)}`}async function M5(n){const e=await R5(n),t=So().gapi;return rt(t,n,"internal-error"),e.open({where:document.body,url:L5(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:P5,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=bo(n,"network-request-failed"),a=So().setTimeout(()=>{i(o)},A5.get());function l(){So().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},z5=500,B5=600,U5="_blank",W5="http://localhost";class kA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j5(n,e,t,r=z5,s=B5){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},V5),{width:r.toString(),height:s.toString(),top:i,left:o}),u=Wr().toLowerCase();t&&(a=mF(u)?U5:t),fF(u)&&(e=e||W5,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[m,y])=>`${p}${m}=${y},`,"");if(uq(u)&&a!=="_self")return G5(e||"",a),new kA(null);const d=window.open(e||"",a,h);rt(d,n,"popup-blocked");try{d.focus()}catch{}return new kA(d)}function G5(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H5="__/auth/handler",q5="emulator/auth/handler",K5=encodeURIComponent("fac");async function NA(n,e,t,r,s,i){rt(n.config.authDomain,n,"auth-domain-config-required"),rt(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:wd,eventId:s};if(e instanceof _F){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",RH(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof Um){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${K5}=${encodeURIComponent(l)}`:"";return`${X5(n)}?${Vm(a).slice(1)}${u}`}function X5({config:n}){return n.emulator?j_(n,q5):`https://${n.authDomain}/${H5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS="webStorageSupport";class Q5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=OF,this._completeRedirectFn=x5,this._overrideRedirectResult=y5}async _openPopup(e,t,r,s){var i;ga((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await NA(e,t,r,gT(),s);return j5(e,o,X_())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await NA(e,t,r,gT(),s);return Zq(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ga(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await M5(e),r=new I5(e);return t.register("authEvent",s=>(rt(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(LS,{type:LS},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[LS];o!==void 0&&t(!!o),qi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=E5(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xF()||pF()||H_()}}const Y5=Q5;var $A="@firebase/auth",RA="1.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){rt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z5(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function e9(n){qh(new nc("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;rt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bF(n)},u=new mq(r,s,i,l);return _q(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),qh(new nc("auth-internal",e=>{const t=_c(e.getProvider("auth").getImmediate());return(r=>new J5(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Il($A,RA,Z5(n)),Il($A,RA,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t9=5*60,n9=YP("authIdTokenMaxAge")||t9;let AA=null;const r9=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>n9)return;const s=t==null?void 0:t.token;AA!==s&&(AA=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function s9(n=tF()){const e=B_(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Tq(n,{popupRedirectResolver:Y5,persistence:[l5,Qq,OF]}),r=YP("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=r9(i.toString());Hq(t,o,()=>o(t.currentUser)),Gq(t,a=>o(a))}}const s=XP("auth");return s&&Cq(t,`http://${s}`),t}function i9(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}gq({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=bo("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",i9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});e9("Browser");var DA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Xu,BF;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,$){function N(){}N.prototype=$.prototype,k.D=$.prototype,k.prototype=new N,k.prototype.constructor=k,k.C=function(R,E,L){for(var F=Array(arguments.length-2),G=2;G<arguments.length;G++)F[G-2]=arguments[G];return $.prototype[E].apply(R,F)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,$,N){N||(N=0);var R=Array(16);if(typeof $=="string")for(var E=0;16>E;++E)R[E]=$.charCodeAt(N++)|$.charCodeAt(N++)<<8|$.charCodeAt(N++)<<16|$.charCodeAt(N++)<<24;else for(E=0;16>E;++E)R[E]=$[N++]|$[N++]<<8|$[N++]<<16|$[N++]<<24;$=k.g[0],N=k.g[1],E=k.g[2];var L=k.g[3],F=$+(L^N&(E^L))+R[0]+3614090360&4294967295;$=N+(F<<7&4294967295|F>>>25),F=L+(E^$&(N^E))+R[1]+3905402710&4294967295,L=$+(F<<12&4294967295|F>>>20),F=E+(N^L&($^N))+R[2]+606105819&4294967295,E=L+(F<<17&4294967295|F>>>15),F=N+($^E&(L^$))+R[3]+3250441966&4294967295,N=E+(F<<22&4294967295|F>>>10),F=$+(L^N&(E^L))+R[4]+4118548399&4294967295,$=N+(F<<7&4294967295|F>>>25),F=L+(E^$&(N^E))+R[5]+1200080426&4294967295,L=$+(F<<12&4294967295|F>>>20),F=E+(N^L&($^N))+R[6]+2821735955&4294967295,E=L+(F<<17&4294967295|F>>>15),F=N+($^E&(L^$))+R[7]+4249261313&4294967295,N=E+(F<<22&4294967295|F>>>10),F=$+(L^N&(E^L))+R[8]+1770035416&4294967295,$=N+(F<<7&4294967295|F>>>25),F=L+(E^$&(N^E))+R[9]+2336552879&4294967295,L=$+(F<<12&4294967295|F>>>20),F=E+(N^L&($^N))+R[10]+4294925233&4294967295,E=L+(F<<17&4294967295|F>>>15),F=N+($^E&(L^$))+R[11]+2304563134&4294967295,N=E+(F<<22&4294967295|F>>>10),F=$+(L^N&(E^L))+R[12]+1804603682&4294967295,$=N+(F<<7&4294967295|F>>>25),F=L+(E^$&(N^E))+R[13]+4254626195&4294967295,L=$+(F<<12&4294967295|F>>>20),F=E+(N^L&($^N))+R[14]+2792965006&4294967295,E=L+(F<<17&4294967295|F>>>15),F=N+($^E&(L^$))+R[15]+1236535329&4294967295,N=E+(F<<22&4294967295|F>>>10),F=$+(E^L&(N^E))+R[1]+4129170786&4294967295,$=N+(F<<5&4294967295|F>>>27),F=L+(N^E&($^N))+R[6]+3225465664&4294967295,L=$+(F<<9&4294967295|F>>>23),F=E+($^N&(L^$))+R[11]+643717713&4294967295,E=L+(F<<14&4294967295|F>>>18),F=N+(L^$&(E^L))+R[0]+3921069994&4294967295,N=E+(F<<20&4294967295|F>>>12),F=$+(E^L&(N^E))+R[5]+3593408605&4294967295,$=N+(F<<5&4294967295|F>>>27),F=L+(N^E&($^N))+R[10]+38016083&4294967295,L=$+(F<<9&4294967295|F>>>23),F=E+($^N&(L^$))+R[15]+3634488961&4294967295,E=L+(F<<14&4294967295|F>>>18),F=N+(L^$&(E^L))+R[4]+3889429448&4294967295,N=E+(F<<20&4294967295|F>>>12),F=$+(E^L&(N^E))+R[9]+568446438&4294967295,$=N+(F<<5&4294967295|F>>>27),F=L+(N^E&($^N))+R[14]+3275163606&4294967295,L=$+(F<<9&4294967295|F>>>23),F=E+($^N&(L^$))+R[3]+4107603335&4294967295,E=L+(F<<14&4294967295|F>>>18),F=N+(L^$&(E^L))+R[8]+1163531501&4294967295,N=E+(F<<20&4294967295|F>>>12),F=$+(E^L&(N^E))+R[13]+2850285829&4294967295,$=N+(F<<5&4294967295|F>>>27),F=L+(N^E&($^N))+R[2]+4243563512&4294967295,L=$+(F<<9&4294967295|F>>>23),F=E+($^N&(L^$))+R[7]+1735328473&4294967295,E=L+(F<<14&4294967295|F>>>18),F=N+(L^$&(E^L))+R[12]+2368359562&4294967295,N=E+(F<<20&4294967295|F>>>12),F=$+(N^E^L)+R[5]+4294588738&4294967295,$=N+(F<<4&4294967295|F>>>28),F=L+($^N^E)+R[8]+2272392833&4294967295,L=$+(F<<11&4294967295|F>>>21),F=E+(L^$^N)+R[11]+1839030562&4294967295,E=L+(F<<16&4294967295|F>>>16),F=N+(E^L^$)+R[14]+4259657740&4294967295,N=E+(F<<23&4294967295|F>>>9),F=$+(N^E^L)+R[1]+2763975236&4294967295,$=N+(F<<4&4294967295|F>>>28),F=L+($^N^E)+R[4]+1272893353&4294967295,L=$+(F<<11&4294967295|F>>>21),F=E+(L^$^N)+R[7]+4139469664&4294967295,E=L+(F<<16&4294967295|F>>>16),F=N+(E^L^$)+R[10]+3200236656&4294967295,N=E+(F<<23&4294967295|F>>>9),F=$+(N^E^L)+R[13]+681279174&4294967295,$=N+(F<<4&4294967295|F>>>28),F=L+($^N^E)+R[0]+3936430074&4294967295,L=$+(F<<11&4294967295|F>>>21),F=E+(L^$^N)+R[3]+3572445317&4294967295,E=L+(F<<16&4294967295|F>>>16),F=N+(E^L^$)+R[6]+76029189&4294967295,N=E+(F<<23&4294967295|F>>>9),F=$+(N^E^L)+R[9]+3654602809&4294967295,$=N+(F<<4&4294967295|F>>>28),F=L+($^N^E)+R[12]+3873151461&4294967295,L=$+(F<<11&4294967295|F>>>21),F=E+(L^$^N)+R[15]+530742520&4294967295,E=L+(F<<16&4294967295|F>>>16),F=N+(E^L^$)+R[2]+3299628645&4294967295,N=E+(F<<23&4294967295|F>>>9),F=$+(E^(N|~L))+R[0]+4096336452&4294967295,$=N+(F<<6&4294967295|F>>>26),F=L+(N^($|~E))+R[7]+1126891415&4294967295,L=$+(F<<10&4294967295|F>>>22),F=E+($^(L|~N))+R[14]+2878612391&4294967295,E=L+(F<<15&4294967295|F>>>17),F=N+(L^(E|~$))+R[5]+4237533241&4294967295,N=E+(F<<21&4294967295|F>>>11),F=$+(E^(N|~L))+R[12]+1700485571&4294967295,$=N+(F<<6&4294967295|F>>>26),F=L+(N^($|~E))+R[3]+2399980690&4294967295,L=$+(F<<10&4294967295|F>>>22),F=E+($^(L|~N))+R[10]+4293915773&4294967295,E=L+(F<<15&4294967295|F>>>17),F=N+(L^(E|~$))+R[1]+2240044497&4294967295,N=E+(F<<21&4294967295|F>>>11),F=$+(E^(N|~L))+R[8]+1873313359&4294967295,$=N+(F<<6&4294967295|F>>>26),F=L+(N^($|~E))+R[15]+4264355552&4294967295,L=$+(F<<10&4294967295|F>>>22),F=E+($^(L|~N))+R[6]+2734768916&4294967295,E=L+(F<<15&4294967295|F>>>17),F=N+(L^(E|~$))+R[13]+1309151649&4294967295,N=E+(F<<21&4294967295|F>>>11),F=$+(E^(N|~L))+R[4]+4149444226&4294967295,$=N+(F<<6&4294967295|F>>>26),F=L+(N^($|~E))+R[11]+3174756917&4294967295,L=$+(F<<10&4294967295|F>>>22),F=E+($^(L|~N))+R[2]+718787259&4294967295,E=L+(F<<15&4294967295|F>>>17),F=N+(L^(E|~$))+R[9]+3951481745&4294967295,k.g[0]=k.g[0]+$&4294967295,k.g[1]=k.g[1]+(E+(F<<21&4294967295|F>>>11))&4294967295,k.g[2]=k.g[2]+E&4294967295,k.g[3]=k.g[3]+L&4294967295}r.prototype.u=function(k,$){$===void 0&&($=k.length);for(var N=$-this.blockSize,R=this.B,E=this.h,L=0;L<$;){if(E==0)for(;L<=N;)s(this,k,L),L+=this.blockSize;if(typeof k=="string"){for(;L<$;)if(R[E++]=k.charCodeAt(L++),E==this.blockSize){s(this,R),E=0;break}}else for(;L<$;)if(R[E++]=k[L++],E==this.blockSize){s(this,R),E=0;break}}this.h=E,this.o+=$},r.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var $=1;$<k.length-8;++$)k[$]=0;var N=8*this.o;for($=k.length-8;$<k.length;++$)k[$]=N&255,N/=256;for(this.u(k),k=Array(16),$=N=0;4>$;++$)for(var R=0;32>R;R+=8)k[N++]=this.g[$]>>>R&255;return k};function i(k,$){var N=a;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=$(k)}function o(k,$){this.h=$;for(var N=[],R=!0,E=k.length-1;0<=E;E--){var L=k[E]|0;R&&L==$||(N[E]=L,R=!1)}this.g=N}var a={};function l(k){return-128<=k&&128>k?i(k,function($){return new o([$|0],0>$?-1:0)}):new o([k|0],0>k?-1:0)}function u(k){if(isNaN(k)||!isFinite(k))return d;if(0>k)return w(u(-k));for(var $=[],N=1,R=0;k>=N;R++)$[R]=k/N|0,N*=4294967296;return new o($,0)}function h(k,$){if(k.length==0)throw Error("number format error: empty string");if($=$||10,2>$||36<$)throw Error("radix out of range: "+$);if(k.charAt(0)=="-")return w(h(k.substring(1),$));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=u(Math.pow($,8)),R=d,E=0;E<k.length;E+=8){var L=Math.min(8,k.length-E),F=parseInt(k.substring(E,E+L),$);8>L?(L=u(Math.pow($,L)),R=R.j(L).add(u(F))):(R=R.j(N),R=R.add(u(F)))}return R}var d=l(0),p=l(1),m=l(16777216);n=o.prototype,n.m=function(){if(v(this))return-w(this).m();for(var k=0,$=1,N=0;N<this.g.length;N++){var R=this.i(N);k+=(0<=R?R:4294967296+R)*$,$*=4294967296}return k},n.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if(y(this))return"0";if(v(this))return"-"+w(this).toString(k);for(var $=u(Math.pow(k,6)),N=this,R="";;){var E=T(N,$).g;N=b(N,E.j($));var L=((0<N.g.length?N.g[0]:N.h)>>>0).toString(k);if(N=E,y(N))return L+R;for(;6>L.length;)L="0"+L;R=L+R}},n.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function y(k){if(k.h!=0)return!1;for(var $=0;$<k.g.length;$++)if(k.g[$]!=0)return!1;return!0}function v(k){return k.h==-1}n.l=function(k){return k=b(this,k),v(k)?-1:y(k)?0:1};function w(k){for(var $=k.g.length,N=[],R=0;R<$;R++)N[R]=~k.g[R];return new o(N,~k.h).add(p)}n.abs=function(){return v(this)?w(this):this},n.add=function(k){for(var $=Math.max(this.g.length,k.g.length),N=[],R=0,E=0;E<=$;E++){var L=R+(this.i(E)&65535)+(k.i(E)&65535),F=(L>>>16)+(this.i(E)>>>16)+(k.i(E)>>>16);R=F>>>16,L&=65535,F&=65535,N[E]=F<<16|L}return new o(N,N[N.length-1]&-2147483648?-1:0)};function b(k,$){return k.add(w($))}n.j=function(k){if(y(this)||y(k))return d;if(v(this))return v(k)?w(this).j(w(k)):w(w(this).j(k));if(v(k))return w(this.j(w(k)));if(0>this.l(m)&&0>k.l(m))return u(this.m()*k.m());for(var $=this.g.length+k.g.length,N=[],R=0;R<2*$;R++)N[R]=0;for(R=0;R<this.g.length;R++)for(var E=0;E<k.g.length;E++){var L=this.i(R)>>>16,F=this.i(R)&65535,G=k.i(E)>>>16,Y=k.i(E)&65535;N[2*R+2*E]+=F*Y,S(N,2*R+2*E),N[2*R+2*E+1]+=L*Y,S(N,2*R+2*E+1),N[2*R+2*E+1]+=F*G,S(N,2*R+2*E+1),N[2*R+2*E+2]+=L*G,S(N,2*R+2*E+2)}for(R=0;R<$;R++)N[R]=N[2*R+1]<<16|N[2*R];for(R=$;R<2*$;R++)N[R]=0;return new o(N,0)};function S(k,$){for(;(k[$]&65535)!=k[$];)k[$+1]+=k[$]>>>16,k[$]&=65535,$++}function C(k,$){this.g=k,this.h=$}function T(k,$){if(y($))throw Error("division by zero");if(y(k))return new C(d,d);if(v(k))return $=T(w(k),$),new C(w($.g),w($.h));if(v($))return $=T(k,w($)),new C(w($.g),$.h);if(30<k.g.length){if(v(k)||v($))throw Error("slowDivide_ only works with positive integers.");for(var N=p,R=$;0>=R.l(k);)N=O(N),R=O(R);var E=V(N,1),L=V(R,1);for(R=V(R,2),N=V(N,2);!y(R);){var F=L.add(R);0>=F.l(k)&&(E=E.add(N),L=F),R=V(R,1),N=V(N,1)}return $=b(k,E.j($)),new C(E,$)}for(E=d;0<=k.l($);){for(N=Math.max(1,Math.floor(k.m()/$.m())),R=Math.ceil(Math.log(N)/Math.LN2),R=48>=R?1:Math.pow(2,R-48),L=u(N),F=L.j($);v(F)||0<F.l(k);)N-=R,L=u(N),F=L.j($);y(L)&&(L=p),E=E.add(L),k=b(k,F)}return new C(E,k)}n.A=function(k){return T(this,k).h},n.and=function(k){for(var $=Math.max(this.g.length,k.g.length),N=[],R=0;R<$;R++)N[R]=this.i(R)&k.i(R);return new o(N,this.h&k.h)},n.or=function(k){for(var $=Math.max(this.g.length,k.g.length),N=[],R=0;R<$;R++)N[R]=this.i(R)|k.i(R);return new o(N,this.h|k.h)},n.xor=function(k){for(var $=Math.max(this.g.length,k.g.length),N=[],R=0;R<$;R++)N[R]=this.i(R)^k.i(R);return new o(N,this.h^k.h)};function O(k){for(var $=k.g.length+1,N=[],R=0;R<$;R++)N[R]=k.i(R)<<1|k.i(R-1)>>>31;return new o(N,k.h)}function V(k,$){var N=$>>5;$%=32;for(var R=k.g.length-N,E=[],L=0;L<R;L++)E[L]=0<$?k.i(L+N)>>>$|k.i(L+N+1)<<32-$:k.i(L+N);return new o(E,k.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,BF=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Xu=o}).apply(typeof DA<"u"?DA:typeof self<"u"?self:typeof window<"u"?window:{});var ew=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var UF,Vp,WF,Cw,xT,jF,GF,HF;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,A,M){return x==Array.prototype||x==Object.prototype||(x[A]=M.value),x};function t(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof ew=="object"&&ew];for(var A=0;A<x.length;++A){var M=x[A];if(M&&M.Math==Math)return M}throw Error("Cannot find global object")}var r=t(this);function s(x,A){if(A)e:{var M=r;x=x.split(".");for(var W=0;W<x.length-1;W++){var ue=x[W];if(!(ue in M))break e;M=M[ue]}x=x[x.length-1],W=M[x],A=A(W),A!=W&&A!=null&&e(M,x,{configurable:!0,writable:!0,value:A})}}function i(x,A){x instanceof String&&(x+="");var M=0,W=!1,ue={next:function(){if(!W&&M<x.length){var ge=M++;return{value:A(ge,x[ge]),done:!1}}return W=!0,{done:!0,value:void 0}}};return ue[Symbol.iterator]=function(){return ue},ue}s("Array.prototype.values",function(x){return x||function(){return i(this,function(A,M){return M})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(x){var A=typeof x;return A=A!="object"?A:x?Array.isArray(x)?"array":A:"null",A=="array"||A=="object"&&typeof x.length=="number"}function u(x){var A=typeof x;return A=="object"&&x!=null||A=="function"}function h(x,A,M){return x.call.apply(x.bind,arguments)}function d(x,A,M){if(!x)throw Error();if(2<arguments.length){var W=Array.prototype.slice.call(arguments,2);return function(){var ue=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ue,W),x.apply(A,ue)}}return function(){return x.apply(A,arguments)}}function p(x,A,M){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:d,p.apply(null,arguments)}function m(x,A){var M=Array.prototype.slice.call(arguments,1);return function(){var W=M.slice();return W.push.apply(W,arguments),x.apply(this,W)}}function y(x,A){function M(){}M.prototype=A.prototype,x.aa=A.prototype,x.prototype=new M,x.prototype.constructor=x,x.Qb=function(W,ue,ge){for(var De=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)De[Bt-2]=arguments[Bt];return A.prototype[ue].apply(W,De)}}function v(x){const A=x.length;if(0<A){const M=Array(A);for(let W=0;W<A;W++)M[W]=x[W];return M}return[]}function w(x,A){for(let M=1;M<arguments.length;M++){const W=arguments[M];if(l(W)){const ue=x.length||0,ge=W.length||0;x.length=ue+ge;for(let De=0;De<ge;De++)x[ue+De]=W[De]}else x.push(W)}}class b{constructor(A,M){this.i=A,this.j=M,this.h=0,this.g=null}get(){let A;return 0<this.h?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function S(x){return/^[\s\xa0]*$/.test(x)}function C(){var x=a.navigator;return x&&(x=x.userAgent)?x:""}function T(x){return T[" "](x),x}T[" "]=function(){};var O=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function V(x,A,M){for(const W in x)A.call(M,x[W],W,x)}function k(x,A){for(const M in x)A.call(void 0,x[M],M,x)}function $(x){const A={};for(const M in x)A[M]=x[M];return A}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(x,A){let M,W;for(let ue=1;ue<arguments.length;ue++){W=arguments[ue];for(M in W)x[M]=W[M];for(let ge=0;ge<N.length;ge++)M=N[ge],Object.prototype.hasOwnProperty.call(W,M)&&(x[M]=W[M])}}function E(x){var A=1;x=x.split(":");const M=[];for(;0<A&&x.length;)M.push(x.shift()),A--;return x.length&&M.push(x.join(":")),M}function L(x){a.setTimeout(()=>{throw x},0)}function F(){var x=re;let A=null;return x.g&&(A=x.g,x.g=x.g.next,x.g||(x.h=null),A.next=null),A}class G{constructor(){this.h=this.g=null}add(A,M){const W=Y.get();W.set(A,M),this.h?this.h.next=W:this.g=W,this.h=W}}var Y=new b(()=>new q,x=>x.reset());class q{constructor(){this.next=this.g=this.h=null}set(A,M){this.h=A,this.g=M,this.next=null}reset(){this.next=this.g=this.h=null}}let se,X=!1,re=new G,ie=()=>{const x=a.Promise.resolve(void 0);se=()=>{x.then(j)}};var j=()=>{for(var x;x=F();){try{x.h.call(x.g)}catch(M){L(M)}var A=Y;A.j(x),100>A.h&&(A.h++,x.next=A.g,A.g=x)}X=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function he(x,A){this.type=x,this.g=this.target=A,this.defaultPrevented=!1}he.prototype.h=function(){this.defaultPrevented=!0};var ve=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var x=!1,A=Object.defineProperty({},"passive",{get:function(){x=!0}});try{const M=()=>{};a.addEventListener("test",M,A),a.removeEventListener("test",M,A)}catch{}return x}();function we(x,A){if(he.call(this,x?x.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,x){var M=this.type=x.type,W=x.changedTouches&&x.changedTouches.length?x.changedTouches[0]:null;if(this.target=x.target||x.srcElement,this.g=A,A=x.relatedTarget){if(O){e:{try{T(A.nodeName);var ue=!0;break e}catch{}ue=!1}ue||(A=null)}}else M=="mouseover"?A=x.fromElement:M=="mouseout"&&(A=x.toElement);this.relatedTarget=A,W?(this.clientX=W.clientX!==void 0?W.clientX:W.pageX,this.clientY=W.clientY!==void 0?W.clientY:W.pageY,this.screenX=W.screenX||0,this.screenY=W.screenY||0):(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0),this.button=x.button,this.key=x.key||"",this.ctrlKey=x.ctrlKey,this.altKey=x.altKey,this.shiftKey=x.shiftKey,this.metaKey=x.metaKey,this.pointerId=x.pointerId||0,this.pointerType=typeof x.pointerType=="string"?x.pointerType:Se[x.pointerType]||"",this.state=x.state,this.i=x,x.defaultPrevented&&we.aa.h.call(this)}}y(we,he);var Se={2:"touch",3:"pen",4:"mouse"};we.prototype.h=function(){we.aa.h.call(this);var x=this.i;x.preventDefault?x.preventDefault():x.returnValue=!1};var Ne="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function Pe(x,A,M,W,ue){this.listener=x,this.proxy=null,this.src=A,this.type=M,this.capture=!!W,this.ha=ue,this.key=++Ae,this.da=this.fa=!1}function qe(x){x.da=!0,x.listener=null,x.proxy=null,x.src=null,x.ha=null}function tt(x){this.src=x,this.g={},this.h=0}tt.prototype.add=function(x,A,M,W,ue){var ge=x.toString();x=this.g[ge],x||(x=this.g[ge]=[],this.h++);var De=bt(x,A,W,ue);return-1<De?(A=x[De],M||(A.fa=!1)):(A=new Pe(A,this.src,ge,!!W,ue),A.fa=M,x.push(A)),A};function wt(x,A){var M=A.type;if(M in x.g){var W=x.g[M],ue=Array.prototype.indexOf.call(W,A,void 0),ge;(ge=0<=ue)&&Array.prototype.splice.call(W,ue,1),ge&&(qe(A),x.g[M].length==0&&(delete x.g[M],x.h--))}}function bt(x,A,M,W){for(var ue=0;ue<x.length;++ue){var ge=x[ue];if(!ge.da&&ge.listener==A&&ge.capture==!!M&&ge.ha==W)return ue}return-1}var Pt="closure_lm_"+(1e6*Math.random()|0),Nt={};function Tt(x,A,M,W,ue){if(Array.isArray(A)){for(var ge=0;ge<A.length;ge++)Tt(x,A[ge],M,W,ue);return null}return M=Xr(M),x&&x[Ne]?x.K(A,M,u(W)?!!W.capture:!!W,ue):Ft(x,A,M,!1,W,ue)}function Ft(x,A,M,W,ue,ge){if(!A)throw Error("Invalid event type");var De=u(ue)?!!ue.capture:!!ue,Bt=us(x);if(Bt||(x[Pt]=Bt=new tt(x)),M=Bt.add(A,M,W,De,ge),M.proxy)return M;if(W=Lt(),M.proxy=W,W.src=x,W.listener=M,x.addEventListener)ve||(ue=De),ue===void 0&&(ue=!1),x.addEventListener(A.toString(),W,ue);else if(x.attachEvent)x.attachEvent(rr(A.toString()),W);else if(x.addListener&&x.removeListener)x.addListener(W);else throw Error("addEventListener and attachEvent are unavailable.");return M}function Lt(){function x(M){return A.call(x.src,x.listener,M)}const A=Bn;return x}function Rr(x,A,M,W,ue){if(Array.isArray(A))for(var ge=0;ge<A.length;ge++)Rr(x,A[ge],M,W,ue);else W=u(W)?!!W.capture:!!W,M=Xr(M),x&&x[Ne]?(x=x.i,A=String(A).toString(),A in x.g&&(ge=x.g[A],M=bt(ge,M,W,ue),-1<M&&(qe(ge[M]),Array.prototype.splice.call(ge,M,1),ge.length==0&&(delete x.g[A],x.h--)))):x&&(x=us(x))&&(A=x.g[A.toString()],x=-1,A&&(x=bt(A,M,W,ue)),(M=-1<x?A[x]:null)&&jt(M))}function jt(x){if(typeof x!="number"&&x&&!x.da){var A=x.src;if(A&&A[Ne])wt(A.i,x);else{var M=x.type,W=x.proxy;A.removeEventListener?A.removeEventListener(M,W,x.capture):A.detachEvent?A.detachEvent(rr(M),W):A.addListener&&A.removeListener&&A.removeListener(W),(M=us(A))?(wt(M,x),M.h==0&&(M.src=null,A[Pt]=null)):qe(x)}}}function rr(x){return x in Nt?Nt[x]:Nt[x]="on"+x}function Bn(x,A){if(x.da)x=!0;else{A=new we(A,this);var M=x.listener,W=x.ha||x.src;x.fa&&jt(x),x=M.call(W,A)}return x}function us(x){return x=x[Pt],x instanceof tt?x:null}var sr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xr(x){return typeof x=="function"?x:(x[sr]||(x[sr]=function(A){return x.handleEvent(A)}),x[sr])}function Gt(){Z.call(this),this.i=new tt(this),this.M=this,this.F=null}y(Gt,Z),Gt.prototype[Ne]=!0,Gt.prototype.removeEventListener=function(x,A,M,W){Rr(this,x,A,M,W)};function Ht(x,A){var M,W=x.F;if(W)for(M=[];W;W=W.F)M.push(W);if(x=x.M,W=A.type||A,typeof A=="string")A=new he(A,x);else if(A instanceof he)A.target=A.target||x;else{var ue=A;A=new he(W,x),R(A,ue)}if(ue=!0,M)for(var ge=M.length-1;0<=ge;ge--){var De=A.g=M[ge];ue=ir(De,W,!0,A)&&ue}if(De=A.g=x,ue=ir(De,W,!0,A)&&ue,ue=ir(De,W,!1,A)&&ue,M)for(ge=0;ge<M.length;ge++)De=A.g=M[ge],ue=ir(De,W,!1,A)&&ue}Gt.prototype.N=function(){if(Gt.aa.N.call(this),this.i){var x=this.i,A;for(A in x.g){for(var M=x.g[A],W=0;W<M.length;W++)qe(M[W]);delete x.g[A],x.h--}}this.F=null},Gt.prototype.K=function(x,A,M,W){return this.i.add(String(x),A,!1,M,W)},Gt.prototype.L=function(x,A,M,W){return this.i.add(String(x),A,!0,M,W)};function ir(x,A,M,W){if(A=x.i.g[String(A)],!A)return!0;A=A.concat();for(var ue=!0,ge=0;ge<A.length;++ge){var De=A[ge];if(De&&!De.da&&De.capture==M){var Bt=De.listener,Un=De.ha||De.src;De.fa&&wt(x.i,De),ue=Bt.call(Un,W)!==!1&&ue}}return ue&&!W.defaultPrevented}function wi(x,A,M){if(typeof x=="function")M&&(x=p(x,M));else if(x&&typeof x.handleEvent=="function")x=p(x.handleEvent,x);else throw Error("Invalid listener argument");return 2147483647<Number(A)?-1:a.setTimeout(x,A||0)}function Js(x){x.g=wi(()=>{x.g=null,x.i&&(x.i=!1,Js(x))},x.l);const A=x.h;x.h=null,x.m.apply(null,A)}class vi extends Z{constructor(A,M){super(),this.m=A,this.l=M,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Js(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Uo(x){Z.call(this),this.h=x,this.g={}}y(Uo,Z);var no=[];function ou(x){V(x.g,function(A,M){this.g.hasOwnProperty(M)&&jt(A)},x),x.g={}}Uo.prototype.N=function(){Uo.aa.N.call(this),ou(this)},Uo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var au=a.JSON.stringify,Uf=a.JSON.parse,Wf=class{stringify(x){return a.JSON.stringify(x,void 0)}parse(x){return a.JSON.parse(x,void 0)}};function lu(){}lu.prototype.h=null;function Wc(x){return x.h||(x.h=x.i())}function jc(){}var Zs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ro(){he.call(this,"d")}y(ro,he);function Gc(){he.call(this,"c")}y(Gc,he);var so={},jf=null;function uu(){return jf=jf||new Gt}so.La="serverreachability";function Gf(x){he.call(this,so.La,x)}y(Gf,he);function Wo(x){const A=uu();Ht(A,new Gf(A))}so.STAT_EVENT="statevent";function Hf(x,A){he.call(this,so.STAT_EVENT,x),this.stat=A}y(Hf,he);function Tn(x){const A=uu();Ht(A,new Hf(A,x))}so.Ma="timingevent";function Hc(x,A){he.call(this,so.Ma,x),this.size=A}y(Hc,he);function xi(x,A){if(typeof x!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){x()},A)}function cu(){this.g=!0}cu.prototype.xa=function(){this.g=!1};function hu(x,A,M,W,ue,ge){x.info(function(){if(x.g)if(ge)for(var De="",Bt=ge.split("&"),Un=0;Un<Bt.length;Un++){var $t=Bt[Un].split("=");if(1<$t.length){var or=$t[0];$t=$t[1];var An=or.split("_");De=2<=An.length&&An[1]=="type"?De+(or+"="+$t+"&"):De+(or+"=redacted&")}}else De=null;else De=ge;return"XMLHTTP REQ ("+W+") [attempt "+ue+"]: "+A+`
`+M+`
`+De})}function qc(x,A,M,W,ue,ge,De){x.info(function(){return"XMLHTTP RESP ("+W+") [ attempt "+ue+"]: "+A+`
`+M+`
`+ge+" "+De})}function bi(x,A,M,W){x.info(function(){return"XMLHTTP TEXT ("+A+"): "+J1(x,M)+(W?" "+W:"")})}function qf(x,A){x.info(function(){return"TIMEOUT: "+A})}cu.prototype.info=function(){};function J1(x,A){if(!x.g)return A;if(!A)return null;try{var M=JSON.parse(A);if(M){for(x=0;x<M.length;x++)if(Array.isArray(M[x])){var W=M[x];if(!(2>W.length)){var ue=W[1];if(Array.isArray(ue)&&!(1>ue.length)){var ge=ue[0];if(ge!="noop"&&ge!="stop"&&ge!="close")for(var De=1;De<ue.length;De++)ue[De]=""}}}}return au(M)}catch{return A}}var Kc={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ly={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ii;function du(){}y(du,lu),du.prototype.g=function(){return new XMLHttpRequest},du.prototype.i=function(){return{}},Ii=new du;function Si(x,A,M,W){this.j=x,this.i=A,this.l=M,this.R=W||1,this.U=new Uo(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new My}function My(){this.i=null,this.g="",this.h=!1}var Kf={},Xc={};function Qc(x,A,M){x.L=1,x.v=Wa(Ds(A)),x.m=M,x.P=!0,Xf(x,null)}function Xf(x,A){x.F=Date.now(),Jt(x),x.A=Ds(x.v);var M=x.A,W=x.R;Array.isArray(W)||(W=[String(W)]),Ga(M.i,"t",W),x.C=0,M=x.j.J,x.h=new My,x.g=n0(x.j,M?A:null,!x.m),0<x.O&&(x.M=new vi(p(x.Y,x,x.g),x.O)),A=x.U,M=x.g,W=x.ca;var ue="readystatechange";Array.isArray(ue)||(ue&&(no[0]=ue.toString()),ue=no);for(var ge=0;ge<ue.length;ge++){var De=Tt(M,ue[ge],W||A.handleEvent,!1,A.h||A);if(!De)break;A.g[De.key]=De}A=x.H?$(x.H):{},x.m?(x.u||(x.u="POST"),A["Content-Type"]="application/x-www-form-urlencoded",x.g.ea(x.A,x.u,x.m,A)):(x.u="GET",x.g.ea(x.A,x.u,null,A)),Wo(),hu(x.i,x.u,x.A,x.l,x.R,x.m)}Si.prototype.ca=function(x){x=x.target;const A=this.M;A&&hs(x)==3?A.j():this.Y(x)},Si.prototype.Y=function(x){try{if(x==this.g)e:{const An=hs(this.g);var A=this.g.Ba();const ni=this.g.Z();if(!(3>An)&&(An!=3||this.g&&(this.h.h||this.g.oa()||tp(this.g)))){this.J||An!=4||A==7||(A==8||0>=ni?Wo(3):Wo(2)),fu(this);var M=this.g.Z();this.X=M;t:if(Vy(this)){var W=tp(this.g);x="";var ue=W.length,ge=hs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ei(this),Va(this);var De="";break t}this.h.i=new a.TextDecoder}for(A=0;A<ue;A++)this.h.h=!0,x+=this.h.i.decode(W[A],{stream:!(ge&&A==ue-1)});W.length=0,this.h.g+=x,this.C=0,De=this.h.g}else De=this.g.oa();if(this.o=M==200,qc(this.i,this.u,this.A,this.l,this.R,An,M),this.o){if(this.T&&!this.K){t:{if(this.g){var Bt,Un=this.g;if((Bt=Un.g?Un.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(Bt)){var $t=Bt;break t}}$t=null}if(M=$t)bi(this.i,this.l,M,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qf(this,M);else{this.o=!1,this.s=3,Tn(12),ei(this),Va(this);break e}}if(this.P){M=!0;let Ps;for(;!this.J&&this.C<De.length;)if(Ps=Z1(this,De),Ps==Xc){An==4&&(this.s=4,Tn(14),M=!1),bi(this.i,this.l,null,"[Incomplete Response]");break}else if(Ps==Kf){this.s=4,Tn(15),bi(this.i,this.l,De,"[Invalid Chunk]"),M=!1;break}else bi(this.i,this.l,Ps,null),Qf(this,Ps);if(Vy(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),An!=4||De.length!=0||this.h.h||(this.s=1,Tn(16),M=!1),this.o=this.o&&M,!M)bi(this.i,this.l,De,"[Invalid Chunked Response]"),ei(this),Va(this);else if(0<De.length&&!this.W){this.W=!0;var or=this.j;or.g==this&&or.ba&&!or.M&&(or.j.info("Great, no buffering proxy detected. Bytes received: "+De.length),rp(or),or.M=!0,Tn(11))}}else bi(this.i,this.l,De,null),Qf(this,De);An==4&&ei(this),this.o&&!this.J&&(An==4?ah(this.j,this):(this.o=!1,Jt(this)))}else nh(this.g),M==400&&0<De.indexOf("Unknown SID")?(this.s=3,Tn(12)):(this.s=0,Tn(13)),ei(this),Va(this)}}}catch{}finally{}};function Vy(x){return x.g?x.u=="GET"&&x.L!=2&&x.j.Ca:!1}function Z1(x,A){var M=x.C,W=A.indexOf(`
`,M);return W==-1?Xc:(M=Number(A.substring(M,W)),isNaN(M)?Kf:(W+=1,W+M>A.length?Xc:(A=A.slice(W,W+M),x.C=W+M,A)))}Si.prototype.cancel=function(){this.J=!0,ei(this)};function Jt(x){x.S=Date.now()+x.I,zy(x,x.I)}function zy(x,A){if(x.B!=null)throw Error("WatchDog timer not null");x.B=xi(p(x.ba,x),A)}function fu(x){x.B&&(a.clearTimeout(x.B),x.B=null)}Si.prototype.ba=function(){this.B=null;const x=Date.now();0<=x-this.S?(qf(this.i,this.A),this.L!=2&&(Wo(),Tn(17)),ei(this),this.s=2,Va(this)):zy(this,this.S-x)};function Va(x){x.j.G==0||x.J||ah(x.j,x)}function ei(x){fu(x);var A=x.M;A&&typeof A.ma=="function"&&A.ma(),x.M=null,ou(x.U),x.g&&(A=x.g,x.g=null,A.abort(),A.ma())}function Qf(x,A){try{var M=x.j;if(M.G!=0&&(M.g==x||Qr(M.h,x))){if(!x.K&&Qr(M.h,x)&&M.G==3){try{var W=M.Da.g.parse(A)}catch{W=null}if(Array.isArray(W)&&W.length==3){var ue=W;if(ue[0]==0){e:if(!M.u){if(M.g)if(M.g.F+3e3<x.F)oh(M),ki(M);else break e;ih(M),Tn(18)}}else M.za=ue[1],0<M.za-M.T&&37500>ue[2]&&M.F&&M.v==0&&!M.C&&(M.C=xi(p(M.Za,M),6e3));if(1>=Uy(M.h)&&M.ca){try{M.ca()}catch{}M.ca=void 0}}else Ko(M,11)}else if((x.K||M.g==x)&&oh(M),!S(A))for(ue=M.Da.g.parse(A),A=0;A<ue.length;A++){let $t=ue[A];if(M.T=$t[0],$t=$t[1],M.G==2)if($t[0]=="c"){M.K=$t[1],M.ia=$t[2];const or=$t[3];or!=null&&(M.la=or,M.j.info("VER="+M.la));const An=$t[4];An!=null&&(M.Aa=An,M.j.info("SVER="+M.Aa));const ni=$t[5];ni!=null&&typeof ni=="number"&&0<ni&&(W=1.5*ni,M.L=W,M.j.info("backChannelRequestTimeoutMs_="+W)),W=M;const Ps=x.g;if(Ps){const xu=Ps.g?Ps.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xu){var ge=W.h;ge.g||xu.indexOf("spdy")==-1&&xu.indexOf("quic")==-1&&xu.indexOf("h2")==-1||(ge.j=ge.l,ge.g=new Set,ge.h&&(Yf(ge,ge.h),ge.h=null))}if(W.D){const uh=Ps.g?Ps.g.getResponseHeader("X-HTTP-Session-Id"):null;uh&&(W.ya=uh,Kt(W.I,W.D,uh))}}M.G=3,M.l&&M.l.ua(),M.ba&&(M.R=Date.now()-x.F,M.j.info("Handshake RTT: "+M.R+"ms")),W=M;var De=x;if(W.qa=t0(W,W.J?W.ia:null,W.W),De.K){Wy(W.h,De);var Bt=De,Un=W.L;Un&&(Bt.I=Un),Bt.B&&(fu(Bt),Jt(Bt)),W.g=De}else vu(W);0<M.i.length&&lo(M)}else $t[0]!="stop"&&$t[0]!="close"||Ko(M,7);else M.G==3&&($t[0]=="stop"||$t[0]=="close"?$t[0]=="stop"?Ko(M,7):Sr(M):$t[0]!="noop"&&M.l&&M.l.ta($t),M.v=0)}}Wo(4)}catch{}}var By=class{constructor(x,A){this.g=x,this.map=A}};function pu(x){this.l=x||10,a.PerformanceNavigationTiming?(x=a.performance.getEntriesByType("navigation"),x=0<x.length&&(x[0].nextHopProtocol=="hq"||x[0].nextHopProtocol=="h2")):x=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=x?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function As(x){return x.h?!0:x.g?x.g.size>=x.j:!1}function Uy(x){return x.h?1:x.g?x.g.size:0}function Qr(x,A){return x.h?x.h==A:x.g?x.g.has(A):!1}function Yf(x,A){x.g?x.g.add(A):x.h=A}function Wy(x,A){x.h&&x.h==A?x.h=null:x.g&&x.g.has(A)&&x.g.delete(A)}pu.prototype.cancel=function(){if(this.i=jy(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const x of this.g.values())x.cancel();this.g.clear()}};function jy(x){if(x.h!=null)return x.i.concat(x.h.D);if(x.g!=null&&x.g.size!==0){let A=x.i;for(const M of x.g.values())A=A.concat(M.D);return A}return v(x.i)}function Yc(x){if(x.V&&typeof x.V=="function")return x.V();if(typeof Map<"u"&&x instanceof Map||typeof Set<"u"&&x instanceof Set)return Array.from(x.values());if(typeof x=="string")return x.split("");if(l(x)){for(var A=[],M=x.length,W=0;W<M;W++)A.push(x[W]);return A}A=[],M=0;for(W in x)A[M++]=x[W];return A}function Jc(x){if(x.na&&typeof x.na=="function")return x.na();if(!x.V||typeof x.V!="function"){if(typeof Map<"u"&&x instanceof Map)return Array.from(x.keys());if(!(typeof Set<"u"&&x instanceof Set)){if(l(x)||typeof x=="string"){var A=[];x=x.length;for(var M=0;M<x;M++)A.push(M);return A}A=[],M=0;for(const W in x)A[M++]=W;return A}}}function za(x,A){if(x.forEach&&typeof x.forEach=="function")x.forEach(A,void 0);else if(l(x)||typeof x=="string")Array.prototype.forEach.call(x,A,void 0);else for(var M=Jc(x),W=Yc(x),ue=W.length,ge=0;ge<ue;ge++)A.call(void 0,W[ge],M&&M[ge],x)}var mu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eI(x,A){if(x){x=x.split("&");for(var M=0;M<x.length;M++){var W=x[M].indexOf("="),ue=null;if(0<=W){var ge=x[M].substring(0,W);ue=x[M].substring(W+1)}else ge=x[M];A(ge,ue?decodeURIComponent(ue.replace(/\+/g," ")):"")}}}function jo(x){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,x instanceof jo){this.h=x.h,gu(this,x.j),this.o=x.o,this.g=x.g,Ba(this,x.s),this.l=x.l;var A=x.i,M=new io;M.i=A.i,A.g&&(M.g=new Map(A.g),M.h=A.h),Ua(this,M),this.m=x.m}else x&&(A=String(x).match(mu))?(this.h=!1,gu(this,A[1]||"",!0),this.o=_t(A[2]||""),this.g=_t(A[3]||"",!0),Ba(this,A[4]),this.l=_t(A[5]||"",!0),Ua(this,A[6]||"",!0),this.m=_t(A[7]||"")):(this.h=!1,this.i=new io(null,this.h))}jo.prototype.toString=function(){var x=[],A=this.j;A&&x.push(ja(A,Zc,!0),":");var M=this.g;return(M||A=="file")&&(x.push("//"),(A=this.o)&&x.push(ja(A,Zc,!0),"@"),x.push(encodeURIComponent(String(M)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M=this.s,M!=null&&x.push(":",String(M))),(M=this.l)&&(this.g&&M.charAt(0)!="/"&&x.push("/"),x.push(ja(M,M.charAt(0)=="/"?qy:Hy,!0))),(M=this.i.toString())&&x.push("?",M),(M=this.m)&&x.push("#",ja(M,Jf)),x.join("")};function Ds(x){return new jo(x)}function gu(x,A,M){x.j=M?_t(A,!0):A,x.j&&(x.j=x.j.replace(/:$/,""))}function Ba(x,A){if(A){if(A=Number(A),isNaN(A)||0>A)throw Error("Bad port number "+A);x.s=A}else x.s=null}function Ua(x,A,M){A instanceof io?(x.i=A,oo(x.i,x.h)):(M||(A=ja(A,Ky)),x.i=new io(A,x.h))}function Kt(x,A,M){x.i.set(A,M)}function Wa(x){return Kt(x,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),x}function _t(x,A){return x?A?decodeURI(x.replace(/%25/g,"%2525")):decodeURIComponent(x):""}function ja(x,A,M){return typeof x=="string"?(x=encodeURI(x).replace(A,Gy),M&&(x=x.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x):null}function Gy(x){return x=x.charCodeAt(0),"%"+(x>>4&15).toString(16)+(x&15).toString(16)}var Zc=/[#\/\?@]/g,Hy=/[#\?:]/g,qy=/[#\?]/g,Ky=/[#\?@]/g,Jf=/#/g;function io(x,A){this.h=this.g=null,this.i=x||null,this.j=!!A}function Ir(x){x.g||(x.g=new Map,x.h=0,x.i&&eI(x.i,function(A,M){x.add(decodeURIComponent(A.replace(/\+/g," ")),M)}))}n=io.prototype,n.add=function(x,A){Ir(this),this.i=null,x=ti(this,x);var M=this.g.get(x);return M||this.g.set(x,M=[]),M.push(A),this.h+=1,this};function Ti(x,A){Ir(x),A=ti(x,A),x.g.has(A)&&(x.i=null,x.h-=x.g.get(A).length,x.g.delete(A))}function _i(x,A){return Ir(x),A=ti(x,A),x.g.has(A)}n.forEach=function(x,A){Ir(this),this.g.forEach(function(M,W){M.forEach(function(ue){x.call(A,ue,W,this)},this)},this)},n.na=function(){Ir(this);const x=Array.from(this.g.values()),A=Array.from(this.g.keys()),M=[];for(let W=0;W<A.length;W++){const ue=x[W];for(let ge=0;ge<ue.length;ge++)M.push(A[W])}return M},n.V=function(x){Ir(this);let A=[];if(typeof x=="string")_i(this,x)&&(A=A.concat(this.g.get(ti(this,x))));else{x=Array.from(this.g.values());for(let M=0;M<x.length;M++)A=A.concat(x[M])}return A},n.set=function(x,A){return Ir(this),this.i=null,x=ti(this,x),_i(this,x)&&(this.h-=this.g.get(x).length),this.g.set(x,[A]),this.h+=1,this},n.get=function(x,A){return x?(x=this.V(x),0<x.length?String(x[0]):A):A};function Ga(x,A,M){Ti(x,A),0<M.length&&(x.i=null,x.g.set(ti(x,A),v(M)),x.h+=M.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const x=[],A=Array.from(this.g.keys());for(var M=0;M<A.length;M++){var W=A[M];const ge=encodeURIComponent(String(W)),De=this.V(W);for(W=0;W<De.length;W++){var ue=ge;De[W]!==""&&(ue+="="+encodeURIComponent(String(De[W]))),x.push(ue)}}return this.i=x.join("&")};function ti(x,A){return A=String(A),x.j&&(A=A.toLowerCase()),A}function oo(x,A){A&&!x.j&&(Ir(x),x.i=null,x.g.forEach(function(M,W){var ue=W.toLowerCase();W!=ue&&(Ti(this,W),Ga(this,ue,M))},x)),x.j=A}function tI(x,A){const M=new cu;if(a.Image){const W=new Image;W.onload=m(cs,M,"TestLoadImage: loaded",!0,A,W),W.onerror=m(cs,M,"TestLoadImage: error",!1,A,W),W.onabort=m(cs,M,"TestLoadImage: abort",!1,A,W),W.ontimeout=m(cs,M,"TestLoadImage: timeout",!1,A,W),a.setTimeout(function(){W.ontimeout&&W.ontimeout()},1e4),W.src=x}else A(!1)}function Xy(x,A){const M=new cu,W=new AbortController,ue=setTimeout(()=>{W.abort(),cs(M,"TestPingServer: timeout",!1,A)},1e4);fetch(x,{signal:W.signal}).then(ge=>{clearTimeout(ue),ge.ok?cs(M,"TestPingServer: ok",!0,A):cs(M,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(ue),cs(M,"TestPingServer: error",!1,A)})}function cs(x,A,M,W,ue){try{ue&&(ue.onload=null,ue.onerror=null,ue.onabort=null,ue.ontimeout=null),W(M)}catch{}}function nI(){this.g=new Wf}function Qy(x,A,M){const W=M||"";try{za(x,function(ue,ge){let De=ue;u(ue)&&(De=au(ue)),A.push(W+ge+"="+encodeURIComponent(De))})}catch(ue){throw A.push(W+"type="+encodeURIComponent("_badmap")),ue}}function Go(x){this.l=x.Ub||null,this.j=x.eb||!1}y(Go,lu),Go.prototype.g=function(){return new yu(this.l,this.j)},Go.prototype.i=function(x){return function(){return x}}({});function yu(x,A){Gt.call(this),this.D=x,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(yu,Gt),n=yu.prototype,n.open=function(x,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=x,this.A=A,this.readyState=1,Ei(this)},n.send=function(x){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const A={headers:this.u,method:this.B,credentials:this.m,cache:void 0};x&&(A.body=x),(this.D||a).fetch(new Request(this.A,A)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ci(this)),this.readyState=0},n.Sa=function(x){if(this.g&&(this.l=x,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=x.headers,this.readyState=2,Ei(this)),this.g&&(this.readyState=3,Ei(this),this.g)))if(this.responseType==="arraybuffer")x.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in x){if(this.j=x.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Yy(this)}else x.text().then(this.Ra.bind(this),this.ga.bind(this))};function Yy(x){x.j.read().then(x.Pa.bind(x)).catch(x.ga.bind(x))}n.Pa=function(x){if(this.g){if(this.o&&x.value)this.response.push(x.value);else if(!this.o){var A=x.value?x.value:new Uint8Array(0);(A=this.v.decode(A,{stream:!x.done}))&&(this.response=this.responseText+=A)}x.done?Ci(this):Ei(this),this.readyState==3&&Yy(this)}},n.Ra=function(x){this.g&&(this.response=this.responseText=x,Ci(this))},n.Qa=function(x){this.g&&(this.response=x,Ci(this))},n.ga=function(){this.g&&Ci(this)};function Ci(x){x.readyState=4,x.l=null,x.j=null,x.v=null,Ei(x)}n.setRequestHeader=function(x,A){this.u.append(x,A)},n.getResponseHeader=function(x){return this.h&&this.h.get(x.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const x=[],A=this.h.entries();for(var M=A.next();!M.done;)M=M.value,x.push(M[0]+": "+M[1]),M=A.next();return x.join(`\r
`)};function Ei(x){x.onreadystatechange&&x.onreadystatechange.call(x)}Object.defineProperty(yu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(x){this.m=x?"include":"same-origin"}});function Ho(x){let A="";return V(x,function(M,W){A+=W,A+=":",A+=M,A+=`\r
`}),A}function Ha(x,A,M){e:{for(W in M){var W=!1;break e}W=!0}W||(M=Ho(M),typeof x=="string"?M!=null&&encodeURIComponent(String(M)):Kt(x,A,M))}function sn(x){Gt.call(this),this.headers=new Map,this.o=x||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(sn,Gt);var rI=/^https?$/i,Zf=["POST","PUT"];n=sn.prototype,n.Ha=function(x){this.J=x},n.ea=function(x,A,M,W){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+x);A=A?A.toUpperCase():"GET",this.D=x,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ii.g(),this.v=this.o?Wc(this.o):Wc(Ii),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(A,String(x),!0),this.B=!1}catch(ge){wu(this,ge);return}if(x=M||"",M=new Map(this.headers),W)if(Object.getPrototypeOf(W)===Object.prototype)for(var ue in W)M.set(ue,W[ue]);else if(typeof W.keys=="function"&&typeof W.get=="function")for(const ge of W.keys())M.set(ge,W.get(ge));else throw Error("Unknown input type for opt_headers: "+String(W));W=Array.from(M.keys()).find(ge=>ge.toLowerCase()=="content-type"),ue=a.FormData&&x instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Zf,A,void 0))||W||ue||M.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ge,De]of M)this.g.setRequestHeader(ge,De);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{th(this),this.u=!0,this.g.send(x),this.u=!1}catch(ge){wu(this,ge)}};function wu(x,A){x.h=!1,x.g&&(x.j=!0,x.g.abort(),x.j=!1),x.l=A,x.m=5,eh(x),Os(x)}function eh(x){x.A||(x.A=!0,Ht(x,"complete"),Ht(x,"error"))}n.abort=function(x){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=x||7,Ht(this,"complete"),Ht(this,"abort"),Os(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Os(this,!0)),sn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ep(this):this.bb())},n.bb=function(){ep(this)};function ep(x){if(x.h&&typeof o<"u"&&(!x.v[1]||hs(x)!=4||x.Z()!=2)){if(x.u&&hs(x)==4)wi(x.Ea,0,x);else if(Ht(x,"readystatechange"),hs(x)==4){x.h=!1;try{const De=x.Z();e:switch(De){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var M;if(!(M=A)){var W;if(W=De===0){var ue=String(x.D).match(mu)[1]||null;!ue&&a.self&&a.self.location&&(ue=a.self.location.protocol.slice(0,-1)),W=!rI.test(ue?ue.toLowerCase():"")}M=W}if(M)Ht(x,"complete"),Ht(x,"success");else{x.m=6;try{var ge=2<hs(x)?x.g.statusText:""}catch{ge=""}x.l=ge+" ["+x.Z()+"]",eh(x)}}finally{Os(x)}}}}function Os(x,A){if(x.g){th(x);const M=x.g,W=x.v[0]?()=>{}:null;x.g=null,x.v=null,A||Ht(x,"ready");try{M.onreadystatechange=W}catch{}}}function th(x){x.I&&(a.clearTimeout(x.I),x.I=null)}n.isActive=function(){return!!this.g};function hs(x){return x.g?x.g.readyState:0}n.Z=function(){try{return 2<hs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(x){if(this.g){var A=this.g.responseText;return x&&A.indexOf(x)==0&&(A=A.substring(x.length)),Uf(A)}};function tp(x){try{if(!x.g)return null;if("response"in x.g)return x.g.response;switch(x.H){case"":case"text":return x.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in x.g)return x.g.mozResponseArrayBuffer}return null}catch{return null}}function nh(x){const A={};x=(x.g&&2<=hs(x)&&x.g.getAllResponseHeaders()||"").split(`\r
`);for(let W=0;W<x.length;W++){if(S(x[W]))continue;var M=E(x[W]);const ue=M[0];if(M=M[1],typeof M!="string")continue;M=M.trim();const ge=A[ue]||[];A[ue]=ge,ge.push(M)}k(A,function(W){return W.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ao(x,A,M){return M&&M.internalChannelParams&&M.internalChannelParams[x]||A}function np(x){this.Aa=0,this.i=[],this.j=new cu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ao("failFast",!1,x),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ao("baseRetryDelayMs",5e3,x),this.cb=ao("retryDelaySeedMs",1e4,x),this.Wa=ao("forwardChannelMaxRetries",2,x),this.wa=ao("forwardChannelRequestTimeoutMs",2e4,x),this.pa=x&&x.xmlHttpFactory||void 0,this.Xa=x&&x.Tb||void 0,this.Ca=x&&x.useFetchStreams||!1,this.L=void 0,this.J=x&&x.supportsCrossDomainXhr||!1,this.K="",this.h=new pu(x&&x.concurrentRequestLimit),this.Da=new nI,this.P=x&&x.fastHandshake||!1,this.O=x&&x.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=x&&x.Rb||!1,x&&x.xa&&this.j.xa(),x&&x.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&x&&x.detectBufferingProxy||!1,this.ja=void 0,x&&x.longPollingTimeout&&0<x.longPollingTimeout&&(this.ja=x.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=np.prototype,n.la=8,n.G=1,n.connect=function(x,A,M,W){Tn(0),this.W=x,this.H=A||{},M&&W!==void 0&&(this.H.OSID=M,this.H.OAID=W),this.F=this.X,this.I=t0(this,null,this.W),lo(this)};function Sr(x){if(rh(x),x.G==3){var A=x.U++,M=Ds(x.I);if(Kt(M,"SID",x.K),Kt(M,"RID",A),Kt(M,"TYPE","terminate"),qo(x,M),A=new Si(x,x.j,A),A.L=2,A.v=Wa(Ds(M)),M=!1,a.navigator&&a.navigator.sendBeacon)try{M=a.navigator.sendBeacon(A.v.toString(),"")}catch{}!M&&a.Image&&(new Image().src=A.v,M=!0),M||(A.g=n0(A.j,null),A.g.ea(A.v)),A.F=Date.now(),Jt(A)}e0(x)}function ki(x){x.g&&(rp(x),x.g.cancel(),x.g=null)}function rh(x){ki(x),x.u&&(a.clearTimeout(x.u),x.u=null),oh(x),x.h.cancel(),x.s&&(typeof x.s=="number"&&a.clearTimeout(x.s),x.s=null)}function lo(x){if(!As(x.h)&&!x.s){x.s=!0;var A=x.Ga;se||ie(),X||(se(),X=!0),re.add(A,x),x.B=0}}function sI(x,A){return Uy(x.h)>=x.h.j-(x.s?1:0)?!1:x.s?(x.i=A.D.concat(x.i),!0):x.G==1||x.G==2||x.B>=(x.Va?0:x.Wa)?!1:(x.s=xi(p(x.Ga,x,A),Zy(x,x.B)),x.B++,!0)}n.Ga=function(x){if(this.s)if(this.s=null,this.G==1){if(!x){this.U=Math.floor(1e5*Math.random()),x=this.U++;const ue=new Si(this,this.j,x);let ge=this.o;if(this.S&&(ge?(ge=$(ge),R(ge,this.S)):ge=this.S),this.m!==null||this.O||(ue.H=ge,ge=null),this.P)e:{for(var A=0,M=0;M<this.i.length;M++){t:{var W=this.i[M];if("__data__"in W.map&&(W=W.map.__data__,typeof W=="string")){W=W.length;break t}W=void 0}if(W===void 0)break;if(A+=W,4096<A){A=M;break e}if(A===4096||M===this.i.length-1){A=M+1;break e}}A=1e3}else A=1e3;A=qa(this,ue,A),M=Ds(this.I),Kt(M,"RID",x),Kt(M,"CVER",22),this.D&&Kt(M,"X-HTTP-Session-Id",this.D),qo(this,M),ge&&(this.O?A="headers="+encodeURIComponent(String(Ho(ge)))+"&"+A:this.m&&Ha(M,this.m,ge)),Yf(this.h,ue),this.Ua&&Kt(M,"TYPE","init"),this.P?(Kt(M,"$req",A),Kt(M,"SID","null"),ue.T=!0,Qc(ue,M,null)):Qc(ue,M,A),this.G=2}}else this.G==3&&(x?sh(this,x):this.i.length==0||As(this.h)||sh(this))};function sh(x,A){var M;A?M=A.l:M=x.U++;const W=Ds(x.I);Kt(W,"SID",x.K),Kt(W,"RID",M),Kt(W,"AID",x.T),qo(x,W),x.m&&x.o&&Ha(W,x.m,x.o),M=new Si(x,x.j,M,x.B+1),x.m===null&&(M.H=x.o),A&&(x.i=A.D.concat(x.i)),A=qa(x,M,1e3),M.I=Math.round(.5*x.wa)+Math.round(.5*x.wa*Math.random()),Yf(x.h,M),Qc(M,W,A)}function qo(x,A){x.H&&V(x.H,function(M,W){Kt(A,W,M)}),x.l&&za({},function(M,W){Kt(A,W,M)})}function qa(x,A,M){M=Math.min(x.i.length,M);var W=x.l?p(x.l.Na,x.l,x):null;e:{var ue=x.i;let ge=-1;for(;;){const De=["count="+M];ge==-1?0<M?(ge=ue[0].g,De.push("ofs="+ge)):ge=0:De.push("ofs="+ge);let Bt=!0;for(let Un=0;Un<M;Un++){let $t=ue[Un].g;const or=ue[Un].map;if($t-=ge,0>$t)ge=Math.max(0,ue[Un].g-100),Bt=!1;else try{Qy(or,De,"req"+$t+"_")}catch{W&&W(or)}}if(Bt){W=De.join("&");break e}}}return x=x.i.splice(0,M),A.D=x,W}function vu(x){if(!x.g&&!x.u){x.Y=1;var A=x.Fa;se||ie(),X||(se(),X=!0),re.add(A,x),x.v=0}}function ih(x){return x.g||x.u||3<=x.v?!1:(x.Y++,x.u=xi(p(x.Fa,x),Zy(x,x.v)),x.v++,!0)}n.Fa=function(){if(this.u=null,Jy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var x=2*this.R;this.j.info("BP detection timer enabled: "+x),this.A=xi(p(this.ab,this),x)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Tn(10),ki(this),Jy(this))};function rp(x){x.A!=null&&(a.clearTimeout(x.A),x.A=null)}function Jy(x){x.g=new Si(x,x.j,"rpc",x.Y),x.m===null&&(x.g.H=x.o),x.g.O=0;var A=Ds(x.qa);Kt(A,"RID","rpc"),Kt(A,"SID",x.K),Kt(A,"AID",x.T),Kt(A,"CI",x.F?"0":"1"),!x.F&&x.ja&&Kt(A,"TO",x.ja),Kt(A,"TYPE","xmlhttp"),qo(x,A),x.m&&x.o&&Ha(A,x.m,x.o),x.L&&(x.g.I=x.L);var M=x.g;x=x.ia,M.L=1,M.v=Wa(Ds(A)),M.m=null,M.P=!0,Xf(M,x)}n.Za=function(){this.C!=null&&(this.C=null,ki(this),ih(this),Tn(19))};function oh(x){x.C!=null&&(a.clearTimeout(x.C),x.C=null)}function ah(x,A){var M=null;if(x.g==A){oh(x),rp(x),x.g=null;var W=2}else if(Qr(x.h,A))M=A.D,Wy(x.h,A),W=1;else return;if(x.G!=0){if(A.o)if(W==1){M=A.m?A.m.length:0,A=Date.now()-A.F;var ue=x.B;W=uu(),Ht(W,new Hc(W,M)),lo(x)}else vu(x);else if(ue=A.s,ue==3||ue==0&&0<A.X||!(W==1&&sI(x,A)||W==2&&ih(x)))switch(M&&0<M.length&&(A=x.h,A.i=A.i.concat(M)),ue){case 1:Ko(x,5);break;case 4:Ko(x,10);break;case 3:Ko(x,6);break;default:Ko(x,2)}}}function Zy(x,A){let M=x.Ta+Math.floor(Math.random()*x.cb);return x.isActive()||(M*=2),M*A}function Ko(x,A){if(x.j.info("Error code "+A),A==2){var M=p(x.fb,x),W=x.Xa;const ue=!W;W=new jo(W||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||gu(W,"https"),Wa(W),ue?tI(W.toString(),M):Xy(W.toString(),M)}else Tn(2);x.G=0,x.l&&x.l.sa(A),e0(x),rh(x)}n.fb=function(x){x?(this.j.info("Successfully pinged google.com"),Tn(2)):(this.j.info("Failed to ping google.com"),Tn(1))};function e0(x){if(x.G=0,x.ka=[],x.l){const A=jy(x.h);(A.length!=0||x.i.length!=0)&&(w(x.ka,A),w(x.ka,x.i),x.h.i.length=0,v(x.i),x.i.length=0),x.l.ra()}}function t0(x,A,M){var W=M instanceof jo?Ds(M):new jo(M);if(W.g!="")A&&(W.g=A+"."+W.g),Ba(W,W.s);else{var ue=a.location;W=ue.protocol,A=A?A+"."+ue.hostname:ue.hostname,ue=+ue.port;var ge=new jo(null);W&&gu(ge,W),A&&(ge.g=A),ue&&Ba(ge,ue),M&&(ge.l=M),W=ge}return M=x.D,A=x.ya,M&&A&&Kt(W,M,A),Kt(W,"VER",x.la),qo(x,W),W}function n0(x,A,M){if(A&&!x.J)throw Error("Can't create secondary domain capable XhrIo object.");return A=x.Ca&&!x.pa?new sn(new Go({eb:M})):new sn(x.pa),A.Ha(x.J),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function sp(){}n=sp.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function lh(){}lh.prototype.g=function(x,A){return new Yr(x,A)};function Yr(x,A){Gt.call(this),this.g=new np(A),this.l=x,this.h=A&&A.messageUrlParams||null,x=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(x?x["X-Client-Protocol"]="webchannel":x={"X-Client-Protocol":"webchannel"}),this.g.o=x,x=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(x?x["X-WebChannel-Content-Type"]=A.messageContentType:x={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.va&&(x?x["X-WebChannel-Client-Profile"]=A.va:x={"X-WebChannel-Client-Profile":A.va}),this.g.S=x,(x=A&&A.Sb)&&!S(x)&&(this.g.m=x),this.v=A&&A.supportsCrossDomainXhr||!1,this.u=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!S(A)&&(this.g.D=A,x=this.h,x!==null&&A in x&&(x=this.h,A in x&&delete x[A])),this.j=new uo(this)}y(Yr,Gt),Yr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Yr.prototype.close=function(){Sr(this.g)},Yr.prototype.o=function(x){var A=this.g;if(typeof x=="string"){var M={};M.__data__=x,x=M}else this.u&&(M={},M.__data__=au(x),x=M);A.i.push(new By(A.Ya++,x)),A.G==3&&lo(A)},Yr.prototype.N=function(){this.g.l=null,delete this.j,Sr(this.g),delete this.g,Yr.aa.N.call(this)};function r0(x){ro.call(this),x.__headers__&&(this.headers=x.__headers__,this.statusCode=x.__status__,delete x.__headers__,delete x.__status__);var A=x.__sm__;if(A){e:{for(const M in A){x=M;break e}x=void 0}(this.i=x)&&(x=this.i,A=A!==null&&x in A?A[x]:void 0),this.data=A}else this.data=x}y(r0,ro);function s0(){Gc.call(this),this.status=1}y(s0,Gc);function uo(x){this.g=x}y(uo,sp),uo.prototype.ua=function(){Ht(this.g,"a")},uo.prototype.ta=function(x){Ht(this.g,new r0(x))},uo.prototype.sa=function(x){Ht(this.g,new s0)},uo.prototype.ra=function(){Ht(this.g,"b")},lh.prototype.createWebChannel=lh.prototype.g,Yr.prototype.send=Yr.prototype.o,Yr.prototype.open=Yr.prototype.m,Yr.prototype.close=Yr.prototype.close,HF=function(){return new lh},GF=function(){return uu()},jF=so,xT={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Kc.NO_ERROR=0,Kc.TIMEOUT=8,Kc.HTTP_ERROR=6,Cw=Kc,Ly.COMPLETE="complete",WF=Ly,jc.EventType=Zs,Zs.OPEN="a",Zs.CLOSE="b",Zs.ERROR="c",Zs.MESSAGE="d",Gt.prototype.listen=Gt.prototype.K,Vp=jc,sn.prototype.listenOnce=sn.prototype.L,sn.prototype.getLastError=sn.prototype.Ka,sn.prototype.getLastErrorCode=sn.prototype.Ba,sn.prototype.getStatus=sn.prototype.Z,sn.prototype.getResponseJson=sn.prototype.Oa,sn.prototype.getResponseText=sn.prototype.oa,sn.prototype.send=sn.prototype.ea,sn.prototype.setWithCredentials=sn.prototype.Ha,UF=sn}).apply(typeof ew<"u"?ew:typeof self<"u"?self:typeof window<"u"?window:{});const OA="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lr.UNAUTHENTICATED=new Lr(null),Lr.GOOGLE_CREDENTIALS=new Lr("google-credentials-uid"),Lr.FIRST_PARTY=new Lr("first-party-uid"),Lr.MOCK_USER=new Lr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xd="11.0.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic=new V_("@firebase/firestore");function Dh(){return ic.logLevel}function Ve(n,...e){if(ic.logLevel<=It.DEBUG){const t=e.map(Y_);ic.debug(`Firestore (${xd}): ${n}`,...t)}}function ya(n,...e){if(ic.logLevel<=It.ERROR){const t=e.map(Y_);ic.error(`Firestore (${xd}): ${n}`,...t)}}function Xh(n,...e){if(ic.logLevel<=It.WARN){const t=e.map(Y_);ic.warn(`Firestore (${xd}): ${n}`,...t)}}function Y_(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function it(n="Unexpected state"){const e=`FIRESTORE (${xd}) INTERNAL ASSERTION FAILED: `+n;throw ya(e),new Error(e)}function Vt(n,e){n||it()}function ut(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ye extends ka{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class o9{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Lr.UNAUTHENTICATED))}shutdown(){}}class a9{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class l9{constructor(e){this.t=e,this.currentUser=Lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Vt(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new da;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new da,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Ve("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Ve("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new da)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Ve("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Vt(typeof r.accessToken=="string"),new qF(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Vt(e===null||typeof e=="string"),new Lr(e)}}class u9{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Lr.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class c9{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new u9(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Lr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class h9{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class d9{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Vt(this.o===void 0);const r=i=>{i.error!=null&&Ve("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Ve("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Ve("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):Ve("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Vt(typeof t.token=="string"),this.R=t.token,new h9(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f9(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=f9(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ct(n,e){return n<e?-1:n>e?1:0}function Qh(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{static now(){return Kn.fromMillis(Date.now())}static fromDate(e){return Kn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Kn(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ye(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ye(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ye(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ye(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ct(this.nanoseconds,e.nanoseconds):Ct(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{static fromTimestamp(e){return new lt(e)}static min(){return new lt(new Kn(0,0))}static max(){return new lt(new Kn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t,r){t===void 0?t=0:t>e.length&&it(),r===void 0?r=e.length-t:r>e.length-t&&it(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return am.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof am?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ln extends am{construct(e,t,r){return new ln(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ye(Ee.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ln(t)}static emptyPath(){return new ln([])}}const p9=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Er extends am{construct(e,t,r){return new Er(e,t,r)}static isValidIdentifier(e){return p9.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Er.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Er(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Ye(Ee.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Ye(Ee.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Ye(Ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Ye(Ee.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Er(t)}static emptyPath(){return new Er([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.path=e}static fromPath(e){return new et(ln.fromString(e))}static fromName(e){return new et(ln.fromString(e).popFirst(5))}static empty(){return new et(ln.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ln.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ln.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new et(new ln(e.slice()))}}function m9(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=lt.fromTimestamp(r===1e9?new Kn(t+1,0):new Kn(t,r));return new $l(s,et.empty(),e)}function g9(n){return new $l(n.readTime,n.key,-1)}class $l{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new $l(lt.min(),et.empty(),-1)}static max(){return new $l(lt.max(),et.empty(),-1)}}function y9(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=et.comparator(n.documentKey,e.documentKey),t!==0?t:Ct(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w9="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class v9{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bd(n){if(n.code!==Ee.FAILED_PRECONDITION||n.message!==w9)throw n;Ve("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&it(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new xe((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof xe?t:xe.resolve(t)}catch(t){return xe.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):xe.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):xe.reject(t)}static resolve(e){return new xe((t,r)=>{t(e)})}static reject(e){return new xe((t,r)=>{r(e)})}static waitFor(e){return new xe((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=xe.resolve(!1);for(const r of e)t=t.next(s=>s?xe.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new xe((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new xe((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function x9(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Id(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}hx.oe=-1;function dx(n){return n==null}function yv(n){return n===0&&1/n==-1/0}function b9(n){return typeof n=="number"&&Number.isInteger(n)&&!yv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I9(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=PA(e)),e=S9(n.get(t),e);return PA(e)}function S9(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function PA(n){return n+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FA(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Kl(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function XF(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e,t){this.comparator=e,this.root=t||Cr.EMPTY}insert(e,t){return new yn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Cr.BLACK,null,null))}remove(e){return new yn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Cr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tw(this.root,e,this.comparator,!1)}getReverseIterator(){return new tw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tw(this.root,e,this.comparator,!0)}}class tw{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Cr{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Cr.RED,this.left=s??Cr.EMPTY,this.right=i??Cr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Cr(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Cr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Cr.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Cr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Cr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw it();const e=this.left.check();if(e!==this.right.check())throw it();return e+(this.isRed()?0:1)}}Cr.EMPTY=null,Cr.RED=!0,Cr.BLACK=!1;Cr.EMPTY=new class{constructor(){this.size=0}get key(){throw it()}get value(){throw it()}get color(){throw it()}get left(){throw it()}get right(){throw it()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Cr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e){this.comparator=e,this.data=new yn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new LA(this.data.getIterator())}getIteratorFrom(e){return new LA(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Xn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Xn(this.comparator);return t.data=e,t}}class LA{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e){this.fields=e,e.sort(Er.comparator)}static empty(){return new Ws([])}unionWith(e){let t=new Xn(Er.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ws(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new QF("Invalid base64 string: "+i):i}}(e);return new kr(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new kr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ct(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}kr.EMPTY_BYTE_STRING=new kr("");const T9=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rl(n){if(Vt(!!n),typeof n=="string"){let e=0;const t=T9.exec(n);if(Vt(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Cn(n.seconds),nanos:Cn(n.nanos)}}function Cn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Al(n){return typeof n=="string"?kr.fromBase64String(n):kr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J_(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function fx(n){const e=n.mapValue.fields.__previous_value__;return J_(e)?fx(e):e}function lm(n){const e=Rl(n.mapValue.fields.__local_write_time__.timestampValue);return new Kn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _9{constructor(e,t,r,s,i,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class um{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new um("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof um&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nw={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Dl(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?J_(n)?4:E9(n)?9007199254740991:C9(n)?10:11:it()}function Ao(n,e){if(n===e)return!0;const t=Dl(n);if(t!==Dl(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return lm(n).isEqual(lm(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Rl(s.timestampValue),a=Rl(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Al(s.bytesValue).isEqual(Al(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Cn(s.geoPointValue.latitude)===Cn(i.geoPointValue.latitude)&&Cn(s.geoPointValue.longitude)===Cn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Cn(s.integerValue)===Cn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Cn(s.doubleValue),a=Cn(i.doubleValue);return o===a?yv(o)===yv(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Qh(n.arrayValue.values||[],e.arrayValue.values||[],Ao);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(FA(o)!==FA(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ao(o[l],a[l])))return!1;return!0}(n,e);default:return it()}}function cm(n,e){return(n.values||[]).find(t=>Ao(t,e))!==void 0}function Yh(n,e){if(n===e)return 0;const t=Dl(n),r=Dl(e);if(t!==r)return Ct(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ct(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Cn(i.integerValue||i.doubleValue),l=Cn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return MA(n.timestampValue,e.timestampValue);case 4:return MA(lm(n),lm(e));case 5:return Ct(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Al(i),l=Al(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Ct(a[u],l[u]);if(h!==0)return h}return Ct(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ct(Cn(i.latitude),Cn(o.latitude));return a!==0?a:Ct(Cn(i.longitude),Cn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return VA(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,u,h;const d=i.fields||{},p=o.fields||{},m=(a=d.value)===null||a===void 0?void 0:a.arrayValue,y=(l=p.value)===null||l===void 0?void 0:l.arrayValue,v=Ct(((u=m==null?void 0:m.values)===null||u===void 0?void 0:u.length)||0,((h=y==null?void 0:y.values)===null||h===void 0?void 0:h.length)||0);return v!==0?v:VA(m,y)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===nw.mapValue&&o===nw.mapValue)return 0;if(i===nw.mapValue)return 1;if(o===nw.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const p=Ct(l[d],h[d]);if(p!==0)return p;const m=Yh(a[l[d]],u[h[d]]);if(m!==0)return m}return Ct(l.length,h.length)}(n.mapValue,e.mapValue);default:throw it()}}function MA(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ct(n,e);const t=Rl(n),r=Rl(e),s=Ct(t.seconds,r.seconds);return s!==0?s:Ct(t.nanos,r.nanos)}function VA(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Yh(t[s],r[s]);if(i)return i}return Ct(t.length,r.length)}function Jh(n){return bT(n)}function bT(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Rl(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Al(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return et.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=bT(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${bT(t.fields[o])}`;return s+"}"}(n.mapValue):it()}function Ew(n){switch(Dl(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fx(n);return e?16+Ew(e):16;case 5:return 2*n.stringValue.length;case 6:return Al(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Ew(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Kl(r.fields,(i,o)=>{s+=i.length+Ew(o)}),s}(n.mapValue);default:throw it()}}function IT(n){return!!n&&"integerValue"in n}function Z_(n){return!!n&&"arrayValue"in n}function zA(n){return!!n&&"nullValue"in n}function BA(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function kw(n){return!!n&&"mapValue"in n}function C9(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Zp(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Kl(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Zp(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zp(n.arrayValue.values[t]);return e}return Object.assign({},n)}function E9(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e){this.value=e}static empty(){return new Ss({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!kw(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Zp(t)}setAll(e){let t=Er.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Zp(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());kw(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ao(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];kw(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Kl(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ss(Zp(this.value))}}function YF(n){const e=[];return Kl(n.fields,(t,r)=>{const s=new Er([t]);if(kw(r)){const i=YF(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ws(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Vr(e,0,lt.min(),lt.min(),lt.min(),Ss.empty(),0)}static newFoundDocument(e,t,r,s){return new Vr(e,1,t,lt.min(),r,s,0)}static newNoDocument(e,t){return new Vr(e,2,t,lt.min(),lt.min(),Ss.empty(),0)}static newUnknownDocument(e,t){return new Vr(e,3,t,lt.min(),lt.min(),Ss.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(lt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ss.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ss.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=lt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Vr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Vr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e,t){this.position=e,this.inclusive=t}}function UA(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=et.comparator(et.fromName(o.referenceValue),t.key):r=Yh(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function WA(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ao(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,t="asc"){this.field=e,this.dir=t}}function k9(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{}class Hn extends JF{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new $9(e,t,r):t==="array-contains"?new D9(e,r):t==="in"?new O9(e,r):t==="not-in"?new P9(e,r):t==="array-contains-any"?new F9(e,r):new Hn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new R9(e,r):new A9(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Yh(t,this.value)):t!==null&&Dl(this.value)===Dl(t)&&this.matchesComparison(Yh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return it()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Do extends JF{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Do(e,t)}matches(e){return ZF(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ZF(n){return n.op==="and"}function eL(n){return N9(n)&&ZF(n)}function N9(n){for(const e of n.filters)if(e instanceof Do)return!1;return!0}function ST(n){if(n instanceof Hn)return n.field.canonicalString()+n.op.toString()+Jh(n.value);if(eL(n))return n.filters.map(e=>ST(e)).join(",");{const e=n.filters.map(t=>ST(t)).join(",");return`${n.op}(${e})`}}function tL(n,e){return n instanceof Hn?function(r,s){return s instanceof Hn&&r.op===s.op&&r.field.isEqual(s.field)&&Ao(r.value,s.value)}(n,e):n instanceof Do?function(r,s){return s instanceof Do&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&tL(o,s.filters[a]),!0):!1}(n,e):void it()}function nL(n){return n instanceof Hn?function(t){return`${t.field.canonicalString()} ${t.op} ${Jh(t.value)}`}(n):n instanceof Do?function(t){return t.op.toString()+" {"+t.getFilters().map(nL).join(" ,")+"}"}(n):"Filter"}class $9 extends Hn{constructor(e,t,r){super(e,t,r),this.key=et.fromName(r.referenceValue)}matches(e){const t=et.comparator(e.key,this.key);return this.matchesComparison(t)}}class R9 extends Hn{constructor(e,t){super(e,"in",t),this.keys=rL("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class A9 extends Hn{constructor(e,t){super(e,"not-in",t),this.keys=rL("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rL(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>et.fromName(r.referenceValue))}class D9 extends Hn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Z_(t)&&cm(t.arrayValue,this.value)}}class O9 extends Hn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&cm(this.value.arrayValue,t)}}class P9 extends Hn{constructor(e,t){super(e,"not-in",t)}matches(e){if(cm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!cm(this.value.arrayValue,t)}}class F9 extends Hn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Z_(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>cm(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L9{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function jA(n,e=null,t=[],r=[],s=null,i=null,o=null){return new L9(n,e,t,r,s,i,o)}function eC(n){const e=ut(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ST(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),dx(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Jh(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Jh(r)).join(",")),e.ue=t}return e.ue}function tC(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!k9(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!tL(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!WA(n.startAt,e.startAt)&&WA(n.endAt,e.endAt)}function TT(n){return et.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function M9(n,e,t,r,s,i,o,a){return new px(n,e,t,r,s,i,o,a)}function nC(n){return new px(n)}function GA(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function V9(n){return n.collectionGroup!==null}function em(n){const e=ut(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Xn(Er.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new vv(i,r))}),t.has(Er.keyField().canonicalString())||e.ce.push(new vv(Er.keyField(),r))}return e.ce}function To(n){const e=ut(n);return e.le||(e.le=z9(e,em(n))),e.le}function z9(n,e){if(n.limitType==="F")return jA(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new vv(s.field,i)});const t=n.endAt?new wv(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new wv(n.startAt.position,n.startAt.inclusive):null;return jA(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _T(n,e,t){return new px(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function mx(n,e){return tC(To(n),To(e))&&n.limitType===e.limitType}function sL(n){return`${eC(To(n))}|lt:${n.limitType}`}function Oh(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>nL(s)).join(", ")}]`),dx(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Jh(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Jh(s)).join(",")),`Target(${r})`}(To(n))}; limitType=${n.limitType})`}function gx(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):et.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of em(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=UA(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,em(r),s)||r.endAt&&!function(o,a,l){const u=UA(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,em(r),s))}(n,e)}function B9(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function iL(n){return(e,t)=>{let r=!1;for(const s of em(n)){const i=U9(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function U9(n,e,t){const r=n.field.isKeyField()?et.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Yh(l,u):it()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return it()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Kl(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return XF(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W9=new yn(et.comparator);function wa(){return W9}const oL=new yn(et.comparator);function zp(...n){let e=oL;for(const t of n)e=e.insert(t.key,t);return e}function aL(n){let e=oL;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Gu(){return tm()}function lL(){return tm()}function tm(){return new Cc(n=>n.toString(),(n,e)=>n.isEqual(e))}const j9=new yn(et.comparator),G9=new Xn(et.comparator);function St(...n){let e=G9;for(const t of n)e=e.add(t);return e}const H9=new Xn(Ct);function q9(){return H9}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rC(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yv(e)?"-0":e}}function uL(n){return{integerValue:""+n}}function K9(n,e){return b9(e)?uL(e):rC(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(){this._=void 0}}function X9(n,e,t){return n instanceof xv?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&J_(i)&&(i=fx(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof hm?hL(n,e):n instanceof dm?dL(n,e):function(s,i){const o=cL(s,i),a=HA(o)+HA(s.Pe);return IT(o)&&IT(s.Pe)?uL(a):rC(s.serializer,a)}(n,e)}function Q9(n,e,t){return n instanceof hm?hL(n,e):n instanceof dm?dL(n,e):t}function cL(n,e){return n instanceof bv?function(r){return IT(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class xv extends yx{}class hm extends yx{constructor(e){super(),this.elements=e}}function hL(n,e){const t=fL(e);for(const r of n.elements)t.some(s=>Ao(s,r))||t.push(r);return{arrayValue:{values:t}}}class dm extends yx{constructor(e){super(),this.elements=e}}function dL(n,e){let t=fL(e);for(const r of n.elements)t=t.filter(s=>!Ao(s,r));return{arrayValue:{values:t}}}class bv extends yx{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function HA(n){return Cn(n.integerValue||n.doubleValue)}function fL(n){return Z_(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Y9(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof hm&&s instanceof hm||r instanceof dm&&s instanceof dm?Qh(r.elements,s.elements,Ao):r instanceof bv&&s instanceof bv?Ao(r.Pe,s.Pe):r instanceof xv&&s instanceof xv}(n.transform,e.transform)}class J9{constructor(e,t){this.version=e,this.transformResults=t}}class _o{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _o}static exists(e){return new _o(void 0,e)}static updateTime(e){return new _o(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Nw(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class wx{}function pL(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new gL(n.key,_o.none()):new jm(n.key,n.data,_o.none());{const t=n.data,r=Ss.empty();let s=new Xn(Er.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Xl(n.key,r,new Ws(s.toArray()),_o.none())}}function Z9(n,e,t){n instanceof jm?function(s,i,o){const a=s.value.clone(),l=KA(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Xl?function(s,i,o){if(!Nw(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=KA(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(mL(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function nm(n,e,t,r){return n instanceof jm?function(i,o,a,l){if(!Nw(i.precondition,o))return a;const u=i.value.clone(),h=XA(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Xl?function(i,o,a,l){if(!Nw(i.precondition,o))return a;const u=XA(i.fieldTransforms,l,o),h=o.data;return h.setAll(mL(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(d=>d.field))}(n,e,t,r):function(i,o,a){return Nw(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function eK(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=cL(r.transform,s||null);i!=null&&(t===null&&(t=Ss.empty()),t.set(r.field,i))}return t||null}function qA(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Qh(r,s,(i,o)=>Y9(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class jm extends wx{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Xl extends wx{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function mL(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function KA(n,e,t){const r=new Map;Vt(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Q9(o,a,t[s]))}return r}function XA(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,X9(i,o,e))}return r}class gL extends wx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class tK extends wx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nK{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Z9(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=nm(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=nm(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=lL();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=pL(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(lt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),St())}isEqual(e){return this.batchId===e.batchId&&Qh(this.mutations,e.mutations,(t,r)=>qA(t,r))&&Qh(this.baseMutations,e.baseMutations,(t,r)=>qA(t,r))}}class sC{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Vt(e.mutations.length===r.length);let s=function(){return j9}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new sC(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rK{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sK{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var On,Rt;function iK(n){switch(n){default:return it();case Ee.CANCELLED:case Ee.UNKNOWN:case Ee.DEADLINE_EXCEEDED:case Ee.RESOURCE_EXHAUSTED:case Ee.INTERNAL:case Ee.UNAVAILABLE:case Ee.UNAUTHENTICATED:return!1;case Ee.INVALID_ARGUMENT:case Ee.NOT_FOUND:case Ee.ALREADY_EXISTS:case Ee.PERMISSION_DENIED:case Ee.FAILED_PRECONDITION:case Ee.ABORTED:case Ee.OUT_OF_RANGE:case Ee.UNIMPLEMENTED:case Ee.DATA_LOSS:return!0}}function yL(n){if(n===void 0)return ya("GRPC error has no .code"),Ee.UNKNOWN;switch(n){case On.OK:return Ee.OK;case On.CANCELLED:return Ee.CANCELLED;case On.UNKNOWN:return Ee.UNKNOWN;case On.DEADLINE_EXCEEDED:return Ee.DEADLINE_EXCEEDED;case On.RESOURCE_EXHAUSTED:return Ee.RESOURCE_EXHAUSTED;case On.INTERNAL:return Ee.INTERNAL;case On.UNAVAILABLE:return Ee.UNAVAILABLE;case On.UNAUTHENTICATED:return Ee.UNAUTHENTICATED;case On.INVALID_ARGUMENT:return Ee.INVALID_ARGUMENT;case On.NOT_FOUND:return Ee.NOT_FOUND;case On.ALREADY_EXISTS:return Ee.ALREADY_EXISTS;case On.PERMISSION_DENIED:return Ee.PERMISSION_DENIED;case On.FAILED_PRECONDITION:return Ee.FAILED_PRECONDITION;case On.ABORTED:return Ee.ABORTED;case On.OUT_OF_RANGE:return Ee.OUT_OF_RANGE;case On.UNIMPLEMENTED:return Ee.UNIMPLEMENTED;case On.DATA_LOSS:return Ee.DATA_LOSS;default:return it()}}(Rt=On||(On={}))[Rt.OK=0]="OK",Rt[Rt.CANCELLED=1]="CANCELLED",Rt[Rt.UNKNOWN=2]="UNKNOWN",Rt[Rt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Rt[Rt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Rt[Rt.NOT_FOUND=5]="NOT_FOUND",Rt[Rt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Rt[Rt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Rt[Rt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Rt[Rt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Rt[Rt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Rt[Rt.ABORTED=10]="ABORTED",Rt[Rt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Rt[Rt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Rt[Rt.INTERNAL=13]="INTERNAL",Rt[Rt.UNAVAILABLE=14]="UNAVAILABLE",Rt[Rt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oK(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aK=new Xu([4294967295,4294967295],0);function QA(n){const e=oK().encode(n),t=new BF;return t.update(e),new Uint8Array(t.digest())}function YA(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Xu([t,r],0),new Xu([s,i],0)]}class iC{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Bp(`Invalid padding: ${t}`);if(r<0)throw new Bp(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Bp(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Bp(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=Xu.fromNumber(this.Te)}Ee(e,t,r){let s=e.add(t.multiply(Xu.fromNumber(r)));return s.compare(aK)===1&&(s=new Xu([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ie).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=QA(e),[r,s]=YA(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new iC(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const t=QA(e),[r,s]=YA(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Bp extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Gm.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new vx(lt.min(),s,new yn(Ct),wa(),St())}}class Gm{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Gm(r,t,St(),St(),St())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class wL{constructor(e,t){this.targetId=e,this.me=t}}class vL{constructor(e,t,r=kr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class JA{constructor(){this.fe=0,this.ge=ZA(),this.pe=kr.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=St(),t=St(),r=St();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:it()}}),new Gm(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=ZA()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Vt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class lK{constructor(e){this.Le=e,this.Be=new Map,this.ke=wa(),this.qe=rw(),this.Qe=rw(),this.Ke=new yn(Ct)}$e(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.je(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.De(e.resumeToken));break;default:it()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.je(s)&&t(s)})}Je(e){const t=e.targetId,r=e.me.count,s=this.Ye(t);if(s){const i=s.target;if(TT(i))if(r===0){const o=new et(i.path);this.We(t,o,Vr.newNoDocument(o,lt.min()))}else Vt(r===1);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),l=a?this.et(a,e,o):1;if(l!==0){this.He(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,u)}}}}}Xe(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Al(r).toUint8Array()}catch(l){if(l instanceof QF)return Xh("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new iC(o,s,i)}catch(l){return Xh(l instanceof Bp?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Te===0?null:a}et(e,t,r){return t.me.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.We(t,i,null),s++)}),s}it(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Ye(o);if(a){if(i.current&&TT(a.target)){const l=new et(a.target.path);this.st(l).has(o)||this.ot(o,l)||this.We(o,l,Vr.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=St();this.Qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Ye(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new vx(e,t,this.Ke,this.ke,r);return this.ke=wa(),this.qe=rw(),this.Qe=rw(),this.Ke=new yn(Ct),s}Ue(e,t){if(!this.je(e))return;const r=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const s=this.ze(e);this.ot(e,t)?s.Fe(t,1):s.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Be.get(e);return t||(t=new JA,this.Be.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new Xn(Ct),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Xn(Ct),this.qe=this.qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||Ve("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ut(e)}He(e){this.Be.set(e,new JA),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function rw(){return new yn(et.comparator)}function ZA(){return new yn(et.comparator)}const uK={asc:"ASCENDING",desc:"DESCENDING"},cK={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hK={and:"AND",or:"OR"};class dK{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function CT(n,e){return n.useProto3Json||dx(e)?e:{value:e}}function Iv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xL(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function fK(n,e){return Iv(n,e.toTimestamp())}function Co(n){return Vt(!!n),lt.fromTimestamp(function(t){const r=Rl(t);return new Kn(r.seconds,r.nanos)}(n))}function oC(n,e){return ET(n,e).canonicalString()}function ET(n,e){const t=function(s){return new ln(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function bL(n){const e=ln.fromString(n);return Vt(CL(e)),e}function kT(n,e){return oC(n.databaseId,e.path)}function MS(n,e){const t=bL(e);if(t.get(1)!==n.databaseId.projectId)throw new Ye(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ye(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new et(SL(t))}function IL(n,e){return oC(n.databaseId,e)}function pK(n){const e=bL(n);return e.length===4?ln.emptyPath():SL(e)}function NT(n){return new ln(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function SL(n){return Vt(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function eD(n,e,t){return{name:kT(n,e),fields:t.value.mapValue.fields}}function mK(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:it()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(Vt(h===void 0||typeof h=="string"),kr.fromBase64String(h||"")):(Vt(h===void 0||h instanceof Buffer||h instanceof Uint8Array),kr.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?Ee.UNKNOWN:yL(u.code);return new Ye(h,u.message||"")}(o);t=new vL(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=MS(n,r.document.name),i=Co(r.document.updateTime),o=r.document.createTime?Co(r.document.createTime):lt.min(),a=new Ss({mapValue:{fields:r.document.fields}}),l=Vr.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new $w(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=MS(n,r.document),i=r.readTime?Co(r.readTime):lt.min(),o=Vr.newNoDocument(s,i),a=r.removedTargetIds||[];t=new $w([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=MS(n,r.document),i=r.removedTargetIds||[];t=new $w([],i,s,null)}else{if(!("filter"in e))return it();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new sK(s,i),a=r.targetId;t=new wL(a,o)}}return t}function gK(n,e){let t;if(e instanceof jm)t={update:eD(n,e.key,e.value)};else if(e instanceof gL)t={delete:kT(n,e.key)};else if(e instanceof Xl)t={update:eD(n,e.key,e.data),updateMask:_K(e.fieldMask)};else{if(!(e instanceof tK))return it();t={verify:kT(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof xv)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof hm)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof dm)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof bv)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw it()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:fK(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:it()}(n,e.precondition)),t}function yK(n,e){return n&&n.length>0?(Vt(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Co(s.updateTime):Co(i);return o.isEqual(lt.min())&&(o=Co(i)),new J9(o,s.transformResults||[])}(t,e))):[]}function wK(n,e){return{documents:[IL(n,e.path)]}}function vK(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=IL(n,s);const i=function(u){if(u.length!==0)return _L(Do.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:Ph(p.field),direction:IK(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=CT(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ct:t,parent:s}}function xK(n){let e=pK(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Vt(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(d){const p=TL(d);return p instanceof Do&&eL(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(d){return d.map(p=>function(y){return new vv(Fh(y.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(d){let p;return p=typeof d=="object"?d.value:d,dx(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(d){const p=!!d.before,m=d.values||[];return new wv(m,p)}(t.startAt));let u=null;return t.endAt&&(u=function(d){const p=!d.before,m=d.values||[];return new wv(m,p)}(t.endAt)),M9(e,s,o,i,a,"F",l,u)}function bK(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return it()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function TL(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Fh(t.unaryFilter.field);return Hn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Fh(t.unaryFilter.field);return Hn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Fh(t.unaryFilter.field);return Hn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Fh(t.unaryFilter.field);return Hn.create(o,"!=",{nullValue:"NULL_VALUE"});default:return it()}}(n):n.fieldFilter!==void 0?function(t){return Hn.create(Fh(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return it()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Do.create(t.compositeFilter.filters.map(r=>TL(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return it()}}(t.compositeFilter.op))}(n):it()}function IK(n){return uK[n]}function SK(n){return cK[n]}function TK(n){return hK[n]}function Ph(n){return{fieldPath:n.canonicalString()}}function Fh(n){return Er.fromServerFormat(n.fieldPath)}function _L(n){return n instanceof Hn?function(t){if(t.op==="=="){if(BA(t.value))return{unaryFilter:{field:Ph(t.field),op:"IS_NAN"}};if(zA(t.value))return{unaryFilter:{field:Ph(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(BA(t.value))return{unaryFilter:{field:Ph(t.field),op:"IS_NOT_NAN"}};if(zA(t.value))return{unaryFilter:{field:Ph(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ph(t.field),op:SK(t.op),value:t.value}}}(n):n instanceof Do?function(t){const r=t.getFilters().map(s=>_L(s));return r.length===1?r[0]:{compositeFilter:{op:TK(t.op),filters:r}}}(n):it()}function _K(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function CL(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e,t,r,s,i=lt.min(),o=lt.min(),a=kr.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ml(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ml(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ml(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ml(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CK{constructor(e){this.ht=e}}function EK(n){const e=xK({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_T(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kK{constructor(){this.ln=new NK}addToCollectionParentIndex(e,t){return this.ln.add(t),xe.resolve()}getCollectionParents(e,t){return xe.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return xe.resolve()}deleteFieldIndex(e,t){return xe.resolve()}deleteAllFieldIndexes(e){return xe.resolve()}createTargetIndexes(e,t){return xe.resolve()}getDocumentsMatchingTarget(e,t){return xe.resolve(null)}getIndexType(e,t){return xe.resolve(0)}getFieldIndexes(e,t){return xe.resolve([])}getNextCollectionGroupToUpdate(e){return xe.resolve(null)}getMinOffset(e,t){return xe.resolve($l.min())}getMinOffsetFromCollectionGroup(e,t){return xe.resolve($l.min())}updateCollectionGroup(e,t,r){return xe.resolve()}updateIndexEntries(e,t){return xe.resolve()}}class NK{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Xn(ln.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Xn(ln.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Is{static withCacheSize(e){return new Is(e,Is.DEFAULT_COLLECTION_PERCENTILE,Is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Is.DEFAULT_COLLECTION_PERCENTILE=10,Is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Is.DEFAULT=new Is(41943040,Is.DEFAULT_COLLECTION_PERCENTILE,Is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Is.DISABLED=new Is(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new Zh(0)}static Qn(){return new Zh(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD([n,e],[t,r]){const s=Ct(n,t);return s===0?Ct(e,r):s}class $K{constructor(e){this.Gn=e,this.buffer=new Xn(nD),this.zn=0}jn(){return++this.zn}Hn(e){const t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();nD(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class RK{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){Ve("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Id(t)?Ve("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await bd(t)}await this.Yn(3e5)})}}class AK{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return xe.resolve(hx.oe);const r=new $K(t);return this.Zn.forEachTarget(e,s=>r.Hn(s.sequenceNumber)).next(()=>this.Zn.er(e,s=>r.Hn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ve("LruGarbageCollector","Garbage collection skipped; disabled"),xe.resolve(tD)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Ve("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tD):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(Ve("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(e,s))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(i=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(u=Date.now(),Dh()<=It.DEBUG&&Ve("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),xe.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:d})))}}function DK(n,e){return new AK(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(){this.changes=new Cc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Vr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?xe.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PK{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FK{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&nm(r.mutation,s,Ws.empty(),Kn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,St()).next(()=>r))}getLocalViewOfDocuments(e,t,r=St()){const s=Gu();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=zp();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Gu();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,St()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=wa();const o=tm(),a=function(){return tm()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Xl)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),nm(h.mutation,u,h.mutation.getFieldMask(),Kn.now())):o.set(u.key,Ws.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>{var d;return a.set(u,new PK(h,(d=o.get(u))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){const r=tm();let s=new yn((o,a)=>o-a),i=St();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Ws.empty();h=a.applyToLocalView(u,h),r.set(l,h);const d=(s.get(a.batchId)||St()).add(l);s=s.insert(a.batchId,d)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=lL();h.forEach(p=>{if(!i.has(p)){const m=pL(t.get(p),r.get(p));m!==null&&d.set(p,m),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return xe.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return et.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):V9(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):xe.resolve(Gu());let a=-1,l=i;return o.next(u=>xe.forEach(u,(h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(h)?xe.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,St())).next(h=>({batchId:a,changes:aL(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new et(t)).next(r=>{let s=zp();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=zp();return this.indexManager.getCollectionParents(e,i).next(a=>xe.forEach(a,l=>{const u=function(d,p){return new px(p,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((d,p)=>{o=o.insert(d,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Vr.newInvalidDocument(h)))});let a=zp();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&nm(h.mutation,u,Ws.empty(),Kn.now()),gx(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LK{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return xe.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Co(s.createTime)}}(t)),xe.resolve()}getNamedQuery(e,t){return xe.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,function(s){return{name:s.name,query:EK(s.bundledQuery),readTime:Co(s.readTime)}}(t)),xe.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MK{constructor(){this.overlays=new yn(et.comparator),this.Er=new Map}getOverlay(e,t){return xe.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Gu();return xe.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.Tt(e,t,i)}),xe.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Er.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Er.delete(r)),xe.resolve()}getOverlaysForCollection(e,t,r){const s=Gu(),i=t.length+1,o=new et(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return xe.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new yn((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Gu(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Gu(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return xe.resolve(a)}Tt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Er.get(s.largestBatchId).delete(r.key);this.Er.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new rK(t,r));let i=this.Er.get(t);i===void 0&&(i=St(),this.Er.set(t,i)),this.Er.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VK{constructor(){this.sessionToken=kr.EMPTY_BYTE_STRING}getSessionToken(e){return xe.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,xe.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(){this.dr=new Xn(cr.Ar),this.Rr=new Xn(cr.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(e,t){const r=new cr(e,t);this.dr=this.dr.add(r),this.Rr=this.Rr.add(r)}mr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.gr(new cr(e,t))}pr(e,t){e.forEach(r=>this.removeReference(r,t))}yr(e){const t=new et(new ln([])),r=new cr(t,e),s=new cr(t,e+1),i=[];return this.Rr.forEachInRange([r,s],o=>{this.gr(o),i.push(o.key)}),i}wr(){this.dr.forEach(e=>this.gr(e))}gr(e){this.dr=this.dr.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const t=new et(new ln([])),r=new cr(t,e),s=new cr(t,e+1);let i=St();return this.Rr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new cr(e,0),r=this.dr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class cr{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return et.comparator(e.key,t.key)||Ct(e.br,t.br)}static Vr(e,t){return Ct(e.br,t.br)||et.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zK{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new Xn(cr.Ar)}checkEmpty(e){return xe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new nK(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.vr=this.vr.add(new cr(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return xe.resolve(o)}lookupMutationBatch(e,t){return xe.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Fr(r),i=s<0?0:s;return xe.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return xe.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return xe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new cr(t,0),s=new cr(t,Number.POSITIVE_INFINITY),i=[];return this.vr.forEachInRange([r,s],o=>{const a=this.Cr(o.br);i.push(a)}),xe.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Xn(Ct);return t.forEach(s=>{const i=new cr(s,0),o=new cr(s,Number.POSITIVE_INFINITY);this.vr.forEachInRange([i,o],a=>{r=r.add(a.br)})}),xe.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;et.isDocumentKey(i)||(i=i.child(""));const o=new cr(new et(i),0);let a=new Xn(Ct);return this.vr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.br)),!0)},o),xe.resolve(this.Mr(a))}Mr(e){const t=[];return e.forEach(r=>{const s=this.Cr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Vt(this.Or(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return xe.forEach(t.mutations,s=>{const i=new cr(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.vr=r})}Ln(e){}containsKey(e,t){const r=new cr(t,0),s=this.vr.firstAfterOrEqual(r);return xe.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,xe.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){const t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BK{constructor(e){this.Nr=e,this.docs=function(){return new yn(et.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Nr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return xe.resolve(r?r.document.mutableCopy():Vr.newInvalidDocument(t))}getEntries(e,t){let r=wa();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Vr.newInvalidDocument(s))}),xe.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=wa();const o=t.path,a=new et(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||y9(g9(h),r)<=0||(s.has(h.key)||gx(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return xe.resolve(i)}getAllFromCollectionGroup(e,t,r,s){it()}Lr(e,t){return xe.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new UK(this)}getSize(e){return xe.resolve(this.size)}}class UK extends OK{constructor(e){super(),this.hr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.hr.addEntry(e,s)):this.hr.removeEntry(r)}),xe.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WK{constructor(e){this.persistence=e,this.Br=new Cc(t=>eC(t),tC),this.lastRemoteSnapshotVersion=lt.min(),this.highestTargetId=0,this.kr=0,this.qr=new aC,this.targetCount=0,this.Qr=Zh.qn()}forEachTarget(e,t){return this.Br.forEach((r,s)=>t(s)),xe.resolve()}getLastRemoteSnapshotVersion(e){return xe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return xe.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),xe.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.kr&&(this.kr=t),xe.resolve()}Un(e){this.Br.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Qr=new Zh(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,xe.resolve()}updateTargetData(e,t){return this.Un(t),xe.resolve()}removeTargetData(e,t){return this.Br.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,xe.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Br.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Br.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),xe.waitFor(i).next(()=>s)}getTargetCount(e){return xe.resolve(this.targetCount)}getTargetData(e,t){const r=this.Br.get(t)||null;return xe.resolve(r)}addMatchingKeys(e,t,r){return this.qr.mr(t,r),xe.resolve()}removeMatchingKeys(e,t,r){this.qr.pr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),xe.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),xe.resolve()}getMatchingKeysForTargetId(e,t){const r=this.qr.Sr(t);return xe.resolve(r)}containsKey(e,t){return xe.resolve(this.qr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(e,t){this.Kr={},this.overlays={},this.$r=new hx(0),this.Ur=!1,this.Ur=!0,this.Wr=new VK,this.referenceDelegate=e(this),this.Gr=new WK(this),this.indexManager=new kK,this.remoteDocumentCache=function(s){return new BK(s)}(r=>this.referenceDelegate.zr(r)),this.serializer=new CK(t),this.jr=new LK(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new MK,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Kr[e.toKey()];return r||(r=new zK(t,this.referenceDelegate),this.Kr[e.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,r){Ve("MemoryPersistence","Starting transaction:",e);const s=new jK(this.$r.next());return this.referenceDelegate.Hr(),r(s).next(i=>this.referenceDelegate.Jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Yr(e,t){return xe.or(Object.values(this.Kr).map(r=>()=>r.containsKey(e,t)))}}class jK extends v9{constructor(e){super(),this.currentSequenceNumber=e}}class lC{constructor(e){this.persistence=e,this.Zr=new aC,this.Xr=null}static ei(e){return new lC(e)}get ti(){if(this.Xr)return this.Xr;throw it()}addReference(e,t,r){return this.Zr.addReference(r,t),this.ti.delete(r.toString()),xe.resolve()}removeReference(e,t,r){return this.Zr.removeReference(r,t),this.ti.add(r.toString()),xe.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),xe.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(s=>this.ti.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.ti.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return xe.forEach(this.ti,r=>{const s=et.fromPath(r);return this.ni(e,s).next(i=>{i||t.removeEntry(s,lt.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(r=>{r?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return xe.or([()=>xe.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class Sv{constructor(e,t){this.persistence=e,this.ri=new Cc(r=>I9(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=DK(this,t)}static ei(e,t){return new Sv(e,t)}Hr(){}Jr(e){return xe.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){const t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}nr(e){let t=0;return this.er(e,r=>{t++}).next(()=>t)}er(e,t){return xe.forEach(this.ri,(r,s)=>this.ir(e,r,s).next(i=>i?xe.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Lr(e,o=>this.ir(e,o,t).next(a=>{a||(r++,i.removeEntry(o,lt.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),xe.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ri.set(r,e.currentSequenceNumber),xe.resolve()}removeReference(e,t,r){return this.ri.set(r,e.currentSequenceNumber),xe.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),xe.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ew(e.data.value)),t}ir(e,t,r){return xe.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ri.get(t);return xe.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Wi=r,this.Gi=s}static zi(e,t){let r=St(),s=St();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new uC(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GK{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HK{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return _H()?8:x9(Wr())>0?6:4}()}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Xi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.es(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new GK;return this.ts(e,t,o).next(a=>{if(i.result=a,this.Hi)return this.ns(e,t,o,a.size)})}).next(()=>i.result)}ns(e,t,r,s){return r.documentReadCount<this.Ji?(Dh()<=It.DEBUG&&Ve("QueryEngine","SDK will not create cache indexes for query:",Oh(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),xe.resolve()):(Dh()<=It.DEBUG&&Ve("QueryEngine","Query:",Oh(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Yi*s?(Dh()<=It.DEBUG&&Ve("QueryEngine","The SDK decides to create cache indexes for query:",Oh(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,To(t))):xe.resolve())}Xi(e,t){if(GA(t))return xe.resolve(null);let r=To(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=_T(t,null,"F"),r=To(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=St(...i);return this.Zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.rs(t,a);return this.ss(t,u,o,l.readTime)?this.Xi(e,_T(t,null,"F")):this.os(e,u,t,l)}))})))}es(e,t,r,s){return GA(t)||s.isEqual(lt.min())?xe.resolve(null):this.Zi.getDocuments(e,r).next(i=>{const o=this.rs(t,i);return this.ss(t,o,r,s)?xe.resolve(null):(Dh()<=It.DEBUG&&Ve("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Oh(t)),this.os(e,o,t,m9(s,-1)).next(a=>a))})}rs(e,t){let r=new Xn(iL(e));return t.forEach((s,i)=>{gx(e,i)&&(r=r.add(i))}),r}ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ts(e,t,r){return Dh()<=It.DEBUG&&Ve("QueryEngine","Using full collection scan to execute query:",Oh(t)),this.Zi.getDocumentsMatchingQuery(e,t,$l.min(),r)}os(e,t,r,s){return this.Zi.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qK{constructor(e,t,r,s){this.persistence=e,this._s=t,this.serializer=s,this.us=new yn(Ct),this.cs=new Cc(i=>eC(i),tC),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(r)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new FK(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function KK(n,e,t,r){return new qK(n,e,t,r)}async function kL(n,e){const t=ut(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Ps(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=St();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ts:u,removedBatchIds:o,addedBatchIds:a}))})})}function XK(n,e){const t=ut(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.hs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const d=u.batch,p=d.keys();let m=xe.resolve();return p.forEach(y=>{m=m.next(()=>h.getEntry(l,y)).next(v=>{const w=u.docVersions.get(y);Vt(w!==null),v.version.compareTo(w)<0&&(d.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),h.addEntry(v)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,d))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=St();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function NL(n){const e=ut(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function QK(n,e){const t=ut(n),r=e.snapshotVersion;let s=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.hs.newChangeBuffer({trackRemovals:!0});s=t.us;const a=[];e.targetChanges.forEach((h,d)=>{const p=s.get(d);if(!p)return;a.push(t.Gr.removeMatchingKeys(i,h.removedDocuments,d).next(()=>t.Gr.addMatchingKeys(i,h.addedDocuments,d)));let m=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(kr.EMPTY_BYTE_STRING,lt.min()).withLastLimboFreeSnapshotVersion(lt.min()):h.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(h.resumeToken,r)),s=s.insert(d,m),function(v,w,b){return v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(p,m,h)&&a.push(t.Gr.updateTargetData(i,m))});let l=wa(),u=St();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(YK(i,o,e.documentUpdates).next(h=>{l=h.Is,u=h.Es})),!r.isEqual(lt.min())){const h=t.Gr.getLastRemoteSnapshotVersion(i).next(d=>t.Gr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return xe.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.us=s,i))}function YK(n,e,t){let r=St(),s=St();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=wa();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(lt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Ve("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Is:o,Es:s}})}function JK(n,e){const t=ut(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ZK(n,e){const t=ut(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Gr.getTargetData(r,e).next(i=>i?(s=i,xe.resolve(s)):t.Gr.allocateTargetId(r).next(o=>(s=new ml(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Gr.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.us.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.us=t.us.insert(r.targetId,r),t.cs.set(e,r.targetId)),r})}async function $T(n,e,t){const r=ut(n),s=r.us.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Id(o))throw o;Ve("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.us=r.us.remove(e),r.cs.delete(s.target)}function rD(n,e,t){const r=ut(n);let s=lt.min(),i=St();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const d=ut(l),p=d.cs.get(h);return p!==void 0?xe.resolve(d.us.get(p)):d.Gr.getTargetData(u,h)}(r,o,To(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r._s.getDocumentsMatchingQuery(o,e,t?s:lt.min(),t?i:St())).next(a=>(e8(r,B9(e),a),{documents:a,ds:i})))}function e8(n,e,t){let r=n.ls.get(e)||lt.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.ls.set(e,r)}class sD{constructor(){this.activeTargetIds=q9()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class t8{constructor(){this._o=new sD,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,r){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new sD,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n8{uo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){Ve("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){Ve("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sw=null;function VS(){return sw===null?sw=function(){return 268435456+Math.round(2147483648*Math.random())}():sw++,"0x"+sw.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r8={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s8{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fr="WebChannelConnection";class i8 extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+t.host,this.Mo=`projects/${s}/databases/${i}`,this.xo=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Oo(t,r,s,i,o){const a=VS(),l=this.No(t,r.toUriEncodedString());Ve("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const u={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(u,i,o),this.Bo(t,l,u,s).then(h=>(Ve("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Xh("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}ko(t,r,s,i,o,a){return this.Oo(t,r,s,i,o)}Lo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+xd}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}No(t,r){const s=r8[t];return`${this.Fo}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Bo(e,t,r,s){const i=VS();return new Promise((o,a)=>{const l=new UF;l.setWithCredentials(!0),l.listenOnce(WF.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Cw.NO_ERROR:const h=l.getResponseJson();Ve(Fr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Cw.TIMEOUT:Ve(Fr,`RPC '${e}' ${i} timed out`),a(new Ye(Ee.DEADLINE_EXCEEDED,"Request time out"));break;case Cw.HTTP_ERROR:const d=l.getStatus();if(Ve(Fr,`RPC '${e}' ${i} failed with status:`,d,"response text:",l.getResponseText()),d>0){let p=l.getResponseJson();Array.isArray(p)&&(p=p[0]);const m=p==null?void 0:p.error;if(m&&m.status&&m.message){const y=function(w){const b=w.toLowerCase().replace(/_/g,"-");return Object.values(Ee).indexOf(b)>=0?b:Ee.UNKNOWN}(m.status);a(new Ye(y,m.message))}else a(new Ye(Ee.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Ye(Ee.UNAVAILABLE,"Connection failed."));break;default:it()}}finally{Ve(Fr,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);Ve(Fr,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",u,r,15)})}qo(e,t,r){const s=VS(),i=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=HF(),a=GF(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Lo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");Ve(Fr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const d=o.createWebChannel(h,l);let p=!1,m=!1;const y=new s8({Eo:w=>{m?Ve(Fr,`Not sending because RPC '${e}' stream ${s} is closed:`,w):(p||(Ve(Fr,`Opening RPC '${e}' stream ${s} transport.`),d.open(),p=!0),Ve(Fr,`RPC '${e}' stream ${s} sending:`,w),d.send(w))},Ao:()=>d.close()}),v=(w,b,S)=>{w.listen(b,C=>{try{S(C)}catch(T){setTimeout(()=>{throw T},0)}})};return v(d,Vp.EventType.OPEN,()=>{m||(Ve(Fr,`RPC '${e}' stream ${s} transport opened.`),y.So())}),v(d,Vp.EventType.CLOSE,()=>{m||(m=!0,Ve(Fr,`RPC '${e}' stream ${s} transport closed`),y.Do())}),v(d,Vp.EventType.ERROR,w=>{m||(m=!0,Xh(Fr,`RPC '${e}' stream ${s} transport errored:`,w),y.Do(new Ye(Ee.UNAVAILABLE,"The operation could not be completed")))}),v(d,Vp.EventType.MESSAGE,w=>{var b;if(!m){const S=w.data[0];Vt(!!S);const C=S,T=(C==null?void 0:C.error)||((b=C[0])===null||b===void 0?void 0:b.error);if(T){Ve(Fr,`RPC '${e}' stream ${s} received error:`,T);const O=T.status;let V=function(N){const R=On[N];if(R!==void 0)return yL(R)}(O),k=T.message;V===void 0&&(V=Ee.INTERNAL,k="Unknown error status: "+O+" with message "+T.message),m=!0,y.Do(new Ye(V,k)),d.close()}else Ve(Fr,`RPC '${e}' stream ${s} received:`,S),y.vo(S)}}),v(a,jF.STAT_EVENT,w=>{w.stat===xT.PROXY?Ve(Fr,`RPC '${e}' stream ${s} detected buffering proxy`):w.stat===xT.NOPROXY&&Ve(Fr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.bo()},0),y}}function zS(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xx(n){return new dK(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e,t,r=1e3,s=1.5,i=6e4){this.li=e,this.timerId=t,this.Qo=r,this.Ko=s,this.$o=i,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const t=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),s=Math.max(0,t-r);s>0&&Ve("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,s,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e,t,r,s,i,o,a,l){this.li=e,this.Yo=r,this.Zo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new $L(e,t)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(e,t){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():t&&t.code===Ee.RESOURCE_EXHAUSTED?(ya(t.toString()),ya("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===Ee.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.po(t)}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Xo===t&&this.I_(r,s)},r=>{e(()=>{const s=new Ye(Ee.UNKNOWN,"Fetching auth token failed: "+r.message);return this.E_(s)})})}I_(e,t){const r=this.T_(this.Xo);this.stream=this.d_(e,t),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(s=>{r(()=>this.E_(s))}),this.stream.onMessage(s=>{r(()=>++this.n_==1?this.A_(s):this.onNext(s))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}E_(e){return Ve("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(Ve("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class o8 extends RL{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}d_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const t=mK(this.serializer,e),r=function(i){if(!("targetChange"in i))return lt.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?lt.min():o.readTime?Co(o.readTime):lt.min()}(e);return this.listener.R_(t,r)}V_(e){const t={};t.database=NT(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=TT(l)?{documents:wK(i,l)}:{query:vK(i,l).ct},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=xL(i,o.resumeToken);const u=CT(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(lt.min())>0){a.readTime=Iv(i,o.snapshotVersion.toTimestamp());const u=CT(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=bK(this.serializer,e);r&&(t.labels=r),this.c_(t)}m_(e){const t={};t.database=NT(this.serializer),t.removeTarget=e,this.c_(t)}}class a8 extends RL{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(e,t){return this.connection.qo("Write",e,t)}A_(e){return Vt(!!e.streamToken),this.lastStreamToken=e.streamToken,Vt(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){Vt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const t=yK(e.writeResults,e.commitTime),r=Co(e.commitTime);return this.listener.y_(r,t)}w_(){const e={};e.database=NT(this.serializer),this.c_(e)}g_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>gK(this.serializer,r))};this.c_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l8 extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.S_=!1}b_(){if(this.S_)throw new Ye(Ee.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,r,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Oo(e,ET(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ye(Ee.UNKNOWN,i.toString())})}ko(e,t,r,s,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.ko(e,ET(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ye(Ee.UNKNOWN,o.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class u8{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(ya(t),this.C_=!1):Ve("OnlineStateTracker",t)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c8{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=i,this.Q_.uo(o=>{r.enqueueAndForget(async()=>{Ec(this)&&(Ve("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=ut(l);u.k_.add(4),await Hm(u),u.K_.set("Unknown"),u.k_.delete(4),await bx(u)}(this))})}),this.K_=new u8(r,s)}}async function bx(n){if(Ec(n))for(const e of n.q_)await e(!0)}async function Hm(n){for(const e of n.q_)await e(!1)}function AL(n,e){const t=ut(n);t.B_.has(e.targetId)||(t.B_.set(e.targetId,e),fC(t)?dC(t):Sd(t).s_()&&hC(t,e))}function cC(n,e){const t=ut(n),r=Sd(t);t.B_.delete(e),r.s_()&&DL(t,e),t.B_.size===0&&(r.s_()?r.a_():Ec(t)&&t.K_.set("Unknown"))}function hC(n,e){if(n.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(lt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Sd(n).V_(e)}function DL(n,e){n.U_.xe(e),Sd(n).m_(e)}function dC(n){n.U_=new lK({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>n.B_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Sd(n).start(),n.K_.F_()}function fC(n){return Ec(n)&&!Sd(n).i_()&&n.B_.size>0}function Ec(n){return ut(n).k_.size===0}function OL(n){n.U_=void 0}async function h8(n){n.K_.set("Online")}async function d8(n){n.B_.forEach((e,t)=>{hC(n,e)})}async function f8(n,e){OL(n),fC(n)?(n.K_.O_(e),dC(n)):n.K_.set("Unknown")}async function p8(n,e,t){if(n.K_.set("Online"),e instanceof vL&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.B_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.B_.delete(a),s.U_.removeTarget(a))}(n,e)}catch(r){Ve("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Tv(n,r)}else if(e instanceof $w?n.U_.$e(e):e instanceof wL?n.U_.Je(e):n.U_.Ge(e),!t.isEqual(lt.min()))try{const r=await NL(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.U_.it(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.B_.get(u);h&&i.B_.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.B_.get(l);if(!h)return;i.B_.set(l,h.withResumeToken(kr.EMPTY_BYTE_STRING,h.snapshotVersion)),DL(i,l);const d=new ml(h.target,l,u,h.sequenceNumber);hC(i,d)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Ve("RemoteStore","Failed to raise snapshot:",r),await Tv(n,r)}}async function Tv(n,e,t){if(!Id(e))throw e;n.k_.add(1),await Hm(n),n.K_.set("Offline"),t||(t=()=>NL(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Ve("RemoteStore","Retrying IndexedDB access"),await t(),n.k_.delete(1),await bx(n)})}function PL(n,e){return e().catch(t=>Tv(n,t,e))}async function Ix(n){const e=ut(n),t=Ol(e);let r=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;m8(e);)try{const s=await JK(e.localStore,r);if(s===null){e.L_.length===0&&t.a_();break}r=s.batchId,g8(e,s)}catch(s){await Tv(e,s)}FL(e)&&LL(e)}function m8(n){return Ec(n)&&n.L_.length<10}function g8(n,e){n.L_.push(e);const t=Ol(n);t.s_()&&t.f_&&t.g_(e.mutations)}function FL(n){return Ec(n)&&!Ol(n).i_()&&n.L_.length>0}function LL(n){Ol(n).start()}async function y8(n){Ol(n).w_()}async function w8(n){const e=Ol(n);for(const t of n.L_)e.g_(t.mutations)}async function v8(n,e,t){const r=n.L_.shift(),s=sC.from(r,e,t);await PL(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ix(n)}async function x8(n,e){e&&Ol(n).f_&&await async function(r,s){if(function(o){return iK(o)&&o!==Ee.ABORTED}(s.code)){const i=r.L_.shift();Ol(r).__(),await PL(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ix(r)}}(n,e),FL(n)&&LL(n)}async function oD(n,e){const t=ut(n);t.asyncQueue.verifyOperationInProgress(),Ve("RemoteStore","RemoteStore received new credentials");const r=Ec(t);t.k_.add(3),await Hm(t),r&&t.K_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),await bx(t)}async function b8(n,e){const t=ut(n);e?(t.k_.delete(2),await bx(t)):e||(t.k_.add(2),await Hm(t),t.K_.set("Unknown"))}function Sd(n){return n.W_||(n.W_=function(t,r,s){const i=ut(t);return i.b_(),new o8(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Ro:h8.bind(null,n),mo:d8.bind(null,n),po:f8.bind(null,n),R_:p8.bind(null,n)}),n.q_.push(async e=>{e?(n.W_.__(),fC(n)?dC(n):n.K_.set("Unknown")):(await n.W_.stop(),OL(n))})),n.W_}function Ol(n){return n.G_||(n.G_=function(t,r,s){const i=ut(t);return i.b_(),new a8(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Ro:()=>Promise.resolve(),mo:y8.bind(null,n),po:x8.bind(null,n),p_:w8.bind(null,n),y_:v8.bind(null,n)}),n.q_.push(async e=>{e?(n.G_.__(),await Ix(n)):(await n.G_.stop(),n.L_.length>0&&(Ve("RemoteStore",`Stopping write stream with ${n.L_.length} pending writes`),n.L_=[]))})),n.G_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new da,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new pC(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ye(Ee.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mC(n,e){if(ya("AsyncQueue",`${e}: ${n}`),Id(n))return new Ye(Ee.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{static emptySet(e){return new Wh(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||et.comparator(t.key,r.key):(t,r)=>et.comparator(t.key,r.key),this.keyedMap=zp(),this.sortedSet=new yn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wh)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Wh;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{constructor(){this.z_=new yn(et.comparator)}track(e){const t=e.doc.key,r=this.z_.get(t);r?e.type!==0&&r.type===3?this.z_=this.z_.insert(t,e):e.type===3&&r.type!==1?this.z_=this.z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.z_=this.z_.remove(t):e.type===1&&r.type===2?this.z_=this.z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):it():this.z_=this.z_.insert(t,e)}j_(){const e=[];return this.z_.inorderTraversal((t,r)=>{e.push(r)}),e}}class ed{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ed(e,t,Wh.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I8{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class S8{constructor(){this.queries=lD(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(t,r){const s=ut(t),i=s.queries;s.queries=lD(),i.forEach((o,a)=>{for(const l of a.J_)l.onError(r)})})(this,new Ye(Ee.ABORTED,"Firestore shutting down"))}}function lD(){return new Cc(n=>sL(n),mx)}async function ML(n,e){const t=ut(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Y_()&&e.Z_()&&(r=2):(i=new I8,r=e.Z_()?0:1);try{switch(r){case 0:i.H_=await t.onListen(s,!0);break;case 1:i.H_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=mC(o,`Initialization of query '${Oh(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.J_.push(e),e.ea(t.onlineState),i.H_&&e.ta(i.H_)&&gC(t)}async function VL(n,e){const t=ut(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.J_.indexOf(e);o>=0&&(i.J_.splice(o,1),i.J_.length===0?s=e.Z_()?0:1:!i.Y_()&&e.Z_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function T8(n,e){const t=ut(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.J_)a.ta(s)&&(r=!0);o.H_=s}}r&&gC(t)}function _8(n,e,t){const r=ut(n),s=r.queries.get(e);if(s)for(const i of s.J_)i.onError(t);r.queries.delete(e)}function gC(n){n.X_.forEach(e=>{e.next()})}var RT,uD;(uD=RT||(RT={})).na="default",uD.Cache="cache";class zL{constructor(e,t,r){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ed(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){if(!e.fromCache||!this.Z_())return!0;const r=t!=="Offline";return(!this.options.ua||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}oa(e){if(e.docChanges.length>0)return!0;const t=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}aa(e){e=ed.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==RT.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BL{constructor(e){this.key=e}}class UL{constructor(e){this.key=e}}class C8{constructor(e,t){this.query=e,this.da=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=St(),this.mutatedKeys=St(),this.Va=iL(e),this.ma=new Wh(this.Va)}get fa(){return this.da}ga(e,t){const r=t?t.pa:new aD,s=t?t.ma:this.ma;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,d)=>{const p=s.get(h),m=gx(this.query,d)?d:null,y=!!p&&this.mutatedKeys.has(p.key),v=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let w=!1;p&&m?p.data.isEqual(m.data)?y!==v&&(r.track({type:3,doc:m}),w=!0):this.ya(p,m)||(r.track({type:2,doc:m}),w=!0,(l&&this.Va(m,l)>0||u&&this.Va(m,u)<0)&&(a=!0)):!p&&m?(r.track({type:0,doc:m}),w=!0):p&&!m&&(r.track({type:1,doc:p}),w=!0,(l||u)&&(a=!0)),w&&(m?(o=o.add(m),i=v?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{ma:o,pa:r,ss:a,mutatedKeys:i}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const o=e.pa.j_();o.sort((h,d)=>function(m,y){const v=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return it()}};return v(m)-v(y)}(h.type,d.type)||this.Va(h.doc,d.doc)),this.wa(r),s=s!=null&&s;const a=t&&!s?this.Sa():[],l=this.Ra.size===0&&this.current&&!s?1:0,u=l!==this.Aa;return this.Aa=l,o.length!==0||u?{snapshot:new ed(this.query,e.ma,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:a}:{ba:a}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new aD,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.da.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.da=this.da.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.da=this.da.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=St(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});const t=[];return e.forEach(r=>{this.Ra.has(r)||t.push(new UL(r))}),this.Ra.forEach(r=>{e.has(r)||t.push(new BL(r))}),t}va(e){this.da=e.ds,this.Ra=St();const t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return ed.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}}class E8{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class k8{constructor(e){this.key=e,this.Fa=!1}}class N8{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ma={},this.xa=new Cc(a=>sL(a),mx),this.Oa=new Map,this.Na=new Set,this.La=new yn(et.comparator),this.Ba=new Map,this.ka=new aC,this.qa={},this.Qa=new Map,this.Ka=Zh.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}}async function $8(n,e,t=!0){const r=KL(n);let s;const i=r.xa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Ca()):s=await WL(r,e,t,!0),s}async function R8(n,e){const t=KL(n);await WL(t,e,!0,!1)}async function WL(n,e,t,r){const s=await ZK(n.localStore,To(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await A8(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&AL(n.remoteStore,s),a}async function A8(n,e,t,r,s){n.Ua=(d,p,m)=>async function(v,w,b,S){let C=w.view.ga(b);C.ss&&(C=await rD(v.localStore,w.query,!1).then(({documents:k})=>w.view.ga(k,C)));const T=S&&S.targetChanges.get(w.targetId),O=S&&S.targetMismatches.get(w.targetId)!=null,V=w.view.applyChanges(C,v.isPrimaryClient,T,O);return hD(v,w.targetId,V.ba),V.snapshot}(n,d,p,m);const i=await rD(n.localStore,e,!0),o=new C8(e,i.ds),a=o.ga(i.documents),l=Gm.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);hD(n,t,u.ba);const h=new E8(e,t,o);return n.xa.set(e,h),n.Oa.has(t)?n.Oa.get(t).push(e):n.Oa.set(t,[e]),u.snapshot}async function D8(n,e,t){const r=ut(n),s=r.xa.get(e),i=r.Oa.get(s.targetId);if(i.length>1)return r.Oa.set(s.targetId,i.filter(o=>!mx(o,e))),void r.xa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await $T(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&cC(r.remoteStore,s.targetId),AT(r,s.targetId)}).catch(bd)):(AT(r,s.targetId),await $T(r.localStore,s.targetId,!0))}async function O8(n,e){const t=ut(n),r=t.xa.get(e),s=t.Oa.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),cC(t.remoteStore,r.targetId))}async function P8(n,e,t){const r=U8(n);try{const s=await function(o,a){const l=ut(o),u=Kn.now(),h=a.reduce((m,y)=>m.add(y.key),St());let d,p;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let y=wa(),v=St();return l.hs.getEntries(m,h).next(w=>{y=w,y.forEach((b,S)=>{S.isValidDocument()||(v=v.add(b))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,y)).next(w=>{d=w;const b=[];for(const S of a){const C=eK(S,d.get(S.key).overlayedDocument);C!=null&&b.push(new Xl(S.key,C,YF(C.value.mapValue),_o.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,b,a)}).next(w=>{p=w;const b=w.applyToLocalDocumentSet(d,v);return l.documentOverlayCache.saveOverlays(m,w.batchId,b)})}).then(()=>({batchId:p.batchId,changes:aL(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.qa[o.currentUser.toKey()];u||(u=new yn(Ct)),u=u.insert(a,l),o.qa[o.currentUser.toKey()]=u}(r,s.batchId,t),await qm(r,s.changes),await Ix(r.remoteStore)}catch(s){const i=mC(s,"Failed to persist write");t.reject(i)}}async function jL(n,e){const t=ut(n);try{const r=await QK(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Ba.get(i);o&&(Vt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Fa=!0:s.modifiedDocuments.size>0?Vt(o.Fa):s.removedDocuments.size>0&&(Vt(o.Fa),o.Fa=!1))}),await qm(t,r,e)}catch(r){await bd(r)}}function cD(n,e,t){const r=ut(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.xa.forEach((i,o)=>{const a=o.view.ea(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ut(o);l.onlineState=a;let u=!1;l.queries.forEach((h,d)=>{for(const p of d.J_)p.ea(a)&&(u=!0)}),u&&gC(l)}(r.eventManager,e),s.length&&r.Ma.R_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function F8(n,e,t){const r=ut(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Ba.get(e),i=s&&s.key;if(i){let o=new yn(et.comparator);o=o.insert(i,Vr.newNoDocument(i,lt.min()));const a=St().add(i),l=new vx(lt.min(),new Map,new yn(Ct),o,a);await jL(r,l),r.La=r.La.remove(i),r.Ba.delete(e),yC(r)}else await $T(r.localStore,e,!1).then(()=>AT(r,e,t)).catch(bd)}async function L8(n,e){const t=ut(n),r=e.batch.batchId;try{const s=await XK(t.localStore,e);HL(t,r,null),GL(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await qm(t,s)}catch(s){await bd(s)}}async function M8(n,e,t){const r=ut(n);try{const s=await function(o,a){const l=ut(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(d=>(Vt(d!==null),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);HL(r,e,t),GL(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await qm(r,s)}catch(s){await bd(s)}}function GL(n,e){(n.Qa.get(e)||[]).forEach(t=>{t.resolve()}),n.Qa.delete(e)}function HL(n,e,t){const r=ut(n);let s=r.qa[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.qa[r.currentUser.toKey()]=s}}function AT(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Oa.get(e))n.xa.delete(r),t&&n.Ma.Wa(r,t);n.Oa.delete(e),n.isPrimaryClient&&n.ka.yr(e).forEach(r=>{n.ka.containsKey(r)||qL(n,r)})}function qL(n,e){n.Na.delete(e.path.canonicalString());const t=n.La.get(e);t!==null&&(cC(n.remoteStore,t),n.La=n.La.remove(e),n.Ba.delete(t),yC(n))}function hD(n,e,t){for(const r of t)r instanceof BL?(n.ka.addReference(r.key,e),V8(n,r)):r instanceof UL?(Ve("SyncEngine","Document no longer in limbo: "+r.key),n.ka.removeReference(r.key,e),n.ka.containsKey(r.key)||qL(n,r.key)):it()}function V8(n,e){const t=e.key,r=t.path.canonicalString();n.La.get(t)||n.Na.has(r)||(Ve("SyncEngine","New document in limbo: "+t),n.Na.add(r),yC(n))}function yC(n){for(;n.Na.size>0&&n.La.size<n.maxConcurrentLimboResolutions;){const e=n.Na.values().next().value;n.Na.delete(e);const t=new et(ln.fromString(e)),r=n.Ka.next();n.Ba.set(r,new k8(t)),n.La=n.La.insert(t,r),AL(n.remoteStore,new ml(To(nC(t.path)),r,"TargetPurposeLimboResolution",hx.oe))}}async function qm(n,e,t){const r=ut(n),s=[],i=[],o=[];r.xa.isEmpty()||(r.xa.forEach((a,l)=>{o.push(r.Ua(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const d=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(u){s.push(u);const d=uC.zi(l.targetId,u);i.push(d)}}))}),await Promise.all(o),r.Ma.R_(s),await async function(l,u){const h=ut(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>xe.forEach(u,p=>xe.forEach(p.Wi,m=>h.persistence.referenceDelegate.addReference(d,p.targetId,m)).next(()=>xe.forEach(p.Gi,m=>h.persistence.referenceDelegate.removeReference(d,p.targetId,m)))))}catch(d){if(!Id(d))throw d;Ve("LocalStore","Failed to update sequence numbers: "+d)}for(const d of u){const p=d.targetId;if(!d.fromCache){const m=h.us.get(p),y=m.snapshotVersion,v=m.withLastLimboFreeSnapshotVersion(y);h.us=h.us.insert(p,v)}}}(r.localStore,i))}async function z8(n,e){const t=ut(n);if(!t.currentUser.isEqual(e)){Ve("SyncEngine","User change. New user:",e.toKey());const r=await kL(t.localStore,e);t.currentUser=e,function(i,o){i.Qa.forEach(a=>{a.forEach(l=>{l.reject(new Ye(Ee.CANCELLED,o))})}),i.Qa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await qm(t,r.Ts)}}function B8(n,e){const t=ut(n),r=t.Ba.get(e);if(r&&r.Fa)return St().add(r.key);{let s=St();const i=t.Oa.get(e);if(!i)return s;for(const o of i){const a=t.xa.get(o);s=s.unionWith(a.view.fa)}return s}}function KL(n){const e=ut(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=jL.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=B8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=F8.bind(null,e),e.Ma.R_=T8.bind(null,e.eventManager),e.Ma.Wa=_8.bind(null,e.eventManager),e}function U8(n){const e=ut(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=L8.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=M8.bind(null,e),e}class _v{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=xx(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,t){return null}Ya(e,t){return null}Ha(e){return KK(this.persistence,new HK,e.initialUser,this.serializer)}ja(e){return new EL(lC.ei,this.serializer)}za(e){return new t8}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_v.provider={build:()=>new _v};class W8 extends _v{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){Vt(this.persistence.referenceDelegate instanceof Sv);const r=this.persistence.referenceDelegate.garbageCollector;return new RK(r,e.asyncQueue,t)}ja(e){const t=this.cacheSizeBytes!==void 0?Is.withCacheSize(this.cacheSizeBytes):Is.DEFAULT;return new EL(r=>Sv.ei(r,t),this.serializer)}}class DT{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>cD(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=z8.bind(null,this.syncEngine),await b8(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new S8}()}createDatastore(e){const t=xx(e.databaseInfo.databaseId),r=function(i){return new i8(i)}(e.databaseInfo);return function(i,o,a,l){return new l8(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new c8(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>cD(this.syncEngine,t,0),function(){return iD.p()?new iD:new n8}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const d=new N8(s,i,o,a,l,u);return h&&(d.$a=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ut(s);Ve("RemoteStore","RemoteStore shutting down."),i.k_.add(5),await Hm(i),i.Q_.shutdown(),i.K_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}DT.provider={build:()=>new DT};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):ya("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j8{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Lr.UNAUTHENTICATED,this.clientId=KF.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Ve("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Ve("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new da;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=mC(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function BS(n,e){n.asyncQueue.verifyOperationInProgress(),Ve("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await kL(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function dD(n,e){n.asyncQueue.verifyOperationInProgress();const t=await G8(n);Ve("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>oD(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>oD(e.remoteStore,s)),n._onlineComponents=e}async function G8(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ve("FirestoreClient","Using user provided OfflineComponentProvider");try{await BS(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Ee.FAILED_PRECONDITION||s.code===Ee.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Xh("Error using user provided cache. Falling back to memory cache: "+t),await BS(n,new _v)}}else Ve("FirestoreClient","Using default OfflineComponentProvider"),await BS(n,new W8(void 0));return n._offlineComponents}async function QL(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ve("FirestoreClient","Using user provided OnlineComponentProvider"),await dD(n,n._uninitializedComponentsProvider._online)):(Ve("FirestoreClient","Using default OnlineComponentProvider"),await dD(n,new DT))),n._onlineComponents}function H8(n){return QL(n).then(e=>e.syncEngine)}async function YL(n){const e=await QL(n),t=e.eventManager;return t.onListen=$8.bind(null,e.syncEngine),t.onUnlisten=D8.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=R8.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=O8.bind(null,e.syncEngine),t}function q8(n,e,t={}){const r=new da;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new XL({next:p=>{h.eu(),o.enqueueAndForget(()=>VL(i,d));const m=p.docs.has(a);!m&&p.fromCache?u.reject(new Ye(Ee.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&p.fromCache&&l&&l.source==="server"?u.reject(new Ye(Ee.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),d=new zL(nC(a.path),h,{includeMetadataChanges:!0,ua:!0});return ML(i,d)}(await YL(n),n.asyncQueue,e,t,r)),r.promise}function K8(n,e,t={}){const r=new da;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new XL({next:p=>{h.eu(),o.enqueueAndForget(()=>VL(i,d)),p.fromCache&&l.source==="server"?u.reject(new Ye(Ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),d=new zL(a,h,{includeMetadataChanges:!0,ua:!0});return ML(i,d)}(await YL(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JL(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZL(n,e,t){if(!t)throw new Ye(Ee.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function X8(n,e,t,r){if(e===!0&&r===!0)throw new Ye(Ee.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pD(n){if(!et.isDocumentKey(n))throw new Ye(Ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mD(n){if(et.isDocumentKey(n))throw new Ye(Ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function wC(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":it()}function va(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ye(Ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=wC(n);throw new Ye(Ee.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Ye(Ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ye(Ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}X8("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=JL((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ye(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ye(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ye(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sx{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gD({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ye(Ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ye(Ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gD(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new o9;switch(r.type){case"firstParty":return new c9(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ye(Ee.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=fD.get(t);r&&(Ve("ComponentProvider","Removing Datastore"),fD.delete(t),r.terminate())}(this),Promise.resolve()}}function Q8(n,e,t,r={}){var s;const i=(n=va(n,Sx))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Xh("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Lr.MOCK_USER;else{a=wH(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new Ye(Ee.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Lr(u)}n._authCredentials=new a9(new qF(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Tx(this.firestore,e,this._query)}}class _s{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Sl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new _s(this.firestore,e,this._key)}}class Sl extends Tx{constructor(e,t,r){super(e,t,nC(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new _s(this.firestore,null,new et(e))}withConverter(e){return new Sl(this.firestore,e,this._path)}}function Y8(n,e,...t){if(n=Yn(n),ZL("collection","path",e),n instanceof Sx){const r=ln.fromString(e,...t);return mD(r),new Sl(n,null,r)}{if(!(n instanceof _s||n instanceof Sl))throw new Ye(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ln.fromString(e,...t));return mD(r),new Sl(n.firestore,null,r)}}function Qu(n,e,...t){if(n=Yn(n),arguments.length===1&&(e=KF.newId()),ZL("doc","path",e),n instanceof Sx){const r=ln.fromString(e,...t);return pD(r),new _s(n,null,new et(r))}{if(!(n instanceof _s||n instanceof Sl))throw new Ye(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ln.fromString(e,...t));return pD(r),new _s(n.firestore,n instanceof Sl?n.converter:null,new et(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new $L(this,"async_queue_retry"),this.fu=()=>{const r=zS();r&&Ve("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=e;const t=zS();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const t=zS();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const t=new da;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!Id(e))throw e;Ve("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){const t=this.gu.then(()=>(this.Ru=!0,e().catch(r=>{this.Au=r,this.Ru=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ya("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.Ru=!1,r))));return this.gu=t,t}enqueueAfterDelay(e,t,r){this.pu(),this.mu.indexOf(e)>-1&&(t=0);const s=pC.createAndSchedule(this,e,t,r,i=>this.Su(i));return this.du.push(s),s}pu(){this.Au&&it()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.du)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}class Km extends Sx{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new yD,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yD(e),this._firestoreClient=void 0,await e}}}function J8(n,e){const t=typeof n=="object"?n:tF(),r=typeof n=="string"?n:"(default)",s=B_(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=gH("firestore");i&&Q8(s,...i)}return s}function vC(n){if(n._terminated)throw new Ye(Ee.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Z8(n),n._firestoreClient}function Z8(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,u,h){return new _9(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,JL(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new j8(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e){this._byteString=e}static fromBase64String(e){try{return new td(kr.fromBase64String(e))}catch(t){throw new Ye(Ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new td(kr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ye(Ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Er(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bC{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ye(Ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ye(Ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ct(this._lat,e._lat)||Ct(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IC{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eX=/^__.*__$/;class tX{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Xl(e,this.data,this.fieldMask,t,this.fieldTransforms):new jm(e,this.data,t,this.fieldTransforms)}}class eM{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Xl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function tM(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw it()}}class SC{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Fu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new SC(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.xu({path:r,Nu:!1});return s.Lu(e),s}Bu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.xu({path:r,Nu:!1});return s.Fu(),s}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return Cv(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lu(this.path.get(e))}Lu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(tM(this.Mu)&&eX.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class nX{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||xx(e)}$u(e,t,r,s=!1){return new SC({Mu:e,methodName:t,Ku:r,path:Er.emptyPath(),Nu:!1,Qu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function nM(n){const e=n._freezeSettings(),t=xx(n._databaseId);return new nX(n._databaseId,!!e.ignoreUndefinedProperties,t)}function rX(n,e,t,r,s,i={}){const o=n.$u(i.merge||i.mergeFields?2:0,e,t,s);TC("Data must be an object, but it was:",o,r);const a=rM(r,o);let l,u;if(i.merge)l=new Ws(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const p=OT(e,d,t);if(!o.contains(p))throw new Ye(Ee.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);iM(h,p)||h.push(p)}l=new Ws(h),u=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,u=o.fieldTransforms;return new tX(new Ss(a),l,u)}class Cx extends xC{_toFieldTransform(e){if(e.Mu!==2)throw e.Mu===1?e.qu(`${this._methodName}() can only appear at the top level of your update data`):e.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Cx}}function sX(n,e,t,r){const s=n.$u(1,e,t);TC("Data must be an object, but it was:",s,r);const i=[],o=Ss.empty();Kl(r,(l,u)=>{const h=_C(e,l,t);u=Yn(u);const d=s.Bu(h);if(u instanceof Cx)i.push(h);else{const p=Ex(u,d);p!=null&&(i.push(h),o.set(h,p))}});const a=new Ws(i);return new eM(o,a,s.fieldTransforms)}function iX(n,e,t,r,s,i){const o=n.$u(1,e,t),a=[OT(e,r,t)],l=[s];if(i.length%2!=0)throw new Ye(Ee.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(OT(e,i[p])),l.push(i[p+1]);const u=[],h=Ss.empty();for(let p=a.length-1;p>=0;--p)if(!iM(u,a[p])){const m=a[p];let y=l[p];y=Yn(y);const v=o.Bu(m);if(y instanceof Cx)u.push(m);else{const w=Ex(y,v);w!=null&&(u.push(m),h.set(m,w))}}const d=new Ws(u);return new eM(h,d,o.fieldTransforms)}function Ex(n,e){if(sM(n=Yn(n)))return TC("Unsupported field value:",e,n),rM(n,e);if(n instanceof xC)return function(r,s){if(!tM(s.Mu))throw s.qu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.qu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Ex(a,s.ku(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Yn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return K9(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Kn.fromDate(r);return{timestampValue:Iv(s.serializer,i)}}if(r instanceof Kn){const i=new Kn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Iv(s.serializer,i)}}if(r instanceof bC)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof td)return{bytesValue:xL(s.serializer,r._byteString)};if(r instanceof _s){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.qu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:oC(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof IC)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.qu("VectorValues must only contain numeric values.");return rC(a.serializer,l)})}}}}}}(r,s);throw s.qu(`Unsupported field value: ${wC(r)}`)}(n,e)}function rM(n,e){const t={};return XF(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Kl(n,(r,s)=>{const i=Ex(s,e.Ou(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function sM(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Kn||n instanceof bC||n instanceof td||n instanceof _s||n instanceof xC||n instanceof IC)}function TC(n,e,t){if(!sM(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=wC(t);throw r==="an object"?e.qu(n+" a custom object"):e.qu(n+" "+r)}}function OT(n,e,t){if((e=Yn(e))instanceof _x)return e._internalPath;if(typeof e=="string")return _C(n,e);throw Cv("Field path arguments must be of type string or ",n,!1,void 0,t)}const oX=new RegExp("[~\\*/\\[\\]]");function _C(n,e,t){if(e.search(oX)>=0)throw Cv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new _x(...e.split("."))._internalPath}catch{throw Cv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Cv(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Ye(Ee.INVALID_ARGUMENT,a+n+l)}function iM(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new _s(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new aX(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(aM("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class aX extends oM{data(){return super.data()}}function aM(n,e){return typeof e=="string"?_C(n,e):e instanceof _x?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lX(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ye(Ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uX{convertValue(e,t="none"){switch(Dl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Al(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw it()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Kl(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Cn(o.doubleValue));return new IC(i)}convertGeoPoint(e){return new bC(Cn(e.latitude),Cn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=fx(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(lm(e));default:return null}}convertTimestamp(e){const t=Rl(e);return new Kn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ln.fromString(e);Vt(CL(r));const s=new um(r.get(1),r.get(3)),i=new et(r.popFirst(5));return s.isEqual(t)||ya(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cX(n,e,t){let r;return r=n?n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class lM extends oM{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Rw(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(aM("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Rw extends lM{data(e={}){return super.data(e)}}class hX{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Up(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Rw(this._firestore,this._userDataWriter,r.key,r,new Up(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ye(Ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Rw(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Up(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Rw(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Up(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:dX(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return it()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(n){n=va(n,_s);const e=va(n.firestore,Km);return q8(vC(e),n._key).then(t=>mX(e,n,t))}class uM extends uX{constructor(e){super(),this.firestore=e}convertBytes(e){return new td(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new _s(this.firestore,null,t)}}function fX(n){n=va(n,Tx);const e=va(n.firestore,Km),t=vC(e),r=new uM(e);return lX(n._query),K8(t,n._query).then(s=>new hX(e,r,n,s))}function pX(n,e,t){n=va(n,_s);const r=va(n.firestore,Km),s=cX(n.converter,e);return cM(r,[rX(nM(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,_o.none())])}function PT(n,e,t,...r){n=va(n,_s);const s=va(n.firestore,Km),i=nM(s);let o;return o=typeof(e=Yn(e))=="string"||e instanceof _x?iX(i,"updateDoc",n._key,e,t,r):sX(i,"updateDoc",n._key,e),cM(s,[o.toMutation(n._key,_o.exists(!0))])}function cM(n,e){return function(r,s){const i=new da;return r.asyncQueue.enqueueAndForget(async()=>P8(await H8(r),s,i)),i.promise}(vC(n),e)}function mX(n,e,t){const r=t.docs.get(e._key),s=new uM(n);return new lM(n,s,e._key,r,new Up(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){xd=s})(wd),qh(new nc("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Km(new l9(r.getProvider("auth-internal")),new d9(r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Ye(Ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new um(u.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Il(OA,"4.7.5",e),Il(OA,"4.7.5","esm2017")})();const gX={apiKey:"AIzaSyCuPtzyna9DGXlmqZ03dRy1uujcnbmOpy4",authDomain:"cloud-quiz-app-dca39.firebaseapp.com",projectId:"cloud-quiz-app-dca39",storageBucket:"cloud-quiz-app-dca39.firebasestorage.app",messagingSenderId:"28227889552",appId:"1:28227889552:web:7a009da7852be6739c6b15"},hM=eF(gX),fa=s9(hM),Tl=J8(hM),yX=()=>{const[n,e]=ye.useState(null),[t,r]=ye.useState([]),[s,i]=ye.useState(!0);ye.useEffect(()=>{const l=qq(fa,async h=>{if(h){const d=Qu(Tl,"users",h.uid),p=await CC(d);if(p.exists()){const m=p.data();e({...h,points:m.points||0,username:m.username||"unknown"})}}else e(null)});return(async()=>{const h=await fX(Y8(Tl,"users")),d=[];h.forEach(p=>{d.push({id:p.id,...p.data()})}),d.sort((p,m)=>m.points-p.points),r(d),i(!1)})(),()=>l()},[]);const o=async()=>{await $F(fa)},a={position:"relative",top:n?"0px":"60px"};return Ce.jsxs("div",{className:"home-container",children:[Ce.jsx("header",{className:"header",children:Ce.jsxs("div",{className:"header-content",children:[Ce.jsx("h2",{children:"CloudQuest"}),n?Ce.jsx("button",{className:"logout-button",onClick:o,children:"ログアウト"}):Ce.jsx(wo,{to:"/login",className:"login-link",children:"ログイン"})]})}),n&&Ce.jsxs("div",{className:"user-info",children:[Ce.jsxs(wo,{to:"/accountSettings",children:["アカウント設定はこちらから →",Ce.jsx("br",{})]}),Ce.jsxs("span",{children:[n.username||"unknown"," ",n.points,"P"]})]}),Ce.jsx("h2",{className:"ranking-title",style:a,children:"総合ランキング"}),Ce.jsx("div",{className:"ranking-container",style:a,children:s?Ce.jsx("p",{children:"読み込み中..."}):Ce.jsx("ul",{className:"ranking-list",children:t.map((l,u)=>Ce.jsxs("li",{className:`ranking-item ${u===0?"top-ranking-1":u===1?"top-ranking-2":u===2?"top-ranking-3":""}`,children:[Ce.jsx("span",{children:u+1}),Ce.jsx("span",{children:l.username||"unknown"}),Ce.jsxs("span",{children:[l.points,"P"]})]},l.id))})}),n?Ce.jsx(wo,{to:"/quiz",className:"quiz-button",children:"クイズに挑戦"}):Ce.jsx(wo,{to:"/Login",className:"quiz-button",style:a,children:"まずはログインしよう"})]})};var US={},Du={};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX=1e-7,vX=1e-4;class EC{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class kx{refCount(e){return ws("refCount")}incRef(e){return ws("incRef")}timerAvailable(){return!0}time(e){return ws("time")}read(e){return ws("read")}readSync(e){return ws("readSync")}readToGPU(e,t){return ws("readToGPU")}numDataIds(){return ws("numDataIds")}disposeData(e,t){return ws("disposeData")}write(e,t,r){return ws("write")}move(e,t,r,s,i){return ws("move")}createTensorFromGPUData(e,t,r){return ws("createTensorFromGPUData")}memory(){return ws("memory")}floatPrecision(){return ws("floatPrecision")}epsilon(){return this.floatPrecision()===32?wX:vX}dispose(){return ws("dispose")}}function ws(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kC(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,oa(n,e,t)}function xX(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,r=0;for(;t>0;)r=Math.random()*t|0,t--,oa(n,t,r),oa(e,t,r)}function Pl(n,e,t){return Math.max(n,Math.min(e,t))}function Nx(n){return n%2===0?n:n+1}function oa(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function dM(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function bX(n,e){const t=Math.random();return e*t+(1-t)*n}function IX(n,e){let t=0;for(let r=0;r<n.length;r++){const s=Number(n[r])-Number(e[r]);t+=s*s}return t}function B(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function yr(n,e,t=""){B(mt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function kc(n){B(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function fe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function SX(n){return n.length===0}function fM(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==null&&e[t]!==null&&n[t]!==e[t])return!1;return!0}function mt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function oc(n){return n%1===0}function TX(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function Ev(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function _X(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return kC(e),e}function Yu(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function FT(n,e=s=>0,t,r){return new Promise((s,i)=>{let o=0;const a=()=>{if(n()){s();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function NC(n,e){let t=1,r=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=n.slice();return s[r]=e/t,s}function ft(n,e){const t=e.length;return n=n==null?e.map((r,s)=>s):[].concat(n),B(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),B(n.every(r=>oc(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function $a(n,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||s?null:ft(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Jn(n,e){return mn(n,e)}function mn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function pM(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function mM(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function $C(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function fm(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function gM(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function vo(n){return typeof n=="string"||n instanceof String}function yM(n){return typeof n=="boolean"}function kv(n){return typeof n=="number"}function Nc(n){return Array.isArray(n)?Nc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":kv(n)?"float32":vo(n)?"string":yM(n)?"bool":"float32"}function Fl(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Nv(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Qe(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function wM(n,e,t,r=!1){const s=new Array;if(e.length===1){const i=e[0]*(r?2:1);for(let o=0;o<i;o++)s[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(r?2:1);for(let l=0;l<i;l++)s[l]=wM(n+l*a,o,t,r)}return s}function qs(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((s,i)=>s*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return wM(0,n,e,t)}function vM(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function $x(n,e){const t=gr(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function gr(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function RC(n,e){const t=n.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return qs(n,new Float32Array(t));if(e==="int32")return qs(n,new Int32Array(t));if(e==="bool")return qs(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Rs(n){n.forEach(e=>{B(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Wi(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function $c(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}function xa(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD="tfjsflags";class xM{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=CX,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(le().getBool("IS_TEST")||le().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];le().getBool("IS_TEST")||le().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(xa(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);wD in e&&e[wD].split(",").forEach(r=>{const[s,i]=r.split(":");this.urlFlags[s]=kX(s,i)})}}function CX(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(EX(e,r[0],r[1]),r.join("="))),e}function EX(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function kX(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function le(){return AC}let AC=null;function NX(n){AC=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let WS;function bM(){if(WS==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");WS=n}return WS}function $X(){const n=bM();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function DC(n,e){const t=$X();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const Xm="Abs",Td="Acos",_d="Acosh",Rc="Add",Qm="AddN",Rx="All",Ax="Any",Ym="ArgMax",Jm="ArgMin",Cd="Asin",Ed="Asinh",kd="Atan",Nd="Atanh",$d="Atan2",Zm="AvgPool",Dx="AvgPoolGrad",eg="AvgPool3D",Ox="AvgPool3DGrad",tg="BatchMatMul",ng="BatchToSpaceND",Px="Bincount",rg="BitwiseAnd",IM="BroadcastTo",Fx="BroadcastArgs",Rd="Cast",Ad="Ceil",Dd="ClipByValue",Lx="Complex",sg="ComplexAbs",ig="Concat",og="Conv2D",Mx="Conv2DBackpropFilter",ag="Conv2DBackpropInput",lg="Conv3D",Vx="Conv3DBackpropFilterV2",zx="Conv3DBackpropInputV2",Od="Cos",Pd="Cosh",Bx="Cumprod",ug="Cumsum",Ux="CropAndResize",Wx="DenseBincount",jx="DepthToSpace",cg="DepthwiseConv2dNative",Gx="DepthwiseConv2dNativeBackpropFilter",Hx="DepthwiseConv2dNativeBackpropInput",qx="Diag",hg="Dilation2D",$v="Dilation2DBackpropInput",Rv="Dilation2DBackpropFilter",Kx="Draw",Fd="RealDiv",Xx="Einsum",Ld="Elu",Qx="EluGrad",Md="Erf",dg="Equal",Vd="Exp",fg="ExpandDims",zd="Expm1",Yx="FFT",Jx="Fill",Zx="FlipLeftRight",Bd="Floor",Ud="FloorDiv",pg="FusedBatchNorm",mg="GatherV2",eb="GatherNd",gg="Greater",Wd="GreaterEqual",jd="Identity",tb="IFFT",nb="Imag",Gd="IsFinite",Hd="IsInf",qd="IsNan",yg="LeakyRelu",wg="Less",vg="LessEqual",rb="LinSpace",Kd="Log",Xd="Log1p",xg="LogicalAnd",bg="LogicalNot",Ig="LogicalOr",RX="LogicalXor",SM="LogSoftmax",AX="LowerBound",Sg="LRN",sb="LRNGrad",DX="MatrixBandPart",Tg="Max",Qd="Maximum",_g="MaxPool",ib="MaxPoolGrad",Cg="MaxPool3D",ob="MaxPool3DGrad",ab="MaxPoolWithArgmax",Eg="Mean",kg="Min",Yd="Minimum",Ng="MirrorPad",Jd="Mod",lb="Multinomial",Zd="Multiply",$g="Neg",Rg="NotEqual",ub="NonMaxSuppressionV3",cb="NonMaxSuppressionV4",hb="NonMaxSuppressionV5",Ag="OnesLike",Dg="OneHot",Og="Pack",Pg="PadV2",OX="Pool",ef="Pow",Fg="Prelu",Lg="Prod",db="RaggedGather",fb="RaggedRange",pb="RaggedTensorToTensor",mb="Range",gb="Real",tf="Reciprocal",nf="Relu",Mg="Reshape",Vg="ResizeNearestNeighbor",yb="ResizeNearestNeighborGrad",zg="ResizeBilinear",wb="ResizeBilinearGrad",rf="Relu6",Bg="Reverse",sf="Round",of="Rsqrt",vb="ScatterNd",xb="TensorScatterUpdate",bb="SearchSorted",Ug="Select",af="Selu",Wg="Slice",lf="Sin",uf="Sinh",cf="Sign",hf="Sigmoid",df="Softplus",ff="Sqrt",jg="Sum",Gg="SpaceToBatchND",Hg="SplitV",qg="Softmax",Ib="SparseFillEmptyRows",Sb="SparseReshape",Tb="SparseSegmentMean",_b="SparseSegmentSum",Cb="SparseToDense",pf="SquaredDifference",Eb="Square",Kg="StaticRegexReplace",kb="StridedSlice",Nb="StringNGrams",$b="StringSplit",Rb="StringToHashBucketFast",mf="Sub",gf="Tan",yf="Tanh",wf="Tile",Ab="TopK",Db="Transform",Ju="Transpose",Ob="Unique",Xg="Unpack",Qg="UnsortedSegmentSum",PX="UpperBound",Yg="ZerosLike",vf="Step",Av="FromPixels",Pb="RotateWithOffset",pm="_FusedMatMul",mm="FusedConv2D",gm="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bs(...n){le().getBool("IS_TEST")||le().getBool("PROD")||console.warn(...n)}function FX(...n){le().getBool("IS_TEST")||le().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nd=DC("kernelRegistry",()=>new Map),ym=DC("gradRegistry",()=>new Map);function wm(n,e){const t=OC(n,e);return nd.get(t)}function LT(n){return ym.get(n)}function Dv(n){const e=nd.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[i,o]=s,[a]=i.split("_");a===n&&t.push(o)}return t}function Fb(n){const{kernelName:e,backendName:t}=n,r=OC(e,t);nd.has(r)&&Bs(`The kernel '${e}' for backend '${t}' is already registered`),nd.set(r,n)}function TM(n){const{kernelName:e}=n;ym.has(e)&&le().getBool("DEBUG")&&Bs(`Overriding the gradient for '${e}'`),ym.set(e,n)}function LX(n,e){const t=OC(n,e);if(!nd.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);nd.delete(t)}function MX(n){if(!ym.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);ym.delete(n)}function VX(n,e){Dv(n).forEach(r=>{const s=Object.assign({},r,{backendName:e});Fb(s)})}function OC(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _M(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var jS,vD;function zX(){if(vD)return jS;vD=1,jS=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(R,E,L){this.low=R|0,this.high=E|0,this.unsigned=!!L}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(R){return(R&&R.__isLong__)===!0}e.isLong=t;var r={},s={};function i(R,E){var L,F,G;return E?(R>>>=0,(G=0<=R&&R<256)&&(F=s[R],F)?F:(L=a(R,(R|0)<0?-1:0,!0),G&&(s[R]=L),L)):(R|=0,(G=-128<=R&&R<128)&&(F=r[R],F)?F:(L=a(R,R<0?-1:0,!1),G&&(r[R]=L),L))}e.fromInt=i;function o(R,E){if(isNaN(R))return E?S:b;if(E){if(R<0)return S;if(R>=y)return k}else{if(R<=-v)return $;if(R+1>=v)return V}return R<0?o(-R,E).neg():a(R%m|0,R/m|0,E)}e.fromNumber=o;function a(R,E,L){return new e(R,E,L)}e.fromBits=a;var l=Math.pow;function u(R,E,L){if(R.length===0)throw Error("empty string");if(R==="NaN"||R==="Infinity"||R==="+Infinity"||R==="-Infinity")return b;if(typeof E=="number"?(L=E,E=!1):E=!!E,L=L||10,L<2||36<L)throw RangeError("radix");var F;if((F=R.indexOf("-"))>0)throw Error("interior hyphen");if(F===0)return u(R.substring(1),E,L).neg();for(var G=o(l(L,8)),Y=b,q=0;q<R.length;q+=8){var se=Math.min(8,R.length-q),X=parseInt(R.substring(q,q+se),L);if(se<8){var re=o(l(L,se));Y=Y.mul(re).add(o(X))}else Y=Y.mul(G),Y=Y.add(o(X))}return Y.unsigned=E,Y}e.fromString=u;function h(R,E){return typeof R=="number"?o(R,E):typeof R=="string"?u(R,E):a(R.low,R.high,typeof E=="boolean"?E:R.unsigned)}e.fromValue=h;var d=65536,p=1<<24,m=d*d,y=m*m,v=y/2,w=i(p),b=i(0);e.ZERO=b;var S=i(0,!0);e.UZERO=S;var C=i(1);e.ONE=C;var T=i(1,!0);e.UONE=T;var O=i(-1);e.NEG_ONE=O;var V=a(-1,2147483647,!1);e.MAX_VALUE=V;var k=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=k;var $=a(0,-2147483648,!1);e.MIN_VALUE=$;var N=e.prototype;return N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*m+(this.low>>>0):this.high*m+(this.low>>>0)},N.toString=function(E){if(E=E||10,E<2||36<E)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq($)){var L=o(E),F=this.div(L),G=F.mul(L).sub(this);return F.toString(E)+G.toInt().toString(E)}else return"-"+this.neg().toString(E);for(var Y=o(l(E,6),this.unsigned),q=this,se="";;){var X=q.div(Y),re=q.sub(X.mul(Y)).toInt()>>>0,ie=re.toString(E);if(q=X,q.isZero())return ie+se;for(;ie.length<6;)ie="0"+ie;se=""+ie+se}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq($)?64:this.neg().getNumBitsAbs();for(var E=this.high!=0?this.high:this.low,L=31;L>0&&!(E&1<<L);L--);return this.high!=0?L+33:L+1},N.isZero=function(){return this.high===0&&this.low===0},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return(this.low&1)===1},N.isEven=function(){return(this.low&1)===0},N.equals=function(E){return t(E)||(E=h(E)),this.unsigned!==E.unsigned&&this.high>>>31===1&&E.high>>>31===1?!1:this.high===E.high&&this.low===E.low},N.eq=N.equals,N.notEquals=function(E){return!this.eq(E)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(E){return this.comp(E)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(E){return this.comp(E)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(E){return this.comp(E)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(E){return this.comp(E)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(E){if(t(E)||(E=h(E)),this.eq(E))return 0;var L=this.isNegative(),F=E.isNegative();return L&&!F?-1:!L&&F?1:this.unsigned?E.high>>>0>this.high>>>0||E.high===this.high&&E.low>>>0>this.low>>>0?-1:1:this.sub(E).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq($)?$:this.not().add(C)},N.neg=N.negate,N.add=function(E){t(E)||(E=h(E));var L=this.high>>>16,F=this.high&65535,G=this.low>>>16,Y=this.low&65535,q=E.high>>>16,se=E.high&65535,X=E.low>>>16,re=E.low&65535,ie=0,j=0,Z=0,he=0;return he+=Y+re,Z+=he>>>16,he&=65535,Z+=G+X,j+=Z>>>16,Z&=65535,j+=F+se,ie+=j>>>16,j&=65535,ie+=L+q,ie&=65535,a(Z<<16|he,ie<<16|j,this.unsigned)},N.subtract=function(E){return t(E)||(E=h(E)),this.add(E.neg())},N.sub=N.subtract,N.multiply=function(E){if(this.isZero())return b;if(t(E)||(E=h(E)),n){var L=n.mul(this.low,this.high,E.low,E.high);return a(L,n.get_high(),this.unsigned)}if(E.isZero())return b;if(this.eq($))return E.isOdd()?$:b;if(E.eq($))return this.isOdd()?$:b;if(this.isNegative())return E.isNegative()?this.neg().mul(E.neg()):this.neg().mul(E).neg();if(E.isNegative())return this.mul(E.neg()).neg();if(this.lt(w)&&E.lt(w))return o(this.toNumber()*E.toNumber(),this.unsigned);var F=this.high>>>16,G=this.high&65535,Y=this.low>>>16,q=this.low&65535,se=E.high>>>16,X=E.high&65535,re=E.low>>>16,ie=E.low&65535,j=0,Z=0,he=0,ve=0;return ve+=q*ie,he+=ve>>>16,ve&=65535,he+=Y*ie,Z+=he>>>16,he&=65535,he+=q*re,Z+=he>>>16,he&=65535,Z+=G*ie,j+=Z>>>16,Z&=65535,Z+=Y*re,j+=Z>>>16,Z&=65535,Z+=q*X,j+=Z>>>16,Z&=65535,j+=F*ie+G*re+Y*X+q*se,j&=65535,a(he<<16|ve,j<<16|Z,this.unsigned)},N.mul=N.multiply,N.divide=function(E){if(t(E)||(E=h(E)),E.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&E.low===-1&&E.high===-1)return this;var L=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,E.low,E.high);return a(L,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?S:b;var F,G,Y;if(this.unsigned){if(E.unsigned||(E=E.toUnsigned()),E.gt(this))return S;if(E.gt(this.shru(1)))return T;Y=S}else{if(this.eq($)){if(E.eq(C)||E.eq(O))return $;if(E.eq($))return C;var q=this.shr(1);return F=q.div(E).shl(1),F.eq(b)?E.isNegative()?C:O:(G=this.sub(E.mul(F)),Y=F.add(G.div(E)),Y)}else if(E.eq($))return this.unsigned?S:b;if(this.isNegative())return E.isNegative()?this.neg().div(E.neg()):this.neg().div(E).neg();if(E.isNegative())return this.div(E.neg()).neg();Y=b}for(G=this;G.gte(E);){F=Math.max(1,Math.floor(G.toNumber()/E.toNumber()));for(var se=Math.ceil(Math.log(F)/Math.LN2),X=se<=48?1:l(2,se-48),re=o(F),ie=re.mul(E);ie.isNegative()||ie.gt(G);)F-=X,re=o(F,this.unsigned),ie=re.mul(E);re.isZero()&&(re=C),Y=Y.add(re),G=G.sub(ie)}return Y},N.div=N.divide,N.modulo=function(E){if(t(E)||(E=h(E)),n){var L=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,E.low,E.high);return a(L,n.get_high(),this.unsigned)}return this.sub(this.div(E).mul(E))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return a(~this.low,~this.high,this.unsigned)},N.and=function(E){return t(E)||(E=h(E)),a(this.low&E.low,this.high&E.high,this.unsigned)},N.or=function(E){return t(E)||(E=h(E)),a(this.low|E.low,this.high|E.high,this.unsigned)},N.xor=function(E){return t(E)||(E=h(E)),a(this.low^E.low,this.high^E.high,this.unsigned)},N.shiftLeft=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?a(this.low<<E,this.high<<E|this.low>>>32-E,this.unsigned):a(0,this.low<<E-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?a(this.low>>>E|this.high<<32-E,this.high>>E,this.unsigned):a(this.high>>E-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(E){if(t(E)&&(E=E.toInt()),E&=63,E===0)return this;var L=this.high;if(E<32){var F=this.low;return a(F>>>E|L<<32-E,L>>>E,this.unsigned)}else return E===32?a(L,0,this.unsigned):a(L>>>E-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},N.toBytes=function(E){return E?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var E=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,E&255,E>>>8&255,E>>>16&255,E>>>24]},N.toBytesBE=function(){var E=this.high,L=this.low;return[E>>>24,E>>>16&255,E>>>8&255,E&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},e.fromBytes=function(E,L,F){return F?e.fromBytesLE(E,L):e.fromBytesBE(E,L)},e.fromBytesLE=function(E,L){return new e(E[0]|E[1]<<8|E[2]<<16|E[3]<<24,E[4]|E[5]<<8|E[6]<<16|E[7]<<24,L)},e.fromBytesBE=function(E,L){return new e(E[4]<<24|E[5]<<16|E[6]<<8|E[7],E[0]<<24|E[1]<<16|E[2]<<8|E[3],L)},jS}var CM=zX();const EM=RP(CM),BX=Nj({__proto__:null,default:EM},[CM]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zu=EM||BX;function Jg(n){return zu.fromString(n,!0,16)}const kM=Jg("c3a5c85c97cb3127"),Mu=Jg("b492b66fbe98f273"),zr=Jg("9ae16a3b2f90404f");function MT(n){return n.xor(n.shru(47))}function NM(n,e,t){const r=n.slice(e,e+t);return zu.fromBytes(Array.from(r),!0,!0)}function Xt(n,e){return NM(n,e,8)}function xD(n,e){return NM(n,e,4)}function Gn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function _l(n,e,t=Jg("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function UX(n,e,t,r,s,i){s=s.add(n),i=Gn(i.add(s).add(r),21);const o=s;return s=s.add(e),s=s.add(t),i=i.add(Gn(s,44)),[s.add(r),i.add(o)]}function iw(n,e,t,r){return UX(Xt(n,e),Xt(n,e+8),Xt(n,e+16),Xt(n,e+24),t,r)}function WX(n,e=n.length){if(e>=8){const t=zr.add(e*2),r=Xt(n,0).add(zr),s=Xt(n,e-8),i=Gn(s,37).mul(t).add(r),o=Gn(r,25).add(s).mul(t);return _l(i,o,t)}if(e>=4){const t=zr.add(e*2),r=xD(n,0);return _l(r.shl(3).add(e),xD(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],s=n[e-1],i=t+(r<<8),o=e+(s<<2);return MT(zr.mul(i).xor(kM.mul(o))).mul(zr)}return zr}function jX(n,e=n.length){const t=zr.add(e*2),r=Xt(n,0).mul(Mu),s=Xt(n,8),i=Xt(n,e-8).mul(t),o=Xt(n,e-16).mul(zr);return _l(Gn(r.add(s),43).add(Gn(i,30)).add(o),r.add(Gn(s.add(zr),18)).add(i),t)}function GX(n,e=n.length){const t=zr.add(e*2),r=Xt(n,0).mul(zr),s=Xt(n,8),i=Xt(n,e-8).mul(t),o=Xt(n,e-16).mul(zr),a=Gn(r.add(s),43).add(Gn(i,30)).add(o),l=_l(a,r.add(Gn(s.add(zr),18)).add(i),t),u=Xt(n,16).mul(t),h=Xt(n,24),d=a.add(Xt(n,e-32)).mul(t),p=l.add(Xt(n,e-24)).mul(t);return _l(Gn(u.add(h),43).add(Gn(d,30)).add(p),u.add(Gn(h.add(r),18)).add(d),t)}function $M(n,e=n.length){const t=zu.fromNumber(81,!0);if(e<=32)return e<=16?WX(n,e):jX(n,e);if(e<=64)return GX(n,e);let r=t,s=t.mul(Mu).add(113),i=MT(s.mul(zr).add(113)).mul(zr),o=[zu.UZERO,zu.UZERO],a=[zu.UZERO,zu.UZERO];r=r.mul(zr).add(Xt(n,0));let l=0;const u=(e-1>>6)*64,h=u+(e-1&63)-63;do r=Gn(r.add(s).add(o[0]).add(Xt(n,l+8)),37).mul(Mu),s=Gn(s.add(o[1]).add(Xt(n,l+48)),42).mul(Mu),r=r.xor(a[1]),s=s.add(o[0]).add(Xt(n,l+40)),i=Gn(i.add(a[0]),33).mul(Mu),o=iw(n,l,o[1].mul(Mu),r.add(a[0])),a=iw(n,l+32,i.add(a[1]),s.add(Xt(n,l+16))),[i,r]=[r,i],l+=64;while(l!==u);const d=Mu.add(i.and(255).shl(1));return l=h,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=Gn(r.add(s).add(o[0]).add(Xt(n,l+8)),37).mul(d),s=Gn(s.add(o[1]).add(Xt(n,l+48)),42).mul(d),r=r.xor(a[1].mul(9)),s=s.add(o[0].mul(9).add(Xt(n,l+40))),i=Gn(i.add(a[0]),33).mul(d),o=iw(n,l,o[1].mul(d),r.add(a[0])),a=iw(n,l+32,i.add(a[1]),s.add(Xt(n,l+16))),[i,r]=[r,i],_l(_l(o[0],a[0],d).add(MT(s).mul(kM)).add(i),_l(o[1],a[1],d).add(r),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ra(n,e){return e==="string"?Eo(n):Ql([n],e)}function HX(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Ql(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Oo(n)),le().getBool("DEBUG")&&pM(n,e),HX(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function hr(){return le().platform.now()}function RM(n,e){return le().platform.fetch(n,e)}function Eo(n,e="utf-8"){return e=e||"utf-8",le().platform.encode(n,e)}function ba(n,e="utf-8"){return e=e||"utf-8",le().platform.decode(n,e)}function Pn(n){return le().platform.isTypedArray!=null?le().platform.isTypedArray(n):_M(n)}function Oo(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||xa(n)||n==null||Pn(n)&&t)e.push(n);else if(Array.isArray(n)||Pn(n))for(let r=0;r<n.length;++r)Oo(n[r],e,t);else{let r=-1;for(const s of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)Oo(n[s],e,t)}return e}const qX=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:mt,arraysEqualWithNull:fM,assert:B,assertNonNegativeIntegerDimensions:Rs,assertNonNull:kc,assertShapesMatch:yr,bytesFromStringArray:gM,bytesPerElement:fm,checkConversionForErrors:pM,clamp:Pl,computeStrides:Qe,convertBackendValuesAndArrayBuffer:vM,createScalarValue:Ra,createShuffledIndices:_X,decodeString:ba,distSquared:IX,encodeString:Eo,fetch:RM,fingerPrint64:$M,flatten:Oo,getArrayFromDType:mn,getTypedArrayFromDType:Jn,hasEncodingLoss:$C,hexToLong:Jg,indexToLoc:$c,inferDtype:Nc,inferFromImplicitShape:NC,isBoolean:yM,isFunction:Fl,isInt:oc,isNumber:kv,isPromise:xa,isScalarShape:SX,isString:vo,isTypedArray:Pn,isValidDtype:mM,locToIndex:Wi,makeOnesTypedArray:$x,makeZerosNestedTypedArray:RC,makeZerosTypedArray:gr,nearestDivisor:Nv,nearestLargerEven:Nx,now:hr,parseAxisParam:ft,randUniform:bX,repeatedTry:FT,rightPad:Yu,shuffle:kC,shuffleCombo:xX,sizeFromShape:fe,sizeToSquarishShape:Ev,squeezeShape:$a,sum:dM,swap:oa,tanh:TX,toNestedArray:qs,toTypedArray:Ql},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KX{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new QX)}profileKernel(e,t,r){let s;const i=()=>{s=r()};let o;const a=hr();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of s)u.dataSync();o=Promise.resolve({kernelMs:hr()-a})}if(le().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<s.length;u++){const h=s[u];h.data().then(d=>{XX(d,h.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:i,extraInfo:o}=e;r.forEach(a=>{Promise.all([a.data(),s,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function XX(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const s=n[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class QX{logKernelProfile(e,t,r,s,i,o){const a=typeof s=="number"?Yu(`${s}ms`,9):s.error,l=Yu(e,25),u=t.rank,h=t.size,d=Yu(t.shape.toString(),14);let p="";for(const m in i){const y=i[m];if(y!=null){const v=y.shape||t.shape,w=v.length;p+=`${m}: ${w}D ${w>0?v:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${d}	%c${h}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n,e,t){const r={},s={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],h=u.inputs;for(const d in h){const p=h[d];let m=!1;for(let y=0;y<e.length;y++)if(r[p.id]){u.outputs.forEach(v=>r[v.id]=!0),m=!0,s[u.id]=!0;break}if(m)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],h=u.inputs;for(let d=0;d<u.outputs.length;d++)if(i[u.outputs[d].id]){for(const p in h)i[h[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(s[u.id]&&o[u.id]){const h={};for(const p in u.inputs){const m=u.inputs[p];r[m.id]&&(h[p]=m)}const d=Object.assign({},u);d.inputs=h,d.outputs=u.outputs,a.push(d)}}return a}function JX(n,e,t,r){for(let s=e.length-1;s>=0;s--){const i=e[s],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const h=i.inputs[l];if(!mt(u.shape,h.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=u;else{const d=n[h.id];n[h.id]=r(d,u),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bD=20,Rp=3,GS=7;function ZX(n,e,t,r){const s=Qe(e),i=e7(n,e,t,s),o=e.length,a=Aw(n,e,t,s,i),l=["Tensor"];return r&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function e7(n,e,t,r){const s=fe(e),i=r[r.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?jp(n):n;if(a>1)for(let u=0;u<s/i;u++){const h=u*i;for(let d=0;d<i;d++)o[d]=Math.max(o[d],Wp(l[h+d],0,t).length)}return o}function Wp(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(GS))} + ${parseFloat(n[1].toFixed(GS))}j`:vo(n)?r=`'${n}'`:t==="bool"?r=AM(n):r=parseFloat(n.toFixed(GS)).toString(),Yu(r,e)}function AM(n){return n===0?"false":"true"}function Aw(n,e,t,r,s,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const v=jp(n);return[Wp(v[0],0,t)]}return t==="bool"?[AM(n[0])]:[n[0].toString()]}if(l===1){if(a>bD){const w=Rp*o;let b=Array.from(n.slice(0,w)),S=Array.from(n.slice((a-Rp)*o,a*o));return t==="complex64"&&(b=jp(b),S=jp(S)),["["+b.map((C,T)=>Wp(C,s[T],t)).join(", ")+", ..., "+S.map((C,T)=>Wp(C,s[a-Rp+T],t)).join(", ")+"]"]}return["["+(t==="complex64"?jp(n):Array.from(n)).map((w,b)=>Wp(w,s[b],t)).join(", ")+"]"]}const u=e.slice(1),h=r.slice(1),d=r[0]*o,p=[];if(a>bD){for(let v=0;v<Rp;v++){const w=v*d,b=w+d;p.push(...Aw(n.slice(w,b),u,t,h,s,!1))}p.push("...");for(let v=a-Rp;v<a;v++){const w=v*d,b=w+d;p.push(...Aw(n.slice(w,b),u,t,h,s,v===a-1))}}else for(let v=0;v<a;v++){const w=v*d,b=w+d;p.push(...Aw(n.slice(w,b),u,t,h,s,v===a-1))}const m=l===2?",":"";p[0]="["+(a>0?p[0]+m:"");for(let v=1;v<p.length-1;v++)p[v]=" "+p[v]+m;let y=`,
`;for(let v=2;v<l;v++)y+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":y),p}function jp(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $n{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=fe(e),r!=null){const s=r.length;B(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||mn(t,this.size),this.strides=Qe(e)}set(e,...t){t.length===0&&(t=[0]),B(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return zi().makeTensor(this.values,this.shape,this.dtype)}}let zi=null,Lh=null;function t7(n){zi=n}function n7(n){Lh=n}class Et{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=fe(e),this.strides=Qe(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Lh.buffer(this.shape,this.dtype,e)}bufferSync(){return Lh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return qs(this.shape,e,this.dtype==="complex64")}arraySync(){return qs(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=zi().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>ba(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),zi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=zi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ba(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await zi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),zi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Lh.print(this,e)}clone(){return this.throwIfDisposed(),Lh.clone(this)}toString(e=!1){const t=this.dataSync();return ZX(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Lh.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),zi().makeVariable(this,e,t,r)}}Object.defineProperty(Et,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function me(){return DC("Tensor",()=>Et)}me();class vm extends Et{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!mt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);zi().disposeTensor(this),this.dataId=e.dataId,zi().incRef(this,null)}dispose(){zi().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(vm,Symbol.hasInstance,{value:n=>n instanceof Et&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var VT;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(VT||(VT={}));var zT;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(zT||(zT={}));var BT;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(BT||(BT={}));var UT;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(UT||(UT={}));var WT;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(WT||(WT={}));const r7={float32:UT,int32:zT,bool:BT,complex64:WT};function rs(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return r7[n][e]}function Lb(n){return rs(n,"int32")}function DM(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function OM(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hn(n,e){if(n.dtype===e.dtype)return[n,e];const t=rs(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function PM(n,e){B(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function Mb(n,e){return e.some(t=>t.id===n.id)}function Ia(n){const e=[];return FM(n,e,new Set),e}function FM(n,e,t){if(n==null)return;if(n instanceof Et){e.push(n);return}if(!s7(n))return;const r=n;for(const s in r){const i=r[s];t.has(i)||(t.add(i),FM(i,e,t))}}function s7(n){return Array.isArray(n)||typeof n=="object"}const i7=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:PM,getTensorsInContainer:Ia,isTensorInList:Mb,makeTypesMatch:hn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HS(n){return n.kernelName!=null}class ID{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class rd{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ID}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Bs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new KX(this.backendInstance),!0}setupRegisteredKernels(){Dv(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Dv(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof kx)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,i=r.then(o=>s<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Bs(`Initialization of backend ${e} failed`),Bs(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Bs(`Initialization of backend ${e} failed`),Bs(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:i}=this.initializeBackend(r);if(i||s)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,i=this.readSync(t),o=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return rd.nextTensorId++}nextVariableId(){return rd.nextVariableId++}clone(e){const t=K.runKernel(jd,{x:e}),r={x:e},s=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return K.runKernel(Rd,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(wm(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let i=0;r.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=HS(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(HS(e)){const{kernelName:y,inputs:v,attrs:w}=e;this.backendName==null&&this.backend;const b=wm(y,this.backendName);B(b!=null,()=>`Cannot find registered kernel '${y}' for backend '${this.backendName}'`),a=()=>{const S=this.backend.numDataIds();l=b.kernelFunc({inputs:v,attrs:w,backend:this.backend});const C=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(y,S,C);const T=C.map(O=>O.rank!=null?O:this.makeTensorFromTensorInfo(O));if(s){const O=this.getTensorsForGradient(y,v,T);r=this.saveTensorsForBackwardMode(O)}return T}}else{const{forwardFunc:y}=e,v=w=>{s&&(r=w.map(b=>this.keep(this.clone(b))))};a=()=>{const w=this.backend.numDataIds();l=this.tidy(()=>y(this.backend,v));const b=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,w,b),b}}const{inputs:h,attrs:d}=e,p=HS(e)?null:e.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(m=this.profiler.profileKernel(u,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),t=m.outputs)}),s&&this.addTapeNode(u,h,t,p,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(y=>h[y]!=null?h[y].shape:null),outputShapes:t.map(y=>y.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){const s=LT(e);if(s!=null){const i=s.inputsToSave||[],o=s.outputsToSave||[];let a;s.saveAllInputs?(B(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=r.filter((u,h)=>o[h]);return a.concat(l)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let i=e;r==="string"&&vo(e[0])&&(i=e.map(l=>Eo(l)));const o=s.write(i,t,r),a=new Et(t,r,o,this.nextTensorId());if(this.trackTensor(a,s),r==="string"){const l=this.state.tensorInfo.get(o),u=gM(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,r,s){r=r||"float32";const i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:i}=e,o=new Et(s,i,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const i=new vm(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*fm(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof vm||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*fm(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},l=LT(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=u=>(u=u.map((h,d)=>{if(h==null){const p=r[d],m=gr(p.size,p.dtype);return this.makeTensor(m,p.shape,p.dtype)}return h}),s(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Ia(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(e,t,r,s=!1){if(B(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));B(i instanceof Et,()=>"The result y returned by f() must be a tensor.");const o=YX(this.state.activeTape,t,i);if(!s&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=r??o7(i.shape),JX(a,o,u=>this.tidy(u),a7);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const h of u.saved)h.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return B(Fl(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{B(t.every(a=>a instanceof Et),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((a,l)=>{s[l]=a});const i=(a,l)=>(r=e(...t,l),B(r.value instanceof Et,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),B(Fl(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,l)=>{const u=r.gradFunc(a,l),h=Array.isArray(u)?u:[u];B(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),B(h.every(p=>p instanceof Et),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return h.forEach((p,m)=>{d[m]=()=>p}),d};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=hr(),r=await this.backend.time(e);return r.wallMs=hr()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ID;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}rd.nextTensorId=0;rd.nextVariableId=0;function o7(n){const e=$x(fe(n),"float32");return K.makeTensor(e,n,"float32")}function LM(){const n=bM();if(n._tfengine==null){const e=new xM(n);n._tfengine=new rd(e)}return NX(n._tfengine.ENV),t7(()=>n._tfengine),n._tfengine}const K=LM();function a7(n,e){const t={a:n,b:e};return K.runKernel(Rc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(){return typeof navigator<"u"&&navigator!=null}let jT;function u7(n){jT=n}function PC(n){if(jT!==void 0)return jT;if(n||l7()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function FC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const c7=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:FC,isMobile:PC,mockIsMobile:u7},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ss=le();ss.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ss.registerFlag("IS_BROWSER",()=>FC());ss.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ss.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ss.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ss.registerFlag("PROD",()=>!1);ss.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ss.getBool("DEBUG"));ss.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ss.registerFlag("IS_TEST",()=>!1);ss.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ss.getBool("DEBUG"));ss.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ss.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ss.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Po(n,e){let t=n;if(Pn(n))return e==="string"?[]:[n.length];if(DM(n)){const s=n.channels||"RGBA";return[n.height,n.width*s.length]}else if(OM(n))return[n.buffer.size/(e==null?4:fm(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||Pn(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&le().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&MM(n,r,[]),r}function MM(n,e,t){if(t=t||[],!Array.isArray(n)&&!Pn(n)){B(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}B(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),B(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let s=0;s<n.length;++s)MM(n[s],r,t.concat(s))}function SD(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function U(n,e,t,r="numeric"){if(n instanceof me())return SD(r,n.dtype,e,t),n;let s=Nc(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),SD(r,s,e,t),n==null||!Pn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Po(n,s);!Pn(n)&&!Array.isArray(n)&&(n=[n]);const a=s!=="string"?Ql(n,s):Oo(n,[],!0);return K.makeTensor(a,i,s)}function xm(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>U(i,`${e}[${o}]`,t,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LC="__op";function Q(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+LC;const s=(...i)=>{K.startScope(t);try{const o=r(...i);return xa(o)&&console.error("Cannot return a Promise inside of tidy."),K.endScope(o),o}catch(o){throw K.endScope(null),o}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(n,e){const t=U(n,"real","complex"),r=U(e,"imag","complex");yr(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return K.runKernel(Lx,s)}const Sa=Q({complex_:h7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yl(n,e,t,r){if(r==null)r=Nc(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(OM(n)||DM(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return K.backend.createTensorFromGPUData(n,e||t,r)}if(!Pn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Rs(e);const s=fe(e),i=fe(t);B(s===i,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==fe(e.slice(o)):!0;B(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Pn(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?Ql(n,r):Oo(n,[],!0),K.makeTensor(n,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cs(n,e,t){const r=Po(n,t);return Yl(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ac={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Ji{static join(e){return new Ji(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>Pn(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+s.byteLength;this.shards.push({buffer:s,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=t-e,i=new ArrayBuffer(s),o=new Uint8Array(i);let a=0;for(let l=r;l<this.shards.length;l++){const u=this.shards[l],d=e+a-u.start,p=a,y=Math.min(t,u.end)-u.start,v=new Uint8Array(u.buffer,d,y-d);if(o.set(v,p),a+=v.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(s){return e<s.start?-1:e>=s.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=d7(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function d7(n,e){let t=0,r=n.length;for(;t<=r;){const s=Math.floor((r-t)/2)+t,i=e(n[s]);if(i===0)return s;i<0?r=s:t=s+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(){le().set("PROD",!0)}function p7(){le().set("DEBUG",!0)}function m7(){le().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function g7(n){le().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function y7(){K.disposeVariables()}function Vi(){return K}function GT(){return K.memory()}function w7(n){return K.profile(n)}function ae(n,e){return K.tidy(n,e)}function ot(n){Ia(n).forEach(t=>t.dispose())}function Fn(n){return K.keep(n)}function v7(n){return K.time(n)}function x7(n){return K.setBackend(n)}function b7(){return K.ready()}function VM(){return K.backendName}function I7(n){K.removeBackend(n)}function S7(n){return K.findBackend(n)}function T7(n){return K.findBackendFactory(n)}function MC(n,e,t=1){return K.registerBackend(n,e,t)}function VC(){return K.backend}function _7(n,e){le().setPlatform(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ll=4;async function HT(n,e){const t=[],r=[],s=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<s.length;++o){const a=s[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async d=>{const p=await l.bytes(),m=p.reduce((w,b)=>w+b.length,0)+Ll*p.length,y=new Uint8Array(m);let v=0;for(let w=0;w<p.length;w++){const b=p[w],S=new Uint8Array(new Uint32Array([b.length]).buffer);y.set(S,v),v+=Ll,y.set(b,v),v+=b.length}d(y)});r.push(h)}else r.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(r);return{data:k7(i),specs:t}}function zC(n,e){const t=new Ji(n),r={};let s=0;for(const i of e){const o=C7(i,(a,l)=>t.slice(s+a,s+l));r[i.name]=zM(i,t.slice(s,s+o)),s+=o}return r}function C7(n,e){const t=fe(n.shape);let r;if("quantization"in n){const s=n.quantization;r=ac[s.dtype]}else if(n.dtype==="string"){let s=0;for(let i=0;i<t;i++)s+=Ll+new Uint32Array(e(s,s+Ll))[0];return s}else r=ac[n.dtype];return t*r}async function E7(n,e){const t=fe(n.shape);let r;if("quantization"in n){const s=n.quantization;r=ac[s.dtype]}else if(n.dtype==="string"){let s=0;for(let i=0;i<t;i++)s+=Ll+new Uint32Array(await e(s,s+Ll))[0];return s}else r=ac[n.dtype];return t*r}function zM(n,e){const t=n.name,r=n.dtype,s=n.shape,i=fe(s);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=ac[l.dtype],h=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(r==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(h.length);for(let d=0;d<h.length;d++){const p=h[d];o[d]=p*l.scale+l.min}}else if(l.dtype==="float16")o=O7()(h);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(r==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(h.length);for(let d=0;d<h.length;d++){const p=h[d];o[d]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${r}`);a+=i*u}else if(r==="string"){const l=fe(n.shape);o=[];for(let u=0;u<l;u++){const h=new Uint32Array(e.slice(a,a+Ll))[0];a+=Ll;const d=new Uint8Array(e.slice(a,a+h));o.push(d),a+=h}}else{const l=ac[r];if(r==="float32")o=new Float32Array(e);else if(r==="int32")o=new Int32Array(e);else if(r==="bool")o=new Uint8Array(e);else if(r==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),h=new Float32Array(o.length/2);for(let y=0;y<u.length;y++)u[y]=o[y*2],h[y]=o[y*2+1];const d=Cs(u,s,"float32"),p=Cs(h,s,"float32"),m=Sa(d,p);return d.dispose(),p.dispose(),m}else throw new Error(`Unsupported dtype in weight '${t}': ${r}`);a+=i*l}return Cs(o,s,r)}async function TD(n,e,t){let r=new Uint8Array(e);for(;r.byteLength<t;){const{done:s,value:i}=await n.read();if(s&&i==null){const a=t-r.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(r.length+i.byteLength);o.set(r,0),o.set(new Uint8Array(i),r.length),r=o}return r.buffer}async function BM(n,e){const t={},r=n.getReader();let s=new ArrayBuffer(0);for(const i of e){const o=await E7(i,async(u,h)=>(s=await TD(r,s,h),s.slice(u,h)));s=await TD(r,s,o);const a=s.slice(0,o);s=s.slice(o);const l=zM(i,a);if(t[i.name]=l,VM()==="webgpu"){const u=VC();"uploadToGPU"in u&&fe(l.shape)>=le().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return t}function k7(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(i=>{r.set(new Uint8Array(i.buffer),s),s+=i.byteLength}),r.buffer}const BC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function _D(n){return BC?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function N7(n){if(BC)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function $7(n){if(BC){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function UM(n){return Ji.join(n)}function CD(n){const e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);const t=n.split(e);return t[t.length-1]}function WM(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function UC(n,e,t){const r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}async function WC(n,e){let t,r;return n.weightsManifest!=null&&([t,r]=await e(n.weightsManifest)),UC(n,t,r)}function Zg(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:_D(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:_D(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Ji(n.weightData).byteLength}}function Ov(n){const e=[];for(const t of n)e.push(...t.weights);return e}function R7(){const n=t=>{let r=t<<13,s=0;for(;!(r&8388608);)s-=8388608,r<<=1;return r&=-8388609,s+=947912704,r|s},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function A7(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function D7(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function O7(){const n=R7(),e=A7(),t=D7();return r=>{const s=new ArrayBuffer(4*r.length),i=new Uint32Array(s);for(let o=0;o<r.length;o++){const a=r[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(s)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class an{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return an.instance==null&&(an.instance=new an),an.instance}static registerSaveRouter(e){an.getInstance().saveRouters.push(e)}static registerLoadRouter(e){an.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return an.getHandlers(e,"save")}static getLoadHandlers(e,t){return an.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?an.getInstance().loadRouters:an.getInstance().saveRouters).forEach(o=>{const a=o(e,r);a!==null&&s.push(a)}),s}}const P7=n=>an.registerSaveRouter(n),F7=n=>an.registerLoadRouter(n),jM=n=>an.getSaveHandlers(n),GM=(n,e)=>an.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qT="tensorflowjs",KT=1,Hu="models_store",gl="model_info_store";function HM(){if(!le().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function XT(n){const e=n.result;e.createObjectStore(Hu,{keyPath:"modelPath"}),e.createObjectStore(gl,{keyPath:"modelPath"})}class lc{constructor(e){if(this.indexedDB=HM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const i=this.indexedDB.open(qT,KT);i.onupgradeneeded=()=>XT(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(Hu,"readonly"),u=a.objectStore(Hu).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(u.result.modelArtifacts)},u.onerror=h=>(o.close(),s(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Ji.join(t.weightData);const a=Zg(t),l=o.transaction(gl,"readwrite");let u=l.objectStore(gl),h;try{h=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return s(p)}let d;h.onsuccess=()=>{d=o.transaction(Hu,"readwrite");const p=d.objectStore(Hu);let m;try{m=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(y){return s(y)}m.onsuccess=()=>r({modelArtifactsInfo:a}),m.onerror=y=>{u=l.objectStore(gl);const v=u.delete(this.modelPath);v.onsuccess=()=>(o.close(),s(m.error)),v.onerror=w=>(o.close(),s(m.error))}},h.onerror=p=>(o.close(),s(h.error)),l.oncomplete=()=>{d==null?o.close():d.oncomplete=()=>o.close()}}},i.onerror=o=>s(i.error)})}}lc.URL_SCHEME="indexeddb://";const qM=n=>le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(lc.URL_SCHEME)?L7(n.slice(lc.URL_SCHEME.length)):null;an.registerSaveRouter(qM);an.registerLoadRouter(qM);function L7(n){return new lc(n)}function M7(n){return n.startsWith(lc.URL_SCHEME)?n.slice(lc.URL_SCHEME.length):n}class V7{constructor(){this.indexedDB=HM()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(qT,KT);r.onupgradeneeded=()=>XT(r),r.onsuccess=()=>{const s=r.result,i=s.transaction(gl,"readonly"),a=i.objectStore(gl).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(s.close(),t(a.error)),i.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=M7(e),new Promise((t,r)=>{const s=this.indexedDB.open(qT,KT);s.onupgradeneeded=()=>XT(s),s.onsuccess=()=>{const i=s.result,o=i.transaction(gl,"readwrite"),a=o.objectStore(gl),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=a.delete(e),d=()=>{u=i.transaction(Hu,"readwrite");const m=u.objectStore(Hu).delete(e);m.onsuccess=()=>t(l.result.modelArtifactsInfo),m.onerror=y=>r(l.error)};h.onsuccess=d,h.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=h=>(i.close(),r(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},s.onerror=i=>r(s.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa="/",Mh="tensorflowjs_models",KM="info",z7="model_topology",B7="weight_specs",U7="weight_data",W7="model_metadata";function XM(n){return{info:[Mh,n,KM].join(aa),topology:[Mh,n,z7].join(aa),weightSpecs:[Mh,n,B7].join(aa),weightData:[Mh,n,U7].join(aa),modelMetadata:[Mh,n,W7].join(aa)}}function QM(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function j7(n){const e=n.split(aa);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(aa)}function G7(n){return n.startsWith(uc.URL_SCHEME)?n.slice(uc.URL_SCHEME.length):n}class uc{constructor(e){if(!le().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=XM(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=Zg(e),i=Ji.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,N7(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:s}}catch{throw QM(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=$7(o),t}}uc.URL_SCHEME="localstorage://";const YM=n=>le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(uc.URL_SCHEME)?H7(n.slice(uc.URL_SCHEME.length)):null;an.registerSaveRouter(YM);an.registerLoadRouter(YM);function H7(n){return new uc(n)}class q7{constructor(){B(le().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),B(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Mh+aa,r=aa+KM;for(let s=0;s<this.LS.length;++s){const i=this.LS.key(s);if(i.startsWith(t)&&i.endsWith(r)){const o=j7(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=G7(e);const t=XM(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return QM(t),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jh="://";class Mr{constructor(){this.managers={}}static getInstance(){return Mr.instance==null&&(Mr.instance=new Mr),Mr.instance}static registerManager(e,t){B(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(jh)&&(e=e.slice(0,e.indexOf(jh))),B(e.length>0,()=>"scheme must not be an empty string.");const r=Mr.getInstance();B(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=Mr.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Mr.getInstance().managers)}}function Dw(n){if(n.indexOf(jh)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Mr.getSchemes().join(",")}`);return{scheme:n.split(jh)[0],path:n.split(jh)[1]}}async function JM(n,e,t=!1){B(n!==e,()=>`Old path and new path are the same: '${n}'`);const r=an.getLoadHandlers(n);B(r.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),B(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${n}.`);const s=r[0],i=an.getSaveHandlers(e);B(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),B(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`);const o=i[0],a=Dw(n).scheme,l=Dw(n).path,u=a===Dw(n).scheme,h=await s.load();t&&u&&await Mr.getManager(a).removeModel(l);const d=await o.save(h);return t&&!u&&await Mr.getManager(a).removeModel(l),d.modelArtifactsInfo}async function K7(){const n=Mr.getSchemes(),e={};for(const t of n){const r=await Mr.getManager(t).listModels();for(const s in r){const i=t+jh+s;e[i]=r[s]}}return e}async function X7(n){const e=Dw(n);return Mr.getManager(e.scheme).removeModel(e.path)}async function Q7(n,e){return JM(n,e,!1)}async function Y7(n,e){return JM(n,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J7{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!le().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return _M(e)}}if(le().get("IS_BROWSER")){le().setPlatform("browser",new J7);try{Mr.registerManager(uc.URL_SCHEME,new q7)}catch{}try{Mr.registerManager(lc.URL_SCHEME,new V7)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7={importFetch:()=>require("node-fetch")};let qS;class eQ{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return le().global.fetch!=null?le().global.fetch(e,t):(qS==null&&(qS=Z7.importFetch()),qS(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}le().get("IS_NODE")&&!le().get("IS_BROWSER")&&le().setPlatform("node",new eQ);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ht(n,e="float32",t){return e=e||"float32",Rs(n),new $n(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n,e){const t=U(n,"x","cast");if(!mM(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return K.runKernel(Rd,r,s)}const Re=Q({cast_:tQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(n){const t={x:U(n,"x","clone","string_or_numeric")};return K.runKernel(jd,t)}const ko=Q({clone_:nQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jC(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */LM();const rQ={buffer:ht,cast:Re,clone:ko,print:jC};n7(rQ);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n,e){let t=U(n,"a","add"),r=U(e,"b","add");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel(Rc,s)}const be=Q({add_:sQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(n,e){let t=U(n,"a","floorDiv"),r=U(e,"b","floorDiv");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel(Ud,s)}const Vb=Q({floorDiv_:iQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(n,e){let t=U(n,"a","div"),r=U(e,"b","div");if([t,r]=hn(t,r),t.dtype==="int32"&&r.dtype==="int32")return Vb(t,r);const s={a:t,b:r},i={};return K.runKernel(Fd,s,i)}const je=Q({div_:oQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(n,e){let t=U(n,"a","mul"),r=U(e,"b","mul");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel(Zd,s)}const J=Q({mul_:aQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(n){const e=U(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return K.runKernel(sg,t)}else{const t={x:e};return K.runKernel(Xm,t)}}const En=Q({abs_:lQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(n){const t={x:U(n,"x","acos")};return K.runKernel(Td,t)}const GC=Q({acos_:uQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(n){const t={x:U(n,"x","acosh")};return K.runKernel(_d,t)}const HC=Q({acosh_:cQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(n){B(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),B(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((s,i)=>U(s,`tensors${i}`,"addN")),t=e[0];e.forEach(s=>{if(s.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(s=>{if(!mt(s.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=e;return K.runKernel(Qm,r)}const ZM=Q({addN_:hQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n,e=null,t=!1){const s={x:U(n,"x","all","bool")},i={axis:e,keepDims:t};return K.runKernel(Rx,s,i)}const zb=Q({all_:dQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(n,e=null,t=!1){const s={x:U(n,"x","any","bool")},i={axis:e,keepDims:t};return K.runKernel(Ax,s,i)}const bm=Q({any_:fQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(n,e=0){const r={x:U(n,"x","argMax")},s={axis:e};return K.runKernel(Ym,r,s)}const cc=Q({argMax_:pQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(n,e=0){const r={x:U(n,"x","argMin")},s={axis:e};return K.runKernel(Jm,r,s)}const qC=Q({argMin_:mQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(n){const t={x:U(n,"x","asin")};return K.runKernel(Cd,t)}const KC=Q({asin_:gQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(n){const t={x:U(n,"x","asinh")};return K.runKernel(Ed,t)}const XC=Q({asinh_:yQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(n){const t={x:U(n,"x","atan")};return K.runKernel(kd,t)}const QC=Q({atan_:wQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vQ(n,e){let t=U(n,"a","atan2"),r=U(e,"b","atan2");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel($d,s)}const YC=Q({atan2_:vQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(n){const t={x:U(n,"x","atanh")};return K.runKernel(Nd,t)}const JC=Q({atanh_:xQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ey(n,e,t,r,s="NHWC",i){const o=n[3],a=[...e,o],l=Da(s);return tr(n,a,t,i,r,null,null,l)}function mi(n,e,t,r,s,i,o="channelsLast"){const[a,l]=Im(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return tr(n,u,t,r,s,i,!1,o)}function Aa(n,e,t,r,s,i,o="NDHWC"){const[a,l,u]=QT(e);let h,d;if(o==="NDHWC")d="channelsLast",h=[a,l,u,n[4],n[4]];else if(o==="NCDHW")d="channelsFirst",h=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Jl(n,h,t,r,s,!1,d,i)}function tr(n,e,t,r,s,i,o=!1,a="channelsLast"){let[l,u,h,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,h,d]=n;else if(a==="channelsFirst")[l,d,u,h]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,m,,y]=e,[v,w]=Im(t),[b,S]=Im(r),C=Gh(p,b),T=Gh(m,S),{padInfo:O,outHeight:V,outWidth:k}=SQ(s,u,h,v,w,C,T,i,a),$=o?y*d:y;let N;return a==="channelsFirst"?N=[l,$,V,k]:a==="channelsLast"&&(N=[l,V,k,$]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:h,inChannels:d,outHeight:V,outWidth:k,outChannels:$,padInfo:O,strideHeight:v,strideWidth:w,filterHeight:p,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:T,dilationHeight:b,dilationWidth:S,inShape:n,outShape:N,filterShape:e}}function Jl(n,e,t,r,s,i=!1,o="channelsLast",a){let[l,u,h,d,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,h,d,p]=n;else if(o==="channelsFirst")[l,p,u,h,d]=n;else throw new Error(`Unknown dataFormat ${o}`);const[m,y,v,,w]=e,[b,S,C]=QT(t),[T,O,V]=QT(r),k=Gh(m,T),$=Gh(y,O),N=Gh(v,V),{padInfo:R,outDepth:E,outHeight:L,outWidth:F}=TQ(s,u,h,d,b,S,C,k,$,N,a),G=i?w*p:w;let Y;return o==="channelsFirst"?Y=[l,G,E,L,F]:o==="channelsLast"&&(Y=[l,E,L,F,G]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:h,inWidth:d,inChannels:p,outDepth:E,outHeight:L,outWidth:F,outChannels:G,padInfo:R,strideDepth:b,strideHeight:S,strideWidth:C,filterDepth:m,filterHeight:y,filterWidth:v,effectiveFilterDepth:k,effectiveFilterHeight:$,effectiveFilterWidth:N,dilationDepth:T,dilationHeight:O,dilationWidth:V,inShape:n,outShape:Y,filterShape:e}}function bQ(n,e,t,r,s){r==null&&(r=ZC(n,e,t));const i=n[0],o=n[1],a=Sm((i-e+2*r)/t+1,s),l=Sm((o-e+2*r)/t+1,s);return[a,l]}function IQ(n,e,t,r,s,i){s==null&&(s=ZC(n,e[0],r[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*s>=e[a]&&(o[a]=Sm((n[a]-e[a]+2*s)/r[a]+1,i));return o}function ZC(n,e,t,r=1){const s=Gh(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function Im(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function QT(n){return typeof n=="number"?[n,n,n]:n}function Gh(n,e){return e<=1?n:n+(n-1)*(e-1)}function SQ(n,e,t,r,s,i,o,a,l){let u,h,d;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const m=bQ([e,t],i,r,n,a);h=m[0],d=m[1]}else if(n==="same"){h=Math.ceil(e/r),d=Math.ceil(t/s);const p=Math.max(0,(h-1)*r+i-e),m=Math.max(0,(d-1)*s+o-t),y=Math.floor(p/2),v=p-y,w=Math.floor(m/2),b=m-w;u={top:y,bottom:v,left:w,right:b,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-i+1)/r),d=Math.ceil((t-o+1)/s);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],m=l==="channelsLast"?n[1][1]:n[2][1],y=l==="channelsLast"?n[2][0]:n[3][0],v=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:m,left:y,right:v,type:p===0&&m===0&&y===0&&v===0?"VALID":"EXPLICIT"},h=Sm((e-i+p+m)/r+1,a),d=Sm((t-o+y+v)/s+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:h,outWidth:d}}function TQ(n,e,t,r,s,i,o,a,l,u,h){let d,p,m,y;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const w=IQ([e,t,r,1],[a,l,u],1,[s,i,o],n,h);p=w[0],m=w[1],y=w[2]}else if(n==="same"){p=Math.ceil(e/s),m=Math.ceil(t/i),y=Math.ceil(r/o);const v=(p-1)*s+a-e,w=(m-1)*i+l-t,b=(y-1)*o+u-r,S=Math.floor(v/2),C=v-S,T=Math.floor(w/2),O=w-T,V=Math.floor(b/2),k=b-V;d={top:T,bottom:O,left:V,right:k,front:S,back:C,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:p,outHeight:m,outWidth:y}}function Sm(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ml(n){const[e,t,r]=Im(n);return e===1&&t===1&&r===1}function wr(n,e){return Ml(n)||Ml(e)}function hc(n){return Im(n).every(e=>e>0)}function Da(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Hr(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")B(oc(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{B(oc(s),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n,e){const r={x:U(n,"x","reshape","string_or_numeric")},s={shape:e};return K.runKernel(Mg,r,s)}const ee=Q({reshape_:_Q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CQ(n,e,t,r,s){const i=U(n,"x","avgPool","float32"),o=1;B(wr(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),B(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Hr("avgPool",r,s);const u={x:a},h={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let d=K.runKernel(Zm,u,h);return d=Re(d,i.dtype),l?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const ty=Q({avgPool_:CQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(n,e,t,r,s,i="NDHWC"){const o=U(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),B(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),B(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),B(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Hr("avgPool3d",r,s);const u={x:a},h={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i};let d=K.runKernel(eg,u,h);return d=Re(d,a.dtype),l?ee(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const eE=Q({avgPool3d_:EQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n,e=0){B(n.length>=1,()=>"Pass at least one tensor to concat");const t=xm(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return ko(t[0]);const r=t,s={axis:e};return K.runKernel(ig,r,s)}const vn=Q({concat_:kQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(n,e,t=!1,r=!1){let s=U(n,"a","matMul"),i=U(e,"b","matMul");[s,i]=hn(s,i);const o={a:s,b:i},a={transposeA:t,transposeB:r};return K.runKernel(tg,o,a)}const dt=Q({matMul_:NQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(n){const t={x:U(n,"x","sigmoid","float32")};return K.runKernel(hf,t)}const ji=Q({sigmoid_:$Q});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(n,e,t){const r=U(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},i={begin:e,size:t};return K.runKernel(Wg,s,i)}const vt=Q({slice_:RQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(n){const t={x:U(n,"x","tanh","float32")};return K.runKernel(yf,t)}const Vl=Q({tanh_:AQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(n,e,t,r,s,i){const o=U(n,"forgetBias","basicLSTMCell"),a=U(e,"lstmKernel","basicLSTMCell"),l=U(t,"lstmBias","basicLSTMCell"),u=U(r,"data","basicLSTMCell"),h=U(s,"c","basicLSTMCell"),d=U(i,"h","basicLSTMCell"),p=vn([u,d],1),m=dt(p,a),y=be(m,l),v=y.shape[0],w=y.shape[1]/4,b=[v,w],S=vt(y,[0,0],b),C=vt(y,[0,w],b),T=vt(y,[0,w*2],b),O=vt(y,[0,w*3],b),V=be(J(ji(S),Vl(C)),J(h,ji(be(o,T)))),k=J(Vl(V),ji(O));return[V,k]}const eV=Q({basicLSTMCell_:DQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(n,e,t){const r=U(n,"x","batchToSpaceND"),s=e.reduce((a,l)=>a*l);B(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),B(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),B(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const i={x:r},o={blockShape:e,crops:t};return K.runKernel(ng,i,o)}const ny=Q({batchToSpaceND_:OQ});function PQ(n){let e;return n.rank===0||n.rank===1?e=ee(n,[1,1,1,n.size]):n.rank===2?e=ee(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n,e,t,r,s,i){i==null&&(i=.001);const o=U(n,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(t,"variance","batchNorm");let u;s!=null&&(u=U(s,"scale","batchNorm"));let h;r!=null&&(h=U(r,"offset","batchNorm")),B(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),B(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),B(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:PQ(o),scale:u,offset:h,mean:a,variance:l},m={varianceEpsilon:i},y=K.runKernel(pg,p,m);return ee(y,o.shape)}const xf=Q({batchNorm_:FQ});function LQ(n,e,t,r,s,i){const o=U(n,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(t,"variance","batchNorm");let u;s!=null&&(u=U(s,"scale","batchNorm"));let h;return r!=null&&(h=U(r,"offset","batchNorm")),B(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),B(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),B(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&B(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&B(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),xf(o,a,l,h,u,i)}const tE=Q({batchNorm2d_:LQ});function MQ(n,e,t,r,s,i){const o=U(n,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(t,"variance","batchNorm");let u;s!=null&&(u=U(s,"scale","batchNorm"));let h;return r!=null&&(h=U(r,"offset","batchNorm")),B(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),B(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),B(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&B(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&B(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),xf(o,a,l,h,u,i)}const nE=Q({batchNorm3d_:MQ});function VQ(n,e,t,r,s,i){const o=U(n,"x","batchNorm"),a=U(e,"mean","batchNorm"),l=U(t,"variance","batchNorm");let u;s!=null&&(u=U(s,"scale","batchNorm"));let h;return r!=null&&(h=U(r,"offset","batchNorm")),B(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),B(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),B(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&B(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&B(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),xf(o,a,l,h,u,i)}const rE=Q({batchNorm4d_:VQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zQ(n,e,t){const r=U(n,"x","bincount"),s=U(e,"weights","bincount");B(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),B(t>=0,()=>`size must be non-negative, but got ${t}.`),B(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const i={x:r,weights:s},o={size:t};return K.runKernel(Px,i,o)}const sE=Q({bincount_:zQ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(n,e){const t=U(n,"x","bitwiseAnd"),r=U(e,"y","bitwiseAnd");if(!mt(t.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${r.shape}`);if(t.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${r.dtype}`);const s={a:t,b:r};return K.runKernel(rg,s)}const tV=Q({bitwiseAnd_:BQ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UQ(n,e){const t=U(n,"s0","broadcastArgs","int32"),r=U(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:t,s1:r};return K.runKernel(Fx,s)}const nV=Q({broadcastArgs_:UQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WQ(n,e){let t=U(n,"broadcastTo","x");const r=t.shape;if(Rs(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=ee(t,u)}const s=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(s[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((u,h)=>u>1?h:-1).filter(u=>u>=0).length===0)return ko(t);const a={x:t},l={reps:i};return K.runKernel(wf,a,l)}const Zu=Q({broadcastTo_:WQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jQ(n){const t={x:U(n,"x","ceil","float32")};return K.runKernel(Ad,t)}const iE=Q({ceil_:jQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ac(n,e,t){Rs(n),t=t||Nc(e);const r={shape:n,value:e,dtype:t};return K.runKernel(Jx,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(n,e,t){const r=U(n,"x","clipByValue");if(B(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Ac(r.shape,e,r.dtype);const s={x:r},i={clipValueMin:e,clipValueMax:t};return K.runKernel(Dd,s,i)}const is=Q({clipByValue_:GQ});function HQ(n){return vn(n,0)}const oE=Q({concat1d_:HQ});function qQ(n,e){return vn(n,e)}const aE=Q({concat2d_:qQ});function KQ(n,e){return vn(n,e)}const lE=Q({concat3d_:KQ});function XQ(n,e){return vn(n,e)}const uE=Q({concat4d_:XQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QQ(n,e,t,r,s="NHWC",i=[1,1],o){const a=U(n,"x","conv2d","float32"),l=U(e,"filter","conv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),B(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),B(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Hr("conv2d",r,o);const d=s==="NHWC"?u.shape[3]:u.shape[1];B(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),B(wr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),B(hc(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),B(hc(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},m={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},y=K.runKernel(og,p,m);return h?ee(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const Ta=Q({conv2d_:QQ});function YQ(n,e,t,r,s="NWC",i=1,o){const a=U(n,"x","conv1d"),l=U(e,"filter","conv1d");let u=a,h=!1;a.rank===2&&(h=!0,u=ee(a,[1,a.shape[0],a.shape[1]])),B(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),B(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Hr("conv1d",r,o),B(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),B(wr(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),B(hc(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),B(hc(t),()=>"Error in conv1D: Stride should be larger than 0."),B(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const d=ee(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ee(u,[u.shape[0],1,u.shape[1],u.shape[2]]),w=Ta(p,d,[1,t],r,"NHWC",[1,i],o);return h?ee(w,[w.shape[2],w.shape[3]]):ee(w,[w.shape[0],w.shape[2],w.shape[3]])}const Bb=Q({conv1d_:YQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(n,e,t,r,s,i="NHWC",o){B(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),B(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),B(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),B(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];B(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),B(d===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${t.shape[3]}.`),Hr("conv2dDerInput",s,o);const p={dy:l,filter:t},m={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,inputShape:a},y=K.runKernel(ag,p,m);return u?ee(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const cE=Q({conv2DBackpropInput_:JQ});function ZQ(n,e,t,r,s,i){const o=U(n,"x","conv2dTranspose"),a=U(e,"filter","conv2dTranspose");return cE(t,o,a,r,s,"NHWC",i)}const Ub=Q({conv2dTranspose_:ZQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(n,e,t,r,s="NDHWC",i=[1,1,1]){const o=U(n,"x","conv3d"),a=U(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),B(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),B(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),B(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),B(wr(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),B(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),B(hc(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),B(hc(t),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},d={strides:t,pad:r,dataFormat:s,dilations:i},p=K.runKernel(lg,h,d);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const hE=Q({conv3d_:eY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tY(n,e,t,r,s){B(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];B(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),B(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),B(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),B(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),B(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const h={dy:o,filter:t},d={pad:s,strides:r,inputShape:i},p=K.runKernel(zx,h,d);return a?ee(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const rV=Q({conv3DBackpropInput_:tY});function nY(n,e,t,r,s){const i=U(n,"x","conv3dTranspose"),o=U(e,"filter","conv3dTranspose");return rV(t,i,o,r,s)}const dE=Q({conv3dTranspose_:nY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rY(n){const t={x:U(n,"x","cos","float32")};return K.runKernel(Od,t)}const ry=Q({cos_:rY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sY(n){const t={x:U(n,"x","cosh","float32")};return K.runKernel(Pd,t)}const Wb=Q({cosh_:sY});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iY(n,e=0,t=!1,r=!1){const i={x:U(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return K.runKernel(Bx,i,o)}const Tm=Q({cumprod_:iY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oY(n,e=0,t=!1,r=!1){const i={x:U(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return K.runKernel(ug,i,o)}const jb=Q({cumsum_:oY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(n,e,t,r=!1){const s=U(n,"x","denseBincount"),i=U(e,"weights","denseBincount");B(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),B(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),B(t>=0,()=>`size must be non-negative, but got ${t}.`),B(i.size===s.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${i.shape}.`);const o={x:s,weights:i},a={size:t,binaryOutput:r};return K.runKernel(Wx,o,a)}const Pv=Q({denseBincount_:aY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(n,e,t="NHWC"){const r=U(n,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];B(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),B(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),B(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),B(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:t};return K.runKernel(jx,a,l)}const fE=Q({depthToSpace_:lY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uY(n,e,t,r,s="NHWC",i=[1,1],o){const a=U(n,"x","depthwiseConv2d","float32"),l=U(e,"filter","depthwiseConv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),B(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),B(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=s==="NHWC"?u.shape[3]:u.shape[1];B(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),Hr("depthwiseConv2d",r,o);const p={x:u,filter:l},m={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},y=K.runKernel(cg,p,m);return h?ee(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const bf=Q({depthwiseConv2d_:uY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cY(n){const t={x:U(n,"x","diag")};return K.runKernel(qx,t)}const sV=Q({diag_:cY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(n,e,t,r,s=[1,1],i="NHWC"){const o=U(n,"x","dilation2d"),a=U(e,"filter","dilation2d");B(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),B(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),B(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),B(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},d={strides:t,pad:r,dilations:s},p=K.runKernel(hg,h,d);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const pE=Q({dilation2d_:hY});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dc(n,e){const t=n.length,r=[];for(let s=0;s<t;s++){const i=t-1-s,o=n[i]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(i)}return r}function Rn(n,e){const t=[];for(let r=0;r<e.length;r++){const s=n[n.length-r-1],i=e.length-r-1,o=e[i];(s==null||s===1&&o>1)&&t.unshift(i)}return t}function at(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let s=0;s<t;s++){let i=n[n.length-s-1];i==null&&(i=1);let o=e[e.length-s-1];if(o==null&&(o=1),i===1)r[t-s-1]=o;else if(o===1)r[t-s-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else r[t-s-1]=i}return r}const dY=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:at,getBroadcastDims:dc,getReductionAxes:Rn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(n,e){let t=U(n,"a","equal","string_or_numeric"),r=U(e,"b","equal","string_or_numeric");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(dg,s)}const Es=Q({equal_:fY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pY(n,e,t){const r=U(e,"a","where"),s=U(t,"b","where"),i=U(n,"condition","where","bool"),o=at(at(i.shape,r.shape),s.shape),a=Zu(i,o),l=Zu(r,o),u=Zu(s,o),h={condition:a,t:l,e:u};return K.runKernel(Ug,h)}const Qn=Q({where_:pY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mY(n){const t={x:U(n,"x","zerosLike")};return K.runKernel(Yg,t)}const xt=Q({zerosLike_:mY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gY(n,e){let t=U(n,"a","div"),r=U(e,"b","div");[t,r]=hn(t,r);const s=je(t,r),i=xt(s),o=Es(r,i);return Qn(o,i,s)}const mE=Q({divNoNan_:gY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(n,e){const t=U(n,"t1","dot"),r=U(e,"t2","dot");B((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(B(s===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${i}.`),t.rank===1&&r.rank===1){const o=ee(t,[1,-1]),a=ee(r,[-1,1]),l=dt(o,a);return ee(l,[])}else if(t.rank===1&&r.rank===2){const o=ee(t,[1,-1]),a=ee(r,[r.shape[0],r.shape[1]]),l=dt(o,a);return ee(l,[l.size])}else if(t.rank===2&&r.rank===1){const o=ee(r,[-1,1]),a=dt(t,o);return ee(a,[a.size])}else{const o=ee(r,[r.shape[0],r.shape[1]]);return dt(t,o)}}const gE=Q({dot_:yY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n,...e){const t=e.map((s,i)=>U(s,`tensors${i}`,"einsum")),r={equation:n};return K.runKernel(Xx,t,r)}const Bu=Q({einsum_:wY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n){const t={x:U(n,"x","elu","float32")};return K.runKernel(Ld,t)}const If=Q({elu_:vY});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n,e){const t=U(n,"x","ensureShape","string_or_numeric");if(!fM(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return n}const iV=Q({ensureShape_:xY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(n){let e=U(n,"x","erf");B(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Re(e,"float32"));const t={x:e};return K.runKernel(Md,t)}const Gb=Q({erf_:bY});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function oV(n,e,t){const r=n.length+e.length,s=[];let i=0,o=0;for(let a=0;a<r;a++)t.indexOf(a)===-1?s.push(n[i++]):s.push(e[o++]);return s}function nr(n,e){const t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);const s=e.map(i=>n[i]);return[t,s]}function xn(n,e){const t=e.map(r=>1);return oV(n,t,e)}function vr(n,e,t){B(yE(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function dn(n,e){if(yE(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function Zl(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function bn(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IY(n,e=null,t=!1){const s={x:U(n,"x","max")},i={reductionIndices:e,keepDims:t};return K.runKernel(Tg,s,i)}const Ks=Q({max_:IY});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(n,e=null,t=!1){const s={x:U(n,"x","min")},i={axis:e,keepDims:t};return K.runKernel(kg,s,i)}const sd=Q({min_:SY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(n,e){let t=U(n,"base","pow"),r=U(e,"exp","pow");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel(ef,s)}const Fo=Q({pow_:TY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xe(n,e){if((Pn(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Pn(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Yl(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Y(n){const t={x:U(n,"x","sqrt","float32")};return K.runKernel(ff,t)}const Zn=Q({sqrt_:_Y});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n){const e=U(n,"x","square"),t={};return K.runKernel("Square",{x:e},t)}const Ut=Q({square_:CY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(n,e=null,t=!1){let r=U(n,"x","sum");r.dtype==="bool"&&(r=Re(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return K.runKernel(jg,s,i)}const ze=Q({sum_:EY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(n,e="euclidean",t=null,r=!1){n=U(n,"x","norm");const s=aV(n,e,t);let i=s.shape;if(r){const o=ft(t,n.shape);i=xn(s.shape,o)}return ee(s,i)}function aV(n,e,t=null){if(n.rank===0)return En(n);if(n.rank!==1&&t===null)return aV(ee(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return ze(En(n),t);if(e===1/0)return Ks(En(n),t);if(e===-1/0)return sd(En(n),t);if(e==="euclidean"||e===2)return Zn(ze(Fo(En(n),Xe(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Ks(ze(En(n),t[0]),t[1]-1);if(e===1/0)return Ks(ze(En(n),t[1]),t[0]);if(e===-1/0)return sd(ze(En(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Zn(ze(Ut(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Sf=Q({norm_:kY});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(n,e=null,t=!1){return Sf(n,"euclidean",e,t)}const wE=Q({euclideanNorm_:NY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(n){const t={x:U(n,"x","exp")};return K.runKernel(Vd,t)}const os=Q({exp_:$Y});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(n,e=0){const t=U(n,"x","expandDims","string_or_numeric");B(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return K.runKernel(fg,r,s)}const dr=Q({expandDims_:RY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(n){const t={x:U(n,"x","expm1")};return K.runKernel(zd,t)}const vE=Q({expm1_:AY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(n,e){const t=U(n,"x","tile","string_or_numeric");B(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return K.runKernel(wf,r,s)}const js=Q({tile_:DY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(n,e,t,r="float32"){e==null&&(e=n);const s=ht([n,e],r),i=n<=e?n:e;for(let a=0;a<i;++a)s.set(1,a,a);const o=ee(s.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return js(dr(o,0),[t[0],1,1]);if(t.length===2)return js(dr(dr(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return js(dr(dr(dr(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Hb=Q({eye_:OY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(n){const t={x:U(n,"x","floor","float32")};return K.runKernel(Bd,t)}const Tf=Q({floor_:PY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(n,e,t=0,r=0){const s=U(n,"x","gather"),i=U(e,"indices","gather","int32"),o={x:s,indices:i},a={axis:t,batchDims:r};return K.runKernel(mg,o,a)}const _f=Q({gather_:FY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(n,e){let t=U(n,"a","greater","string_or_numeric"),r=U(e,"b","greater","string_or_numeric");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(gg,s)}const qr=Q({greater_:LY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MY(n,e){let t=U(n,"a","greaterEqual","string_or_numeric"),r=U(e,"b","greaterEqual","string_or_numeric");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(Wd,s)}const Oa=Q({greaterEqual_:MY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VY(n){const t={input:U(n,"input","imag")};return K.runKernel(nb,t)}const sy=Q({imag_:VY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zY(n){const t={x:U(n,"x","isFinite")};return K.runKernel(Gd,t)}const xE=Q({isFinite_:zY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BY(n){const t={x:U(n,"x","isInf")};return K.runKernel(Hd,t)}const bE=Q({isInf_:BY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(n){const t={x:U(n,"x","isNaN")};return K.runKernel(qd,t)}const IE=Q({isNaN_:UY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WY(n,e=.2){const r={x:U(n,"x","leakyRelu")},s={alpha:e};return K.runKernel(yg,r,s)}const iy=Q({leakyRelu_:WY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jY(n,e){let t=U(n,"a","less","string_or_numeric"),r=U(e,"b","less","string_or_numeric");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(wg,s)}const id=Q({less_:jY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GY(n,e){let t=U(n,"a","lessEqual","string_or_numeric"),r=U(e,"b","lessEqual","string_or_numeric");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(vg,s)}const eu=Q({lessEqual_:GY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const r={start:n,stop:e,num:t};return K.runKernel(rb,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HY(n,e=5,t=1,r=1,s=.5){const i=U(n,"x","localResponseNormalization");B(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),B(oc(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:r,beta:s},h=K.runKernel(Sg,l,u);return a?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const SE=Q({localResponseNormalization_:HY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(n){const t={x:U(n,"x","log","float32")};return K.runKernel(Kd,t)}const ks=Q({log_:qY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(n){const t={x:U(n,"x","log1p")};return K.runKernel(Xd,t)}const oy=Q({log1p_:KY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XY(n){return B(Fl(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const r=U(e,"x","tf.grad","string_or_numeric"),s=t!=null?U(t,"dy","tf.grad"):null;return K.tidy(()=>{const{value:i,grads:o}=K.gradients(()=>n(r),[r],s);return s!=null&&yr(i.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),qb(o),o[0]})}}function QY(n){return B(Fl(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{B(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=xm(e,"args","tf.grads","string_or_numeric"),s=t!=null?U(t,"dy","tf.grads"):null;return K.tidy(()=>{const{value:i,grads:o}=K.gradients(()=>n(...r),r,s);return s!=null&&yr(i.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),qb(o),o})}}function YY(n){return B(Fl(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{B(e instanceof Et,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),B(t==null||t instanceof Et,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:s}=K.gradients(()=>n(e),[e],t);return qb(r),{grad:r[0],value:s}}}function JY(n){return B(Fl(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{B(Array.isArray(e)&&e.every(s=>s instanceof Et),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),B(t==null||t instanceof Et,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=K.gradients(()=>n(...e),e,t);return t!=null&&yr(r.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),qb(r.grads),r}}function uV(n,e){B(Fl(n),()=>"The f passed in variableGrads(f) must be a function"),B(e==null||Array.isArray(e)&&e.every(u=>u instanceof vm),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in K.registeredVariables)e.push(K.registeredVariables[u])}const r=t?e.filter(u=>!u.trainable):null,s=e.length;e=e.filter(u=>u.trainable),B(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const i=!0,{value:o,grads:a}=K.gradients(n,e,null,i);B(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),B(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,h)=>{a[h]!=null&&(l[u.name]=a[h])}),r!=null&&r.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Lo(n){return K.customGrad(n)}function qb(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(n){const t={x:U(n,"x","neg")};return K.runKernel($g,t)}const Qt=Q({neg_:ZY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eJ(n){const t={x:U(n,"x","softplus")};return K.runKernel(df,t)}const Dc=Q({softplus_:eJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tJ(n){const e=U(n,"x","logSigmoid");return Lo(r=>({value:Qt(Dc(Qt(r))),gradFunc:o=>J(o,ji(Qt(r)))}))(e)}const TE=Q({logSigmoid_:tJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nJ(n,e){let t=U(n,"a","sub"),r=U(e,"b","sub");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel(mf,s)}const Le=Q({sub_:nJ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rJ(n,e=-1){const t=U(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Lo((s,i)=>{const a=Ks(s,e,!0),l=Le(s,a),u=Le(Re(l,"float32"),ks(ze(os(l),e,!0)));return i([u]),{value:u,gradFunc:(d,p)=>{const[m]=p,y=!0,v=os(m);return Le(d,J(ze(d,e,y),v))}}})(t)}const Kb=Q({logSoftmax_:rJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sJ(n,e=null,t=!1){const r=U(n,"x","logSumExp"),s=ft(e,r.shape),i=Ks(r,s,!0),o=Le(r,i),a=os(o),l=ze(a,s),u=ks(l),h=be(ee(i,u.shape),u);if(t){const d=xn(h.shape,s);return ee(h,d)}return h}const ay=Q({logSumExp_:sJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iJ(n,e){const t=U(n,"a","logicalAnd","bool"),r=U(e,"b","logicalAnd","bool");at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(xg,s)}const pi=Q({logicalAnd_:iJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(n){const t={x:U(n,"x","logicalNot","bool")};return K.runKernel(bg,t)}const ly=Q({logicalNot_:oJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(n,e){const t=U(n,"a","logicalOr","bool"),r=U(e,"b","logicalOr","bool");at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(Ig,s)}const Xb=Q({logicalOr_:aJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(n,e){const t=U(n,"a","logicalXor","bool"),r=U(e,"b","logicalXor","bool");return at(t.shape,r.shape),pi(Xb(n,e),ly(pi(n,e)))}const _E=Q({logicalXor_:lJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ow=2147483648;function uJ(n,e,t="left"){const r=U(n,"sortedSequence","searchSorted"),s=U(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=s.shape[s.shape.length-1],a=ee(r,[-1,i]),l=ee(s,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(fe(l.shape)>=ow)throw new Error(`values tensor size must less than ${ow}`);if(a.shape[1]>=ow)throw new Error(`trailing dim_size must less than ${ow} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},h={side:t};return K.runKernel(bb,u,h)}const Qb=Q({searchSorted_:uJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n,e){return Qb(n,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cJ(n,e,t,r,s){const i=U(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),B(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),B(wr(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Hr("maxPool",r,s);const u={x:a},h={filterSize:e,strides:t,pad:r,dimRoundingMode:s},d=K.runKernel(_g,u,h);return l?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const uy=Q({maxPool_:cJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(n,e=[1,1,1],t,r,s,i="NDHWC"){const o=U(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),B(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),B(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Hr("maxPool3d",r,s);const u={x:a},h={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i},d=K.runKernel(Cg,u,h);return l?ee(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const CE=Q({maxPool3d_:hJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dJ(n,e,t,r,s=!1){const o={x:U(n,"x","maxPoolWithArgmax")},a={filterSize:e,strides:t,pad:r,includeBatchInIndex:s},l=K.runKernel(ab,o,a);return{result:l[0],indexes:l[1]}}const hV=Q({maxPoolWithArgmax_:dJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fJ(n,e){let t=U(n,"a","maximum"),r=U(e,"b","maximum");[t,r]=hn(t,r),t.dtype==="bool"&&(t=Re(t,"int32"),r=Re(r,"int32")),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(Qd,s)}const zo=Q({maximum_:fJ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pJ(n,e=null,t=!1){const s={x:U(n,"x","mean")},i={axis:e,keepDims:t};return K.runKernel(Eg,s,i)}const un=Q({mean_:pJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kn(n,e="float32"){if(Rs(n),e==="complex64"){const r=kn(n,"float32"),s=kn(n,"float32");return Sa(r,s)}const t=gr(fe(n),e);return K.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ts(n,e="float32"){if(Rs(n),e==="complex64"){const r=ts(n,"float32"),s=kn(n,"float32");return Sa(r,s)}const t=$x(fe(n),e);return K.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let r=U(n,"x","meshgrid",n instanceof Et?n.dtype:"float32");if(e===void 0)return[r];let s=U(e,"y","meshgrid",e instanceof Et?e.dtype:"float32");const i=fe(r.shape),o=fe(s.shape);return t==="xy"?(r=ee(r,[1,-1]),s=ee(s,[-1,1]),[dt(ts([o,1],r.dtype),r),dt(s,ts([1,i],s.dtype))]):(r=ee(r,[-1,1]),s=ee(s,[1,-1]),[dt(r,ts([1,o],r.dtype)),dt(ts([i,1],s.dtype),s)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mJ(n,e){let t=U(n,"a","minimum"),r=U(e,"b","minimum");[t,r]=hn(t,r),t.dtype==="bool"&&(t=Re(t,"int32"),r=Re(r,"int32")),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(Yd,s)}const zl=Q({minimum_:mJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(n,e,t){B(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=U(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");B(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let a=0;a<r.rank;a++)B(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),B(e[a][0]>=0&&e[a][0]<=r.shape[a]-s&&e[a][1]>=0&&e[a][1]<=r.shape[a]-s,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-s} or less than 0 for input of shape ${r.shape}`);const i={paddings:e,mode:t},o={x:r};return K.runKernel(Ng,o,i)}const EE=Q({mirrorPad_:gJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yJ(n,e){let t=U(n,"a","mod"),r=U(e,"b","mod");[t,r]=hn(t,r);const s={a:t,b:r};return K.runKernel(Jd,s)}const kE=Q({mod_:yJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wJ(n,e=null,t=!1){n=U(n,"x","moments");const r=ft(e,n.shape),s=un(n,r,t);let i=s.shape;t||(i=xn(s.shape,r));const o=Ut(Le(Re(n,"float32"),ee(s,i))),a=un(o,r,t);return{mean:s,variance:a}}const cy=Q({moments_:wJ});function vJ(n,e,t,r){const s=U(e,"data","multiRNNCell"),i=xm(t,"c","multiRNNCell"),o=xm(r,"h","multiRNNCell");let a=s;const l=[];for(let d=0;d<n.length;d++){const p=n[d](a,i[d],o[d]);l.push(p[0]),l.push(p[1]),a=p[1]}const u=[],h=[];for(let d=0;d<l.length;d+=2)u.push(l[d]),h.push(l[d+1]);return[u,h]}const fV=Q({multiRNNCell_:vJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xJ(n,e,t,r=!1){const s=U(n,"logits","multinomial"),i=s.size,o=s.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();const l={logits:o===1?ee(s,[1,-1]):s},u={numSamples:e,seed:t,normalized:r},h=K.runKernel(lb,l,u);return o===1?ee(h,[h.size]):h}const pV=Q({multinomial_:xJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bJ(n,e){let t=U(n,"a","notEqual","string_or_numeric"),r=U(e,"b","notEqual","string_or_numeric");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r};return K.runKernel(Rg,s)}const fc=Q({notEqual_:bJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IJ(n,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:U(n,"indices","oneHot","int32")},a={dtype:s,depth:e,onValue:t,offValue:r};return K.runKernel(Dg,o,a)}const od=Q({oneHot_:IJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SJ(n){const t={x:U(n,"x","onesLike")};return K.runKernel(Ag,t)}const Ns=Q({onesLike_:SJ});function TJ(n,e){const t=U(n,"v1","outerProduct"),r=U(e,"v2","outerProduct");B(t.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${r.rank}.`);const s=ee(t,[-1,1]),i=ee(r,[1,-1]);return dt(s,i)}const mV=Q({outerProduct_:TJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _J(n,e,t=0){const r=U(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},i={x:r};return K.runKernel(Pg,i,s)}const Pa=Q({pad_:_J});function CJ(n,e,t=0){return B(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Pa(n,[e],t)}const gV=Q({pad1d_:CJ});function EJ(n,e,t=0){return B(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Pa(n,e,t)}const yV=Q({pad2d_:EJ});function kJ(n,e,t=0){return B(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Pa(n,e,t)}const wV=Q({pad3d_:kJ});function NJ(n,e,t=0){return B(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Pa(n,e,t)}const vV=Q({pad4d_:NJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $J(n,e,t){const r=U(n,"x","spaceToBatchND");B(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),B(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),B(r.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},i={blockShape:e,paddings:t};return K.runKernel(Gg,s,i)}const hy=Q({spaceToBatchND_:$J});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RJ(n,e,t,r,s,i,o){s==null&&(s=[1,1]),i==null&&(i=1),r===0&&(r="valid");const a=U(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),B(wr(i,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${s}'`);const h=mi(l.shape,e,i,s,r),d=[h.dilationHeight,h.dilationWidth];let p;r==="same"?p=DJ([h.filterHeight,h.filterWidth],d):p=[[0,0],[0,0]];const m=d[0]===1&&d[1]===1,[y,v]=AJ([h.inHeight,h.inWidth],d,p),w=m?r:"valid",b=m?l:hy(l,d,y),C=(t==="avg"?()=>ty(b,e,i,w,o):()=>uy(b,e,i,w,o))(),T=m?C:ny(C,d,v);return u?ee(T,[T.shape[1],T.shape[2],T.shape[3]]):T}function AJ(n,e,t){const r=t.map(h=>h[0]),s=t.map(h=>h[1]),i=n.concat(r,s),o=e.map((h,d)=>(h-i[d]%h)%h),a=s.map((h,d)=>h+o[d]),l=e.map((h,d)=>[r[d],a[d]]),u=e.map((h,d)=>[0,o[d]]);return[l,u]}function DJ(n,e){const r=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),s=r.map(o=>Math.floor(o/2)),i=r.map((o,a)=>o-s[a]);return r.map((o,a)=>[s[a],i[a]])}const NE=Q({pool_:RJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OJ(n,e){const t=U(n,"x","prelu"),r=U(e,"alpha","prelu"),s={x:t,alpha:r};return K.runKernel(Fg,s)}const dy=Q({prelu_:OJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PJ(n,e=null,t=!1){let r=U(n,"x","prod");r.dtype==="bool"&&(r=Re(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return K.runKernel(Lg,s,i)}const $E=Q({prod_:PJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FJ(n,e,t,r){const s=n.map((h,d)=>U(h,`tensors${d}`,"raggedGather","int32")),i=U(e,"paramsDenseValues","raggedGather"),o=U(t,"indices","raggedGather","int32"),a={paramsNestedSplits:s,paramsDenseValues:i,indices:o},l={outputRaggedRank:r},u=K.runKernel(db,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const xV=Q({raggedGather_:FJ});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(n,e,t){const r=U(n,"starts","raggedRange"),s=U(e,"limits","raggedRange",r.dtype),i=U(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:s,deltas:i},a=K.runKernel(fb,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const bV=Q({raggedRange_:LJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(n,e,t,r,s){const i=U(n,"shape","raggedTensorToTensor","int32"),o=U(e,"values","raggedTensorToTensor"),a=U(t,"defaultValue","raggedTensorToTensor",o.dtype),l=r.map((d,p)=>U(d,`tensors${p}`,"raggedTensorToTensor","int32")),u={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},h={rowPartitionTypes:s};return K.runKernel(pb,u,h)}const IV=Q({raggedTensorToTensor_:MJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(n,e,t){Rs(n);const r=fe(n);let s=null;if(t==null||t==="float32")s=new Float32Array(r);else if(t==="int32")s=new Int32Array(r);else if(t==="bool")s=new Uint8Array(r);else throw new Error(`Unknown data type ${t}`);for(let i=0;i<r;i++)s[i]=e();return K.makeTensor(s,n,t)}const SV=Q({rand_:VJ});var Ow={exports:{}},zJ=Ow.exports,ED;function BJ(){return ED||(ED=1,function(n){(function(e,t,r){function s(l){var u=this,h=a();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(l),u.s0<0&&(u.s0+=1),u.s1-=h(l),u.s1<0&&(u.s1+=1),u.s2-=h(l),u.s2<0&&(u.s2+=1),h=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var h=new s(l),d=u&&u.state,p=h.next;return p.int32=function(){return h.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,d&&(typeof d=="object"&&i(d,h),p.state=function(){return i(h,{})}),p}function a(){var l=4022871197,u=function(h){h=String(h);for(var d=0;d<h.length;d++){l+=h.charCodeAt(d);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(zJ,n)}(Ow)),Ow.exports}var Pw={exports:{}},UJ=Pw.exports,kD;function WJ(){return kD||(kD=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xor128=o})(UJ,n)}(Pw)),Pw.exports}var Fw={exports:{}},jJ=Fw.exports,ND;function GJ(){return ND||(ND=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,h==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xorwow=o})(jJ,n)}(Fw)),Fw.exports}var Lw={exports:{}},HJ=Lw.exports,$D;function qJ(){return $D||($D=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var h=l.x,d=l.i,p,m;return p=h[d],p^=p>>>7,m=p^p<<24,p=h[d+1&7],m^=p^p>>>10,p=h[d+3&7],m^=p^p>>>3,p=h[d+4&7],m^=p^p<<7,p=h[d+7&7],p=p^p<<13,m^=p^p<<9,h[d]=m,l.i=d+1&7,m};function u(h,d){var p,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,p=0;p<d.length;++p)m[p&7]=m[p&7]<<15^d.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&m[p]===0;++p);for(p==8?m[7]=-1:m[p],h.x=m,h.i=0,p=256;p>0;--p)h.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(h.x&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xorshift7=o})(HJ,n)}(Lw)),Lw.exports}var Mw={exports:{}},KJ=Mw.exports,RD;function XJ(){return RD||(RD=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var h=l.w,d=l.X,p=l.i,m,y;return l.w=h=h+1640531527|0,y=d[p+34&127],m=d[p=p+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,y=d[p]=y^m,l.i=p,y+(h^h>>>16)|0};function u(h,d){var p,m,y,v,w,b=[],S=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,S=Math.max(S,d.length)),y=0,v=-32;v<S;++v)d&&(m^=d.charCodeAt((v+32)%d.length)),v===0&&(w=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,v>=0&&(w=w+1640531527|0,p=b[v&127]^=m+w,y=p==0?y+1:0);for(y>=128&&(b[(d&&d.length||0)&127]=-1),y=127,v=4*128;v>0;--v)m=b[y+34&127],p=b[y=y+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,b[y]=m^p;h.w=w,h.X=b,h.i=y}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(h.X&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xor4096=o})(KJ,n)}(Mw)),Mw.exports}var Vw={exports:{}},QJ=Vw.exports,AD;function YJ(){return AD||(AD=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var d=l.b,p=l.c,m=l.d,y=l.a;return d=d<<25^d>>>7^p,p=p-m|0,m=m<<24^m>>>8^y,y=y-d|0,l.b=d=d<<20^d>>>12^p,l.c=p=p-m|0,l.d=m<<16^p>>>16^y,l.a=y-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var h=0;h<u.length+20;h++)l.b^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.tychei=o})(QJ,n)}(Vw)),Vw.exports}var zw={exports:{}};const JJ={},ZJ=Object.freeze(Object.defineProperty({__proto__:null,default:JJ},Symbol.toStringTag,{value:"Module"})),RE=A_(ZJ);var eZ=zw.exports,DD;function tZ(){return DD||(DD=1,function(n){(function(e,t,r){var s=256,i=6,o=52,a="random",l=r.pow(s,i),u=r.pow(2,o),h=u*2,d=s-1,p;function m(T,O,V){var k=[];O=O==!0?{entropy:!0}:O||{};var $=b(w(O.entropy?[T,C(t)]:T??S(),3),k),N=new y(k),R=function(){for(var E=N.g(i),L=l,F=0;E<u;)E=(E+F)*s,L*=s,F=N.g(1);for(;E>=h;)E/=2,L/=2,F>>>=1;return(E+F)/L};return R.int32=function(){return N.g(4)|0},R.quick=function(){return N.g(4)/4294967296},R.double=R,b(C(N.S),t),(O.pass||V||function(E,L,F,G){return G&&(G.S&&v(G,N),E.state=function(){return v(N,{})}),F?(r[a]=E,L):E})(R,$,"global"in O?O.global:this==r,O.state)}function y(T){var O,V=T.length,k=this,$=0,N=k.i=k.j=0,R=k.S=[];for(V||(T=[V++]);$<s;)R[$]=$++;for($=0;$<s;$++)R[$]=R[N=d&N+T[$%V]+(O=R[$])],R[N]=O;(k.g=function(E){for(var L,F=0,G=k.i,Y=k.j,q=k.S;E--;)L=q[G=d&G+1],F=F*s+q[d&(q[G]=q[Y=d&Y+L])+(q[Y]=L)];return k.i=G,k.j=Y,F})(s)}function v(T,O){return O.i=T.i,O.j=T.j,O.S=T.S.slice(),O}function w(T,O){var V=[],k=typeof T,$;if(O&&k=="object")for($ in T)try{V.push(w(T[$],O-1))}catch{}return V.length?V:k=="string"?T:T+"\0"}function b(T,O){for(var V=T+"",k,$=0;$<V.length;)O[d&$]=d&(k^=O[d&$]*19)+V.charCodeAt($++);return C(O)}function S(){try{var T;return p&&(T=p.randomBytes)?T=T(s):(T=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(T)),C(T)}catch{var O=e.navigator,V=O&&O.plugins;return[+new Date,e,V,e.screen,C(t)]}}function C(T){return String.fromCharCode.apply(0,T)}if(b(r.random(),t),n.exports){n.exports=m;try{p=RE}catch{}}else r["seed"+a]=m})(typeof self<"u"?self:eZ,[],Math)}(zw)),zw.exports}var KS,OD;function nZ(){if(OD)return KS;OD=1;var n=BJ(),e=WJ(),t=GJ(),r=qJ(),s=XJ(),i=YJ(),o=tZ();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=r,o.xor4096=s,o.tychei=i,KS=o,KS}var AE=nZ();/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rZ=.001,TV=.1;function sZ(n,e,t){return t==null&&(t=DE()),YT(n,e,(r,s)=>OE(r,s,t))}function DE(){return K.backend.floatPrecision()===32?rZ:TV}function YT(n,e,t){let r=!0;if((Pn(n)||Pn(e))&&(r=!1),Pn(n)&&Pn(e)&&(r=!0),r){const o=n.constructor.name,a=e.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(n)&&Array.isArray(e)){const o=Po(n),a=Po(e);if(!mt(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const s=Pn(n)?n:Oo(n),i=Pn(e)?e:Oo(e);if(s.length!==i.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${i.length}.
Actual:   ${s}.
Expected: ${i}.`);for(let o=0;o<i.length;++o){const a=s[o],l=i[o];if(!t(a,l))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${l}.
Actual:   ${s}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function iZ(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function oZ(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return vo(n)||vo(n[0])||vo(e)||vo(e[0])?YT(n,t,(r,s)=>r==s):YT(n,e,(r,s)=>OE(r,s,0))}function aZ(n,e,t){if(t==null&&(t=DE()),!OE(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function OE(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function lZ(n,e,t){for(let r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error(`Value out of range:${n[r]} low: ${e}, high: ${t}`)}function uZ(n,e){const t=new Float32Array(n),r=new Float32Array(e);if(t.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${t.length}`);for(let s=0;s<r.length;s++)if(t[s]!==r[s])throw new Error(`Expected ArrayBuffer value at ${s} to be ${r[s]} but got ${t[s]} instead`)}function _V(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?_V(t):n[e]=Eo(t)}return n}function cZ(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",r=>t(e)),e.load()})}async function hZ(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const dZ=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:TV,createVideoElement:cZ,encodeStrings:_V,expectArrayBuffersEqual:uZ,expectArraysClose:sZ,expectArraysEqual:oZ,expectNumbersClose:aZ,expectPromiseToFail:iZ,expectValuesInRange:lZ,play:hZ,testEpsilon:DE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PE{constructor(e,t,r,s,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=AE.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,i,o;do s=2*this.random()-1,i=2*this.random()-1,o=s*s+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*s*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class fZ{constructor(e,t,r,s){this.alpha=e,this.beta=1/t,this.dtype=r;const i=s||Math.random();this.randu=AE.alea(i.toString()),this.randn=new PE(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,r,s,i,o;for(;;){do s=this.randn.nextValue(),o=1+this.c*s;while(o<=0);if(o*=o*o,e=s*s,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class pZ{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=AE.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(n,e,t=1,r="float32",s){if(Rs(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const i=new fZ(e,t,r,s),o=ht(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const CV=Q({randomGamma_:mZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(n,e=0,t=1,r,s){if(Rs(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const i=new PE(e,t,r,!1,s),o=ht(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Yb=Q({randomNormal_:gZ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return Yb(n,0,1,e,t)}const EV=Q({randomStandardNormal_:yZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(n,e=0,t=1,r="float32",s){Rs(n);const i=ht(n,r),o=new pZ(e,t,null,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const tu=Q({randomUniform_:wZ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vZ(n,e,t,r){return tu(n,e,t,"int32",r)}const kV=Q({randomUniformInt_:vZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pc(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:n,stop:e,step:t,dtype:r};return K.runKernel(mb,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xZ(n){const t={input:U(n,"input","real")};return K.runKernel(gb,t)}const ad=Q({real_:xZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(n){const t={x:U(n,"x","reciprocal")};return K.runKernel(tf,t)}const FE=Q({reciprocal_:bZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IZ(n){const t={x:U(n,"x","relu")};return K.runKernel(nf,t)}const Zi=Q({relu_:IZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(n){const t={x:U(n,"x","relu6")};return K.runKernel(rf,t)}const Jb=Q({relu6_:SZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TZ(n,e){const r={x:U(n,"x","reverse")},s={dims:e};return K.runKernel(Bg,r,s)}const Xs=Q({reverse_:TZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(n){const e=U(n,"x","reverse");return B(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Xs(e,0)}const NV=Q({reverse1d_:_Z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(n,e){const t=U(n,"x","reverse");return B(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Xs(t,e)}const $V=Q({reverse2d_:CZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZ(n,e){const t=U(n,"x","reverse");return B(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Xs(t,e)}const RV=Q({reverse3d_:EZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kZ(n,e){const t=U(n,"x","reverse");return B(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Xs(t,e)}const AV=Q({reverse4d_:kZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(n){const t={x:U(n,"x","round")};return K.runKernel(sf,t)}const Zb=Q({round_:NZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(n){const t={x:U(n,"x","rsqrt","float32")};return K.runKernel(of,t)}const e1=Q({rsqrt_:$Z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(n){const t={x:U(n,"x","selu")};return K.runKernel(af,t)}const t1=Q({selu_:RZ});function AZ(n,e,t,r,s,i=[1,1],o="NHWC"){const a=U(n,"x","separableConv2d"),l=U(e,"depthwiseFilter","separableConv2d"),u=U(t,"pointwiseFilter","separableConv2d");let h=a,d=!1;if(a.rank===3&&(d=!0,h=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");B(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),B(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),B(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),B(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),B(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],m=l.shape[3];B(u.shape[2]===p*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*m}, but got ${u.shape[2]}.`);const y=bf(h,l,r,s,o,i),w=Ta(y,u,1,"valid",o);return d?ee(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const n1=Q({separableConv2d_:AZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function DZ(n,e){const t=U(n,"x","setdiff1d"),r=U(e,"y","setdiff1d");B(t.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${r.dtype}).`),B(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),B(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const s=await t.data(),i=await r.data(),o=new Set(i);let a=0;for(let h=0;h<s.length;h++)o.has(s[h])||a++;const l=new $n([a],t.dtype),u=new $n([a],"int32");for(let h=0,d=0;h<s.length;h++)o.has(s[h])||(l.values[d]=s[h],u.values[d]=h,d++);return[l.toTensor(),u.toTensor()]}const DV=DZ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(n){const t={x:U(n,"x","sign")};return K.runKernel(cf,t)}const LE=Q({sign_:OZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(n){const t={x:U(n,"x","sin","float32")};return K.runKernel(lf,t)}const r1=Q({sin_:PZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(n){const t={x:U(n,"x","sinh")};return K.runKernel(uf,t)}const s1=Q({sinh_:FZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LZ(n,e,t){const r=U(n,"x","slice1d");return B(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),vt(r,[e],[t])}const fy=Q({slice1d_:LZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(n,e,t){const r=U(n,"x","slice2d");return B(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),vt(r,e,t)}const i1=Q({slice2d_:MZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(n,e,t){const r=U(n,"x","slice3d");return B(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),vt(r,e,t)}const py=Q({slice3d_:VZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(n,e,t){const r=U(n,"x","slice4d");return B(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),vt(r,e,t)}const ld=Q({slice4d_:zZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(n,e=-1){const t=U(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return K.runKernel(qg,r,s)}const my=Q({softmax_:BZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(n){B(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return K.runKernel(Yx,e)}const gy=Q({fft_:UZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(n){B(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return K.runKernel(tb,e)}const ud=Q({ifft_:WZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jZ(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const s=ee(n,[t,e]);r=ud(s)}else{const s=[t,2*(e-1)],i=ee(ad(n),[t,e]),o=ee(sy(n),[t,e]),a=Xs(vt(i,[0,1],[t,e-2]),1),l=J(Xs(vt(o,[0,1],[t,e-2]),1),Xe(-1)),u=vn([i,a],1),h=vn([o,l],1),d=ee(Sa(u,h),[s[0],s[1]]);r=ud(d)}if(r=ad(r),n.rank===3&&n.shape[0]!==0){const s=r,i=n.shape[0];r=ee(r,[i,r.shape[0]/i,r.shape[1]]),s.dispose()}return r}const o1=Q({irfft_:jZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(n,e,t=0){const s={x:U(n,"x","split")},i={numOrSizeSplits:e,axis:t};return K.runKernel(Hg,s,i)}const ns=Q({split_:GZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(n,e){B(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let s;if(e!=null&&e<t){const y=n.shape.map(w=>0),v=n.shape.map(w=>w);v[n.shape.length-1]=e,s=vt(n,y,v),t=e}else if(e!=null&&e>t){const y=n.shape.map(v=>v);y[n.shape.length-1]=e-t,s=vn([n,kn(y)],n.shape.length-1),t=e}else s=n;const i=xt(s),o=ee(Sa(s,i),[r,t]),a=gy(o),l=Math.floor(t/2)+1,u=ad(a),h=sy(a),d=ns(u,[l,t-l],u.shape.length-1),p=ns(h,[l,t-l],h.shape.length-1),m=s.shape.slice();return m[s.shape.length-1]=l,ee(Sa(d[0],p[0]),m)}const yy=Q({rfft_:HZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qZ(n,e){let t=U(n,"a","squaredDifference"),r=U(e,"b","squaredDifference");[t,r]=hn(t,r),at(t.shape,r.shape);const s={a:t,b:r},i={};return K.runKernel(pf,s,i)}const a1=Q({squaredDifference_:qZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(n,e){const t=U(n,"x","squeeze","string_or_numeric");return ee(t,$a(t.shape,e).newShape)}const nu=Q({squeeze_:KZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(n,e=0){const t=xm(n,"tensors","stack","string_or_numeric");B(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&B(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return K.runKernel(Og,r,s)}const jr=Q({stack_:XZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(n,e=0){const r={x:U(n,"x","step")},s={alpha:e};return K.runKernel(vf,r,s)}const Oc=Q({step_:QZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(n,e,t,r,s=0,i=0,o=0,a=0,l=0){const h={x:U(n,"x","stridedSlice","string_or_numeric")},d={begin:e,end:t,strides:r,beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return K.runKernel(kb,h,d)}const ME=Q({stridedSlice_:YZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JZ(n){const t={x:U(n,"x","tan","float32")};return K.runKernel(gf,t)}const VE=Q({tan_:JZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mr(n,e){kc(n);const t=Po(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Yl(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cl(n,e,t){if(kc(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Po(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Yl(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(n,e,t){if(kc(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Po(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Yl(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n,e,t){if(kc(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=Po(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Yl(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(n,e,t){if(kc(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=Po(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Yl(n,e,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(n,e,t){if(kc(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=Po(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Yl(n,e,r,t)}function BE(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(i+` update.rank < ${s}. `);if(n.length<r+(t.rank-s))throw new Error(i+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+n.length-r)throw new Error(i+` update.rank != ${s+n.length-r}`);for(let o=0;o<s;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-s;++o)if(t.shape[o+s]!==n[o+r])throw new Error(i+` updates.shape[${o+s}] (${t.shape[o+s]}) != shape[${o+s}] (${n[o+s]})`)}function l1(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}BE(t,e,n)}function ru(n,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,i=t.length;let o=1;for(let d=s;d<i;++d)o*=t[d];const a=s<1?1:s,l=fe(e.shape)/a,u=[...Qe(t.slice(0,s)),1],h=fe(t);return{sliceRank:s,numUpdates:l,sliceSize:o,strides:u,outputSize:h}}const ZZ=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:ru,validateInput:l1,validateUpdateShape:BE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eee(n,e,t){const r=U(n,"tensor","tensorScatterupdate"),s=U(e,"indices","tensorScatterupdate","int32"),i=U(t,"updates","tensorScatterupdate");if(l1(i,s,r.shape),r.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${i.dtype}.`);const o={tensor:r,indices:s,updates:i},a={};return K.runKernel(xb,o,a)}const LV=Q({tensorScatterUpdate_:eee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tee(n,e=1,t=!0){const r=U(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const i={x:r},o={k:e,sorted:t},[a,l]=K.runKernel(Ab,i,o);return{values:a,indices:l}}const UE=Q({topk_:tee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nee(n,e=0,t=1,r,s){if(Rs(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new PE(e,t,r,!0,s),o=ht(n,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const u1=Q({truncatedNormal_:nee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ree(n,e=0){const t=U(n,"x","unique","string_or_numeric");B(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[i,o]=K.runKernel(Ob,r,s);return{values:i,indices:o}}const WE=Q({unique_:ree});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function see(n,e,t){const r=U(n,"x","unsortedSegmentSum"),s=U(e,"segmentIds","unsortedSegmentSum","int32");B(oc(t),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:s},o={numSegments:t};return K.runKernel(Qg,i,o)}const c1=Q({unsortedSegmentSum_:see});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iee(n,e=0){const t=U(n,"x","unstack","string_or_numeric");B(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return K.runKernel(Xg,r,s)}const Qs=Q({unstack_:iee});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n,e){return Qb(n,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jE(n,e=!0,t,r){return K.makeVariable(n,e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h1(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const r=ht(n,"int32"),s=ht([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=r.indexToLoc(t[i]),a=i*n.length;s.values.set(o,a)}return s.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function oee(n){const e=U(n,"condition","whereAsync","bool"),t=await e.data(),r=h1(e.shape,t);return n!==e&&e.dispose(),r}const GE=oee;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function aee(n,e,t){const r=U(n,"tensor","boolMask"),s=U(e,"mask","boolMask","bool"),i=t??0,o=s.rank,a=r.shape;B(o>0,()=>"mask cannot be scalar"),yr(a.slice(i,i+o),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let v=i;v<i+o;v++)l*=a[v];const u=a.slice(0,i).concat([l],a.slice(i+o)),h=ee(r,u),d=ee(s,[-1]),p=await GE(d),m=nu(p,[1]),y=_f(h,m,i);return n!==r&&r.dispose(),e!==s&&s.dispose(),m.dispose(),h.dispose(),d.dispose(),p.dispose(),y}const VV=aee;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lee(n,e,t){const r=U(n,"x","transpose");if(e==null&&(e=r.shape.map((o,a)=>a).reverse()),B(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{B(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},i={perm:e};return r.dtype==="complex64"?ae(()=>{let o=ad(r),a=sy(r);return o=K.runKernel(Ju,{x:o},i),a=K.runKernel(Ju,{x:a},i),t&&(a=Qt(a)),Sa(o,a)}):K.runKernel(Ju,s,i)}const yt=Q({transpose_:lee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uee(n,e,t,r,s=!0){const i=U(n,"v","movingAverage"),o=U(e,"x","movingAverage"),a=U(t,"decay","movingAverage");PM(i,o),B(mt(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=Xe(1),u=Le(l,a);let h=J(Le(o,i),u);if(s){B(r!=null,()=>"When using zeroDebias: true, step is required.");const d=U(r,"step","movingAverage");h=je(h,Le(l,Fo(a,d)))}return be(i,h)}const zV=Q({movingAverage_:uee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cee(n,e,t){Rs(t);const r=U(n,"indices","scatterND","int32"),s=U(e,"updates","scatterND");l1(s,r,t);const i={indices:r,updates:s},o={shape:t};return K.runKernel(vb,i,o)}const BV=Q({scatterND_:cee});function hee(n,e,t,r){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const s=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dee(n,e,t,r=0){Rs(t);const s=U(n,"sparseIndices","sparseToDense","int32"),i=U(e,"sparseValues","sparseToDense","string_or_numeric"),o=U(r,"defaultValue","sparseToDense",i.dtype);hee(s,i,t,o);const a={sparseIndices:s,sparseValues:i,defaultValue:o},l={outputShape:t};return K.runKernel(Cb,a,l)}const UV=Q({sparseToDense_:dee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(n,e){const t=U(e,"indices","gatherND","int32"),s={params:U(n,"x","gatherND","string_or_numeric"),indices:t};return K.runKernel(eb,s)}const WV=Q({gatherND_:fee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pee(n,e){if(e==null)return n.shape.slice();if(mt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mee(n,e,t,r){const s=U(n,"x","dropout");if(B(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),B(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Et?s.clone():s;const i=pee(s,t),o=1-e,a=je(Tf(be(tu(i,0,1,"float32",r),o)),o);return J(s,a)}const HE=Q({dropout_:mee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function d1(n,e,t){const r=1-n%2,s=new Float32Array(n);for(let i=0;i<n;++i){const o=2*Math.PI*i/(n+r-1);s[i]=e-t*Math.cos(o)}return mr(s,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gee(n,e,t=1){const r=U(n,"predictions","inTopK"),s=U(e,"targets","inTopK");B(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),B(r.rank-1===s.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`),yr(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=r.shape[r.shape.length-1];B(t>0&&t<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${t}`);const o=await r.data(),a=await s.data(),[l,u]=[o.length/i,i],h=Jn("bool",l);for(let d=0;d<l;d++){const p=d*u,m=o.subarray(p,p+u),y=[];for(let v=0;v<m.length;v++)y.push({value:m[v],index:v});y.sort((v,w)=>w.value-v.value),h[d]=0;for(let v=0;v<t;v++)if(y[v].index===a[d]){h[d]=1;break}}return n!==r&&r.dispose(),e!==s&&s.dispose(),Cs(h,s.shape,"bool")}const jV=gee;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yee(n,e,t,r,s,i="NHWC",o){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]])),B(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),B(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),B(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],h=i==="NHWC"?l.shape[3]:l.shape[1];B(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),B(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),Hr("conv2dDerFilter",s,o);const d={x:a,dy:l},p={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,filterShape:t};return K.runKernel(Mx,d,p)}const KE=Q({conv2DBackpropFilter_:yee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return J(n,Oc(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function p1(n,e){let t=e;const r=Rn(n.shape,e.shape);return r.length>0&&(t=ze(t,r)),ee(t,n.shape)}function m1(n,e,t,r){if(e==="linear")return n;if(e==="relu")return Zi(n);if(e==="elu")return If(n);if(e==="relu6")return Jb(n);if(e==="prelu")return dy(n,t);if(e==="leakyrelu")return iy(n,r);if(e==="sigmoid")return ji(n);throw new Error(`Unknown fused activation ${e}.`)}const g1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wee({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(l=l||"linear",g1(K.state.gradientDepth,l)===!1){B(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let V=Ta(n,e,t,r,s,i,o);return a!=null&&(V=be(V,a)),m1(V,l,u,h)}const d=U(n,"x","conv2d","float32"),p=U(e,"filter","conv2d","float32");let m=d,y=!1;d.rank===3&&(y=!0,m=ee(d,[1,d.shape[0],d.shape[1],d.shape[2]])),B(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),B(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Hr("fused conv2d",r,o);const v=s==="NHWC"?m.shape[3]:m.shape[1];B(p.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${p.shape[2]}.`),B(wr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const w=tr(m.shape,p.shape,t,i,r,o);let b;a!=null&&(b=U(a,"bias","fused conv2d"),[b]=hn(b,d),s==="NHWC"?at(w.outShape,b.shape):(B(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),B(b.shape.length===0||b.shape[0]===w.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${w.outChannels})`)));let S;if(u!=null){const V=u.shape;if(B(V.length<=1||V.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${V.length}.`),V.length===1)B(V[0]===1||V[0]===w.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the number of output channels (${w.outChannels}).`);else if(V.length===3)try{at(V,w.outShape)}catch{const $=`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the output shape of the conv2d (${w.outShape}).`;throw Error($)}S=U(u,"prelu weights","fused conv2d")}const C=(V,k)=>{B(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[$,N,R,E]=k,L=f1(V,R,l);B(Ml(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const F=cE(N.shape,L,$,t,r),G=KE(N,L,$.shape,t,r),Y=[F,G];if(E!=null){const q=p1(E,L);Y.push(q)}return Y},T={x:m,filter:p,bias:b,preluActivationWeights:S},O={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?Lo((k,$,N)=>{let R=K.runKernel(mm,T,O);return N([$,k,R]),y&&(R=ee(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:C}})(m,p):Lo((k,$,N,R)=>{let E=K.runKernel(mm,T,O);return R([$,k,E,N]),y&&(E=ee(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:C}})(m,p,b)}const GV=Q({fusedConv2d_:wee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vee(n,e,t,r,s,i=[1,1],o){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},h={strides:r,pad:s,dimRoundingMode:o,dilations:i,filterShape:t};return K.runKernel(Gx,u,h)}const HV=Q({depthwiseConv2dNativeBackpropFilter_:vee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xee(n,e,t,r,s,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},h={strides:r,pad:s,dimRoundingMode:o,dilations:i,inputShape:n},d=K.runKernel(Hx,u,h);return l?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const qV=Q({depthwiseConv2dNativeBackpropInput_:xee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(g1(K.state.gradientDepth,l)===!1){let O=bf(n,e,t,r,s,i,o);return a!=null&&(O=be(O,a)),m1(O,l,u,h)}const d=U(n,"x","depthwiseConv2d","float32"),p=U(e,"filter","depthwiseConv2d","float32");let m=d,y=!1;d.rank===3&&(y=!0,m=ee(d,[1,d.shape[0],d.shape[1],d.shape[2]])),B(m.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${m.rank}.`),B(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),B(m.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${m.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),B(wr(t,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Hr("fused depthwiseConv2d",r,o);const v=tr(m.shape,p.shape,t,i,r,o,!0);let w;a!=null&&(w=U(a,"bias","fused conv2d"),[w]=hn(w,d),at(v.outShape,w.shape));let b;u!=null&&(b=U(u,"prelu weights","fused depthwiseConv2d"));const S=(O,V)=>{B(Ml(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[k,$,N,R]=V,E=f1(O,N,l),L=qV($.shape,E,k,t,r,i,o),F=HV($,E,k.shape,t,r,i,o);if(R!=null){const G=p1(w,E);return[L,F,G]}return[L,F]},C={x:m,filter:p,bias:w,preluActivationWeights:b},T={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?Lo((V,k,$)=>{let N=K.runKernel(gm,C,T);return $([k,V,N]),y&&(N=ee(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:S}})(m,p):Lo((V,k,$,N)=>{let R=K.runKernel(gm,C,T);return N([k,V,R,$]),y&&(R=ee(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:S}})(m,p,w)}const Iee=Q({fusedDepthwiseConv2d_:bee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function See({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(g1(K.state.gradientDepth,i)===!1){let E=dt(n,e,t,r);return s!=null&&(E=be(E,s)),m1(E,i,o,a)}let l=U(n,"a","fused matMul"),u=U(e,"b","fused matMul");[l,u]=hn(l,u);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],m=r?u.shape[u.rank-2]:u.shape[u.rank-1],y=l.shape.slice(0,-2),v=u.shape.slice(0,-2),w=fe(y),b=fe(v);B(h===d,()=>`Error in fused matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${r} must match.`);const C=at(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,m]),T=t?ee(l,[w,h,p]):ee(l,[w,p,h]),O=r?ee(u,[b,m,d]):ee(u,[b,d,m]);let V;s!=null&&(V=U(s,"bias","fused matMul"),[V]=hn(V,l),at(C,V.shape));let k;o!=null&&(k=U(o,"prelu weights","fused matMul"));const $=(E,L)=>{const[F,G,Y,q]=L,se=f1(ee(E,Y.shape),Y,i);let X,re;if(!t&&!r?(X=dt(se,G,!1,!0),re=dt(F,se,!0,!1)):!t&&r?(X=dt(se,G,!1,!1),re=dt(se,F,!0,!1)):t&&!r?(X=dt(G,se,!1,!0),re=dt(F,se,!1,!1)):(X=dt(G,se,!0,!0),re=dt(se,F,!0,!0)),s!=null){const ie=p1(q,se);return[X,re,ie]}else return[X,re]},N={a:T,b:O,bias:V,preluActivationWeights:k},R={transposeA:t,transposeB:r,activation:i,leakyreluAlpha:a};return s==null?Lo((L,F,G)=>{const Y=K.runKernel(pm,N,R);return G([L,F,Y]),{value:ee(Y,C),gradFunc:$}})(T,O):Lo((L,F,G,Y)=>{const q=K.runKernel(pm,N,R);return Y([L,F,q,G]),{value:ee(q,C),gradFunc:$}})(T,O,V)}const JT=Q({fusedMatMul_:See});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KV=Object.freeze(Object.defineProperty({__proto__:null,conv2d:GV,depthwiseConv2d:Iee,matMul:JT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tee(n){return d1(n,.54,.46)}const _ee=Q({hammingWindow_:Tee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cee(n){return d1(n,.5,.5)}const XV=Q({hannWindow_:Cee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eee(n,e,t,r=!1,s=0){let i=0;const o=[];for(;i+e<=n.size;)o.push(vt(n,i,e)),i+=t;if(r)for(;i<n.size;){const a=i+e-n.size,l=vn([vt(n,i,e-a),Ac([a],s)]);o.push(l),i+=t}return o.length===0?Cl([],[0,e]):ee(vn(o),[o.length,e])}const QV=Q({frame_:Eee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kee(n,e,t,r,s=XV){r==null&&(r=qE(e));const i=QV(n,e,t),o=J(i,s(e));return yy(o,r)}const Nee=Q({stft_:kee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ee(n,e,t,r,s="bilinear",i=0){const o=U(n,"image","cropAndResize"),a=U(e,"boxes","cropAndResize","float32"),l=U(t,"boxInd","cropAndResize","int32"),u=a.shape[0];B(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),B(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),B(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),B(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),B(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),B(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const h={image:o,boxes:a,boxInd:l},d={method:s,extrapolationValue:i,cropSize:r};return K.runKernel(Ux,h,d)}const Ree=Q({cropAndResize_:$ee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aee(n){const e=U(n,"image","flipLeftRight","float32");B(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return K.runKernel(Zx,t,{})}const Dee=Q({flipLeftRight_:Aee});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oee(n){const e=U(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];B(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),B(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,js(e,s)}const Pee=Q({grayscaleToRGB_:Oee});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fee(n){const e=U(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];B(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),B(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,i=Re(e,"float32"),o=mr([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Bu("ij,j->i",i,o);break;case 3:a=Bu("ijk,k->ij",i,o);break;case 4:a=Bu("ijkl,l->ijk",i,o);break;case 5:a=Bu("ijklm,m->ijkl",i,o);break;case 6:a=Bu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=dr(a,-1),Re(a,s)}const Lee=Q({rgbToGrayscale_:Fee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mee(n,e,t=0,r=.5){const s=U(n,"image","rotateWithOffset","float32");B(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const i={image:s},o={radians:e,fillValue:t,center:r};return K.runKernel(Pb,i,o)}const Vee=Q({rotateWithOffset_:Mee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cf(n,e,t,r,s,i){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),B(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),B(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),B(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),B(e.rank===1,()=>"scores must be a 1D tensor"),B(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),B(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zee(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=U(n,"boxes","nonMaxSuppression","float32"),o=U(e,"scores","nonMaxSuppression","float32"),a=Cf(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return K.runKernel(ub,{boxes:i,scores:o},l)}const Bee=Q({nonMaxSuppression_:zee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(n,e,t){const r=Wee(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function Wee(n,e,t){return Gee(n,e,t||jee)}function jee(n,e){return n>e?1:n<e?-1:0}function Gee(n,e,t){let r=0,s=n.length,i=0,o=!1;for(;r<s;){i=r+(s-r>>>1);const a=t(e,n[i]);a>0?r=i+1:(s=i,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1(n,e,t,r,s){return XE(n,e,t,r,s,0)}function w1(n,e,t,r,s,i){return XE(n,e,t,r,s,0,!1,i,!0)}function v1(n,e,t,r,s,i){return XE(n,e,t,r,s,i,!0)}function XE(n,e,t,r,s,i,o=!1,a=!1,l=!1){const u=[];for(let w=0;w<e.length;w++)e[w]>s&&u.push({score:e[w],boxIndex:w,suppressBeginIndex:0});u.sort(PD);const h=i>0?-.5/i:0,d=[],p=[];for(;d.length<t&&u.length>0;){const w=u.pop(),{score:b,boxIndex:S,suppressBeginIndex:C}=w;if(b<s)break;let T=!1;for(let O=d.length-1;O>=C;--O){const V=Hee(n,S,d[O]);if(V>=r){T=!0;break}if(w.score=w.score*qee(r,h,V),w.score<=s)break}w.suppressBeginIndex=d.length,T||(w.score===b?(d.push(S),p.push(w.score)):w.score>s&&Uee(u,w,PD))}const m=d.length,y=t-m;a&&y>0&&(d.push(...new Array(y).fill(0)),p.push(...new Array(y).fill(0)));const v={selectedIndices:d};return o&&(v.selectedScores=p),l&&(v.validOutputs=m),v}function Hee(n,e,t){const r=n.subarray(e*4,e*4+4),s=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(s[0],s[2]),h=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),p=Math.max(s[1],s[3]),m=(a-i)*(l-o),y=(d-u)*(p-h);if(m<=0||y<=0)return 0;const v=Math.max(i,u),w=Math.max(o,h),b=Math.min(a,d),S=Math.min(l,p),C=Math.max(b-v,0)*Math.max(S-w,0);return C/(m+y-C)}function qee(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function PD(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Kee(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=U(n,"boxes","nonMaxSuppressionAsync"),o=U(e,"scores","nonMaxSuppressionAsync"),a=Cf(i,o,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],h=l[1],{selectedIndices:d}=y1(u,h,t,r,s);return i!==n&&i.dispose(),o!==e&&o.dispose(),mr(d,"int32")}const Xee=Kee;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qee(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=U(n,"boxes","nonMaxSuppression"),a=U(e,"scores","nonMaxSuppression"),l=Cf(o,a,t,r,s,i);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},h={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i},d=K.runKernel(hb,u,h);return{selectedIndices:d[0],selectedScores:d[1]}}const Yee=Q({nonMaxSuppressionWithScore_:Qee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Jee(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=U(n,"boxes","nonMaxSuppressionAsync"),a=U(e,"scores","nonMaxSuppressionAsync"),l=Cf(o,a,t,r,s,i);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),h=u[0],d=u[1],{selectedIndices:p,selectedScores:m}=v1(h,d,t,r,s,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:mr(p,"int32"),selectedScores:mr(m)}}const Zee=Jee;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=U(n,"boxes","nonMaxSuppression"),a=U(e,"scores","nonMaxSuppression"),l=Cf(o,a,t,r,s,null),u=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,p={boxes:o,scores:a},m={maxOutputSize:u,iouThreshold:h,scoreThreshold:d,padToMaxOutputSize:i},y=K.runKernel(cb,p,m);return{selectedIndices:y[0],validOutputs:y[1]}}const tte=Q({nonMaxSuppressionPadded_:ete});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nte(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=U(n,"boxes","nonMaxSuppressionAsync"),a=U(e,"scores","nonMaxSuppressionAsync"),l=Cf(o,a,t,r,s,null),u=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,[p,m]=await Promise.all([o.data(),a.data()]),{selectedIndices:y,validOutputs:v}=w1(p,m,u,h,d,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:mr(y,"int32"),validOutputs:Xe(v,"int32")}}const rte=nte;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ste(n,e,t=!1,r=!1){const s=U(n,"images","resizeBilinear");B(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),B(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),B(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=ee(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:r,size:e},u=K.runKernel(zg,a,l);return o?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const YV=Q({resizeBilinear_:ste});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(n,e,t=!1,r=!1){const s=U(n,"images","resizeNearestNeighbor");B(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),B(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),B(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),B(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=ee(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:r,size:e},u=K.runKernel(Vg,a,l);return o?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const JV=Q({resizeNearestNeighbor_:ite});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ote(n,e="binary",t=!1,r=.5){const s=U(n,"image","threshold"),i=.2989,o=.587,a=.114,l=s.shape[0]*s.shape[1];let u=J(mr([r]),255),h,d,p,m;if(B(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),B(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),B(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),B(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[h,d,p]=ns(s,[1,1,1],-1);const w=J(h,i),b=J(d,o),S=J(p,a);m=be(be(w,b),S)}else m=n;if(e==="otsu"){const w=sE(Re(Zb(m),"int32"),Cs([]),256);u=ate(w,l)}const y=t?eu(m,u):qr(m,u);return Re(J(y,255),"int32")}function ate(n,e){let t=mr([-1]),r=mr([0]),s=mr([0]),i,o,a,l,u,h;for(let d=0;d<n.size-1;d++){i=vt(n,0,d+1),o=vt(n,d+1),u=je(ze(i),e),h=je(ze(o),e);const p=ze(J(i,pc(0,i.size)));a=je(p,ze(i));const m=Ac(o.shape,i.size),y=be(pc(0,o.size),m),v=J(o,y);l=je(ze(v),ze(o));const w=Le(a,l),b=Le(a,l),S=J(u,h);s=J(J(S,w),b);const C=qr(s,r);r=Qn(C,s,r),t=Qn(C,mr([d]),t)}return t}const lte=Q({threshold_:ote});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ute(n,e,t="nearest",r="constant",s=0,i){const o=U(n,"image","transform","float32"),a=U(e,"transforms","transform","float32");B(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),B(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),B(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:r,fillValue:s,outputShape:i};return K.runKernel(Db,l,u)}const cte=Q({transform_:ute});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hte(n,e,t){const r=U(n,"a","bandPart");B(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[i,o]=r.shape.slice(-2);let a,l;typeof e=="number"?(B(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),B(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=U(e<0?i:e,"numLower","bandPart")):(B(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Qn(id(e,0),i,zl(e,i))),typeof t=="number"?(B(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),B(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=U(t<0?o:t,"numUpper","bandPart")):(B(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Qn(id(t,0),o,zl(t,o)));const u=ee(pc(0,i,1,"int32"),[-1,1]),h=pc(0,o,1,"int32"),d=Le(u,h),p=pi(eu(d,a),Oa(d,Qt(l))),m=kn([i,o],r.dtype);return ee(jr(Qs(ee(r,[-1,i,o])).map(y=>Qn(p,y,m))),s)}const dte=Q({bandPart_:hte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fte(n){let e;if(Array.isArray(n)){e=!1,B(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=n[0].shape[0];for(let i=1;i<n.length;++i)B(n[i].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${s})`)}else e=!0,n=ns(n,n.shape[0],0).map(s=>nu(s,[0]));B(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let s=0;s<n.length;++s)t.push(K.tidy(()=>{let i=r[s];if(s>0)for(let o=0;o<s;++o){const a=J(ze(J(t[o],i)),t[o]);i=Le(i,a)}return je(i,Sf(i,"euclidean"))}));return e?jr(t,0):t}const pte=Q({gramSchmidt_:fte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mte(n,e=!1){if(B(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return FD(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),r=Qs(ee(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],i=[];r.forEach(l=>{const[u,h]=FD(l,e);s.push(u),i.push(h)});const o=ee(jr(s,0),n.shape),a=ee(jr(i,0),n.shape);return[o,a]}}function FD(n,e=!1){return K.tidy(()=>{B(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let s=Hb(t),i=ko(n);const o=Cl([[1]],[1,1]);let a=ko(o);const l=t>=r?r:t;for(let u=0;u<l;++u){const h=i,d=a,p=s;[a,i,s]=K.tidy(()=>{const m=vt(i,[u,u],[t-u,1]),y=Sf(m),v=vt(i,[u,u],[1,1]),w=Qn(qr(v,0),Cl([[-1]]),Cl([[1]])),b=Le(v,J(w,y)),S=je(m,b);S.shape[0]===1?a=ko(o):a=vn([o,vt(S,[1,0],[S.shape[0]-1,S.shape[1]])],0);const C=Qt(je(dt(w,b),y)),T=vt(i,[u,0],[t-u,r]),O=J(C,a),V=yt(a);if(u===0)i=Le(T,dt(O,dt(V,T)));else{const N=Le(T,dt(O,dt(V,T)));i=vn([vt(i,[0,0],[u,r]),N],0)}const k=yt(O),$=vt(s,[0,u],[t,s.shape[1]-u]);if(u===0)s=Le($,dt(dt($,a),k));else{const N=Le($,dt(dt($,a),k));s=vn([vt(s,[0,0],[t,u]),N],1)}return[a,i,s]}),ot([h,d,p])}return!e&&t>r&&(s=vt(s,[0,0],[t,r]),i=vt(i,[0,0],[r,r])),[s,i]})}const gte=Q({qr_:mte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Br;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Br||(Br={}));function yte(n,e,t=Br.SUM_BY_NONZERO_WEIGHTS){const r=U(n,"losses","computeWeightedLoss");let s=null;e!=null&&(s=U(e,"weights","computeWeightedLoss"));const i=s==null?r:J(r,s);if(t===Br.NONE)return i;if(t===Br.SUM)return ze(i);if(t===Br.MEAN){if(s==null)return un(i);{const o=r.size/s.size,a=je(ze(i),ze(s));return o>1?je(a,Xe(o)):a}}if(t===Br.SUM_BY_NONZERO_WEIGHTS){if(s==null)return je(ze(i),Xe(r.size));{const o=J(s,ts(r.shape)),a=Re(ze(fc(o,Xe(0))),"float32");return je(ze(i),a)}}throw Error(`Unknown reduction: ${t}`)}const Fa=Q({computeWeightedLoss_:yte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wte(n,e,t,r=Br.SUM_BY_NONZERO_WEIGHTS){const s=U(n,"labels","absoluteDifference"),i=U(e,"predictions","absoluteDifference");let o=null;t!=null&&(o=U(t,"weights","absoluteDifference")),yr(s.shape,i.shape,"Error in absoluteDifference: ");const a=En(Le(s,i));return Fa(a,o,r)}const vte=Q({absoluteDifference_:wte});function xte(n,e,t,r,s=Br.SUM_BY_NONZERO_WEIGHTS){const i=U(n,"labels","cosineDistance"),o=U(e,"predictions","cosineDistance");let a=null;r!=null&&(a=U(r,"weights","cosineDistance")),yr(i.shape,o.shape,"Error in cosineDistance: ");const l=Xe(1),u=Le(l,ze(J(i,o),t,!0));return Fa(u,a,s)}const bte=Q({cosineDistance_:xte});function Ite(n,e,t,r=Br.SUM_BY_NONZERO_WEIGHTS){let s=U(n,"labels","hingeLoss");const i=U(e,"predictions","hingeLoss");let o=null;t!=null&&(o=U(t,"weights","hingeLoss")),yr(s.shape,i.shape,"Error in hingeLoss: ");const a=Xe(1);s=Le(J(Xe(2),s),a);const l=Zi(Le(a,J(s,i)));return Fa(l,o,r)}const Ste=Q({hingeLoss_:Ite});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tte(n,e,t,r=1,s=Br.SUM_BY_NONZERO_WEIGHTS){const i=U(n,"labels","huberLoss"),o=U(e,"predictions","huberLoss");let a=null;t!=null&&(a=U(t,"weights","huberLoss")),yr(i.shape,o.shape,"Error in huberLoss: ");const l=Xe(r),u=En(Le(o,i)),h=zl(u,l),d=Le(u,h),p=be(J(Xe(.5),Ut(h)),J(l,d));return Fa(p,a,s)}const _te=Q({huberLoss_:Tte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cte(n,e,t,r=1e-7,s=Br.SUM_BY_NONZERO_WEIGHTS){const i=U(n,"labels","logLoss"),o=U(e,"predictions","logLoss");let a=null;t!=null&&(a=U(t,"weights","logLoss")),yr(i.shape,o.shape,"Error in logLoss: ");const l=Xe(1),u=Xe(r),h=Qt(J(i,ks(be(o,u)))),d=J(Le(l,i),ks(be(Le(l,o),u))),p=Le(h,d);return Fa(p,a,s)}const Ete=Q({logLoss_:Cte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kte(n,e,t,r=Br.SUM_BY_NONZERO_WEIGHTS){const s=U(n,"labels","meanSquaredError"),i=U(e,"predictions","meanSquaredError");let o=null;t!=null&&(o=U(t,"weights","meanSquaredError")),yr(s.shape,i.shape,"Error in meanSquaredError: ");const a=a1(s,i);return Fa(a,o,r)}const Nte=Q({meanSquaredError_:kte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $te(n,e){const t=U(n,"labels","sigmoidCrossEntropyWithLogits"),r=U(e,"logits","sigmoidCrossEntropyWithLogits");yr(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=Zi(r),i=J(r,t),o=oy(os(Qt(En(r))));return be(Le(s,i),o)}function Rte(n,e,t,r=0,s=Br.SUM_BY_NONZERO_WEIGHTS){let i=U(n,"multiClassLabels","sigmoidCrossEntropy");const o=U(e,"logits","sigmoidCrossEntropy");let a=null;if(t!=null&&(a=U(t,"weights","sigmoidCrossEntropy")),yr(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const u=Xe(r),h=Xe(1),d=Xe(.5);i=be(J(i,Le(h,u)),J(d,u))}const l=$te(i,o);return Fa(l,a,s)}const Ate=Q({sigmoidCrossEntropy_:Rte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dte(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Lo((s,i,o)=>{const l=ay(i,[t],!0),u=Le(Re(i,"float32"),l);o([s,u]);const h=Qt(J(u,s));return{value:ze(h,[t]),gradFunc:(m,y)=>{const[v,w]=y,b=xn(m.shape,[t]);return[J(ee(m,b),Le(Re(v,"float32"),os(w))),J(ee(m,b),Le(os(w),Re(v,"float32")))]}}})(n,e)}function Ote(n,e,t,r=0,s=Br.SUM_BY_NONZERO_WEIGHTS){let i=U(n,"onehotLabels","softmaxCrossEntropy");const o=U(e,"logits","softmaxCrossEntropy");let a=null;if(t!=null&&(a=U(t,"weights","softmaxCrossEntropy")),yr(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const u=Xe(r),h=Xe(1),d=Xe(i.shape[1]);i=be(J(i,Le(h,u)),je(u,d))}const l=Dte(i,o);return Fa(l,a,s)}const Pte=Q({softmaxCrossEntropy_:Ote});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fte(n,e,t,r){const s=U(n,"indices","sparseFillEmptyRows","int32"),i=U(e,"values","sparseFillEmptyRows"),o=U(t,"denseShape","sparseFillEmptyRows","int32"),a=U(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(s.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${s.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:s,values:i,denseShape:o,defaultValue:a},u=K.runKernel(Ib,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const Lte=Q({sparseFillEmptyRows_:Fte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mte(n,e,t){const r=U(n,"inputIndices","sparseReshape","int32"),s=U(e,"inputShape","sparseReshape","int32"),i=U(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(s.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:r,inputShape:s,newShape:i},a=K.runKernel(Sb,o);return{outputIndices:a[0],outputShape:a[1]}}const Vte=Q({sparseReshape_:Mte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zte(n,e,t){const r=U(n,"data","sparseSegmentMean"),s=U(e,"indices","sparseSegmentMean","int32"),i=U(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${s.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:r,indices:s,segmentIds:i};return K.runKernel(Tb,o)}const Bte=Q({sparseSegmentMean_:zte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ute(n,e,t){const r=U(n,"data","sparseSegmentSum"),s=U(e,"indices","sparseSegmentSum","int32"),i=U(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${s.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:r,indices:s,segmentIds:i};return K.runKernel(_b,o)}const Wte=Q({sparseSegmentSum_:Ute});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jte(n,e,t,r,s,i,o,a){const l=U(n,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=U(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const h={separator:t,nGramWidths:r,leftPad:s,rightPad:i,padWidth:o,preserveShortSequences:a},d={data:l,dataSplits:u},p=K.runKernel(Nb,d,h);return{nGrams:p[0],nGramsSplits:p[1]}}const Gte=Q({stringNGrams_:jte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(n,e,t=!0){const r=U(n,"input","stringSplit","string"),s=U(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(s.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const i={skipEmpty:t},o={input:r,delimiter:s},a=K.runKernel($b,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const qte=Q({stringSplit_:Hte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kte(n,e){const t=U(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:t};return K.runKernel(Rb,s,r)}const Xte=Q({stringToHashBucketFast_:Kte});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qte(n,e,t,r=!0){const s=U(n,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:r};return K.runKernel(Kg,{x:s},i)}const Yte=Q({staticRegexReplace_:Qte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZV={fft:gy,ifft:ud,rfft:yy,irfft:o1},e3={hammingWindow:_ee,hannWindow:XV,frame:QV,stft:Nee},di={flipLeftRight:Dee,grayscaleToRGB:Pee,resizeNearestNeighbor:JV,resizeBilinear:YV,rgbToGrayscale:Lee,rotateWithOffset:Vee,cropAndResize:Ree,nonMaxSuppression:Bee,nonMaxSuppressionAsync:Xee,nonMaxSuppressionWithScore:Yee,nonMaxSuppressionWithScoreAsync:Zee,nonMaxSuppressionPadded:tte,nonMaxSuppressionPaddedAsync:rte,threshold:lte,transform:cte},QE={bandPart:dte,gramSchmidt:pte,qr:gte},t3={absoluteDifference:vte,computeWeightedLoss:Fa,cosineDistance:bte,hingeLoss:Ste,huberLoss:_te,logLoss:Ete,meanSquaredError:Nte,sigmoidCrossEntropy:Ate,softmaxCrossEntropy:Pte},n3={sparseFillEmptyRows:Lte,sparseReshape:Vte,sparseSegmentMean:Bte,sparseSegmentSum:Wte},r3={stringNGrams:Gte,stringSplit:qte,stringToHashBucketFast:Xte,staticRegexReplace:Yte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte=new Map,ZT=new Map;class Pc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Us{constructor(){this.classNameMap={}}static getMap(){return Us.instance==null&&(Us.instance=new Us),Us.instance}static register(e){Us.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ie(n,e,t){B(n.className!=null,()=>"Class being registered does not have the static className property defined."),B(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),B(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,s=e+">"+r;return Us.register(n),Jte.set(s,n),ZT.set(n,s),n}function Zte(n){return ZT.has(n)?ZT.get(n):n.className}const ene=Object.freeze(Object.defineProperty({__proto__:null,Serializable:Pc,SerializationMap:Us,getRegisteredName:Zte,registerClass:Ie},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class La extends Pc{minimize(e,t=!1,r){const{value:s,grads:i}=this.computeGradients(e,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return ot(i),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return uV(e,t)}dispose(){this.iterations_!=null&&ot(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Xe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(La,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YE extends La{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r],o=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accum_grad`,variable:ae(()=>xt(i).variable(o))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${r}/accum_var`,variable:ae(()=>xt(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[s].variable,u=this.accumulatedUpdates[s].variable;ae(()=>{const h=be(J(l,this.rho),J(Ut(a),1-this.rho)),d=J(je(Zn(be(u,this.epsilon)),Zn(be(l,this.epsilon))),a),p=be(J(u,this.rho),J(Ut(d),1-this.rho));l.assign(h),u.assign(p);const m=be(J(d,-this.learningRate),i);i.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ot(this.accumulatedGrads.map(e=>e.variable)),ot(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JE extends La{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accumulator`,variable:ae(()=>Ac(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[s].tensor:e[r];if(o==null)return;const a=this.accumulatedGrads[s].variable;ae(()=>{const l=be(a,Ut(o));a.assign(l);const u=be(J(je(o,Zn(be(l,K.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ot(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZE extends La{static get className(){return"Adam"}constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ae(()=>{this.accBeta1=Xe(t).variable(),this.accBeta2=Xe(r).variable()}),s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ae(()=>{const r=Le(1,this.accBeta1),s=Le(1,this.accBeta2);t.forEach((i,o)=>{const a=K.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ae(()=>xt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:ae(()=>xt(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,d=this.accumulatedSecondMoment[o].variable,p=be(J(h,this.beta1),J(u,1-this.beta1)),m=be(J(d,this.beta2),J(Ut(u),1-this.beta2)),y=je(p,r),v=je(m,s);h.assign(p),d.assign(m);const w=be(J(je(y,be(Zn(v),this.epsilon)),-this.learningRate),a);a.assign(w)}),this.accBeta1.assign(J(this.accBeta1,this.beta1)),this.accBeta2.assign(J(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ot(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&ot(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ae(()=>{this.accBeta1.assign(Fo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Fo(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ek extends La{static get className(){return"Adamax"}constructor(e,t,r,s=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ae(()=>{this.iteration=Xe(0).variable(),this.accBeta1=Xe(t).variable()}),s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ae(()=>{const r=Le(1,this.accBeta1),s=je(-this.learningRate,be(J(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=K.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:xt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:xt(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,d=this.accumulatedWeightedInfNorm[o].variable,p=be(J(h,this.beta1),J(u,1-this.beta1)),m=J(d,this.beta2),y=En(u),v=zo(m,y);h.assign(p),d.assign(v);const w=be(J(je(s,r),je(p,be(v,this.epsilon))),a);a.assign(w)}),this.iteration.assign(be(this.iteration,1)),this.accBeta1.assign(J(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ot(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&ot(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x1 extends La{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const o=K.registeredVariables[r];ae(()=>{const a=be(J(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Fn(Xe(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tk extends x1{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=Xe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${r}/momentum`,variable:ae(()=>xt(i).variable(!1))});const o=this.accumulations[s].variable,a=Array.isArray(e)?e[s].tensor:e[r];a!=null&&ae(()=>{let l;const u=be(J(this.m,o),a);this.useNesterov?l=be(J(this.c,be(a,J(u,this.m))),i):l=be(J(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ot(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nk extends La{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,s=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,s==null&&(this.epsilon=K.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r],o=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${r}/rms`,variable:ae(()=>xt(i).variable(o))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${r}/momentum`,variable:ae(()=>xt(i).variable(o))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${r}/mg`,variable:ae(()=>xt(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[s].variable,u=this.accumulatedMoments[s].variable;ae(()=>{const h=be(J(l,this.decay),J(Ut(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[s].variable,p=be(J(d,this.decay),J(a,1-this.decay)),m=je(J(a,this.learningRate),Zn(Le(h,be(Ut(p),this.epsilon)))),y=be(J(u,this.momentum),m);l.assign(h),d.assign(p),u.assign(y);const v=Le(i,y);i.assign(v)}else{const d=be(J(l,this.decay),J(Ut(a),1-this.decay)),p=be(J(u,this.momentum),je(J(a,this.learningRate),Zn(be(d,this.epsilon))));l.assign(d),u.assign(p);const m=Le(i,p);i.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ot(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ot(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&ot(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tne=[YE,JE,ZE,ek,tk,nk,x1];function nne(){for(const n of tne)Ie(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rne="model",sne=".json",ine=".weights.bin";function LD(n){return new Promise(e=>setTimeout(e)).then(n)}class mc{constructor(e){if(!le().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(mc.URL_SCHEME)&&(e=e.slice(mc.URL_SCHEME.length)),(e==null||e.length===0)&&(e=rne),this.modelJsonFileName=e+sne,this.weightDataFileName=e+ine}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=Ji.join(e.weightData),r=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const s=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=WM(e,s),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await LD(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await LD(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Zg(e)}}}}mc.URL_SCHEME="downloads://";class one{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const r=new FileReader;r.onload=s=>{const i=JSON.parse(s.target.result),o=i.modelTopology;if(o==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=WC(i,u=>this.loadWeights(u));e(l)},r.onerror=s=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(e){const t=[],r=[];for(const o of e)t.push(...o.weights),r.push(...o.paths);const s=this.checkManifestAndWeightFiles(e),i=r.map(o=>this.loadWeightsFile(o,s[o]));return Promise.all(i).then(o=>[t,o])}loadWeightsFile(e,t){return new Promise((r,s)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;r(a)},i.onerror=o=>s(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],r=this.weightsFiles.map(i=>CD(i.name)),s={};for(const i of e)i.paths.forEach(o=>{const a=CD(o);if(t.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(t.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);s[o]=this.weightsFiles[r.indexOf(a)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return s}}const ane=n=>le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(mc.URL_SCHEME)?lne(n.slice(mc.URL_SCHEME.length)):null;an.registerSaveRouter(ane);function lne(n="model"){return new mc(n)}function une(n){return new one(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e,t,r){o(n),t=t??0,r=r??1,a(t,r);let s=0;const i=l=>(l.then(u=>{const h=t+ ++s/n.length*(r-t);return e(h),u}),l);function o(l){B(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){B(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),B(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),B(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function s3(n,e){e==null&&(e={});const t=e.fetchFunc==null?le().platform.fetch:e.fetchFunc,r=n.map(d=>t(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(r):await MD(r,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await MD(a,e.onProgress,.5,1)}function cne(n,e){var t;const r=e.fetchFunc==null?le().platform.fetch:e.fetchFunc;let s=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;s<n.length;){i||(i=(await r(n[s],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){s++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,s/n.length);continue}o.enqueue(u);return}o.close()}})}async function i3(n,e="",t,r){return o3(o=>s3(o,{requestInit:r}))(n,e,t)}function o3(n){return async(e,t="",r)=>{const s=e.map(()=>!1),i={},o=r!=null?r.map(()=>!1):[],a=[];if(e.forEach((m,y)=>{let v=0;m.weights.forEach(w=>{const b="quantization"in w?w.quantization.dtype:w.dtype,S=ac[b]*fe(w.shape),C=()=>{s[y]=!0,i[y]==null&&(i[y]=[]),i[y].push({manifestEntry:w,groupOffset:v,sizeBytes:S})};r!=null?r.forEach((T,O)=>{T===w.name&&(C(),o[O]=!0)}):C(),a.push(w.name),v+=S})}),!o.every(m=>m)){const m=r.filter((y,v)=>!o[v]);throw new Error(`Could not find weights in manifest with names: ${m.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=s.reduce((m,y,v)=>(y&&m.push(v),m),[]),u=[];l.forEach(m=>{e[m].paths.forEach(y=>{const v=t+(t.endsWith("/")?"":"/")+y;u.push(v)})});const h=await n(u),d={};let p=0;return l.forEach(m=>{const y=e[m].paths.length,v=new Ji(h.slice(p,p+y));i[m].forEach(b=>{const S=v.slice(b.groupOffset,b.groupOffset+b.sizeBytes),C=zC(S,[b.manifestEntry]);for(const T in C)d[T]=C[T]}),p+=y}),d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hne="application/octet-stream",dne="application/json";class rk{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(B(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=le().platform.fetch,B(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&B(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s=WM(e,r);if(t.body.append("model.json",new Blob([JSON.stringify(s)],{type:dne}),"model.json"),e.weightData!=null){const o=Ji.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:hne}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Zg(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=t.modelTopology,s=t.weightsManifest;if(r==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return WC(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),r=Ov(e.weightsManifest),s=()=>cne(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:r,getWeightStream:s})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[r,s]=fne(t),i=this.weightPathPrefix||r,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+s);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),r=Ov(e),s=await s3(t,this.loadOptions);return[r,s]}}rk.URL_SCHEME_REGEX=/^https?:\/\//;function fne(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),s=t>e?n.substring(t):"";return[r+"/",s]}function e_(n){return n.match(rk.URL_SCHEME_REGEX)!=null}const a3=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(r=>e_(r)):t=e_(n),t)return sk(n,e)}return null};an.registerSaveRouter(a3);an.registerLoadRouter(a3);function sk(n,e){return new rk(n,e)}function l3(n,e){return sk(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XS{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class u3{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class pne{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function mne(n,e,t,r){const s=arguments;return new pne(Fv(...s))}function Fv(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new XS(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new XS({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new XS({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))}function gne(n){return new u3(n)}function yne(n){return new u3(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ik=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Ji,browserFiles:une,browserHTTPRequest:l3,concatenateArrayBuffers:UM,copyModel:Q7,decodeWeights:zC,decodeWeightsStream:BM,encodeWeights:HT,fromMemory:mne,fromMemorySync:Fv,getLoadHandlers:GM,getModelArtifactsForJSON:WC,getModelArtifactsForJSONSync:UC,getModelArtifactsInfoForJSON:Zg,getSaveHandlers:jM,getWeightSpecs:Ov,http:sk,isHTTPScheme:e_,listModels:K7,loadWeights:i3,moveModel:Y7,registerLoadRouter:F7,registerSaveRouter:P7,removeModel:X7,weightsLoaderFactory:o3,withSaveHandler:gne,withSaveHandlerSync:yne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wne(n,e,t){const r=U(n,"labels","confusionMatrix"),s=U(e,"predictions","confusionMatrix");B(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),B(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),B(s.rank===1,()=>`Expected the rank of predictions to be 1, but got ${s.rank}`),B(r.shape[0]===s.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`),B(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const i=od(Re(r,"int32"),t),o=od(Re(s,"int32"),t),a=yt(i),l=dt(a,o);return Re(l,"int32")}const vne=Q({confusionMatrix_:wne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xne=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:vne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ou,VD=!1;function c3(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,r=!1,s=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(wm(Av,K.backendName)!=null){const y={pixels:n},v={numChannels:e};return K.runKernel(Av,y,v)}const[u,h]=s?[n.videoWidth,n.videoHeight]:[n.width,n.height];let d;if(o)d=n.getContext("2d").getImageData(0,0,u,h).data;else if(r||t)d=n.data;else if(i||s||a){if(Ou==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Ou=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Ou=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Ou.canvas.width=u,Ou.canvas.height=h,Ou.drawImage(n,0,0,u,h),d=Ou.getImageData(0,0,u,h).data}let p;if(e===4)p=new Int32Array(d);else{const y=u*h;p=new Int32Array(y*e);for(let v=0;v<y;v++)for(let w=0;w<e;++w)p[v*e+w]=d[v*4+w]}return zE(p,[h,u,e],"int32")}function bne(n){return n!=null&&n.data instanceof Uint8Array}function Ine(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Sne(n){return n!=null&&n.width!==0&&n.height!==0}function Tne(n){return Ine()&&!(n instanceof ImageBitmap)&&Sne(n)&&!bne(n)}async function _ne(n,e=3){let t=null;if(le().getBool("WRAP_TO_IMAGEBITMAP")&&Tne(n)){let r;try{r=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===n.width&&r.height===n.height?t=r:t=n}else t=n;return c3(t,e)}function h3(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const e=n.rank===2?1:n.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function Cne(n){const e=(n==null?void 0:n.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function Ene(n,e){let t=U(n,"img","toPixels");if(!(n instanceof Et)){const u=t;t=Re(u,"int32"),u.dispose()}h3(t);const[r,s]=t.shape.slice(0,2),i=t.rank===2?1:t.shape[2],o=await t.data(),a=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(s*r*4);for(let u=0;u<r*s;++u){const h=[0,0,0,255];for(let p=0;p<i;p++){const m=o[u*i+p];if(t.dtype==="float32"){if(m<0||m>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${m}.`)}else if(t.dtype==="int32"&&(m<0||m>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${m}.`);i===1?(h[0]=m*a,h[1]=m*a,h[2]=m*a):h[p]=m*a}const d=u*4;l[d+0]=Math.round(h[0]),l[d+1]=Math.round(h[1]),l[d+2]=Math.round(h[2]),l[d+3]=Math.round(h[3])}if(e!=null){VD||wm(Kx,K.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),VD=!0),e.width=s,e.height=r;const u=e.getContext("2d"),h=new ImageData(l,s,r);u.putImageData(h,0,0)}return t!==n&&t.dispose(),l}function kne(n,e,t){let r=U(n,"img","draw");if(!(n instanceof Et)){const o=r;r=Re(o,"int32"),o.dispose()}h3(r),Cne(t==null?void 0:t.imageOptions);const s={image:r},i={canvas:e,options:t};K.runKernel(Kx,s,i)}const d3=Q({fromPixels_:c3}),Nne=Object.freeze(Object.defineProperty({__proto__:null,draw:kne,fromPixels:d3,fromPixelsAsync:_ne,toPixels:Ene},Symbol.toStringTag,{value:"Module"}));function b1(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(fe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const s=e.shape,i=s[s.length-1];let o=1;for(let d=0;d<s.length-1;++d)o*=s[d];const a=n.shape,l=s.slice();l.pop();let u=1;for(let d=i;d<t;++d)u*=a[d],l.push(a[d]);const h=[...Qe(n.shape).map(d=>d/u),1].slice(0,i);return[l,o,u,h]}const $ne=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:b1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_=-2,Rne=-1;function ok(n,e,t){const r=n.shape.length;B(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),B(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)B(e[s]+t[s]<=n.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${n.shape[s]})`)}function Ane(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function ak(n,e,t){const r=[];for(let s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function f3(n,e,t,r){const s=[...n];for(let i=s.length;i<r.length;i++)s.push(1);for(let i=0;i<t;i++)i===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function p3(n,e,t){return t<=n?t:t-(e-1)}function m3(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function Dne(n,e,t,r,s,i,o,a,l){const u=n.length;let h=new Array(u),d=new Array(u),p=new Array(u);if(e.length&&t>0){const m=e[0],y=t+1;h=g3(o,m,y,r,n),d=y3(a,m,y,s,n),p=f3(i,m,y,n)}else for(let m=0;m<u;m++)h[m]=v3(o,r,i,n,m,l),d[m]=x3(a,s,i,n,m,l),p[m]=w3(i,m,l);return{begin:h,end:d,strides:p}}function g3(n,e,t,r,s){const i=[...s],o=m3(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=p3(e,t,a);let u=r[l];n&1<<l&&(u=0),i[a]=u}return i}function y3(n,e,t,r,s){const i=[...s],o=m3(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=p3(e,t,a);let u=r[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=s[a];i[a]<0&&(i[a]+=l),i[a]=Pl(0,i[a],s[a])}return i}function w3(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function v3(n,e,t,r,s,i){let o=e[s];const a=t[s]||1;(n&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),o=Pl(0,o,l-1),o}function x3(n,e,t,r,s,i){let o=e[s];const a=t[s]||1;(n&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),a>0?o=Pl(0,o,l):o=Pl(-1,o,l-1),o}function lk(n,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function uk(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function I1(n,e,t){let r;const s=n.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(o=>{B(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(s).fill(-1):typeof t=="number"?i=[t,...new Array(s-1).fill(-1)]:t.length<s?i=t.concat(new Array(s-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(B(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,i]}function ck(n,e,t,r,s,i,o,a,l){let u;if(r==null?(u=new Array(e.length),u.fill(1)):u=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const d={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let C=0;C<d.dims;C++)h&&1<<C&a&&d.numAddAxisAfterEllipsis++,1<<C&o&&(h=!0);h||(d.ellipsisMask|=1<<d.dims,d.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};One(d,p);let m=!0,y=!0,v=!0;const w=[],b=[];for(let C=0;C<n.length;++C){if(p.strides[C]===0)throw Error(`strides[${C}] must be non-zero`);const T=!!(p.shrinkAxisMask&1<<C),O=n[C];if(O===-1){w.push(T?1:-1);continue}const V=[p.beginMask&1<<C,p.endMask&1<<C],k=[p.strides[C]>0?0:-1,p.strides[C]>0?O:O-1];if(T&&p.strides[C]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&p.strides[C]===1;const $=!!(p.beginMask&1<<C&&p.endMask&1<<C);if(p.beginValid&&p.endValid){if(T){const L=p.begin[C]<0?O+p.begin[C]:p.begin[C];if(p.begin[C]=L,p.end[C]=p.begin[C]+1,L<0||L>=O)throw Error(`slice index ${p.begin[C]} of dimension ${C} out of bounds.`)}else p.begin[C]=zD(p.begin[C],0,p.strides[C],O,V,k),p.end[C]=zD(p.end[C],1,p.strides[C],O,V,k);const E=p.strides[C]===1&&p.begin[C]===0&&p.end[C]===O;m=m&&E,y=y&&(C===0&&p.strides[C]===1||E)}else m=m&&p.strides[C]===1&&$,y=y&&(C===0&&p.strides[C]===1||$);let N,R=!1;if(p.beginValid&&p.endValid?(N=p.end[C]-p.begin[C],R=!0):T?(N=1,R=!0):$&&O>=0&&(p.strides[C]<0?N=-O:N=O,R=!0),R){let E;N===0||N<0!=p.strides[C]<0?E=0:E=Math.trunc(N/p.strides[C])+(N%p.strides[C]!==0?1:0),w.push(E)}else w.push(-1)}for(let C=0;C<p.finalShapeGatherIndices.length;++C){const T=p.finalShapeGatherIndices[C];T>=0?b.push(w[T]):T===t_&&b.push(1)}return{finalShapeSparse:b.filter((C,T)=>p.finalShapeGatherIndices[T]!==t_),finalShape:b,isIdentity:m,sliceDim0:y,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function One(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const s=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(t_),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(Rne),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function zD(n,e,t,r,s,i){if(s[e])return t>0?i[e]:i[e+1&1];{const o=n<0?r+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const b3=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:ok,computeFlatOffset:uk,computeOutShape:ak,getNormalizedAxes:Dne,isSliceContinous:lk,maskToAxes:Ane,parseSliceParams:I1,sliceInfo:ck,startForAxis:v3,startIndicesWithElidedDims:g3,stopForAxis:x3,stopIndicesWithElidedDims:y3,stridesForAxis:w3,stridesWithElidedDims:f3},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const I3="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S3{static sgd(e){return new x1(e)}static momentum(e,t,r=!1){return new tk(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,i=!1){return new nk(e,t,r,s,i)}static adam(e=.001,t=.9,r=.999,s=null){return new ZE(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new YE(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,i=0){return new ek(e,t,r,s,i)}static adagrad(e,t=.1){return new JE(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vu=S3;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pne=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function hk(){return new Promise(n=>Pne(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dk(n,e){const t=n[0].length;n.forEach((s,i)=>{B(s.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),B(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((s,i)=>{for(let o=0;o<t;o++)B(o===e||s[o]===r[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function No(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Bi;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Bi||(Bi={}));function T3(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const i=t[s],o=r[r.length-t.length+s],a=r[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+n}] = ${i} but shape[${s+n}] = ${a}`)}else r[o]=i}return r}function _3(n){const e={FIRST_DIM_SIZE:Bi.FIRST_DIM_SIZE,VALUE_ROWIDS:Bi.VALUE_ROWIDS,ROW_LENGTHS:Bi.ROW_LENGTHS,ROW_SPLITS:Bi.ROW_SPLITS,ROW_LIMITS:Bi.ROW_LIMITS,ROW_STARTS:Bi.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function C3(n){return n.length===0?0:n[0]===Bi.FIRST_DIM_SIZE?n.length-1:n.length}function E3(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const i=n[s],o=e[s+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-n.length}] = ${i} but ragged tensor input.flatValues.shape[${s-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fk=30;function S1(n){return n<=fk?n:Nv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pk(n,e,t){const r=t*(typeof n=="number"?n:n[0]),s=e*(typeof n=="number"?n:n[1]);return[r,s]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wy(n,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)s=s.concat([n[o+1]/e[o],e[o]]);s=s.concat(n.slice(i+1))}return s}function vy(n,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):s.push(o);r.push(...s),r.push(0),r.push(...i)}return r}function xy(n,e,t,r=!0){const s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?r?s.push(e[i-1]*n[i]):s.push(n[i]/e[i-1]):s.push(n[i]);return s}function mk(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function gk(n,e,t){const r=n.slice(0,1);for(let s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T1=1.7580993408473768,_1=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yk=.3275911,wk=.254829592,vk=-.284496736,xk=1.421413741,bk=-1.453152027,Ik=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _a(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function k3(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function N3(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function $3(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function Sk(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function R3(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function A3(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let s=0;s<Math.ceil(n/2);s++){const i=(e?2:-2)*Math.PI*(s/n);t[s]=Math.cos(i),r[s]=Math.sin(i)}return{real:t,imag:r}}function D3(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),s=Math.cos(r),i=Math.sin(r);return{real:s,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS="->",Fne=/->/g,BD=",",UD="...";function Tk(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Fne,"").length)/QS.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${QS}").`);const[r,s]=n.split(QS);B(r.indexOf(UD)===-1,()=>`The ellipsis notation ("${UD}") is not supported yet.`);const i=r.split(BD),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<s.length;++p){const m=s[p];if(!i.some(y=>y.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);a.indexOf(m)===-1&&a.push(m)}for(let p=0;p<r.length;++p){const m=r[p];a.indexOf(m)===-1&&m!==BD&&a.push(m)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let m=0;m<i[p].length;++m)l[p].push(a.indexOf(i[p][m]))}const u=a.length,h=s.length,d=[];for(let p=h;p<u;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function _k(n,e){let t=new Array(n);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<n;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function Ck(n,e,t){const r=new Array(n);for(let s=0;s<t.length;++s){const i=t[s].shape;for(let o=0;o<e[s].length;++o)r[e[s][o]]===void 0?r[e[s][o]]=i[o]:B(r[e[s][o]]===i[o],()=>`Expected dimension ${r[e[s][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function Ek(n,e){const t=n,r=[];let s=0;n.length===0&&t.push(-1),s=n.length+1;for(let o=0;o<s;++o)r.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=Lne(e,a);for(const u of l)i.indexOf(u)===-1&&(r[o].push(u),i.push(u))}return{path:t,steps:r}}function kk(n){return n.every((e,t)=>e===t)}function Lne(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function Nk(n,e,t=0){let r=[];if(typeof e=="number")B(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const s=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);B(s<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}B(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O3(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function P3(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function F3(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function M3(n,e){return`size ${n} must be non-negative, not ${e}`}function V3(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function z3(n,e){const t=fe(n),r=fe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function B3(n,e){const t=fe(n),r=fe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_(){return"segment ids must be >= 0"}function U3(){return"segment ids are not increasing"}function W3(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function j3(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3(n,e){let t=!1,r;for(n<=fk?(r=n,t=!0):r=Nv(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=Nv(n,r+1);return r}function H3(n,e,t){const r=[],s=n.length;for(let i=0;i<s;i++)i!==e?r.push(n[i]):r.push(t);return r}function $k(n,e,t,r){const s=e.shape.length,i=n.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let d=0;d<r;++d)if(n.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const o=n.shape[t],a=[];let l=1,u=1,h=1;for(let d=0;d<r;++d)a.push(n.shape[d]),l*=n.shape[d];for(let d=r;d<t;d++)a.push(n.shape[d]),u*=n.shape[d];for(let d=r;d<s;d++)a.push(e.shape[d]);for(let d=t+1;d<i;d++)a.push(n.shape[d]),h*=n.shape[d];return{batchSize:l,sliceSize:h,outerSize:u,dimSize:o,outputShape:a}}const Mne=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:$k,computeOutShape:H3,segOpComputeOptimalWindowSize:G3},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ca(n){try{return n.map(e=>ba(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function q3(n){return n.map(e=>Eo(e))}const K3=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:wk,ERF_A2:vk,ERF_A3:xk,ERF_A4:bk,ERF_A5:Ik,ERF_P:yk,PARALLELIZE_THRESHOLD:fk,get RowPartitionType(){return Bi},SELU_SCALE:_1,SELU_SCALEALPHA:T1,applyActivation:m1,assertAndGetBroadcastShape:at,assertAxesAreInnerMostDims:vr,assertParamsConsistent:dk,assignToTypedArray:R3,axesAreInnerMostDims:yE,calculateShapes:ru,checkEinsumDimSizes:Ck,checkPadOnDimRoundingMode:Hr,combineLocations:oV,combineRaggedTensorToTensorShapes:T3,complexWithEvenIndex:N3,complexWithOddIndex:$3,computeConv2DInfo:tr,computeConv3DInfo:Jl,computeDefaultPad:ZC,computeDilation2DInfo:ey,computeOptimalWindowSize:S1,computeOutAndReduceShapes:nr,computeOutShape:No,computePool2DInfo:mi,computePool3DInfo:Aa,convertConv2DDataFormat:Da,decodeEinsumEquation:Tk,eitherStridesOrDilationsAreOne:wr,expandShapeToKeepDim:xn,exponent:D3,exponents:A3,fromStringArrayToUint8:q3,fromUint8ToStringArray:Ca,getAxesPermutation:dn,getBroadcastDims:dc,getComplexWithIndex:Sk,getEinsumComputePath:Ek,getEinsumPermutation:_k,getFusedBiasGradient:p1,getFusedDyActivation:f1,getImageCenter:pk,getInnerMostAxes:bn,getPermuted:vy,getRaggedRank:C3,getReductionAxes:Rn,getReshaped:wy,getReshapedPermuted:xy,getRowPartitionTypesHelper:_3,getSliceBeginCoords:mk,getSliceSize:gk,getSparseFillEmptyRowsIndicesDenseShapeMismatch:O3,getSparseFillEmptyRowsNegativeIndexErrorMessage:P3,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:F3,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:V3,getSparseReshapeInputOutputMismatchErrorMessage:B3,getSparseReshapeInputOutputMultipleErrorMessage:z3,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:L3,getSparseReshapeNegativeOutputDimErrorMessage:M3,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:j3,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:n_,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:U3,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:W3,getUndoAxesPermutation:Zl,isIdentityPermutation:kk,log:FX,mergeRealAndImagArrays:_a,prepareAndValidate:b1,prepareSplitSize:Nk,segment_util:Mne,shouldFuse:g1,slice_util:b3,splitRealAndImagArrays:k3,stridesOrDilationsArePositive:hc,tupleValuesAreOne:Ml,upcastType:rs,validateDefaultValueShape:E3,validateInput:l1,validateUpdateShape:BE,warn:Bs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vne=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:y1,nonMaxSuppressionV4Impl:w1,nonMaxSuppressionV5Impl:v1,whereImpl:h1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nne();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X3={kernelName:Xm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,Oc(Re(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne={kernelName:Td,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Ut(Re(t,"float32")),s=Zn(Le(Xe(1),r));return Qt(je(n,s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bne={kernelName:_d,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Zn(Le(Ut(Re(t,"float32")),1));return je(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Une={kernelName:Rc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{let a=n;const l=Rn(t.shape,s);return l.length>0&&(a=ze(a,l)),ee(a,t.shape)},b:()=>{let a=n;const l=Rn(r.shape,s);return l.length>0&&(a=ze(a,l)),ee(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wne={kernelName:Qm,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne={kernelName:Ym,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gne={kernelName:Jm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hne={kernelName:Cd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,Zn(Le(Xe(1),Ut(Re(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qne={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Zn(be(Xe(1),Ut(Re(t,"float32"))));return je(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kne={kernelName:$d,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{const a=be(Ut(t),Ut(r));let l=J(n,je(r,a));const u=Rn(t.shape,s);return u.length>0&&(l=ze(l,u)),ee(l,t.shape)},b:()=>{const a=be(Ut(t),Ut(r));let l=Qt(J(n,je(t,a)));const u=Rn(r.shape,s);return u.length>0&&(l=ze(l,u)),ee(l,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xne={kernelName:kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,be(Ut(Re(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qne={kernelName:Nd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,Le(Xe(1),Ut(Re(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yne(n,e,t,r,s,i){const o=U(n,"dy","avgPool3dGrad"),a=U(e,"input","avgPool3dGrad");let l=o,u=a,h=!1;a.rank===4&&(h=!0,l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),B(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),B(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Hr("avgPool3dGrad",s,i);const d={dy:l,input:u},p={filterSize:t,strides:r,pad:s,dimRoundingMode:i},m=K.runKernel(Ox,d,p);return h?ee(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const Jne=Q({avgPool3dGrad_:Yne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zne={kernelName:eg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>Jne(n,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ere(n,e,t,r,s){const i=U(n,"dy","avgPoolGrad"),o=U(e,"input","avgPoolGrad");B(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),B(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),B(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const h={dy:l,input:a},d={filterSize:t,strides:r,pad:s},p=K.runKernel(Dx,h,d);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const tre=Q({avgPoolGrad_:ere});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nre={kernelName:Zm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:o}=t;return{x:()=>tre(n,r,s,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rre={kernelName:tg,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,s]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>dt(n,s,!1,!0),b:()=>dt(r,n,!0,!1)}:!i&&o?{a:()=>dt(n,s,!1,!1),b:()=>dt(n,r,!0,!1)}:i&&!o?{a:()=>dt(s,n,!1,!0),b:()=>dt(r,n,!1,!1)}:{a:()=>dt(s,n,!0,!0),b:()=>dt(n,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre={kernelName:ng,gradFunc:(n,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>hy(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ire={kernelName:IM,gradFunc:(n,e,t)=>{const r=t,s=r.inputShape,i=r.shape,o=Array.from(i);for(let l=s.length-1;l>=0;l--)if(s[l]===i[l])o[l]=1;else if(s[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>ze(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ore={kernelName:Rd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are={kernelName:Ad,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lre={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:i}=t;return{x:()=>Qn(pi(Oa(r,s),eu(r,i)),n,xt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ure={kernelName:sg,inputsToSave:["x"],gradFunc:X3.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cre={kernelName:ig,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(l=>l.shape),{axis:s}=t,i=ft(s,e[0].shape)[0],o=r.map(l=>l[i]);return ns(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hre={kernelName:og,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return B(Ml(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>cE(r.shape,n,s,o,a,l),filter:()=>KE(r,n,s.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dre={kernelName:ag,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Ta(n,s,i,o,a,1,l),filter:()=>KE(n,r,s.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fre(n,e,t,r,s){let i=n;n.rank===4&&(i=ee(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),B(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),B(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),B(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),B(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),B(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:r,pad:s,filterShape:t};return K.runKernel(Vx,a,l)}const pre=Q({conv3DBackpropFilter_:fre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mre={kernelName:lg,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i}=t;B(Ml(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=e;return{x:()=>rV(o.shape,n,a,s,i),filter:()=>pre(o,n,a.shape,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gre={kernelName:Od,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(Qt(r1(Re(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre={kernelName:Pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(s1(Re(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre={kernelName:ug,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s,exclusive:i,reverse:o}=t;return{x:()=>{const a=dn([s],r.rank);let l=jb(n,s,i,!o);return a!=null&&(l=yt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vre={kernelName:cg,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i,dimRoundingMode:o}=t,a=r??[1,1];B(Ml(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return B(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),B(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),B(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),B(wr(s,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${a}'.`),Hr("depthwiseConv2d",i,o),{x:()=>qV(l.shape,n,u,s,i,a,o),filter:()=>HV(l,n,u.shape,s,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xre={kernelName:hg,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,i={x:r,filter:s,dy:n},o={x:r,filter:s,dy:n};return{x:()=>K.runKernel($v,i,t),filter:()=>K.runKernel(Rv,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bre={kernelName:Ld,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>K.runKernel(Qx,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ire={kernelName:Md,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=J(os(Qt(Ut(t))),2/Math.sqrt(Math.PI));return{x:()=>J(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sre={kernelName:Vd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tre={kernelName:fg,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _re={kernelName:zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,os(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre={kernelName:Bd,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ere={kernelName:Ud,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{const a=je(n,Re(r,"float32")),l=Rn(t.shape,s);return l.length>0?ee(ze(a,l),t.shape):a},b:()=>{let a=J(n,Re(t,"float32"));const l=Rn(r.shape,s);l.length>0&&(a=ee(ze(a,l),r.shape));const u=Ut(r);return Qt(je(a,Re(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kre={kernelName:pg,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[s,i,o,a]=e,l=a??Xe(1),u=Rn(i.shape,s.shape),h=[];if(i.rank===1){for(let T=0;T<s.shape.length-1;++T)h.push(s.shape[T]);h.push(1)}const d=Le(s,i),p=J(n,l),m=e1(be(o,Xe(r))),y=J(J(J(m,m),m),Xe(-.5));return{x:()=>i.rank===1?ee(J(J(n,js(ee(m,[1,1,1,i.shape[0]]),h)),l),s.shape):ee(J(J(n,m),l),s.shape),mean:()=>{let T=J(J(m,Xe(-1)),p);return i.rank===1&&(T=ze(T,u)),ee(T,i.shape)},variance:()=>{let T=J(J(y,d),p);return i.rank===1&&(T=ze(T,u)),ee(T,i.shape)},scale:()=>{const T=J(d,m);let O=J(n,T);return i.rank===1&&(O=ze(O,u)),ee(O,i.shape)},offset:()=>{let T=n;return i.rank===1&&(T=ze(T,u)),ee(T,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nre={kernelName:mg,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,s]=e,{axis:i,batchDims:o}=t,a=ft(i,r.shape)[0],l=(u,h,d)=>()=>{const p=u.shape,m=h.size,y=p.slice(0,a),v=y.length,w=p.slice(i,p.length).slice(1),b=w.length,S=WD(0,v),C=WD(v+1,v+1+b),T=jD([y,[m],w]),O=ee(d,T),V=ee(h,[m]),k=jD([[v],S,C]),$=yt(O,k);let N=c1($,V,u.shape[a]);const R=Zl(k);return N=yt(N,R),N};if(o===1){const u=r.shape[0],h=r.split(u,0);return{x:()=>jr(h.map((m,y)=>l(m,s.slice(y,1),n.slice(y,1))())).reshape(r.shape),indices:()=>s}}else return{x:l(r,s,n),indices:()=>s}}};function WD(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function jD(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $re={kernelName:Wd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>xt(t),b:()=>xt(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rre={kernelName:jd,gradFunc:n=>({x:()=>Re(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Are={kernelName:Gd,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dre={kernelName:Hd,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ore={kernelName:qd,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pre={kernelName:yg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:s}=t,i=qr(r,0);return{x:()=>Qn(i,n,J(n,s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fre={kernelName:Xd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,be(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lre={kernelName:Kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,Re(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mre={kernelName:SM,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const o=os(r);return Le(n,J(ze(n,s,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(n,e,t,r=5,s=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:r,bias:s,alpha:i,beta:o};return K.runKernel(sb,a,l)}const zre=Q({localResponseNormalizationBackprop_:Vre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bre={kernelName:Sg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>zre(r,s,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3(n,e,t,r){return e.rank<t.rank&&(e=ee(e,xn(e.shape,r))),n.rank<t.rank&&(n=ee(n,xn(n.shape,r))),{x:()=>J(n,Re(Es(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD={kernelName:Tg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:s}=r,i=e[0],o=e[1],a=ft(s,i.shape),l=Q3(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ure={kernelName:Qd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>J(n,Re(Oa(t,r),"float32")),b:()=>J(n,Re(id(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wre(n,e,t,r,s,i,o){const a=U(n,"dy","maxPool3dGrad"),l=U(e,"input","maxPool3dGrad"),u=U(t,"output","maxPool3dGrad");let h=a,d=l,p=u,m=!1;l.rank===4&&(m=!0,h=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=ee(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=ee(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),B(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),B(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),B(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Hr("maxPool3dGrad",i,o);const y={dy:h,input:d,output:p},v={filterSize:r,strides:s,pad:i,dimRoundingMode:o},w=K.runKernel(ob,y,v);return m?ee(w,[w.shape[1],w.shape[2],w.shape[3],w.shape[4]]):w}const jre=Q({maxPool3dGrad_:Wre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre={kernelName:Cg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>jre(n,r,s,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hre(n,e,t,r,s,i,o){const a=U(n,"dy","maxPoolGrad"),l=U(e,"input","maxPoolGrad"),u=U(t,"output","maxPoolGrad");B(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),B(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),B(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Hr("maxPoolGrad",i,o);const h={dy:a,input:l,output:u},d={filterSize:r,strides:s,pad:i,dimRoundingMode:o};return K.runKernel(ib,h,d)}const qre=Q({maxPoolGrad_:Hre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kre={kernelName:_g,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>qre(n,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xre={kernelName:Eg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t,i=ft(s,r.shape),a=nr(r.shape,i)[1],l=fe(a);return{x:()=>{const h=r.shape.slice();i.forEach(m=>{h[m]=1});const d=ee(n,h);return je(J(d,ts(r.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qre={kernelName:kg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:s}=r,[i,o]=e,a=ft(s,i.shape),l=Q3(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yre={kernelName:Yd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>J(n,Re(eu(t,r),"float32")),b:()=>J(n,Re(qr(t,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jre={kernelName:Ng,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(o=>o[0]);return{x:()=>vt(n,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zre={kernelName:Jd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{const a=Rn(t.shape,s);return a.length>0?ee(ze(n,a),t.shape):n},b:()=>{const a=J(n,Qt(Tf(je(t,r)))),l=Rn(r.shape,s);return l.length>0?ee(ze(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ese={kernelName:Zd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{const a=J(n,Re(r,"float32")),l=Rn(t.shape,s);return l.length>0?ee(ze(a,l),t.shape):a},b:()=>{const a=J(n,Re(t,"float32")),l=Rn(r.shape,s);return l.length>0?ee(ze(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse={kernelName:$g,gradFunc:n=>({x:()=>Qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nse={kernelName:Dg,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>kn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rse={kernelName:Ag,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sse={kernelName:Og,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return Qs(n,r).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HD={kernelName:Pg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(o=>o[0]);return{x:()=>vt(n,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise={kernelName:ef,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,s]=e,i=t,o=r,a=at(i.shape,o.shape);return{a:()=>{const h=Re(o,"float32");let d=J(n,J(h,Fo(i,Le(h,Xe(1)))));const p=Rn(i.shape,a);return p.length>0&&(d=ze(d,p)),ee(d,i.shape)},b:()=>{const h=qr(i,0),d=Qn(h,ks(i),xt(i));let p=J(n,J(s,d));const m=Rn(o.shape,a);return m.length>0&&(p=ze(p,m)),ee(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ose={kernelName:Fg,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,s=qr(t,0);return{x:()=>Qn(s,n,J(n,r)),alpha:()=>{let i=Qn(s,xt(n),J(n,t));const o=Rn(r.shape,n.shape);return o.length>0&&(i=ze(i,o)),ee(i,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(n,e,t){const r=n.shape.slice();r[t]=1;const s=ee(e,r),i=Tm(n,t,!0,!1),o=Tm(n,t,!0,!0),a=J(i,o);return J(s,a)}function lse(n,e,t){const r=n.shape.length,s=r-t.length,i=dn(t,r);let o=n;i!=null&&(o=yt(n,i));const a=o.shape.slice(),u=a.splice(r-t.length,t.length).reduce((p,m)=>p*m,1);a.push(u);const h=o.reshape(a);let d=ase(h,e,s);if(d=d.reshape(o.shape),i!=null){const p=Zl(i);d=yt(d,p)}return d}const use={kernelName:Lg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;let i=[];return s==null?i=r.shape.map((o,a)=>a):typeof s=="number"?i=[s]:i=s,{x:()=>lse(r,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cse={kernelName:Fd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{const a=je(n,Re(r,"float32")),l=Rn(t.shape,s);return l.length>0?ee(ze(a,l),t.shape):a},b:()=>{let a=J(n,Re(t,"float32"));const l=Rn(r.shape,s);l.length>0&&(a=ee(ze(a,l),r.shape));const u=Ut(r);return Qt(je(a,Re(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hse={kernelName:tf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,Qt(Ut(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dse={kernelName:rf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=J(eu(t,6),Oc(t));return{x:()=>J(n,Re(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse={kernelName:nf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,Re(Oc(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pse={kernelName:Mg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mse={kernelName:zg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>K.runKernel(wb,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse={kernelName:Vg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>K.runKernel(yb,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yse={kernelName:Bg,gradFunc:(n,e,t)=>{const{dims:r}=t,s=ft(r,n.shape);return{x:()=>Xs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wse={kernelName:sf,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse={kernelName:of,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qt(je(n,J(Fo(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xse={kernelName:Ug,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Re(xt(t),"float32"),t:()=>J(n,Re(t,n.dtype)),e:()=>J(n,Re(ly(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse={kernelName:af,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=qr(t,Xe(0)),s=Xe(T1),i=Xe(_1),o=J(n,i),a=J(J(n,s),os(Re(t,"float32")));return Qn(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ise={kernelName:hf,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,J(t,Le(Xe(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sse={kernelName:cf,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tse={kernelName:lf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(ry(Re(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se={kernelName:uf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(Wb(Re(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cse={kernelName:Wg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:s,size:i}=t,o=r.shape,[a,l]=I1(r,s,i),u=[];for(let h=0;h<n.rank;h++)u.push([a[h],o[h]-a[h]-l[h]]);return{x:()=>Pa(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ese={kernelName:qg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:s}=t,i=!0,o=J(n,r);return{logits:()=>Le(o,J(ze(o,[s],i),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kse={kernelName:df,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,ji(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD={kernelName:Gg,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>ny(n,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KD={kernelName:Hg,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>vn(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nse={kernelName:ff,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,J(Zn(Re(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $se={kernelName:Eb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,J(Re(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rse={kernelName:pf,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Xe(2);return{a:()=>J(n,J(s,Le(t,r))),b:()=>J(n,J(s,Le(r,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ase={kernelName:vf,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dse={kernelName:mf,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=at(t.shape,r.shape);return{a:()=>{let a=n;const l=Rn(t.shape,s);return l.length>0&&(a=ze(a,l)),ee(a,t.shape)},b:()=>{let a=n;const l=Rn(r.shape,s);return l.length>0&&(a=ze(a,l)),ee(Qt(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ose={kernelName:jg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:i}=t;ft(i,r.shape).forEach(u=>{s[u]=1});const a=ee(n,s),l=J(a,ts(r.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pse={kernelName:gf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>je(n,Ut(ry(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse={kernelName:yf,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(Le(Xe(1),Ut(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse={kernelName:wf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let o=xt(r);if(r.rank===1)for(let a=0;a<s[0];++a)o=be(o,vt(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)o=be(o,vt(n,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let u=0;u<s[2];++u)o=be(o,vt(n,[a*r.shape[0],l*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let u=0;u<s[2];++u)for(let h=0;h<s[3];++h)o=be(o,vt(n,[a*r.shape[0],l*r.shape[1],u*r.shape[2],h*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mse={kernelName:Ju,gradFunc:(n,e,t)=>{const r=t,{perm:s}=r,i=Zl(s);return{x:()=>yt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vse={kernelName:Xg,gradFunc:(n,e,t)=>{const r=t,{axis:s}=r;return{value:()=>jr(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse={kernelName:Qg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bse(n,t)}}};function Bse(n,e){const t=zo(e,xt(e)),r=_f(n,t);let s=Oa(e,Xe(0,"int32"));const i=r.rank-s.rank;for(let a=0;a<i;++a)s=dr(s,a+1);s=pi(s,ts(r.shape,"bool"));const o=xt(r);return Qn(s,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Use={kernelName:Yg,gradFunc:n=>({x:()=>xt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wse=[X3,zne,Bne,Une,Wne,jne,Gne,Hne,qne,Kne,Xne,Qne,Zne,nre,rre,sre,ire,ore,are,lre,ure,cre,dre,hre,mre,gre,yre,wre,vre,xre,cse,bre,Ire,Sre,Tre,_re,Ere,Cre,kre,Nre,$re,Rre,Are,Dre,Ore,Pre,Fre,Lre,Mre,Bre,GD,GD,Ure,Gre,Kre,Xre,Qre,Yre,Jre,Zre,ese,tse,nse,rse,sse,HD,HD,ise,ose,use,hse,dse,fse,pse,mse,gse,yse,wse,vse,xse,bse,Ise,Sse,Tse,_se,Cse,Ese,kse,qD,qD,KD,KD,Nse,Rse,$se,Ase,Dse,Ose,Pse,Fse,Lse,Mse,Vse,zse,Use];for(const n of Wse)TM(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.abs=function(){return this.throwIfDisposed(),En(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.acos=function(){return this.throwIfDisposed(),GC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.acosh=function(){return this.throwIfDisposed(),HC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.add=function(n){return this.throwIfDisposed(),be(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.all=function(n,e){return this.throwIfDisposed(),zb(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.any=function(n,e){return this.throwIfDisposed(),bm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.argMax=function(n){return this.throwIfDisposed(),cc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.argMin=function(n){return this.throwIfDisposed(),qC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.asScalar=function(){return this.throwIfDisposed(),B(this.size===1,()=>"The array must have only 1 element."),ee(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.asType=function(n){return this.throwIfDisposed(),Re(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.as1D=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.as2D=function(n,e){return this.throwIfDisposed(),ee(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ee(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),ee(this,[n,e,t,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.as5D=function(n,e,t,r,s){return this.throwIfDisposed(),ee(this,[n,e,t,r,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.asin=function(){return this.throwIfDisposed(),KC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.asinh=function(){return this.throwIfDisposed(),XC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.atan=function(){return this.throwIfDisposed(),QC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.atan2=function(n){return this.throwIfDisposed(),YC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.atanh=function(){return this.throwIfDisposed(),JC(this)};me().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),ty(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),ny(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.batchNorm=function(n,e,t,r,s){return this.throwIfDisposed(),xf(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Zu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.cast=function(n){return this.throwIfDisposed(),Re(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.ceil=function(){return this.throwIfDisposed(),iE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),is(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Et&&(n=[n]),vn([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.conv1d=function(n,e,t,r,s,i){return this.throwIfDisposed(),Bb(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.conv2dTranspose=function(n,e,t,r,s){return this.throwIfDisposed(),Ub(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.conv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),Ta(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.cos=function(){return this.throwIfDisposed(),ry(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.cosh=function(){return this.throwIfDisposed(),Wb(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Tm(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),jb(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),fE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.depthwiseConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),bf(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.dilation2d=function(n,e,t,r,s){return this.throwIfDisposed(),pE(this,n,e,t,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.divNoNan=function(n){return this.throwIfDisposed(),mE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.div=function(n){return this.throwIfDisposed(),je(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.dot=function(n){return this.throwIfDisposed(),gE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.elu=function(){return this.throwIfDisposed(),If(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.equal=function(n){return this.throwIfDisposed(),Es(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.erf=function(){return this.throwIfDisposed(),Gb(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),wE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.exp=function(){return this.throwIfDisposed(),os(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.expandDims=function(n){return this.throwIfDisposed(),dr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.expm1=function(){return this.throwIfDisposed(),vE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.fft=function(){return this.throwIfDisposed(),gy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.flatten=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.floor=function(){return this.throwIfDisposed(),Tf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.floorDiv=function(n){return this.throwIfDisposed(),Vb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.gather=function(n,e,t){return this.throwIfDisposed(),_f(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Oa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.greater=function(n){return this.throwIfDisposed(),qr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.ifft=function(){return this.throwIfDisposed(),ud(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.irfft=function(){return this.throwIfDisposed(),o1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.isFinite=function(){return this.throwIfDisposed(),xE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.isInf=function(){return this.throwIfDisposed(),bE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.isNaN=function(){return this.throwIfDisposed(),IE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.leakyRelu=function(n){return this.throwIfDisposed(),iy(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.lessEqual=function(n){return this.throwIfDisposed(),eu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.less=function(n){return this.throwIfDisposed(),id(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),SE(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logSigmoid=function(){return this.throwIfDisposed(),TE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Kb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),ay(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.log=function(){return this.throwIfDisposed(),ks(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.log1p=function(){return this.throwIfDisposed(),oy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logicalAnd=function(n){return this.throwIfDisposed(),pi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logicalNot=function(){return this.throwIfDisposed(),ly(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logicalOr=function(n){return this.throwIfDisposed(),Xb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.logicalXor=function(n){return this.throwIfDisposed(),_E(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),dt(this,n,e,t)};me().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),uy(this,n,e,t,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.max=function(n,e){return this.throwIfDisposed(),Ks(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.maximum=function(n){return this.throwIfDisposed(),zo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.mean=function(n,e){return this.throwIfDisposed(),un(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.min=function(n,e){return this.throwIfDisposed(),sd(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.minimum=function(n){return this.throwIfDisposed(),zl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),EE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.mod=function(n){return this.throwIfDisposed(),kE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.mul=function(n){return this.throwIfDisposed(),J(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.neg=function(){return this.throwIfDisposed(),Qt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Sf(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.notEqual=function(n){return this.throwIfDisposed(),fc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),od(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.onesLike=function(){return this.throwIfDisposed(),Ns(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.pad=function(n,e){return this.throwIfDisposed(),Pa(this,n,e)};me().prototype.pool=function(n,e,t,r,s,i){return this.throwIfDisposed(),NE(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.pow=function(n){return this.throwIfDisposed(),Fo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.prelu=function(n){return this.throwIfDisposed(),dy(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.prod=function(n,e){return this.throwIfDisposed(),$E(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.reciprocal=function(){return this.throwIfDisposed(),FE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.relu=function(){return this.throwIfDisposed(),Zi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.relu6=function(){return this.throwIfDisposed(),Jb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ee(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.reshape=function(n){return this.throwIfDisposed(),ee(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),YV(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),JV(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.reverse=function(n){return this.throwIfDisposed(),Xs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.rfft=function(){return this.throwIfDisposed(),yy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.round=function(){return this.throwIfDisposed(),Zb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.rsqrt=function(){return this.throwIfDisposed(),e1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.selu=function(){return this.throwIfDisposed(),t1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.separableConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),n1(this,n,e,t,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sigmoid=function(){return this.throwIfDisposed(),ji(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sign=function(){return this.throwIfDisposed(),LE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sin=function(){return this.throwIfDisposed(),r1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sinh=function(){return this.throwIfDisposed(),s1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.slice=function(n,e){return this.throwIfDisposed(),vt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.softmax=function(n){return this.throwIfDisposed(),my(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.softplus=function(){return this.throwIfDisposed(),Dc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),hy(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.split=function(n,e){return this.throwIfDisposed(),ns(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sqrt=function(){return this.throwIfDisposed(),Zn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.square=function(){return this.throwIfDisposed(),Ut(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.squaredDifference=function(n){return this.throwIfDisposed(),a1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.squeeze=function(n){return this.throwIfDisposed(),nu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Et?[this,n]:[this,...n];return jr(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.step=function(n){return this.throwIfDisposed(),Oc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.stridedSlice=function(n,e,t,r,s,i,o,a){return this.throwIfDisposed(),ME(this,n,e,t,r,s,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sub=function(n){return this.throwIfDisposed(),Le(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.sum=function(n,e){return this.throwIfDisposed(),ze(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.tan=function(){return this.throwIfDisposed(),VE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.tanh=function(){return this.throwIfDisposed(),Vl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.tile=function(n){return this.throwIfDisposed(),js(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.toBool=function(){return this.throwIfDisposed(),Re(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.toFloat=function(){return this.throwIfDisposed(),Re(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.toInt=function(){return this.throwIfDisposed(),Re(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.topk=function(n,e){return this.throwIfDisposed(),UE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.transpose=function(n){return this.throwIfDisposed(),yt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.unique=function(n){return this.throwIfDisposed(),WE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),c1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.unstack=function(n){return this.throwIfDisposed(),Qs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.where=function(n,e){return this.throwIfDisposed(),Qn(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */me().prototype.zerosLike=function(){return this.throwIfDisposed(),xt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mo extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mo.prototype)}}class fi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,fi.prototype)}}class ne extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ne.prototype)}}class ct extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ct.prototype)}}class Rk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Rk.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Y3{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gc(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function go(n,e){if(!n)throw new Rk(e)}function XD(n,e){let t=0;for(const r of n)r===e&&t++;return t}function es(n){return n.length===1?n[0]:n}function Mt(n){return Array.isArray(n)?n:[n]}function ra(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Uu(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ui={};function Ak(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function r_(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>r_(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:r_(r))}}}function by(n,e={},t={},r="object",s=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in ui)o=ui[i];else if(o=e[i],o==null)throw new ne(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new ne(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in ui?[a,l]=ui.className:o in e&&([a,l]=e[o]),a==null)throw new ne(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const m of Object.keys(ui))u[m]=ui[m];for(const m of Object.keys(t))u[m]=t[m];const h=i.config;h.customObjects=u;const d=Object.assign({},ui);for(const m of Object.keys(t))ui[m]=t[m];r_(i.config);const p=l(a,i.config,t,s);return ui=Object.assign({},d),p}else{const u=Object.assign({},ui);for(const d of Object.keys(t))ui[d]=t[d];const h=new a(i.config);return ui=Object.assign({},u),h}}}function jse(n,e){return n<e?-1:n>e?1:0}function aw(n,e){return-1*jse(n,e)}function El(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function Gse(n){if(n==null)throw new ne(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Fc(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new ne(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Dk(n,e,t=0,r=1/0){return go(t>=0),go(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(s=>typeof s===e)}function qn(n,e){Array.isArray(n)?(B(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>qn(t,`element ${r+1} of ${e}`))):B(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${J3(n)}.`)}function J3(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>J3(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function Hse(n,e,t){let r=t!=null?t():hr(),s;return(...o)=>{const a=t!=null?t():hr();return a-r<e||(r=a,s=n(...o)),s}}function Z3(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let qse=0;function ez(){return qse++}const lw={};function C1(n=""){return n in lw||(lw[n]=0),lw[n]+=1,n+lw[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Kse=["channelsFirst","channelsLast"],Xse=["nearest","bilinear"],Qse=["valid","same","causal"],Yse=["max","avg"],Jse=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $h=new Map;function In(n){Fc(Kse,"DataFormat",n)}function Zse(n){Fc(Xse,"InterpolationFormat",n)}function Ys(n){Fc(Qse,"PaddingMode",n)}function tz(n){Fc(Yse,"PoolMode",n)}const rm=[],QD="/";function ec(n,e){rm.push(n);try{const t=e();return rm.pop(),t}catch(t){throw rm.pop(),t}}function eie(){return rm.length===0?"":rm.join(QD)+QD}function nz(n){if(!sz(n))throw new Error("Not a valid tensor name: '"+n+"'");return eie()+n}function rz(n){if(!sz(n))throw new Error("Not a valid tensor name: '"+n+"'");$h.has(n)||$h.set(n,0);const e=$h.get(n);if($h.set(n,$h.get(n)+1),e>0){const t=`${n}_${e}`;return $h.set(t,1),t}else return n}const tie=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function sz(n){return!!n.match(tie)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nie(n){return n===parseInt(n.toString(),10)}function kl(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let s=e;s<t;++s)r*=n[s];return r}function cd(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function Bl(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function Ki(n,e){if(e<n)throw new ne(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let YS;function Ln(){return YS==null&&(YS=VC().epsilon()),YS}function Xi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $o(n,e){return Re(n,e)}function Iy(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ee(n,t)}function rie(n,e){return ae(()=>{if(n.shape.length!==2)throw new ne(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Iy(n,1);return s_(t,[1,e,1])})}function sie(n){const e=[kl(n.shape)];return ee(n,e)}function iie(n){if(n.rank<=1)throw new ne(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],kl(n.shape,1)];return ee(n,e)}function tc(n,e,t){return ae(()=>{switch(n.rank){case 1:return fy(n,e,t);case 2:return i1(n,[e,0],[t,n.shape[1]]);case 3:return py(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return ld(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return vt(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return vt(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new ne(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function JS(n,e,t){return ae(()=>{switch(n.rank){case 1:return fy(n,e,t);case 2:return i1(n,[0,e],[n.shape[0],t]);case 3:return py(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return ld(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new ne(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function uw(n,e,t,r){return ae(()=>{switch(n.rank){case 1:return fy(n,e,t);case 2:switch(r){case 1:return tc(n,e,t);case 2:return JS(n,e,t);default:throw new ne(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return tc(n,e,t);case 2:return py(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return JS(n,e,t);default:throw new ne(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return tc(n,e,t);case 2:return ld(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return ld(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return JS(n,e,t);default:throw new ne(`The axis is not within the rank of the tensor ${r}`)}default:throw new ne(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Ok(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),vn(n,e)}function YD(n,e){switch(n.rank){case 1:return oE([n,e]);case 2:return aE([n,e],0);case 3:return lE([n,e],0);case 4:return uE([n,e],0);default:throw new ne(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function s_(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new ne(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return js(n,e)}function E1(n,e=0,t=1,r,s){return Yb(n,e,t,r,s)}function Ro(n,e,t,r){if(n.rank<2||e.rank<2)throw new ct(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(s!==i)throw new ct(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return JT({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?i_(n.rank,r,Xi()):null,activation:t});{const s=n.shape.slice(),i=s.pop();n=ee(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],h=Array.from({length:e.rank},(y,v)=>v===0?e.rank-2:v<=e.rank-2?v-1:v);e=ee(yt(e,h),[l,-1]);const d=[...s,...u];return ee(JT({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?i_(n.rank,r,Xi()):null,activation:t}),d)}}function iz(n,e,t){return ae(()=>(Array.isArray(e)?e=mr(e,"int32"):e=Re(e,"int32"),_f(n,e,t)))}function Sy(n){return J(n,n)}function i_(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new ne(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?ee(e,[1,r[0],1,1,1]):ee(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?ee(e,[1,1,1,1,r[0]]):ee(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?ee(e,[1,r[0],1,1]):ee(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?ee(e,[1,1,1,r[0]]):ee(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?ee(e,[1,r[0],1]):ee(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?ee(e,[1,1,r[0]]):ee(e,[1].concat(r))}else if(n<3)return e;throw new ne(`Unsupported input rank by biasAdd: ${e.rank}`)}function eo(n,e,t){return ae(()=>(t==null&&(t=Xi()),In(t),be(n,i_(n.rank,e,t))))}function oie(n,e=1){if(e!==1)throw new ct(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return If(n)}function aie(n){return ae(()=>je(n,be(En(n),1)))}function oz(n,e,t,r){return ae(()=>HE(n,e,t,r))}function lie(n){return ae(()=>{const e=be(.5,J(.2,n));return is(e,0,1)})}function Ty(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const uie=["fanIn","fanOut","fanAvg"],cie=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hie(n){Fc(uie,"FanMode",n)}function die(n){Fc(cie,"Distribution",n)}class gi extends Pc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Pk extends gi{apply(e,t){return kn(e,t)}}Pk.className="Zeros";Ie(Pk);class k1 extends gi{apply(e,t){return ts(e,t)}}k1.className="Ones";Ie(k1);class Fk extends gi{constructor(e){if(super(),typeof e!="object")throw new ne(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ne(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ae(()=>J(Xe(this.value),ts(e,t)))}getConfig(){return{value:this.value}}}Fk.className="Constant";Ie(Fk);class Lk extends gi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return tu(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Lk.className="RandomUniform";Ie(Lk);class Mk extends gi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ct(`randomNormal does not support dType ${t}.`);return E1(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Mk.className="RandomNormal";Ie(Mk);class Vk extends gi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ct(`truncatedNormal does not support dType ${t}.`);return u1(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Vk.className="TruncatedNormal";Ie(Vk);class zk extends gi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ae(()=>{if(e.length!==2||e[0]!==e[1])throw new ne("Identity matrix initializer can only be used for 2D square matrices.");return J(this.gain,Hb(e[0]))})}getConfig(){return{gain:this.gain}}}zk.className="Identity";Ie(zk);function fie(n,e="channelsLast"){let t,r;if(In(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const s=kl(n,2);t=n[1]*s,r=n[0]*s}else if(e==="channelsLast"){const s=kl(n,0,n.length-2);t=n[n.length-2]*s,r=n[n.length-1]*s}}else{const s=kl(n);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class as extends gi{constructor(e){if(super(),e.scale<0)throw new ne(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,hie(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,die(this.distribution),this.seed=e.seed}apply(e,t){const r=fie(e),s=r[0],i=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,s):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(s+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ct(`${this.getClassName()} does not support dType ${t}.`);return u1(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return tu(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}as.className="VarianceScaling";Ie(as);class N1 extends as{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return as.className}}N1.className="GlorotUniform";Ie(N1);class $1 extends as{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return as.className}}$1.className="GlorotNormal";Ie($1);class R1 extends as{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return as.className}}R1.className="HeNormal";Ie(R1);class A1 extends as{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return as.className}}A1.className="HeUniform";Ie(A1);class D1 extends as{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return as.className}}D1.className="LeCunNormal";Ie(D1);class O1 extends as{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return as.className}}O1.className="LeCunUniform";Ie(O1);class Bk extends gi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ae(()=>{if(e.length<2)throw new ct("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=fe(e.slice(0,-1)),s=e[e.length-1],i=r*s;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(s,r),Math.min(s,r)],a=E1(o,0,1,t,this.seed),l=QE.qr(a,!1);let u=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return u=J(u,d.sign()),r<s&&(u=u.transpose()),J(Xe(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}Bk.className="Orthogonal";Ie(Bk);const JD={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ZD(n,e={}){return by(n,Us.getMap().classNameMap,e,"initializer")}function cn(n){return Ak(n)}function nn(n){if(typeof n=="string"){const e=n in JD?JD[n]:n;if(e==="GlorotNormal")return new $1;if(e==="GlorotUniform")return new N1;if(e==="HeNormal")return new R1;if(e==="HeUniform")return new A1;if(e==="LeCunNormal")return new D1;if(e==="LeCunUniform")return new O1;{const t={};return t.className=e,t.config={},ZD(t)}}else return n instanceof gi?n:ZD(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function o_(n){return Array.isArray(n)&&Array.isArray(n[0])}function Lv(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function nt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new ne(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function At(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new ne(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mv(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const eO="Variable";class az{constructor(e,t="float32",r=eO,s=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=ez(),r=r??eO,this.originalName=nz(r),this.name=rz(this.originalName),this.trainable_=s,this.constraint=i,this.val=jE(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),pie(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function pie(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function a_(n){return n.map(e=>e.read())}function Uk(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Nn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Qi{constructor(e,t,r,s,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=i,this.outputTensorIndex=a,this.id=ez(),o!=null&&(this.originalName=nz(o),this.name=rz(this.originalName)),this.rank=t.length}}let mie=0;class P1{constructor(e,t){this.callArgs=t,this.id=mie++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let gie=0;class pt extends Pc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=gie++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=ra(r)+"_"+C1(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),r=[i].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new fi(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ne(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return es(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return es(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new mo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new mo(`Layer ${this.name} is not connected, no input to return.`);return es(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new mo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new mo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return es(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Mt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=Mt(this.inputSpec);if(t.length!==r.length)throw new ne(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let s=0;s<t.length;s++){const i=t[s],o=r[s];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new ne(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new ne(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new ne(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new ne(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const h=Number(u),d=o.axes[u],p=h>=0?l[h]:l[l.length+h];if(d!=null&&[d,null].indexOf(p)===-1)throw new ne(`Input ${s} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${d} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],h=i.shape[l];if(u!=null&&h!=null&&u!==h)throw new ne(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=Mt(e),s=vie(e),i=xie(e);if(s===i)throw new ne("Arguments to apply() must be all SymbolicTensors or all Tensors");return ec(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Mt(e))o.push(a.shape);this.build(es(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Mt(o),l=[];for(let u of a)r.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=es(l),this.activityRegularizer!=null)throw new ct("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=yie(e),a=this.computeOutputShape(o);let l;const u=wie(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((h,d)=>new Qi(u,h,this,Mt(e),t,this.name,d)):l=new Qi(u,a,this,Mt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new ct("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new mo(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new mo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new fi(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Mv(this.weights)}build(e){this.built=!0}getWeights(e=!1){return a_(e?this.trainableWeights:this.weights)}setWeights(e){ae(()=>{const t=this.weights;if(t.length!==e.length)throw new ne(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=a_(t);for(let i=0;i<s.length;++i){const o=s[i],a=t[i],l=e[i];if(!mt(o.shape,l.shape))throw new ne(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}Uk(r)})}addWeight(e,t,r,s,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ne(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=l!=null?l():nn("zeros"));const u=s.apply(t,r),h=new az(u,r,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(h.read())),o==null&&(o=!0),o?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Mt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),i=Mt(t),o=Mt(s);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,r,s,i,o,a=null){const l=Mt(e);t=Mt(t),r=Mt(r),s=Mt(s),i=Lv(i),o=Lv(o);const u=[],h=[],d=[];for(const p of l)u.push(p.sourceLayer),h.push(p.nodeIndex),d.push(p.tensorIndex);new P1({outboundLayer:this,inboundLayers:u,nodeIndices:h,tensorIndices:d,inputTensors:l,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function yie(n){n=Mt(n);const e=[];for(const t of n)e.push(t.shape);return es(e)}function wie(n){return"float32"}function lz(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let i=0;i<r.inboundLayers.length;i++){const o=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],u=lz(o,a,l);for(const h of u)s.indexOf(h)===-1&&s.push(h)}return s}}}function vie(n){let e=!0;for(const t of Mt(n))if(!(t instanceof Qi)){e=!1;break}return e}function xie(n){let e=!0;for(const t of Mt(n))if(t instanceof Qi){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ef extends pt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:C1("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ne("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new ne("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ne("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new Qi(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new P1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ne(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Ef.className="InputLayer";Ie(Ef);function uz(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new ne("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Ef({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bie(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Re(e,n.dtype)}catch{throw new ne(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class yl{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof yl)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=bie(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new ne(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Qi){if(this.id2Value[e.id]==null)throw new ne(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ne(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Qi){if(this.id2Value[e.id]==null)throw new ne(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ne(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&ot(this.id2Mask)}}const Vv=new Y3,zv=new Y3;function Iie(n){Vv!=null&&Vv.setMaxEntries(n),zv!=null&&zv.setMaxEntries(n)}function Gp(n,e,t,r){const s=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(y=>y.name),l=[],u=e.names();for(const y of a)u.indexOf(y)!==-1?l.push(e.getValue(y)):l.push(null);const h=a.join(",")+"|"+e.names().sort().join(",");let d=Vv.get(h),p;if(d==null){const y=Sie(o,e);d=y.sorted,p=y.recipientCounts,Vv.put(h,d),zv.put(h,p)}p={},s||Object.assign(p,zv.get(h));const m=new yl(e);for(let y=0;y<d.length;++y){const v=d[y],w=v.sourceLayer;if(w instanceof Ef)continue;const b=[],S=[],C=[];let T=!1;for(const N of v.inputs){const R=m.getValue(N),E=m.getMask(N);b.push(R),S.push(E),E!=null&&(T=!0),s||(p[N.name]--,p[N.name]===0&&!e.hasKey(N)&&a.indexOf(N.name)===-1&&!R.isDisposed&&N.sourceLayer.stateful!==!0&&C.push(R))}T&&(t=t||{},t.mask=S[0]);const O=Mt(w.apply(b,t));let V=null;w.supportsMasking&&(V=w.computeMask(b,S));const k=_ie(v),$=Array.isArray(k)?k:[k];for(let N=0;N<$.length;++N){m.hasKey($[N])||m.add($[N],O[N],Array.isArray(V)?V[0]:V);const R=a.indexOf($[N].name);R!==-1&&(l[R]=O[N])}s||ot(C)}return m.disposeMasks(),i?l:l[0]}function Sie(n,e){B(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const s=tO(n[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const i of n){const{sorted:o,recipientMap:a}=tO(i,e);for(const l of o)s.has(l.name)||(t.push(l),s.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(u=>r[l].add(u))}}return{sorted:t,recipientCounts:Tie(r)}}function Tie(n){const e={};for(const t in n)e[t]=n[t].size;return e}function tO(n,e){const t=new Set,r=[],s={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)s[u.name]==null&&(s[u.name]=new Set),s[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:r,recipientMap:s}}function _ie(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const s of n.sourceLayer.inboundNodes[r].outputTensors)if(s.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cie=le();Cie.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Iie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wk(n,e){return ae(()=>Zn(ze(J(n,n),e,!0)))}class _y extends Pc{getConfig(){return{}}}class jk extends _y{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>{const t=Wk(e,this.axis),r=is(t,0,this.maxValue);return J(e,je(r,be(Ln(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}jk.className="MaxNorm";Ie(jk);class Gk extends _y{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>je(e,be(Ln(),Wk(e,this.axis))))}getConfig(){return{axis:this.axis}}}Gk.className="UnitNorm";Ie(Gk);class Hk extends _y{apply(e){return Zi(e)}}Hk.className="NonNeg";Ie(Hk);class qk extends _y{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>{const t=Wk(e,this.axis),r=be(J(this.rate,is(t,this.minValue,this.maxValue)),J(1-this.rate,t));return J(e,je(r,be(Ln(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}qk.className="MinMaxNorm";Ie(qk);const nO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Mn(n){return Ak(n)}function rO(n,e={}){return by(n,Us.getMap().classNameMap,e,"constraint")}function Vn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in nO?nO[n]:n,config:{}};return rO(t)}else return n instanceof _y?n:rO(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eie(n){return new jk(n)}function kie(n){return new Gk(n)}function Nie(){return new Hk}function $ie(n){return new qk(n)}const Rie=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:Eie,minMaxNorm:$ie,nonNeg:Nie,unitNorm:kie},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Aie(){return new Pk}function Die(){return new k1}function Oie(n){return new Fk(n)}function Pie(n){return new Lk(n)}function Fie(n){return new Mk(n)}function Lie(n){return new Vk(n)}function Mie(n){return new zk(n)}function Vie(n){return new as(n)}function zie(n){return new N1(n)}function Bie(n){return new $1(n)}function Uie(n){return new R1(n)}function Wie(n){return new A1(n)}function jie(n){return new D1(n)}function Gie(n){return new O1(n)}function Hie(n){return new Bk(n)}const qie=Object.freeze(Object.defineProperty({__proto__:null,constant:Oie,glorotNormal:Bie,glorotUniform:zie,heNormal:Uie,heUniform:Wie,identity:Mie,leCunNormal:jie,leCunUniform:Gie,ones:Die,orthogonal:Hie,randomNormal:Fie,randomUniform:Pie,truncatedNormal:Lie,varianceScaling:Vie,zeros:Aie},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ul(n){if(n==null)return;const e=[],t=[],r=[];for(const s in n){const i=n[s];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(s),r.push(o)}}if(e.length>0){const s=await Promise.all(e);for(let i=0;i<s.length;++i)n[t[i]]=s[i][0];ot(r)}}function cz(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var sO;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(sO||(sO={}));const Kie=125;class hd{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class hz{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class Xie extends hd{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const i=t[s];if(typeof i=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+i*r;else{let o;s in this.totals?o=this.totals[s]:this.totals[s]=0;const a=ae(()=>be(this.totals[s],J(i,r)));this.totals[s]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:ae(()=>{const s=J(je(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),Fn(t[r])}))}}class dz extends hd{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),r.push(a)}}const s=await Promise.all(e);for(let i=0;i<s.length;++i)this.history[t[i]][r[i]].dispose(),this.history[t[i]][r[i]]=s[i][0]}}class fz extends hd{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||hk,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Kie),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");kv(this.yieldEvery)&&(this.maybeWait=Hse(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await ul(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await ul(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await ul(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await ul(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await ul(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):kv(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await ul(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await ul(e),await this.trainEnd(e))}}function pz(n,e){return n==null&&(n={}),n instanceof hd?[n]:Array.isArray(n)&&n[0]instanceof hd?n:Mt(n).map(r=>new fz(r,e))}class zs{constructor(){}static registerCallbackConstructor(e,t){B(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),zs.checkForDuplicate(t),zs.constructors[e]==null&&(zs.constructors[e]=[]),zs.constructors[e].push(t)}static checkForDuplicate(e){for(const t in zs.constructors)zs.constructors[+t].forEach(s=>{if(s===e)throw new ne("Duplicate callback constructor.")})}static clear(){zs.constructors={}}static createCallbacks(e){const t=[];for(const r in zs.constructors){const s=+r;e>=s&&t.push(...zs.constructors[s])}return t.map(r=>new r)}}zs.constructors={};function mz(n,e,t,r,s,i,o,a,l){const u=new dz,h=[new Xie,...zs.createCallbacks(e)];n!=null&&h.push(...n),h.push(u);const d=new hz(h);return d.setParams({epochs:t,initialEpoch:r,samples:s,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gi(n,e={},t=!1){return by(n,Us.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bv(n,e){return ae(()=>{n.dtype!=="float32"&&(n=Re(n,"float32"));const t=ze(Sy(n),e,!0),r=Ac(t.shape,Ln()),s=Zn(zo(t,r));return je(n,s)})}function Lc(n,e){return ae(()=>un(Sy(Le(e,n)),-1))}function F1(n,e){return ae(()=>un(En(Le(e,n)),-1))}function kf(n,e){return ae(()=>{const t=Le(n,e),r=is(En(n),Ln(),Number.MAX_VALUE),s=En(je(t,r));return J(100,un(s,-1))})}function Qie(n,e){return ae(()=>{const t=is(e,Ln(),Number.MAX_VALUE),r=ks(be(1,t)),s=is(n,Ln(),Number.MAX_VALUE),i=ks(be(1,s));return un(Sy(Le(r,i)),-1)})}function Yie(n,e){return ae(()=>{const t=zo(0,Le(1,J(n,e)));return un(Sy(t),-1)})}function Jie(n,e){return ae(()=>{const t=zo(0,Le(1,J(n,e)));return un(t,-1)})}function Zie(n,e){return ae(()=>{const t=ze(J(n,e),-1),r=Ks(J(Le(1,n),e),-1);return zo(0,be(1,Le(r,t)))})}function eoe(n,e){return ae(()=>{const t=Math.log(2),r=Le(e,n),s=Le(be(r,Dc(J(-2,r))),t);return un(s,-1)})}function _m(n,e,t=!1){return ae(()=>{if(t)e=my(e);else{const r=ze(e,e.shape.length-1,!0);e=je(e,r)}return e=is(e,Ln(),1-Ln()),Qt(ze(J(Re(n,"float32"),ks(e)),e.shape.length-1))})}function Uv(n,e,t=!1){return ae(()=>{const r=Re(Tf(sie(n)),"int32");e=is(e,Ln(),1-Ln());const s=e.shape,i=ee(od(r,s[s.length-1]),s);return _m(i,e,t)})}function toe(n,e){if(!mt(n.shape,e.shape))throw new ne(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ae(()=>{const t=Zi(e),r=Qt(En(e));return be(Le(t,J(e,n)),oy(os(r)))})}function L1(n,e){return ae(()=>{let t;return t=is(e,Ln(),1-Ln()),t=ks(je(t,Le(1,t))),un(toe(n,t),-1)})}function noe(n,e){return ae(()=>{const t=is(n,Ln(),1),r=is(e,Ln(),1);return ze(J(n,ks(je(t,r))),-1)})}function roe(n,e){return ae(()=>{const t=ks(be(Ln(),e));return un(Le(e,J(n,t)),-1)})}function Kk(n,e){return ae(()=>{const t=Bv(n,-1),r=Bv(e,-1),s=J(t,r);return Qt(ze(s,-1))})}const Wv={meanSquaredError:Lc,meanAbsoluteError:F1,meanAbsolutePercentageError:kf,meanSquaredLogarithmicError:Qie,squaredHinge:Yie,hinge:Jie,categoricalHinge:Zie,logcosh:eoe,categoricalCrossentropy:_m,sparseCategoricalCrossentropy:Uv,binaryCrossentropy:L1,kullbackLeiblerDivergence:noe,poisson:roe,cosineProximity:Kk};function ZS(n){if(typeof n=="string"){if(n in Wv)return Wv[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ne(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xk(n,e){return ae(()=>{const t=J(.5,Ns(e)),r=$o(qr(e,t),n.dtype);return un(Es(n,r),-1)})}function Qk(n,e){return ae(()=>$o(Es(cc(n,-1),cc(e,-1)),"float32"))}function gz(n,e){return ae(()=>Re(ze(pi(Es(n,1),Es(e,1))),"float32"))}function soe(n,e){return ae(()=>Re(ze(pi(Es(n,1),Es(e,0))),"float32"))}function ioe(n,e){return ae(()=>Re(ze(pi(Es(n,0),Es(e,1))),"float32"))}function yz(n,e){return ae(()=>{const t=gz(n,e),r=ioe(n,e),s=be(t,r);return Re(Qn(qr(s,0),je(t,s),0),"float32")})}function ooe(n,e){return ae(()=>{const t=gz(n,e),r=soe(n,e),s=be(t,r);return Re(Qn(qr(s,0),je(t,s),0),"float32")})}function wz(n,e){return L1(n,e)}function vz(n,e){return n.rank===e.rank&&(n=nu(n,[n.rank-1])),e=cc(e,-1),e.dtype!==n.dtype&&(e=Re(e,n.dtype)),Re(Es(n,e),"float32")}function aoe(n,e){return ae(()=>{const t=n.sub(e).square().sum(),r=n.sub(n.mean()).square().sum();return Xe(1).sub(t.div(r))})}const loe=Lc,uoe=Lc,coe=F1,hoe=F1,doe=kf,foe=kf,Yk=_m,poe=Kk,xz=Uv,jv={binaryAccuracy:Xk,categoricalAccuracy:Qk,precision:yz,categoricalCrossentropy:Yk,sparseCategoricalCrossentropy:xz,mse:loe,MSE:uoe,mae:coe,MAE:hoe,mape:doe,MAPE:foe,cosine:poe};function moe(n){if(typeof n=="string"&&n in jv)return jv[n];if(typeof n!="string"&&n!=null)return n;throw new ne(`Unknown metric ${n}`)}function cw(n){if(go(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Wv))if(Wv[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(jv))if(jv[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function goe(n){const e={Adagrad:()=>Vu.adagrad(.01),Adadelta:()=>Vu.adadelta(1,.95,Ln()),Adam:()=>Vu.adam(.001,.9,.999,Ln()),Adamax:()=>Vu.adamax(.002,.9,.999,Ln(),0),RMSProp:()=>Vu.rmsprop(.001,.9,0,Ln()),SGD:()=>Vu.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new ne(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iO=1*1024*1024;function oO(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!l_(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>iO&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${iO}.`)}}function l_(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!l_(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!l_(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yoe(n,e,t,r=console.log){const s=voe(n),i=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(h=>Math.floor(e*h)));let o;if(!s){i.push("Receives inputs"),o=[];for(const h in n.nodesByDepth)o.push(...n.nodesByDepth[h])}r("_".repeat(e)),Gv(i,t,r),r("=".repeat(e));const a=n.layers;for(let h=0;h<a.length;++h)s?xoe(a[h],t,r):boe(a[h],t,o,r),r((h===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=woe(n),u=Mv(n.nonTrainableWeights);r(`Total params: ${l+u}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${u}`),r("_".repeat(e))}function woe(n){let e;return n.collectedTrainableWeights!=null?e=Mv(n.collectedTrainableWeights):e=Mv(n.trainableWeights),e}function voe(n){let e=!0;const t=[],r=[];for(const s in n.nodesByDepth)t.push(n.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of n.layers){let i=!1;for(const o of s.inboundNodes)if(r.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function Gv(n,e,t=console.log){let r="";for(let s=0;s<n.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=n[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function xoe(n,e,t){let r,s;try{s=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,s,r,n.countParams().toString()];Gv(a,e,t)}function boe(n,e,t,r){let s,i;try{i=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=[];for(const d of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(d)===-1))for(let p=0;p<d.inboundLayers.length;++p){const m=d.inboundLayers[p].name,y=d.nodeIndices[p],v=d.tensorIndices[p];o.push(`${m}[${y}][${v}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],h=[`${a} (${l})`,i,s,n.countParams().toString(),u];Gv(h,e,r);for(let d=1;d<o.length;++d)Gv(["","","","",o[d]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bz(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Cm(n,e){if(n===null)return null;if(typeof n=="string")return Uu(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];bz(e,s,i)?t.push(i):t.push(Cm(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const i=Uu(r);t[i]=Cm(s,i)}}return t}}function u_(n,e){if(n==null)return null;if(typeof n=="string")return ra(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];bz(e,s,i)?t.push(i):t.push(u_(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r],i=ra(r);(r==="name"||r==="className")&&typeof s=="string"?t[i]=s:t[i]=u_(s,r)}return t}}/** @license See the LICENSE file. */const M1="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ioe=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Mi extends pt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const S=this.getClassName().toLowerCase();this.name=C1(S)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],El(this.inputs).length!==this.inputs.length)throw new ne(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(S=>S.name)}`);El(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(S=>S.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const S of this.outputs){const C=S.sourceLayer,T=S.nodeIndex,O=S.tensorIndex;this.outputLayers.push(C),this.outputLayersNodeIndices.push(T),this.outputLayersTensorIndices.push(O)}for(const S of this.inputs){const C=S.sourceLayer,T=S.nodeIndex,O=S.tensorIndex;go(T===0,"input layer has >1 nodes"),go(O===0,"input layer has >1 tensors"),this.inputLayers.push(C),this.inputLayersNodeIndices.push(T),this.inputLayersTensorIndices.push(O)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let S=0;S<this.inputLayers.length;S++){const C=this.inputLayers[S];if(!(C instanceof Ef))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${S} (0-based) originates from layer type ${C.getClassName()}.`);this.inputNames.push(C.name),this.feedInputShapes.push(C.batchInputShape),this.feedInputNames.push(C.name)}for(const S of this.outputLayers)this.outputNames.push(S.name);this.internalInputShapes=this.inputs.map(S=>S.shape),this.internalOutputShapes=this.outputs.map(S=>S.shape);const t={},r={},s={},i={},o={},a=[],l=(S,C,T,O,V,k)=>{(O==null||V==null||k==null)&&(O=S.sourceLayer,V=S.nodeIndex,k=S.tensorIndex);const $=O.inboundNodes[V];if(T.indexOf($)!==-1)throw new fi(`The tensor ${S.name} at layer "${O.name}" is part of a cycle.`);if(C.indexOf($)!==-1)return;this.containerNodes.add(Mi.nodeKey(O,V)),O.id in o||(o[O.id]=Object.keys(o).length),T.indexOf($)===-1&&T.push($);const N=$.inboundLayers.length;for(let R=0;R<N;R++){const E=$.inputTensors[R],L=$.inboundLayers[R],F=$.nodeIndices[R],G=$.tensorIndices[R];l(E,C,T,L,F,G)}for(C.push($);T.indexOf($)>=0;)T.splice(T.indexOf($),1);a.push($)},u=[],h=[];for(const S of this.outputs)l(S,u,h);const d=a.slice().reverse();for(const S of d){r[S.id]=S,S.id in t||(t[S.id]=0);let C=t[S.id];const T=s[S.outboundLayer.id]==null?0:s[S.outboundLayer.id];C=Math.max(C,T),s[S.outboundLayer.id]=C,i[S.outboundLayer.id]=S.outboundLayer,t[S.id]=C;for(let O=0;O<S.inboundLayers.length;O++){const V=S.inboundLayers[O],k=S.nodeIndices[O],$=V.inboundNodes[k],N=t[$.id]==null?0:t[$.id];t[$.id]=Math.max(C+1,N),r[$.id]=$}}const p={};for(const S in t){const C=t[S];C in p||(p[C]=[]),p[C].push(r[S])}const m={};for(const S in s){const C=s[S];C in m||(m[C]=[]),m[C].push(i[S])}let y=Object.keys(m).map(S=>parseInt(S,10)).sort(aw);this.layers=[];for(const S of y){const C=m[S];C.sort((T,O)=>{const V=o[T.id],k=o[O.id];return V<k?-1:V>k?1:0});for(const T of C)T instanceof Mi&&this.internalContainerRefs.push(T),this.layers.push(T)}this.layersByDepth=m,y=Object.keys(p).map(S=>parseInt(S,10)).sort(aw);const v=this.inputs.slice(),w=[];for(const S of y)for(const C of p[S]){const T=C.outboundLayer;if(T!=null){for(const O of C.inputTensors)if(v.indexOf(O)===-1)throw new fi(`Graph disconnected: cannot obtain value for tensor ${O} at layer "${T.name}". The following previous layers were accessed without issue: ${w}`);for(const O of C.outputTensors)v.push(O);w.push(T.name)}}this.nodesByDepth=p;const b=this.layers.map(S=>S.name);for(const S of b){const C=b.filter(T=>T===S).length;if(C!==1)throw new fi(`The name "${S}" is used ${C} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new P1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(S=>null),outputMasks:this.outputs.map(S=>null),inputShapes:this.inputs.map(S=>S.shape),outputShapes:this.outputs.map(S=>S.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ne("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;const i=Ioe(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const h=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(r[h]!=null)throw new ne(`Duplicate weight name: ${h}`);r[h]=u,s++}const o=[];for(const a in e){let l=a;if(r[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(r[l]!=null)o.push([r[l],e[a]]);else if(t)throw new ne(`Provided weight data has no target variable: ${a}`);delete r[l]}if(t){const a=[];for(const l in r)a.push(l);if(a.length>0)throw new ne(`${a.length} of ${s} weights are not set: ${a}`)}Uk(o)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),s=["vars","layer_checkpoint_dependencies"],i=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!s.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${M1}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=u_(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return ae(()=>{e=Mt(e);const r=new yl;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return Gp(this.outputs,r,t)})}computeMask(e,t){return ae(()=>{e=Mt(e);let r;return t==null?r=gc(null,e.length):r=Mt(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=Lv(e);if(t.length!==this.inputLayers.length)throw new ne(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],h=l.name+"_0_0";r[h]=u}const s=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(aw);if(s.length>1)for(const a of s){const l=this.nodesByDepth[a];for(const u of l){const h=u.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(h.id)!==-1)continue;const d=[];for(let v=0;v<u.inboundLayers.length;v++){const w=u.inboundLayers[v],b=u.nodeIndices[v],S=u.tensorIndices[v],C=`${w.name}_${b}_${S}`,T=r[C];d.push(T)}const p=h.computeOutputShape(es(d)),m=Lv(p),y=h.inboundNodes.indexOf(u);for(let v=0;v<m.length;v++){const w=`${h.name}_${y}_${v}`;r[w]=m[v]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],d=`${l.name}_${u}_${h}`;o.push(d)}for(let a=0;a<o.length;a++){const l=o[a];go(l in r),i.push(r[l])}return es(i)}runInternalGraph(e,t){t==null&&(t=gc(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],h=e[l],d=t[l];r[u.id]=[h,d]}const s=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(aw);for(const l of s){const u=this.nodesByDepth[l];for(const h of u){const d=h.outboundLayer,p=h.inputTensors,m=h.outputTensors,y=new Array;for(const v of p)v.id in r&&y.push(r[v.id]);if(y.length===p.length){let v={},w,b,S,C;if(h.callArgs!=null&&(v=h.callArgs),y.length===1){const[T,O]=y[0];v.mask==null&&(v.mask=O),S=Mt(d.call(T,v)),C=Mt(d.computeMask(T,O)),w=[T],b=[O]}else w=y.map(T=>T[0]),b=y.map(T=>T[1]),v.mask==null&&(v.mask=b),S=Mt(d.call(w,v)),C=Mt(d.computeMask(w,b));if(d.activityRegularizer)throw new ct("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let T=0;T<m.length;++T){const O=m[T],V=S[T],k=C[T];r[O.id]=[V,k]}}}}const i=[],o=[],a=[];for(const l of this.outputs){go(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[u,h]=r[l.id];a.push(u.shape),i.push(u),o.push(h)}return[i,o,a]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof Mi?1:0;for(let i=0;i<s.inboundNodes.length;i++){const o=Mi.nodeKey(s,i);this.containerNodes.has(o)&&(t[o]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new ne("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new ne(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new ne(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ae(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=Mi.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let d=0;d<o.inboundNodes.length;d++){const p=o.inboundNodes[d],m=Mi.nodeKey(o,d);let y={};if(this.containerNodes.has(m)){if(p.callArgs)try{JSON.stringify(p.callArgs),y=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),y={}}if(p.inboundLayers.length>0){const v=[];for(let w=0;w<p.inboundLayers.length;w++){const b=p.inboundLayers[w],S=p.nodeIndices[w],C=p.tensorIndices[w],T=Mi.nodeKey(b,S);let O=t[T];O==null&&(O=0),v.push([b.name,O,C,y])}u.push(v)}}}const h={};h.name=o.name,h.className=a,h.config=l,h.inboundNodes=u,r.push(h)}e.layers=r;const s=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Mi.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=t[u];h==null&&(h=0);const d=this.inputLayersTensorIndices[o];s.push([a.name,h,d])}e.inputLayers=s;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Mi.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=t[u];h==null&&(h=0);const d=this.outputLayersTensorIndices[o];i.push([a.name,h,d])}return e.outputLayers=i,e}static fromConfig(e,t,r={},s=!1){const i={},o={};function a(w,b){w.name in o?o[w.name].push(b):o[w.name]=[b]}function l(w,b){const S=[];let C;for(const T of b){const O=T[0],V=T[1],k=T[2];if(C=T[3]==null?{}:T[3],!(O in i)){a(w,b);return}const $=i[O];if($.inboundNodes.length<=V){a(w,b);return}const N=$.inboundNodes[V];S.push(N.outputTensors[k])}S.length>0&&w.apply(es(S),C)}function u(w){const b=w.name,S=Gi(w,t.customObjects!=null?t.customObjects:{});S.setFastWeightInitDuringBuild(s),i[b]=S,w.inboundNodes.forEach(T=>{if(!(T instanceof Array))throw new ne(`Corrupted configuration, expected array for nodeData: ${T}`);a(S,T)})}const h=t.name,d=t.layers;for(const w of d)u(w);for(;!Gse(o);)for(const w of d){const b=i[w.name];if(b.name in o){const S=o[b.name];delete o[b.name];for(const C of S)l(b,C)}}const p=[],m=[],y=t.inputLayers;for(const w of y){const b=w[0],S=w[1],C=w[2];go(b in i);const O=i[b].inboundNodes[S].outputTensors;p.push(O[C])}const v=t.outputLayers;for(const w of v){const b=w[0],S=w[1],C=w[2];go(b in i);const O=i[b].inboundNodes[S].outputTensors;m.push(O[C])}return new e({inputs:p,outputs:m,name:h})}get stateful(){if(this._stateful)throw new ne("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ae(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Soe(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const s=[];return e.forEach(i=>{i in n?s.push(n[i]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function Iz(n,e){return Soe(n,e,"classWeight")}async function Sz(n,e,t,r){if(t!=null){const s=ae(()=>{if(n.shape.length===1)return ko(n);if(n.shape.length===2){if(n.shape[1]>1)return cc(n,1);if(n.shape[1]===1)return ee(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await s.data());ot(s);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),mr(o,"float32")}else return null}function Toe(n,e){return J(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _oe=32;function Tz(n,e){let t,r;const s=e;t=s.xs,r=s.ys,B(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=aO("input",n.inputNames,t),o=aO("output",n.outputNames,r),a=i[0].shape[0];B(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),B(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)B(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)B(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function aO(n,e,t){if(t instanceof Et)return[t];if(Array.isArray(t))return B(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new ne(`The feature data generated by the dataset lacks the required ${n} key '${s}'.`);r.push(t[s])}return r}}function Coe(n){if(n.length===3)throw new ct("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function Eoe(n,e,t){const r=t.batchesPerEpoch!=null;if(B(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),B(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),B(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),B(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),B(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const s=t.validationData!=null;let i,o;if(s)if(lO(t.validationData))B(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const w=Coe(t.validationData);i=w.xs,o=w.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;s?u=l.slice().concat(l.map(w=>"val_"+w)):u=l.slice();const h=pz(t.callbacks,t.yieldEvery),d=t.verbose==null?1:t.verbose,{callbackList:p,history:m}=mz(h,d,t.epochs,null,null,koe(e,t),null,s,u);p.setModel(n),n.history=m,await p.onTrainBegin(),n.stopTraining_=!1;let y=t.initialEpoch==null?0:t.initialEpoch,v=await e.iterator();for(;y<t.epochs;){const w={};await p.onEpochBegin(y);let b=0,S=0;for(r||(v=await e.iterator());!r||b<t.batchesPerEpoch;){const C=await v.next();if(r&&C.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(C.value!=null){const{xs:T,ys:O}=Tz(n,C.value),V={};V.batch=S,V.size=T[0].shape[0],await p.onBatchBegin(S,V);const k=[];if(t.classWeight!=null){const R=Iz(t.classWeight,n.outputNames);for(let E=0;E<R.length;++E)k.push(await Sz(O[E],null,R[E]))}const $=T.concat(O).concat(k),N=a($);ot($);for(let R=0;R<l.length;++R){const E=l[R],L=N[R];V[E]=L,Fn(L)}await p.onBatchEnd(S,V),cz(V),S++,b++}if(r?b>=t.batchesPerEpoch:C.done){if(s){let T;lO(t.validationData)?T=Mt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):T=Mt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?_oe:t.validationBatchSize,verbose:0}));for(let O=0;O<n.metricsNames.length;++O)w[`val_${n.metricsNames[O]}`]=T[O]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(y,w),y++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function koe(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function lO(n){return typeof n.iterator=="function"}function Noe(n){return typeof n.next=="function"}async function $oe(n,e,t){t=t||{};const r=t.batches!=null,s=n.testFunction;let i=[];if(t.verbose>0)throw new ct("Verbose mode is not implemented yet.");B(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=Noe(e)?e:await e.iterator();let a=0,l=0;for(;!r||l<t.batches;){const u=await o.next();if(i=ae(()=>{if(u.value){const{xs:h,ys:d}=Tz(n,u.value),p=h.concat(d),m=ae(()=>s(p));if(ot(p),l===0)for(let v=0;v<m.length;++v)i.push(Xe(0));const y=p[0].shape[0];for(let v=0;v<m.length;++v){const w=m[v],b=i[v];i[v]=ae(()=>be(i[v],J(y,w))),l>0&&ot(b)}ot(m),a+=y,++l}return i}),u.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const h=i[u];i[u]=je(i[u],a),ot(h)}return es(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eT(n){B(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Ap(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>tc(r,e,t-e)):tc(n,e,t-e)}function c_(n,e){return ae(()=>n==null?null:Array.isArray(n)?n.map(t=>c_(t,e)):iz(n,e.dtype==="int32"?e:Re(e,"int32")))}function tT(n,e){const t=[];let r=0,s=null;for(;r<n;)s=r+e,s>=n&&(s=n),t.push([r,s]),r=s;return t}function _z(n){const e=[];n instanceof Et&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(Iy(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function Pi(n,e){if(n==null)return;const t=[];if(e instanceof Et)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const i=e[s];t.push(i.id)}const r=[];if(n instanceof Et)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(n!=null)for(const s in n){const i=n[s];t.indexOf(i.id)===-1&&r.push(i)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Roe(n){return n instanceof Et}function h_(n){return Array.isArray(n)}function uO(n){return!Roe(n)&&!h_(n)}function cO(n,e,t,r=!0,s=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(h_(n)&&n.length>0)o=!0;else if(uO(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ne(`Error when checking model ${s} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(uO(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new ne(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(h_(n)){if(n=n,n.length!==e.length)throw new ne(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new ne(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=_z(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ne(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!r)continue;const u=a.shape[l],h=t[o][l];if(h!=null&&h>=0&&u!==h)throw new ne(`${s} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${s} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function Aoe(n,e,t){const r=El(n.map(i=>i.shape[0]));r.sort();const s=El(e.map(i=>i.shape[0]));if(s.sort(),r.length>1)throw new ne(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(s.length>1)throw new ne(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(r.length>0&&s.length>0&&!mt(r,s))throw new ne(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function Doe(n,e,t){const r=[Lc,L1,_m];for(let s=0;s<n.length;++s){const i=n[s],o=e[s],a=t[s];if(o!=null){if(o===_m&&i.shape[i.shape.length-1]===1)throw new ne(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let h=0;h<l.length;++h){const d=l[h],p=u[h];if(p!=null&&d!==p)throw new ne(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function hO(n,e,t,r=!0,s=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new ne(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new ne(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ne(`Error when checking ${s}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!r)continue;const u=a.shape[l],h=t[o][l];if(h!=null&&h!==u)throw new ne(`Error when checking ${s}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Ooe(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let i=t.hasOwnProperty(s)?t[s]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}const Poe="layers-model";class pa extends Mi{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new ne("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");yoe(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=goe(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof La))throw new ne("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new ne(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(ZS(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ne(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>ZS(a))}else{const o=ZS(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ec("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const s=Ooe(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};ec("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=s[o];(u=>{const h="";let d,p,m;for(const y of u){if(typeof y=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(y)!==-1){const w=this.internalOutputShapes[o];w[w.length-1]===1||this.lossFunctions[o]===L1?["accuracy","acc"].indexOf(y)!==-1?p=Xk:["crossentropy","ce"].indexOf(y)!==-1&&(p=wz):this.lossFunctions[o]===Uv?["accuracy","acc"].indexOf(y)!==-1?p=vz:["crossentropy","ce"].indexOf(y)!==-1&&(p=xz):["accuracy","acc"].indexOf(y)!==-1?p=Qk:["crossentropy","ce"].indexOf(y)!==-1&&(p=Yk);let b;["accuracy","acc"].indexOf(y)!==-1?b="acc":["crossentropy","ce"].indexOf(y)!==-1&&(b="ce"),m=p,d=h+b}else m=moe(y),d=h+cw(y);let v;ec(d,()=>{v=m}),i(o,d,v)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;eT(s);const o=this.standardizeUserDataXY(e,t,!0,s);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,s,r.verbose,r.steps);return es(u)}finally{Pi(o[0],e),Pi(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),$oe(this,e,t)}checkNumSamples(e,t,r,s="steps"){let i;if(r!=null){if(i=null,t!=null)throw new ne(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new ne(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new ne("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],i=this.retrieveSymbolicTensors(s),o=new yl;if(e instanceof Et&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ne(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new ne(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Gp(i,o);return r?a:a[0]}retrieveSymbolicTensors(e){const t=gc(null,e.length);let r=e.length;for(const s of this.layers){const i=Array.isArray(s.output)?s.output:[s.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((i,o)=>{i==null&&s.push(e[o])}),new ne(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return ae(()=>{const s=this.checkNumSamples(e);if(r)throw new ct("Verbose predictLoop() is not implemented yet.");const i=tT(s,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)ae(()=>{const u=i[a][0],h=i[a][1],d=Ap(e,u,h),p=[];if(Array.isArray(d))for(let y=0;y<d.length;++y)p.push({key:this.inputs[y],value:d[y]});else p.push({key:this.inputs[0],value:d});const m=new yl(p);return Gp(this.outputs,m)}).forEach((u,h)=>o[h].push(u));return es(o.map(a=>vn(a,0)))})}predict(e,t={}){const r=_z(e);hO(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return eT(s),this.predictLoop(r,s)}finally{Pi(r,e)}}predictOnBatch(e){hO(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new fi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Uv?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=cO(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=cO(t,this.feedOutputNames,i,!1,"target"),Aoe(e,t),Doe(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new ne(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(r!=null)throw new Error("sample weight is not supported yet.");let u=null;if(s!=null){const h=Iz(s,this.outputNames);u=[];for(let d=0;d<h.length;++d)u.push(await Sz(l[d],null,h[d]))}return[a,l,u]}testLoop(e,t,r,s=0,i){return ae(()=>{const o=this.checkNumSamples(t,r,i,"steps"),a=[];if(s>0)throw new ct("Verbose mode is not implemented yet.");if(i!=null)throw new ct("steps mode in testLoop() is not implemented yet");{const l=tT(o,r),u=mr(Ki(0,o));for(let h=0;h<l.length;++h){const d=l[h][0],p=l[h][1],m=tc(u,d,p-d),y=c_(t,m),v=e(y);if(h===0)for(let w=0;w<v.length;++w)a.push(Xe(0));for(let w=0;w<v.length;++w){const b=v[w];a[w]=be(a[w],J(p-d,b))}}for(let h=0;h<a.length;++h)a[h]=je(a[h],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let i=s;if(XD(e,s)>1){const o=XD(e.slice(0,r),s);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const d=[];for(let v=0;v<this.inputs.length;++v)d.push({key:this.inputs[v],value:r[v]});const p=new yl(d),m=Gp(this.outputs,p,{training:!0});let y;for(let v=0;v<this.lossFunctions.length;++v){const w=this.lossFunctions[v];let b=w(s[v],m[v]);i[v]!=null&&(b=Toe(b,i[v]));const S=un(b);t.push(S),v===0?y=b:y=be(y,b)}for(let v=0;v<this.metricsTensors.length;++v){let w;if(this.outputs.length>1&&v<this.outputs.length)w=t[v];else{const b=this.metricsTensors[v][0],S=this.metricsTensors[v][1];w=un(b(s[S],m[S]))}Fn(w),o.push(w)}return y=un(y),this.calculateLosses().forEach(v=>{y=be(y,v)}),y},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>ae(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:s[u]});const a=new yl(o),l=Gp(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const h=this.lossFunctions[u],d=un(h(i[u],l[u]));u===0?r=d:r=be(r,d),t.push(r)}for(let u=0;u<this.metricsTensors.length;++u){const h=this.metricsTensors[u][0],d=this.metricsTensors[u][1],p=un(h(i[d],l[d]));t.push(p)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,i,o,a,l,u,h,d,p;try{const m=r.batchSize==null?32:r.batchSize;eT(m);const v=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,m);s=v[0],i=v[1],p=v[2];let w=!1,b;if(r.validationData!=null&&r.validationData.length>0){if(w=!0,r.validationData.length===2)l=r.validationData[0],u=r.validationData[1];else throw r.validationData.length===3?new ct("validationData including sample weights is not supported yet."):new ne(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const R=await this.standardizeUserData(l,u,null,null,!0,m);h=R[0],d=R[1],b=h.concat(d)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){w=!0;const N=Math.floor(s[0].shape[0]*(1-r.validationSplit)),R=s[0].shape[0];h=Ap(s,N,R),o=s,s=Ap(s,0,N),d=Ap(i,N,R),a=i,i=Ap(i,0,N),b=h.concat(d)}else r.validationSteps!=null&&(w=!0);const S=s.concat(i).concat(p);this.checkTrainableWeightsConsistency();const C=this.makeTrainFunction(),T=this.getDedupedMetricsNames();let O,V;w?(this.makeTestFunction(),O=this.testFunction,V=T.slice().concat(T.map(N=>"val_"+N))):(O=null,b=[],V=T.slice());const k=pz(r.callbacks,r.yieldEvery);return await this.fitLoop(C,S,T,m,r.epochs,r.verbose,k,O,b,r.shuffle,V,r.initialEpoch,null,null)}finally{this.isTraining=!1,Pi(s,e),Pi(i,t),Pi(o,e),Pi(a,t),Pi(h,l),Pi(d,u),p!=null&&ot(p)}}async fitLoop(e,t,r,s,i,o,a,l,u,h,d,p,m,y){s==null&&(s=32),i==null&&(i=1),h==null&&(h=!0),p==null&&(p=0);let v=!1;if(l!=null&&u!=null&&(v=!0),y!=null&&(v=!0,m==null))throw new ne("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const w=this.checkNumSamples(t,s,m,"steps_per_epoch");let b;w!=null&&(b=Ki(0,w)),o==null&&(o=1);const{callbackList:S,history:C}=mz(a,o,i,p,w,m,s,v,d);S.setModel(this),this.history=C,await S.onTrainBegin(),this.stopTraining_=!1;for(let T=p;T<i;++T){await S.onEpochBegin(T);const O={};if(m!=null)throw new ct("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new ct("batch shuffling is not implemneted yet");h&&kC(b);const V=mr(b),k=tT(w,s);for(let $=0;$<k.length;++$){const N={};if(await S.onBatchBegin($,N),ae(()=>{const R=k[$][0],E=k[$][1],L=tc(V,R,E-R);N.batch=$,N.size=E-R;const F=c_(t,L),G=e(F);for(let Y=0;Y<r.length;++Y){const q=r[Y],se=G[Y];N[q]=se,Fn(se)}if($===k.length-1&&v){const Y=this.testLoop(l,u,s);for(let q=0;q<r.length;++q){const se=r[q],X=Y[q];Fn(X),O["val_"+se]=X}}}),await S.onBatchEnd($,N),cz(N),this.stopTraining_)break}V.dispose()}if(await S.onEpochEnd(T,O),this.stopTraining_)break}return await S.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return Eoe(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],i=r[1],a=this.makeTrainFunction()(s.concat(i)),l=[];for(const u of a){const h=await u.data();l.push(h[0])}return ot(a),Pi(r[0],e),Pi(r[1],t),es(l)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,i=this.getWeights(r);for(let o=0;o<s.length;++o)r&&!s[o].trainable||t.push({name:s[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=GT().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-GT().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ra(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>ra(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=ra(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ra(cw(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ra(cw(e)));{const e={};for(const t in this.metrics)e[t]=ra(cw(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Cm(e.optimizer_config),r=Gi(t);let s;if(typeof e.loss=="string")s=Uu(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(o=>Uu(o));else if(e.loss!=null){s={};for(const o in e.loss)s[o]=Uu(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Uu(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Uu(e.metrics[o])}this.compile({loss:s,metrics:i,optimizer:r})}async save(e,t){if(typeof e=="string"){const u=jM(e);if(u.length===0)throw new ne(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new ne(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new ne("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await HT(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:Poe,generatedBy:`TensorFlow.js tfjs-layers v${M1}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:h,specs:d}=await HT(await this.optimizer.getWeights(),u);r.specs.push(...d),r.data=UM([r.data,h])}return this.userDefinedMetadata!=null&&(oO(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){oO(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}pa.className="Model";Ie(pa);class Cz extends pa{}Cz.className="Functional";Ie(Cz);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Foe(n,e){"modelTopology"in n||(n={modelTopology:n}),n=n;let t=n.modelTopology;t.model_config!=null&&(t=t.model_config);const r=Cm(t),s=Gi(r,e);if(n.weightsManifest!=null){const i=await i3(n.weightsManifest,n.pathPrefix,s.weights.map(a=>a.originalName)),o={};for(const a of s.weights)o[a.originalName]=i[a.originalName];s.loadWeights(o),ot(i)}return s}async function Loe(n,e){if(e==null&&(e={}),typeof n=="string"){const t=GM(n,e);if(t.length===0)t.push(l3(n,e));else if(t.length>1)throw new ne(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return Moe(n,void 0,e)}async function Moe(n,e,t){if(t==null&&(t={}),n.load==null)throw new ne("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await n.load();let s=r.modelTopology;s.model_config!=null&&(s=s.model_config);const i=t.strict==null?!0:t.strict,o=r.weightData!=null&&r.weightSpecs!=null&&i,a=Gi(Cm(s),e,o),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new ne("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:h}=Voe(r.weightData,r.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&h.length>0&&await a.optimizer.setWeights(h),ot(u),ot(h.map(d=>d.tensor))}return a}function Voe(n,e){const t=zC(n,e),r={},s=[];return e.forEach(i=>{i.group==="optimizer"?s.push({name:i.name,tensor:t[i.name]}):r[i.name]=t[i.name]}),{modelWeights:r,optimizerWeights:s}}class yc extends pa{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:C1("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new ne(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof yc||e instanceof pa;let r;if(t){if(r=e,r.outputs.length!==1)throw new ne("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new ne("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new ne("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=uz({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new ne(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new ne("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=lz(this.outputs[0])}this.inboundNodes=[],new P1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:gc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(At(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new pa({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new ne("Legacy serialization format not supported yet.");i=t}else B(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof yc))throw new ct(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const h=Gi(l,void 0,s);s&&h.setFastWeightInitDuringBuild(!0),a.add(h)}return a}set stopTraining(e){if(this.model==null)throw new ne("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new ne("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}yc.className="Sequential";Ie(yc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zoe(n){return new pa(n)}function Boe(n){return new yc(n)}function Ez(n){return uz(n)}function Uoe(n,e){zs.registerCallbackConstructor(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Nr=class extends Pc{getConfig(){return{}}};class kz extends Nr{apply(e,t=1){return oie(e,t)}}kz.className="elu";Ie(kz);class Nz extends Nr{apply(e){return t1(e)}}Nz.className="selu";Ie(Nz);class $z extends Nr{apply(e){return Zi(e)}}$z.className="relu";Ie($z);class Rz extends Nr{apply(e){return ae(()=>zl(6,Zi(e)))}}Rz.className="relu6";Ie(Rz);class Az extends Nr{apply(e){return e}}Az.className="linear";Ie(Az);class Dz extends Nr{apply(e){return ji(e)}}Dz.className="sigmoid";Ie(Dz);class Oz extends Nr{apply(e){return lie(e)}}Oz.className="hardSigmoid";Ie(Oz);class Pz extends Nr{apply(e){return Dc(e)}}Pz.className="softplus";Ie(Pz);class Fz extends Nr{apply(e){return aie(e)}}Fz.className="softsign";Ie(Fz);class Lz extends Nr{apply(e){return Vl(e)}}Lz.className="tanh";Ie(Lz);let Jk=class extends Nr{apply(e,t=-1){return my(e,t)}};Jk.className="softmax";Ie(Jk);class Mz extends Nr{apply(e,t=-1){return Kb(e,t)}}Mz.className="logSoftmax";Ie(Mz);class Vz extends Nr{apply(e){return ae(()=>ae(()=>{const t=Math.sqrt(2),r=J(.5,be(1,Gb(je(e,t))));return J(e,r)}))}}Vz.className="gelu";Ie(Vz);class zz extends Nr{apply(e){return ae(()=>J(.5,J(e,be(1,Vl(J(Zn(je(2,Math.PI)),be(e,J(.044715,Fo(e,3)))))))))}}zz.className="gelu_new";Ie(zz);class Bz extends Nr{apply(e){return ae(()=>J(e,Vl(Dc(e))))}}Bz.className="mish";Ie(Bz);class Uz extends Nr{apply(e,t=1){return ae(()=>J(ji(J(e,t)),e))}}Uz.className="swish";Ie(Uz);function Ul(n){return n.getClassName()}function nT(n,e={}){return by(n,Us.getMap().classNameMap,e,"activation")}function Wl(n){if(n==null){const e={};return e.className="linear",e.config={},nT(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},nT(e)}else return n instanceof Nr?n:nT(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zk(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class Wz extends Pc{}class Cy extends Wz{constructor(e){super(),Zk(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ae(()=>{let t=kn([1]);return this.hasL1&&(t=be(t,ze(J(this.l1,En(e))))),this.hasL2&&(t=be(t,ze(J(this.l2,Sy(e))))),ee(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Cy.className="L1L2";Ie(Cy);function Woe(n){return Zk(n),new Cy({l1:n!=null?n.l1:null,l2:0})}function joe(n){return Zk(n),new Cy({l2:n!=null?n.l2:null,l1:0})}const dO={l1l2:"L1L2"};function qt(n){return Ak(n)}function fO(n,e={}){return by(n,Us.getMap().classNameMap,e,"regularizer")}function rn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in dO?dO[n]:n,config:{}};return fO(t)}else return n instanceof Wz?n:fO(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class eN extends pt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=nt(e);let r=Zi(e);return this.maxValue!=null&&(r=is(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}eN.className="ReLU";Ie(eN);class tN extends pt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=nt(e);return iy(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}tN.className="LeakyReLU";Ie(tN);class nN extends pt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=nn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=rn(e.alphaRegularizer),this.alphaConstraint=Vn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ne(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=At(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new Nn({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=nt(e),dy(e,this.alpha.read())}getConfig(){const e={alphaInitializer:cn(this.alphaInitializer),alphaRegularizer:qt(this.alphaRegularizer),alphaConstraint:Mn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}nN.className="PReLU";Ie(nN);let rN=class extends pt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new ct(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=nt(e);return If(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};rN.className="ELU";Ie(rN);class sN extends pt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=nt(e);return J(r,Re(qr(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}sN.className="ThresholdedReLU";Ie(sN);class iN extends pt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Jk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ae(()=>{let r=nt(e);const s=t.mask;if(s!=null){const i=J(Le(ts(r.shape),Re(s,r.dtype)),Xe(-1e9));r=be(r,i)}return this.axis instanceof Array?this.axis.length>1?os(Le(r,ay(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}iN.className="Softmax";Ie(iN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hh(n,e,t){if(typeof n=="number")return gc(n,e);if(n.length!==e)throw new ne(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const s=n[r];if(!nie(s))throw new ne(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${s}`)}return n}function Hi(n,e,t,r,s=1){if(n==null)return n;const i=e+(e-1)*(s-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+r-1)/r)}function yo(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+Bl([t-e,0]);else if(r==="same")n=n*e;else throw new ne(`Unsupport padding mode: ${r}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oN(n,e){return ae(()=>(In(e),e==="channelsFirst"?yt(n,[0,2,3,1]):n))}function jz(n,e){return ae(()=>(In(e),e==="channelsFirst"?yt(n,[0,2,3,4,1]):n))}function Goe(n,e,t,r=1,s="valid",i,o=1){return ae(()=>{if(i==null&&(i=Xi()),In(i),n.shape.length!==3)throw new ne(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new ne(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new ne(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=yt(n,[0,2,1])),s==="causal")throw new ct("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Bb(n,e,r,s==="same"?"same":"valid","NWC",o);return t!=null&&(a=eo(a,t)),a})}function pO(n,e,t,r=[1,1],s="valid",i,o,a=null){return ae(()=>{if(i==null&&(i=Xi()),In(i),n.rank!==3&&n.rank!==4)throw new ne(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new ne(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=oN(n,i);if(s==="causal")throw new ct("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=GV({x:l,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=yt(l,[0,3,1,2])),l})}function Hoe(n,e,t,r=[1,1,1],s="valid",i,o){return ae(()=>{if(i==null&&(i=Xi()),In(i),n.rank!==4&&n.rank!==5)throw new ne(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new ne(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=jz(n,i);if(s==="causal")throw new ct("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=hE(a,e,r,s==="same"?"same":"valid","NDHWC",o),t!=null&&(a=eo(a,t)),i==="channelsFirst"&&(a=yt(a,[0,4,1,2,3])),a})}class V1 extends pt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",V1.verifyArgs(t),this.rank=e,qn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new ct(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Hh(t.kernelSize,e,"kernelSize"),this.strides=Hh(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ys(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,In(this.dataFormat),this.activation=Wl(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=nn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Vn(t.biasConstraint),this.biasRegularizer=rn(t.biasRegularizer),this.activityRegularizer=rn(t.activityRegularizer),this.dilationRate=Hh(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ne(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ne(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ne(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(go("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Dk(e.kernelSize,"number",1,3))throw new ne(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ul(this.activation),useBias:this.useBias,biasInitializer:cn(this.biasInitializer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),biasConstraint:Mn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Nf extends V1{constructor(e,t){super(e,t),this.kernel=null,Nf.verifyArgs(t),this.filters=t.filters,qn(this.filters,"filters"),this.kernelInitializer=nn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Vn(t.kernelConstraint),this.kernelRegularizer=rn(t.kernelRegularizer)}build(e){e=At(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ne(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return ae(()=>{e=nt(e);let r;const s=this.bias==null?null:this.bias.read(),i=Z3(this.activation.getClassName());if(i!=null&&this.rank===2)r=pO(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=Goe(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=pO(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=Hoe(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new ct("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=At(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<r.length;++i){const o=Hi(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:cn(this.kernelInitializer),kernelRegularizer:qt(this.kernelRegularizer),kernelConstraint:Mn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new ne(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class $f extends Nf{constructor(e){super(2,e),$f.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Dk(e.kernelSize,"number",1,2))throw new ne(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}$f.className="Conv2D";Ie($f);class Rf extends Nf{constructor(e){super(3,e),Rf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new ne(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Rf.className="Conv3D";Ie(Rf);class aN extends $f{constructor(e){if(super(e),this.inputSpec=[new Nn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ne(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=At(e),e.length!==4)throw new ne("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ne("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Nn({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return ae(()=>{let r=nt(e);if(r.shape.length!==4)throw new ne(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=s[o],u=s[a],h=this.kernelSize[0],d=this.kernelSize[1],p=this.strides[0],m=this.strides[1],y=yo(l,p,h,this.padding),v=yo(u,m,d,this.padding),w=[i,y,v,this.filters];this.dataFormat!=="channelsLast"&&(r=yt(r,[0,2,3,1]));let b=Ub(r,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=yt(b,[0,3,1,2])),this.bias!=null&&(b=eo(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=At(e);const t=e.slice();let r,s,i;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3):(r=3,s=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[r]=this.filters,t[s]=yo(t[s],l,o,this.padding),t[i]=yo(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}aN.className="Conv2DTranspose";Ie(aN);class lN extends Rf{constructor(e){if(super(e),this.inputSpec=[new Nn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ne(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=At(e),e.length!==5)throw new ne("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ne("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Nn({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return ae(()=>{let r=nt(e);if(r.shape.length!==5)throw new ne(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=s[l],h=s[o],d=s[a],p=this.kernelSize[0],m=this.kernelSize[1],y=this.kernelSize[2],v=this.strides[0],w=this.strides[1],b=this.strides[2],S=yo(u,v,p,this.padding),C=yo(h,w,m,this.padding),T=yo(d,b,y,this.padding),O=[i,S,C,T,this.filters];this.dataFormat!=="channelsLast"&&(r=yt(r,[0,2,3,4,1]));let V=dE(r,this.kernel.read(),O,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(V=yt(V,[0,4,1,2,3])),this.bias!==null&&(V=eo(V,this.bias.read(),this.dataFormat)),this.activation!==null&&(V=this.activation.apply(V)),V})}computeOutputShape(e){e=At(e);const t=e.slice();let r,s,i,o;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3,o=4):(r=4,s=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],h=this.strides[0],d=this.strides[1],p=this.strides[2];return t[r]=this.filters,t[s]=yo(t[s],h,a,this.padding),t[i]=yo(t[i],d,l,this.padding),t[o]=yo(t[o],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}lN.className="Conv3DTranspose";Ie(lN);class Gz extends Nf{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new ne("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new ne("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new ne(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=nn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=rn(t.depthwiseRegularizer),this.depthwiseConstraint=Vn(t.depthwiseConstraint),this.pointwiseInitializer=nn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=rn(t.pointwiseRegularizer),this.pointwiseConstraint=Vn(t.pointwiseConstraint)}build(e){if(e=At(e),e.length<this.rank+2)throw new ne(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new ne(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Nn({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return ae(()=>{e=nt(e);let r;if(this.rank===1)throw new ct("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=yt(e,[0,2,3,1])),r=n1(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=eo(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=yt(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=cn(this.depthwiseInitializer),e.pointwiseInitializer=cn(this.pointwiseInitializer),e.depthwiseRegularizer=qt(this.depthwiseRegularizer),e.pointwiseRegularizer=qt(this.pointwiseRegularizer),e.depthwiseConstraint=Mn(this.depthwiseConstraint),e.pointwiseConstraint=Mn(this.pointwiseConstraint),e}}Gz.className="SeparableConv";class uN extends Gz{constructor(e){super(2,e)}}uN.className="SeparableConv2D";Ie(uN);class Ey extends Nf{constructor(e){super(1,e),Ey.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Dk(e.kernelSize,"number",1,1))throw new ne(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Ey.className="Conv1D";Ie(Ey);class cN extends pt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ae(()=>{if(e=nt(e),this.dataFormat==="channelsLast"){const r=uw(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return uw(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=uw(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return uw(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}cN.className="Cropping2D";Ie(cN);class hN extends pt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Zse(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return ae(()=>{let r=nt(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=yt(r,[0,2,3,1]);const i=this.size[0]*s[2],o=this.size[1]*s[3],a=this.interpolation==="nearest"?di.resizeNearestNeighbor(r,[i,o]):di.resizeBilinear(r,[i,o]);return yt(a,[0,3,1,2])}else{const i=this.size[0]*s[1],o=this.size[1]*s[2];return this.interpolation==="nearest"?di.resizeNearestNeighbor(r,[i,o]):di.resizeBilinear(r,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}hN.className="UpSampling2D";Ie(hN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qoe(n,e,t=[1,1],r="valid",s,i){return ae(()=>{s==null&&(s=Xi()),In(s);let o=oN(n,s);if(n.rank!==4)throw new ne(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new ne(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=bf(o,e,t,r==="same"?"same":"valid","NHWC",i),s==="channelsFirst"&&(o=yt(o,[0,3,1,2])),o})}class dN extends V1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=nn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Vn(e.depthwiseConstraint),this.depthwiseRegularizer=rn(e.depthwiseRegularizer)}build(e){if(e=At(e),e.length<4)throw new ne(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new ne(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{e=nt(e);let r=qoe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=eo(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=At(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Hi(t,this.kernelSize[0],this.padding,this.strides[0]),o=Hi(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,i,o]:[e[0],i,o,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=cn(this.depthwiseInitializer),e.depthwiseRegularizer=qt(this.depthwiseRegularizer),e.depthwiseConstraint=Mn(this.depthwiseRegularizer),e}}dN.className="DepthwiseConv2D";Ie(dN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hz(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new ne("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function s(i){return i==null||Array.isArray(i)?i:[i]}return e=s(e),t=s(t),{inputs:n,initialState:e,constants:t}}function qz(n,e,t,r=!1,s,i,o=!1,a=!1){return ae(()=>{const l=e.shape.length;if(l<3)throw new ne(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Ki(2,l));e=yt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=Re(Re(s,"bool"),"float32"),s.rank===l-1&&(s=dr(s,-1)),s=yt(s,u)),r&&(e=Xs(e,0),s!=null&&(s=Xs(s,0)));const h=[];let d,p=t;const m=e.shape[0],y=Qs(e);let v;s!=null&&(v=Qs(s));for(let b=0;b<m;++b){const S=y[b],C=ae(()=>n(S,p));if(s==null)d=C[0],p=C[1];else{const T=ae(()=>{const O=v[b],V=Le(Ns(O),O),k=be(J(C[0],O),J(p[0],V)),$=p.map((N,R)=>be(J(C[1][R],O),J(N,V)));return{output:k,newStates:$}});d=T.output,p=T.newStates}a&&h.push(d)}let w;return a&&(w=jr(h,1)),[d,w,p]})}class to extends pt{constructor(e){super(e);let t;if(e.cell==null)throw new ne("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new U1({cells:e.cell}):t=e.cell,t.stateSize==null)throw new ne("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Nn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ki(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){o_(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[s].concat(i)}else return s}computeMask(e,t){return ae(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(i=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new ct("Constants support is not implemented in RNN yet.");o_(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new Nn({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!mt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new ne(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new Nn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ae(()=>{if(!this.stateful)throw new mo("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new ne("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>kn([r,s])):this.states_=[kn([r,this.cell.stateSize])];else if(e==null)ot(this.states_),this.keptStates!=null&&(ot(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>kn([r,s])):this.states_[0]=kn([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ne(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):ot(this.states_);for(let s=0;s<this.states_.length;++s){const i=e[s],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,a=[r,o];if(!mt(i.shape,a))throw new ne(`State ${s} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>Fn(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=Hz(e,r,s,this.numConstants);e=i.inputs,r=i.initialState,s=i.constants;let o=[],a=[];if(r!=null){t.initialState=r,o=o.concat(r),this.stateSpec=[];for(const u of r)this.stateSpec.push(new Nn({shape:u.shape}));a=a.concat(this.stateSpec)}if(s!=null&&(t.constants=s,o=o.concat(s),this.numConstants=s.length),o[0]instanceof Qi){const u=[e].concat(o),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const p=super.apply(u,t);return this.inputSpec=d,p}else return super.apply(e,t)}call(e,t){return ae(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let i=t==null?null:t.initialState;e=nt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new ne(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:s},u=qz((y,v)=>{const w=this.cell.call([y].concat(v),a);return[w[0],w.slice(1)]},e,i,this.goBackwards,r,null,this.unroll,this.returnSequences),h=u[0],d=u[1],p=u[2];this.stateful&&this.resetStates(p,s);const m=this.returnSequences?d:h;return this.returnState?[m].concat(p):m})}getInitialState(e){return ae(()=>{let t=kn(e.shape);return t=ze(t,[1,2]),t=Iy(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?s_(t,[1,r]):t):this.cell.stateSize>1?[s_(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===to.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const s=t.cell,i=Gi(s,r);return new e(Object.assign(t,{cell:i}))}}to.className="RNN";Ie(to);class ky extends pt{}class z1 extends ky{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qn(this.units,"units"),this.activation=Wl(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=rn(e.kernelRegularizer),this.recurrentRegularizer=rn(e.recurrentRegularizer),this.biasRegularizer=rn(e.biasRegularizer),this.kernelConstraint=Vn(e.kernelConstraint),this.recurrentConstraint=Vn(e.recurrentConstraint),this.biasConstraint=Vn(e.biasConstraint),this.dropout=cd([1,Bl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=cd([1,Bl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=At(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{if(e=e,e.length!==2)throw new ne(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jl({ones:()=>Ns(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jl({ones:()=>Ns(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Ro(J(e,o),this.kernel.read()):i=Ro(e,this.kernel.read()),this.bias!=null&&(i=eo(i,this.bias.read())),a!=null&&(r=J(r,a));let l=be(i,Ro(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ul(this.activation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),recurrentInitializer:cn(this.recurrentInitializer),biasInitializer:cn(this.biasInitializer),kernelRegularizer:qt(this.kernelRegularizer),recurrentRegularizer:qt(this.recurrentRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),recurrentConstraint:Mn(this.recurrentConstraint),biasConstraint:Mn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}z1.className="SimpleRNNCell";Ie(z1);class fN extends to{constructor(e){e.cell=new z1(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return new e(t)}}fN.className="SimpleRNN";Ie(fN);class B1 extends ky{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ne("GRUCell does not support reset_after parameter set to true.");this.units=e.units,qn(this.units,"units"),this.activation=Wl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Wl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=rn(e.kernelRegularizer),this.recurrentRegularizer=rn(e.recurrentRegularizer),this.biasRegularizer=rn(e.biasRegularizer),this.kernelConstraint=Vn(e.kernelConstraint),this.recurrentConstraint=Vn(e.recurrentConstraint),this.biasConstraint=Vn(e.biasConstraint),this.dropout=cd([1,Bl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=cd([1,Bl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=At(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{if(e=e,e.length!==2)throw new ne(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jl({ones:()=>Ns(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jl({ones:()=>Ns(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=J(e,i[0]));let h=Ro(e,this.kernel.read());this.useBias&&(h=eo(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=J(s,o[0]));const d=this.recurrentKernel.read(),[p,m]=ns(d,[2*this.units,this.units],d.rank-1),y=Ro(s,p),[v,w,b]=ns(h,3,h.rank-1),[S,C]=ns(y,2,y.rank-1);a=this.recurrentActivation.apply(be(v,S)),l=this.recurrentActivation.apply(be(w,C));const T=Ro(J(l,s),m);u=this.activation.apply(be(b,T));const O=be(J(a,s),J(be(1,Qt(a)),u));return[O,O]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ul(this.activation),recurrentActivation:Ul(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),recurrentInitializer:cn(this.recurrentInitializer),biasInitializer:cn(this.biasInitializer),kernelRegularizer:qt(this.kernelRegularizer),recurrentRegularizer:qt(this.recurrentRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),recurrentConstraint:Mn(this.recurrentConstraint),biasConstraint:Mn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}B1.className="GRUCell";Ie(B1);class pN extends to{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new B1(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}pN.className="GRU";Ie(pN);class Ny extends ky{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qn(this.units,"units"),this.activation=Wl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Wl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=rn(e.kernelRegularizer),this.recurrentRegularizer=rn(e.recurrentRegularizer),this.biasRegularizer=rn(e.biasRegularizer),this.kernelConstraint=Vn(e.kernelConstraint),this.recurrentConstraint=Vn(e.recurrentConstraint),this.biasConstraint=Vn(e.biasConstraint),this.dropout=cd([1,Bl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=cd([1,Bl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=At(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;s=new(t=class extends gi{apply(l,u){const h=i.apply([o]),d=new k1().apply([o]),p=i.apply([o*2]);return YD(YD(h,d),p)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ae(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new ne(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jl({ones:()=>Ns(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jl({ones:()=>Ns(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,h,d;0<this.dropout&&this.dropout<1&&(e=J(e,o[0]));let p=Ro(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=J(s,a[0])),p=be(p,Ro(s,this.recurrentKernel.read())),this.useBias&&(p=eo(p,this.bias.read()));const[m,y,v,w]=ns(p,4,p.rank-1);l=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(y),h=be(J(u,i),J(l,this.activation.apply(v))),d=this.recurrentActivation.apply(w);const b=J(d,this.activation.apply(h));return[b,b,h]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ul(this.activation),recurrentActivation:Ul(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),recurrentInitializer:cn(this.recurrentInitializer),biasInitializer:cn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:qt(this.kernelRegularizer),recurrentRegularizer:qt(this.recurrentRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),recurrentConstraint:Mn(this.recurrentConstraint),biasConstraint:Mn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Ny.className="LSTMCell";Ie(Ny);class mN extends to{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ny(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}mN.className="LSTM";Ie(mN);class U1 extends ky{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ae(()=>{e=e;let r=e.slice(1);const s=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?s.push(r.splice(0,a.stateSize.length)):s.push(r.splice(0,1));s.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=s[a],a===0?o=[e[0]].concat(r):o=[o[0]].concat(r),o=l.call(o,t),i.push(o.slice(1))}r=[];for(const a of i.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(e){o_(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{ec(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,t,r={}){const s=[];for(const i of t.cells)s.push(Gi(i,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return a_(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,i=e.splice(s);for(let o=0;o<r.weights.length;++o)t.push([r.weights[o],i[o]])}Uk(t)}}U1.className="StackedRNNCells";Ie(U1);function jl(n){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):oz(e(),t),a=()=>Ty(o,e,r);return!s||s<=1?Fn(a().clone()):Array(s).fill(void 0).map(a).map(u=>Fn(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Koe=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Kz extends to{constructor(e){if(e.unroll)throw new ct("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ct("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Nn({ndim:5})]}call(e,t){return ae(()=>{if(this.cell.dropoutMask!=null&&(ot(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ot(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ne("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ae(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)],o=kn(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){ae(()=>{if(!this.stateful)throw new mo("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)];if(r[0]==null)throw new ne("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kn(i)):this.states_=[kn(i)];else if(e==null)ot(this.states_),this.keptStates!=null&&(ot(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kn(i)):this.states_[0]=kn(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ne(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):ot(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!mt(l.shape,u))throw new ne(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Fn(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],h=e[l?4:3],d=Hi(u,s[0],i,o[0],a[0]),p=Hi(h,s[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[r,d,p]:[d,p,r]]}}Kz.className="ConvRNN2D";class W1 extends Ny{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,qn(this.filters,"filters"),this.kernelSize=Hh(r,2,"kernelSize"),this.kernelSize.forEach(l=>qn(l,"kernelSize")),this.strides=Hh(s||1,2,"strides"),this.strides.forEach(l=>qn(l,"strides")),this.padding=i||"valid",Ys(this.padding),this.dataFormat=o||"channelsLast",In(this.dataFormat),this.dilationRate=Hh(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>qn(l,"dilationRate"))}build(e){var t;e=At(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new ne(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],i=4,o=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,h=this.filters;l=new(t=class extends gi{apply(p,m){const y=u.apply([h]),v=ts([h]),w=u.apply([h*2]);return Ok([y,v,w])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ae(()=>{if(e.length!==3)throw new ne(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jl({ones:()=>Ns(s),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(ie,j,Z)=>!j||!j[Z]?ie:J(j[Z],ie);let h=u(s,l,0),d=u(s,l,1),p=u(s,l,2),m=u(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jl({ones:()=>Ns(i),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const y=this.recurrentDropoutMask;let v=u(i,y,0),w=u(i,y,1),b=u(i,y,2),S=u(i,y,3);const C=3,[T,O,V,k]=ns(this.kernel.read(),a,C),[$,N,R,E]=this.useBias?ns(this.bias.read(),a):[null,null,null,null];h=this.inputConv(h,T,$,this.padding),d=this.inputConv(d,O,N,this.padding),p=this.inputConv(p,V,R,this.padding),m=this.inputConv(m,k,E,this.padding);const[L,F,G,Y]=ns(this.recurrentKernel.read(),a,C);v=this.recurrentConv(v,L),w=this.recurrentConv(w,F),b=this.recurrentConv(b,G),S=this.recurrentConv(S,Y);const q=this.recurrentActivation.apply(be(h,v)),se=this.recurrentActivation.apply(be(d,w)),X=be(J(se,o),J(q,this.activation.apply(be(p,b)))),re=J(this.recurrentActivation.apply(be(m,S)),this.activation.apply(X));return[re,re,X]})}getConfig(){const e=super.getConfig(),t=Koe(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}inputConv(e,t,r,s){const i=Ta(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?eo(i,r,this.dataFormat):i}recurrentConv(e,t){return Ta(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}W1.className="ConvLSTM2DCell";Ie(W1);class gN extends Kz{constructor(e){const t=new W1(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}gN.className="ConvLSTM2D";Ie(gN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class j1 extends pt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,i=this.getNoiseShape(r);return Ty(()=>oz(r,this.rate,i,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}j1.className="Dropout";Ie(j1);class yN extends j1{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}yN.className="SpatialDropout1D";Ie(yN);class wN extends pt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,qn(this.units,"units"),this.activation=Wl(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Vn(e.kernelConstraint),this.biasConstraint=Vn(e.biasConstraint),this.kernelRegularizer=rn(e.kernelRegularizer),this.biasRegularizer=rn(e.biasRegularizer),this.activityRegularizer=rn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=At(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=At(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e),s=Z3(this.activation.getClassName());let i;return s!=null?i=Ro(r,this.kernel.read(),s,this.bias?this.bias.read():null):(i=Ro(r,this.kernel.read()),this.bias!=null&&(i=eo(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Ul(this.activation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),biasInitializer:cn(this.biasInitializer),kernelRegularizer:qt(this.kernelRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),biasConstraint:Mn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}wN.className="Dense";Ie(wN);class vN extends pt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=At(e);for(const t of e.slice(1))if(t==null)throw new ne(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],kl(e,1)]}call(e,t){return ae(()=>{this.invokeCallHook(e,t);let r=nt(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let i=2;i<r.rank;++i)s.push(i);s.push(1),r=yt(r,s)}return iie(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}vN.className="Flatten";Ie(vN);class xN extends pt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Wl(e.activation)}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e);return this.activation.apply(r)})}getConfig(){const e={activation:Ul(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}xN.className="Activation";Ie(xN);class bN extends pt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ae(()=>(e=nt(e),rie(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}bN.className="RepeatVector";Ie(bN);class IN extends pt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let i=1,o=null;for(let l=0;l<s.length;++l){const u=s[l];if(this.isUnknown(u))if(o===null)o=l;else throw new ne("Can only specifiy one unknown dimension.");else i*=u}const a=kl(e);if(o!==null){if(i===0||a%i!==0)throw new ne(r);s[o]=a/i}else if(a!==i)throw new ne(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e),s=r.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return ee(r,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}IN.className="Reshape";Ie(IN);class SN extends pt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Ki(1,e.dims.length+1);if(!mt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Nn({ndim:this.dims.length+1})]}computeOutputShape(e){e=At(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return yt(nt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}SN.className="Permute";Ie(SN);class TN extends pt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=nt(e);return bm(fc(r,this.maskValue),-1)}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e),o=bm(fc(r,this.maskValue),-1,!0);return J(r,Re(o,r.dtype))})}}TN.className="Masking";Ie(TN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _N extends pt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Mt(e.inputLength))}this.inputDim=e.inputDim,qn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,qn(this.outputDim,"outputDim"),this.embeddingsInitializer=nn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=rn(e.embeddingsRegularizer),this.activityRegularizer=rn(e.activityRegularizer),this.embeddingsConstraint=Vn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ae(()=>this.maskZero?(e=nt(e),fc(e,xt(e))):null)}computeOutputShape(e){if(e=At(e),this.inputLength==null)return[...e,this.outputDim];const t=Mt(this.inputLength);if(t.length!==e.length-1)throw new ne(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const i=t[s],o=e[s+1];if(i!=null&&o!=null&&i!==o)throw new ne(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[r]=o),r++}}return[e[0],...t,this.outputDim]}call(e,t){return ae(()=>{this.invokeCallHook(e,t);let r=nt(e);r.dtype!=="int32"&&(r=$o(r,"int32"));const s=iz(this.embeddings.read(),ee(r,[r.size]));return ee(s,At(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:cn(this.embeddingsInitializer),embeddingsRegularizer:qt(this.embeddingsRegularizer),activityRegularizer:qt(this.activityRegularizer),embeddingsConstraint:Mn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}_N.className="Embedding";Ie(_N);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Mc extends pt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new ct}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const i=e[e.length-t.length+s],o=t[s];if(i==null||o==null||i<0||o<0)r.push(null);else if(i===1)r.push(o);else if(o===1)r.push(i);else{if(i!==o)throw new ne("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(i)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[At(e)]),e=e,e.length<2)throw new ne(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=El(t),t.length>1)throw new ne(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const s=e.map(i=>i.length);e.indexOf(null)===-1&&El(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ae(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(i=>i.rank);if(s.indexOf(null)===-1){const i=Bl(s);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Iy(o,1);r.push(o)}return this.mergeFunction(r)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const h=l.shape,d=h[0],p=h.slice(1).concat([d]);let m=ee(l,[d].concat(kl(h.slice(1))));m=yt(m,[1,0]),m=ee(m,p),r.push(m),i=!0}else if(u>1){const h=Ki(1,u).concat([0]);r.push(yt(l,h)),i=!0}else r.push(l)}let o=this.mergeFunction(r);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,h=l[u-1],d=[h].concat(l.slice(0,l.length-1));o=ee(yt(ee(o,[-1,h]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Ki(0,a-1));o=yt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const i=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=El(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return ae(()=>{if(t==null)return null;if(!Array.isArray(t))throw new ne("`mask` should be an Array");if(!Array.isArray(e))throw new ne("`inputs` should be an Array");if(t.length!==e.length)throw new ne(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:dr(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=pi(r,t[s]);return r})}}class CN extends Mc{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=be(t,e[r]);return t})}}CN.className="Add";Ie(CN);class EN extends Mc{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=J(t,e[r]);return t})}}EN.className="Multiply";Ie(EN);class kN extends Mc{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=be(t,e[r]);return J(1/e.length,t)})}}kN.className="Average";Ie(kN);class NN extends Mc{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=zo(t,e[r]);return t})}}NN.className="Maximum";Ie(NN);class $N extends Mc{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=zl(t,e[r]);return t})}}$N.className="Minimum";Ie($N);class RN extends Mc{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ne("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const i=e[s].slice();i.splice(this.axis,1);let o=!1;for(const a of r)if(mt(a,i)){o=!0;break}o||r.push(i)}if(r.length>1)throw new ne("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ae(()=>Ok(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ne("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const i of t.slice(1)){if(r[s]==null||i[s]==null){r[s]=null;break}r[s]+=i[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new ne("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ne("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ne(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ae(()=>{let r=!0;if(t.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const s=[];for(let o=0;o<e.length;++o)t[o]==null?s.push(Re(Ns(e[o]),"bool")):t[o].rank<e[o].rank?s.push(dr(t[o],-1)):s.push(t[o]);const i=vn(s,this.axis);return zb(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}RN.className="Concatenate";Ie(RN);function Dp(n,e){for(;n<0;)n+=e;return n}function Xoe(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new ct("batchDot is not implemented for tensors of 4D or higher rank yet");if(B(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),B(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new ct("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const i=t;return ae(()=>{let o;if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);e=ee(e,e.shape.concat(l))}else if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);n=ee(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=ze(J(n,e),i[0]):a=ze(J(yt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=dt(n,e,l,u)}if(o>0){let l;r>s?l=r+s-3:l=r-1;const u=[];for(let h=l;h<l+o;++h)u.push(h);a=nu(a,u)}return a.shape.length===1&&(a=dr(a,1)),a})}class AN extends Mc{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){B(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new ct("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new ne(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ne(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,o)=>Dp(i,e[o].shape.length)):s=[Dp(this.axes,t.shape.length),Dp(this.axes,r.shape.length)],this.normalize&&(t=Bv(t,s[0]),r=Bv(r,s[1])),Xoe(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[Dp(this.axes,e.length),Dp(this.axes,t.length)],r}computeOutputShape(e){B(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new ct("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const i=t.concat(r);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}AN.className="Dot";Ie(AN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DN extends pt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e);return Ty(()=>be(E1(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}DN.className="GaussianNoise";Ie(DN);class ON extends pt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const r=nt(e);return this.rate>0&&this.rate<1?Ty(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return J(r,E1(r.shape,1,i))},()=>r,t.training||!1):r})}}ON.className="GaussianDropout";Ie(ON);class PN extends pt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||nt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ae(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return Ty(()=>{const i=nt(e),l=-1.6732632423543772*1.0507009873554805;let u=Oa(tu(r),this.rate);u=$o(u,"float32");const h=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-h*l*this.rate,p=be(J(i,u),J(be(u,-1),l));return be(J(p,h),d)},()=>nt(e),t.training||!1)}return e})}}PN.className="AlphaDropout";Ie(PN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Em(n,e,t,r,s,i=.001){let o;if(n.rank===2)o=tE(n,e,t,r,s,i);else if(n.rank===3)o=nE(n,e,t,r,s,i);else if(n.rank===4)o=rE(n,e,t,r,s,i);else throw new ct(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function Qoe(n,e,t,r,s=.001){return ae(()=>{const i=cy(n,r),o=i.mean,a=i.variance;return[Em(n,o,a,t,e,s),o,a]})}function Yoe(n,e,t,r,s=.001){return ae(()=>{const i=cy(n,r),o=i.mean,a=i.variance,l=[];for(const y of Ki(0,n.rank))r.indexOf(y)!==-1?l.push(1):l.push(n.shape[y]);const u=ee(o,l),h=ee(a,l),d=e==null?null:ee(e,l),p=t==null?null:ee(t,l);return[Em(n,u,h,p,d,s),o,a]})}function Joe(n,e,t,r,s=.001){return mt(r.slice().sort(),Ki(0,n.rank-1))?Qoe(n,e,t,r,s):Yoe(n,e,t,r,s)}class FN extends pt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=nn(e.betaInitializer||"zeros"),this.gammaInitializer=nn(e.gammaInitializer||"ones"),this.movingMeanInitializer=nn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=nn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Vn(e.betaConstraint),this.gammaConstraint=Vn(e.gammaConstraint),this.betaRegularizer=rn(e.betaRegularizer),this.gammaRegularizer=rn(e.gammaRegularizer)}build(e){e=At(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new ne(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Nn({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ae(()=>{const r=t.training==null?!1:t.training,s=nt(e),i=s.shape,o=i.length,a=Ki(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=gc(1,o);u[l]=i[l];const h=a.slice();h.sort();const d=!mt(h,Ki(0,o).slice(0,o-1)),p=()=>{if(d){const S=ee(this.movingMean.read(),u),C=ee(this.movingVariance.read(),u),T=this.center?ee(this.beta.read(),u):null,O=this.scale?ee(this.gamma.read(),u):null;return Em(s,S,C,T,O,this.epsilon)}else return Em(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return p();const[m,y,v]=Joe(s,this.gamma.read(),this.beta.read(),a,this.epsilon),w=(S,C,T)=>{ae(()=>{const O=1-T,V=S.read(),k=J(Le(V,C),O);S.write(Le(V,k))})};return(()=>{w(this.movingMean,y,this.momentum),w(this.movingVariance,v,this.momentum)})(),m})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:cn(this.betaInitializer),gammaInitializer:cn(this.gammaInitializer),movingMeanInitializer:cn(this.movingMeanInitializer),movingVarianceInitializer:cn(this.movingVarianceInitializer),betaRegularizer:qt(this.betaRegularizer),gammaRegularizer:qt(this.gammaRegularizer),betaConstraint:Mn(this.betaConstraint),gammaConstraint:Mn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}FN.className="BatchNormalization";Ie(FN);class LN extends pt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=nn(e.betaInitializer||"zeros"),this.gammaInitializer=nn(e.gammaInitializer||"ones"),this.betaRegularizer=rn(e.betaRegularizer),this.gammaRegularizer=rn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=At(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==El(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(i=>e[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=nt(e),s=r.shape,i=s.length;return ae(()=>{let{mean:a,variance:l}=cy(r,this.axis,!0);const u=gc(1,i);for(const v of this.axis)u[v]=s[v];const h=v=>v!=null&&v.shape.length!==i?ee(v,u):v;let d=this.scale?h(this.gamma.read()):null,p=this.center?h(this.beta.read()):null;const m=[],y=[];for(let v=0;v<i;++v)this.axis.indexOf(v)!==-1?(m.push(s[v]),y.push(1)):(m.push(1),y.push(s[v]));return a=js(a,m),l=js(l,m),d!=null&&(d=js(d,y)),p!=null&&(p=js(p,y)),Em(r,a,l,p,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:cn(this.betaInitializer),gammaInitializer:cn(this.gammaInitializer),betaRegularizer:qt(this.betaRegularizer),gammaRegularizer:qt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}LN.className="LayerNormalization";Ie(LN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zoe(n,e,t){return ae(()=>{if(n.rank!==4)throw new ne(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ne("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Xi()),t!=="channelsLast"&&t!=="channelsFirst")throw new ne(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],Pa(n,r)})}class MN extends pt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Xi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ne(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ne(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new ne(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new Nn({ndim:4})]}computeOutputShape(e){e=At(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return ae(()=>Zoe(nt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}MN.className="ZeroPadding2D";Ie(MN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G1(n,e,t,r,s,i){return ae(()=>{In(s),tz(i),Ys(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=Xi()),i==null&&(i="max"),n=oN(n,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=uy(n,e,t,a):o=ty(n,e,t,a),s==="channelsFirst"&&(o=yt(o,[0,3,1,2])),o})}function Xz(n,e,t,r,s,i){return ae(()=>{In(s),tz(i),Ys(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=Xi()),i==null&&(i="max"),n=jz(n,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=CE(n,e,t,a):o=eE(n,e,t,a),s==="channelsFirst"&&(o=yt(o,[0,4,1,2,3])),o})}class Qz extends pt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ne(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(qn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ne(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ys(this.padding),this.inputSpec=[new Nn({ndim:3})]}computeOutputShape(e){e=At(e);const t=Hi(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ae(()=>{this.invokeCallHook(e,t),e=Iy(nt(e),2);const r=this.poolingFunction(nt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return nu(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class VN extends Qz{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return In(i),Ys(s),G1(e,t,r,s,i,"max")}}VN.className="MaxPooling1D";Ie(VN);class zN extends Qz{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return In(i),Ys(s),G1(e,t,r,s,i,"avg")}}zN.className="AveragePooling1D";Ie(zN);class Yz extends pt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ne(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),Ys(this.padding),this.inputSpec=[new Nn({ndim:4})]}computeOutputShape(e){e=At(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Hi(t,this.poolSize[0],this.padding,this.strides[0]),r=Hi(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return ae(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class BN extends Yz{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return In(i),Ys(s),G1(e,t,r,s,i,"max")}}BN.className="MaxPooling2D";Ie(BN);class UN extends Yz{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return In(i),Ys(s),G1(e,t,r,s,i,"avg")}}UN.className="AveragePooling2D";Ie(UN);class Jz extends pt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ne(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),Ys(this.padding),this.inputSpec=[new Nn({ndim:5})]}computeOutputShape(e){e=At(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Hi(t,this.poolSize[0],this.padding,this.strides[0]),r=Hi(r,this.poolSize[1],this.padding,this.strides[1]),s=Hi(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return ae(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class WN extends Jz{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return In(i),Ys(s),Xz(e,t,r,s,i,"max")}}WN.className="MaxPooling3D";Ie(WN);class jN extends Jz{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return In(i),Ys(s),Xz(e,t,r,s,i,"avg")}}jN.className="AveragePooling3D";Ie(jN);class Zz extends pt{constructor(e){super(e),this.inputSpec=[new Nn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new ct}}class GN extends Zz{constructor(e){super(e||{})}call(e,t){return ae(()=>{const r=nt(e);return un(r,1)})}}GN.className="GlobalAveragePooling1D";Ie(GN);class HN extends Zz{constructor(e){super(e||{})}call(e,t){return ae(()=>{const r=nt(e);return Ks(r,1)})}}HN.className="GlobalMaxPooling1D";Ie(HN);class eB extends pt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),this.inputSpec=[new Nn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new ct}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class qN extends eB{call(e,t){return ae(()=>{const r=nt(e);return this.dataFormat==="channelsLast"?un(r,[1,2]):un(r,[2,3])})}}qN.className="GlobalAveragePooling2D";Ie(qN);class KN extends eB{call(e,t){return ae(()=>{const r=nt(e);return this.dataFormat==="channelsLast"?Ks(r,[1,2]):Ks(r,[2,3])})}}KN.className="GlobalMaxPooling2D";Ie(KN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tB extends pt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,i=Gi(s,r);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class XN extends tB{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=At(e),e.length<3)throw new ne(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=At(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return ae(()=>(e=nt(e),qz((o,a)=>[nt(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}XN.className="TimeDistributed";Ie(XN);function eae(n){Fc(Jse,"BidirectionalMergeMode",n)}const tae="concat";class QN extends tB{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=Gi(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=Gi(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?tae:e.mergeMode,eae(this.mergeMode),e.weights)throw new ct("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,i;return this.returnState&&(i=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[r].concat(i).concat(i.slice()):es(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=Hz(e,r,s,this.numConstants);if(e=i.inputs,r=i.initialState,s=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const o=[],a=[];if(r!=null){const u=r.length;if(u%2>0)throw new ne("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push(...r);const h=r.map(d=>new Nn({shape:d.shape}));this.forwardLayer.stateSpec=h.slice(0,u/2),this.backwardLayer.stateSpec=h.slice(u/2),a.push(...h)}if(s!=null)throw new ct("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Qi;for(const u of o)if(u instanceof Qi!==l)throw new ne("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const p=super.apply(u,t);return this.inputSpec=d,p}else return super.apply(e,t)}call(e,t){return ae(()=>{const r=t.initialState;let s,i;if(r==null)s=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=r.slice(0,r.length/2),u=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(s)&&(o=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=Xs(i,1));let a;return this.mergeMode==="concat"?a=Ok([s,i]):this.mergeMode==="sum"?a=be(s,i):this.mergeMode==="ave"?a=J(.5,be(s,i)):this.mergeMode==="mul"?a=J(s,i):this.mergeMode==null&&(a=[s,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ec(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ec(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(i).concat(i):[r].concat(i).concat(i)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=Gi(t.layer);if(delete t.layer,t.numConstants!=null)throw new ct("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}QN.className="Bidirectional";Ie(QN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YN extends pt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ae(()=>(e=nt(e),e.dtype!=="float32"&&(e=$o(e,"float32")),be(J(e,this.scale),this.offset)))}}YN.className="Rescaling";Ie(YN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:nae,cropAndResize:rae}=di;class JN extends pt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,s,i,o,a,l){return ae(()=>{let u,h=!1;const d=t/o,p=r/a,m=(s+t)/o,y=(i+r)/a,v=[d,p,m,y],w=[];e.rank===3?(h=!0,u=jr([e])):u=e;for(let O=0;O<u.shape[0];O++)w.push(v);const b=Cs(w,[w.length,4]),S=pc(0,w.length,1,"int32"),T=rae(u,b,S,[s,i],"nearest");return $o(h?nt(Qs(T)):T,l)})}upsize(e,t,r,s){return ae(()=>{const i=nae(e,[t,r]);return $o(i,s)})}call(e,t){return ae(()=>{const r=nt(e),s=r.dtype,i=r.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(r,l,u,this.height,this.width,o,a,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=At(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}JN.className="CenterCrop";Ie(JN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sae(n,e,t,r){let s=nt(n);if(s.dtype!=="int32"&&(s=$o(s,"int32")),e==="int")return s;const i=s.shape;if(s.rank===0&&(s=dr(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=dr(s,-1)),s.rank>2)throw new ne(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${s.rank}.`);const o=["multiHot","oneHot"].includes(e),a=s;let l;if(typeof r<"u"&&e==="count"?l=Pv(a,r,t,o):l=Pv(a,[],t,o),e!=="tfIdf")return l;if(r)return J(l,r);throw new ne("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ZN extends pt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=At(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ae(()=>{e=nt(e),e.dtype!=="int32"&&(e=$o(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new ne(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=nt(t.countWeights)}const s=Ks(e),i=sd(e),o=qr(this.numTokens,s).bufferSync().get(0),a=Oa(i,0).bufferSync().get(0);if(!(o&&a))throw new ne(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return sae(e,this.outputMode,this.numTokens,r)})}}ZN.className="CategoryEncoding";Ie(ZN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iae=["bilinear","nearest"],mO=new Set(iae);class e2 extends pt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(mO.has(e.interpolation))this.interpolation=e.interpolation;else throw new ne(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=At(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ae(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return di.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return di.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...mO]} are supported`)})}}e2.className="Resizing";Ie(e2);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nB{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}nB.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rB extends pt{constructor(e){super(e),this.randomGenerator=new nB(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}rB.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oae=["bilinear","nearest"],gO=new Set(oae);class t2 extends rB{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ne(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ne(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ne(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(gO.has(r))this.interpolation=r;else throw new ne(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=At(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ae(()=>{const r=nt(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=tu([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*s;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return di.resizeBilinear(e,o);case"nearest":return di.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...gO]} are supported`)}})}}t2.className="RandomWidth";Ie(t2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aae(n){return new Ef(n)}function lae(n){return new rN(n)}function uae(n){return new eN(n)}function cae(n){return new tN(n)}function hae(n){return new nN(n)}function dae(n){return new iN(n)}function fae(n){return new sN(n)}function pae(n){return new Ey(n)}function mae(n){return new $f(n)}function gae(n){return new aN(n)}function yae(n){return new Rf(n)}function wae(n){return new lN(n)}function vae(n){return new uN(n)}function xae(n){return new cN(n)}function bae(n){return new hN(n)}function Iae(n){return new dN(n)}function Sae(n){return new xN(n)}function Tae(n){return new wN(n)}function _ae(n){return new j1(n)}function Cae(n){return new yN(n)}function Eae(n){return new vN(n)}function kae(n){return new bN(n)}function Nae(n){return new IN(n)}function $ae(n){return new SN(n)}function Rae(n){return new _N(n)}function Aae(n){return new CN(n)}function Dae(n){return new kN(n)}function Oae(n){return new RN(n)}function Pae(n){return new NN(n)}function Fae(n){return new $N(n)}function Lae(n){return new EN(n)}function Mae(n){return new AN(n)}function Vae(n){return new FN(n)}function zae(n){return new LN(n)}function Bae(n){return new MN(n)}function n2(n){return new zN(n)}function Uae(n){return n2(n)}function Wae(n){return n2(n)}function r2(n){return new UN(n)}function jae(n){return r2(n)}function Gae(n){return r2(n)}function s2(n){return new jN(n)}function Hae(n){return s2(n)}function qae(n){return s2(n)}function Kae(n){return new GN(n)}function Xae(n){return new qN(n)}function sB(n){return new HN(n)}function iB(n){return new KN(n)}function oB(n){return new VN(n)}function aB(n){return new BN(n)}function Qae(n){return new WN(n)}function Yae(n){return new pN(n)}function Jae(n){return new B1(n)}function Zae(n){return new mN(n)}function ele(n){return new Ny(n)}function tle(n){return new fN(n)}function nle(n){return new z1(n)}function rle(n){return new gN(n)}function sle(n){return new W1(n)}function ile(n){return new to(n)}function ole(n){return new U1(n)}function ale(n){return new QN(n)}function lle(n){return new XN(n)}const ule=sB,cle=iB,hle=oB,dle=aB;function fle(n){return new DN(n)}function ple(n){return new ON(n)}function mle(n){return new PN(n)}function gle(n){return new TN(n)}function yle(n){return new YN(n)}function wle(n){return new JN(n)}function vle(n){return new e2(n)}function xle(n){return new ZN(n)}function ble(n){return new t2(n)}const Ile=Object.freeze(Object.defineProperty({__proto__:null,Layer:pt,RNN:to,RNNCell:ky,activation:Sae,add:Aae,alphaDropout:mle,average:Dae,averagePooling1d:n2,averagePooling2d:r2,averagePooling3d:s2,avgPool1d:Uae,avgPool2d:jae,avgPool3d:Hae,avgPooling1d:Wae,avgPooling2d:Gae,avgPooling3d:qae,batchNormalization:Vae,bidirectional:ale,categoryEncoding:xle,centerCrop:wle,concatenate:Oae,conv1d:pae,conv2d:mae,conv2dTranspose:gae,conv3d:yae,conv3dTranspose:wae,convLstm2d:rle,convLstm2dCell:sle,cropping2D:xae,dense:Tae,depthwiseConv2d:Iae,dot:Mae,dropout:_ae,elu:lae,embedding:Rae,flatten:Eae,gaussianDropout:ple,gaussianNoise:fle,globalAveragePooling1d:Kae,globalAveragePooling2d:Xae,globalMaxPool1d:ule,globalMaxPool2d:cle,globalMaxPooling1d:sB,globalMaxPooling2d:iB,gru:Yae,gruCell:Jae,input:Ez,inputLayer:aae,layerNormalization:zae,leakyReLU:cae,lstm:Zae,lstmCell:ele,masking:gle,maxPool1d:hle,maxPool2d:dle,maxPooling1d:oB,maxPooling2d:aB,maxPooling3d:Qae,maximum:Pae,minimum:Fae,multiply:Lae,permute:$ae,prelu:hae,randomWidth:ble,reLU:uae,repeatVector:kae,rescaling:yle,reshape:Nae,resizing:vle,rnn:ile,separableConv2d:vae,simpleRNN:tle,simpleRNNCell:nle,softmax:dae,spatialDropout1d:Cae,stackedRNNCells:ole,thresholdedReLU:fae,timeDistributed:lle,upSampling2d:bae,zeroPadding2d:Bae},Symbol.toStringTag,{value:"Module"}));function Sle(n,e){return Xk(n,e)}function Tle(n,e){return wz(n,e)}function _le(n,e){return vz(n,e)}function Cle(n,e){return Qk(n,e)}function Ele(n,e){return Yk(n,e)}function kle(n,e){return yz(n,e)}function Nle(n,e){return ooe(n,e)}function $le(n,e){return Kk(n,e)}function Rle(n,e){return F1(n,e)}function Ale(n,e){return kf(n,e)}function Dle(n,e){return kf(n,e)}function Ole(n,e){return kf(n,e)}function Ple(n,e){return Lc(n,e)}function Fle(n,e){return Lc(n,e)}function Lle(n,e){return Lc(n,e)}function Mle(n,e){return aoe(n,e)}const Vle=Object.freeze(Object.defineProperty({__proto__:null,MAPE:Dle,MSE:Fle,binaryAccuracy:Sle,binaryCrossentropy:Tle,categoricalAccuracy:Cle,categoricalCrossentropy:Ele,cosineProximity:$le,mape:Ole,meanAbsoluteError:Rle,meanAbsolutePercentageError:Ale,meanSquaredError:Ple,mse:Lle,precision:kle,r2Score:Mle,recall:Nle,sparseCategoricalAccuracy:_le},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zle=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:Foe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ble(n){return new Cy(n)}function Ule(n){return Woe(n)}function Wle(n){return joe(n)}const jle=Object.freeze(Object.defineProperty({__proto__:null,l1:Ule,l1l2:Ble,l2:Wle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class lB extends hd{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof pa))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function hw(n,e){return n<e}function yO(n,e){return n>e}class uB extends lB{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new ct("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=hw:this.mode==="max"?this.monitorFunc=yO:this.monitor.indexOf("acc")!==-1?this.monitorFunc=yO:this.monitorFunc=hw,this.monitorFunc===hw&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===hw?1/0:-1/0}async onEpochEnd(e,t){await ul(t);const r=this.getMonitorValue(t);r!=null&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});const t=e[this.monitor];return t==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),t}}function Gle(n){return new uB(n)}const Hle={earlyStopping:Gle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qle=le();qle.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var vs;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(vs||(vs={}));var wO;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(wO||(wO={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i2={};function Kle(n,e){const t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};i2[n]=t}function cB(n){return i2[n]}function Xle(n){delete i2[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P(n,e,t,r,s){const i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return fr(e.inputNames[u],t,r,s);if(i.type==="tensors"){const p=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((y,v)=>{var w;return((w=p[v])===null||w===void 0?void 0:w.op)!=="NoOp"}).map(y=>fr(y,t,r,s))}const h=fr(e.inputNames[u],t,r,s),d=h.dataSync();return i.type==="number"?d[0]:qs(h.shape,d)}const o=e.attrParams[n];return o&&o.value}function fr(n,e,t,r){const[s,i]=bs(n,t);if(r!=null){const a=r.getHashTableHandleByName(s);if(a!=null)return a}const o=t.currentContextIds.find(a=>!!e[Hv(s,a)]);return o!==void 0?e[Hv(s,o)][i]:void 0}function vO(n,e,t){return e[Hv(n,t.currentContextId)]}function sa(n,e){const[t,r,s]=bs(n,e);return[Hv(t,e&&e.currentContextId),r,s]}function Hv(n,e){return e?`${n}-${e}`:n}function bs(n,e){if(n==="")return["",0,void 0];const t=e!=null&&e.parseNodeNameCache!=null;if(t){const i=e.parseNodeNameCache.get(n);if(i!=null)return i}const r=n.split(":");let s;if(r.length===1)s=[n,0,void 0];else{const i=r[0],o=r.length===3?r[1]:void 0,a=Number(r[r.length-1]);s=[i,a,o]}return t&&e.parseNodeNameCache.set(n,s),s}function Bw(n,e,t){let r=P("pad",n,e,t);if(r==="explicit"){r=P("explicitPaddings",n,e,t);const s=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)s[i][0]=r[i*2],s[i][1]=r[i*2+1];return s}return r}function ia(n){return n.kept?n:ko(n)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qle=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Yle=Object.freeze(Object.defineProperty({__proto__:null,json:Qle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jle=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Zle=Object.freeze(Object.defineProperty({__proto__:null,json:Jle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eue=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],tue=Object.freeze(Object.defineProperty({__proto__:null,json:eue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],rue=Object.freeze(Object.defineProperty({__proto__:null,json:nue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],iue=Object.freeze(Object.defineProperty({__proto__:null,json:sue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oue=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],aue=Object.freeze(Object.defineProperty({__proto__:null,json:oue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lue=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],uue=Object.freeze(Object.defineProperty({__proto__:null,json:lue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cue=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],hue=Object.freeze(Object.defineProperty({__proto__:null,json:cue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const due=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],fue=Object.freeze(Object.defineProperty({__proto__:null,json:due},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],mue=Object.freeze(Object.defineProperty({__proto__:null,json:pue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gue=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],yue=Object.freeze(Object.defineProperty({__proto__:null,json:gue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wue=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],vue=Object.freeze(Object.defineProperty({__proto__:null,json:wue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xue=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],bue=Object.freeze(Object.defineProperty({__proto__:null,json:xue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iue=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Sue=Object.freeze(Object.defineProperty({__proto__:null,json:Iue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tue=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],_ue=Object.freeze(Object.defineProperty({__proto__:null,json:Tue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cue=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Eue=Object.freeze(Object.defineProperty({__proto__:null,json:Cue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kue=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Nue=Object.freeze(Object.defineProperty({__proto__:null,json:kue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ue=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Rue=Object.freeze(Object.defineProperty({__proto__:null,json:$ue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aue=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Due=Object.freeze(Object.defineProperty({__proto__:null,json:Aue},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xO{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Yle,Zle,tue,rue,iue,aue,uue,hue,fue,mue,yue,vue,bue,Sue,_ue,Eue,Nue,Rue,Due],t=[].concat(...e.map(r=>r.json));this.opMappers=t.reduce((r,s)=>(r[s.tfOpName]=s,r),{})}transformGraph(e,t={}){const r=e.node,s=[],i=[],o=[],a=r.reduce((v,w)=>(v[w.name]=this.mapNode(w),w.op.startsWith("Placeholder")?s.push(v[w.name]):w.op==="Const"?i.push(v[w.name]):(w.input==null||w.input.length===0)&&o.push(v[w.name]),v),{});let l=[];const u=[];let h={},d={};t!=null&&(h=this.mapSignatureEntries(t.inputs),d=this.mapSignatureEntries(t.outputs));const p=Object.keys(a);p.forEach(v=>{const w=a[v];w.inputNames.forEach((b,S)=>{const[C,,T]=sa(b),O=a[C];if(O.outputs!=null){const V=O.outputs.indexOf(T);if(V!==-1){const k=`${C}:${V}`;w.inputNames[S]=k}}w.inputs.push(O),O.children.push(w)})}),Object.keys(d).length===0?p.forEach(v=>{const w=a[v];w.children.length===0&&u.push(w)}):Object.keys(d).forEach(v=>{const[w]=sa(v),b=a[w];b!=null&&(b.signatureKey=d[v],u.push(b))}),Object.keys(h).length>0?Object.keys(h).forEach(v=>{const[w]=sa(v),b=a[w];b&&(b.signatureKey=h[v],l.push(b))}):l=s;let m={};e.library!=null&&e.library.function!=null&&(m=e.library.function.reduce((v,w)=>(v[w.signature.name]=this.mapFunction(w),v),{}));const y={nodes:a,inputs:l,outputs:u,weights:i,placeholders:s,signature:t,functions:m};return o.length>0&&(y.initNodes=o),y}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,r)=>(t[e[r].name]=r,t),{})}mapNode(e){const t=cB(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const r={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(s=>s.startsWith("^")?s.slice(1):s),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(r.inputParams=t.inputs.reduce((s,i)=>(s[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},s),{})),t.attrs!=null&&(r.attrParams=t.attrs.reduce((s,i)=>{const o=i.type;let a;switch(i.type){case"string":a=d_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=d_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=v_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=v_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=p_(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=p_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=w_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=w_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=f_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=f_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=b_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=b_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=y_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=y_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=x_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=x_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=m_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=m_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=g_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=g_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=bO(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=bO(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return s[i.name]={value:a,type:o},s},{})),r}mapFunction(e){const t=e.nodeDef,r=[],s=[];let i={};t!=null&&(i=t.reduce((d,p)=>(d[p.name]=this.mapNode(p),p.op==="Const"&&s.push(d[p.name]),d),{}));const o=[],a=[];e.signature.inputArg.forEach(d=>{const[p]=sa(d.name),m={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:o2(d.type),type:"dtype"}},children:[]};m.signatureKey=d.name,o.push(m),i[p]=m}),Object.keys(i).forEach(d=>{const p=i[d];p.inputNames.forEach((m,y)=>{const[v,,w]=sa(m),b=i[v];if(b.outputs!=null){const S=b.outputs.indexOf(w);if(S!==-1){const C=`${v}:${S}`;p.inputNames[y]=C}}p.inputs.push(b),b.children.push(p)})});const u=e.ret;e.signature.outputArg.forEach(d=>{const[p,m]=sa(u[d.name]),y=i[p];y!=null&&(y.defaultOutput=m,a.push(y))});const h=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:s,placeholders:r,signature:h}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,r)=>(t[r.name]=this.mapArgToTensorInfo(r),t),{}),outputs:e.signature.outputArg.reduce((t,r)=>(t[r.name]=this.mapArgToTensorInfo(r,e.ret),t),{})}}mapArgToTensorInfo(e,t){let r=e.name;return t!=null&&(r=t[r]),{name:r,dtype:e.type}}}function Oue(n){const e=le().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function hB(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):Oue(n);return e?t:t.toLowerCase()}function d_(n,e,t,r=!1){const s=n[e];return s!=null?hB(s.s,r):t}function f_(n,e,t){const r=n[e];return r?r.b:t}function p_(n,e,t){const r=n[e]||{},s=r.i!=null?r.i:r.f!=null?r.f:t;return typeof s=="number"?s:parseInt(s,10)}function o2(n){switch(typeof n=="string"&&(n=vs[n]),n){case vs.DT_FLOAT:case vs.DT_HALF:return"float32";case vs.DT_INT32:case vs.DT_INT64:case vs.DT_INT8:case vs.DT_UINT8:return"int32";case vs.DT_BOOL:return"bool";case vs.DT_DOUBLE:return"float32";case vs.DT_STRING:return"string";case vs.DT_COMPLEX64:case vs.DT_COMPLEX128:return"complex64";default:return null}}function bO(n,e,t){const r=n[e];return r&&r.func?r.func.name:t}function m_(n,e,t){const r=n[e];return r&&r.type?o2(r.type):t}function g_(n,e,t){const r=n[e];return r&&r.list&&r.list.type?r.list.type.map(s=>o2(s)):t}function dB(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function y_(n,e,t){const r=n[e];return r&&r.shape?dB(r.shape):t}function w_(n,e,t){const r=n[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(s=>typeof s=="number"?s:parseInt(s,10)):t}function v_(n,e,t,r=!1){const s=n[e];return s&&s.list&&s.list.s?s.list.s.map(i=>hB(i,r)):t}function x_(n,e,t){const r=n[e];return r&&r.list&&r.list.shape?r.list.shape.map(s=>dB(s)):t}function b_(n,e,t){const r=n[e];return r&&r.list&&r.list.b?r.list.b:t}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pue{constructor(e,t,r){this.node=e,this.tensorMap=t,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(s=>this.getInput(s)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((s,i)=>(s[i]=this.getAttr(i),s),{}))}getInput(e){return fr(e,this.tensorMap,this.context)}getAttr(e,t){const r=this.node.rawAttrs[e];if(r.tensor!=null)return fr(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return p_(this.node.rawAttrs,e,t);if(r.s!=null)return d_(this.node.rawAttrs,e,t);if(r.b!=null)return f_(this.node.rawAttrs,e,t);if(r.shape!=null)return y_(this.node.rawAttrs,e,t);if(r.type!=null)return m_(this.node.rawAttrs,e,t);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return w_(this.node.rawAttrs,e,t);if(r.list.s!=null)return v_(this.node.rawAttrs,e,t);if(r.list.shape!=null)return x_(this.node.rawAttrs,e,t);if(r.list.b!=null)return b_(this.node.rawAttrs,e,t);if(r.list.type!=null)return g_(this.node.rawAttrs,e,t)}return t}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xr=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:LC,abs:En,acos:GC,acosh:HC,add:be,addN:ZM,all:zb,any:bm,argMax:cc,argMin:qC,asin:KC,asinh:XC,atan:QC,atan2:YC,atanh:JC,avgPool:ty,avgPool3d:eE,basicLSTMCell:eV,batchNorm:xf,batchNorm2d:tE,batchNorm3d:nE,batchNorm4d:rE,batchToSpaceND:ny,bincount:sE,bitwiseAnd:tV,booleanMaskAsync:VV,broadcastArgs:nV,broadcastTo:Zu,buffer:ht,cast:Re,ceil:iE,clipByValue:is,clone:ko,complex:Sa,concat:vn,concat1d:oE,concat2d:aE,concat3d:lE,concat4d:uE,conv1d:Bb,conv2d:Ta,conv2dTranspose:Ub,conv3d:hE,conv3dTranspose:dE,cos:ry,cosh:Wb,cosineWindow:d1,cumprod:Tm,cumsum:jb,denseBincount:Pv,depthToSpace:fE,depthwiseConv2d:bf,diag:sV,dilation2d:pE,div:je,divNoNan:mE,dot:gE,dropout:HE,einsum:Bu,elu:If,enclosingPowerOfTwo:qE,ensureShape:iV,equal:Es,erf:Gb,euclideanNorm:wE,exp:os,expandDims:dr,expm1:vE,eye:Hb,fft:gy,fill:Ac,floor:Tf,floorDiv:Vb,fused:KV,gather:_f,gatherND:WV,greater:qr,greaterEqual:Oa,ifft:ud,imag:sy,image:di,inTopKAsync:jV,irfft:o1,isFinite:xE,isInf:bE,isNaN:IE,leakyRelu:iy,less:id,lessEqual:eu,linalg:QE,linspace:lV,localResponseNormalization:SE,log:ks,log1p:oy,logSigmoid:TE,logSoftmax:Kb,logSumExp:ay,logicalAnd:pi,logicalNot:ly,logicalOr:Xb,logicalXor:_E,losses:t3,lowerBound:cV,matMul:dt,max:Ks,maxPool:uy,maxPool3d:CE,maxPoolWithArgmax:hV,maximum:zo,mean:un,meshgrid:dV,min:sd,minimum:zl,mirrorPad:EE,mod:kE,moments:cy,movingAverage:zV,mul:J,multiRNNCell:fV,multinomial:pV,neg:Qt,norm:Sf,notEqual:fc,oneHot:od,ones:ts,onesLike:Ns,op:Q,outerProduct:mV,pad:Pa,pad1d:gV,pad2d:yV,pad3d:wV,pad4d:vV,pool:NE,pow:Fo,prelu:dy,print:jC,prod:$E,raggedGather:xV,raggedRange:bV,raggedTensorToTensor:IV,rand:SV,randomGamma:CV,randomNormal:Yb,randomStandardNormal:EV,randomUniform:tu,randomUniformInt:kV,range:pc,real:ad,reciprocal:FE,relu:Zi,relu6:Jb,reshape:ee,reverse:Xs,reverse1d:NV,reverse2d:$V,reverse3d:RV,reverse4d:AV,rfft:yy,round:Zb,rsqrt:e1,scalar:Xe,scatterND:BV,searchSorted:Qb,selu:t1,separableConv2d:n1,setdiff1dAsync:DV,sigmoid:ji,sign:LE,signal:e3,sin:r1,sinh:s1,slice:vt,slice1d:fy,slice2d:i1,slice3d:py,slice4d:ld,softmax:my,softplus:Dc,spaceToBatchND:hy,sparse:n3,sparseToDense:UV,spectral:ZV,split:ns,sqrt:Zn,square:Ut,squaredDifference:a1,squeeze:nu,stack:jr,step:Oc,stridedSlice:ME,string:r3,sub:Le,sum:ze,tan:VE,tanh:Vl,tensor:Cs,tensor1d:mr,tensor2d:Cl,tensor3d:zE,tensor4d:OV,tensor5d:PV,tensor6d:FV,tensorScatterUpdate:LV,tile:js,topk:UE,transpose:yt,truncatedNormal:u1,unique:WE,unsortedSegmentSum:c1,unstack:Qs,upperBound:MV,variable:jE,where:Qn,whereAsync:GE,zeros:kn,zerosLike:xt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fue=(n,e,t,r=xr)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(P("a",n,e,t),P("b",n,e,t))];case"AddN":return[r.addN(P("tensors",n,e,t))];case"FloorMod":case"Mod":return[r.mod(P("a",n,e,t),P("b",n,e,t))];case"Mul":return[r.mul(P("a",n,e,t),P("b",n,e,t))];case"RealDiv":case"Div":return[r.div(P("a",n,e,t),P("b",n,e,t))];case"DivNoNan":return[r.divNoNan(P("a",n,e,t),P("b",n,e,t))];case"FloorDiv":return[r.floorDiv(P("a",n,e,t),P("b",n,e,t))];case"Sub":return[r.sub(P("a",n,e,t),P("b",n,e,t))];case"Minimum":return[r.minimum(P("a",n,e,t),P("b",n,e,t))];case"Maximum":return[r.maximum(P("a",n,e,t),P("b",n,e,t))];case"Pow":return[r.pow(P("a",n,e,t),P("b",n,e,t))];case"SquaredDifference":return[r.squaredDifference(P("a",n,e,t),P("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lue=(n,e,t,r=xr)=>{switch(n.op){case"Abs":case"ComplexAbs":return[r.abs(P("x",n,e,t))];case"Acos":return[r.acos(P("x",n,e,t))];case"Acosh":return[r.acosh(P("x",n,e,t))];case"Asin":return[r.asin(P("x",n,e,t))];case"Asinh":return[r.asinh(P("x",n,e,t))];case"Atan":return[r.atan(P("x",n,e,t))];case"Atan2":return[r.atan2(P("x",n,e,t),P("y",n,e,t))];case"Atanh":return[r.atanh(P("x",n,e,t))];case"Ceil":return[r.ceil(P("x",n,e,t))];case"Complex":return[r.complex(P("real",n,e,t),P("imag",n,e,t))];case"Cos":return[r.cos(P("x",n,e,t))];case"Cosh":return[r.cosh(P("x",n,e,t))];case"Elu":return[r.elu(P("x",n,e,t))];case"Erf":return[r.erf(P("x",n,e,t))];case"Exp":return[r.exp(P("x",n,e,t))];case"Expm1":return[r.expm1(P("x",n,e,t))];case"Floor":return[r.floor(P("x",n,e,t))];case"Log":return[r.log(P("x",n,e,t))];case"Log1p":return[r.log1p(P("x",n,e,t))];case"Imag":return[r.imag(P("x",n,e,t))];case"Neg":return[r.neg(P("x",n,e,t))];case"Reciprocal":return[r.reciprocal(P("x",n,e,t))];case"Real":return[r.real(P("x",n,e,t))];case"Relu":return[r.relu(P("x",n,e,t))];case"Round":return[r.round(P("x",n,e,t))];case"Selu":return[r.selu(P("x",n,e,t))];case"Sigmoid":return[r.sigmoid(P("x",n,e,t))];case"Sin":return[r.sin(P("x",n,e,t))];case"Sign":return[r.sign(P("x",n,e,t))];case"Sinh":return[r.sinh(P("x",n,e,t))];case"Softplus":return[r.softplus(P("x",n,e,t))];case"Sqrt":return[r.sqrt(P("x",n,e,t))];case"Square":return[r.square(P("x",n,e,t))];case"Tanh":return[r.tanh(P("x",n,e,t))];case"Tan":return[r.tan(P("x",n,e,t))];case"ClipByValue":return[r.clipByValue(P("x",n,e,t),P("clipValueMin",n,e,t),P("clipValueMax",n,e,t))];case"Relu6":return[r.relu6(P("x",n,e,t))];case"Rsqrt":return[r.rsqrt(fr(n.inputNames[0],e,t))];case"LeakyRelu":return[r.leakyRelu(P("x",n,e,t),P("alpha",n,e,t))];case"Prelu":return[r.prelu(P("x",n,e,t),P("alpha",n,e,t))];case"IsNan":return[r.isNaN(fr(n.inputNames[0],e,t))];case"IsInf":return[r.isInf(fr(n.inputNames[0],e,t))];case"IsFinite":return[r.isFinite(fr(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hi(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){B(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let r=0;r<n.length;r++){const s=n[r],i=e[r];B(s<0||i<0||s===i,()=>t+` Shapes ${n} and ${e} must match`)}}}function IO(n){return!(typeof n=="number"||n.some(e=>e<0))}function Op(n,e,t){let r=I_(n,t);const s=!IO(r);if(s&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach(i=>{r=I_(i.shape,r)}),!IO(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function I_(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let r=0;r<n.length;++r){const s=n[r],i=e[r];if(s>=0&&i>=0&&s!==i)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[r]=s>=0?s:i}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mue{constructor(e,t,r,s,i,o,a){this.name=e,this.dtype=t,this.maxSize=r,this.elementShape=s,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Xe(0),Fn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const r=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),hi(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),r.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(r.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);r.tensor=t,Fn(t),r.written=!0,this.tensors[e]=r}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((r,s)=>this.write(r,t[s]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let s=0;s<this.size();s++)e.push(s)}if(e.length===0)return Cs([],[0].concat(this.elementShape));const r=this.readMany(e);return hi(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),jr(r,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Cs([],[0].concat(this.elementShape));const t=[];for(let s=0;s<this.size();s++)t.push(s);const r=this.readMany(t);return hi(this.elementShape,r[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${r[0].shape})`),vn(r,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(!this.dynamicSize&&r>=this.maxSize)throw new Error(`Max index must be < array size (${r}  vs. ${this.maxSize})`);this.writeMany(e,Qs(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let r=0;const s=e.map(l=>(r+=l,r));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=r===0?0:t.size/r,o=[];ae(()=>{t=ee(t,[1,r,i]);for(let l=0;l<e.length;++l){const h=[0,l===0?0:s[l-1],0],d=[1,e[l],i];o[l]=ee(vt(t,h,d),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wc{get id(){return this.idTensor.id}constructor(e,t,r,s=-1){this.tensors=e,this.elementShape=t,this.elementDtype=r,e!=null&&e.forEach(i=>{if(r!==i.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${i.dtype}`);hi(t,i.shape,"TensorList shape mismatch: "),Fn(i)}),this.idTensor=Xe(0),this.maxNumElements=s,Fn(this.idTensor)}copy(){return new wc([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,r=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);hi(e,this.elementShape,"TensorList shape mismatch: ");const s=Op(this.elementShape,this.tensors,e);return ae(()=>{const i=this.tensors.map(o=>ee(o,s));return jr(i,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const r=Op(this.elementShape,this.tensors,e),s=this.tensors.pop();return s.kept=!1,hi(s.shape,e,"TensorList shape mismatch: "),ee(s,r)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(hi(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Fn(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new wc([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let r=0;r<Math.min(this.tensors.length,e);++r)t.tensors[r]=this.tensors[r];return t}getItem(e,t,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);hi(this.tensors[e].shape,t,"TensorList shape mismatch: ");const s=Op(this.elementShape,this.tensors,t);return ee(this.tensors[e],s)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);hi(this.elementShape,t.shape,"TensorList shape mismatch: "),Fn(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,r){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);hi(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());const s=Op(this.elementShape,this.tensors,r);return e.length===0?Cs([],[0].concat(s)):ae(()=>{const i=e.map(o=>ee(this.tensors[o],s));return jr(i,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);hi(this.elementShape,t,"TensorList shape mismatch: ");const r=Op(this.elementShape,this.tensors,t);return this.size()===0?Cs([],[0].concat(r)):ae(()=>{const s=this.tensors.map(i=>ee(i,r));return vn(s,0)})}}function Vue(n,e,t){const r=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const s=n.shape.slice(1);hi(s,e,"TensorList shape mismatch: ");const i=Qs(n);return new wc(i,e,r)}function zue(n,e,t,r){return new wc([],n,e,r)}function Bue(n,e,t,r){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(r!=null&&r!==-1&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const i=new wc([],t,n.dtype,r),o=Qs(n,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function Uue(n,e,t){let r=0;const s=e.map(h=>(r+=h,r));if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${n.shape}`);const i=n.shape.slice(1),o=I_(i,t),a=r===0?0:n.size/r,l=ae(()=>{const h=[];n=ee(n,[1,r,a]);for(let d=0;d<e.length;++d){const m=[0,d===0?0:s[d-1],0],y=[1,e[d],a];h[d]=ee(vt(n,m,y),o)}return n.dispose(),h}),u=new wc([],t,n.dtype,e.length);for(let h=0;h<l.length;h++)u.setItem(h,l[h]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wue=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const r=P("thenBranch",n,e,t),s=P("elseBranch",n,e,t),i=P("cond",n,e,t),o=P("args",n,e,t);return(await i.data())[0]?t.functionMap[r].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap):t.functionMap[s].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const r=P("body",n,e,t),s=P("cond",n,e,t),i=P("args",n,e,t),o=await t.functionMap[s].executeFunctionAsync(i,t.tensorArrayMap,t.tensorListMap),a=i.map(h=>h.id);let l=await o[0].data();o.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&h.dispose()});let u=i;for(;l[0];){const h=u;u=await t.functionMap[r].executeFunctionAsync(u,t.tensorArrayMap,t.tensorListMap);const d=u.map(m=>m.id);h.forEach(m=>{!m.kept&&a.indexOf(m.id)===-1&&d.indexOf(m.id)===-1&&m.dispose()});const p=await t.functionMap[s].executeFunctionAsync(u,t.tensorArrayMap,t.tensorListMap);l=await p[0].data(),p.forEach(m=>{!m.kept&&a.indexOf(m.id)===-1&&d.indexOf(m.id)===-1&&m.dispose()})}return u}case"LoopCond":{const r=P("pred",n,e,t);return[ia(r)]}case"Switch":{const r=P("pred",n,e,t);let s=P("data",n,e,t);return s.kept||(s=ia(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=n.inputNames.find(s=>fr(s,e,t)!==void 0);if(r){const s=fr(r,e,t);return[ia(s)]}return}case"Enter":{const r=P("frameName",n,e,t),s=P("tensor",n,e,t);return t.enterFrame(r),[ia(s)]}case"Exit":{const r=P("tensor",n,e,t);return t.exitFrame(),[ia(r)]}case"NextIteration":{const r=P("tensor",n,e,t);return t.nextIteration(),[ia(r)]}case"TensorArrayV3":{const r=P("size",n,e,t),s=P("dtype",n,e,t),i=P("elementShape",n,e,t),o=P("dynamicSize",n,e,t),a=P("clearAfterRead",n,e,t),l=P("identicalElementShapes",n,e,t),u=P("name",n,e,t),h=new Mue(u,s,r,i,l,o,a);return t.addTensorArray(h),[h.idTensor,Xe(1)]}case"TensorArrayWriteV3":{const r=P("tensorArrayId",n,e,t),s=P("index",n,e,t),i=P("tensor",n,e,t),o=t.getTensorArray(r.id);return o.write(s,i),[o.idTensor]}case"TensorArrayReadV3":{const r=P("tensorArrayId",n,e,t),s=P("index",n,e,t);return[t.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=P("tensorArrayId",n,e,t),s=P("indices",n,e,t),i=P("dtype",n,e,t);return[t.getTensorArray(r.id).gather(s,i)]}case"TensorArrayScatterV3":{const r=P("tensorArrayId",n,e,t),s=P("indices",n,e,t),i=P("tensor",n,e,t),o=t.getTensorArray(r.id);return o.scatter(s,i),[o.idTensor]}case"TensorArrayConcatV3":{const r=P("tensorArrayId",n,e,t),s=t.getTensorArray(r.id),i=P("dtype",n,e,t);return[s.concat(i)]}case"TensorArraySplitV3":{const r=P("tensorArrayId",n,e,t),s=P("tensor",n,e,t),i=P("lengths",n,e,t),o=t.getTensorArray(r.id);return o.split(i,s),[o.idTensor]}case"TensorArraySizeV3":{const r=P("tensorArrayId",n,e,t),s=t.getTensorArray(r.id);return[Xe(s.size(),"int32")]}case"TensorArrayCloseV3":{const r=P("tensorArrayId",n,e,t),s=t.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=P("tensorListId",n,e,t),s=P("index",n,e,t),i=P("tensor",n,e,t),o=t.getTensorList(r.id);return o.setItem(s,i),[o.idTensor]}case"TensorListGetItem":{const r=P("tensorListId",n,e,t),s=P("index",n,e,t),i=P("elementShape",n,e,t),o=P("elementDType",n,e,t);return[t.getTensorList(r.id).getItem(s,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=P("indices",n,e,t),s=P("tensor",n,e,t),i=P("elementShape",n,e,t),o=P("numElements",n,e,t),a=Bue(s,r,i,o);return t.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=P("elementShape",n,e,t),s=P("elementDType",n,e,t);let i;n.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=P(i,n,e,t),a=n.op==="TensorListReserve"?-1:o,l=zue(r,s,o,a);return t.addTensorList(l),[l.idTensor]}case"TensorListGather":{const r=P("tensorListId",n,e,t),s=P("indices",n,e,t),i=P("elementShape",n,e,t),o=P("elementDType",n,e,t);return[t.getTensorList(r.id).gather(s,o,i)]}case"TensorListStack":{const r=P("tensorListId",n,e,t),s=P("elementShape",n,e,t),i=P("elementDType",n,e,t),o=P("numElements",n,e,t);return[t.getTensorList(r.id).stack(s,i,o)]}case"TensorListFromTensor":{const r=P("tensor",n,e,t),s=P("elementShape",n,e,t),i=P("elementDType",n,e,t),o=Vue(r,s,i);return t.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=P("tensorListId",n,e,t),s=t.getTensorList(r.id),i=P("dtype",n,e,t),o=P("elementShape",n,e,t);return[s.concat(i,o)]}case"TensorListPushBack":{const r=P("tensorListId",n,e,t),s=P("tensor",n,e,t),i=t.getTensorList(r.id);return i.pushBack(s),[i.idTensor]}case"TensorListPopBack":{const r=P("tensorListId",n,e,t),s=P("elementShape",n,e,t),i=P("elementDType",n,e,t);return[t.getTensorList(r.id).popBack(s,i)]}case"TensorListSplit":{const r=P("tensor",n,e,t),s=P("elementShape",n,e,t),i=P("lengths",n,e,t),o=Uue(r,i,s);return t.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=P("tensorListId",n,e,t),s=t.getTensorList(r.id);return[Xe(s.size(),"int32")]}case"TensorListResize":{const r=P("tensorListId",n,e,t),s=P("size",n,e,t),o=t.getTensorList(r.id).resize(s);return t.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SO(n,e,t){const[r,s]=P("fusedOps",n,e,t),i=r==="biasadd",o=!i,a=s==="prelu",l=r==="fusedbatchnorm",u=P("numArgs",n,e,t);if(i){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const h=P("strides",n,e,t),d=Bw(n,e,t),p=P("dataFormat",n,e,t).toUpperCase(),m=P("dilations",n,e,t);let[y,v]=P("args",n,e,t);o&&(v=y,y=void 0);const w=P("leakyreluAlpha",n,e,t);return{stride:h,pad:d,dataFormat:p,dilations:m,biasArg:y,preluArg:v,activationFunc:s,leakyreluAlpha:w}}const jue=(n,e,t,r=xr)=>{switch(n.op){case"Conv1D":{const s=P("stride",n,e,t),i=P("pad",n,e,t),o=P("dataFormat",n,e,t).toUpperCase(),a=P("dilation",n,e,t);return[r.conv1d(P("x",n,e,t),P("filter",n,e,t),s,i,o,a)]}case"Conv2D":{const s=P("strides",n,e,t),i=Bw(n,e,t),o=P("dataFormat",n,e,t).toUpperCase(),a=P("dilations",n,e,t);return[r.conv2d(P("x",n,e,t),P("filter",n,e,t),[s[1],s[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:s,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:h,leakyreluAlpha:d}=SO(n,e,t);return[r.fused.conv2d({x:P("x",n,e,t),filter:P("filter",n,e,t),strides:[s[1],s[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:h,preluActivationWeights:u,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{const{stride:s,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:h,leakyreluAlpha:d}=SO(n,e,t);return[r.fused.depthwiseConv2d({x:P("x",n,e,t),filter:P("filter",n,e,t),strides:[s[1],s[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:h,preluActivationWeights:u,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const s=P("outputShape",n,e,t),i=P("strides",n,e,t),o=Bw(n,e,t);return[r.conv2dTranspose(P("x",n,e,t),P("filter",n,e,t),s,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const s=P("strides",n,e,t),i=Bw(n,e,t),o=P("dilations",n,e,t),a=P("dataFormat",n,e,t).toUpperCase();return[r.depthwiseConv2d(P("input",n,e,t),P("filter",n,e,t),[s[1],s[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("dataFormat",n,e,t).toUpperCase(),a=P("dilations",n,e,t);return[r.conv3d(P("x",n,e,t),P("filter",n,e,t),[s[1],s[2],s[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("kernelSize",n,e,t);return[r.avgPool(P("x",n,e,t),[o[1],o[2]],[s[1],s[2]],i)]}case"MaxPool":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("kernelSize",n,e,t);return[r.maxPool(P("x",n,e,t),[o[1],o[2]],[s[1],s[2]],i)]}case"MaxPoolWithArgmax":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("kernelSize",n,e,t),a=P("includeBatchInIndex",n,e,t),{result:l,indexes:u}=r.maxPoolWithArgmax(P("x",n,e,t),[o[1],o[2]],[s[1],s[2]],i,a);return[l,u]}case"AvgPool3D":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("kernelSize",n,e,t);return[r.avgPool3d(P("x",n,e,t),[o[1],o[2],o[3]],[s[1],s[2],s[3]],i)]}case"MaxPool3D":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("kernelSize",n,e,t);return[r.maxPool3d(P("x",n,e,t),[o[1],o[2],o[3]],[s[1],s[2],s[3]],i)]}case"Dilation2D":{const s=P("strides",n,e,t),i=P("pad",n,e,t),o=P("dilations",n,e,t),a=s[1],l=s[2],u=o[1],h=o[2];return[r.dilation2d(P("x",n,e,t),P("filter",n,e,t),[a,l],i,[u,h],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gue=(n,e,t,r=xr)=>{switch(n.op){case"Fill":{const s=P("shape",n,e,t),i=P("dtype",n,e,t),o=P("value",n,e,t);return[r.fill(s,o,i)]}case"LinSpace":{const s=P("start",n,e,t),i=P("stop",n,e,t),o=P("num",n,e,t);return[r.linspace(s,i,o)]}case"Multinomial":{const s=P("logits",n,e,t),i=P("numSamples",n,e,t),o=P("seed",n,e,t);return[r.multinomial(s,i,o)]}case"OneHot":{const s=P("indices",n,e,t),i=P("depth",n,e,t),o=P("onValue",n,e,t),a=P("offValue",n,e,t),l=P("dtype",n,e,t);return[r.oneHot(s,i,o,a,l)]}case"Ones":return[r.ones(P("shape",n,e,t),P("dtype",n,e,t))];case"OnesLike":return[r.onesLike(P("x",n,e,t))];case"RandomStandardNormal":return[r.randomStandardNormal(P("shape",n,e,t),P("dtype",n,e,t),P("seed",n,e,t))];case"RandomUniform":return[r.randomUniform(P("shape",n,e,t),P("minval",n,e,t),P("maxval",n,e,t),P("dtype",n,e,t))];case"RandomUniformInt":return[r.randomUniformInt(P("shape",n,e,t),P("minval",n,e,t),P("maxval",n,e,t),P("seed",n,e,t))];case"Range":{const s=P("start",n,e,t),i=P("stop",n,e,t),o=P("step",n,e,t);return[r.range(s,i,o,P("dtype",n,e,t))]}case"TruncatedNormal":{const s=P("shape",n,e,t),i=P("mean",n,e,t),o=P("stdDev",n,e,t),a=P("seed",n,e,t);return[r.truncatedNormal(s,i,o,P("dtype",n,e,t),a)]}case"Zeros":return[r.zeros(P("shape",n,e,t),P("dtype",n,e,t))];case"ZerosLike":return[r.zerosLike(P("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rT(n,e,t){const r=P("boxes",n,e,t),s=P("scores",n,e,t),i=P("maxOutputSize",n,e,t),o=P("iouThreshold",n,e,t),a=P("scoreThreshold",n,e,t),l=P("softNmsSigma",n,e,t);return{boxes:r,scores:s,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const Hue=async(n,e,t,r,s=xr)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:h}=rT(n,e,t),d=await s.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,u,h);return[d.selectedIndices,d.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=rT(n,e,t),h=P("padToMaxOutputSize",n,e,t),d=await s.image.nonMaxSuppressionPaddedAsync(i,o,a,l,u,h);return[d.selectedIndices,d.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=rT(n,e,t);return[await s.image.nonMaxSuppressionAsync(i,o,a,l,u)]}case"Where":{const i=s.cast(P("condition",n,e,t),"bool"),o=[await s.whereAsync(i)];return i.dispose(),o}case"ListDiff":return s.setdiff1dAsync(P("x",n,e,t),P("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const que=(n,e,t,r=xr)=>{switch(n.op){case"LowerBound":{const s=P("sortedSequence",n,e,t),i=P("values",n,e,t);return[r.lowerBound(s,i)]}case"TopKV2":{const s=P("x",n,e,t),i=P("k",n,e,t),o=P("sorted",n,e,t),a=r.topk(s,i,o);return[a.values,a.indices]}case"UpperBound":{const s=P("sortedSequence",n,e,t),i=P("values",n,e,t);return[r.upperBound(s,i)]}case"Unique":{const s=P("x",n,e,t),i=r.unique(s);return[i.values,i.indices]}case"UniqueV2":{const s=P("x",n,e,t),i=P("axis",n,e,t),o=r.unique(s,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kue=(n,e,t,r=xr)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const s=P("default",n,e,t);return[fr(n.name,e,t)||s];case"Placeholder":return[fr(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const h=P("x",n,e,t);return[ia(h)]}case"IdentityN":return P("x",n,e,t).map(h=>ia(h));case"Snapshot":const i=P("x",n,e,t);return[ia(i)];case"Shape":return[r.tensor1d(P("x",n,e,t).shape,"int32")];case"ShapeN":return P("x",n,e,t).map(h=>r.tensor1d(h.shape));case"Size":return[r.scalar(P("x",n,e,t).size,"int32")];case"Rank":return[r.scalar(P("x",n,e,t).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const o=P("x",n,e,t),a=P("data",n,e,t),l=P("message",n,e,t),u=P("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let h=0;h<a.length;h++)console.log(Array.prototype.slice.call(a[h].dataSync()).slice(0,u));return[o];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xue{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Xe(0),this.tensorMap=new Map,Fn(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Xe(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const r=await e.data();return this.tensorMap.forEach(s=>s.dispose()),this.tensorMap.clear(),ae(()=>{const s=Qs(t),i=r.length,o=s.length;B(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=r[a],u=s[a];Fn(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const r=await e.data();return ae(()=>{const s=[];for(let i=0;i<r.length;i++){const o=r[i],a=this.findWithDefault(o,t);s.push(a)}return jr(s)})}findWithDefault(e,t){const r=this.tensorMap.get(e);return r??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Que=async(n,e,t,r)=>{switch(n.op){case"HashTable":case"HashTableV2":{const s=r.getHashTableHandleByName(n.name);if(s!=null)return[s];{const i=P("keyDType",n,e,t),o=P("valueDType",n,e,t),a=new Xue(i,o);return r.addHashTable(n.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const s=P("tableHandle",n,e,t,r),i=P("keys",n,e,t),o=P("values",n,e,t);return[await r.getHashTableById(s.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const s=P("tableHandle",n,e,t,r),i=P("keys",n,e,t),o=P("defaultValue",n,e,t);return[await r.getHashTableById(s.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=P("tableHandle",n,e,t,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yue=(n,e,t,r=xr)=>{switch(n.op){case"ResizeBilinear":{const s=P("images",n,e,t),i=P("size",n,e,t),o=P("alignCorners",n,e,t),a=P("halfPixelCenters",n,e,t);return[r.image.resizeBilinear(s,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const s=P("images",n,e,t),i=P("size",n,e,t),o=P("alignCorners",n,e,t),a=P("halfPixelCenters",n,e,t);return[r.image.resizeNearestNeighbor(s,[i[0],i[1]],o,a)]}case"CropAndResize":{const s=P("image",n,e,t),i=P("boxes",n,e,t),o=P("boxInd",n,e,t),a=P("cropSize",n,e,t),l=P("method",n,e,t),u=P("extrapolationValue",n,e,t);return[r.image.cropAndResize(s,i,o,a,l,u)]}case"ImageProjectiveTransformV3":{const s=P("images",n,e,t),i=P("transforms",n,e,t),o=P("outputShape",n,e,t),a=P("fillValue",n,e,t),l=P("interpolation",n,e,t),u=P("fillMode",n,e,t);return[r.image.transform(s,i,l.toLowerCase(),u.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jue=(n,e,t,r=xr)=>{switch(n.op){case"Equal":return[r.equal(P("a",n,e,t),P("b",n,e,t))];case"NotEqual":return[r.notEqual(P("a",n,e,t),P("b",n,e,t))];case"Greater":return[r.greater(P("a",n,e,t),P("b",n,e,t))];case"GreaterEqual":return[r.greaterEqual(P("a",n,e,t),P("b",n,e,t))];case"Less":return[r.less(P("a",n,e,t),P("b",n,e,t))];case"LessEqual":return[r.lessEqual(P("a",n,e,t),P("b",n,e,t))];case"LogicalAnd":return[r.logicalAnd(P("a",n,e,t),P("b",n,e,t))];case"LogicalNot":return[r.logicalNot(P("a",n,e,t))];case"LogicalOr":return[r.logicalOr(P("a",n,e,t),P("b",n,e,t))];case"Select":case"SelectV2":return[r.where(P("condition",n,e,t),P("a",n,e,t),P("b",n,e,t))];case"BitwiseAnd":return[r.bitwiseAnd(P("a",n,e,t),P("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue=(n,e,t,r=xr)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(P("a",n,e,t),P("b",n,e,t),P("transposeA",n,e,t),P("transposeB",n,e,t))];case"Einsum":return[r.einsum(P("equation",n,e,t),...P("tensors",n,e,t))];case"Transpose":return[r.transpose(P("x",n,e,t),P("perm",n,e,t))];case"_FusedMatMul":const[s,i]=P("fusedOps",n,e,t),o=s==="biasadd",a=i==="prelu",l=P("numArgs",n,e,t),u=P("leakyreluAlpha",n,e,t);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[h,d]=P("args",n,e,t);return[r.fused.matMul({a:P("a",n,e,t),b:P("b",n,e,t),transposeA:P("transposeA",n,e,t),transposeB:P("transposeB",n,e,t),bias:h,activation:i,preluActivationWeights:d,leakyreluAlpha:u})];case"MatrixBandPart":return[r.linalg.bandPart(P("a",n,e,t),P("numLower",n,e,t),P("numUpper",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ece=(n,e,t,r=xr)=>{switch(n.op){case"EuclideanNorm":return[r.euclideanNorm(P("x",n,e,t),P("axis",n,e,t),P("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(P("x",n,e,t),P("mean",n,e,t),P("variance",n,e,t),P("offset",n,e,t),P("scale",n,e,t),P("epsilon",n,e,t))];case"FusedBatchNormV3":return[r.batchNorm(P("x",n,e,t),P("mean",n,e,t),P("variance",n,e,t),P("offset",n,e,t),P("scale",n,e,t),P("epsilon",n,e,t))];case"LRN":return[r.localResponseNormalization(P("x",n,e,t),P("radius",n,e,t),P("bias",n,e,t),P("alpha",n,e,t),P("beta",n,e,t))];case"Softmax":return[r.softmax(P("x",n,e,t))];case"LogSoftmax":return[r.logSoftmax(P("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tce=(n,e,t,r=xr)=>{switch(n.op){case"RaggedGather":{const{outputNestedSplits:s,outputDenseValues:i}=r.raggedGather(P("paramsNestedSplits",n,e,t),P("paramsDenseValues",n,e,t),P("indices",n,e,t),P("outputRaggedRank",n,e,t));return s.concat(i)}case"RaggedRange":{const{rtNestedSplits:s,rtDenseValues:i}=r.raggedRange(P("starts",n,e,t),P("limits",n,e,t),P("splits",n,e,t));return[s,i]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(P("shape",n,e,t),P("values",n,e,t),P("defaultValue",n,e,t),P("rowPartitionTensors",n,e,t),P("rowPartitionTypes",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce=(n,e,t,r=xr)=>{switch(n.op){case"Max":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.max(P("x",n,e,t),a,l)]}case"Mean":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.mean(P("x",n,e,t),a,l)]}case"Min":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.min(P("x",n,e,t),a,l)]}case"Sum":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.sum(P("x",n,e,t),a,l)]}case"All":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.all(P("x",n,e,t),a,l)]}case"Any":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.any(P("x",n,e,t),a,l)]}case"ArgMax":{const a=P("axis",n,e,t);return[r.argMax(P("x",n,e,t),a)]}case"ArgMin":{const a=P("axis",n,e,t);return[r.argMin(P("x",n,e,t),a)]}case"Prod":{const a=P("axis",n,e,t),l=P("keepDims",n,e,t);return[r.prod(P("x",n,e,t),a,l)]}case"Cumprod":{const a=P("axis",n,e,t),l=P("exclusive",n,e,t),u=P("reverse",n,e,t);return[r.cumprod(P("x",n,e,t),a,l,u)]}case"Cumsum":{const a=P("axis",n,e,t),l=P("exclusive",n,e,t),u=P("reverse",n,e,t);return[r.cumsum(P("x",n,e,t),a,l,u)]}case"Bincount":const s=P("x",n,e,t),i=P("weights",n,e,t),o=P("size",n,e,t);return[r.bincount(s,i,o)];case"DenseBincount":{const a=P("x",n,e,t),l=P("weights",n,e,t),u=P("size",n,e,t),h=P("binaryOutput",n,e,t);return[r.denseBincount(a,l,u,h)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rce=(n,e,t,r=xr)=>{switch(n.op){case"ConcatV2":case"Concat":{const s=P("n",n,e,t),i=P("axis",n,e,t);let o=P("tensors",n,e,t);return o=o.slice(0,s),[r.concat(o,i)]}case"Gather":{const s=P("x",n,e,t),i=P("indices",n,e,t);return[r.gather(s,r.cast(i,"int32"),0)]}case"GatherV2":{const s=P("axis",n,e,t),i=P("batchDims",n,e,t),o=P("x",n,e,t),a=P("indices",n,e,t);return[r.gather(o,r.cast(a,"int32"),s,i)]}case"Reverse":{const s=P("dims",n,e,t),i=[];for(let a=0;a<s.length;a++)s[a]&&i.push(a);const o=P("x",n,e,t);return[r.reverse(o,i)]}case"ReverseV2":{const s=P("axis",n,e,t),i=P("x",n,e,t);return[r.reverse(i,s)]}case"Slice":{const s=P("begin",n,e,t),i=P("size",n,e,t);return[r.slice(P("x",n,e,t),s,i)]}case"StridedSlice":{const s=P("begin",n,e,t),i=P("end",n,e,t),o=P("strides",n,e,t),a=P("beginMask",n,e,t),l=P("endMask",n,e,t),u=P("ellipsisMask",n,e,t),h=P("newAxisMask",n,e,t),d=P("shrinkAxisMask",n,e,t),p=P("x",n,e,t);return[r.stridedSlice(p,s,i,o,a,l,u,h,d)]}case"Pack":return ae(()=>{const s=P("axis",n,e,t),i=P("tensors",n,e,t),o=i[0].shape,a=r.squeeze(i[0]).shape,l=i.map(u=>{const h=mt(u.shape,o);if(!h&&!mt(r.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return h?u:r.reshape(u,o)});return[r.stack(l,s)]});case"Unpack":{const s=P("axis",n,e,t),i=P("tensor",n,e,t);return r.unstack(i,s)}case"Tile":{const s=P("reps",n,e,t);return[r.tile(P("x",n,e,t),s)]}case"Split":case"SplitV":{const s=P("axis",n,e,t),i=P("numOrSizeSplits",n,e,t),o=P("x",n,e,t);return r.split(o,i,s)}case"ScatterNd":{const s=P("indices",n,e,t),i=P("values",n,e,t),o=P("shape",n,e,t);return[r.scatterND(s,i,o)]}case"GatherNd":{const s=P("x",n,e,t),i=P("indices",n,e,t);return[r.gatherND(s,i)]}case"SparseToDense":{const s=P("sparseIndices",n,e,t),i=P("outputShape",n,e,t),o=P("sparseValues",n,e,t),a=P("defaultValue",n,e,t);return[r.sparseToDense(s,o,i,o.dtype===a.dtype?a:r.cast(a,o.dtype))]}case"TensorScatterUpdate":{const s=P("indices",n,e,t),i=P("values",n,e,t),o=P("tensor",n,e,t);return[r.tensorScatterUpdate(o,s,i)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sce=(n,e,t,r=xr)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:s,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=r.sparse.sparseFillEmptyRows(P("indices",n,e,t),P("values",n,e,t),P("denseShape",n,e,t),P("defaultValue",n,e,t));return[s,i,o,a]}case"SparseReshape":{const{outputIndices:s,outputShape:i}=r.sparse.sparseReshape(P("inputIndices",n,e,t),P("inputShape",n,e,t),P("newShape",n,e,t));return[s,i]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(P("data",n,e,t),P("indices",n,e,t),P("segmentIds",n,e,t))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(P("data",n,e,t),P("indices",n,e,t),P("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ice=(n,e,t,r=xr)=>{switch(n.op){case"FFT":return[r.fft(P("x",n,e,t))];case"IFFT":return[r.ifft(P("x",n,e,t))];case"RFFT":return[r.rfft(P("x",n,e,t))];case"IRFFT":return[r.irfft(P("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=(n,e,t,r=xr)=>{switch(n.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(P("input",n,e,t),P("pattern",n,e,t),P("rewrite",n,e,t),P("replaceGlobal",n,e,t))];case"StringNGrams":{const{nGrams:s,nGramsSplits:i}=r.string.stringNGrams(P("data",n,e,t),P("dataSplits",n,e,t),P("separator",n,e,t),P("nGramWidths",n,e,t),P("leftPad",n,e,t),P("rightPad",n,e,t),P("padWidth",n,e,t),P("preserveShortSequences",n,e,t));return[s,i]}case"StringSplit":{const{indices:s,values:i,shape:o}=r.string.stringSplit(P("input",n,e,t),P("delimiter",n,e,t),P("skipEmpty",n,e,t));return[s,i,o]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(P("input",n,e,t),P("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ace=(n,e,t,r=xr)=>{switch(n.op){case"Cast":return[r.cast(P("x",n,e,t),P("dtype",n,e,t))];case"ExpandDims":{const s=P("axis",n,e,t);return[r.expandDims(P("x",n,e,t),s)]}case"Squeeze":{const s=P("axis",n,e,t);return[r.squeeze(P("x",n,e,t),s)]}case"Reshape":return[r.reshape(P("x",n,e,t),P("shape",n,e,t))];case"EnsureShape":return[r.ensureShape(P("x",n,e,t),P("shape",n,e,t))];case"MirrorPad":return[r.mirrorPad(P("x",n,e,t),P("padding",n,e,t),P("mode",n,e,t))];case"PadV2":case"Pad":return[r.pad(P("x",n,e,t),P("padding",n,e,t),P("constantValue",n,e,t))];case"SpaceToBatchND":{const s=P("blockShape",n,e,t),i=P("paddings",n,e,t);return[r.spaceToBatchND(P("x",n,e,t),s,i)]}case"BatchToSpaceND":{const s=P("blockShape",n,e,t),i=P("crops",n,e,t);return[r.batchToSpaceND(P("x",n,e,t),s,i)]}case"DepthToSpace":{const s=P("blockSize",n,e,t),i=P("dataFormat",n,e,t).toUpperCase();return[r.depthToSpace(P("x",n,e,t),s,i)]}case"BroadcastTo":return[r.broadcastTo(P("x",n,e,t),P("shape",n,e,t))];case"BroadcastArgs":return[r.broadcastArgs(P("s0",n,e,t),P("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TO(n,e,t,r,s=ae){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return s(()=>Fue(o,a,l));case"basic_math":return s(()=>Lue(o,a,l));case"control":return Wue(o,a,l);case"convolution":return s(()=>jue(o,a,l));case"creation":return s(()=>Gue(o,a,l));case"dynamic":return Hue(o,a,l);case"evaluation":return s(()=>que(o,a,l));case"image":return s(()=>Yue(o,a,l));case"graph":return s(()=>Kue(o,a,l));case"logical":return s(()=>Jue(o,a,l));case"matrices":return s(()=>Zue(o,a,l));case"normalization":return s(()=>ece(o,a,l));case"ragged":return s(()=>tce(o,a,l));case"reduction":return s(()=>nce(o,a,l));case"slice_join":return s(()=>rce(o,a,l));case"sparse":return s(()=>sce(o,a,l));case"spectral":return s(()=>ice(o,a,l));case"string":return s(()=>oce(o,a,l));case"transformation":return s(()=>ace(o,a,l));case"hash_table":return Que(o,a,l,r);case"custom":const u=cB(o.op);if(u&&u.customExecutor)return u.customExecutor(new Pue(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return xa(i)?i.then(o=>[].concat(o)):[].concat(i)}class _O{constructor(e={},t={},r={},s={},i){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=r,this.functionMap=s,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const r=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CO(n,e,t,r){const s=new Set,i=[];let o=null,a=null;const l=new Set,u=new Set(Object.keys(n).map(p=>bs(p)[0]));r=r||[];const h=new Set(r.map(p=>bs(p.name)[0])),d=[...e];for(;d.length>0;){const p=d.pop();if((Wu(p)||mce(p)||gce(p))&&o==null&&(o=p,a=o.children.map(m=>m.name).filter(m=>s.has(m))),s.add(p.name),t[p.name]==null&&!u.has(p.name)&&!h.has(p.name)){if(p.inputs.length===0){i.push(p.name);continue}p.inputs.forEach(m=>{l.has(m.name)||(l.add(m.name),d.push(m))})}}return{inputs:n,outputs:e,usedNodes:s,missingInputs:i,dynamicNode:o,syncInputs:a}}function lce(n,e){const{usedNodes:t,inputs:r}=e,s=Object.keys(r).map(w=>bs(w)[0]).map(w=>n.nodes[w]),i=n.initNodes||[],o=w=>t.has(typeof w=="string"?w:w.name);function a(w){return[...new Map(w.map(b=>[b.name,b])).values()]}const l=a([...s,...n.weights,...i]).filter(o),u=a([...l,...Object.values(n.nodes)]).filter(o),h=new Map(u.map(w=>[w.name,w])),d={};for(const w of u){d[w.name]=d[w.name]||0;for(const b of w.children)o(b)||(d[b.name]=Number.POSITIVE_INFINITY),d[b.name]=(d[b.name]||0)+1}const p=Object.entries(d).filter(([,w])=>w===0).map(([w])=>w),m=[...p];for(;p.length>0;){const w=p.pop(),b=h.get(w);for(const S of b.children.filter(o))--d[S.name]===0&&(m.push(S.name),p.push(S.name))}const y=m.map(w=>h.get(w)),v=uce(y,l);return cce(v,l),v}function uce(n,e){const t=new Map(n.map(o=>[o.name,o])),r=e.map(o=>o.name),s=new Set(r);for(;r.length>0;){const o=r.pop(),a=t.get(o);for(const l of a.children)!t.has(l.name)||s.has(l.name)||(s.add(l.name),r.push(l.name))}return n.filter(o=>s.has(o.name))}class dw extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function cce(n,e){const t=new Map(n.map((a,l)=>[a.name,l])),r=new Set(e.map(a=>a.name)),s=a=>r.has(typeof a=="string"?a:a.name),i=new Set(n.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of n){for(const l of a.children.filter(o)){if(!t.has(l.name))throw new dw(`Child ${l.name} of node ${a.name} is unreachable.`);if(t.get(a.name)>t.get(l.name))throw new dw(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!s(a))for(const l of a.inputs){if(!t.has(l.name))throw new dw(`Input ${l.name} of node ${a.name} is unreachable.`);if(t.get(l.name)>t.get(a.name))throw new dw(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function hce(n){const e=new Map(n.map((a,l)=>[a.name,l])),t=Number.MAX_SAFE_INTEGER,r=n.map((a,l)=>Wu(a)?t:l),s=a=>{const l=r[e.get(a.name)];return l??-1},i=n.map((a,l)=>a.children.map(s).reduce((u,h)=>Math.max(u,h),r[l])),o=new Map;for(let a=0;a<n.length;++a){const l=i[a];if(l===t)continue;const u=n[a],h=n[l];o.has(h.name)||o.set(h.name,[]),o.get(h.name).push(u)}return o}const dce=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),fce=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),pce=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Wu(n){return dce.has(n.op)}function mce(n){return fce.has(n.op)}function gce(n){return pce.has(n.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qv{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(r=>e[r].map(s=>s.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(r=>{this._functionExecutorMap[r]=new qv(e.functions[r],this)})}getCompilationKey(e,t){const r=e.map(i=>i.name).sort(),s=t.map(i=>i.name).sort();return r.join(this.SEPARATOR)+"--"+s.join(this.SEPARATOR)}compile(e,t){const r=CO(e,t,this.weightMap,this._initNodes),{missingInputs:s,dynamicNode:i,syncInputs:o}=r;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(s.length>0){const u=t.map(d=>d.name),h=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${h}]. Missing the following inputs: [${s}]`)}const a=lce(this.graph,r),l=hce(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const t=e.clone();return Fn(t),t}cloneTensorList(e){return e?e.map(r=>this.cloneAndKeepTensor(r)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,r])=>[t,this.cloneTensorList(r)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const s=r.map(p=>this.graph.nodes[bs(p)[0]]),i=t.map(p=>bs(p)[0]),o=new Set(i);let a=i.map(p=>this.graph.nodes[p]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(s,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=le().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const h={},d={};return ae(()=>{const p=new _O(this.weightMap,h,d,this.functionExecutorMap,this.parseNodeNameCache),m=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(b=>{const[S,C]=bs(b,p),T=[];T[C]=e[b],m[S]=T,this.keepIntermediateTensors&&(this.clonedTensorsMap[S]=this.cloneTensorList(T))});const y=this.getFrozenTensorIds(m),{orderedNodes:v,nodeLiveUntilMap:w}=u;for(const b of v){if(m[b.name])continue;const S=TO(b,m,p,this._resourceManager);if(xa(S))throw new Error(`The execution of the op '${b.op}' returned a promise. Please use model.executeAsync() instead.`);m[b.name]=S,this.keepIntermediateTensors&&(this.clonedTensorsMap[b.name]=this.cloneTensorList(S)),this.checkTensorForDisposalWithNodeLiveUntilInfo(b,m,p,y,o,w.get(b.name))}return this.parent==null&&p.dispose(y),t.map(b=>fr(b,m,p))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(r=>e[r]).map(r=>r.map(s=>s.id)));return new Set(t)}checkTensorForDisposal(e,t,r,s,i,o,a){if(!(Wu(t)||o.has(e))){for(const l of r[e])l!=null&&(a[l.id]=(a[l.id]||0)+t.children.length);for(const l of t.inputs){if(Wu(l))continue;const u=vO(l.name,r,s);if(u!=null)for(const h of u){if(!h||h.kept||i.has(h.id))continue;const d=a[h.id];d===1?(h.dispose(),delete a[h.id]):d!=null&&a[h.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,r,s,i,o){function a(l){return Wu(l)||i.has(l.name)}if(!(Wu(e)||o==null))for(const l of o){if(a(l))continue;const u=vO(l.name,t,r);for(const h of u)!h||h.kept||s.has(h.id)||h.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,r=!1,s={},i={}){this.disposeIntermediateTensors(),r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=le().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const o=new _O(this.weightMap,s,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,t,r),l=t.map(p=>fr(p,a,o)),u=l.map(p=>p.id),h=Object.keys(e).map(p=>e[p].id),d=new Set([...u,...h,...this.weightIds]);return Object.values(a).forEach(p=>{p.forEach(m=>{m&&!m.isDisposed&&!d.has(m.id)&&m.dispose()})}),this.parent==null&&o.dispose(d),l}async executeFunctionAsync(e,t,r){const s=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(s,this.outputNodes,!0,t,r)}async executeWithControlFlow(e,t,r,s){const i=Object.keys(e),o=i.map(T=>this.graph.nodes[bs(T)[0]]),a=r.map(T=>bs(T)[0]),l=new Set(a);let u=a.map(T=>this.graph.nodes[T]);u.length===0&&(u=this._outputs);const{usedNodes:h,missingInputs:d,dynamicNode:p,syncInputs:m}=CO(e,u,this.weightMap,this._initNodes),y=[...o,...this.graph.weights,...this._initNodes||[]].map(T=>({node:T,contexts:t.currentContext})),v=Object.assign({},this.weightMap);Object.keys(e).forEach(T=>{const[O,V]=bs(T),k=[];k[V]=e[T],v[O]=k});const w={},b=this.getFrozenTensorIds(v),S={};for(;y.length>0;){const T=this.processStack(o,y,t,v,S,b,l,w,h);await Promise.all(T)}p==null&&!s&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const C=u.filter(T=>!Wu(T)&&!fr(T.name,v,t)).map(T=>T.name);if(C.length>0){let T="";throw p!=null&&(T=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${m}]`),new Error(`Cannot compute the outputs [${C}] from the provided inputs [${i}]. Consider providing the following inputs: [${d}]. ${T}`)}return v}processStack(e,t,r,s,i,o,a,l,u){const h=[];for(;t.length>0;){const d=t.pop();r.currentContext=d.contexts;let p="";if(d.node.op==="Enter"&&P("isConstant",d.node,s,r)&&([p]=sa(d.node.name,r)),s[d.node.name]==null){const m=TO(d.node,s,r,this._resourceManager);p||([p]=sa(d.node.name,r));const y=r.currentContext;xa(m)?h.push(m.then(v=>(s[p]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(v)),r.currentContext=y,this.checkTensorForDisposal(p,d.node,s,r,o,a,l),this.processChildNodes(d.node,t,r,s,i,u),v))):(s[p]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(m)),this.checkTensorForDisposal(p,d.node,s,r,o,a,l),this.processChildNodes(d.node,t,r,s,i,u))}else this.processChildNodes(d.node,t,r,s,i,u)}return h}processChildNodes(e,t,r,s,i,o){e.children.forEach(a=>{const[l]=sa(a.name,r);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!fr(u,s,r))&&(i[l]=!0,t.push({contexts:r.currentContext,node:a})):a.inputNames.every(u=>!!fr(u,s,r))&&(i[l]=!0,t.push({contexts:r.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const r=e[t],[s]=bs(t),i=this.graph.nodes[s];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===r.shape.length&&r.shape.every((l,u)=>o[u]===-1||o[u]===l);B(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${r.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&B(r.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(e){var t,r;const s={};for(const i in e){const o=(r=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||r===void 0?void 0:r[i];o!=null?s[o.name]=e[i]:s[i]=e[i]}return s}checkInputs(e){const t=Object.keys(e).filter(r=>{const[s]=bs(r);return this.graph.nodes[s]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var r,s;const i=(s=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||s===void 0?void 0:s[t];return i!=null?i.name:t},{})}checkOutputs(e){e.forEach(t=>{const[r]=bs(t);if(!this.graph.nodes[r])throw new Error(`The output '${t}' is not found in the graph`)})}}class yce{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wce="?tfjs-format=file",vce="model.json";class a2{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},r=ik){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=r,t==null&&(this.loadOptions={}),this.resourceManager=new yce}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return xa(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const t=await BM(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const r=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(s=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=s,this.version=`${r.versions.producer}.${r.versions.minConsumer}`,this.executor=new qv(xO.Instance.transformGraph(r,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=xO.Instance.transformGraph(e.modelInitializer);this.initializer=new qv(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){const r=this.io.getSaveHandlers(e);if(r.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(r.length>1)throw new Error(`Found more than one (${r.length}) save handlers for URL '${e}'`);e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t=e instanceof Et?[e]:e,r={};return t.forEach((s,i)=>r[this.structuredOutputKeys[i]]=s),r}return e}predict(e,t){const r=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(r)}async predictAsync(e,t){const r=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(r)}normalizeInputs(e){var t;if(!(e instanceof Et)&&!Array.isArray(e)){const i=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const r=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+r!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-r} non-resource placeholders, while there are ${e.length} input tensors provided.`);let s=0;return this.inputNodes.reduce((i,o)=>{var a,l,u;const h=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||u===void 0?void 0:u.resourceId;return h!=null?i[o]=this.resourceIdToCapturedInput[h]:i[o]=e[s++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,r=Object.keys(t);for(let s=0;s<r.length;s++){const i=r[s],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[s]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const r=this.executor.execute(e,t);return r.length>1?r:r[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const r=await this.executor.executeAsync(e,t);return r.length>1?r:r[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,r)=>(t[r]=[e[r]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&ot(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function xce(n,e={},t=ik){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=Ice(n));const r=new a2(n,e,t);return await r.load(),r}function bce(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(n instanceof Array){const[r,s]=n;if(!r)throw new Error("modelJSON must be the first element of the array");if(!s||!(s instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");const i=Ov(r.weightsManifest),o=UC(r,i,s);e=Fv(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=Fv(n);else throw new Error("Unknown model format");const t=new a2(e);return t.load(),t}function Ice(n){return n.endsWith("/")||(n=n+"/"),`${n}${vce}${wce}`}/** @license See the LICENSE file. */const fB="4.22.0";var Uw={exports:{}},Sce=Uw.exports,EO;function Tce(){return EO||(EO=1,function(n){(function(e,t,r){function s(l){var u=this,h=a();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(l),u.s0<0&&(u.s0+=1),u.s1-=h(l),u.s1<0&&(u.s1+=1),u.s2-=h(l),u.s2<0&&(u.s2+=1),h=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var h=new s(l),d=u&&u.state,p=h.next;return p.int32=function(){return h.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,d&&(typeof d=="object"&&i(d,h),p.state=function(){return i(h,{})}),p}function a(){var l=4022871197,u=function(h){h=h.toString();for(var d=0;d<h.length;d++){l+=h.charCodeAt(d);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(Sce,n)}(Uw)),Uw.exports}var Ww={exports:{}},_ce=Ww.exports,kO;function Cce(){return kO||(kO=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xor128=o})(_ce,n)}(Ww)),Ww.exports}var jw={exports:{}},Ece=jw.exports,NO;function kce(){return NO||(NO=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,h==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xorwow=o})(Ece,n)}(jw)),jw.exports}var Gw={exports:{}},Nce=Gw.exports,$O;function $ce(){return $O||($O=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var h=l.x,d=l.i,p,m;return p=h[d],p^=p>>>7,m=p^p<<24,p=h[d+1&7],m^=p^p>>>10,p=h[d+3&7],m^=p^p>>>3,p=h[d+4&7],m^=p^p<<7,p=h[d+7&7],p=p^p<<13,m^=p^p<<9,h[d]=m,l.i=d+1&7,m};function u(h,d){var p,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,p=0;p<d.length;++p)m[p&7]=m[p&7]<<15^d.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&m[p]===0;++p);for(p==8?m[7]=-1:m[p],h.x=m,h.i=0,p=256;p>0;--p)h.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(h.x&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xorshift7=o})(Nce,n)}(Gw)),Gw.exports}var Hw={exports:{}},Rce=Hw.exports,RO;function Ace(){return RO||(RO=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var h=l.w,d=l.X,p=l.i,m,y;return l.w=h=h+1640531527|0,y=d[p+34&127],m=d[p=p+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,y=d[p]=y^m,l.i=p,y+(h^h>>>16)|0};function u(h,d){var p,m,y,v,w,b=[],S=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,S=Math.max(S,d.length)),y=0,v=-32;v<S;++v)d&&(m^=d.charCodeAt((v+32)%d.length)),v===0&&(w=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,v>=0&&(w=w+1640531527|0,p=b[v&127]^=m+w,y=p==0?y+1:0);for(y>=128&&(b[(d&&d.length||0)&127]=-1),y=127,v=4*128;v>0;--v)m=b[y+34&127],p=b[y=y+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,b[y]=m^p;h.w=w,h.X=b,h.i=y}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(h.X&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xor4096=o})(Rce,n)}(Hw)),Hw.exports}var qw={exports:{}},Dce=qw.exports,AO;function Oce(){return AO||(AO=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var d=l.b,p=l.c,m=l.d,y=l.a;return d=d<<25^d>>>7^p,p=p-m|0,m=m<<24^m>>>8^y,y=y-d|0,l.b=d=d<<20^d>>>12^p,l.c=p=p-m|0,l.d=m<<16^p>>>16^y,l.a=y-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var h=0;h<u.length+20;h++)l.b^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.tychei=o})(Dce,n)}(qw)),qw.exports}var sT={exports:{}},DO;function Pce(){return DO||(DO=1,function(n){(function(e,t){var r=(0,eval)("this"),s=256,i=6,o=52,a="random",l=t.pow(s,i),u=t.pow(2,o),h=u*2,d=s-1,p;function m(T,O,V){var k=[];O=O==!0?{entropy:!0}:O||{};var $=b(w(O.entropy?[T,C(e)]:T??S(),3),k),N=new y(k),R=function(){for(var E=N.g(i),L=l,F=0;E<u;)E=(E+F)*s,L*=s,F=N.g(1);for(;E>=h;)E/=2,L/=2,F>>>=1;return(E+F)/L};return R.int32=function(){return N.g(4)|0},R.quick=function(){return N.g(4)/4294967296},R.double=R,b(C(N.S),e),(O.pass||V||function(E,L,F,G){return G&&(G.S&&v(G,N),E.state=function(){return v(N,{})}),F?(t[a]=E,L):E})(R,$,"global"in O?O.global:this==t,O.state)}t["seed"+a]=m;function y(T){var O,V=T.length,k=this,$=0,N=k.i=k.j=0,R=k.S=[];for(V||(T=[V++]);$<s;)R[$]=$++;for($=0;$<s;$++)R[$]=R[N=d&N+T[$%V]+(O=R[$])],R[N]=O;(k.g=function(E){for(var L,F=0,G=k.i,Y=k.j,q=k.S;E--;)L=q[G=d&G+1],F=F*s+q[d&(q[G]=q[Y=d&Y+L])+(q[Y]=L)];return k.i=G,k.j=Y,F})(s)}function v(T,O){return O.i=T.i,O.j=T.j,O.S=T.S.slice(),O}function w(T,O){var V=[],k=typeof T,$;if(O&&k=="object")for($ in T)try{V.push(w(T[$],O-1))}catch{}return V.length?V:k=="string"?T:T+"\0"}function b(T,O){for(var V=T+"",k,$=0;$<V.length;)O[d&$]=d&(k^=O[d&$]*19)+V.charCodeAt($++);return C(O)}function S(){try{var T;return p&&(T=p.randomBytes)?T=T(s):(T=new Uint8Array(s),(r.crypto||r.msCrypto).getRandomValues(T)),C(T)}catch{var O=r.navigator,V=O&&O.plugins;return[+new Date,r,V,r.screen,C(e)]}}function C(T){return String.fromCharCode.apply(0,T)}if(b(t.random(),e),n.exports){n.exports=m;try{p=RE}catch{}}})([],Math)}(sT)),sT.exports}var iT,OO;function pB(){if(OO)return iT;OO=1;var n=Tce(),e=Cce(),t=kce(),r=$ce(),s=Ace(),i=Oce(),o=Pce();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=r,o.xor4096=s,o.tychei=i,iT=o,iT}var mB=pB();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Fce(n,e){return Kv(n,e)}function Kv(n,e,t=new Map,r=new Set){if(n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(r.has(n))throw new Error("Circular references are not supported.");if(t.has(n))return t.get(n);const s=e(n);if(s.recurse&&s.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(s.recurse)if(dd(n)){const i=Array.isArray(n)?[]:{};r.add(n);for(const o in n){const a=n[o],l=Kv(a,e,t,r);i[o]=l}return r.delete(n),n.__proto__&&(i.__proto__=n.__proto__),i}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return t.set(n,s.value),s.value}function Lce(n,e=yB){return gB(n,e)}function gB(n,e,t=new Set){const r=n[0];if(t.has(r))throw new Error("Circular references are not supported.");const s=e(n);if(s.recurse&&s.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(s.recurse)if(dd(r)){const i=Array.isArray(r)?[]:{};t.add(r);for(const o in r){const a=n.map(u=>u[o]),l=gB(a,e,t);i[o]=l}return t.delete(r),i}else throw new Error(`Can't recurse into non-iterable type: ${r}`);else return s.value}function yB(n){return n===null?null:dd(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}async function wB(n,e){const t=new Map;Kv(n,e,t);for(const s of Array.from(t.keys())){const i=t.get(s);if(xa(i)){const o=await i;t.set(s,o)}}return Kv(n,e,t)}function dd(n){let e=!1;if(le().get("IS_BROWSER"))e=n instanceof TextDecoder;else{const{StringDecoder:t}=require("string_decoder");e=n instanceof t}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof Et)&&!(n instanceof Promise)&&!e)}function Mce(n){return n==null||Vce(n)||Array.isArray(n)||typeof n=="object"&&n instanceof Et||Pn(n)}function Vce(n){return n===null||typeof n!="object"&&typeof n!="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function zce(n){return Fce(n,Bce)}function Bce(n){return n instanceof Et?{value:n.clone(),recurse:!1}:dd(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class vB{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),r=this.get(t);return this.set(t,this.pop()),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class H1 extends vB{constructor(){super(H1.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=this.capacity*2,t=new Array(e),r=this.length();for(let s=0;s<r;s++)t[s]=this.get(this.wrap(this.begin+s));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=r}}H1.INITIAL_CAPACITY=32;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function xB(n){return new jce(n)}function l2(n){return new Gce(n)}function Uce(n,e){return new bB(n,e)}function Wce(n,e=wl.FAIL){return new ehe(n,e)}class er{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let r=await e.next();for(;!r.done;)t.push(r.value),r=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),r=e(t.value);for(;!t.done&&r;)t=await this.next(),r=e(t.value)}handleErrors(e){return new Jce(this,e)}filter(e){return new Qce(this,e)}map(e){return new Yce(this,e)}mapAsync(e){return new PO(this,e)}serialMapAsync(e){return new PO(this,e).serial()}flatmap(e){return new Zce(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(t=>t===!0)}rowMajorBatch(e,t=!0){return new Xce(this,e,t)}columnMajorBatch(e,t=!0,r=yB){return this.rowMajorBatch(e,t).map(i=>Lce(i,r))}concatenate(e,t){return new bB(xB([this,e]),t)}take(e){return e<0||e==null?this:new Kce(this,e)}skip(e){return e<0||e==null?this:new qce(this,e)}prefetch(e){return new IB(this,e)}shuffle(e,t){return new the(this,e,t)}serial(){return new Hce(this)}}class jce extends er{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:zce(e),done:!1}}}class Gce extends er{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class Hce extends er{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class qce extends er{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;ot(e.value)}return this.upstream.next()}}class Kce extends er{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class Xce extends er{constructor(e,t,r=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=r,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class Qce extends er{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;ot(e.value)}}}class Yce extends er{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=Ia(e.value),r=this.transform(e.value),s=Ia(r);for(const i of t)Mb(i,s)||i.dispose();return{value:r,done:!1}}}class Jce extends er{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class PO extends er{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=Ia(e.value),r=await this.transform(e.value),s=Ia(r);for(const i of t)Mb(i,s)||i.dispose();return{value:r,done:!1}}}class u2 extends er{constructor(){super(),this.outputQueue=new H1,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Zce extends u2{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=Ia(e.value),r=this.transform(e.value),s=Ia(r);this.outputQueue.pushAll(r);for(const i of t)Mb(i,s)||i.dispose();return!0}}class bB extends er{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){const r=await this.moreIterators.next();if(r.done)return{value:null,done:!0};this.iterator=r.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var wl;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(wl||(wl={}));class ehe extends er{constructor(e,t=wl.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,r=0;function s(o){return o instanceof er?{value:o.next().then(l=>(t++,l.done&&r++,l.value)),recurse:!1}:{value:null,recurse:!0}}const i=await wB(this.iterators,s);if(t===r)return{value:null,done:!0};if(r>0)switch(this.mismatchMode){case wl.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case wl.SHORTEST:return{value:null,done:!0};case wl.LONGEST:}return this.count++,{value:i,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class IB extends er{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new vB(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class the extends IB{constructor(e,t,r){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=mB.alea(r||hr().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(t.done)this.upstreamExhausted=!0;else return this.refill(),t}return{value:null,done:!0}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Af{constructor(){this.size=null}batch(e,t=!0){const r=this;B(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let s;return this.size===1/0||this.size==null?s=this.size:t?s=Math.ceil(this.size/e):s=Math.floor(this.size/e),xs(async()=>(await r.iterator()).columnMajorBatch(e,t,she),s)}concatenate(e){const t=this;let r;return this.size===1/0||e.size===1/0?r=1/0:this.size!=null&&e.size!=null?r=this.size+e.size:r=null,xs(async()=>(await t.iterator()).concatenate(await e.iterator()),r)}filter(e){const t=this;let r;return this.size===1/0?r=1/0:r=null,xs(async()=>(await t.iterator()).filter(s=>ae(()=>e(s))),r)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return xs(async()=>(await t.iterator()).map(r=>ae(()=>e(r))),this.size)}mapAsync(e){const t=this;return xs(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return xs(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let r;return this.size!=null&&e>0?r=this.size*e:e===0?r=0:this.size!=null&&(e===void 0||e<0)?r=1/0:r=null,xs(async()=>{const s=l2(async()=>({value:await t.iterator(),done:!1}));return Uce(s.take(e))},r)}skip(e){const t=this;let r;return this.size!=null&&e>=0&&this.size>=e?r=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?r=0:r=null,xs(async()=>(await t.iterator()).skip(e),r)}shuffle(e,t,r=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const s=this,i=mB.alea(t||hr().toString());return xs(async()=>{let o=i.int32();return r&&(o+=i.int32()),(await s.iterator()).shuffle(e,o.toString())},this.size)}take(e){const t=this;let r;return this.size!=null&&this.size>e?r=e:this.size!=null&&this.size<=e?r=this.size:r=null,xs(async()=>(await t.iterator()).take(e),r)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}Af.MAX_BUFFER_SIZE=1e4;function xs(n,e=null){return new class extends Af{constructor(){super(...arguments),this.size=e}async iterator(){return n()}}}function nhe(n){return xs(async()=>xB(n),n.length)}function rhe(n){if(!dd(n))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(n))for(let t=0;t<n.length;t++)e=e==null?n[t].size:Math.min(e,n[t].size);else if(n instanceof Object)for(const t in n)e=e==null?n[t].size:Math.min(e,n[t].size);return xs(async()=>{const t=await wB(n,r=>{if(r instanceof Af)return{value:r.iterator(),recurse:!1};if(dd(r))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return Wce(t,wl.SHORTEST)},e)}function she(n){if(n===null)return null;const e=n[0];return Mce(e)?{value:ihe(n),recurse:!1}:{value:null,recurse:!0}}function ihe(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof Et?jr(n):Cs(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class SB extends Af{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(s=>(s.endsWith("\r")&&(s=s.slice(0,-1)),s))}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */const fw='"',Pp=Symbol("out"),FO=Symbol("field"),pw=Symbol("quote"),oT=Symbol("quoteafterquote"),LO=Symbol("quoteinquote");class TB extends Af{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&B(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const t=this.fullColumnNames.reduce((s,i)=>(s[i]=s[i]+1||1,s),{}),r=Object.keys(t).filter(s=>t[s]>1);if(B(r.length===0,()=>"Duplicate column names found: "+r.toString()),this.columnConfigs){for(const s of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(s)===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const t=await(await this.base.iterator()).next();if(t.done)throw new Error("No data was found for CSV parsing.");const r=t.value;return this.parseRow(r,!1)}else return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new SB(e),t||(t={}),this.hasHeader=t.hasHeader!==!1,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(B(t.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(t=>this.makeDataElement(t))}makeDataElement(e){const t=this.parseRow(e),r={},s={};for(let i=0;i<this.fullColumnNames.length;i++){const o=this.fullColumnNames[i],a=this.columnConfigs?this.columnConfigs[o]:null;if(!(this.configuredColumnsOnly&&!a)){const l=t[i];let u=null;if(l==="")if(a&&a.default!==void 0)u=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${o} is empty in this line: ${e}`);u=void 0}else{const h=Number(l);if(isNaN(h))a&&a.dtype==="bool"?u=this.getBoolean(l):u=l;else if(!a||!a.dtype)u=h;else switch(a.dtype){case"float32":u=h;break;case"int32":u=Math.floor(h);break;case"bool":u=this.getBoolean(l);break;default:u=h}}a&&a.isLabel?s[o]=u:r[o]=u}}return Object.keys(s).length===0?r:{xs:r,ys:s}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,t=!0){const r=[];let s=0;const i=e.length;let o=Pp;for(let a=0;a<i;a++)switch(o){case Pp:switch(e.charAt(a)){case fw:s=a+1,o=pw;break;case this.delimiter:if(s=a+1,this.delimiter===" "&&this.delimWhitespace)break;r.push(""),o=Pp;break;default:o=FO,s=a;break}break;case FO:switch(e.charAt(a)){case this.delimiter:r.push(e.substring(s,a)),o=Pp,s=a+1;break}break;case pw:switch(e.charAt(a)){case fw:o=oT;break}break;case oT:switch(e.charAt(a)){case this.delimiter:r.push(e.substring(s,a-1)),o=Pp,s=a+1;break;case fw:o=pw;break;default:o=LO;break}break;case LO:switch(e.charAt(a)){case fw:o=pw;break}break}if(o===oT?r.push(e.substring(s,i-1)):r.push(e.substring(s)),t&&r.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${r}`);return r}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class c2 extends er{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const t=Math.log2(this.fftSize);if(this.fftSize<0||t<4||t>14||!Number.isInteger(t))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=e.includeSpectrogram!==!1,this.includeWaveform=e.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(!le().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const t=new c2(e);return await t.start(),t}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(r){throw new Error(`Error thrown while initializing video stream: ${r.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,t.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,t;const r=await this.getAudioData();if(this.includeSpectrogram){const s=this.flattenQueue(r.freqDataQueue);e=this.getTensorFromAudioDataArray(s,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const s=this.flattenQueue(r.timeDataQueue);t=this.getTensorFromAudioDataArray(s,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:t},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],t=[];let r=0;return new Promise(s=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&s({freqDataQueue:e,timeDataQueue:t}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),t.push(this.timeData.slice())),++r===this.numFrames&&(clearInterval(i),s({freqDataQueue:e,timeDataQueue:t}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const t=e[0].length,r=new Float32Array(e.length*t);return e.forEach((s,i)=>r.set(s,i*t)),r}getTensorFromAudioDataArray(e,t){const r=new Float32Array(fe(t));return r.set(e,r.length-e.length),Cs(r,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class h2 extends er{constructor(e,t){if(super(),this.webcamVideoElement=e,this.webcamConfig=t,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=mr([0],"int32"),this.webcamConfig.centerCrop){const r=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,s=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,i=(1-r)/2,o=(1-s)/2,a=i+r,l=s+o;this.cropBox=Cl([o,i,l,a],[1,4])}else this.cropBox=Cl([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,t={}){if(!le().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!t.resizeWidth||!t.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=t.resizeWidth,e.height=t.resizeHeight}const r=new h2(e,t);return await r.start(),r}async start(){this.webcamConfig.facingMode&&B(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message=`Error thrown while initializing video stream: ${e.message}`,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=d3(this.webcamVideoElement)}catch(t){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(t)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(t){throw new Error(`Error thrown cropping the video: ${t.message}`)}finally{e.dispose()}else return{value:e,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(e){return ae(()=>{const t=dr(Re(e,"float32"),0);let r;r=di.cropAndResize(t,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const s=r.shape;return ee(r,s.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class _B{}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class CB extends er{split(e){return new ohe(this,e)}}class ohe extends CB{constructor(e,t){super(),this.upstream=e,this.impl=new ahe(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class ahe extends u2{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);const t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(const r of t.slice(0,-1))this.outputQueue.push(r);return this.carryover=t[t.length-1],!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class lhe extends er{decodeUTF8(){return new uhe(this)}}class uhe extends CB{constructor(e){super(),this.upstream=e,this.impl=new che(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class che extends u2{constructor(e){if(super(),this.upstream=e,le().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:t}=require("string_decoder");this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const e=await this.upstream.next();let t;if(e.done)return!1;t=e.value;let r;return le().get("IS_BROWSER")?r=this.decoder.decode(t,{stream:!0}):r=this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(r),!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class EB extends lhe{constructor(e,t={}){super(),this.file=e,this.options=t,B(e instanceof Uint8Array||(le().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((t,r)=>{const s=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)t(new Uint8Array(this.file.slice(this.offset,s)));else{const i=new FileReader;i.onload=a=>{let l=i.result;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),!(l instanceof Uint8Array))return r(new TypeError("FileReader returned unknown type."));t(l)},i.onabort=a=>r(new Error("Aborted")),i.onerror=a=>r(new Error(a.type));const o=this.file.slice(this.offset,s);i.readAsArrayBuffer(o)}this.offset=s}),done:!1}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */async function hhe(n,e={},t){let r,s;typeof n=="string"?r=n:(r=n.url,s=dhe(n));const i=await RM(r,s);if(i.ok){const o=new Uint8Array(await i.arrayBuffer());return new EB(o,e)}else throw new Error(i.statusText)}const dhe=n=>({method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function kB(n){return typeof n=="string"&&n.slice(0,7)==="file://"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class NB extends _B{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(kB(this.input)&&le().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new EB(this.input,this.options)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class $B extends _B{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return kB(this.url)?new NB(this.url,this.fileOptions).iterator():hhe(this.url,this.fileOptions)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function fhe(n,e={}){return new TB(new $B(n),e)}function phe(n){const e=l2(n);return xs(async()=>e)}function mhe(n){return xs(async()=>{const e=await n();return l2(()=>e.next())})}async function ghe(n,e){return h2.create(n,e)}async function yhe(n){return c2.create(n)}/** @license See the LICENSE file. */const RB="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const whe=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:TB,Dataset:Af,FileDataSource:NB,TextLineDataset:SB,URLDataSource:$B,array:nhe,csv:fhe,func:phe,generator:mhe,microphone:yhe,version_data:RB,webcam:ghe,zip:rhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ue(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&B(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vhe=h1;class $y extends kx{nextDataId(){return $y.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new EC(this,Vi())}write(e,t,r){this.firstUse&&(this.firstUse=!1,le().get("IS_NODE")&&Bs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&vo(r[0])){const i=r.map(o=>Eo(o));s=this.write(i,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,i){this.data.set(e,{values:t,dtype:s,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return _a(s,i)}return vM(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>ba(s));return ht(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ht(e.shape,e.dtype,t)}makeOutput(e,t,r){return Vi().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=hr();return e(),{kernelMs:hr()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ue([e],"where");const t=this.readSync(e.dataId);return vhe(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}$y.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const xhe=n=>{const{x:e}=n.inputs,t=n.backend;Ue(e,"abs");let r=new Float32Array(fe(e.shape));const s=t.data.get(e.dataId).values;return r=AB(s),t.makeOutput(r,e.shape,e.dtype)},bhe={kernelName:Xm,backendName:"cpu",kernelFunc:xhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sn(n){return(e,t,r,s,i)=>{const o=at(e,t),a=o.length,l=Qe(o),u=fe(o),h=Jn(i,u),d=e.length,p=t.length,m=Qe(e),y=Qe(t),v=dc(e,o),w=dc(t,o);if(v.length+w.length===0)for(let b=0;b<h.length;++b)h[b]=n(r[b%r.length],s[b%s.length]);else for(let b=0;b<h.length;++b){const S=$c(b,a,l),C=S.slice(-d);v.forEach(k=>C[k]=0);const T=Wi(C,d,m),O=S.slice(-p);w.forEach(k=>O[k]=0);const V=Wi(O,p,y);h[b]=n(r[T],s[V])}return[h,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,a=t.makeTensorInfo(r.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(s.shape,"float32",o)},a}const Ihe={kernelName:Lx,backendName:"cpu",kernelFunc:Ts};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xv(n,e,t="float32"){if(t==="complex64"){const s=Xv(n,e,"float32"),i=Xv(n,e,"float32");return Ts({inputs:{real:s,imag:i},backend:n})}const r=gr(fe(e),t);return n.makeTensorInfo(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mo(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const She={kernelName:jd,backendName:"cpu",kernelFunc:Mo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vc(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const The={kernelName:gb,backendName:"cpu",kernelFunc:vc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n,e,t,r){if(r==="int32"){const s=Int32Array.from(n);return[e,"int32",s]}if(r==="bool"){const s=Ql([0],t),[i,o]=Sn((a,l)=>a!==l?1:0)(e,[],n,s,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function Gl(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return Mo({inputs:{x:s},backend:t});const h=Xv(t,s.shape,s.dtype),d=Gl({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),p=Ts({inputs:{real:d,imag:h},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),p}if(s.dtype==="complex64"){const h=vc({inputs:{input:s},backend:t}),d=Gl({inputs:{x:h},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(h),d}if(!$C(s.dtype,i)){const h=Mo({inputs:{x:s},backend:t});return{dataId:h.dataId,shape:h.shape,dtype:i}}const o=t.data.get(s.dataId).values,[a,l,u]=DB(o,s.shape,s.dtype,i);return t.makeTensorInfo(a,l,u)}const _he={kernelName:Rd,backendName:"cpu",kernelFunc:Gl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(n,e,t,r){return t==null?({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;Ue([o,a],n);const u=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,d=o.dtype==="string"?Ca(u):u,p=o.dtype==="string"?Ca(h):h,m=r||o.dtype,[y,v]=e(o.shape,a.shape,d,p,m);return l.makeTensorInfo(v,m,y)}:({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Gl({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,m=l.data.get(d.dataId).values,y=l.data.get(p.dataId).values,v=Gl({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),w=l.data.get(v.dataId),b=w.complexTensorInfos.real,S=w.complexTensorInfos.imag,C=l.data.get(b.dataId).values,T=l.data.get(S.dataId).values,[O,V,k]=t(o.shape,a.shape,m,y,C,T),$=l.makeTensorInfo(k,"float32",O),N=l.makeTensorInfo(k,"float32",V),R=Ts({inputs:{real:$,imag:N},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo($),l.disposeIntermediateTensorInfo(N),R}else{const u=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,d=r||o.dtype,[p,m]=e(o.shape,a.shape,u,h,d);return l.makeTensorInfo(m,d,p)}}}function d2(n){return(e,t,r,s,i,o)=>{const a=at(e,t),l=fe(a),u=a.length,h=Qe(a),d=Jn("float32",l),p=Jn("float32",l),m=dc(e,a),y=dc(t,a),v=_a(r,s),w=_a(i,o),b=e.length,S=Qe(e),C=t.length,T=Qe(t);if(m.length+y.length===0)for(let O=0;O<d.length;O++){const V=O%v.length,k=O%w.length,$=n(v[V*2],v[V*2+1],w[k*2],w[k*2+1]);d[O]=$.real,p[O]=$.imag}else for(let O=0;O<d.length;O++){const V=$c(O,u,h),k=V.slice(-b);m.forEach(L=>k[L]=0);const $=Wi(k,b,S),N=V.slice(-C);y.forEach(L=>N[L]=0);const R=Wi(N,C,T),E=n(v[$*2],v[$*2+1],w[R*2],w[R*2+1]);d[O]=E.real,p[O]=E.imag}return[d,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OB=Sn((n,e)=>n+e),Che=d2((n,e,t,r)=>({real:n+t,imag:e+r})),fd=zn(Rc,OB,Che),Ehe={kernelName:Rc,backendName:"cpu",kernelFunc:fd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2(n,e,t,r,s){const i=fe(r),o=gr(s,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=s||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function PB(n,e,t,r=!1){const s=n.shape[0],i=n.shape[1],o=ht([s,t],e.dtype);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(r?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FB=Sn((n,e)=>n&e),khe=zn(rg,FB),Nhe={kernelName:rg,backendName:"cpu",kernelFunc:khe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bo(n){return(e,t,r)=>{const s=mn(t,e.length);for(let i=0;i<e.length;++i)s[i]=n(e[i],r);return s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zt(n,e,t){const r=Bo(e);return su(n,r,t)}function su(n,e,t){return({inputs:r,attrs:s,backend:i})=>{const{x:o}=r;Ue(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Ca(l)}else u=l;const h=t||o.dtype,d=e(u,h,s);return a.makeTensorInfo(o.shape,h,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LB=Bo(n=>Math.ceil(n)),$he=su(Ad,LB),Rhe={kernelName:Ad,backendName:"cpu",kernelFunc:$he};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n,e,t,r){const s=mn(t,fe(e));if(r&&t!=="string"){let i=0;n.forEach(o=>{const a=fe(o.shape);s.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?Ca(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const h=u*e[1]+i;for(let d=0;d<o.shape[1];++d)s[h+d]=a[l++]}i+=o.shape[1]})}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VB=Sn((n,e)=>n===e?1:0),zB=zn(dg,VB,null,"bool"),Ahe={kernelName:dg,backendName:"cpu",kernelFunc:zB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BB=Bo(n=>Math.exp(n)),UB=su(Vd,BB,"float32"),Dhe={kernelName:Vd,backendName:"cpu",kernelFunc:UB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WB=Bo(n=>Math.expm1(n)),Ohe=su(zd,WB),Phe={kernelName:zd,backendName:"cpu",kernelFunc:Ohe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jB=Bo(n=>Math.floor(n)),Fhe=su(Bd,jB),Lhe={kernelName:Bd,backendName:"cpu",kernelFunc:Fhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GB=Sn((n,e)=>Math.floor(n/e)),Mhe=zn(Ud,GB,null,"int32"),Vhe={kernelName:Ud,backendName:"cpu",kernelFunc:Mhe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e,t,r,s,i,o,a,l){const u=ht([r,i],t);for(let h=0;h<r;h++){const d=[];let p=0;for(let m=0;m<s;m++){const y=n[h*s+m];p+=y*o[m],d.push(y)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let m=0;m<i;m++)u.values[h*i+m]=e.get(...e.indexToLoc(p*i+m))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n,e,t){const r=ht(t,n.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const h=n.locToIndex(o);0<=h&&h<n.values.length&&(r.values[s]=n.values[h])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KB=Sn((n,e)=>n>e?1:0),zhe=zn(gg,KB,null,"bool"),Bhe={kernelName:gg,backendName:"cpu",kernelFunc:zhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XB=Sn((n,e)=>n>=e?1:0),Uhe=zn(Wd,XB,null,"bool"),Whe={kernelName:Wd,backendName:"cpu",kernelFunc:Uhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QB=Sn((n,e)=>n<e?1:0),jhe=zn(wg,QB,null,"bool"),Ghe={kernelName:wg,backendName:"cpu",kernelFunc:jhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YB=Sn((n,e)=>n<=e?1:0),Hhe=zn(vg,YB,null,"bool"),qhe={kernelName:vg,backendName:"cpu",kernelFunc:Hhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e,t){const r=(e-n)/(t-1),s=gr(t,"float32");s[0]=n;for(let i=1;i<s.length;i++)s[i]=s[i-1]+r;return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZB=Bo(n=>Math.log(n)),Khe=su(Kd,ZB),Xhe={kernelName:Kd,backendName:"cpu",kernelFunc:Khe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e4(n,e,t,r){const s=Jn(r,fe(t));for(let i=0;i<s.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}s[i]=a}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t4=Sn((n,e)=>Math.max(n,e)),Qhe=zn(Qd,t4),Yhe={kernelName:Qd,backendName:"cpu",kernelFunc:Qhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n4=Sn((n,e)=>Math.min(n,e)),Jhe=zn(Yd,n4),Zhe={kernelName:Yd,backendName:"cpu",kernelFunc:Jhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p2=Sn((n,e)=>n*e),ede=d2((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t})),q1=zn(Zd,p2,ede),tde={kernelName:Zd,backendName:"cpu",kernelFunc:q1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r4(n,e,t){const r=Ra(-1,t);return p2([],e,r,n,t)}function nde(n){const{inputs:e,backend:t}=n,{x:r}=e;Ue(r,"neg");const s=t.data.get(r.dataId).values,[i,o]=r4(s,r.shape,r.dtype);return t.makeTensorInfo(o,r.dtype,i)}const rde={kernelName:$g,backendName:"cpu",kernelFunc:nde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s4=Sn((n,e)=>n!==e?1:0),sde=zn(Rg,s4,null,"bool"),ide={kernelName:Rg,backendName:"cpu",kernelFunc:sde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m2(n,e,t,r,s){const i=e.length,o=fe(e),a=Qe(e),l=Qe(s),u=Jn(t,fe(s));for(let h=0;h<o;++h){const d=$c(h,i,a),p=new Array(d.length);for(let y=0;y<p.length;y++)p[y]=d[r[y]];const m=Wi(p,i,l);u[m]=n[h]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(n){const{inputs:e,attrs:t,backend:r}=n,{x:s}=e,{perm:i}=t;Ue(s,"transpose");const o=s.shape.length,a=new Array(o);for(let d=0;d<a.length;d++)a[d]=s.shape[i[d]];const l=r.data.get(s.dataId).values,u=m2(l,s.shape,s.dtype,i,a);return{dataId:r.write(u,a,s.dtype),shape:a,dtype:s.dtype}}const ode={kernelName:Ju,backendName:"cpu",kernelFunc:ls};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i4(n,e,t,r){const[s,i]=nr(n,r),o=rs(e,"int32"),a=gr(fe(s),o),l=fe(i);for(let u=0;u<a.length;++u){const h=u*l;let d=1;for(let p=0;p<l;++p)d*=t[h+p];a[u]=d}return{outVals:a,outShape:s,outDtype:o}}function ade(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ue(s,"prod");const a=s.shape.length,l=ft(i,s.shape),u=dn(l,a);let h=l,d=s;const p=[];u!=null&&(d=ls({inputs:{x:s},backend:t,attrs:{perm:u}}),p.push(d),h=bn(h.length,a));const m=t.data.get(d.dataId).values,{outVals:y,outShape:v,outDtype:w}=i4(d.shape,d.dtype,m,h);let b=v;return o&&(b=xn(v,l)),p.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(b,w,y)}const lde={kernelName:Lg,backendName:"cpu",kernelFunc:ade};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ude(n,e,t){n.forEach((r,s)=>{if(r<0||r>=t){const i=$c(s,e.length,Qe(e)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${t})`)}})}function cde(n,e){for(let t=0;t<n.length;++t){const r=n[t],s=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function hde(n,e,t,r){const s=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);cde(t,r);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const h=e[u+1];for(let d=1;d<l+1;++d)a[u].push(d*h)}for(let u=0;u<n.length;++u){let h=n[u],d=n[u]+1;for(let p=0;p<t.length;++p){const m=t[p],y=p+e.length-1;if(y>=0){const v=a[y],w=v[v.length-1]-m[h];for(let b=h;b<d;++b)a[y].push(m[b+1]+w)}h=m[h],d=m[d]}d!==h&&(s.push([h,d]),i+=d-h)}return{outSplits:a,valueSlices:s,numValues:i}}function dde(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,s=mn("int32",r);e.push(s),n[t].forEach((i,o)=>s[o]=i)}return e}function MO(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function fde(n,e,t,r,s,i){const o=MO(e,2)[1],a=MO(i,2)[1];let l=0;for(const u of t)for(let h=u[0];h<u[1];++h){for(let d=0;d<r;++d)s[l*a+d]=n[h*o+d];++l}}function pde(n,e,t,r,s){const i=e.slice();i[0]=s;const o=mn(t,fe(i)),a=n.length,l=a===0?0:a/e[0];return fde(n,e,r,l,o,i),[o,i]}function o4(n,e,t,r,s,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(ude(i,o,l),r.length===0)throw new Error("params.rank must be nonzero");const u=r[0],{outSplits:h,valueSlices:d,numValues:p}=hde(i,o,n,u),m=dde(h),y=pde(t,r,s,d,p);return[m,y[0],y[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VO=2147483647;function a4(n,e,t,r,s,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=s.length===0,u=o.length===0,h=[];a||h.push(e[0]),l||h.push(s[0]),u||h.push(o[0]);for(let w=1;w<h.length;++w)if(h[w]!==h[w-1])throw new Error("starts, limits, and deltas must have the same shape");const d=h.length===0?1:h[0],p=mn("int32",d+1);p[0]=0;for(let w=0;w<d;++w){const b=a?n[0]:n[w],S=l?r[0]:r[w],C=u?i[0]:i[w];if(C===0)throw new Error("Requires delta != 0");let T;if(C>0&&S<b||C<0&&S>b)T=0;else if(T=Math.ceil(Math.abs((S-b)/C)),T>VO)throw new Error(`Requires ((limit - start) / delta) <= ${VO}`);p[w+1]=p[w]+T}const m=p[d],y=mn(t,m);let v=0;for(let w=0;w<d;++w){const b=p[w+1]-p[w];let S=a?n[0]:n[w];const C=u?i[0]:i[w];for(let T=0;T<b;++T)y[v++]=S,S+=C}return[p,y]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ci=Bi;class Qv{constructor(e,t,r,s,i,o,a,l,u,h){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=_3(h),this.raggedRank=C3(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ci.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ci.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ci.VALUE_ROWIDS:return Qv.getMaxWidthValueRowID(t);case ci.ROW_SPLITS:return Qv.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${ci[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const i=e[s+1]-e[s];i>r&&(r=i)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==s&&(s=a,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return BO(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;E3(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=T3(this.raggedRank,s,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),i=[];let o=0;for(let a=0;a<s;++a,o+=t)i.push(o);for(let a=s;a<e;++a)i.push(-1);return B(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,r,s){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(s,l),h=t[a];h===-1&&(u=0);for(let d=0;d<u;++d)o.push(h),h+=r;for(let d=0;d<l-u;++d)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,r,s){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let h=1;h<i;++h){const d=e[h];if(d===l)u>=0&&(++a,a<s?u+=r:u=-1);else{if(a=0,l=d,d>=t.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${t.length}`);u=t[d]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,r,s){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ci.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,s);case ci.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,r,s);default:throw new Error(`Unsupported partition type: ${ci[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case ci.FIRST_DIM_SIZE:return e[0];case ci.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ci.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ci[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let l=s.length-2;l>=0;--l)s[l]=s[l+1]*r[l+1];const i=BO(r,!1),o=mn(this.valuesDType,fe(i));if(s[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(t,s[0],r[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,s[u],r[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,r,s){if(r.length===0)return;const i=this.values,o=r;let a=s.slice();a=a.slice(e+1);const l=fe(a),u=t.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const y=this.defaultValueShape;ae(()=>{const v=ee(h,y);h=Zu(v,a).dataSync()})}let d=0,p=0,m=0;for(let y=0;y<=u;++y){let v=y<u?t[y]:-1;if(v===m){++m;continue}if(p<m){const w=i.subarray(d*l),b=o.subarray(p*l),S=(m-p)*l;zO(b,w,S)}if(y>=u){const w=r.length;v=Math.floor(w/l)}if(v>m)if(this.defaultValue.length===1)o.subarray(m*l,v*l).fill(this.defaultValue[0]),m=v;else for(;v>m;){const w=o.slice(m*l);zO(w,h,l),++m}v<0?(d=y+1,p=m):(d=y,p=m,m=p+1)}}}function zO(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function BO(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function l4(n,e,t,r,s,i,o,a,l,u){return new Qv(n,e,t,r,s,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4(n,e,t,r){const s=n===e,i=n<e&&t<0,o=e<n&&t>1;if(s||i||o)return gr(0,r);const a=Math.abs(Math.ceil((e-n)/t)),l=gr(a,r);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c4=Bo(n=>1/Math.sqrt(n)),mde=su(of,c4),gde={kernelName:of,backendName:"cpu",kernelFunc:mde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qu(n,e,t,r,s,i,o,a,l,u){const h=[r/s,s],d=n.values,p=e.values;if(r===0)return ht(t,e.dtype);const m=l instanceof $n?l:ht(h,e.dtype);typeof l=="string"||typeof l=="number"?m.values.fill(l):typeof l=="boolean"&&m.values.fill(+l);for(let y=0;y<i;y++){const v=[];let w=0;for(let b=0;b<o;b++){const S=d[y*o+b];v.push(S),w+=S*a[b]}if(w<0||w>=r/s)throw new Error(`Invalid indices: ${v} does not index into ${t}`);for(let b=0;b<s;b++)u?m.values[w*s+b]+=p[y*s+b]:m.values[w*s+b]=e.rank===0?p[0]:p[y*s+b]}return m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yde=Bo(n=>1/(1+Math.exp(-n))),h4=zt(hf,n=>1/(1+Math.exp(-n))),wde={kernelName:hf,backendName:"cpu",kernelFunc:h4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4(n,e,t,r,s){const i=lk(r,e,t),o=fe(t),a=Qe(r);if(i){const d=uk(e,a);return s==="string"?n.slice(d,d+o):n.subarray(d,d+o)}const l=s==="string"?Ca(n):n,u=ht(r,s,l),h=ht(t,s);for(let d=0;d<h.size;++d){const p=h.indexToLoc(d),m=p.map((y,v)=>y+e[v]);h.set(u.get(...m),...p)}return s==="string"?q3(h.values):h.values}function xc(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:o}=r;Ue(s,"slice");const[a,l]=I1(s,i,o);ok(s,a,l);const u=t.data.get(s.dataId).values,h=d4(u,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,h)}const vde={kernelName:Wg,backendName:"cpu",kernelFunc:xc};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4(n,e,t,r,s,i,o){const a=e[0],l=i[0],u=new Array(l),h=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(O3(a));const w=mn(t,0),b=mn(s,0);return[w,[0,d],b,u,h]}let p=!0,m=0;const y=new Array(l).fill(0);for(let w=0;w<a;++w){const b=n[w*d];if(b<0)throw new Error(P3(w,b));if(b>=l)throw new Error(F3(w,b,l));++y[b],p=p&&b>=m,m=b}let v=!0;for(let w=0;w<l;++w){const b=y[w]===0;u[w]=b,v=v&&!b,y[w]=Math.max(y[w],1),w>0&&(y[w]+=y[w-1])}if(v&&p){const w=n,b=r;for(let S=0;S<a;++S)h[S]=S;return[w,[a,d],b,u,h]}else{const w=y[l-1],b=mn(t,w*d),S=mn(s,w),C=new Array(l).fill(0);for(let T=0;T<a;++T){const O=n[T*d],V=C[O],k=(O===0?0:y[O-1])+V;C[O]++;for(let $=0;$<d;++$)b[k*d+$]=n[T*d+$];S[k]=r[T],h[T]=k}for(let T=0;T<l;++T)if(C[T]===0){const V=T===0?0:y[T-1];b[V*d+0]=T;for(let k=1;k<d;++k)b[V*d+k]=0;S[V]=o}return[b,[w,d],S,u,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4(n,e,t,r,s){const i=fe(r),o=e[0],a=s.length,l=[];let u=1,h=-1;for(let w=0;w<a;++w){const b=s[w];if(b===-1){if(h!==-1)throw new Error(L3(h,w));h=w,l.push(1)}else{if(b<0)throw new Error(M3(w,b));u*=b,l.push(b)}}if(h!==-1){if(u<=0)throw new Error(V3());const w=Math.trunc(i/u);if(u*w!==i)throw new Error(z3(r,l));l[h]=w}if(fe(l)!==i)throw new Error(B3(r,l));const p=r.length,m=[];if(p>0){m[p-1]=1;for(let w=p-2;w>=0;--w)m[w]=m[w+1]*r[w+1]}const y=[];if(a>0){y[a-1]=1;for(let w=a-2;w>=0;--w)y[w]=y[w+1]*l[w+1]}const v=mn(t,o*a);for(let w=0;w<o;++w){let b=0;for(let S=0;S<p;++S)b+=n[w*p+S]*m[S];for(let S=0;S<a;++S)v[w*a+S]=Math.trunc(b/y[S]),b%=y[S]}return[v,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2(n,e,t,r,s,i=!1,o=0){const a=r.length,l=[e[0],n.length/e[0]],u=l[1],d=a>0?s[a-1]+1:0;if(d<0)throw new Error(n_());const p=e.slice();p[0]=d;const m=p.reduce((C,T)=>C*T,1),y=mn(t,m);if(a===0)return d>0&&y.fill(o),[y,p];if(d<=0)throw new Error(n_());let v=0,w=1,b=0,S=s[v];for(;;){let C=0;if(w<a){if(C=s[w],S===C){++w;continue}if(S>=C)throw new Error(U3())}if(S<0||S>=d)throw new Error(W3(S,d));S>b&&y.fill(o,b*u,S*u);for(let T=v;T<w;++T){const O=r[T];if(O<0||O>=l[0])throw new Error(j3(T,r[T],l[0]));for(let V=0;V<u;V++)y[S*u+V]+=n[O*u+V]}if(i)for(let T=0;T<u;T++)y[S*u+T]/=w-v;if(v=w,++w,b=S+1,S=C,w>a)break}return b<d&&y.fill(o,b*u,d*u),[y,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde=Bo(n=>Math.sqrt(n)),bde=zt(ff,n=>Math.sqrt(n)),Ide={kernelName:ff,backendName:"cpu",kernelFunc:bde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m4=Sn((n,e)=>{const t=n-e;return t*t}),Sde=zn(pf,m4),Tde={kernelName:pf,backendName:"cpu",kernelFunc:Sde};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g4=Bo((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:s}=e;return n.replace(new RegExp(t,r?"g":""),s)}),_de=su(Kg,g4),Cde={kernelName:Kg,backendName:"cpu",kernelFunc:_de};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y4(n,e,t,r){const s=ht(n,e.dtype);for(let i=0;i<s.size;i++){const o=s.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+r[l];s.set(e.get(...a),...o)}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ede{constructor(e,t,r,s,i,o){this.separator=Eo(e),this.nGramWidths=t,this.leftPad=Eo(r),this.rightPad=Eo(s),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),h=Math.max(0,l-(i-(a+1))),d=o-(u+h),p=t+(u>0?0:a-l);let m=0;m+=u*this.leftPad.length;for(let S=0;S<d;++S)m+=e[p+S].length;m+=h*this.rightPad.length;const y=u+h+d-1;m+=y*this.separator.length,r[s+a]=new Uint8Array(m);const v=r[s+a];let w=0;const b=S=>S.forEach(C=>v[w++]=C);for(let S=0;S<u;++S)b(this.leftPad),b(this.separator);for(let S=0;S<d-1;++S)b(e[p+S]),b(this.separator);if(d>0){b(e[p+d-1]);for(let S=0;S<h;++S)b(this.separator),b(this.rightPad)}else{for(let S=0;S<h-1;++S)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<s;++u){let h=t[u]>=l;if(h=h&&t[u]<=r,!h)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${r}]`);l=t[u]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const i=s-1,o=mn("int32",s);if(r===0||s===0){const l=new Array(r);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let h=0;this.nGramWidths.forEach(d=>{h+=this.getNumNGrams(u,d)}),this.preserveShort&&u>0&&h===0&&(h=1),o[l]=o[l-1]+h}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let h=o[l];if(this.nGramWidths.forEach(d=>{const p=t[l+1]-t[l],m=this.getNumNGrams(p,d);this.createNGrams(e,u,a,h,m,d),h+=m}),this.preserveShort&&h===o[l]){const d=t[l+1]-t[l];if(d===0)continue;const p=d+2*this.padWidth;this.createNGrams(e,u,a,h,1,p)}}return[a,o]}}function w4(n,e,t,r,s,i,o,a){return new Ede(t,r,s,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(n,e,t,r){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)r.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&r.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}let s=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(s,i);(!t||o.length!==0)&&r.push(o),s=i+1}}function v4(n,e,t){const r=n.length,s=[];let i=0,o=0;const a=new Array(r);for(let p=0;p<r;++p){const m=s.length;kde(n[p],e,t,s);const y=s.length-m;a[p]=y,i+=y,o=Math.max(o,y)}const l=mn("int32",i*2),u=new Array(i),h=[r,o];let d=0;for(let p=0;p<r;++p)for(let m=0;m<a[p];++m)l[d*2]=p,l[d*2+1]=m,u[d]=s[d],++d;return[l,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x4(n,e){const t=mn("int32",n.length);for(let r=0;r<n.length;++r)t[r]=$M(n[r]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b4=Sn((n,e)=>n-e),Nde=d2((n,e,t,r)=>({real:n-t,imag:e-r})),y2=zn(mf,b4,Nde),$de={kernelName:mf,backendName:"cpu",kernelFunc:y2};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I4(n,e){const t=new Array(n.rank);for(let s=0;s<t.length;s++)t[s]=n.shape[s]*e[s];const r=ht(t,n.dtype);for(let s=0;s<r.values.length;++s){const i=r.indexToLoc(s),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);r.values[s]=n.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hp=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function S4(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const a=r-t+1,l=e-t+1,u=Math.log(a),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(a-h)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*h/a+d)),m=Math.min(r,Math.floor(e+(a-l)*h/a+d));S4(n,e,p,m)}const s=n[e];let i=t,o=r;for(oa(n,t,e),Hp(n[r],s)>0&&oa(n,t,r);i<o;){for(oa(n,i,o),i++,o--;Hp(n[i],s)<0;)i=i+1;for(;Hp(n[o],s)>0;)o=o-1}Hp(n[t],s)===0?oa(n,t,o):(o=o+1,oa(n,o,r)),o<=e&&(t=o+1),e<=o&&(r=o-1)}}function T4(n,e,t,r,s){const i=e[e.length-1],[o,a]=[n.length/i,i],l=Jn(t,o*r),u=Jn("int32",o*r);for(let d=0;d<o;d++){const p=d*a,m=n.subarray(p,p+a);let y=new Array(m.length);m.forEach((S,C)=>y[C]={value:S,index:C}),r<y.length&&(S4(y,r),y=y.slice(0,r)),s&&y.sort(Hp);const v=d*r,w=l.subarray(v,v+r),b=u.subarray(v,v+r);for(let S=0;S<r;S++)w[S]=y[S].value,b[S]=y[S].index}const h=e.slice();return h[h.length-1]=r,[ht(h,t,l),ht(h,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _4(n,e,t,r){const s=ft(e,t)[0],i=[1,t[0],1];for(let y=0;y<s;y++)i[0]*=t[y];i[1]=t[s];for(let y=s+1;y<t.length;y++)i[2]*=t[y];const o=new Map,a=new Int32Array(t[s]),l=new $n(i,r,n),u=[],h=i[0]===1&&i[2]===1;for(let y=0;y<t[s];y++){let v;if(h)v=n[y].toString();else{const b=[];for(let S=0;S<i[0];S++)for(let C=0;C<i[2];C++)b.push(l.get(S,y,C));v=b.join(",")}const w=o.get(v);if(w!=null)a[y]=w;else{const b=o.size;o.set(v,b),a[y]=b,u.push(y)}}const d=i.slice();d[1]=o.size;const p=new $n(d,r);u.forEach((y,v)=>{for(let w=0;w<i[0];w++)for(let b=0;b<i[2];b++)p.set(l.get(w,y,b),w,v,b)});const m=t.slice();return m[s]=d[1],{outputValues:p.values,outputShape:m,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C4=Object.freeze(Object.defineProperty({__proto__:null,addImpl:OB,bincountImpl:f2,bincountReduceImpl:PB,bitwiseAndImpl:FB,castImpl:DB,ceilImpl:LB,concatImpl:MB,equalImpl:VB,expImpl:BB,expm1Impl:WB,floorDivImpl:GB,floorImpl:jB,gatherNdImpl:HB,gatherV2Impl:qB,greaterEqualImpl:XB,greaterImpl:KB,lessEqualImpl:YB,lessImpl:QB,linSpaceImpl:JB,logImpl:ZB,maxImpl:e4,maximumImpl:t4,minimumImpl:n4,multiplyImpl:p2,negImpl:r4,notEqualImpl:s4,prodImpl:i4,raggedGatherImpl:o4,raggedRangeImpl:a4,raggedTensorToTensorImpl:l4,rangeImpl:u4,rsqrtImpl:c4,scatterImpl:qu,sigmoidImpl:yde,simpleAbsImpl:AB,sliceImpl:d4,sparseFillEmptyRowsImpl:f4,sparseReshapeImpl:p4,sparseSegmentReductionImpl:g2,sqrtImpl:xde,squaredDifferenceImpl:m4,staticRegexReplaceImpl:g4,stridedSliceImpl:y4,stringNGramsImpl:w4,stringSplitImpl:v4,stringToHashBucketFastImpl:x4,subImpl:b4,tileImpl:I4,topKImpl:T4,transposeImpl:m2,uniqueImpl:_4},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const E4="4.22.0";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */MC("cpu",()=>new $y,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4=zt(Ld,n=>n>=0?n:Math.exp(n)-1),Rde={kernelName:Ld,backendName:"cpu",kernelFunc:k4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r;Ue([s],"leakyRelu");const o=fe(s.shape),a=t.data.get(s.dataId).values,l=Jn("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(s.shape,"float32",l)}const Ade={kernelName:yg,backendName:"cpu",kernelFunc:N4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dde=Sn((n,e)=>n<0?e*n:n);function $4(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e;Ue([r,s],"prelu");const i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,[a,l]=Dde(r.shape,s.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const Ode={kernelName:Fg,backendName:"cpu",kernelFunc:$4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R4=zt(nf,n=>Math.max(0,n)),Pde={kernelName:nf,backendName:"cpu",kernelFunc:R4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A4=zt(rf,n=>Math.min(Math.max(0,n),6)),Fde={kernelName:rf,backendName:"cpu",kernelFunc:A4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yv(n,e,t,r,s){if(t==="linear")return Mo({inputs:{x:e},backend:n});if(t==="relu")return R4({inputs:{x:e},backend:n});if(t==="elu")return k4({inputs:{x:e},backend:n});if(t==="relu6")return A4({inputs:{x:e},backend:n});if(t==="prelu")return $4({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return N4({inputs:{x:e},backend:n,attrs:{alpha:s}});if(t==="sigmoid")return h4({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yt(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,o=fe(s.shape),a=NC(i,o),l=fe(a);B(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${s.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const u=t.data.get(s.dataId);if(u.complexTensorInfos!=null){const h=u.complexTensorInfos.real,d=u.complexTensorInfos.imag;h.shape=a,d.shape=a}return{dataId:s.dataId,shape:a,dtype:s.dtype}}const Lde={kernelName:Mg,backendName:"cpu",kernelFunc:Yt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;Ue([s,i],"matMul");const l=s.shape.length,u=i.shape.length,h=o?s.shape[l-2]:s.shape[l-1],d=a?i.shape[u-1]:i.shape[u-2],p=o?s.shape[l-1]:s.shape[l-2],m=a?i.shape[u-2]:i.shape[u-1],y=s.shape.slice(0,-2),v=i.shape.slice(0,-2),w=fe(y),b=fe(v),C=at(s.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,m]);B(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${s.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const T=o?[w,h,p]:[w,p,h],O=a?[b,m,d]:[b,d,m],V=Yt({inputs:{x:s},backend:t,attrs:{shape:T}}),k=Yt({inputs:{x:i},backend:t,attrs:{shape:O}}),$=o?V.shape[1]:V.shape[2],N=o?V.shape[2]:V.shape[1],R=a?k.shape[1]:k.shape[2],E=Math.max(w,b),L=t.data.get(V.dataId).values,F=t.data.get(k.dataId).values,G=Qe(V.shape),Y=Qe(k.shape),[q,se,X]=o?[G[0],1,G[1]]:[G[0],G[1],1],[re,ie,j]=a?[1,Y[1],Y[0]]:[Y[1],1,Y[0]],Z=N*R,he=ht([E,N,R],V.dtype),ve=he.values,we=t.blockSize;for(let Se=0;Se<E;Se++){const Ne=Se%w,Ae=Se%b;for(let Pe=0;Pe<N;Pe+=we){const qe=Math.min(Pe+we,N);for(let tt=0;tt<R;tt+=we){const wt=Math.min(tt+we,R);for(let bt=0;bt<$;bt+=we){const Pt=Math.min(bt+we,$);for(let Nt=Pe;Nt<qe;Nt++)for(let Tt=tt;Tt<wt;Tt++){let Ft=0;for(let Lt=bt;Lt<Pt;Lt++){const Rr=L[Ne*q+Nt*se+Lt*X],jt=F[Lt*re+Tt*ie+Ae*j];Ft+=Rr*jt}ve[Se*Z+(Nt*R+Tt)]+=Ft}}}}}return t.disposeIntermediateTensorInfo(V),t.disposeIntermediateTensorInfo(k),t.makeTensorInfo(C,he.dtype,he.values)}const Mde={kernelName:tg,backendName:"cpu",kernelFunc:D4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vde(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:d}=r;let p,m,y;const v=[];p=D4({inputs:{a:s,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(m=fd({inputs:{a:p,b:o},backend:t}),v.push(p),p=m),h&&(y=Yv(t,p,h,a,d),v.push(p),p=y);for(const b of v)t.disposeIntermediateTensorInfo(b);return p}const zde={kernelName:pm,backendName:"cpu",kernelFunc:Vde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bde=zt(Td,n=>Math.acos(n)),Ude={kernelName:Td,backendName:"cpu",kernelFunc:Bde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wde=zt(_d,n=>Math.acosh(n)),jde={kernelName:_d,backendName:"cpu",kernelFunc:Wde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gde(n){const{inputs:e,backend:t}=n,r=e;Ue(e,"addN");const s=r.map(a=>t.data.get(a.dataId).values),i=ht(r[0].shape,r[0].dtype),o=i.values;for(let a=0;a<r.length;a++){const l=s[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const Hde={kernelName:Qm,backendName:"cpu",kernelFunc:Gde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qde(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ue(s,"all");const a=ft(i,s.shape);let l=a;const u=dn(l,s.shape.length);let h=s;u!=null&&(h=ls({inputs:{x:s},backend:t,attrs:{perm:u}}),l=bn(l.length,s.shape.length)),vr("all",l,h.shape.length);const[d,p]=nr(h.shape,l),m=fe(p),y=gr(fe(d),h.dtype),v=t.data.get(h.dataId).values;for(let b=0;b<y.length;++b){const S=b*m;let C=v[S];for(let T=0;T<m;++T){const O=v[S+T];C=C&&O}y[b]=C}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(d,h.dtype,y);if(o){const b=xn(d,a),S=Yt({inputs:{x:w},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(w),S}return w}const Kde={kernelName:Rx,backendName:"cpu",kernelFunc:qde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xde(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ue(s,"any");const a=ft(i,s.shape);let l=a;const u=dn(l,s.shape.length);let h=s;u!=null&&(h=ls({inputs:{x:s},backend:t,attrs:{perm:u}}),l=bn(l.length,s.shape.length)),vr("any",l,h.shape.length);const[d,p]=nr(h.shape,l),m=fe(p),y=gr(fe(d),h.dtype),v=t.data.get(h.dataId).values;for(let b=0;b<y.length;++b){const S=b*m;let C=v[S];for(let T=0;T<m;++T){const O=v[S+T];C=C||O}y[b]=C}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(d,h.dtype,y);if(o){const b=xn(d,a),S=Yt({inputs:{x:w},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(w),S}return w}const Qde={kernelName:Ax,backendName:"cpu",kernelFunc:Xde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;Ue(s,"argMax");let o=ft(i,s.shape);const a=dn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=ls({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),o=[o[0]],vr("argMax",o,l.shape.length);const[h,d]=nr(l.shape,o),p=fe(h),m=gr(p,"int32"),y=fe(d),v=t.data.get(l.dataId).values;for(let w=0;w<m.length;++w){const b=w*y;let S=v[b],C=0;for(let T=0;T<y;++T){const O=v[b+T];O>S&&(S=O,C=T)}m[w]=C}return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(h,"int32",m)}const Jde={kernelName:Ym,backendName:"cpu",kernelFunc:Yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zde(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;Ue(s,"argMin");let o=ft(i,s.shape);const a=dn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=ls({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),o=[o[0]],vr("argMin",o,l.shape.length);const[h,d]=nr(l.shape,o),p=fe(h),m=gr(p,"int32"),y=fe(d),v=t.data.get(l.dataId).values;for(let w=0;w<m.length;++w){const b=w*y;let S=v[b],C=0;for(let T=0;T<y;++T){const O=v[b+T];O<S&&(S=O,C=T)}m[w]=C}return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(h,"int32",m)}const efe={kernelName:Jm,backendName:"cpu",kernelFunc:Zde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tfe=zt(Cd,n=>Math.asin(n)),nfe={kernelName:Cd,backendName:"cpu",kernelFunc:tfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rfe=zt(Ed,n=>Math.asinh(n)),sfe={kernelName:Ed,backendName:"cpu",kernelFunc:rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ife=zt(kd,n=>Math.atan(n)),ofe={kernelName:kd,backendName:"cpu",kernelFunc:ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const afe=Sn((n,e)=>Math.atan2(n,e)),lfe=zn($d,afe),ufe={kernelName:$d,backendName:"cpu",kernelFunc:lfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cfe=zt(Nd,n=>Math.atanh(n)),hfe={kernelName:Nd,backendName:"cpu",kernelFunc:cfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2(n,e,t,r,s,i){const o=s.strideHeight,a=s.strideWidth,l=s.dilationHeight,u=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,p=s.padInfo.top,m=s.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=ht(s.outShape,t),w=v.values,b=s.outShape[1]*s.outShape[2]*s.outShape[3],S=s.outShape[2]*s.outShape[3],C=s.outShape[3];for(let T=0;T<s.batchSize;++T){const O=T*b,V=T*r[0];for(let k=0;k<s.inChannels;++k)for(let $=0;$<s.outHeight;++$){const N=$*o-p,R=Math.max(0,N),E=Math.min(s.inHeight,h+N),L=O+$*S;for(let F=0;F<s.outWidth;++F){const G=F*a-m,Y=Math.max(0,G),q=Math.min(s.inWidth,d+G);let se=y,X=0,re=0;for(let j=R;j<E;j+=l){const Z=V+j*r[1];for(let he=Y;he<q;he+=u){const ve=Z+he*r[2],we=n[ve+k];i==="max"&&we>se?se=we:i==="avg"&&(X+=we,re++)}if(isNaN(se))break}const ie=L+F*C+k;w[ie]=i==="avg"?X/re:se}}}return v}function O4(n,e,t,r,s=!1,i=!1){const o=ht(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,y=r.padInfo.left,v=ht(e,t,n);for(let w=0;w<r.batchSize;++w)for(let b=0;b<r.inChannels;++b)for(let S=0;S<r.outHeight;++S){const C=S*a-m;let T=C;for(;T<0;)T+=u;const O=Math.min(r.inHeight,d+C);for(let V=0;V<r.outWidth;++V){const k=V*l-y;let $=k;for(;$<0;)$+=h;const N=Math.min(r.inWidth,p+k);let R=Number.NEGATIVE_INFINITY,E=-1;for(let L=T;L<O;L+=u){const F=L-C;for(let G=$;G<N;G+=h){const Y=G-k,q=v.get(w,L,G,b);q>R&&(R=q,s?E=i?((w*r.inHeight+L)*r.inWidth+G)*r.inChannels+b:(L*r.inWidth+G)*r.inChannels+b:E=F*p+Y)}}o.set(E,w,S,V,b)}}return o}function P4(n,e,t,r,s,i){const o=s.strideDepth,a=s.strideHeight,l=s.strideWidth,u=s.dilationDepth,h=s.dilationHeight,d=s.dilationWidth,p=s.effectiveFilterDepth,m=s.effectiveFilterHeight,y=s.effectiveFilterWidth,v=s.padInfo.front,w=s.padInfo.top,b=s.padInfo.left,S=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=ht(s.outShape,t),T=C.values,O=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],V=s.outShape[2]*s.outShape[3]*s.outShape[4],k=s.outShape[3]*s.outShape[4],$=s.outShape[4];for(let N=0;N<s.batchSize;++N){const R=N*O,E=N*r[0];for(let L=0;L<s.inChannels;++L)for(let F=0;F<s.outDepth;++F){const G=F*o-v;let Y=G;for(;Y<0;)Y+=u;const q=Math.min(s.inDepth,p+G),se=R+F*V;for(let X=0;X<s.outHeight;++X){const re=X*a-w;let ie=re;for(;ie<0;)ie+=h;const j=Math.min(s.inHeight,m+re),Z=se+X*k;for(let he=0;he<s.outWidth;++he){const ve=he*l-b;let we=ve;for(;we<0;)we+=d;const Se=Math.min(s.inWidth,y+ve),Ne=Z+he*$;let Ae=S,Pe=0,qe=0;for(let wt=Y;wt<q;wt+=u){const bt=E+wt*r[1];for(let Pt=ie;Pt<j;Pt+=h){const Nt=bt+Pt*r[2];for(let Tt=we;Tt<Se;Tt+=d){const Ft=Nt+Tt*r[3],Lt=n[Ft+L];if(i==="max"&&Lt>Ae?Ae=Lt:i==="avg"&&(Pe+=Lt,qe++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}const tt=Ne+L;T[tt]=i==="avg"?Pe/Math.max(qe,1):Ae}}}}return C}function dfe(n,e){const t=ht(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;for(let v=0;v<e.batchSize;++v)for(let w=0;w<e.inChannels;++w)for(let b=0;b<e.outDepth;++b){const S=b*r-p;let C=S;for(;C<0;)C+=o;const T=Math.min(e.inDepth,u+S);for(let O=0;O<e.outHeight;++O){const V=O*s-m;let k=V;for(;k<0;)k+=a;const $=Math.min(e.inHeight,h+V);for(let N=0;N<e.outWidth;++N){const R=N*i-y;let E=R;for(;E<0;)E+=l;const L=Math.min(e.inWidth,d+R);let F=Number.NEGATIVE_INFINITY,G=-1;for(let Y=C;Y<T;Y+=o){const q=Y-S;for(let se=k;se<$;se+=a){const X=se-V;for(let re=E;re<L;re+=l){const ie=re-R,j=n.get(v,Y,se,re,w);j>=F&&(F=j,G=q*h*d+X*h+ie)}}}t.set(G,v,b,O,N,w)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ffe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Ue(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;B(wr(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=mi(s.shape,i,o,u,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&mt(h.inShape,h.outShape))d=Mo({inputs:{x:s},backend:t});else{const p=t.data.get(s.dataId).values,m=Qe(s.shape),y=w2(p,s.shape,s.dtype,m,h,"avg");d=t.makeTensorInfo(h.outShape,s.dtype,y.values)}return d}const pfe={kernelName:Zm,backendName:"cpu",kernelFunc:ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r;Ue(s,"avgPool3d");const h=Aa(s.shape,i,o,1,a,l,u),d=t.data.get(s.dataId).values,p=P4(d,s.shape,s.dtype,Qe(s.shape),h,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const gfe={kernelName:eg,backendName:"cpu",kernelFunc:mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yfe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=r;Ue([s,i],"avgPool3DGrad");const h=Aa(i.shape,o,a,1,l,u),d=h.strideDepth,p=h.strideHeight,m=h.strideWidth,y=h.filterDepth,v=h.filterHeight,w=h.filterWidth,b=h.dilationDepth,S=h.dilationHeight,C=h.dilationWidth,T=h.effectiveFilterDepth,O=h.effectiveFilterHeight,V=h.effectiveFilterWidth,k=T-1-h.padInfo.front,$=V-1-h.padInfo.left,N=O-1-h.padInfo.top,R=ht(i.shape,"float32"),E=1/(y*v*w),L=t.bufferSync(s);for(let F=0;F<h.batchSize;++F)for(let G=0;G<h.inChannels;++G)for(let Y=0;Y<h.inDepth;++Y)for(let q=0;q<h.inHeight;++q)for(let se=0;se<h.inWidth;++se){const X=Y-k,re=q-N,ie=se-$;let j=0;for(let Z=0;Z<T;Z+=b){const he=(X+Z)/d;if(!(he<0||he>=h.outDepth||Math.floor(he)!==he))for(let ve=0;ve<O;ve+=S){const we=(re+ve)/p;if(!(we<0||we>=h.outHeight||Math.floor(we)!==we))for(let Se=0;Se<V;Se+=C){const Ne=(ie+Se)/m;if(Ne<0||Ne>=h.outWidth||Math.floor(Ne)!==Ne)continue;const Ae=L.get(F,he,we,Ne,G);j+=Ae}}}R.set(j*E,F,Y,q,se,G)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const wfe={kernelName:Ox,backendName:"cpu",kernelFunc:yfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vfe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i;Ue([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=r,h=mi(o.shape,a,l,1,u),d=h.strideHeight,p=h.strideWidth,m=h.filterHeight,y=h.filterWidth,v=h.dilationHeight,w=h.dilationWidth,b=h.effectiveFilterHeight,S=h.effectiveFilterWidth,C=S-1-h.padInfo.left,T=b-1-h.padInfo.top,O=ht(o.shape,"float32"),V=1/(m*y),k=t.data.get(s.dataId).values,$=ht(s.shape,"float32",k);for(let N=0;N<h.batchSize;++N)for(let R=0;R<h.inChannels;++R)for(let E=0;E<h.inHeight;++E)for(let L=0;L<h.inWidth;++L){const F=E-T,G=L-C;let Y=0;for(let q=0;q<b;q+=v){const se=(F+q)/d;if(!(se<0||se>=h.outHeight||Math.floor(se)!==se))for(let X=0;X<S;X+=w){const re=(G+X)/p;if(re<0||re>=h.outWidth||Math.floor(re)!==re)continue;const ie=$.get(N,se,re,R);Y+=ie}}O.set(Y*V,N,E,L,R)}return t.makeTensorInfo(O.shape,O.dtype,O.values)}const xfe={kernelName:Dx,backendName:"cpu",kernelFunc:vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,scale:i,offset:o,mean:a,variance:l}=e;B(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),B(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),B(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ue([s,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=r;u==null&&(u=.001);const h=t.data.get(s.dataId).values,d=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,m=i?t.data.get(i.dataId).values:new Float32Array([1]),y=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(h.length),w=y.length,b=m.length,S=p.length,C=d.length;let T=0,O=0,V=0,k=0;for(let $=0;$<h.length;++$)v[$]=y[T++]+(h[$]-d[O++])*m[V++]/Math.sqrt(p[k++]+u),T>=w&&(T=0),O>=C&&(O=0),V>=b&&(V=0),k>=S&&(k=0);return t.makeTensorInfo(s.shape,s.dtype,v)}const Ife={kernelName:pg,backendName:"cpu",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:o}=r;Ue([s],"batchToSpaceND");const a=i.reduce((b,S)=>b*S),l=wy(s.shape,i,a),u=vy(l.length,i.length),h=xy(s.shape,i,a),d=mk(o,i.length),p=gk(h,o,i.length),m=Yt({inputs:{x:s},backend:t,attrs:{shape:l}}),y=ls({inputs:{x:m},backend:t,attrs:{perm:u}}),v=Yt({inputs:{x:y},backend:t,attrs:{shape:h}}),w=xc({inputs:{x:v},backend:t,attrs:{begin:d,size:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}const Tfe={kernelName:ng,backendName:"cpu",kernelFunc:Sfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _fe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o}=r,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,u=f2(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const Cfe={kernelName:Px,backendName:"cpu",kernelFunc:_fe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Efe(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values,a=at(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const kfe={kernelName:Fx,backendName:"cpu",kernelFunc:Efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nfe=zt(Dd,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),$fe={kernelName:Dd,backendName:"cpu",kernelFunc:Nfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rfe=n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(fe(e.shape)),s=t.data.get(e.dataId),i=s.complexTensorInfos.real,o=s.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const h=a[u],d=l[u];r[u]=Math.hypot(h,d)}return t.makeOutput(r,e.shape,"float32")},Afe={kernelName:sg,backendName:"cpu",kernelFunc:Rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pd(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const Dfe={kernelName:nb,backendName:"cpu",kernelFunc:pd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function md(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=ft(s,e[0].shape)[0],o=e.map(v=>v.shape);dk(o,i);let a=No(e.map(v=>v.shape),i);if(fe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(v=>fe(v.shape)>0);if(l.length===1)return Mo({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const v=l.map(T=>vc({inputs:{input:T},backend:t})),w=l.map(T=>pd({inputs:{input:T},backend:t})),b=md({inputs:v,backend:t,attrs:{axis:i}}),S=md({inputs:w,backend:t,attrs:{axis:i}}),C=Ts({inputs:{real:b,imag:S},backend:t});return v.forEach(T=>t.disposeIntermediateTensorInfo(T)),w.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(S),C}const u=l.map(v=>{const b=[-1,fe(v.shape.slice(i))];return Yt({inputs:{x:v},backend:t,attrs:{shape:b}})}),h=u.map(v=>({vals:t.data.get(v.dataId).values,shape:v.shape}));a=No(u.map(v=>v.shape),1);const d=u[0].shape[0]===1,p=MB(h,a,e[0].dtype,d),m=No(l.map(v=>v.shape),i),y=t.makeTensorInfo(m,e[0].dtype,p);return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),y}const Ofe={kernelName:ig,backendName:"cpu",kernelFunc:md};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=r;Ue([s,i],"conv2d");const d=Da(l),p=tr(s.shape,i.shape,o,u,a,h,!1,d),m=p.filterHeight,y=p.filterWidth,v=p.dilationHeight,w=p.dilationWidth,b=p.padInfo.left,S=p.padInfo.top,C=p.dataFormat==="channelsLast",T=new $n(p.outShape,s.dtype),O=Qe(s.shape),V=Qe(i.shape),k=O[0],$=C?O[1]:O[2],N=C?O[2]:1,R=C?1:O[1],E=T.strides[0],L=C?T.strides[1]:T.strides[2],F=C?T.strides[2]:1,G=C?1:T.strides[1],Y=t.data.get(s.dataId).values,q=t.data.get(i.dataId).values,se=T.values;for(let X=0;X<p.batchSize;++X){const re=X*k,ie=X*E;for(let j=0;j<p.outHeight;++j){const Z=ie+j*L,he=j*p.strideHeight-S;for(let ve=0;ve<m;++ve){const we=he+ve*v;if(we<0||we>=p.inHeight)continue;const Se=ve*V[0],Ne=re+we*$;for(let Ae=0;Ae<p.outWidth;++Ae){const Pe=Z+Ae*F,qe=Ae*p.strideWidth-b;for(let tt=0;tt<y;++tt){const wt=qe+tt*w;if(wt<0||wt>=p.inWidth)continue;const bt=Se+tt*V[1],Pt=Ne+wt*N;let Nt=bt;for(let Tt=0;Tt<p.inChannels;++Tt){const Ft=Y[Pt+Tt*R];for(let Lt=0;Lt<p.outChannels;++Lt)se[Pe+Lt*G]+=Ft*q[Nt+Lt];Nt+=p.outChannels}}}}}}return t.makeTensorInfo(T.shape,T.dtype,se)}const Pfe={kernelName:og,backendName:"cpu",kernelFunc:F4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ffe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=r;Ue([s,i],"conv2dBackpropFilter");const d=Da(l),p=tr(s.shape,h,o,1,a,u,!1,d),{strideHeight:m,strideWidth:y,filterHeight:v,filterWidth:w}=p,b=p.dataFormat==="channelsLast",S=new $n(p.filterShape,"float32"),C=p.padInfo.left,T=p.padInfo.top,O=t.data.get(s.dataId).values,V=t.data.get(i.dataId).values,k=new $n(s.shape,s.dtype,O),$=new $n(i.shape,i.dtype,V);for(let N=0;N<v;++N){const R=Math.max(0,Math.ceil((T-N)/m)),E=Math.min(p.outHeight,(p.inHeight+T-N)/m);for(let L=0;L<w;++L){const F=Math.max(0,Math.ceil((C-L)/y)),G=Math.min(p.outWidth,(p.inWidth+C-L)/y);for(let Y=0;Y<p.inChannels;++Y)for(let q=0;q<p.outChannels;++q){let se=0;for(let X=0;X<p.batchSize;++X)for(let re=R;re<E;++re){const ie=N+re*m-T;for(let j=F;j<G;++j){const Z=L+j*y-C;b?se+=k.get(X,ie,Z,Y)*$.get(X,re,j,q):se+=k.get(X,Y,ie,Z)*$.get(X,q,re,j)}}S.set(se,N,L,Y,q)}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const Lfe={kernelName:Mx,backendName:"cpu",kernelFunc:Ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mfe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=r;Ue([s,i],"conv2dBackpropInput");const d=Qe(i.shape),p=Qe(s.shape);let m=Da(u);const y=tr(o,i.shape,a,1,l,h,!1,m),v=new $n(y.inShape,"float32"),w=v.values,b=t.data.get(s.dataId).values,S=t.data.get(i.dataId).values,[C,T,O]=d,{batchSize:V,filterHeight:k,filterWidth:$,inChannels:N,inHeight:R,inWidth:E,outChannels:L,outHeight:F,outWidth:G,strideHeight:Y,strideWidth:q}=y;m=y.dataFormat;const se=k-1-y.padInfo.top,X=$-1-y.padInfo.left,re=m==="channelsLast",ie=v.strides[0],j=re?v.strides[1]:v.strides[2],Z=re?v.strides[2]:1,he=re?1:v.strides[1],ve=p[0],we=re?p[1]:p[2],Se=re?p[2]:1,Ne=re?1:p[1];for(let Ae=0;Ae<V;++Ae)for(let Pe=0;Pe<N;++Pe)for(let qe=0;qe<R;++qe){const tt=qe-se,wt=Math.max(0,Math.ceil(tt/Y)),bt=Math.min(F,(k+tt)/Y);for(let Pt=0;Pt<E;++Pt){const Nt=Pt-X,Tt=Math.max(0,Math.ceil(Nt/q)),Ft=Math.min(G,($+Nt)/q);let Lt=0;for(let jt=wt;jt<bt;++jt){const rr=jt*Y-tt;for(let Bn=Tt;Bn<Ft;++Bn){const us=Bn*q-Nt,sr=ve*Ae+we*jt+Se*Bn,Xr=C*(k-1-rr)+T*($-1-us)+O*Pe;for(let Gt=0;Gt<L;++Gt){const Ht=b[sr+Ne*Gt],ir=S[Xr+Gt];Lt+=Ht*ir}}}const Rr=ie*Ae+j*qe+Z*Pt+he*Pe;w[Rr]=Lt}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const Vfe={kernelName:ag,backendName:"cpu",kernelFunc:Mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r;Ue([s,i],"conv3d");const u=Jl(s.shape,i.shape,o,l,a),{filterDepth:h,filterHeight:d,filterWidth:p,dilationDepth:m,dilationHeight:y,dilationWidth:v,padInfo:w}=u,b=w.front,S=w.left,C=w.top,T=new $n(u.outShape,s.dtype),O=t.data.get(s.dataId).values,V=t.data.get(i.dataId).values,k=T.values,$=Qe(s.shape),N=Qe(i.shape);for(let R=0;R<u.batchSize;++R){const E=R*$[0],L=R*T.strides[0];for(let F=0;F<u.outDepth;++F){const G=L+F*T.strides[1],Y=F*u.strideDepth-b;for(let q=0;q<h;++q){const se=Y+q*m;if(se<0||se>=u.inDepth)continue;const X=q*N[0],re=E+se*$[1];for(let ie=0;ie<u.outHeight;++ie){const j=G+ie*T.strides[2],Z=ie*u.strideHeight-C;for(let he=0;he<d;++he){const ve=Z+he*y;if(ve<0||ve>=u.inHeight)continue;const we=X+he*N[1],Se=re+ve*$[2];for(let Ne=0;Ne<u.outWidth;++Ne){const Ae=j+Ne*u.outChannels,Pe=Ne*u.strideWidth-S;for(let qe=0;qe<p;++qe){const tt=Pe+qe*v;if(tt<0||tt>=u.inWidth)continue;const wt=we+qe*N[2],bt=Se+tt*u.inChannels;let Pt=wt;for(let Nt=0;Nt<u.inChannels;++Nt){const Tt=O[bt+Nt];for(let Ft=0;Ft<u.outChannels;++Ft)k[Ae+Ft]+=Tt*V[Pt+Ft];Pt+=u.outChannels}}}}}}}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Bfe={kernelName:lg,backendName:"cpu",kernelFunc:zfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ufe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r;Ue([s,i],"conv3dBackpropFilterV2");const u=Qe(s.shape),h=Qe(i.shape),d=Jl(s.shape,l,o,1,a),p=d.strideDepth,m=d.strideHeight,y=d.strideWidth,v=d.filterDepth,w=d.filterHeight,b=d.filterWidth,S=new $n(d.filterShape,"float32"),C=S.values,[T,O,V,k]=S.strides,$=t.data.get(i.dataId).values,[N,R,E,L]=h,F=t.data.get(s.dataId).values,[G,Y,q,se]=u,X=d.padInfo.front,re=d.padInfo.left,ie=d.padInfo.top;for(let j=0;j<v;++j){const Z=Math.max(0,Math.ceil((X-j)/p)),he=Math.min(d.outDepth,(d.inDepth+X-j)/p),ve=j*T;for(let we=0;we<w;++we){const Se=Math.max(0,Math.ceil((ie-we)/m)),Ne=Math.min(d.outHeight,(d.inHeight+ie-we)/m),Ae=we*O+ve;for(let Pe=0;Pe<b;++Pe){const qe=Math.max(0,Math.ceil((re-Pe)/y)),tt=Math.min(d.outWidth,(d.inWidth+re-Pe)/y),wt=Pe*V+Ae;for(let bt=0;bt<d.inChannels;++bt){const Pt=bt*k+wt;for(let Nt=0;Nt<d.outChannels;++Nt){let Tt=0;for(let Ft=0;Ft<d.batchSize;++Ft){const Lt=Ft*G,Rr=Ft*N;for(let jt=Z;jt<he;++jt){const Bn=(j+jt*p-X)*Y+Lt,us=jt*R+Rr;for(let sr=Se;sr<Ne;++sr){const Gt=(we+sr*m-ie)*q+Bn,Ht=sr*E+us;for(let ir=qe;ir<tt;++ir){const Js=(Pe+ir*y-re)*se+Gt,vi=ir*L+Ht;Tt+=F[Js+bt]*$[vi+Nt]}}}}C[Pt+Nt]=Tt}}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const Wfe={kernelName:Vx,backendName:"cpu",kernelFunc:Ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r;Ue([s],"conv3dBackpropInputV2");const u=Qe(s.shape),h=Qe(i.shape),d=Jl(l,i.shape,a,1,o),p=new $n(d.inShape,"float32"),m=p.values,[y,v,w,b]=p.strides,S=t.data.get(s.dataId).values,[C,T,O,V]=u,k=t.data.get(i.dataId).values,[$,N,R,E]=h,{batchSize:L,filterDepth:F,filterHeight:G,filterWidth:Y,inChannels:q,inDepth:se,inHeight:X,inWidth:re,outChannels:ie,outDepth:j,outHeight:Z,outWidth:he,strideDepth:ve,strideHeight:we,strideWidth:Se}=d,Ne=F-1-d.padInfo.front,Ae=G-1-d.padInfo.top,Pe=Y-1-d.padInfo.left;for(let qe=0;qe<L;++qe)for(let tt=0;tt<q;++tt)for(let wt=0;wt<se;++wt){const bt=wt-Ne,Pt=Math.max(0,Math.ceil(bt/ve)),Nt=Math.min(j,(F+bt)/ve);for(let Tt=0;Tt<X;++Tt){const Ft=Tt-Ae,Lt=Math.max(0,Math.ceil(Ft/we)),Rr=Math.min(Z,(G+Ft)/we);for(let jt=0;jt<re;++jt){const rr=jt-Pe,Bn=Math.max(0,Math.ceil(rr/Se)),us=Math.min(he,(Y+rr)/Se);let sr=0;for(let Xr=Pt;Xr<Nt;++Xr){const Gt=Xr*ve-bt;for(let Ht=Lt;Ht<Rr;++Ht){const ir=Ht*we-Ft;for(let wi=Bn;wi<us;++wi){const Js=wi*Se-rr,vi=C*qe+T*Xr+O*Ht+V*wi,Uo=$*(F-1-Gt)+N*(G-1-ir)+R*(Y-1-Js)+E*tt;for(let no=0;no<ie;++no){const ou=S[vi+no],au=k[Uo+no];sr+=ou*au}}}}m[y*qe+v*wt+w*Tt+b*jt+tt]=sr}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const Gfe={kernelName:zx,backendName:"cpu",kernelFunc:jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hfe=zt(Od,n=>Math.cos(n)),qfe={kernelName:Od,backendName:"cpu",kernelFunc:Hfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kfe=zt(Pd,n=>Math.cosh(n)),Xfe={kernelName:Pd,backendName:"cpu",kernelFunc:Kfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=r,[h,d,p,m]=s.shape,y=i.shape[0],[v,w]=a,b=ht([y,v,w,m],"float32"),S=t.data.get(i.dataId).values,C=t.data.get(o.dataId).values,T=t.data.get(s.dataId).values,O=Qe(s.shape),V=Qe(b.shape);for(let k=0;k<y;k++){const $=k*4,N=S[$],R=S[$+1],E=S[$+2],L=S[$+3],F=C[k];if(F>=h)continue;const G=v>1?(E-N)*(d-1)/(v-1):0,Y=w>1?(L-R)*(p-1)/(w-1):0;for(let q=0;q<v;q++){const se=v>1?N*(d-1)+q*G:.5*(N+E)*(d-1);if(se<0||se>d-1){for(let X=0;X<w;X++)for(let re=0;re<m;re++){const ie=re+X*V[2]+q*V[1]+k*V[0];b.values[ie]=u}continue}if(l==="bilinear"){const X=Math.floor(se),re=Math.ceil(se),ie=se-X;for(let j=0;j<w;j++){const Z=w>1?R*(p-1)+j*Y:.5*(R+L)*(p-1);if(Z<0||Z>p-1){for(let Se=0;Se<m;Se++){const Ne=Se+j*V[2]+q*V[1]+k*V[0];b.values[Ne]=u}continue}const he=Math.floor(Z),ve=Math.ceil(Z),we=Z-he;for(let Se=0;Se<m;Se++){let Ne=Se+he*O[2]+X*O[1]+F*O[0];const Ae=T[Ne];Ne=Se+ve*O[2]+X*O[1]+F*O[0];const Pe=T[Ne];Ne=Se+he*O[2]+re*O[1]+F*O[0];const qe=T[Ne];Ne=Se+ve*O[2]+re*O[1]+F*O[0];const tt=T[Ne],wt=Ae+(Pe-Ae)*we,bt=qe+(tt-qe)*we;Ne=Se+j*V[2]+q*V[1]+k*V[0],b.values[Ne]=wt+(bt-wt)*ie}}}else for(let X=0;X<w;++X){const re=w>1?R*(p-1)+X*Y:.5*(R+L)*(p-1);if(re<0||re>p-1){for(let Z=0;Z<m;Z++){const he=Z+X*V[2]+q*V[1]+k*V[0];b.values[he]=u}continue}const ie=Math.round(re),j=Math.round(se);for(let Z=0;Z<m;Z++){const he=Z+ie*O[2]+j*O[1]+F*O[0],ve=Z+X*V[2]+q*V[1]+k*V[0];b.values[ve]=T[he]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const Yfe={kernelName:Ux,backendName:"cpu",kernelFunc:Qfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jfe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Ue(s,"cumprod");const l=dn([i],s.shape.length);let u=s;l!=null&&(u=ls({inputs:{x:s},backend:t,attrs:{perm:l}}));const h=bn(1,s.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const d=rs(u.dtype,"int32"),p=$x(fe(u.shape),d),m=t.data.get(u.dataId).values,y=u.shape[u.shape.length-1],v=a?(b,S)=>b+y-S-1:(b,S)=>b+S;for(let b=0;b<m.length;b+=y)for(let S=0;S<y;S++){const C=v(b,S);if(S===0)p[C]=o?1:m[C];else{const T=v(b,S-1);p[C]=o?m[T]*p[T]:m[C]*p[T]}}const w=t.makeTensorInfo(u.shape,d,p);if(l!=null){const b=Zl(l),S=ls({inputs:{x:w},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(u),S}return w}const Zfe={kernelName:Bx,backendName:"cpu",kernelFunc:Jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Ue(s,"cumsum");const l=dn([i],s.shape.length);let u=s;l!=null&&(u=ls({inputs:{x:s},backend:t,attrs:{perm:l}}));const h=bn(1,s.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const d=rs(u.dtype,"int32"),p=gr(fe(u.shape),d),m=t.data.get(u.dataId).values,y=u.shape[u.shape.length-1],v=a?(b,S)=>b+y-S-1:(b,S)=>b+S;for(let b=0;b<m.length;b+=y)for(let S=0;S<y;S++){const C=v(b,S);if(S===0)p[C]=o?0:m[C];else{const T=v(b,S-1);p[C]=o?m[T]+p[T]:m[C]+p[T]}}const w=t.makeTensorInfo(u.shape,d,p);if(l!=null){const b=Zl(l),S=ls({inputs:{x:w},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(u),S}return w}const tpe={kernelName:ug,backendName:"cpu",kernelFunc:epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values,h=f2(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,h)}else if(s.shape.length===2){const l=t.bufferSync(s),u=t.bufferSync(i),h=PB(l,u,o,a);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const rpe={kernelName:Wx,backendName:"cpu",kernelFunc:npe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function spe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:o}=r;B(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=s.shape[0],l=s.shape[1],u=s.shape[2],h=s.shape[3],d=l*i,p=u*i,m=h/(i*i),y=t.data.get(s.dataId).values,v=new Float32Array(a*d*p*m);let w=0;for(let b=0;b<a;++b)for(let S=0;S<d;++S){const C=Math.floor(S/i),T=S%i;for(let O=0;O<p;++O){const V=Math.floor(O/i),k=O%i,$=(T*i+k)*m;for(let N=0;N<m;++N){const E=N+$+h*(V+u*(C+l*b));v[w++]=y[E]}}}return t.makeTensorInfo([a,d,p,m],s.dtype,v)}const ipe={kernelName:jx,backendName:"cpu",kernelFunc:spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;Ue([s,i],"depthwiseConv2DNative");const h=Qe(s.shape),d=Qe(i.shape);let p=l;p==null&&(p=[1,1]),B(wr(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const m=tr(s.shape,i.shape,o,p,a,u,!0),{filterHeight:y,filterWidth:v,dilationHeight:w,dilationWidth:b,padInfo:S}=m,C=S.left,T=S.top,O=m.outChannels/m.inChannels,V=new $n(m.outShape,s.dtype),k=t.data.get(s.dataId).values,$=t.data.get(i.dataId).values,N=V.values;for(let R=0;R<m.batchSize;++R){const E=R*h[0],L=R*V.strides[0];for(let F=0;F<m.outHeight;++F){const G=L+F*V.strides[1],Y=F*m.strideHeight-T;for(let q=0;q<y;++q){const se=Y+q*w;if(se<0||se>=m.inHeight)continue;const X=q*d[0],re=E+se*h[1];for(let ie=0;ie<m.outWidth;++ie){const j=G+ie*V.strides[2],Z=ie*m.strideWidth-C;for(let he=0;he<v;++he){const ve=Z+he*b;if(ve<0||ve>=m.inWidth)continue;const we=X+he*d[1],Se=re+ve*m.inChannels;let Ne=j,Ae=we;for(let Pe=0;Pe<m.inChannels;++Pe){const qe=k[Se+Pe];for(let tt=0;tt<O;++tt)N[Ne+tt]+=qe*$[Ae+tt];Ne+=O,Ae+=O}}}}}}return t.makeTensorInfo(V.shape,V.dtype,V.values)}const ope={kernelName:cg,backendName:"cpu",kernelFunc:L4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ape(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=r;Ue([s,i],"depthwiseConv2dNativeBackpropFilter");const d=tr(s.shape,h,o,a,l,u,!0),{strideHeight:p,strideWidth:m,filterHeight:y,filterWidth:v}=d,w=new $n(d.filterShape,"float32"),b=d.padInfo.left,S=d.padInfo.top,C=d.outChannels/d.inChannels,T=t.data.get(s.dataId).values,O=new $n(s.shape,s.dtype,T),V=t.data.get(i.dataId).values,k=new $n(i.shape,i.dtype,V);for(let $=0;$<y;++$){const N=Math.max(0,Math.ceil((S-$)/p)),R=Math.min(d.outHeight,(d.inHeight+S-$)/p);for(let E=0;E<v;++E){const L=Math.max(0,Math.ceil((b-E)/m)),F=Math.min(d.outWidth,(d.inWidth+b-E)/m);for(let G=0;G<d.outChannels;++G){const Y=Math.trunc(G/C),q=G%C;let se=0;for(let X=0;X<d.batchSize;++X)for(let re=N;re<R;++re){const ie=$+re*p-S;for(let j=L;j<F;++j){const Z=E+j*m-b;se+=O.get(X,ie,Z,Y)*k.get(X,re,j,G)}}w.set(se,$,E,Y,q)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const lpe={kernelName:Gx,backendName:"cpu",kernelFunc:ape};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function upe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=r;Ue([s,i],"depthwiseConv2DNativeBackpropInput");const d=Qe(s.shape),p=Qe(i.shape),m=tr(h,i.shape,o,a,l,u,!0),y=new $n(m.inShape,"float32"),v=y.values,[w,b,S]=y.strides,C=t.data.get(s.dataId).values,[T,O,V]=d,k=t.data.get(i.dataId).values,[$,N,R]=p,{batchSize:E,filterHeight:L,filterWidth:F,inChannels:G,inHeight:Y,inWidth:q,outChannels:se,outHeight:X,outWidth:re,strideHeight:ie,strideWidth:j}=m,Z=L-1-m.padInfo.top,he=F-1-m.padInfo.left,ve=se/G;for(let we=0;we<E;++we)for(let Se=0;Se<G;++Se)for(let Ne=0;Ne<Y;++Ne){const Ae=Ne-Z,Pe=Math.max(0,Math.ceil(Ae/ie)),qe=Math.min(X,(L+Ae)/ie);for(let tt=0;tt<q;++tt){const wt=tt-he,bt=Math.max(0,Math.ceil(wt/j)),Pt=Math.min(re,(F+wt)/j);let Nt=0;for(let Tt=Pe;Tt<qe;++Tt){const Ft=Tt*ie-Ae;for(let Lt=bt;Lt<Pt;++Lt){const Rr=Lt*j-wt,jt=T*we+O*Tt+V*Lt,rr=$*(L-1-Ft)+N*(F-1-Rr)+R*Se;for(let Bn=0;Bn<ve;++Bn){const us=Se*ve+Bn,sr=C[jt+us],Xr=k[rr+Bn];Nt+=sr*Xr}}}v[w*we+b*Ne+S*tt+Se]=Nt}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const cpe={kernelName:Hx,backendName:"cpu",kernelFunc:upe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hpe(n){const{inputs:e,backend:t}=n,{x:r}=e,s=fe(r.shape),i=t.data.get(r.dataId).values,o=ht([s,s],r.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*s+u]=i[u];const l=[...r.shape,...r.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const dpe={kernelName:qx,backendName:"cpu",kernelFunc:hpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fpe={kernelName:hg,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(r.dataId).values,h=r.shape.length,d=l.data.get(s.dataId).values,p=s.shape.length,{batchSize:m,inHeight:y,inWidth:v,inChannels:w,outHeight:b,outWidth:S,padInfo:C,strideHeight:T,strideWidth:O,filterHeight:V,filterWidth:k,dilationHeight:$,dilationWidth:N,outShape:R}=ey(r.shape,s.shape,i,o,"NHWC",a),E=fe(R),L=R.length,F=mn(r.dtype,E);for(let Y=0;Y<m;++Y)for(let q=0;q<b;++q){const se=q*T-C.top;for(let X=0;X<S;++X){const re=X*O-C.left;for(let ie=0;ie<w;++ie){let j=Number.MIN_SAFE_INTEGER;for(let he=0;he<V;++he){const ve=se+he*$;if(ve>=0&&ve<y)for(let we=0;we<k;++we){const Se=re+we*N;if(Se>=0&&Se<v){const Ne=Wi([Y,ve,Se,ie],h,Qe(r.shape)),Ae=Wi([he,we,ie],p,Qe(s.shape)),Pe=u[Ne]+d[Ae];Pe>j&&(j=Pe)}}}const Z=Wi([Y,q,X,ie],L,Qe(R));F[Z]=j}}}return{dataId:l.write(Ql(F,r.dtype),R,r.dtype),shape:R,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ppe={kernelName:Rv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,h=qs(r.shape,u.data.get(r.dataId).values),d=qs(s.shape,u.data.get(s.dataId).values),{batchSize:p,inHeight:m,inWidth:y,inChannels:v,outHeight:w,outWidth:b,padInfo:S,strideHeight:C,strideWidth:T,filterHeight:O,filterWidth:V,dilationHeight:k,dilationWidth:$,outShape:N}=ey(r.shape,s.shape,o,a,"NHWC",l);B(i.rank===N.length,()=>`Error in ${Rv}, dy must have the same rank as output ${N.length}, but got ${i.rank}`);const R=qs(N,u.data.get(i.dataId).values),E=RC(s.shape,s.dtype);for(let F=0;F<p;++F)for(let G=0;G<w;++G){const Y=G*C-S.top;for(let q=0;q<b;++q){const se=q*T-S.left;for(let X=0;X<v;++X){let re=Number.MIN_SAFE_INTEGER,ie=0,j=0;for(let Z=0;Z<O;++Z){const he=Y+Z*k;if(he>=0&&he<m)for(let ve=0;ve<V;++ve){const we=se+ve*$;if(we>=0&&we<y){const Se=h[F][he][we][X]+d[Z][ve][X];Se>re&&(re=Se,ie=Z,j=ve)}}}E[ie][j][X]+=R[F][G][q][X]}}}return{dataId:u.write(Ql(E,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mpe={kernelName:$v,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,h=qs(r.shape,u.data.get(r.dataId).values),d=qs(s.shape,u.data.get(s.dataId).values),{batchSize:p,inHeight:m,inWidth:y,inChannels:v,outHeight:w,outWidth:b,padInfo:S,strideHeight:C,strideWidth:T,filterHeight:O,filterWidth:V,dilationHeight:k,dilationWidth:$,outShape:N}=ey(r.shape,s.shape,o,a,"NHWC",l);B(i.rank===N.length,()=>`Error in ${$v}, dy must have the same rank as output ${N.length}, but got ${i.rank}`);const R=qs(N,u.data.get(i.dataId).values),E=RC(r.shape,r.dtype);for(let F=0;F<p;++F)for(let G=0;G<w;++G){const Y=G*C-S.top;for(let q=0;q<b;++q){const se=q*T-S.left;for(let X=0;X<v;++X){let re=Number.MIN_SAFE_INTEGER,ie=Y<0?0:Y,j=se<0?0:se;for(let Z=0;Z<O;++Z){const he=Y+Z*k;if(he>=0&&he<m)for(let ve=0;ve<V;++ve){const we=se+ve*$;if(we>=0&&we<y){const Se=h[F][he][we][X]+d[Z][ve][X];Se>re&&(re=Se,ie=he,j=we)}}}E[F][ie][j][X]+=R[F][G][q][X]}}}return{dataId:u.write(Ql(E,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gpe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s}=e,{canvas:i,options:o}=r,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,h=(a==null?void 0:a.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=i.getContext(h,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${h} type.`);const[p,m]=s.shape.slice(0,2),y=s.shape.length===2?1:s.shape[2],v=t.data.get(s.dataId).values,w=s.dtype==="float32"?255:1,b=new Uint8ClampedArray(m*p*4);for(let C=0;C<p*m;++C){const T=[0,0,0,255*u];for(let V=0;V<y;V++){const k=v[C*y+V];if(s.dtype==="float32"){if(k<0||k>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${k}.`)}else if(s.dtype==="int32"&&(k<0||k>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${k}.`);y===1?(T[0]=k*w,T[1]=k*w,T[2]=k*w):T[V]=k*w}const O=C*4;b[O+0]=Math.round(T[0]),b[O+1]=Math.round(T[1]),b[O+2]=Math.round(T[2]),b[O+3]=Math.round(T[3])}i.width=m,i.height=p;const S=new ImageData(b,m,p);return d.putImageData(S,0,0),s}const ype={kernelName:Kx,backendName:"cpu",kernelFunc:gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ry(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ue(s,"sum");let a;s.dtype==="bool"?a=Gl({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):a=Mo({inputs:{x:s},backend:t});const l=a.shape.length,u=ft(i,a.shape),h=dn(u,l);let d=u,p=a;h!=null&&(p=ls({inputs:{x:a},backend:t,attrs:{perm:h}}),d=bn(d.length,l)),vr("sum",d,p.shape.length);const[m,y]=nr(p.shape,d),v=rs(p.dtype,"int32");let w=Xv(t,m,v);const b=fe(y),S=t.data.get(w.dataId).values,C=t.data.get(p.dataId).values;for(let T=0;T<S.length;++T){const O=T*b;let V=0;for(let k=0;k<b;++k)V+=C[O+k];S[T]=V}if(o){const T=xn(w.shape,u),O=w;w=Yt({inputs:{x:w},backend:t,attrs:{shape:T}}),t.disposeIntermediateTensorInfo(O)}return t.disposeIntermediateTensorInfo(a),h!=null&&t.disposeIntermediateTensorInfo(p),w}const wpe={kernelName:jg,backendName:"cpu",kernelFunc:Ry};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vpe(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=Tk(s,i.length);Ck(o.length,l,i);const{path:u,steps:h}=Ek(a,l),d=h.length;let p=null,m=o.length;const y=[];for(let v=0;v<d;++v){for(const w of h[v]){const{permutationIndices:b,expandDims:S}=_k(m,l[w]);let C;kk(b)?C=i[w]:(C=ls({inputs:{x:i[w]},backend:t,attrs:{perm:b}}),y.push(C));const T=C.shape.slice();for(let O=0;O<S.length;++O)T.splice(S[O],0,1);mt(C.shape,T)||(C=Yt({inputs:{x:C},backend:t,attrs:{shape:T}}),y.push(C)),p===null?p=C:(p=q1({inputs:{a:C,b:p},backend:t}),y.push(p))}v<d-1&&(u[v]>=0&&(p=Ry({inputs:{x:p},backend:t,attrs:{axis:u[v]-(o.length-m),keepDims:!1}}),y.push(p)),m--)}for(const v of y)v!==p&&t.disposeIntermediateTensorInfo(v);return p}const xpe={kernelName:Xx,backendName:"cpu",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(n){const{inputs:e,backend:t}=n,{dy:r,y:s}=e;Ue([r,s],"eluGrad");const i=new Float32Array(fe(s.shape)),o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(s.shape,"float32",i)}const Ipe={kernelName:Qx,backendName:"cpu",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Spe=yk,Tpe=wk,_pe=vk,Cpe=xk,Epe=bk,kpe=Ik,Npe=zt(Md,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+Spe*t);return e*(1-((((kpe*r+Epe)*r+Cpe)*r+_pe)*r+Tpe)*r*Math.exp(-t*t))}),$pe={kernelName:Md,backendName:"cpu",kernelFunc:Npe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jv(n){const{inputs:e,backend:t,attrs:r}=n,{input:s}=e,{dim:i}=r,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(B(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Yt({inputs:{x:s},backend:t,attrs:{shape:a}})}const Rpe={kernelName:fg,backendName:"cpu",kernelFunc:Jv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ape=Sn((n,e)=>n/e),v2=zn(Fd,Ape),S_={kernelName:Fd,backendName:"cpu",kernelFunc:v2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M4(n,e,t){const r=n.shape,s=r[0],i=r[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[s,i],h=fe(u),d=Jn("float32",h),p=Jn("float32",h);for(let w=0;w<s;w++){const b=xc({inputs:{x:a},backend:t,attrs:{begin:[w,0],size:[1,i]}}),S=xc({inputs:{x:l},backend:t,attrs:{begin:[w,0],size:[1,i]}}),C=Ts({inputs:{real:b,imag:S},backend:t}),{real:T,imag:O}=Dpe(C,e,t),V=_a(T,O);for(let k=0;k<i;k++){const $=Sk(V,k);d[w*i+k]=$.real,p[w*i+k]=$.imag}t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(C)}const m=t.makeTensorInfo(u,"float32",d),y=t.makeTensorInfo(u,"float32",p),v=Ts({inputs:{real:m,imag:y},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),v}function Dpe(n,e,t){const r=fe(n.shape),s=t.data.get(n.dataId),i=t.data.get(s.complexTensorInfos.real.dataId).values,o=t.data.get(s.complexTensorInfos.imag.dataId).values;if(Ope(r)){const a=T_(i,o,r,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),h=t.makeTensorInfo(l,"float32",a.imag),d=t.makeTensorInfo([],"float32",Ra(r,"float32")),p=Mo({inputs:{x:d},backend:t}),m=S_.kernelFunc({inputs:{a:u,b:d},backend:t}),y=S_.kernelFunc({inputs:{a:h,b:p},backend:t}),v=t.data.get(m.dataId).values,w=t.data.get(y.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),{real:v,imag:w}}return a}else{const a=_a(i,o),l=Ppe(a,r,e);return k3(l)}}function Ope(n){return(n&n-1)===0}function T_(n,e,t,r,s){if(t===1)return{real:n,imag:e};const i=_a(n,e),o=t/2,a=N3(i),l=a.real,u=a.imag,h=[l.length],d=s.makeTensorInfo(h,"float32",l),p=s.makeTensorInfo(h,"float32",u),m=Ts({inputs:{real:d,imag:p},backend:s}),y=$3(i),v=y.real,w=y.imag,b=[v.length],S=s.makeTensorInfo(b,"float32",v),C=s.makeTensorInfo(b,"float32",w),T=Ts({inputs:{real:S,imag:C},backend:s}),O=T_(l,u,o,r,s),V=O.real,k=O.imag,$=[V.length],N=s.makeTensorInfo($,"float32",V),R=s.makeTensorInfo($,"float32",k),E=Ts({inputs:{real:N,imag:R},backend:s}),L=T_(v,w,o,r,s),F=L.real,G=L.imag,Y=[F.length],q=s.makeTensorInfo(Y,"float32",F),se=s.makeTensorInfo(Y,"float32",G),X=Ts({inputs:{real:q,imag:se},backend:s}),re=A3(t,r),ie=[re.real.length],j=s.makeTensorInfo(ie,"float32",re.real),Z=s.makeTensorInfo(ie,"float32",re.imag),he=Ts({inputs:{real:j,imag:Z},backend:s}),ve=q1({inputs:{a:he,b:X},backend:s}),we=fd({inputs:{a:E,b:ve},backend:s}),Se=y2({inputs:{a:E,b:ve},backend:s}),Ne=vc({inputs:{input:we},backend:s}),Ae=vc({inputs:{input:Se},backend:s}),Pe=pd({inputs:{input:we},backend:s}),qe=pd({inputs:{input:Se},backend:s}),tt=md({inputs:[Ne,Ae],backend:s,attrs:{axis:0}}),wt=md({inputs:[Pe,qe],backend:s,attrs:{axis:0}}),bt=s.data.get(tt.dataId).values,Pt=s.data.get(wt.dataId).values;return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(C),s.disposeIntermediateTensorInfo(T),s.disposeIntermediateTensorInfo(N),s.disposeIntermediateTensorInfo(R),s.disposeIntermediateTensorInfo(E),s.disposeIntermediateTensorInfo(q),s.disposeIntermediateTensorInfo(se),s.disposeIntermediateTensorInfo(X),s.disposeIntermediateTensorInfo(j),s.disposeIntermediateTensorInfo(Z),s.disposeIntermediateTensorInfo(he),s.disposeIntermediateTensorInfo(ve),s.disposeIntermediateTensorInfo(we),s.disposeIntermediateTensorInfo(Se),s.disposeIntermediateTensorInfo(Ne),s.disposeIntermediateTensorInfo(Pe),s.disposeIntermediateTensorInfo(Ae),s.disposeIntermediateTensorInfo(qe),s.disposeIntermediateTensorInfo(tt),s.disposeIntermediateTensorInfo(wt),{real:bt,imag:Pt}}function Ppe(n,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let i=0,o=0;for(let a=0;a<e;a++){const l=D3(s*a,e,t),u=Sk(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),R3(r,i,o,s)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fpe(n){const{inputs:e,backend:t}=n,{input:r}=e,s=fe(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=Yt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),l=M4(a,!1,t),u=Yt({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const Lpe={kernelName:Yx,backendName:"cpu",kernelFunc:Fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(n){const{backend:e,attrs:t}=n,{shape:r,value:s,dtype:i}=t,o=i||Nc(s),a=mn(o,fe(r));return Vpe(a,s,o),e.makeTensorInfo(r,o,a)}const Mpe={kernelName:Jx,backendName:"cpu",kernelFunc:x2};function Vpe(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zpe={kernelName:Zx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,s=t,i=Jn(r.dtype,fe(r.shape)),[o,a,l,u]=r.shape,h=s.data.get(r.dataId).values;for(let p=0;p<o;p++){const m=p*l*a*u;for(let y=0;y<a;y++){const v=y*(l*u);for(let w=0;w<l;w++){const b=w*u;for(let S=0;S<u;S++){const C=Math.round(l-w-1),T=m+v+b+S;let O=h[T];if(C>=0&&C<l){const V=C*u,k=m+v+V+S;O=h[k]}i[T]=O}}}}return{dataId:s.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:y}=r;let v=F4({inputs:{x:s,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:p}});if(o){const w=v;if(h==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const b=Yt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=fd({inputs:{a:v,b},backend:t}),t.disposeIntermediateTensorInfo(b)}else v=fd({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(w)}if(m){const w=v;if(h==="NCHW"&&m==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const b=Yt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});v=Yv(t,v,m,b,y),t.disposeIntermediateTensorInfo(b)}else v=Yv(t,v,m,a,y);t.disposeIntermediateTensorInfo(w)}return v}const Upe={kernelName:mm,backendName:"cpu",kernelFunc:Bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:y}=r;let v=L4({inputs:{x:s,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:p}});if(o){const w=v;v=fd({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(w)}if(m){const w=v;v=Yv(t,v,m,a,y),t.disposeIntermediateTensorInfo(w)}return v}const jpe={kernelName:gm,backendName:"cpu",kernelFunc:Wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gpe(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=fe(r.shape),o=s.shape,a=o[o.length-1],[l,u,h,d]=b1(r,s);if(u===0)return t.makeTensorInfo(l,r.dtype,[]);const p=t.data.get(s.dataId).values,m=t.bufferSync(r),y=HB(p,m,r.dtype,u,a,h,d,r.shape,i);return t.makeTensorInfo(l,r.dtype,y.values)}const Hpe={kernelName:eb,backendName:"cpu",kernelFunc:Gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qpe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:o,batchDims:a}=r;Ue([s,i],"gatherV2");const l=ft(o,s.shape)[0],u=t.data.get(i.dataId).values,h=s.shape[l];for(let T=0;T<u.length;++T){const O=u[T];B(O<=h-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${h-1}]`)}let d=a;a==null&&(d=0);const p=fe(i.shape),m=$k(s,i,l,d),y=Yt({inputs:{x:s},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),v=Yt({inputs:{x:i},backend:t,attrs:{shape:[m.batchSize,p/m.batchSize]}}),w=[m.batchSize,m.outerSize,p/m.batchSize,m.sliceSize],b=t.bufferSync(v),S=t.bufferSync(y),C=qB(S,b,w);return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.makeTensorInfo(m.outputShape,C.dtype,C.values)}const Kpe={kernelName:mg,backendName:"cpu",kernelFunc:qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpe(n){const{inputs:e,backend:t}=n,{input:r}=e,s=fe(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=Yt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),l=M4(a,!0,t),u=Yt({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const Qpe={kernelName:tb,backendName:"cpu",kernelFunc:Xpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ype=zt(Gd,n=>Number.isFinite(n)?1:0,"bool"),Jpe={kernelName:Gd,backendName:"cpu",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zpe=zt(Hd,n=>Math.abs(n)===1/0?1:0,"bool"),eme={kernelName:Hd,backendName:"cpu",kernelFunc:Zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tme=zt(qd,n=>Number.isNaN(n)?1:0,"bool"),nme={kernelName:qd,backendName:"cpu",kernelFunc:tme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rme(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,o=JB(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const sme={kernelName:rb,backendName:"cpu",kernelFunc:rme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ime=zt(Xd,n=>Math.log1p(n)),ome={kernelName:Xd,backendName:"cpu",kernelFunc:ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame=Sn((n,e)=>n&&e),lme=zn(xg,ame,null,"bool"),ume={kernelName:xg,backendName:"cpu",kernelFunc:lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cme=zt(bg,n=>n?0:1,"bool"),hme={kernelName:bg,backendName:"cpu",kernelFunc:cme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dme=Sn((n,e)=>n||e),fme=zn(Ig,dme,null,"bool"),pme={kernelName:Ig,backendName:"cpu",kernelFunc:fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r;Ue(s,"LRN");const u=s.shape[3],h=u-1,d=t.data.get(s.dataId).values,p=fe(s.shape),m=new Float32Array(p);function y(v){const w=v%u;let b=v-w+Math.max(0,w-i);const S=v-w+Math.min(w+i,h);let C=0;for(;b<=S;b++){const T=d[b];C+=T*T}return C}for(let v=0;v<p;v++){const w=y(v),b=d[v]*Math.pow(o+a*w,-l);m[v]=b}return t.makeTensorInfo(s.shape,s.dtype,m)}const gme={kernelName:Sg,backendName:"cpu",kernelFunc:mme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:h}=r;Ue(o,"LRNGrad");const d=fe(o.shape),p=o.shape[3],m=t.data.get(o.dataId).values,y=t.data.get(s.dataId).values,v=t.data.get(i.dataId).values,w=new Float32Array(d),b=d;for(let S=0;S<b;S++){const C=S%p,T=S-C+Math.max(0,C-a),O=S-C+Math.min(p,C+a+1);let V=0;for(let k=T;k<O;k++)V+=Math.pow(y[k],2);V=u*V+l;for(let k=T;k<O;k++){let $=-2*u*h*y[k]*v[S]/V;S===k&&($+=Math.pow(V,-h)),$*=m[S],w[k]+=$}}return t.makeTensorInfo(o.shape,s.dtype,w)}const wme={kernelName:sb,backendName:"cpu",kernelFunc:yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=t;let l=s.shape;const u=l.length,h=ft(i,l);let d=h;const p=dn(d,u);let m=a.data.get(s.dataId).values;if(p!=null){const T=new Array(u);for(let O=0;O<T.length;O++)T[O]=l[p[O]];m=m2(m,l,s.dtype,p,T),d=bn(d.length,u),l=T}Ue(s,"max"),vr("max",d,u);const[y,v]=nr(l,d),w=fe(v),b=e4(m,w,y,s.dtype),S=a.write(b,y,s.dtype);let C=y;return o&&(C=xn(y,h)),{dataId:S,shape:C,dtype:s.dtype}}const vme={kernelName:Tg,backendName:"cpu",kernelFunc:V4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xme(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Ue(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;B(wr(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=mi(s.shape,i,o,u,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&mt(h.inShape,h.outShape))d=Mo({inputs:{x:s},backend:t});else{const p=t.data.get(s.dataId).values,m=Qe(s.shape),y=w2(p,s.shape,s.dtype,m,h,"max");d=t.makeTensorInfo(h.outShape,s.dtype,y.values)}return d}const bme={kernelName:_g,backendName:"cpu",kernelFunc:xme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ime(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r;Ue(s,"maxPool3d");const h=Aa(s.shape,i,o,1,a,l,u),d=t.data.get(s.dataId).values,p=P4(d,s.shape,s.dtype,Qe(s.shape),h,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const Sme={kernelName:Cg,backendName:"cpu",kernelFunc:Ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tme(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=r;Ue([s,i],"maxPool3DGrad");const h=Aa(i.shape,o,a,1,l,u),d=t.bufferSync(i),p=dfe(d,h),m=h.strideDepth,y=h.strideHeight,v=h.strideWidth,w=h.dilationDepth,b=h.dilationHeight,S=h.dilationWidth,C=h.effectiveFilterDepth,T=h.effectiveFilterHeight,O=h.effectiveFilterWidth,V=C-1-h.padInfo.front,k=O-1-h.padInfo.left,$=T-1-h.padInfo.top,N=ht(i.shape,"float32"),R=t.bufferSync(s);for(let E=0;E<h.batchSize;++E)for(let L=0;L<h.inChannels;++L)for(let F=0;F<h.inDepth;++F)for(let G=0;G<h.inHeight;++G)for(let Y=0;Y<h.inWidth;++Y){const q=F-V,se=G-$,X=Y-k;let re=0;for(let ie=0;ie<C;ie+=w){const j=(q+ie)/m;if(!(j<0||j>=h.outDepth||Math.floor(j)!==j))for(let Z=0;Z<T;Z+=b){const he=(se+Z)/y;if(!(he<0||he>=h.outHeight||Math.floor(he)!==he))for(let ve=0;ve<O;ve+=S){const we=(X+ve)/v;if(we<0||we>=h.outWidth||Math.floor(we)!==we)continue;const Se=C*T*O-1-p.get(E,j,he,we,L),Ne=ie*T*O+Z*O+ve,Ae=Se===Ne?1:0;if(Ae===0)continue;const Pe=R.get(E,j,he,we,L);re+=Pe*Ae}}}N.set(re,E,F,G,Y,L)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const _me={kernelName:ob,backendName:"cpu",kernelFunc:Tme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:o}=e,a=i;Ue([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=r,p=mi(a.shape,l,u,1,h,d),m=t.data.get(a.dataId).values,y=ht(p.outShape,a.dtype,O4(m,a.shape,a.dtype,p).values),v=p.strideHeight,w=p.strideWidth,b=p.dilationHeight,S=p.dilationWidth,C=p.effectiveFilterHeight,T=p.effectiveFilterWidth,O=T-1-p.padInfo.left,V=C-1-p.padInfo.top,k=ht(a.shape,"float32"),$=t.data.get(s.dataId).values,N=ht(s.shape,"float32",$);for(let R=0;R<p.batchSize;++R)for(let E=0;E<p.inChannels;++E)for(let L=0;L<p.inHeight;++L)for(let F=0;F<p.inWidth;++F){const G=L-V,Y=F-O;let q=0;for(let se=0;se<C;se+=b){const X=(G+se)/v;if(!(X<0||X>=p.outHeight||Math.floor(X)!==X))for(let re=0;re<T;re+=S){const ie=(Y+re)/w;if(ie<0||ie>=p.outWidth||Math.floor(ie)!==ie)continue;const j=C*T-1-y.get(R,X,ie,E),Z=se*T+re,he=j===Z?1:0;if(he===0)continue;const ve=N.get(R,X,ie,E);q+=ve*he}}k.set(q,R,L,F,E)}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Eme={kernelName:ib,backendName:"cpu",kernelFunc:Cme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(n,e,t,r,s){const i=Qe(e),o=w2(n,e,t,i,s,"max"),a=O4(n,e,t,s,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nme={kernelName:ab,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Ue(r,"MaxPoolWithArgmax");const u=l.data.get(r.dataId).values,h=mi(r.shape,s,i,[1,1],o),[d,p]=kme(u,r.shape,r.dtype,a,h),m=l.write(d,h.outShape,r.dtype),y=l.write(p,h.outShape,r.dtype);return[{dataId:m,shape:h.outShape,dtype:r.dtype},{dataId:y,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=ft(i,s.shape),u=nr(s.shape,a)[1],h=fe(u),d=[],p=t.makeTensorInfo([],"float32",new Float32Array([h]));d.push(p);const m=Gl({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});d.push(m);const y=v2({inputs:{a:m,b:p},backend:t});d.push(y);const v=Ry({inputs:{x:y},backend:t,attrs:{axis:i,keepDims:o}});return d.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const Rme={kernelName:Eg,backendName:"cpu",kernelFunc:$me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;Ue(s,"min");const a=ft(i,s.shape);let l=a;const u=dn(l,s.shape.length);let h=s;u!=null&&(h=ls({inputs:{x:s},backend:t,attrs:{perm:u}}),l=bn(l.length,s.shape.length)),vr("min",l,h.shape.length);const[d,p]=nr(h.shape,l),m=fe(p),y=gr(fe(d),h.dtype),v=t.data.get(h.dataId).values;for(let b=0;b<y.length;++b){const S=b*m;let C=v[S];for(let T=0;T<m;++T){const O=v[S+T];(Number.isNaN(O)||O<C)&&(C=O)}y[b]=C}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(d,h.dtype,y);if(o){const b=xn(d,a),S=Yt({inputs:{x:w},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(w),S}return w}const Dme={kernelName:kg,backendName:"cpu",kernelFunc:Ame};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ome(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,mode:o}=r;Ue(s,"mirrorPad");const a=i.map((C,T)=>C[0]+s.shape[T]+C[1]),l=i.map(C=>C[0]),u=i.map((C,T)=>C[0]+s.shape[T]),h=o==="reflect"?0:1,d=t.data.get(s.dataId).values,p=s.shape.length,m=Qe(s.shape),y=fe(a),v=a.length,w=Qe(a),b=Jn(s.dtype,y);for(let C=0;C<y;C++){let T=$c(C,v,w);for(let V=0;V<v;V++)T[V]<l[V]?T[V]=l[V]*2-T[V]-h:T[V]>=u[V]&&(T[V]=(u[V]-1)*2-T[V]+h);T=T.map((V,k)=>V-l[k]);const O=Wi(T,p,m);b[C]=d[O]}return{dataId:t.write(b,a,s.dtype),shape:a,dtype:s.dtype}}const Pme={kernelName:Ng,backendName:"cpu",kernelFunc:Ome};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fme=Sn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),Lme=zn(Jd,Fme),Mme={kernelName:Jd,backendName:"cpu",kernelFunc:Lme};var Kw={exports:{}},Vme=Kw.exports,UO;function zme(){return UO||(UO=1,function(n){(function(e,t,r){function s(l){var u=this,h=a();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(l),u.s0<0&&(u.s0+=1),u.s1-=h(l),u.s1<0&&(u.s1+=1),u.s2-=h(l),u.s2<0&&(u.s2+=1),h=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var h=new s(l),d=u&&u.state,p=h.next;return p.int32=function(){return h.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,d&&(typeof d=="object"&&i(d,h),p.state=function(){return i(h,{})}),p}function a(){var l=4022871197,u=function(h){h=String(h);for(var d=0;d<h.length;d++){l+=h.charCodeAt(d);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(Vme,n)}(Kw)),Kw.exports}var Xw={exports:{}},Bme=Xw.exports,WO;function Ume(){return WO||(WO=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xor128=o})(Bme,n)}(Xw)),Xw.exports}var Qw={exports:{}},Wme=Qw.exports,jO;function jme(){return jO||(jO=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,h==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xorwow=o})(Wme,n)}(Qw)),Qw.exports}var Yw={exports:{}},Gme=Yw.exports,GO;function Hme(){return GO||(GO=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var h=l.x,d=l.i,p,m;return p=h[d],p^=p>>>7,m=p^p<<24,p=h[d+1&7],m^=p^p>>>10,p=h[d+3&7],m^=p^p>>>3,p=h[d+4&7],m^=p^p<<7,p=h[d+7&7],p=p^p<<13,m^=p^p<<9,h[d]=m,l.i=d+1&7,m};function u(h,d){var p,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,p=0;p<d.length;++p)m[p&7]=m[p&7]<<15^d.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&m[p]===0;++p);for(p==8?m[7]=-1:m[p],h.x=m,h.i=0,p=256;p>0;--p)h.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(h.x&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xorshift7=o})(Gme,n)}(Yw)),Yw.exports}var Jw={exports:{}},qme=Jw.exports,HO;function Kme(){return HO||(HO=1,function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var h=l.w,d=l.X,p=l.i,m,y;return l.w=h=h+1640531527|0,y=d[p+34&127],m=d[p=p+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,y=d[p]=y^m,l.i=p,y+(h^h>>>16)|0};function u(h,d){var p,m,y,v,w,b=[],S=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,S=Math.max(S,d.length)),y=0,v=-32;v<S;++v)d&&(m^=d.charCodeAt((v+32)%d.length)),v===0&&(w=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,v>=0&&(w=w+1640531527|0,p=b[v&127]^=m+w,y=p==0?y+1:0);for(y>=128&&(b[(d&&d.length||0)&127]=-1),y=127,v=4*128;v>0;--v)m=b[y+34&127],p=b[y=y+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,b[y]=m^p;h.w=w,h.X=b,h.i=y}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(h.X&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.xor4096=o})(qme,n)}(Jw)),Jw.exports}var Zw={exports:{}},Xme=Zw.exports,qO;function Qme(){return qO||(qO=1,function(n){(function(e,t,r){function s(a){var l=this,u="";l.next=function(){var d=l.b,p=l.c,m=l.d,y=l.a;return d=d<<25^d>>>7^p,p=p-m|0,m=m<<24^m>>>8^y,y=y-d|0,l.b=d=d<<20^d>>>12^p,l.c=p=p-m|0,l.d=m<<16^p>>>16^y,l.a=y-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var h=0;h<u.length+20;h++)l.b^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new s(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=u.next()>>>11,m=(u.next()>>>0)/4294967296,y=(p+m)/(1<<21);while(y===0);return y},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}t&&t.exports?t.exports=o:this.tychei=o})(Xme,n)}(Zw)),Zw.exports}var ev={exports:{}},Yme=ev.exports,KO;function Jme(){return KO||(KO=1,function(n){(function(e,t,r){var s=256,i=6,o=52,a="random",l=r.pow(s,i),u=r.pow(2,o),h=u*2,d=s-1,p;function m(T,O,V){var k=[];O=O==!0?{entropy:!0}:O||{};var $=b(w(O.entropy?[T,C(t)]:T??S(),3),k),N=new y(k),R=function(){for(var E=N.g(i),L=l,F=0;E<u;)E=(E+F)*s,L*=s,F=N.g(1);for(;E>=h;)E/=2,L/=2,F>>>=1;return(E+F)/L};return R.int32=function(){return N.g(4)|0},R.quick=function(){return N.g(4)/4294967296},R.double=R,b(C(N.S),t),(O.pass||V||function(E,L,F,G){return G&&(G.S&&v(G,N),E.state=function(){return v(N,{})}),F?(r[a]=E,L):E})(R,$,"global"in O?O.global:this==r,O.state)}function y(T){var O,V=T.length,k=this,$=0,N=k.i=k.j=0,R=k.S=[];for(V||(T=[V++]);$<s;)R[$]=$++;for($=0;$<s;$++)R[$]=R[N=d&N+T[$%V]+(O=R[$])],R[N]=O;(k.g=function(E){for(var L,F=0,G=k.i,Y=k.j,q=k.S;E--;)L=q[G=d&G+1],F=F*s+q[d&(q[G]=q[Y=d&Y+L])+(q[Y]=L)];return k.i=G,k.j=Y,F})(s)}function v(T,O){return O.i=T.i,O.j=T.j,O.S=T.S.slice(),O}function w(T,O){var V=[],k=typeof T,$;if(O&&k=="object")for($ in T)try{V.push(w(T[$],O-1))}catch{}return V.length?V:k=="string"?T:T+"\0"}function b(T,O){for(var V=T+"",k,$=0;$<V.length;)O[d&$]=d&(k^=O[d&$]*19)+V.charCodeAt($++);return C(O)}function S(){try{var T;return p&&(T=p.randomBytes)?T=T(s):(T=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(T)),C(T)}catch{var O=e.navigator,V=O&&O.plugins;return[+new Date,e,V,e.screen,C(t)]}}function C(T){return String.fromCharCode.apply(0,T)}if(b(r.random(),t),n.exports){n.exports=m;try{p=RE}catch{}}else r["seed"+a]=m})(typeof self<"u"?self:Yme,[],Math)}(ev)),ev.exports}var aT,XO;function Zme(){if(XO)return aT;XO=1;var n=zme(),e=Ume(),t=jme(),r=Hme(),s=Kme(),i=Qme(),o=Jme();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=r,o.xor4096=s,o.tychei=i,aT=o,aT}var ege=Zme();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,o=s.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=ft([a],s.shape),u=V4({inputs:{x:s},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),h=xn(u.shape,l),d=Yt({inputs:{x:u},backend:t,attrs:{shape:h}}),p=y2({inputs:{a:s,b:d},backend:t}),m=UB({inputs:{x:p},backend:t}),y=Ry({inputs:{x:m},backend:t,attrs:{axis:l,keepDims:!1}}),v=Yt({inputs:{x:y},backend:t,attrs:{shape:h}}),w=v2({inputs:{a:m,b:v},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}const tge={kernelName:qg,backendName:"cpu",kernelFunc:z4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nge(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r;Ue(s,"multinomial");const l=a?s:z4({inputs:{logits:s},backend:t,attrs:{dim:-1}}),u=l.shape[0],h=l.shape[1],d=t.data.get(l.dataId).values,p=[u,i],m=gr(fe(p),"int32");for(let y=0;y<u;++y){const v=y*h,w=new Float32Array(h-1);w[0]=d[v];for(let C=1;C<w.length;++C)w[C]=w[C-1]+d[v+C];const b=ege.alea(o.toString()),S=y*i;for(let C=0;C<i;++C){const T=b();m[S+C]=w.length;for(let O=0;O<w.length;O++)if(T<w[O]){m[S+C]=O;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",m)}const rge={kernelName:lb,backendName:"cpu",kernelFunc:nge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sge=y1;function ige(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;Ue(s,"NonMaxSuppression");const u=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,{selectedIndices:d}=sge(u,h,o,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const oge={kernelName:ub,backendName:"cpu",kernelFunc:ige};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const age=w1;function lge(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r;Ue(s,"NonMaxSuppressionPadded");const h=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:m}=age(h,d,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([m]))]}const uge={kernelName:cb,backendName:"cpu",kernelFunc:lge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cge=v1;function hge(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r;Ue(s,"NonMaxSuppressionWithScore");const h=t.data.get(s.dataId).values,d=t.data.get(i.dataId).values,p=o,m=a,y=l,v=u,{selectedIndices:w,selectedScores:b}=cge(h,d,p,m,y,v);return[t.makeTensorInfo([w.length],"int32",new Int32Array(w)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const dge={kernelName:hb,backendName:"cpu",kernelFunc:hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fge(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r;Ue(s,"oneHot");const u=fe(s.shape),h=new Float32Array(u*o);h.fill(l);const d=t.data.get(s.dataId).values;for(let p=0;p<u;++p)d[p]>=0&&d[p]<o&&(h[p*o+d[p]]=a);return t.makeTensorInfo([...s.shape,o],i,h)}const pge={kernelName:Dg,backendName:"cpu",kernelFunc:fge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zv(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=vc({inputs:{input:r},backend:t}),i=Zv({inputs:{x:s},backend:t}),o=pd({inputs:{input:r},backend:t}),a=Zv({inputs:{x:o},backend:t}),l=Ts({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return x2({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const mge={kernelName:Yg,backendName:"cpu",kernelFunc:Zv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=vc({inputs:{input:r},backend:t}),i=B4({inputs:{x:s},backend:t}),o=pd({inputs:{input:r},backend:t}),a=Zv({inputs:{x:o},backend:t}),l=Ts({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return x2({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const gge={kernelName:Ag,backendName:"cpu",kernelFunc:B4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return Jv({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(h=>{yr(i,h.shape,"All tensors passed to stack must have matching shapes"),B(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const d=Jv({inputs:{input:h},backend:t,attrs:{dim:s}});return a.push(d),d}),u=md({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const yge={kernelName:Og,backendName:"cpu",kernelFunc:U4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:o}=r;Ue(s,"pad");const a=i.map((S,C)=>S[0]+s.shape[C]+S[1]),l=i.map(S=>S[0]),u=t.data.get(s.dataId).values,h=fe(s.shape),d=s.shape.length,p=Qe(s.shape),m=fe(a),y=a.length,v=Qe(a),w=Jn(s.dtype,m);o!==0&&w.fill(o);for(let S=0;S<h;S++){const T=$c(S,d,p).map((V,k)=>V+l[k]),O=Wi(T,y,v);w[O]=u[S]}return{dataId:t.write(w,a,s.dtype),shape:a,dtype:s.dtype}}const W4={kernelName:Pg,backendName:"cpu",kernelFunc:wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vge=Sn((n,e)=>Math.pow(n,e)),xge=zn(ef,vge),bge={kernelName:ef,backendName:"cpu",kernelFunc:xge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ige(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,a=s.map(w=>t.data.get(w.dataId).values),l=s.map(w=>w.shape),u=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values,[d,p,m]=o4(a,l,u,i.shape,i.dtype,h,o.shape),y=d.map(w=>t.makeTensorInfo([w.length],"int32",w)),v=t.makeTensorInfo(m,i.dtype,p);return y.concat([v])}const Sge={kernelName:db,backendName:"cpu",kernelFunc:Ige};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tge(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[u,h]=a4(o,r.shape,r.dtype,a,s.shape,l,i.shape),d=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([h.length],r.dtype,h);return[d,p]}const _ge={kernelName:fb,backendName:"cpu",kernelFunc:Tge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cge(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,u=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values,p=a.map(w=>t.data.get(w.dataId).values),m=a.map(w=>w.shape),[y,v]=l4(u,s.shape,h,i.shape,i.dtype,d,o.shape,p,m,l);return t.makeTensorInfo(y,i.dtype,v)}const Ege={kernelName:pb,backendName:"cpu",kernelFunc:Cge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kge(n){const{backend:e,attrs:t}=n,{start:r,stop:s,dtype:i,step:o}=t,a=u4(r,s,o,i);return e.makeTensorInfo([a.length],i,a)}const Nge={kernelName:mb,backendName:"cpu",kernelFunc:kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ge=zt(tf,n=>1/n),Rge={kernelName:tf,backendName:"cpu",kernelFunc:$ge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Age(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Ue(s,"resizeBilinear");const l=Qe(s.shape),[u,h]=a,[d,p,m,y]=s.shape,v=t.data.get(s.dataId).values,w=new Float32Array(fe([d,u,h,y])),b=[i&&u>1?p-1:p,i&&h>1?m-1:m],S=[i&&u>1?u-1:u,i&&h>1?h-1:h];let C=0;const T=b[0]/S[0],O=b[1]/S[1];for(let V=0;V<d;V++)for(let k=0;k<u;k++){let $;o?$=T*(k+.5)-.5:$=T*k;const N=Math.max(0,Math.floor($)),R=$-N,E=Math.min(p-1,Math.ceil($)),L=V*l[0]+N*l[1],F=V*l[0]+E*l[1];for(let G=0;G<h;G++){let Y;o?Y=O*(G+.5)-.5:Y=O*G;const q=Math.max(0,Math.floor(Y)),se=Y-q,X=Math.min(m-1,Math.ceil(Y)),re=L+q*l[2],ie=F+q*l[2],j=L+X*l[2],Z=F+X*l[2];for(let he=0;he<y;he++){const ve=v[re+he],we=v[ie+he],Se=v[j+he],Ne=v[Z+he],Ae=ve+(Se-ve)*se,Pe=we+(Ne-we)*se,qe=Ae+(Pe-Ae)*R;w[C++]=qe}}}return t.makeTensorInfo([d,u,h,y],"float32",w)}const Dge={kernelName:zg,backendName:"cpu",kernelFunc:Age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oge(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r;Ue([i,s],"resizeBilinearGrad");const a=Qe(s.shape),[l,u,h,d]=s.shape,[,p,m]=i.shape,y=new Float32Array(l*u*h*d),v=[o&&p>1?u-1:u,o&&m>1?h-1:h],w=[o&&p>1?p-1:p,o&&m>1?m-1:m],b=v[0]/w[0],S=v[1]/w[1],C=t.data.get(i.dataId).values;let T=0;for(let O=0;O<l;O++){const V=O*a[0];for(let k=0;k<p;k++){const $=k*b,N=Math.floor($),R=Math.min(Math.ceil($),u-1),E=V+N*a[1],L=V+R*a[1],F=$-N,G=1-F;for(let Y=0;Y<m;Y++){const q=Y*S,se=Math.floor(q),X=Math.min(Math.ceil(q),h-1),re=q-se,ie=1-re,j=E+se*a[2],Z=E+X*a[2],he=L+se*a[2],ve=L+X*a[2],we=G*ie,Se=G*re,Ne=F*ie,Ae=F*re;for(let Pe=0;Pe<d;Pe++){const qe=C[T++];y[j+Pe]+=qe*we,y[Z+Pe]+=qe*Se,y[he+Pe]+=qe*Ne,y[ve+Pe]+=qe*Ae}}}}return t.makeTensorInfo([l,h,u,d],"float32",y)}const Pge={kernelName:wb,backendName:"cpu",kernelFunc:Oge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fge(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Ue(s,"resizeNearestNeighbor");const l=Qe(s.shape),[u,h]=a,[d,p,m,y]=s.shape,v=t.data.get(s.dataId).values,w=new Float32Array(d*u*h*y),b=[i&&u>1?p-1:p,i&&h>1?m-1:m],S=[i&&u>1?u-1:u,i&&h>1?h-1:h],C=b[0]/S[0],T=b[1]/S[1];let O=0;for(let V=0;V<d;V++){const k=V*l[0];for(let $=0;$<u;$++){const N=o?C*($+.5):C*$;let R=Math.min(p-1,i?Math.round(N):Math.floor(N));o&&(R=Math.max(0,R));const E=k+R*l[1];for(let L=0;L<h;L++){const F=o?T*(L+.5):T*L;let G=Math.min(m-1,i?Math.round(F):Math.floor(F));o&&(G=Math.max(0,G));const Y=E+G*l[2];for(let q=0;q<y;q++){const se=v[Y+q];w[O++]=se}}}}return t.makeTensorInfo([d,u,h,y],s.dtype,w)}const Lge={kernelName:Vg,backendName:"cpu",kernelFunc:Fge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mge(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r;Ue([i,s],"resizeNearestNeighborGrad");const a=Qe(s.shape),l=Qe(i.shape),[u,h,d,p]=s.shape,[,m,y]=i.shape,v=new Float32Array(u*h*d*p),w=t.data.get(i.dataId).values,b=[o&&m>1?h-1:h,o&&y>1?d-1:d],S=[o&&m>1?m-1:m,o&&y>1?y-1:y],C=b[0]/S[0],T=b[1]/S[1],O=1/C,V=1/T,k=Math.ceil(O)*2+2,$=Math.ceil(V)*2+2;for(let N=0;N<u;N++){const R=N*a[0];for(let E=0;E<h;E++){const L=R+E*a[1],F=Math.floor(E*O),G=Math.floor(F-k/2);for(let Y=0;Y<d;Y++){const q=L+Y*a[2],se=Math.floor(Y*V),X=Math.floor(se-$/2);for(let re=0;re<p;re++){let ie=0;for(let j=0;j<k;j++){const Z=j+G;if(Z<0||Z>=m)continue;const he=R+Z*l[1],ve=Z*C,we=Math.min(h-1,o?Math.round(ve):Math.floor(ve));if(E===we)for(let Se=0;Se<$;Se++){const Ne=Se+X;if(Ne<0||Ne>=y)continue;const Ae=he+Ne*l[2],Pe=Ne*T,qe=Math.min(d-1,o?Math.round(Pe):Math.floor(Pe));Y===qe&&(ie+=w[Ae+re])}}v[q+re]=ie}}}}return t.makeTensorInfo(s.shape,s.dtype,v)}const Vge={kernelName:yb,backendName:"cpu",kernelFunc:Mge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zge(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r;Ue(s,"reverse");const o=s.shape.length,a=ft(i,s.shape);if(o===0)return Mo({inputs:{x:s},backend:t});const l=new $n(s.shape,s.dtype),u=t.bufferSync(s);for(let h=0;h<l.size;h++){const d=l.indexToLoc(h),p=d.slice();a.forEach(m=>p[m]=s.shape[m]-1-p[m]),l.set(u.get(...p),...d)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const Bge={kernelName:Bg,backendName:"cpu",kernelFunc:zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uge={kernelName:Pb,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:o}=e,a=t,l=Jn(r.dtype,fe(r.shape)),[u,h,d,p]=r.shape,[m,y]=pk(o,h,d),v=255,w=Math.sin(s),b=Math.cos(s),S=a.data.get(r.dataId).values;for(let T=0;T<u;T++){const O=T*d*h*p;for(let V=0;V<h;V++){const k=V*(d*p);for(let $=0;$<d;$++){const N=$*p;for(let R=0;R<p;R++){const E=[u,V,$,R],L=E[2],F=E[1];let G=(L-m)*b-(F-y)*w,Y=(L-m)*w+(F-y)*b;G=Math.round(G+m),Y=Math.round(Y+y);let q=i;if(typeof i!="number"&&(R===3?q=v:q=i[R]),G>=0&&G<d&&Y>=0&&Y<h){const X=Y*(d*p),re=G*p,ie=O+X+re+R;q=S[ie]}const se=O+k+N+R;l[se]=q}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wge=zt(sf,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),jge={kernelName:sf,backendName:"cpu",kernelFunc:Wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gge(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=ru(i,s,o),p=!0,m=t.bufferSync(s),y=t.bufferSync(i),v=qu(m,y,o,d,u,l,a,h,0,p);return t.makeTensorInfo(o,v.dtype,v.values)}const Hge={kernelName:vb,backendName:"cpu",kernelFunc:Gge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qge(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<e?t=s+1:r=s;return r}function Kge(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<=e?t=s+1:r=s;return r}function Xge(n,e,t,r,s,i){const o=mn("int32",t*s);for(let a=0;a<t;++a){const l=n.slice(a*r,(a+1)*r),u=a*s;for(let h=0;h<s;++h)o[u+h]=i==="left"?qge(l,e[h+u]):Kge(l,e[h+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qge(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:o}=r,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,u=Xge(a,l,s.shape[0],s.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const Yge={kernelName:bb,backendName:"cpu",kernelFunc:Qge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jge(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e;Ue([r,s,i],"select");const o=r.shape.length,a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values,h=rs(s.dtype,i.dtype),d=gr(fe(s.shape),h);let p=0;const m=o===0||o>1||s.shape.length===1?1:fe(s.shape.slice(1));for(let y=0;y<a.length;y++)for(let v=0;v<m;v++)a[y]===1?d[p++]=l[y]:d[p++]=u[y];return t.makeTensorInfo(s.shape,h,d)}const Zge={kernelName:Ug,backendName:"cpu",kernelFunc:Jge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eye=T1,tye=_1,nye=zt(af,n=>n>=0?tye*n:eye*(Math.exp(n)-1)),rye={kernelName:af,backendName:"cpu",kernelFunc:nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sye=zt(cf,n=>n<0?-1:n>0?1:0),iye={kernelName:cf,backendName:"cpu",kernelFunc:sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oye=zt(lf,n=>Math.sin(n)),aye={kernelName:lf,backendName:"cpu",kernelFunc:oye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lye=zt(uf,n=>Math.sinh(n)),uye={kernelName:uf,backendName:"cpu",kernelFunc:lye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cye=11920928955078125e-23,QO=Math.log(cye)+2,hye=zt(df,n=>{const e=n>-QO,t=n<QO,r=Math.exp(n);let s;return t?s=r:e?s=n:s=Math.log(1+r),s}),dye={kernelName:df,backendName:"cpu",kernelFunc:hye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:o}=r;Ue([s],"spaceToBatchND");const a=fe(i),l=[[0,0]];l.push(...o);for(let V=1+i.length;V<s.shape.length;++V)l.push([0,0]);const u=W4.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),h=wy(u.shape,i,a,!1),d=vy(h.length,i.length,!1),p=xy(u.shape,i,a,!1),v=Yt({inputs:{x:u},backend:t,attrs:{shape:h}}),S=ls({inputs:{x:v},backend:t,attrs:{perm:d}}),O=Yt({inputs:{x:S},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(S),O}const pye={kernelName:Gg,backendName:"cpu",kernelFunc:fye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mye(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values[0],[d,p,m,y,v]=f4(a,r.shape,r.dtype,l,s.dtype,u,h);return[t.makeTensorInfo(p,r.dtype,d),t.makeTensorInfo([p[0]],s.dtype,m),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(w=>Number(w)))),t.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}const gye={kernelName:Ib,backendName:"cpu",kernelFunc:mye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yye(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(s.dataId).values),a=t.data.get(r.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,h,d]=p4(a,r.shape,r.dtype,o,l);return[t.makeTensorInfo(h,r.dtype,u),t.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}const wye={kernelName:Sb,backendName:"cpu",kernelFunc:yye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vye(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[u,h]=g2(o,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(h,r.dtype,u)}const xye={kernelName:Tb,backendName:"cpu",kernelFunc:vye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bye(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(i.dataId).values,[u,h]=g2(o,r.shape,r.dtype,a,l);return t.makeTensorInfo(h,r.dtype,u)}const Iye={kernelName:_b,backendName:"cpu",kernelFunc:bye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sye(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:p}=ru(i,s,a),m=!1,y=t.bufferSync(s);let v;switch(i.dtype){case"bool":{const w=t.bufferSync(i),b=!!t.data.get(o.dataId).values[0];v=qu(y,w,a,p,h,u,l,d,b,m);break}case"float32":{const w=t.bufferSync(i),b=t.data.get(o.dataId).values[0];v=qu(y,w,a,p,h,u,l,d,b,m);break}case"int32":{const w=t.bufferSync(i),b=t.data.get(o.dataId).values[0];v=qu(y,w,a,p,h,u,l,d,b,m);break}case"string":{const w=t.bufferSync(i),b=ba(t.data.get(o.dataId).values[0]);v=qu(y,w,a,p,h,u,l,d,b,m);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,v.dtype,v.values)}const Tye={kernelName:Cb,backendName:"cpu",kernelFunc:Sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=ft(o,s.shape)[0],l=Nk(s,i,a),u=new Array(s.shape.length).fill(0),h=s.shape.slice();return l.map(d=>{const p=[...h];p[a]=d;const m=xc({inputs:{x:s},backend:t,attrs:{begin:u,size:p}});return u[a]+=d,m})}const Cye={kernelName:Hg,backendName:"cpu",kernelFunc:_ye};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eye={kernelName:Eb,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;Ue(t,"square");const s=r.data.get(t.dataId).values,i=new Float32Array(s.length);for(let a=0;a<s.length;++a){const l=s[a];i[a]=l*l}return{dataId:r.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kye=zt(vf,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),Nye={kernelName:vf,backendName:"cpu",kernelFunc:kye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=r;Ue(s,"stridedSlice");const{finalShapeSparse:m,finalShape:y,isIdentity:v,sliceDim0:w,isSimpleSlice:b,begin:S,end:C,strides:T}=ck(s.shape,i,o,a,l,u,h,d,p);let O;if(v)O=Yt({inputs:{x:s},backend:t,attrs:{shape:y}});else if(w||b){B(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const V=ak(S,C,T),k=xc({inputs:{x:s},backend:t,attrs:{begin:S,size:V}});O=Yt({inputs:{x:k},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(k)}else{const V=t.bufferSync(s),k=y4(m,V,T,S);O=t.makeTensorInfo(y,k.dtype,k.values)}return O}const Rye={kernelName:kb,backendName:"cpu",kernelFunc:$ye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aye(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:h,dataSplits:d}=e,p=t.data.get(h.dataId).values,m=t.data.get(d.dataId).values,[y,v]=w4(p,m,s,i,o,a,l,u);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(d.shape,"int32",v)]}const Dye={kernelName:Nb,backendName:"cpu",kernelFunc:Aye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oye(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,h,d]=v4(a,l,s),p=h.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const Pye={kernelName:$b,backendName:"cpu",kernelFunc:Oye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fye(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=x4(o,s);return t.makeTensorInfo(i.shape,"int32",a)}const Lye={kernelName:Rb,backendName:"cpu",kernelFunc:Fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mye=zt(gf,n=>Math.tan(n)),Vye={kernelName:gf,backendName:"cpu",kernelFunc:Mye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zye=zt(yf,n=>Math.tanh(n)),Bye={kernelName:yf,backendName:"cpu",kernelFunc:zye};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uye(n){const{inputs:e,backend:t}=n,{tensor:r,indices:s,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:h}=ru(i,s,r.shape),d=!1,p=t.bufferSync(s),m=t.bufferSync(i),y=t.bufferSync(r),v=qu(p,m,r.shape,h,l,a,o,u,y,d);return t.makeTensorInfo(r.shape,v.dtype,v.values)}const Wye={kernelName:xb,backendName:"cpu",kernelFunc:Uye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;Ue(s,"tile");const o=I4(t.bufferSync(s),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const Gye={kernelName:wf,backendName:"cpu",kernelFunc:jye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:o}=r;Ue(s,"topk");const a=t.data.get(s.dataId).values,[l,u]=T4(a,s.shape,s.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const qye={kernelName:Ab,backendName:"cpu",kernelFunc:Hye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kye(n){const{inputs:e,attrs:t,backend:r}=n,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[h,d,p,m]=s.shape,[y,v]=u??[d,p],w=[h,y,v,m],b=Qe(s.shape),S=b[0],C=b[1],T=b[2],O=Qe(w),V=O[0],k=O[1],$=O[2],N=Jn(s.dtype,fe(w));N.fill(l);const R=r.data.get(s.dataId).values,E=r.data.get(i.dataId).values;for(let F=0;F<h;++F){const G=i.shape[0]===1?E:E.subarray(F*8,F*8+8);for(let Y=0;Y<y;++Y)for(let q=0;q<v;++q)for(let se=0;se<m;++se){let X;const re=G[6]*q+G[7]*Y+1;if(re===0)continue;const ie=(G[0]*q+G[1]*Y+G[2])/re,j=(G[3]*q+G[4]*Y+G[5])/re,Z=YO(ie,p,a),he=YO(j,d,a);switch(o){case"nearest":X=e0e(R,d,p,S,C,T,F,he,Z,se,l);break;case"bilinear":X=t0e(R,d,p,S,C,T,F,he,Z,se,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ve=F*V+Y*k+q*$+se;N[ve]=X}return r.makeTensorInfo(w,s.dtype,N)}return{dataId:r.write(N,w,s.dtype),shape:s.shape,dtype:s.dtype}}const Xye={kernelName:Db,backendName:"cpu",kernelFunc:Kye};function YO(n,e,t){switch(t){case"reflect":return Qye(n,e);case"wrap":return Yye(n,e);case"nearest":return Zye(n,e);case"constant":default:return Jye(n)}}function Qye(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return Pl(0,t,e-1)}function Yye(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return Pl(0,t,e-1)}function Jye(n,e){return n}function Zye(n,e){return Pl(0,n,e-1)}function qp(n,e,t,r,s,i,o,a,l,u,h){const d=o*r+a*s+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[d]:h}function e0e(n,e,t,r,s,i,o,a,l,u,h){const d=Math.round(a),p=Math.round(l);return qp(n,e,t,r,s,i,o,d,p,u,h)}function t0e(n,e,t,r,s,i,o,a,l,u,h){const d=Math.floor(a),p=Math.floor(l),m=d+1,y=p+1,v=(y-l)*qp(n,e,t,r,s,i,o,d,p,u,h)+(l-p)*qp(n,e,t,r,s,i,o,d,y,u,h),w=(y-l)*qp(n,e,t,r,s,i,o,m,p,u,h)+(l-p)*qp(n,e,t,r,s,i,o,m,y,u,h);return(m-a)*v+(a-d)*w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Ue(i,"unique");const o=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=_4(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}const r0e={kernelName:Ob,backendName:"cpu",kernelFunc:n0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s0e(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s.shape.length,a=s.shape[i],l=new Array(o-1);let u=0;for(let m=0;m<o;m++)m!==i&&(l[u++]=s.shape[m]);const h=new Array(o).fill(0),d=s.shape.slice();d[i]=1;const p=new Array(a);for(let m=0;m<p.length;m++){h[i]=m;const y=xc({inputs:{x:s},backend:t,attrs:{begin:h,size:d}});p[m]=Yt({inputs:{x:y},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(y)}return p}const i0e={kernelName:Xg,backendName:"cpu",kernelFunc:s0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:o}=r;Ue(s,"unsortedSegmentSum");const a=s.shape.length,l=i.shape.length,u=[],h=[],d=a-l;let p=i;for(let y=0;y<d;++y){const v=Jv({inputs:{input:p},backend:t,attrs:{dim:y+1}});p=v,h.push(v)}for(let y=0;y<o;++y){const v=Ra(y,"int32"),w=t.makeTensorInfo([],"int32",v),b=zB({inputs:{a:w,b:p},backend:t}),S=Gl({inputs:{x:b},backend:t,attrs:{dtype:"float32"}}),C=q1({inputs:{a:S,b:s},backend:t}),T=Ry({inputs:{x:C},backend:t,attrs:{axis:0,keepDims:!1}});u.push(T),h.push(w),h.push(b),h.push(S),h.push(C),h.push(T)}const m=U4({inputs:u,backend:t,attrs:{axis:0}});return h.forEach(y=>t.disposeIntermediateTensorInfo(y)),m}const a0e={kernelName:Qg,backendName:"cpu",kernelFunc:o0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l0e=[zde,bhe,Ude,jde,Ehe,Hde,Kde,Qde,Jde,efe,nfe,sfe,ofe,ufe,hfe,pfe,gfe,wfe,xfe,Mde,Ife,Tfe,Cfe,Nhe,kfe,_he,Rhe,$fe,Ihe,Afe,Ofe,Pfe,Lfe,Vfe,Bfe,Wfe,Gfe,qfe,Xfe,Yfe,Zfe,tpe,rpe,ipe,ope,lpe,cpe,dpe,fpe,ppe,mpe,ype,xpe,Rde,Ipe,Ahe,$pe,Dhe,Rpe,Phe,Lpe,Mpe,zpe,Lhe,Vhe,Upe,jpe,Hpe,Kpe,Bhe,Whe,She,Qpe,Dfe,Jpe,eme,nme,Ade,Ghe,qhe,sme,Xhe,ome,ume,hme,pme,gme,wme,vme,Yhe,bme,Sme,_me,Eme,Nme,Rme,Dme,Zhe,Pme,Mme,rge,tde,rde,oge,uge,dge,ide,pge,gge,yge,W4,bge,Ode,lde,Sge,_ge,Ege,Nge,The,S_,Rge,Pde,Fde,Lde,Dge,Pge,Lge,Vge,Bge,Uge,jge,gde,Hge,Yge,Zge,rye,wde,iye,aye,uye,vde,tge,dye,pye,gye,wye,xye,Iye,Tye,Cye,Ide,Eye,Tde,Cde,Nye,Rye,Dye,Pye,Lye,$de,wpe,Vye,Bye,Wye,Gye,qye,Xye,ode,r0e,i0e,a0e,mge];for(const n of l0e)Fb(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ju={},mw={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function j4(n,e){ju[n]=e}function Yi(n,e){if(!(n in ju)||e!=null){const r=c0e(n,e);if(r!==null)ju[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=ju[n];return t==null||t.isContextLost()?(delete ju[n],Yi(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ju[n])}function u0e(n){if(!le().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function c0e(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??u0e(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete ju[n]},!1),le().getBool("SOFTWARE_WEBGL_ENABLED")&&(mw.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",mw)||t.getContext("experimental-webgl",mw):t.getContext("webgl2",mw)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var km;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(km||(km={}));var Gs;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Gs||(Gs={}));var pr;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(pr||(pr={}));function Ay(n,e){return[e,n]}function h0e(n,e){return n*e}function gw(n){const e=fe(n),t=Math.ceil(e/4);return Ev(t)}function Df(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function d0e(n,e){const[t,r]=Df(n,e);return t*r*4}function b2(n,e){const t=n;let r,s,i,o,a,l,u,h,d,p;return le().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,h=1,d=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(r=n.RGBA,s=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,h=4,d=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:h,textureTypeHalfFloat:d,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(n,e){const t=e();return le().getBool("DEBUG")&&f0e(n),t}function f0e(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+H4(n,e))}const p0e=596e-10,m0e=65504;function G4(n){return!!(le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||p0e<Math.abs(n)&&Math.abs(n)<m0e)}function H4(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Kp(n,e){return Ma(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function q4(n,e){const t=Ma(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Fe(n,()=>n.shaderSource(t,e)),Fe(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function K4(n,e){const t=Ma(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Fe(n,()=>n.shaderSource(t,e)),Fe(n,()=>n.compileShader(t)),le().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw I2(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const g0e=/ERROR: [0-9]+:([0-9]+):/g;function I2(n,e){const t=g0e.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],s=n.split(`
`),i=s.length.toString().length+2,o=s.map((d,p)=>Yu((p+1).toString(),i)+d);let a=0;for(let d=0;d<o.length;d++)a=Math.max(o[d].length,a);const l=o.slice(0,r-1),u=o.slice(r-1,r),h=o.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Yu(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function X4(n){return Ma(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function Q4(n,e){if(Fe(n,()=>n.linkProgram(e)),!le().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function tv(n,e){if(Fe(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Y4(n,e){const t=Ma(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Fe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Fe(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function J4(n,e){const t=Ma(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Fe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Fe(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function y0e(){return le().getNumber("WEBGL_VERSION")===2?1:4}function Z4(n){return Ma(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function eU(n,e){const t=le().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function tU(n){return Ma(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function __(n,e,t,r,s,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Fe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),Fe(n,()=>n.vertexAttribPointer(a,s,n.FLOAT,!1,i,o)),Fe(n,()=>n.enableVertexAttribArray(a)),!0)}function nU(n,e,t){aU(n,t),Fe(n,()=>n.activeTexture(n.TEXTURE0+t)),Fe(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function w0e(n,e){aU(n,e),Fe(n,()=>n.activeTexture(n.TEXTURE0+e)),Fe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function rU(n,e,t){return Ma(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function sU(n,e,t){return n.getUniformLocation(e,t)}function iU(n,e,t,r){Fe(n,()=>nU(n,e,r)),Fe(n,()=>n.uniform1i(t,r))}function v0e(n){Fe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),Fe(n,()=>n.viewport(0,0,n.canvas.width,n.canvas.height)),Fe(n,()=>n.scissor(0,0,n.canvas.width,n.canvas.height))}function nv(n,e,t){Fe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Fe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function C_(n,e){Fe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Fe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Xp(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+oU(n,e))}function oU(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Ma(n,e,t){const r=Fe(n,()=>e());if(r==null)throw new Error(t);return r}function aU(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function bc(n,e=2){return fe(n.slice(0,n.length-e))}function Ic(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Qp(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[bc(n),...Ic(n)]),e}function lU(n,e=!1){let t=le().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=le().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&le().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((a,l)=>l>=n.length-2?Nx(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=$a(n).newShape);let s=fe(n),i=null;n.length<=1&&s<=t?i=[1,s]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=bc(n);let l=2,u=2;n.length&&([l,u]=Ic(n)),s=a*(l/2)*(u/2),i=Ev(s).map(h=>h*2)}else i=Ev(s);return i}function yw(n){return n%2===0}function Nm(n,e){if(n=n.slice(-2),e=e.slice(-2),mt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||yw(t)&&yw(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&yw(n[0])&&yw(e[0])}let rv,sv;function uU(n){if(rv==null){const e=Yi(n);rv=e.getParameter(e.MAX_TEXTURE_SIZE)}return rv}function x0e(){rv=null}function b0e(){sv=null}function cU(n){if(sv==null){const e=Yi(n);sv=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,sv)}function hU(n){if(n===0)return 0;let e;const t=Yi(n);return Hs(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Hs(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Hs(n,e){return n.getExtension(e)!=null}function E_(n){try{if(Yi(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function dU(n){if(n===0)return!1;const e=Yi(n);if(n===1){if(!Hs(e,"OES_texture_float"))return!1}else if(!Hs(e,"EXT_color_buffer_float"))return!1;return k_(e)}function fU(n){if(n===0)return!1;const e=Yi(n);if(n===1){if(!Hs(e,"OES_texture_float")||!Hs(e,"WEBGL_color_buffer_float"))return!1}else{if(Hs(e,"EXT_color_buffer_float"))return k_(e);const r="EXT_color_buffer_half_float";if(Hs(e,r)){const s=e.getExtension(r);return I0e(e,s)}return!1}return k_(e)}function k_(n){const e=b2(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function I0e(n,e){const t=b2(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),a}function pU(n){return n!==2?!1:Yi(n).fenceSync!=null}function Of(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&B(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const S0e=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:Of,bindCanvasToFramebuffer:v0e,bindColorTextureToFramebuffer:nv,bindTextureToProgramUniformSampler:iU,bindTextureUnit:nU,bindVertexBufferToProgramAttribute:__,callAndCheck:Fe,canBeRepresented:G4,createFragmentShader:K4,createFramebuffer:tU,createProgram:X4,createStaticIndexBuffer:J4,createStaticVertexBuffer:Y4,createTexture:Z4,createVertexShader:q4,getBatchDim:bc,getExtensionOrThrow:Kp,getFramebufferErrorMessage:oU,getMaxTexturesInShader:cU,getNumChannels:y0e,getProgramUniformLocation:sU,getProgramUniformLocationOrThrow:rU,getRowsCols:Ic,getShapeAs3D:Qp,getTextureShapeFromLogicalShape:lU,getWebGLDisjointQueryTimerVersion:hU,getWebGLErrorMessage:H4,getWebGLMaxTextureSize:uU,hasExtension:Hs,isCapableOfRenderingToFloatTexture:dU,isDownloadFloatTextureEnabled:fU,isReshapeFree:Nm,isWebGLFenceEnabled:pU,isWebGLVersionEnabled:E_,linkProgram:Q4,logShaderSourceAndInfoLog:I2,resetMaxTextureSize:x0e,resetMaxTexturesInShader:b0e,unbindColorTextureFromFramebuffer:C_,unbindTextureUnit:w0e,validateFramebuffer:Xp,validateProgram:tv,validateTextureSize:eU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ge=le();Ge.registerFlag("HAS_WEBGL",()=>Ge.getNumber("WEBGL_VERSION")>0);Ge.registerFlag("WEBGL_VERSION",()=>E_(2)?2:E_(1)?1:0);Ge.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ge.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ge.get("WEBGL_VERSION")===2);Ge.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ge.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ge.registerFlag("WEBGL_PACK",()=>Ge.getBool("HAS_WEBGL"));Ge.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_CLIP",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_REDUCE",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_CONV_IM2COL",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ge.getBool("WEBGL_PACK"));Ge.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>uU(Ge.getNumber("WEBGL_VERSION")));Ge.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>cU(Ge.getNumber("WEBGL_VERSION")));Ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ge.getNumber("WEBGL_VERSION");return n===0?0:hU(n)});Ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ge.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!PC());Ge.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>dU(Ge.getNumber("WEBGL_VERSION")));Ge.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ge.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ge.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ge.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>fU(Ge.getNumber("WEBGL_VERSION")));Ge.registerFlag("WEBGL_FENCE_API_ENABLED",()=>pU(Ge.getNumber("WEBGL_VERSION")));Ge.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ge.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ge.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ge.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>PC()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ge.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ge.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ge.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ge.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ge.registerFlag("WEBGL_EXP_CONV",()=>!1);Ge.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ge.getBool("IS_TEST"));Ge.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ge.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ge.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ge.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kr(){let n,e,t,r,s,i,o,a,l,u;return le().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",i="outputColor",o="out vec4 outputColor;",a=le().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vc(n,e,t="index"){const r=Qe(e);return r.map((s,i)=>{const o=`int ${n[i]} = ${t} / ${s}`,a=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${s}`:`index -= ${n[i]} * ${s}`;return`${o}; ${a};`}).join("")}function K1(n,e,t="index"){const r=Qe(e);return r.map((s,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function T0e(n,e){const t=n.length,r=n.map(i=>`${e}[${i}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let i=t-3;i>=0;--i)s[i]=`(${s[i+1]} * ${r[i+1]})`;return s}function _0e(n,e,t="index"){const r=n.map((i,o)=>o),s=T0e(r,e);return s.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${s[o]}`,l=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${s[o]}`:`index -= ${n[o]} * ${s[o]}`;return`${a}; ${l};`}).join("")}function S2(n){const e=Qe(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function T2(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const mU=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:gU}=K3;function C0e(n,e,t){const r=[];if(n.forEach(m=>{const y=fe(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?r.push(`uniform float ${m.name}${y>1?`[${y}]`:""};`):(r.push(`uniform sampler2D ${m.name};`),r.push(`uniform int offset${m.name};`)),t.enableShapeUniforms){const{uniformShape:v}=_2(t.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(v.length){case 1:r.push(`uniform int ${m.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${m.name}Shape;`);break}r.push(`uniform ivec2 ${m.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(m=>{r.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});const s=r.join(`
`),i=n.map(m=>E0e(m,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=Kr(),l=$0e(a);let u,h,d=D0e(a);return e.isPacked?(u=k0e(e.logicalShape,o,t.enableShapeUniforms),h=A0e(a)):(u=N0e(e.logicalShape,o,t.enableShapeUniforms),h=R0e(a)),t.packedInputs&&(d+=L0e),[d,l,h,s,u,i,t.userCode].join(`
`)}function Pf(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return X0e(n,e);case 1:return Y0e(n,e);case 2:return Z0e(n,e);case 3:return twe(n,e);case 4:return rwe(n,e);case 5:return swe(n);case 6:return iwe(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function yU(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return K0e(n);case 1:return Q0e(n,e);case 2:return J0e(n,e);case 3:return ewe(n,e);default:return nwe(n,e)}}function E0e(n,e,t=!1,r){let s="";t?s+=yU(n,r):s+=Pf(n,r);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?s+=owe(n,e):s+=awe(n,e)),s}function k0e(n,e,t){switch(n.length){case 0:return wU();case 1:return M0e(n,e,t);case 2:return H0e(n,e,t);case 3:return z0e(n,e,t);default:return U0e(n,e,t)}}function N0e(n,e,t){switch(n.length){case 0:return wU();case 1:return V0e(n,e,t);case 2:return q0e(n,e,t);case 3:return B0e(n,e,t);case 4:return W0e(n,e,t);case 5:return j0e(n,e);case 6:return G0e(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function $0e(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function R0e(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function A0e(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function D0e(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${O0e}
    ${P0e}
    ${F0e}
  `}const O0e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,P0e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,F0e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,L0e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function wU(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function M0e(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function V0e(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function z0e(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[2]/2),i=s*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function B0e(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${K1(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=Vc(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function U0e(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[n.length-1]/2),i=s*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${n.length}(${l});
    }
  `}function W0e(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${K1(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=Vc(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function j0e(n,e){const t=Vc(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function G0e(n,e){const t=Vc(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function H0e(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(mt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function q0e(n,e,t){return mt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function zc(n){return`offset${n}`}function K0e(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Kr();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function X0e(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,i]=n.shapeInfo.texShape;if(s===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=zc(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function Q0e(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=n.shapeInfo.texShape,i=Kr();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function Y0e(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Ff(n)}
      }
    `;const s=n.shapeInfo.texShape,i=s[0],o=s[1];if(o===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=zc(t);return o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function J0e(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=Kr();if(i!=null&&mt(t,i))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],h=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function Z0e(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&mt(t,i)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const p=i[0],m=i[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=$a(t),l=o;if(l.length<t.length){const p=Lf(n,l),m=["row","col"];return`
      ${Pf(p,e)}
      float ${s}(int row, int col) {
        return ${s}(${Mf(m,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Ff(n)}
      }
    `;const u=i[0],h=i[1],d=zc(r);return h===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${r}, uv);
    }
  `:u===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${d};
    vec2 uv = uvFromFlat(${u}, ${h}, index);
    return sampleTexture(${r}, uv);
  }
`}function ewe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),m=[1,2],y=Lf(n,p),v=["b","row","col"];return`
        ${yU(y,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${Mf(v,m)});
        }
      `}const a=Kr();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=o[0],u=o[1],h=Math.ceil(t[2]/2),d=h*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${d}, ${h}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function twe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=$a(t),u=a;if(u.length<t.length){const v=Lf(n,u),w=["row","col","depth"];return`
        ${Pf(v,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${Mf(w,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Ff(n)}
      }
    `;const h=n.shapeInfo.texShape,d=h[0],p=h[1],m=n.shapeInfo.flatOffset;if(p===i&&m==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${d}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(p===o&&m==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `;const y=zc(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${y};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${y};
        vec2 uv = uvFromFlat(${d}, ${p}, index);
        return sampleTexture(${r}, uv);
      }
  `}function nwe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Kr();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],h=l[1],d=Math.ceil(i[o-1]/2);let p=d*Math.ceil(i[o-2]/2),m="int b, int row, int col",y=`b * ${p} + (row / 2) * ${d} + (col / 2)`;for(let v=2;v<o-1;v++)m=`int b${v}, `+m,p*=i[o-v-1],y=`b${v} * ${p} + `+y;return`
    vec4 ${r}(${m}) {
      int index = ${y};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${u});
      return ${s.texture2D}(${t}, uv);
    }
  `}function rwe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=$a(t);if(l.length<t.length){const S=Lf(n,l),C=["row","col","depth","depth2"];return`
      ${Pf(S,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${Mf(C,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Ff(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],m=d[1],y=`int stride2 = ${r}Shape[3];`,v=`int stride1 = ${r}Shape[2] * stride2;`,w=`int stride0 = ${r}Shape[1] * stride1;`;if(m===a&&h==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${y}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(m===i&&h==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;const b=zc(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${y}
      ${v}
      ${w}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${b});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${m}, index + ${b});
      return sampleTexture(${r}, uv);
    }
  `}function swe(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],i=e[3]*s,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=$a(e);if(l.length<e.length){const v=Lf(n,l),w=["row","col","depth","depth2","depth3"];return`
      ${Pf(v)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Mf(w,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${s})) +
          depth3;
        ${Ff(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],m=d[1];if(m===a&&h==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(m===s&&h==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=zc(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${s} + depth3 + ${y};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${t}, uv);
    }
  `}function iwe(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:i}=$a(e);if(s.length<e.length){const w=Lf(n,s),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${Pf(w)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Mf(b,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,h=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Ff(n)}
      }
    `;const d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],y=p[1];if(y===h&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===o&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const v=zc(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${m}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Ff(n){const e=n.name,t=fe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function owe(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=gU(n.shapeInfo.logicalShape,e.logicalShape),l=Wt(o),u=o-i;let h;const d=["x","y","z","w","u","v"];i===0?h="":o<2&&a.length>=1?h="coords = 0;":h=a.map(S=>`coords.${d[S+u]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((S,C)=>`coords.${d[C+u]}`).join(", ");let m="return outputValue;";const v=fe(n.shapeInfo.logicalShape)===1,b=fe(e.logicalShape)===1;if(i===1&&!v&&!b)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!b)o===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(a.length){const S=i-2,C=i-1;a.indexOf(S)>-1&&a.indexOf(C)>-1?m="return vec4(outputValue.x);":a.indexOf(S)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(C)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${r}(${p});
      ${m}
    }
  `}function awe(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&mt(o,i))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Wt(l),h=gU(n.shapeInfo.logicalShape,e.logicalShape),d=l-a;let p;const m=["x","y","z","w","u","v"];a===0?p="":l<2&&h.length>=1?p="coords = 0;":p=h.map(v=>`coords.${m[v+d]} = 0;`).join(`
`);let y="";return l<2&&a>0?y="coords":y=n.shapeInfo.logicalShape.map((v,w)=>`coords.${m[w+d]}`).join(", "),`
    float ${s}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${r}(${y});
    }
  `}function Wt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function _2(n,e,t){const{newShape:r,keptDims:s}=$a(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):r,l=!n&&i>1&&!mt(e,t)&&r.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:s}}function Lf(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Mf(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lwe(n,e,t,r){const s=t.map((h,d)=>{const p={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(p.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:p}}),i=s.map(h=>h.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=C0e(s,o,e),l=K4(n.gl,a),u=n.createProgram(l);return le().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},vU(n,e,u)))}function vU(n,e,t){const r=[],s=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),le().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const h=!1;for(const d of e.variableNames){const p={name:d,uniform:n.getUniformLocation(t,d,h),offset:n.getUniformLocation(t,`offset${d}`,h)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${d}Shape`,h),p.texShape=n.getUniformLocation(t,`${d}TexShape`,h)),r.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",h),a=n.getUniformLocation(t,"outShapeStrides",h),o=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms)for(const d of e.customUniforms)s.push(n.getUniformLocation(t,d.name,h));return{variablesLocations:r,customUniformLocations:s,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function JO(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const s=t.logicalShape,i=e[r],o=i.shape;if(!mt(s,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!mt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function uwe(n,e,t,r,s){e.program.enableShapeUniforms||(JO(e.inShapeInfos,t),JO([e.outShapeInfo],[r]));const i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),le().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:h,offset:d,shape:p,texShape:m}=e.variablesLocations[l];if(p){const{uniformShape:y}=_2(e.program.packedInputs,u.shape,u.texData.texShape);switch(y.length){case 1:n.gl.uniform1iv(p,new Int32Array(y));break;case 2:n.gl.uniform2iv(p,new Int32Array(y));break;case 3:n.gl.uniform3iv(p,new Int32Array(y));break;case 4:n.gl.uniform4iv(p,new Int32Array(y));break}}if(m&&n.gl.uniform2i(m,u.texData.texShape[0],u.texData.texShape[1]),h!=null){if(u.isUniform){if(fe(u.shape)<2)n.gl.uniform1f(h,u.uniformValues[0]);else{let y=u.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),n.gl.uniform1fv(h,y)}continue}u.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,h,l)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=Qe(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],h=e.customUniformLocations[l],d=s[l];if(u.type==="float")n.gl.uniform1fv(h,d);else if(u.type==="vec2")n.gl.uniform2fv(h,d);else if(u.type==="vec3")n.gl.uniform3fv(h,d);else if(u.type==="vec4")n.gl.uniform4fv(h,d);else if(u.type==="int")n.gl.uniform1iv(h,d);else if(u.type==="ivec2")n.gl.uniform2iv(h,d);else if(u.type==="ivec3")n.gl.uniform3iv(h,d);else if(u.type==="ivec4")n.gl.uniform4iv(h,d);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function cwe(n,e,t){let r="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:h,keptDims:d}=_2(n.packedInputs,o.shape,l);let p="",m="",y="";if(h.length===1&&n.packedInputs){const O=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${O[0]>1}_${O[1]>1}`}else if(h.length===2&&!n.packedInputs)m=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!n.packedInputs){const O=Qe(h);y=`${O[0]===l[1]}_${O[O.length-1]===l[1]}`}const v=o.shape.length,w=h.length===2&&mt(o.shape,l),b=fe(o.shape)===1,S=dc(o.shape,t.shape),C=!n.packedInputs&&v===t.shape.length&&mt(l,t.texData.texShape),T=n.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${v}_${C}_${u?d:""}_${h.length}_${b}_${S}_${w}_${p}_${m}_${y}_${T}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${l}_${a}`}});const s=n.userCode;let i=n.constructor.name;return i+="_"+r+"_"+s+`${le().getNumber("WEBGL_VERSION")}`,i}function $r(n){return le().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hwe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=km.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Kr();this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?K1(["r","c","d"],e):Vc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dwe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=km.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Kr();this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?K1(["r","c","d"],e):Vc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fwe{constructor(e){this.variableNames=["A"],this.outTexUsage=Gs.DOWNLOAD;const t=Kr();this.outputShape=e,this.userCode=`
      ${mU}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pwe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Gs.DOWNLOAD;const t=Kr();this.outputShape=e,this.userCode=`
      ${mU}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mwe={R:0,G:1,B:2,A:3};class ZO{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Kr();this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const l=r[a];o+=`
          if(offset == ${a}) {
            result = values[${mwe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?T2():S2(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${o}
        }
        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gwe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Kr();this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length);let s="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;s+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?T2():S2(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xU(n){const e=Kr(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return q4(n,t)}function bU(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Y4(n,e)}function IU(n){const e=new Uint16Array([0,1,2,2,1,3]);return J4(n,e)}function Dy(n,e,t,r,s,i){eU(e,t);const o=Z4(n),a=n.TEXTURE_2D;return Fe(n,()=>n.bindTexture(a,o)),Fe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Fe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Fe(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Fe(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),le().getNumber("WEBGL_VERSION")===1?Fe(n,()=>n.texImage2D(a,0,r,e,t,0,s,i,null)):Fe(n,()=>n.texStorage2D(a,1,r,e,t)),Fe(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function C2(n){return n.internalFormatFloat}function SU(n,e,t,r){const[s,i]=Ay(e,t);return Dy(n,s,i,C2(r),r.textureFormatFloat,n.FLOAT)}function E2(n){return n.internalFormatHalfFloat}function TU(n,e,t,r){const[s,i]=Ay(e,t);return Dy(n,s,i,E2(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function k2(n){return n.downloadTextureFormat}function _U(n,e,t,r){const[s,i]=Ay(e,t);return Dy(n,s,i,k2(r),n.RGBA,n.UNSIGNED_BYTE)}function N2(n){return n.internalFormatPackedFloat}function CU(n,e,t,r){const[s,i]=Df(e,t);return Dy(n,s,i,N2(r),n.RGBA,n.FLOAT)}function $2(n){return n.internalFormatPackedHalfFloat}function EU(n,e,t,r){const[s,i]=Df(e,t);return Dy(n,s,i,$2(r),n.RGBA,r.textureTypeHalfFloat)}function kU(n,e,t){return Fe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),__(n,e,"clipSpacePos",t,3,20,0)&&__(n,e,"uv",t,2,20,12)}function NU(n,e,t,r,s,i){Fe(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;s instanceof Uint8Array?(o=new Uint8Array(t*r*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*r*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(s),le().getNumber("WEBGL_VERSION")===2?Fe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,a,o)):Fe(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,r,0,n.RGBA,a,o)),Fe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function $U(n,e,t){Fe(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?le().getNumber("WEBGL_VERSION")===2?Fe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Fe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):le().getNumber("WEBGL_VERSION")===2?Fe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Fe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Fe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function RU(n,e,t,r){const s=n.createBuffer();Fe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,s));const a=4*4*e*t;return Fe(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Fe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Fe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),s}function AU(n,e,t){const r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function DU(n,e,t,r){const[s,i]=Ay(e,t),o=4,a=new Uint8Array(h0e(e*t,o));return Fe(n,()=>n.readPixels(0,0,s,i,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function OU(n,e,t,r,s,i,o,a){const l=n,u=new Float32Array(d0e(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function PU(n,e,t){const r=new Float32Array(e*t*4);return Fe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}const ywe=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:kU,createBufferFromOutputTexture:RU,createFloat16MatrixTexture:TU,createFloat16PackedMatrixTexture:EU,createFloat32MatrixTexture:SU,createIndexBuffer:IU,createPackedMatrixTexture:CU,createUnsignedBytesMatrixTexture:_U,createVertexBuffer:bU,createVertexShader:xU,downloadByteEncodedFloatMatrixFromOutputTexture:DU,downloadFloat32MatrixFromBuffer:AU,downloadMatrixFromPackedOutputTexture:PU,downloadPackedMatrixFromBuffer:OU,getInternalFormatForFloat16MatrixTexture:E2,getInternalFormatForFloat16PackedMatrixTexture:$2,getInternalFormatForFloat32MatrixTexture:C2,getInternalFormatForPackedMatrixTexture:N2,getInternalFormatForUnsignedBytesMatrixTexture:k2,uploadDenseMatrixToTexture:NU,uploadPixelDataToTexture:$U},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iv{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=le().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,j4(t,e)):this.gl=Yi(t),e=this.gl,le().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Fe(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Fe(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Fe(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Fe(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Fe(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Fe(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Fe(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Fe(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),le().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Kp(this.gl,i),Hs(this.gl,o))this.textureHalfFloatExtension=Kp(this.gl,o);else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Hs(this.gl,s))this.colorBufferHalfFloatExtension=Kp(this.gl,s);else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Hs(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Hs(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=bU(this.gl),this.indexBuffer=IU(this.gl),this.framebuffer=tU(this.gl),this.textureConfig=b2(this.gl,this.textureHalfFloatExtension)}get debug(){return le().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Fe(e,()=>e.finish()),Fe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Fe(e,()=>e.deleteFramebuffer(this.framebuffer)),Fe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Fe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Fe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),SU(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),TU(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),_U(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),$U(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),NU(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),EU(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),CU(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(C_(this.gl,this.framebuffer),this.outputTexture=null),Fe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>DU(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,i,o){return OU(this.gl,e,t,r,s,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return AU(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=RU(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(le().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const o=s.clientWaitSync(i,0,0);return o===s.ALREADY_SIGNALED||o===s.CONDITION_SATISFIED},t=i}else le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>PU(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=xU(t));const r=X4(t);Fe(t,()=>t.attachShader(r,this.vertexShader)),Fe(t,()=>t.attachShader(r,e)),Q4(t,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&tv(t,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Fe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),kU(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Fe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&tv(this.gl,this.program),Fe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?rU(this.gl,e,t):sU(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Fe(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),iU(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,i]=Df(t,r);this.setOutputMatrixTextureDriver(e,s,i)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&tv(this.gl,this.program),Xp(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Fe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Fe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Kp(this.gl,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await FT(()=>this.disposed||this.isQueryAvailable(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=wwe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in le().platform&&(r=le().platform.setTimeoutCustom.bind(le().platform)),FT(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),nv(this.gl,e,this.framebuffer),this.debug&&Xp(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(nv(this.gl,this.outputTexture,this.framebuffer),this.debug&&Xp(this.gl)):C_(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;nv(s,e,this.framebuffer),this.debug&&Xp(s),this.outputTexture=e,Fe(s,()=>s.viewport(0,0,t,r)),Fe(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),Fe(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function wwe(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:vwe,bincountImpl:FU,bincountReduceImpl:xwe,bitwiseAndImpl:bwe,castImpl:Iwe,ceilImpl:Swe,concatImpl:Twe,equalImpl:_we,expImpl:Cwe,expm1Impl:Ewe,floorImpl:kwe,gatherNdImpl:Nwe,gatherV2Impl:$we,greaterImpl:Rwe,greaterEqualImpl:Awe,lessImpl:Dwe,lessEqualImpl:Owe,linSpaceImpl:Pwe,logImpl:Fwe,maxImpl:Lwe,maximumImpl:Mwe,minimumImpl:Vwe,multiplyImpl:zwe,negImpl:Bwe,notEqualImpl:Uwe,prodImpl:Wwe,raggedGatherImpl:jwe,raggedRangeImpl:Gwe,raggedTensorToTensorImpl:Hwe,rangeImpl:qwe,rsqrtImpl:Kwe,scatterImpl:Xwe,sigmoidImpl:Qwe,simpleAbsImpl:LU,sliceImpl:Ywe,sparseFillEmptyRowsImpl:Jwe,sparseReshapeImpl:Zwe,sparseSegmentReductionImpl:MU,sqrtImpl:eve,staticRegexReplaceImpl:tve,stridedSliceImpl:nve,stringNGramsImpl:rve,stringSplitImpl:sve,stringToHashBucketFastImpl:ive,subImpl:ove,tileImpl:ave,topKImpl:lve,transposeImpl:R2,uniqueImpl:uve}=C4;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VU(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Ur(n,e){return e===1?[n]:VU(n,e)}function cve(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hve{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=$r(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Ur("rc",this.rank),r=Wt(this.rank),s=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let i=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zU{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length);let r="";for(let s=0;s<4;s++){let i="thisRC = rc;";s%2===1&&(i+="thisRC.z += 1;"),s>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${dve(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?T2():S2(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function dve(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?_0e(["r","c","d"],"inputShape"):Vc(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fve{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const s=tP(t,r),i=nP(e,s,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=eP(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return s===pr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===pr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===pr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===pr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===pr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const i=tP(r,s),o=nP(t,i,s);o in this.freeTextures||(this.freeTextures[o]=[]);const a=eP(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,s),l=le().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],h=u&&u.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[h]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function pve(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function eP(n,e,t,r,s){const i=mve(e,r);let o;if(s){const[l,u]=Df(n[0],n[1]);o=l*u}else{const[l,u]=Ay(n[0],n[1]);o=l*u}const a=pve(t,i);return o*a}function mve(n,e){switch(n){case pr.PACKED_2X2_FLOAT32:return N2(e);case pr.PACKED_2X2_FLOAT16:return $2(e);case pr.UNPACKED_FLOAT32:return C2(e);case pr.UNPACKED_FLOAT16:return E2(e);case pr.PACKED_4X1_UNSIGNED_BYTE:return k2(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function gve(n){return le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?pr.PACKED_2X2_FLOAT32:pr.UNPACKED_FLOAT32:n?pr.PACKED_2X2_FLOAT16:pr.UNPACKED_FLOAT16}function tP(n,e){if(n===Gs.UPLOAD)return pr.PACKED_2X2_FLOAT32;if(n===Gs.RENDER||n==null)return gve(e);if(n===Gs.DOWNLOAD||n===Gs.PIXELS)return pr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function nP(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xo{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const yi="if (isnan(x)) return x;",yve="return x;",rP="return abs(x);",wve="return (x >= 0.0) ? x : (exp(x) - 1.0);",vve=yi+`
  return (x < 0.0) ? 0.0 : x;
`,xve=yi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,cl="return x;",bve="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ive="return x;",Sve=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Tve=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_ve=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Cve="return 1.0 / (1.0 + exp(-1.0 * x));";class vl{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eve{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length);const t=e.length,r=Ur("rc",t),s=Wt(t),i=cve(t,r),o=r.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kve=h1,Nve=1e-7,$ve=1e-4,ww={};function Rve(n){return n in ww||(ww[n]={}),ww[n]}const Ave=le().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Dve=600;function Ove(){return le().global.screen==null?1024:le().global.screen.height*le().global.screen.width*window.devicePixelRatio*Dve/1024/1024}class Oy extends kx{nextDataId(){return Oy.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!le().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof iv)t=e;else{const r=Yi(le().getNumber("WEBGL_VERSION"),e);t=new iv(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Yi(le().getNumber("WEBGL_VERSION"));t=new iv(r),this.binaryCache=Rve(le().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new fve(this.gpgpu),this.numMBBeforeWarning=Ove(),this.texData=new EC(this,Vi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,s,i,o){const a=this.makeTensorInfo(t,r),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[s,i]},l.texShape=[s,i];const u=Qp(t),h=new ZO(u,!1,o),d=this.runWebGLProgram(h,[a],r,[[s,i]]);return d.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,t,r){if((le().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||le().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:Gs.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,i){if(le().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:Gs.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new vl(a,cl):p=new xo(a,cl);const m=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:s}],s),y=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),y}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const u=this.activeTimers!=null;let h;u&&(h=hr());let d;if(s==="complex64"){const p=this.readSync(i.real.dataId),m=this.readSync(i.imag.dataId);d=_a(p,m)}else d=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=hr()-h),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const y=this.pendingRead.get(e);return new Promise(v=>y.push(v))}const t=this.texData.get(e),{values:r,shape:s,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let y;l?y=new vl(s,cl):y=new xo(s,cl);const v=this.runWebGLProgram(y,[{dataId:e,shape:s,dtype:o}],o),w=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),w}if(r!=null)return this.convertAndCacheOnCPU(e);if(le().getBool("DEBUG")&&!le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&le().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,h;if(o!=="complex64"&&le().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const y=this.texData.get(h.dataId);u=this.gpgpu.createBufferFromTexture(y.texture.texture,...gw(s))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(o==="complex64"){const y=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),v=y[0],w=y[1];d=_a(v,w)}else if(u==null)d=this.getValuesFromTexture(e);else{const y=fe(s);d=this.gpgpu.downloadFloat32MatrixFromBuffer(u,y)}if(h!=null&&this.disposeIntermediateTensorInfo(h),u!=null){const y=this.gpgpu.gl;Fe(y,()=>y.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,d),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(y=>y(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Vi().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let m;l?m=new vl(i,cl):m=new xo(i,cl);const y=this.runWebGLProgram(m,[{dataId:e,shape:i,dtype:a}],a),v=this.readToGPU(y,t);return this.disposeIntermediateTensorInfo(y),v}if(u==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,t.customTexShape),d=Vi().makeTensorFromTensorInfo(h),p=this.texData.get(h.dataId);return Object.assign({tensorRef:d},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>ba(s));return ht(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ht(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!G4(r))throw le().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),i=fe(t);if(le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),m=this.texData.get(p.dataId),y=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...gw(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),y}const o=le().getBool("WEBGL_PACK")&&s===!0,a=o?Qp(t):t,l=o?new pwe(a):new fwe(a),u=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),h=this.texData.get(u.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),d}timerAvailable(){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const i=Oo(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Oo(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=dM(l),a.getExtraProfileInfo=()=>l.map((u,h)=>({name:o[h],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:hr(),endMs:null}}endTimer(e){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=hr(),e)}async getQueryTime(e){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,i,o)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=Ave){return le().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&fe(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Bs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return kve(e.shape,t)}packedUnaryOp(e,t,r){const s=new vl(e.shape,t),i=this.compileAndRun(s,[e],r);return Vi().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=LU(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,rP,e.dtype);const t=new xo(e.shape,rP),r=this.compileAndRun(t,[e]);return Vi().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&vo(r[0])){const i=r.map(o=>Eo(o));s=this.write(i,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return Vi().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new Eve(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new hve(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[bc(e.shape),...Ic(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},i=[bc(t),...Ic(t)],o=new zU(i,r),a=!0,l=[r],u=this.runWebGLProgram(o,[s],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:i,dtype:o}=r;if(t!=null){const p=fe(i),m=t[0]*t[1]*4;B(p<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Qp(i);let l;s?l=new dwe(a):l=new hwe(a);const u=!0,h=[t??gw(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,h,u,t);return{dtype:o,shape:i,dataId:d.dataId}}runWebGLProgram(e,t,r,s,i=!1,o){const a=this.makeTensorInfo(e.outputShape,r),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===km.DENSE){const b=o??gw(e.outputShape);l.texShape=b.map(S=>S*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),fe(a.shape)===0)return l.values=Jn(a.dtype,0),a;const u=[],h=t.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let S=this.texData.get(b.dataId);if(S.texture==null){if(!e.packedInputs&&fe(b.shape)<=le().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:S.values};e.packedInputs&&(S.isPacked=!0,S.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!S.isPacked!=!!e.packedInputs)b=S.isPacked?this.unpackTensor(b):this.packTensor(b),u.push(b),S=this.texData.get(b.dataId);else if(S.isPacked&&!Nm(S.shape,b.shape)){const C=b,T=b.shape;b.shape=S.shape,b=this.packedReshape(b,T),u.push(b),S=this.texData.get(b.dataId),C.shape=T}return{shape:b.shape,texData:S,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},p=cwe(e,h,d),m=this.getAndSaveBinary(p,()=>lwe(this.gpgpu,e,h,d)),y=this.activeTimers!=null;let v;y&&(v=this.startTimer()),le().get("ENGINE_COMPILE_ONLY")||uwe(this.gpgpu,m,h,d,s),u.forEach(b=>this.disposeIntermediateTensorInfo(b)),y&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const w=le().getNumber("WEBGL_FLUSH_THRESHOLD");if(w>0){const b=hr();b-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!le().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const b=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),b}return a}compileAndRun(e,t,r,s,i=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(le().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ae(()=>{if(!le().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=le().getBool("DEBUG");le().set("DEBUG",!1);const t=this.abs(Xe(1e-8)).dataSync()[0];if(le().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Nve:$ve}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let h;u&&(h=hr());let d=t.texShape;if(d==null&&(d=lU(r,l),t.texShape=d),i!=null){const p=Qp(r);let m,y=d[1],v=d[0];const w=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!w)&&([y,v]=Df(d[0],d[1])),l?m=new gwe(p,w):m=new ZO(p,w);const b=w?[v,y]:d,S=this.makeTensorInfo(b,s),C=this.texData.get(S.dataId);w?C.usage=Gs.PIXELS:C.usage=Gs.UPLOAD,C.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(S.dataId),y,v,i);const T=[[v,y]],V=this.runWebGLProgram(m,[S],s,T,!0),k=this.texData.get(V.dataId);t.texShape=k.texShape,t.isPacked=k.isPacked,t.usage=k.usage,le().get("ENGINE_COMPILE_ONLY")?this.disposeData(V.dataId):(t.texture=k.texture,t.values=null,this.texData.delete(V.dataId)),this.disposeIntermediateTensorInfo(S),u&&(this.uploadWaitMs+=hr()-h)}else{const p=this.acquireTexture(d,a,s,l);t.texture=p}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return t!=null&&(r.values=Pve(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*fm(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(i){throw i}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await hk(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(I2(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:s,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=vU(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:s,height:i,width:o,channels:a}=e,l=Vi().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(s,t,r,i,o,a);return Vi().makeTensorFromDataId(u,t,r,l)}}Oy.nextDataId=0;function Pve(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/** @license See the LICENSE file. */const BU="4.22.0";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UU(){le().set("WEBGL_FORCE_F16_TEXTURES",!0)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */FC()&&MC("webgl",()=>new Oy,2);const Fve={forceHalfFloat:UU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Sc{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=at(t,r),this.enableShapeUniforms=$r(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Vf{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=at(t,r);const i=this.outputShape.length;this.enableShapeUniforms=$r(i);let o="";if(s)if(i===0||fe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Wt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Ur("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Lve={kernelName:jd,backendName:"webgl",kernelFunc:$s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iu(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(i.dataId),a=$s({inputs:{x:r},backend:t}),l=$s({inputs:{x:s},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const Mve={kernelName:Lx,backendName:"webgl",kernelFunc:iu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU="return (a < 0.) ? b * a : a;",jU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Vve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r,o=t.makeTensorInfo([],"float32",Ra(i,"float32")),a=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vf(jU,s.shape,o.shape):new Sc(WU,s.shape,o.shape),l=t.runWebGLProgram(a,[s,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const zve={kernelName:yg,backendName:"webgl",kernelFunc:Vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU="return (a < 0.) ? b * a : a;",HU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Bve(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e,i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vf(HU,r.shape,s.shape):new Sc(GU,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],"float32")}const Uve={kernelName:Fg,backendName:"webgl",kernelFunc:Bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zf="if (isnan(x)) return x;";function kt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:i})=>{const{x:o}=s,a=i,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const d=a.texData.get(o.dataId),p=t(d.values,l);return a.makeTensorInfo(o.shape,l,p)}const u=le().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return u?h=new vl(o.shape,e):h=new xo(o.shape,n),a.runWebGLProgram(h,[o],l)}}function br({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,h=a;if(r&&l.dtype==="complex64"){const y=h.texData.get(l.dataId),v=h.texData.get(u.dataId),[w,b]=[[y.complexTensorInfos.real,v.complexTensorInfos.real],[y.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(C=>{const[T,O]=C,V={dataId:T.dataId,dtype:T.dtype,shape:l.shape},k={dataId:O.dataId,dtype:O.dtype,shape:u.shape},$=new Sc(n,l.shape,u.shape);return h.runWebGLProgram($,[V,k],rs(T.dtype,O.dtype))}),S=iu({inputs:{real:w,imag:b},backend:h});return h.disposeIntermediateTensorInfo(w),h.disposeIntermediateTensorInfo(b),S}const d=i||rs(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||h.shouldExecuteOnCPU([l,u]))&&s!=null){const y=h.texData.get(l.dataId).values,v=h.texData.get(u.dataId).values,w=l.dtype==="string"?Ca(y):y,b=l.dtype==="string"?Ca(v):v,[S,C]=s(l.shape,u.shape,w,b,d),T=h.makeTensorInfo(C,d),O=h.texData.get(T.dataId);return O.values=S,T}const p=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let m;return p?m=new Vf(e,l.shape,u.shape,t):m=new Sc(n,l.shape,u.shape),h.runWebGLProgram(m,[l,u],d)}}function $m(n,e=!1){if(n==="linear")return e?Ive:yve;if(n==="relu")return e?Tve:vve;if(n==="elu")return e?Sve:wve;if(n==="relu6")return e?_ve:xve;if(n==="prelu")return e?HU:GU;if(n==="leakyrelu")return e?jU:WU;if(n==="sigmoid")return e?Cve:bve;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qU{constructor(e,t,r,s=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=$r(this.outputShape.length);const h=s?e[1]:e[2],d=Math.ceil(h/2),p=s?"i * 2, rc.y":"rc.y, i * 2",m=i?"rc.z, i * 2":"i * 2, rc.z",y=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let w="",b="";a&&(l?w=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?w=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:w=`vec4 activation(vec4 x) {
          ${a}
        }`,b="result = activation(result);");const S=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let C="rc.x",T="rc.x";e[0]<t[0]?C=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(T=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${w}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${C};
        int batchB = ${T};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${y[0]} * ${v[0]});
          result += (${y[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${S}

        ${b}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class iP{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=at(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP="return a * b;";function D2(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=rs(r.dtype,s.dtype);if(r.dtype==="complex64"){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),u=new iP(sP.REAL,r.shape,s.shape),h=new iP(sP.IMAG,r.shape,s.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],p=t.runWebGLProgram(u,d,"float32"),m=t.runWebGLProgram(h,d,"float32"),y=iu({inputs:{real:p,imag:m},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),y}if(t.shouldExecuteOnCPU([r,s])){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),[u,h]=zwe(r.shape,s.shape,a.values,l.values,i),d=t.makeTensorInfo(h,i),p=t.texData.get(d.dataId);return p.values=u,d}let o;return le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Vf(oP,r.shape,s.shape):o=new Sc(oP,r.shape,s.shape),t.runWebGLProgram(o,[r,s],i)}const Wve={kernelName:Zd,backendName:"webgl",kernelFunc:D2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jve(n,e,t){const r=[bc(n.shape),...Ic(n.shape)],s={dtype:n.dtype,shape:r,dataId:n.dataId},i=[bc(e),...Ic(e)],o=new zU(i,r),a=!0,l=[r],u=t.runWebGLProgram(o,[s],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,o=t,a=fe(s.shape),l=NC(i,a),u=fe(l);B(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const h=o.texData.get(s.dataId);return h.isPacked&&!Nm(s.shape,l)&&!(h.texture!==null&&Nm(h.shape,l))?jve(s,l,o):(o.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype})}const Gve={kernelName:Mg,backendName:"webgl",kernelFunc:Oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aP{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];const a=Math.floor(r/4)*4,l=r%4;let u="sumValue += dot(values, ones);";if(t!=null){const d=1/t;u=`sumValue += dot(values * ${oc(d)?d.toPrecision(2):d}, ones);`}let h="";i%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hve{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const h=Math.floor(r/4)*4,d=r%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let y="";i%r>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qve(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=S1(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function Uc(n,e,t,r){const s=qve(n.shape);let i=n;for(let o=0;o<s.length;o++){const{inSize:a,windowSize:l,outSize:u}=s[o];let h,d;t==="mean"?h=o===0?new aP({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new aP({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):h=new Hve({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),d=i,i=r.runWebGLProgram(h,[i],e),d.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(d)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kve{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[t[o]];this.outputShape=r,this.rank=r.length;const s=Wt(this.rank),i=Xve(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Xve(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<n.length;s++)r[n[s]]=t[s];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qve{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let h=0;h<r.length;h++)r[h]=e[t[h]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=Wt(this.rank),i=VU("rc",this.rank),o=new Array(this.rank);for(let h=0;h<t.length;h++)o[t[h]]=i[h];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X1(n,e,t){const r=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qve(n.shape,e):new Kve(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yve(n,e,t,r){const s=e,i=n.shape.length,o=ft(s,n.shape);let a=o;const l=dn(a,i),u=l!=null;let h=n;u&&(h=X1(n,l,r),a=bn(a.length,i)),vr("sum",a,i);const[d,p]=nr(h.shape,a);let m=d;t&&(m=xn(d,o));const y=fe(p),w=fe(n.shape)/y,b=Oe({inputs:{x:h},attrs:{shape:[w,y]},backend:r}),S=Lb(n.dtype),C=Uc(b,S,"sum",r),T=Oe({inputs:{x:C},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(C),u&&r.disposeIntermediateTensorInfo(h),T}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q1(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r;return Yve(s,i,o,t)}const Jve={kernelName:jg,backendName:"webgl",kernelFunc:Q1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gr(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{perm:i}=r,o=t,a=s.shape.length,l=new Array(a);for(let h=0;h<l.length;h++)l[h]=s.shape[i[h]];let u;if(o.shouldExecuteOnCPU([s])){const d=o.texData.get(s.dataId).values,p=R2(d,s.shape,s.dtype,i,l);u=o.makeTensorInfo(l,s.dtype);const m=o.texData.get(u.dataId);m.values=p}else u=X1(s,i,o);return u}const Zve={kernelName:Ju,backendName:"webgl",kernelFunc:Gr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU=1e3;function ex({a:n,b:e,transposeA:t,transposeB:r,backend:s,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,h=e.shape.length,d=t?n.shape[u-2]:n.shape[u-1],p=r?e.shape[h-1]:e.shape[h-2],m=t?n.shape[u-1]:n.shape[u-2],y=r?e.shape[h-2]:e.shape[h-1],v=n.shape.slice(0,-2),w=e.shape.slice(0,-2),b=fe(v),S=fe(w),T=at(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([m,y]);B(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const O=t?[b,d,m]:[b,m,d],V=r?[S,y,p]:[S,p,y],k=Oe({inputs:{x:n},backend:s,attrs:{shape:O}}),$=Oe({inputs:{x:e},backend:s,attrs:{shape:V}}),N=[k,$],R=Math.max(b,S),E=t?k.shape[1]:k.shape[2],L=i!=null,F=o!=null,G=l==="leakyrelu",Y=l!=null?$m(l,!0):null,q=L||F||G||Y!=null;let se;if((m===1||y===1)&&E>KU&&q===!1){let re=k,ie=$;t&&(re=Gr({inputs:{x:k},backend:s,attrs:{perm:[0,2,1]}}),N.push(re)),r&&(ie=Gr({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),N.push(ie));const j=y!==1,Z=y===1;let he=re;j&&(he=Oe({inputs:{x:re},backend:s,attrs:{shape:[R,E,1]}}),N.push(he));const ve=y===1?2:1;let we=ie;Z&&(we=Oe({inputs:{x:ie},backend:s,attrs:{shape:[R,1,E]}}),N.push(we));const Se=D2({inputs:{a:he,b:we},backend:s});se=Q1({inputs:{x:Se},backend:s,attrs:{axis:ve,keepDims:!0}}),N.push(Se)}else{const re=rs(n.dtype,e.dtype),ie=new qU(O,V,[R,m,y],t,r,L,Y,F,G),j=[k,$];if(i!=null&&j.push(i),F&&j.push(o),G){const Z=s.makeTensorInfo([],"float32",Ra(a,"float32"));j.push(Z),N.push(Z)}se=s.runWebGLProgram(ie,j,re)}const X=Oe({inputs:{x:se},backend:s,attrs:{shape:T}});N.push(se);for(const re of N)s.disposeIntermediateTensorInfo(re);return X}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function exe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:d}=r;return ex({a:s,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:d,activation:h})}const txe={kernelName:pm,backendName:"webgl",kernelFunc:exe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP="return abs(x);";function nxe(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const i=t.texData.get(r.dataId),o=LU(i.values);return t.makeTensorInfo(r.shape,r.dtype,o)}let s;return le().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new vl(r.shape,lP):s=new xo(r.shape,lP),t.runWebGLProgram(s,[r],r.dtype)}const rxe={kernelName:Xm,backendName:"webgl",kernelFunc:nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sxe=yi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ixe=kt({opSnippet:sxe}),oxe={kernelName:Td,backendName:"webgl",kernelFunc:ixe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const axe=yi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,lxe=kt({opSnippet:axe}),uxe={kernelName:_d,backendName:"webgl",kernelFunc:lxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uP="return a + b;",cxe=br({opSnippet:uP,packedOpSnippet:uP,supportsComplex:!0,cpuKernelImpl:vwe}),hxe={kernelName:Rc,backendName:"webgl",kernelFunc:cxe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dxe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fxe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ov(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return $s({inputs:{x:r[0]},backend:t});if(r.length>le().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),u=ov({inputs:r.slice(0,l),backend:t}),h=ov({inputs:r.slice(l),backend:t});return ov({inputs:[u,h],backend:t})}const s=r.map(l=>l.dtype).reduce((l,u)=>rs(l,u)),i=r.map(l=>l.shape),a=le().getBool("WEBGL_PACK")?new fxe(r[0].shape,i):new dxe(r[0].shape,i);return t.runWebGLProgram(a,r,s)}const pxe={kernelName:Qm,backendName:"webgl",kernelFunc:ov};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=ft(i,s.shape);let u=l;const h=dn(u,a);let d=s;h!=null&&(d=Gr({inputs:{x:s},backend:t,attrs:{perm:h}}),u=bn(u.length,a)),vr("all",u,a);const[p,m]=nr(d.shape,u),y=fe(m),v=Oe({inputs:{x:d},backend:t,attrs:{shape:[-1,y]}}),w=Uc(v,v.dtype,"all",t);let b;if(o){const S=xn(p,l);b=Oe({inputs:{x:w},backend:t,attrs:{shape:S}})}else b=Oe({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(d),b}const gxe={kernelName:Rx,backendName:"webgl",kernelFunc:mxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=ft(i,s.shape);let u=l;const h=dn(u,a);let d=s;h!=null&&(d=Gr({inputs:{x:s},backend:t,attrs:{perm:h}}),u=bn(u.length,a)),vr("any",u,a);const[p,m]=nr(d.shape,u),y=fe(m),v=Oe({inputs:{x:d},backend:t,attrs:{shape:[-1,y]}}),w=Uc(v,v.dtype,"any",t);let b;if(o){const S=xn(p,l);b=Oe({inputs:{x:w},backend:t,attrs:{shape:S}})}else b=Oe({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(d),b}const wxe={kernelName:Ax,backendName:"webgl",kernelFunc:yxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vxe{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:i,outSize:o}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xxe{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,B(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),s||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Wt(l),h=Ur("coords",l);let d,p;if(o===1){p=l+1;const $=Wt(p);d=`
        ${$} sourceLocR = ${$}(${h.join()}, 0);
        ++${h[l-1]};
        ${$} sourceLocG = ${$}(${h.join()}, 0);
        ++${h[l-2]};
        ${$} sourceLocA = ${$}(${h.join()}, 0);
        --${h[l-1]};
        ${$} sourceLocB = ${$}(${h.join()}, 0);
        --${h[l-2]};`}else p=l,d=`
        ${u} sourceLocR = coords;
        ++${h[l-1]};
        ${u} sourceLocG = coords;
        ++${h[l-2]};
        ${u} sourceLocA = coords;
        --${h[l-1]};
        ${u} sourceLocB = coords;
        --${h[l-2]};`;const m=["x","y","z","w","u","v"].slice(0,p),y="."+m[p-1],v=m.map($=>"int "+$),w=Ur("sourceLocR",p-1).concat("inIdx.r"),b=Ur("sourceLocG",p-1).concat("inIdx.g"),S=Ur("sourceLocB",p-1).concat("inIdx.b"),C=Ur("sourceLocA",p-1).concat("inIdx.a"),T=r==="max"?"greaterThan":"lessThan",O=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${S.join()}),
                             getBestIndicesAChannel(${C.join()})));`,V=`vec4(
            getAChannel(${w.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${S.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${C.join()}) : 0.)`,k=s?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${k}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${y}, sourceLocG${y},
          sourceLocB${y}, sourceLocA${y}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${V};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${O}
          vec4 candidate = ${V};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${T}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XU(n,e,t,r=null){let s=e.shape[0],i=e.shape[1];r!=null&&(s=r.shape[0],i=r.shape[1]);const o=S1(i),a={windowSize:o,inSize:i,batchSize:s,outSize:Math.ceil(i/o)},l=new vxe(a,t,r==null),u=[e];r!=null&&u.push(r);const h=n.runWebGLProgram(l,u,"int32");if(h.shape[1]===1)return h;const d=XU(n,e,t,h);return n.disposeIntermediateTensorInfo(h),d}function QU(n,e,t,r=null){const s=r!=null?r.shape:e.shape,i=s[s.length-1],o=S1(i),a=new xxe(s,o,t,r==null),l=r==null?[e]:[e,r],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const h=QU(n,e,t,u);return n.disposeIntermediateTensorInfo(u),h}return u}function YU(n,e,t,r){const s=[t];if(vr("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!le().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,h]=nr(l.shape,s),d=fe(h),p=Oe({inputs:{x:l},backend:n,attrs:{shape:[-1,d]}});i.push(p);const m=XU(n,p,r);i.push(m);const y=Oe({inputs:{x:m},backend:n,attrs:{shape:u}});return i.forEach(v=>n.disposeIntermediateTensorInfo(v)),y}return QU(n,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let o=ft(i,s.shape);const a=dn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Gr({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),vr("argMax",[o[0]],l.shape.length);const h=YU(t,l,o[0],"max");return u.forEach(d=>t.disposeIntermediateTensorInfo(d)),h}const Ixe={kernelName:Ym,backendName:"webgl",kernelFunc:bxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let o=ft(i,s.shape);const a=dn(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Gr({inputs:{x:s},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),vr("argMin",[o[0]],l.shape.length);const h=YU(t,l,o[0],"min");return u.forEach(d=>t.disposeIntermediateTensorInfo(d)),h}const Txe={kernelName:Jm,backendName:"webgl",kernelFunc:Sxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _xe=yi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Cxe=kt({opSnippet:_xe}),Exe={kernelName:Cd,backendName:"webgl",kernelFunc:Cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kxe=yi+"return log(x + sqrt(x * x + 1.0));",Nxe=kt({opSnippet:kxe}),$xe={kernelName:Ed,backendName:"webgl",kernelFunc:Nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rxe=yi+`
  return atan(x);
`,Axe=kt({opSnippet:Rxe}),Dxe={kernelName:kd,backendName:"webgl",kernelFunc:Axe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oxe=A2+`
  return atan(a, b);
`,Pxe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Bc+`
  return result;
`,Fxe=br({opSnippet:Oxe,packedOpSnippet:Pxe}),Lxe={kernelName:$d,backendName:"webgl",kernelFunc:Fxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mxe=yi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Vxe=kt({opSnippet:Mxe}),zxe={kernelName:Nd,backendName:"webgl",kernelFunc:Vxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rm{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg",w=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,b=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let S="0.0";if(v||(S="-1.0 / 1e-20"),r){const $=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${m}, ${y});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${$} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?i?w:b:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const C="max";let T=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(T="avgValue / max(count, 1.0)");const O=Math.floor(o/4)*4,V=o%4,k=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${m}, ${y});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${O}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${k}
          }

          int xC = xCCorner + ${O};
          if (${V===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${V===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${V===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${k}
          }
        }
        setOutput(${T});
      }
    `}}class O2{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,h=e.dilationDepth,d=e.dilationHeight,p=e.dilationWidth,m=e.effectiveFilterDepth,y=e.effectiveFilterHeight,v=e.effectiveFilterWidth,w=e.padInfo.front,b=e.padInfo.top,S=e.padInfo.left;this.outputShape=e.outShape;const C=t==="avg";let T="0.0";if(C||(T="-1.0 / 1e-20"),r){const R=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${w}, ${b}, ${S});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${y};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${R} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${y} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const O="max";let V=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(V="avgValue / max(count, 1.0)");const k=Math.floor(o/4)*4,$=o%4,N=`
      if (${C}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${O}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${w}, ${b}, ${S});
      const float initializationValue = ${T};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${T});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${N}
            }

            int xC = xCCorner + ${k};
            if (${$===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${N}
            } else if (${$===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${N}
            } else if (${$===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${N}
            }
          }
        }
        setOutput(${V});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Of(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;B(wr(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=mi(s.shape,i,o,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&mt(h.inShape,h.outShape))return $s({inputs:{x:s},backend:t});const d=new Rm(h,"avg",!1);return t.runWebGLProgram(d,[s],"float32")}const Uxe={kernelName:Zm,backendName:"webgl",kernelFunc:Bxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r,h=[1,1,1],d=Aa(s.shape,i,o,h,a,l,u),p=new O2(d,"avg",!1);return t.runWebGLProgram(p,[s],"float32")}const jxe={kernelName:eg,backendName:"webgl",kernelFunc:Wxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gxe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=l-1-e.padInfo.top,d=u-1-e.padInfo.left,p=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Hxe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,y=d-1-e.padInfo.front,v=p-1-e.padInfo.top,w=m-1-e.padInfo.left,b=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${y}, ${v}, ${w});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qxe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=r,d=[1,1,1],p=Aa(o.shape,a,l,d,u,h),m=new Hxe(p);return t.runWebGLProgram(m,[s],o.dtype)}const Kxe={kernelName:Ox,backendName:"webgl",kernelFunc:qxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xxe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i;Of([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=r,h=mi(o.shape,a,l,1,u),d=new Gxe(h);return t.runWebGLProgram(d,[s],o.dtype)}const Qxe={kernelName:Dx,backendName:"webgl",kernelFunc:Xxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;return ex({a:s,b:i,transposeA:o,transposeB:a,backend:t})}const Jxe={kernelName:tg,backendName:"webgl",kernelFunc:Yxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zxe{constructor(e,t,r,s,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],at(e,t),at(e,r);let a="0.0";s!=null&&(at(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(at(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ebe{constructor(e,t,r,s,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],at(e,t),at(e,r);let a="vec4(0.0)";s!=null&&(at(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(at(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tbe=({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:s,variance:i,offset:o,scale:a}=n;B(s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),B(o==null||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),B(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[r,s,i];let h=null;o!=null&&(h=o.shape,u.push(o));let d=null;a!=null&&(d=a.shape,u.push(a));const p=le().getBool("WEBGL_PACK_NORMALIZATION")?new ebe(r.shape,s.shape,i.shape,h,d,l):new Zxe(r.shape,s.shape,i.shape,h,d,l);return e.runWebGLProgram(p,u,u[0].dtype)},nbe={kernelName:pg,backendName:"webgl",kernelFunc:tbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rbe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Wt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=sbe(this.rank);let s;const i=e.map((o,a)=>`sourceLoc.${N_[a]} = start[${a}] + coords.${N_[a]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const N_=["x","y","z","w","u","v"];function sbe(n){if(n===1)return"sourceLoc";if(n<=6)return N_.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ibe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Wt(this.rank),r=Ur("coords",this.rank),s=Ur("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,o=`getChannel(getSource(${s.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${o};
        --${s[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((h,d)=>`start[${d}]`).join()});`:e.map((h,d)=>`${s[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function obe(n,e,t,r){const s=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),o=r.texData.get(i.dataId);Object.assign(o,s),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=uk(e,Qe(n.shape));s.slice&&(a+=s.slice.flatOffset),o.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||n.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),i}function Bf(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:o}=r,[a,l]=I1(s,i,o);if(ok(s,a,l),fe(l)===0)return t.makeTensorInfo(l,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const d=t.texData.get(s.dataId),p=Ywe(d.values,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,p)}const{isPacked:u}=t.texData.get(s.dataId),h=lk(s.shape,a,l);if(u||!h){const d=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ibe(l):new rbe(l),p=[a];return t.runWebGLProgram(d,[s],s.dtype,p)}return t.uploadToGPU(s.dataId),obe(s,a,l,t)}const abe={kernelName:Wg,backendName:"webgl",kernelFunc:Bf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lbe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:o}=r;B(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((S,C)=>S*C),l=wy(s.shape,i,a),u=vy(l.length,i.length),h=xy(s.shape,i,a),d=mk(o,i.length),p=gk(h,o,i.length),m=[],y=Oe({inputs:{x:s},backend:t,attrs:{shape:l}}),v=Gr({inputs:{x:y},backend:t,attrs:{perm:u}}),w=Oe({inputs:{x:v},backend:t,attrs:{shape:h}}),b=Bf({inputs:{x:w},backend:t,attrs:{begin:d,size:p}});return m.push(y),m.push(v),m.push(w),m.forEach(S=>t.disposeIntermediateTensorInfo(S)),b},ube={kernelName:ng,backendName:"webgl",kernelFunc:lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o}=r,a=t.readSync(s.dataId),l=t.readSync(i.dataId),u=FU(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const hbe={kernelName:Px,backendName:"webgl",kernelFunc:cbe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dbe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,fbe=`
  return float(int(a.r) & int(b.r));
`;function pbe(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=le().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,s])||o===1){const l=t.texData.get(r.dataId).values,u=t.texData.get(s.dataId).values,[h,d]=bwe(r.shape,s.shape,l,u,r.dtype),p=t.makeTensorInfo(d,r.dtype),m=t.texData.get(p.dataId);return m.values=h,p}let a;return i?a=new Vf(dbe,r.shape,s.shape,!1):a=new Sc(fbe,r.shape,s.shape),t.runWebGLProgram(a,[r,s],r.dtype)}const mbe={kernelName:rg,backendName:"webgl",kernelFunc:pbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gbe(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.readSync(r.dataId),o=t.readSync(s.dataId),a=at(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const ybe={kernelName:Fx,backendName:"webgl",kernelFunc:gbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wbe="return float(a != b);",JU=br({opSnippet:wbe,cpuKernelImpl:Uwe,dtype:"bool"}),vbe={kernelName:Rg,backendName:"webgl",kernelFunc:JU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Py(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return $s({inputs:{x:s.complexTensorInfos.real},backend:t})}const xbe={kernelName:gb,backendName:"webgl",kernelFunc:Py};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bbe="return float(int(x));";function Ibe(n,e){const t=new xo(n.shape,bbe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return $s({inputs:{x:s},backend:t});const o=kn(s.shape),a=$_({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),l=iu({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(s.dtype==="complex64"){const o=Py({inputs:{input:s},backend:t}),a=$_({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!$C(s.dtype,i)){const o=$s({inputs:{x:s},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId).values,[a,l,u]=Iwe(o,s.shape,s.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return Ibe(s,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",Jn("bool",1)),l=JU({inputs:{a:s,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${i}`)}const Sbe={kernelName:Rd,backendName:"webgl",kernelFunc:$_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP="return ceil(x);",Tbe=kt({opSnippet:cP,packedOpSnippet:cP,cpuKernelImpl:Swe}),_be={kernelName:Ad,backendName:"webgl",kernelFunc:Tbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cbe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ebe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{clipValueMin:i,clipValueMax:o}=r;let a;le().getBool("WEBGL_PACK_CLIP")?a=new Ebe(s.shape):a=new Cbe(s.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[s],s.dtype,l)}const Nbe={kernelName:Dd,backendName:"webgl",kernelFunc:kbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $be{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hP(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Rbe(n){const{inputs:e,backend:t}=n,{x:r}=e,s=t.texData.get(r.dataId),i=new $be(r.shape),o=[hP(r,s.complexTensorInfos.real),hP(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const Abe={kernelName:sg,backendName:"webgl",kernelFunc:Rbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dbe{constructor(e){this.outputShape=[],this.outputShape=No(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];r.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const s=t.length,i=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Obe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=No(e,t);const r=this.outputShape,s=r.length,i=Wt(s),o=Ur("coords",s),a=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((v,w)=>`T${w}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let v=1;v<l.length;v++)l[v]=l[v-1]+e[v][t];const u=a[t],h=a.slice(-2),d=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${h.join()}));
        }`;for(let v=1;v<l.length;v++){const w=l[v-1];p+=`
        if (${u} < ${l[v]}  && ${u} >= ${l[v-1]}) {
          return getChannel(
            getT${v}(${vw(a,u,w)}),
            vec2(${vw(h,u,w)}));
        }`}const m=l.length,y=l[l.length-1];p+=`
        return getChannel(
          getT${m}(${vw(a,u,y)}),
          vec2(${vw(h,u,y)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[s-1]} = ${o[s-1]} + 1;
        if (${o[s-1]} < ${r[s-1]}) {
          result.g = getValue(${o});
        }

        ${o[s-2]} = ${o[s-2]} + 1;
        if (${o[s-2]} < ${r[s-2]}) {
          result.a = getValue(${o});
        }

        ${o[s-1]} = ${o[s-1]} - 1;
        if (${o[s-2]} < ${r[s-2]} &&
            ${o[s-1]} < ${r[s-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function vw(n,e,t){const r=n.indexOf(e);return n.map((i,o)=>o===r?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y1(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return $s({inputs:{x:s.complexTensorInfos.imag},backend:t})}const Pbe={kernelName:nb,backendName:"webgl",kernelFunc:Y1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yp(n,e,t){const r=n[0].dtype;if(r==="complex64"){const m=n.map(S=>Py({inputs:{input:S},backend:t})),y=n.map(S=>Y1({inputs:{input:S},backend:t})),v=Yp(m,e,t),w=Yp(y,e,t),b=iu({inputs:{real:v,imag:w},backend:t});return m.forEach(S=>t.disposeIntermediateTensorInfo(S)),y.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),b}let s=t.shouldExecuteOnCPU(n);if(r==="string"&&(s=!0),s){const m=n.map(T=>{const V=[-1,fe(T.shape.slice(e))];return Oe({inputs:{x:T},backend:t,attrs:{shape:V}})}),y=m.map(T=>({vals:t.readSync(T.dataId),shape:T.shape})),v=No(m.map(T=>T.shape),1),w=m[0].shape[0]===1,b=Twe(y,v,r,w),S=No(n.map(T=>T.shape),e),C=t.makeTensorInfo(S,r,b);return m.forEach(T=>t.disposeIntermediateTensorInfo(T)),C}const i=n.filter(m=>fe(m.shape)>0),o=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const m=o?new xo(n[0].shape,cl):new vl(n[0].shape,cl);return t.runWebGLProgram(m,n,r)}const a=le().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const m=[];for(let v=0;v<i.length;v+=a){const w=i.slice(v,v+a);m.push(Yp(w,e,t))}const y=Yp(m,e,t);for(const v of m)t.disposeIntermediateTensorInfo(v);return y}if(o){const m=new Obe(i.map(y=>y.shape),e);return t.runWebGLProgram(m,i,r)}const{tensors2D:l,outShape:u}=Fbe(i,e,t),h=new Dbe(l.map(m=>m.shape)),d=t.runWebGLProgram(h,l,r);l.forEach(m=>t.disposeIntermediateTensorInfo(m));const p=Oe({inputs:{x:d},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(d),p}function Fbe(n,e,t){const r=No(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Oe({inputs:{x:i},attrs:{shape:[-1,fe(i.shape.slice(e))]},backend:t})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZU(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=ft(s,e[0].shape)[0],o=e.map(u=>u.shape);dk(o,i);const a=No(e.map(u=>u.shape),i);if(fe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>fe(u.shape)>0);return l.length===1?$s({inputs:{x:l[0]},backend:t}):Yp(l,i,t)}const Lbe={kernelName:ig,backendName:"webgl",kernelFunc:ZU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eW{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,h=e.dilationHeight,d=e.dilationWidth,p=e.filterHeight,m=e.filterWidth,y=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,w=e.dataFormat==="channelsLast",b=w?1:2,S=w?2:3,C=w?3:1;let T="",O="";r&&(s?T=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?T=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:T=`
          float activation(float x) {
            ${r}
          }
        `,O="result = activation(result);");const V=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${T}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${C}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${S}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${y}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${w}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${w}) {
                dotProd +=
                    getX(batch, xR, xC, ${y}) *
                    getW(wR, wC, ${y}, d2);
              } else {
                dotProd +=
                    getX(batch, ${y}, xR, xC) *
                    getW(wR, wC, ${y}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2)
              );

              if (${w}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2),
                getW(wR, wC, ${y} + 2, d2)
              );

              if (${w}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1),
                  getX(batch, xR, xC, ${y} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC),
                  getX(batch, ${y} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${V}
        ${O}
        setOutput(result);
      }
    `}}class Mbe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.filterDepth,p=e.filterHeight,m=e.filterWidth,y=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${y}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${y}) *
                  getW(wF, wR, wC, ${y}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1),
                  getX(batch, xF, xR, xC, ${y} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2),
                  getW(wF, wR, wC, ${y} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tW{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=$r(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,d=h;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<h;w++)p+=`
           vec4 xTexelC${w*2};
           int xTexelC${w*2}Ready;
           vec4 xTexelC${w*2+1};
           int xTexelC${w*2+1}Ready;
           vec4 xC${w};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let w=0;w<h;w++)p+=`
           xTexelC${w*2} = vec4(0.0);
           xTexelC${w*2}Ready = 0;
           xTexelC${w*2+1} = vec4(0.0);
           xTexelC${w*2+1}Ready = 0;
           xC${w} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let w=0;w<(d+1)/2;w++){const b=w*2;if(p+=`
           xC = xCCorner + ${b*l};
           `,a===1){if(b<h&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,l===1&&b>0?p+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<h)){const S=o%2===0?Nx(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${S};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:p+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):S===1?p+=`
                     xC${b+1} = xTexelC${b};
                     `:p+=`
                     xCOffset = xC + ${S};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<h&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<h&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<h&&(p+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<h&&(p+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<h&&(p+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let m="",y="";r&&(s?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:m=`vec4 activation(vec4 x) {
           ${r}
         }`,y="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${y}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vbe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=$r(this.outputShape.length);const{dataFormat:r}=t,s=Kr(),i=r==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let h=0;h<=1;h++)for(let d=0;d<=1;d++)u+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tx(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function nW({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=r.texData.get(n.dataId),h=t.inChannels,d=l[0]*l[1]*l[2],p=t.outChannels,m=t.dataFormat==="channelsLast",y=!1,v=!1;let w;const b=[];if(i!=null){const T=tx(i.shape,m);T!=null&&(i=Oe({inputs:{x:i},backend:r,attrs:{shape:T}}),b.push(i))}if(s!=null){const T=tx(s.shape,m);T!=null&&(s=Oe({inputs:{x:s},backend:r,attrs:{shape:T}}),b.push(s))}if(!((d===1||p===1)&&h>KU)&&u.isPacked&&m&&u.texture!=null&&l[2]%2!==0&&mt(u.shape.slice(-3),l.slice(-3))){const T=l[0]*l[1]*(l[2]+1),O={dataId:n.dataId,shape:[1,T,t.inChannels],dtype:n.dtype},V=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,B(Nm(u.shape,O.shape),()=>`packed reshape ${u.shape} to ${O.shape} isn't free`);const k=Oe({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});b.push(k);const $=ex({a:O,b:k,backend:r,transposeA:y,transposeB:v,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),N=r.texData.get($.dataId);B(N.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=V,N.shape=t.outShape,w=$s({inputs:{x:$},backend:r}),w.shape=t.outShape,b.push($)}else{const T=t.outHeight*t.outWidth,O=Oe({inputs:{x:n},backend:r,attrs:{shape:m?[t.batchSize,T,t.inChannels]:[t.batchSize,t.inChannels,T]}}),V=Oe({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),k=ex({a:m?O:V,b:m?V:O,transposeA:!m,transposeB:v,backend:r,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o});w=Oe({inputs:{x:k},backend:r,attrs:{shape:t.outShape}}),b.push(O),b.push(V),b.push(k)}for(const T of b)r.disposeIntermediateTensorInfo(T);return w}function rW({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:h,outWidth:d,outHeight:p,dataFormat:m}=t,y=m==="channelsLast",v=l*u*h,w=p*d,b=[t.batchSize,v,w],S=!0,C=!1,T=[];if(i!=null){const X=tx(i.shape,y);X!=null&&(i=Oe({inputs:{x:i},backend:r,attrs:{shape:X}}),T.push(i))}if(s!=null){const X=tx(s.shape,y);X!=null&&(s=Oe({inputs:{x:s},backend:r,attrs:{shape:X}}),T.push(s))}const O=Oe({inputs:{x:e},backend:r,attrs:{shape:[1,v,fe(e.shape)/v]}});T.push(O);const V=new Vbe(b,t),k=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],$=r.runWebGLProgram(V,[n],"float32",k),N=Oe({inputs:{x:$},backend:r,attrs:{shape:b}});T.push($),T.push(N);const R=s!=null,E=i!=null,L=a==="leakyrelu",F=a?$m(a,!0):null,G=new qU(y?N.shape:O.shape,y?O.shape:N.shape,y?[t.batchSize,w,t.outChannels]:[t.batchSize,t.outChannels,w],S,C,R,F,E,L),Y=y?[N,O]:[O,N];if(s&&Y.push(s),E&&Y.push(i),L){const X=r.makeTensorInfo([],"float32",Ra(o,"float32"));Y.push(X),T.push(X)}const q=r.runWebGLProgram(G,Y,"float32"),se=Oe({inputs:{x:q},backend:r,attrs:{shape:t.outShape}});T.push(q);for(const X of T)r.disposeIntermediateTensorInfo(X);return se}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=r,d=Da(l),p=tr(s.shape,i.shape,o,u,a,h,!1,d);let m;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))m=nW({x:s,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&d==="channelsLast"&&le().getBool("WEBGL_EXP_CONV")){const v=new tW(p),w=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];m=t.runWebGLProgram(v,[s,i],"float32",w)}else if(le().getBool("WEBGL_CONV_IM2COL"))m=rW({x:s,filter:i,convInfo:p,backend:t});else{const v=new eW(p);m=t.runWebGLProgram(v,[s,i],"float32")}const y=Oe({inputs:{x:m},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(m),y}const Bbe={kernelName:og,backendName:"webgl",kernelFunc:zbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ube{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Wbe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=r-1-e.padInfo.left,u=o?1:2,h=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jbe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Gbe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=r-1-e.padInfo.top,h=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=r,d=Da(l),p=tr(s.shape,h,o,1,a,u,!1,d),m=new Ube(p);return t.runWebGLProgram(m,[s,i],"float32")}const qbe={kernelName:Mx,backendName:"webgl",kernelFunc:Hbe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kbe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=$r(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,s=t-1-e.padInfo.top,i=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=r,d=Da(u),p=tr(o,i.shape,a,1,l,h,!1,d);if(le().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const m=[[p.strideHeight,p.strideWidth]],y=new Kbe(p);return t.runWebGLProgram(y,[s,i],"float32",m)}else{const m=new Wbe(p);return t.runWebGLProgram(m,[s,i],"float32")}}const Qbe={kernelName:ag,backendName:"webgl",kernelFunc:Xbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ybe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,u=Jl(s.shape,i.shape,o,l,a),h=new Mbe(u);return t.runWebGLProgram(h,[s,i],"float32")}const Jbe={kernelName:lg,backendName:"webgl",kernelFunc:Ybe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r,u=Jl(s.shape,l,o,1,a),h=new jbe(u);return t.runWebGLProgram(h,[s,i],"float32")}const e1e={kernelName:Vx,backendName:"webgl",kernelFunc:Zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t1e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r,u=Jl(l,i.shape,a,1,o),h=new Gbe(u);return t.runWebGLProgram(h,[s,i],"float32")}const n1e={kernelName:zx,backendName:"webgl",kernelFunc:t1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r1e=zf+`
  return cos(x);
`,s1e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Bc}
  return result;
`,i1e=kt({opSnippet:r1e,packedOpSnippet:s1e}),o1e={kernelName:Od,backendName:"webgl",kernelFunc:i1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,l1e=kt({opSnippet:a1e}),u1e={kernelName:Pd,backendName:"webgl",kernelFunc:l1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c1e{constructor(e,t,r,s,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[h]=t,[d,p]=r;this.outputShape=[h,d,p,u];const m=s==="bilinear"?1:0,[y,v]=[`${a-1}.0`,`${l-1}.0`],[w,b,S]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${y} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${y}`],[C,T,O]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${w});
      const float width_ratio = float(${C});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${T};

        float in_y = ${S};
        if( in_y < 0.0 || in_y > ${y} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${O};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h1e=n=>{const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=r,h=new c1e(s.shape,i.shape,a,l,u);return t.runWebGLProgram(h,[s,i,o],"float32")},d1e={kernelName:Ux,backendName:"webgl",kernelFunc:h1e};var Am;(function(n){n.Prod="*",n.Sum="+"})(Am||(Am={}));class dP{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Am.Prod?"1.0":"0.0",a=r?o:`getX(${fP(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",h="";r?(u=s?`end != ${l-1}`:"end != 0",h=s?"end + 1":"end - 1"):(u=s?`end + pow2 < ${l}`:"end >= pow2",h=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Wt(i)} coords = getOutputCoords();
        int end = ${pP(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${h};
          ${pP(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${fP(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function fP(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function pP(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n,e,t,r,s,i){const o=e.shape.length,a=dn([r],o);let l=e;a!=null&&(l=Gr({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=bn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const h=l.shape[u];let d=$s({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(h))-1;p++){const m=new dP(n,l.shape,!1,i),y=[[p]],v=d;d=t.runWebGLProgram(m,[d],d.dtype,y),t.disposeIntermediateTensorInfo(v)}if(s){const p=new dP(n,l.shape,s,i),m=d;d=t.runWebGLProgram(p,[d],d.dtype),t.disposeIntermediateTensorInfo(m)}if(a!=null){const p=Zl(a),m=Gr({inputs:{x:d},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(l),m}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return sW(Am.Prod,s,t,i,o,a)}const p1e={kernelName:Bx,backendName:"webgl",kernelFunc:f1e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return sW(Am.Sum,s,t,i,o,a)}const g1e={kernelName:ug,backendName:"webgl",kernelFunc:m1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=t.readSync(s.dataId),u=t.readSync(i.dataId),h=FU(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,h)}else if(s.shape.length===2){const l=t.bufferSync(s),u=t.bufferSync(i),h=xwe(l,u,o,a);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const w1e={kernelName:Wx,backendName:"webgl",kernelFunc:y1e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v1e{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:o}=r,a=s.shape[0],l=o==="NHWC"?s.shape[1]:s.shape[2],u=o==="NHWC"?s.shape[2]:s.shape[3],h=o==="NHWC"?s.shape[3]:s.shape[1],d=l*i,p=u*i,m=h/(i*i),y=o==="NHWC"?[a,d,p,m]:[a,m,d,p],v=new v1e(y,i,o);return t.runWebGLProgram(v,[s],s.dtype)}const b1e={kernelName:jx,backendName:"webgl",kernelFunc:x1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iW{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=$r(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",h="";r&&(s?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:u=`
          float activation(float x) {
            ${r}
          }
        `,h="result = activation(result);");const d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oW{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=$r(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=d;let m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)m+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;m+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let b=0;b<d;b++)m+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(p+1)/2;b++){const S=b*2;if(m+=`
          xC = xCCorner + ${S*u};
          `,l===1){if(S<d&&(a%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }
              `,u===1&&S>0?m+=`
                xC${S} = vec4(xTexelC${S-2}.zw, xTexelC${S}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${S} = vec4(previous.zw, xTexelC${S}.xy);
                  } else {
                    xC${S} = vec4(0.0, 0.0, xTexelC${S}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }

                xC${S} = xTexelC${S};
                `,S+1<d)){const C=a%2===0?Nx(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${C};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                    xTexelC${S+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${S+1}.zw = vec2(0.0);
                    }
                    xTexelC${S+1}Ready = 1;
                  }
                  `,u>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${S+1} = vec4(previous.zw, xTexelC${S+1}.xy);
                    } else {
                     xC${S+1} = vec4(0.0, 0.0, xTexelC${S+1}.xy);
                    }
                    `:m+=`
                    xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.xy);
                    `):C===1?m+=`
                    xC${S+1} = xTexelC${S};
                    `:m+=`
                    xCOffset = xC + ${C};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                      xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${S+1}.zw = vec2(0.0);
                      }
                      xTexelC${S+1}Ready = 1;
                    }

                    xC${S+1} = xTexelC${S+1};
                    `}}else S<d&&(a%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${S+1}Ready == 0) {
                  xTexelC${S+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${S+1}.zw = vec2(0.0);
                  }
                  xTexelC${S+1}Ready = 1;
                }

                xC${S} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
              `,S+1<d&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${S+1} = vec4(xTexelC${S+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                  xTexelC${S} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${S}.zw = vec2(0.0);
                  }
                  xTexelC${S}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                  xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${S+1}.zw = vec2(0.);
                  }
                  xTexelC${S+1}Ready = 1;
                }

                xC${S} = vec4(
                  xTexelC${S}.xy, xTexelC${S+1}.xy);
              `,S+1<d&&(m+=`
                  xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
                `)));S<d&&(m+=`
            wTexel = getW(r, ${S}, d1, q);
            dotProd += xC${S} * vec4(wTexel.xz, wTexel.xz);
          `,S+1<d&&(m+=`
              wTexel = getW(r, ${S+1}, d1, q);
              dotProd += xC${S+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let y="",v="";r&&(s?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:y=`vec4 activation(vec4 x) {
          ${r}
        }`,v="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${w}
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;let h=l;h==null&&(h=[1,1]),B(wr(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=tr(s.shape,i.shape,o,h,a,u,!0);let p;le().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new oW(d):p=new iW(d);const m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return t.runWebGLProgram(p,[s,i],"float32",m)}const S1e={kernelName:cg,backendName:"webgl",kernelFunc:I1e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T1e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class _1e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=r,d=tr(s.shape,h,o,a,l,u,!0),p=new T1e(d);return t.runWebGLProgram(p,[s,i],"float32")}const E1e={kernelName:Gx,backendName:"webgl",kernelFunc:C1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k1e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=r,d=tr(h,i.shape,o,a,l,u,!0),p=new _1e(d);return t.runWebGLProgram(p,[s,i],"float32")}const N1e={kernelName:Hx,backendName:"webgl",kernelFunc:k1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $1e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1e(n){const{inputs:e,backend:t}=n,{x:r}=e,s=[...r.shape,...r.shape],i=fe(r.shape),o=Oe({inputs:{x:r},backend:t,attrs:{shape:[i]}}),a=new $1e(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Oe({inputs:{x:l},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const A1e={kernelName:qx,backendName:"webgl",kernelFunc:R1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D1e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:h}=e,{top:d,left:p}=s;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,u=ey(s.shape,i.shape,o,a,"NHWC",l);let h;const d=new D1e(u);h=t.runWebGLProgram(d,[s,i],"float32");const p=Oe({inputs:{x:h},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(h),p}const P1e={kernelName:hg,backendName:"webgl",kernelFunc:O1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1e(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=Tk(s,i.length);Ck(o.length,l,i);const{path:u,steps:h}=Ek(a,l),d=h.length;let p=null,m=o.length;const y=[];for(let v=0;v<d;++v){for(const w of h[v]){const{permutationIndices:b,expandDims:S}=_k(m,l[w]);let C;kk(b)?C=i[w]:(C=Gr({inputs:{x:i[w]},backend:t,attrs:{perm:b}}),y.push(C));const T=C.shape.slice();for(let O=0;O<S.length;++O)T.splice(S[O],0,1);mt(C.shape,T)||(C=Oe({inputs:{x:C},backend:t,attrs:{shape:T}}),y.push(C)),p===null?p=C:(p=D2({inputs:{a:C,b:p},backend:t}),y.push(p))}v<d-1&&(u[v]>=0&&(p=Q1({inputs:{x:p},backend:t,attrs:{axis:u[v]-(o.length-m),keepDims:!1}}),y.push(p)),m--)}for(const v of y)v!==p&&t.disposeIntermediateTensorInfo(v);return p}const L1e={kernelName:Xx,backendName:"webgl",kernelFunc:F1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M1e="return (x >= 0.0) ? x : (exp(x) - 1.0);",V1e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,z1e=kt({opSnippet:M1e,packedOpSnippet:V1e}),B1e={kernelName:Ld,backendName:"webgl",kernelFunc:z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U1e="return (b >= 0.0) ? a : a * (b + 1.0);",W1e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,j1e=n=>{const{inputs:e,backend:t}=n,{dy:r,y:s}=e,i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vf(W1e,r.shape,s.shape):new Sc(U1e,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],r.dtype)},G1e={kernelName:Qx,backendName:"webgl",kernelFunc:j1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1e=`
  return vec4(equal(a, b));
`,q1e="return float(a == b);",K1e=br({opSnippet:q1e,packedOpSnippet:H1e,dtype:"bool",cpuKernelImpl:_we}),X1e={kernelName:dg,backendName:"webgl",kernelFunc:K1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${yk};
  float a1 = ${wk};
  float a2 = ${vk};
  float a3 = ${xk};
  float a4 = ${bk};
  float a5 = ${Ik};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Y1e=kt({opSnippet:Q1e}),J1e={kernelName:Md,backendName:"webgl",kernelFunc:Y1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z1e=zf+`
  return exp(x);
`,eIe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,aW=kt({opSnippet:Z1e,packedOpSnippet:eIe,cpuKernelImpl:Cwe,dtype:"float32"}),tIe={kernelName:Vd,backendName:"webgl",kernelFunc:aW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_(n){const{inputs:e,attrs:t,backend:r}=n,{dim:s}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(B(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+s+1),a.splice(l,0,1),Oe({inputs:{x:i},backend:r,attrs:{shape:a}})}const nIe={kernelName:fg,backendName:"webgl",kernelFunc:R_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP="return exp(x) - 1.0;",rIe=kt({opSnippet:mP,packedOpSnippet:mP,cpuKernelImpl:Ewe}),sIe={kernelName:zd,backendName:"webgl",kernelFunc:rIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gP{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${s}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(n,e,t){const r=t.texData.get(n.dataId),s=fe(n.shape),i=n.shape[n.shape.length-1],o=s/i,a=Oe({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new gP("real",l,e),h=new gP("imag",l,e),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,d,"float32"),m=t.runWebGLProgram(h,d,"float32"),y=iu({inputs:{real:p,imag:m},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m);const v=Oe({inputs:{x:y},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(y),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iIe(n){const{inputs:e,backend:t}=n,{input:r}=e;return lW(r,!1,t)}const oIe={kernelName:Yx,backendName:"webgl",kernelFunc:iIe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aIe{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fy(n){const{backend:e,attrs:t}=n,{shape:r,value:s}=t;let{dtype:i}=t;if(i=i||Nc(s),i==="string"){const o=mn(i,fe(r));return o.fill(s),e.makeTensorInfo(r,i,o)}else{const o=new aIe(r,s),a=[[s]];return e.runWebGLProgram(o,[],i,a)}}const lIe={kernelName:Jx,backendName:"webgl",kernelFunc:Fy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uIe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cIe={kernelName:Zx,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,s=new uIe(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP="return floor(x);",hIe=kt({opSnippet:yP,packedOpSnippet:yP,cpuKernelImpl:kwe}),dIe={kernelName:Bd,backendName:"webgl",kernelFunc:hIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fIe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,pIe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,mIe=br({opSnippet:fIe,packedOpSnippet:pIe,dtype:"int32"}),gIe={kernelName:Ud,backendName:"webgl",kernelFunc:mIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yIe{constructor(e){this.variableNames=["A"];const t=Kr(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wIe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Kr(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vIe={kernelName:Av,backendName:"webgl",kernelFunc:xIe};let Rh,lT=le().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function xIe(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:s}=e;const{numChannels:i}=r,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[l,u]=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],h=[u,l],d=[u,l,i];if(a||o){const v=le().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Rh==null||v!==lT)&&(lT=v,Rh=document.createElement("canvas").getContext("2d",{willReadFrequently:lT})),Rh.canvas.width=l,Rh.canvas.height=u,Rh.drawImage(s,0,0,l,u),s=Rh.canvas}const p=t.makeTensorInfo(h,"int32");t.texData.get(p.dataId).usage=Gs.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),s);const m=le().getBool("WEBGL_PACK")?new wIe(d):new yIe(d),y=t.runWebGLProgram(m,[p],"int32");return t.disposeData(p.dataId),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:y}=r,v=Da(h),w=tr(s.shape,i.shape,l,d,u,p,!1,v);let b;const S=[],C=o!=null,T=a!=null,O=m==="leakyrelu",V=()=>{const $=[s,i],N=(R,E)=>{if(E==="NCHW"&&R.shape.length===1&&R.shape[0]!==1){const L=Oe({inputs:{x:R},backend:t,attrs:{shape:[R.shape[0],1,1]}});return S.push(L),L}return R};if(C&&$.push(N(o,h)),T&&$.push(N(a,h)),O){const R=t.makeTensorInfo([],"float32",Ra(y,"float32"));$.push(R),S.push(R)}return $};if(w.filterHeight===1&&w.filterWidth===1&&w.dilationHeight===1&&w.dilationWidth===1&&w.strideHeight===1&&w.strideWidth===1&&(w.padInfo.type==="SAME"||w.padInfo.type==="VALID"))b=nW({x:s,filter:i,convInfo:w,backend:t,bias:o,activation:m,preluActivationWeights:a,leakyreluAlpha:y});else if(w.strideWidth<=2&&v==="channelsLast"&&le().getBool("WEBGL_EXP_CONV")){const $=m?$m(m,!0):null,N=new tW(w,C,$,T,O),R=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],E=V();b=t.runWebGLProgram(N,E,"float32",R)}else if(le().getBool("WEBGL_CONV_IM2COL"))b=rW({x:s,filter:i,convInfo:w,backend:t,bias:o,activation:m,preluActivationWeights:a,leakyreluAlpha:y});else{const $=m?$m(m,!1):null,N=new eW(w,C,$,T,O),R=V();b=t.runWebGLProgram(N,R,"float32")}const k=Oe({inputs:{x:b},backend:t,attrs:{shape:w.outShape}});return S.push(b),S.forEach($=>t.disposeIntermediateTensorInfo($)),k}const IIe={kernelName:mm,backendName:"webgl",kernelFunc:bIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:m}=r,y=[];let v=h;v==null&&(v=[1,1]),B(wr(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);const w=tr(s.shape,i.shape,l,v,u,d,!0),b=le().getBool("WEBGL_PACK_DEPTHWISECONV")&&w.strideWidth<=2&&w.outChannels/w.inChannels===1,S=p?$m(p,b):null,C=[s,i],T=o!=null,O=a!=null,V=p==="leakyrelu";if(T&&C.push(o),O&&C.push(a),V){const R=t.makeTensorInfo([],"float32",Ra(m,"float32"));C.push(R),y.push(R)}let k;b?k=new oW(w,T,S,O,V):k=new iW(w,T,S,O,V);const $=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],N=t.runWebGLProgram(k,C,"float32",$);return y.forEach(R=>t.disposeIntermediateTensorInfo(R)),N}const TIe={kernelName:gm,backendName:"webgl",kernelFunc:SIe};class _Ie{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const i=Wt(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CIe(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=s.shape,o=i[i.length-1],a=fe(r.shape),[l,u,h,d]=b1(r,s),p=Oe({inputs:{x:s},backend:t,attrs:{shape:[u,o]}}),m=Oe({inputs:{x:r},backend:t,attrs:{shape:[fe(r.shape)/h,h]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const b=t.readSync(s.dataId),S=t.bufferSync(r),C=Nwe(b,S,r.dtype,u,o,h,d,r.shape,a);return t.makeTensorInfo(l,r.dtype,C.values)}const y=new _Ie(o,d,[u,h],r.shape),v=t.runWebGLProgram(y,[m,p],m.dtype),w=Oe({inputs:{x:v},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),w}const EIe={kernelName:eb,backendName:"webgl",kernelFunc:CIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kIe{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=Wt(this.rank),s=NIe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function NIe(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<n.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:o,batchDims:a}=r,l=ft(o,s.shape)[0];if(le().get("DEBUG")){const S=t.readSync(i.dataId),C=s.shape[l];for(let T=0;T<S.length;++T){const O=S[T];B(O<=C-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${C-1}]`)}}const u=$k(s,i,l,a),h=fe(i.shape),d=[],p=Oe({inputs:{x:s},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),m=Oe({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,h/u.batchSize]}});d.push(p),d.push(m);const y=[u.batchSize,u.outerSize,h/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const S=t.bufferSync(m),C=t.bufferSync(p),T=$we(C,S,y);return d.forEach(O=>t.disposeIntermediateTensorInfo(O)),t.makeTensorInfo(u.outputShape,T.dtype,T.values)}const v=new kIe(p.shape,y),w=t.runWebGLProgram(v,[p,m],p.dtype);d.push(w);const b=Oe({inputs:{x:w},backend:t,attrs:{shape:u.outputShape}});return d.forEach(S=>t.disposeIntermediateTensorInfo(S)),b}const $Ie={kernelName:mg,backendName:"webgl",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RIe="return float(a > b);",AIe=`
  return vec4(greaterThan(a, b));
`,DIe=br({opSnippet:RIe,packedOpSnippet:AIe,cpuKernelImpl:Rwe,dtype:"bool"}),OIe={kernelName:gg,backendName:"webgl",kernelFunc:DIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PIe="return float(a >= b);",FIe=`
  return vec4(greaterThanEqual(a, b));
`,LIe=br({opSnippet:PIe,packedOpSnippet:FIe,dtype:"bool",cpuKernelImpl:Awe}),MIe={kernelName:Wd,backendName:"webgl",kernelFunc:LIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VIe(n){const{inputs:e,backend:t}=n,{input:r}=e;return lW(r,!0,t)}const zIe={kernelName:tb,backendName:"webgl",kernelFunc:VIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BIe="return float(!isnan(x) && !isinf(x));",UIe=kt({opSnippet:BIe,dtype:"bool"}),WIe={kernelName:Gd,backendName:"webgl",kernelFunc:UIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jIe="return float(isinf(x));",GIe=kt({opSnippet:jIe,dtype:"bool"}),HIe={kernelName:Hd,backendName:"webgl",kernelFunc:GIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qIe="return float(isnan(x));",KIe=kt({opSnippet:qIe,dtype:"bool"}),XIe={kernelName:qd,backendName:"webgl",kernelFunc:KIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QIe="return float(a < b);",YIe=`
  return vec4(lessThan(a, b));
`,JIe=br({opSnippet:QIe,packedOpSnippet:YIe,cpuKernelImpl:Dwe,dtype:"bool"}),ZIe={kernelName:wg,backendName:"webgl",kernelFunc:JIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eSe="return float(a <= b);",tSe=`
  return vec4(lessThanEqual(a, b));
`,nSe=br({opSnippet:eSe,packedOpSnippet:tSe,cpuKernelImpl:Owe,dtype:"bool"}),rSe={kernelName:vg,backendName:"webgl",kernelFunc:nSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,o=Pwe(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const iSe={kernelName:rb,backendName:"webgl",kernelFunc:sSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oSe=zf+`
  return x < 0.0 ? 0./0. : log(x);
`,aSe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,lSe=kt({opSnippet:oSe,packedOpSnippet:aSe,cpuKernelImpl:Fwe}),uSe={kernelName:Kd,backendName:"webgl",kernelFunc:lSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cSe=zf+`
  return log(1.0 + x);
`,hSe=kt({opSnippet:cSe}),dSe={kernelName:Xd,backendName:"webgl",kernelFunc:hSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fSe="return float(a >= 1.0 && b >= 1.0);",pSe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,mSe=br({opSnippet:fSe,packedOpSnippet:pSe,dtype:"bool"}),gSe={kernelName:xg,backendName:"webgl",kernelFunc:mSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ySe="return float(!(x >= 1.0));",wSe=kt({opSnippet:ySe}),vSe={kernelName:bg,backendName:"webgl",kernelFunc:wSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xSe="return float(a >= 1.0 || b >= 1.0);",bSe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,ISe=br({opSnippet:xSe,packedOpSnippet:bSe,dtype:"bool"}),SSe={kernelName:Ig,backendName:"webgl",kernelFunc:ISe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TSe{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Se{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CSe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r,u=le().getBool("WEBGL_PACK_NORMALIZATION")?new _Se(s.shape,i,o,a,l):new TSe(s.shape,i,o,a,l);return t.runWebGLProgram(u,[s],s.dtype)},ESe={kernelName:Sg,backendName:"webgl",kernelFunc:CSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kSe{constructor(e,t,r,s,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NSe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:h}=r,d=new kSe(s.shape,a,l,u,h);return t.runWebGLProgram(d,[s,i,o],s.dtype)},$Se={kernelName:sb,backendName:"webgl",kernelFunc:NSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RSe(n,e,t,r){const s=fe(e),o=fe(n.shape)/s,a=Oe({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),l=Uc(a,n.dtype,"max",r),u=Oe({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=s.shape.length,l=ft(i,s.shape);let u=l;const h=dn(u,a),d=h!=null,p=t.shouldExecuteOnCPU([s]);let m=s;if(d){if(p){const C=t.texData.get(m.dataId).values,T=new Array(a);for(let k=0;k<T.length;k++)T[k]=s.shape[h[k]];const O=R2(C,s.shape,s.dtype,h,T);m=t.makeTensorInfo(T,s.dtype);const V=t.texData.get(m.dataId);V.values=O}else m=X1(s,h,t);u=bn(u.length,a)}vr("max",u,a);const[y,v]=nr(m.shape,u);let w=y;o&&(w=xn(y,l));let b;if(p){const C=t.texData.get(m.dataId).values,T=Lwe(C,fe(v),w,s.dtype);b=t.makeTensorInfo(w,s.dtype);const O=t.texData.get(b.dataId);O.values=T}else b=RSe(m,v,w,t);return d&&t.disposeIntermediateTensorInfo(m),b}const ASe={kernelName:Tg,backendName:"webgl",kernelFunc:cW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DSe=A2+`
  return max(a, b);
`,OSe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Bc+`
  return result;
`,PSe=br({opSnippet:DSe,packedOpSnippet:OSe,cpuKernelImpl:Mwe}),FSe={kernelName:Qd,backendName:"webgl",kernelFunc:PSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Of(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;B(wr(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=mi(s.shape,i,o,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&mt(h.inShape,h.outShape))return $s({inputs:{x:s},backend:t});const d=new Rm(h,"max",!1);return t.runWebGLProgram(d,[s],s.dtype)}const MSe={kernelName:_g,backendName:"webgl",kernelFunc:LSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=r,h=[1,1,1],d=Aa(s.shape,i,o,h,a,u,l),p=new O2(d,"max",!1);return t.runWebGLProgram(p,[s],s.dtype)}const zSe={kernelName:Cg,backendName:"webgl",kernelFunc:VSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BSe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class USe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=l-1-e.padInfo.front,p=u-1-e.padInfo.top,m=h-1-e.padInfo.left,y=l*u*h-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${y} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WSe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=r,d=[1,1,1],p=Aa(o.shape,a,l,d,u,h),m=new O2(p,"max",!0),y=t.runWebGLProgram(m,[o],o.dtype),v=new USe(p),w=t.runWebGLProgram(v,[s,y],o.dtype);return t.disposeIntermediateTensorInfo(y),w}const jSe={kernelName:ob,backendName:"webgl",kernelFunc:WSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GSe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:o}=e,a=i;Of([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=r,p=mi(a.shape,l,u,1,h,d),m=!0,y=new Rm(p,"max",m),v=t.runWebGLProgram(y,[a],a.dtype),w=new BSe(p),b=t.runWebGLProgram(w,[s,v],a.dtype);return t.disposeIntermediateTensorInfo(v),b}const HSe={kernelName:ib,backendName:"webgl",kernelFunc:GSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qSe(n,e,t,r){let s=new Rm(t,"max",!1);const i=r.runWebGLProgram(s,[n],"float32");s=new Rm(t,"max",!0,!0,e);const o=r.runWebGLProgram(s,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KSe={kernelName:ab,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;B(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const u=[1,1];B(wr(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=mi(r.shape,s,i,u,o),[d,p]=qSe(r,a,h,l);return[d,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(n,e,t,r){const s=fe(e),o=fe(n.shape)/s,a=Oe({inputs:{x:n},attrs:{shape:[o,s]},backend:r}),l=Uc(a,"float32","mean",r),u=Oe({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QSe={kernelName:Eg,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:s,axis:i}=e,o=t,a=r.shape.length,l=ft(i,r.shape);let u=l;const h=dn(u,a),d=h!=null,p=o.shouldExecuteOnCPU([r]),m=[];let y=r;if(d){if(p){const T=o.texData.get(y.dataId).values,O=new Array(a);for(let $=0;$<O.length;$++)O[$]=r.shape[h[$]];const V=R2(T,r.shape,r.dtype,h,O);y=o.makeTensorInfo(O,r.dtype);const k=o.texData.get(y.dataId);k.values=V}else y=X1(r,h,o);m.push(y),u=bn(u.length,a)}vr("sum",u,a);const[v,w]=nr(y.shape,u);let b=v;s&&(b=xn(v,l));const S=XSe(y,w,b,o);for(const C of m)o.disposeIntermediateTensorInfo(C);return S}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=ft(i,s.shape);let u=l;const h=dn(u,a);let d=s;h!=null&&(d=Gr({inputs:{x:s},backend:t,attrs:{perm:h}}),u=bn(u.length,s.shape.length)),vr("min",u,a);const[p,m]=nr(d.shape,u),y=fe(m),v=Oe({inputs:{x:d},backend:t,attrs:{shape:[-1,y]}}),w=Uc(v,v.dtype,"min",t);let b;if(o){const S=xn(p,l);b=Oe({inputs:{x:w},backend:t,attrs:{shape:S}})}else b=Oe({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(d),b}const JSe={kernelName:kg,backendName:"webgl",kernelFunc:YSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZSe=A2+`
  return min(a, b);
`,eTe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Bc+`
  return result;
`,tTe=br({opSnippet:ZSe,packedOpSnippet:eTe,cpuKernelImpl:Vwe}),nTe={kernelName:Yd,backendName:"webgl",kernelFunc:tTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rTe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((h,d)=>h[0]+e[d]+h[1]);const s=e.length,i=Wt(s),o=t.map(h=>h[0]).join(","),a=t.map((h,d)=>h[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),u=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sTe{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((y,v)=>y[0]+e[v]+y[1]);const s=e.length,i=Wt(s),o=t.map(y=>y[0]).join(","),a=t.map((y,v)=>y[0]+e[v]).join(","),l=Ur("rc",s),u=Ur("source",s),h=`${l[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${u.slice(-2).join()})`,p=r==="reflect"?0:1;let m="";if(s===1){const y=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;m=`
        ${i} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[s-1]} += 1;
        if(${h}) {
          ${y}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
      `}else{const y=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;m=`
        ${i} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[s-1]} += 1;
        if(${h}) {
          ${y}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
        rc = outputLoc;
        ${l[s-2]} += 1;
        if(${l[s-2]} < ${this.outputShape[s-2]}) {
          ${y}
          result[2] = getChannel(getX(${u.join()}), ${d});
          ${l[s-1]} += 1;
          if(${h}) {
            ${y}
            result[3] = getChannel(getX(${u.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iTe=({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:s,mode:i}=t,o=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sTe(r.shape,s,i):new rTe(r.shape,s,i);return e.runWebGLProgram(o,[r],r.dtype)},oTe={kernelName:Ng,backendName:"webgl",kernelFunc:iTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aTe=`if (b == 0.0) return NAN;
  return mod(a, b);`,lTe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Bc+`
  return result;
`,uTe=br({opSnippet:aTe,packedOpSnippet:lTe}),cTe={kernelName:Jd,backendName:"webgl",kernelFunc:uTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hTe{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dTe=`
if (a == b) {
  return 1.0;
};
return a / b;`,fTe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,hW=br({opSnippet:dTe,packedOpSnippet:fTe,checkOutOfBounds:!0}),pTe={kernelName:Fd,backendName:"webgl",kernelFunc:hW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP="return a - b;",dW=br({opSnippet:wP,packedOpSnippet:wP,supportsComplex:!0,cpuKernelImpl:ove}),mTe={kernelName:mf,backendName:"webgl",kernelFunc:dW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,o=ft([i],s.shape),a=cW({inputs:{x:s},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=xn(a.shape,o),u=Oe({inputs:{x:a},backend:t,attrs:{shape:l}}),h=dW({inputs:{a:s,b:u},backend:t}),d=aW({inputs:{x:h},backend:t}),p=Q1({inputs:{x:d},backend:t,attrs:{axis:o,keepDims:!1}}),m=Oe({inputs:{x:p},backend:t,attrs:{shape:l}}),y=hW({inputs:{a:d,b:m},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),y}const gTe={kernelName:qg,backendName:"webgl",kernelFunc:fW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yTe(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r,l=a?s:fW({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),u=l.shape[0],h=l.shape[1],d=new hTe(u,h,i),p=[[o]],m=t.runWebGLProgram(d,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),m}const wTe={kernelName:lb,backendName:"webgl",kernelFunc:yTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vTe=yi+`
  return -x;
`,xTe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function bTe(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId),[o,a]=Bwe(i.values,r.shape,r.dtype);return t.makeTensorInfo(a,r.dtype,o)}let s;return le().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new vl(r.shape,xTe):s=new xo(r.shape,vTe),t.runWebGLProgram(s,[r],r.dtype)}const ITe={kernelName:$g,backendName:"webgl",kernelFunc:bTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const STe=y1;function TTe(n){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,u=t.readSync(s.dataId),h=t.readSync(i.dataId),{selectedIndices:d}=STe(u,h,o,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const _Te={kernelName:ub,backendName:"webgl",kernelFunc:TTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CTe=w1;function ETe(n){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r,h=t.readSync(s.dataId),d=t.readSync(i.dataId),{selectedIndices:p,validOutputs:m}=CTe(h,d,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([m]))]}const kTe={kernelName:cb,backendName:"webgl",kernelFunc:ETe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NTe=v1;function $Te(n){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r,h=t.readSync(s.dataId),d=t.readSync(i.dataId),p=o,m=a,y=l,v=u,{selectedIndices:w,selectedScores:b}=NTe(h,d,p,m,y,v);return[t.makeTensorInfo([w.length],"int32",new Int32Array(w)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const RTe={kernelName:hb,backendName:"webgl",kernelFunc:$Te};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ATe{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DTe=n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r,u=fe(s.shape),h=new ATe(u,o,a,l),d=Oe({inputs:{x:s},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(h,[d],i);t.disposeIntermediateTensorInfo(d);const m=[...s.shape,o],y=Oe({inputs:{x:p},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(p),y},OTe={kernelName:Dg,backendName:"webgl",kernelFunc:DTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nx(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const s=Py({inputs:{input:r},backend:t}),i=nx({inputs:{x:s},backend:t}),o=Y1({inputs:{input:r},backend:t}),a=nx({inputs:{x:o},backend:t}),l=iu({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Fy({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const PTe={kernelName:Yg,backendName:"webgl",kernelFunc:nx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=Py({inputs:{input:r},backend:t}),i=pW({inputs:{x:s},backend:t}),o=Y1({inputs:{input:r},backend:t}),a=nx({inputs:{x:o},backend:t}),l=iu({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Fy({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const FTe={kernelName:Ag,backendName:"webgl",kernelFunc:pW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LTe(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return R_({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(h=>{yr(i,h.shape,"All tensors passed to stack must have matching shapes"),B(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const d=R_({inputs:{input:h},backend:t,attrs:{dim:s}});return a.push(d),d}),u=ZU({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const MTe={kernelName:Og,backendName:"webgl",kernelFunc:LTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VTe{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,h)=>u[0]+e[h]+u[1]);const s=e.length,i=Wt(s),o=t.map(u=>u[0]).join(","),a=t.map((u,h)=>u[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zTe{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((v,w)=>v[0]+e[w]+v[1]);const s=e.length,i=Wt(s),o=t.map(v=>v[0]).join(","),a=t.map((v,w)=>v[0]+e[w]).join(","),l=Ur("rc",s),u=Ur("source",s),h=`${l[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[s-1]} += 1;
       if(${h}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${l[s-2]} += 1;
       if(${l[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${l[s-1]} += 1;
         if(${h}) {`],m=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let y="";for(let v=0,w=s===1?2:4;v<w;v++)y+=`
        ${p[v]}
        if (${m}) {
          result[${v}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${v}] = getChannel(getX(${u.join()}), ${d});
        }
      `;y+=s===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mW=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:o}=r;if(fe(s.shape)===0){const u=i.map((h,d)=>h[0]+s.shape[d]+h[1]);return Fy({backend:t,attrs:{shape:u,value:o,dtype:s.dtype}})}const a=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zTe(s.shape,i,o):new VTe(s.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[s],s.dtype,l)},BTe={kernelName:Pg,backendName:"webgl",kernelFunc:mW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,WTe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Bc+`
  return result;
`,jTe=br({opSnippet:UTe,packedOpSnippet:WTe}),GTe={kernelName:ef,backendName:"webgl",kernelFunc:jTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HTe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=[],u=ft(i,s.shape);let h=u;const d=dn(h,a);let p=s;d!=null&&(p=Gr({inputs:{x:s},backend:t,attrs:{perm:d}}),h=bn(h.length,a),l.push(p)),vr("prod",h,a);let m;if(t.shouldExecuteOnCPU([p])){const y=t.texData.get(p.dataId).values,{outVals:v,outShape:w,outDtype:b}=Wwe(p.shape,p.dtype,y,h);m=t.makeTensorInfo(w,b,v)}else{const[y,v]=nr(p.shape,h),w=fe(v),b=Oe({inputs:{x:p},backend:t,attrs:{shape:[-1,w]}}),S=Lb(s.dtype),C=Uc(b,S,"prod",t);m=Oe({inputs:{x:C},backend:t,attrs:{shape:y}}),l.push(b),l.push(C)}if(o){l.push(m);const y=xn(m.shape,u);m=Oe({inputs:{x:m},backend:t,attrs:{shape:y}})}return l.forEach(y=>t.disposeIntermediateTensorInfo(y)),m}const qTe={kernelName:Lg,backendName:"webgl",kernelFunc:HTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KTe(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=r,l=s.map(b=>t.readSync(b.dataId)),u=s.map(b=>b.shape),h=t.readSync(i.dataId),d=t.readSync(o.dataId),[p,m,y]=jwe(l,u,h,i.shape,i.dtype,d,o.shape,a),v=p.map(b=>t.makeTensorInfo([b.length],"int32",b)),w=t.makeTensorInfo(y,i.dtype,m);return v.concat([w])}const XTe={kernelName:db,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QTe(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[u,h]=Gwe(o,r.shape,r.dtype,a,s.shape,l,i.shape),d=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([h.length],r.dtype,h);return[d,p]}const YTe={kernelName:fb,backendName:"webgl",kernelFunc:QTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JTe(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,u=t.readSync(s.dataId),h=t.readSync(i.dataId),d=t.readSync(o.dataId),p=a.map(w=>t.readSync(w.dataId)),m=a.map(w=>w.shape),[y,v]=Hwe(u,s.shape,h,i.shape,i.dtype,d,o.shape,p,m,l);return t.makeTensorInfo(y,i.dtype,v)}const ZTe={kernelName:pb,backendName:"webgl",kernelFunc:JTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gW=n=>{const{backend:e,attrs:t}=n,{start:r,stop:s,step:i,dtype:o}=t,a=qwe(r,s,i,o);return e.makeTensorInfo([a.length],o,a)},e_e={kernelName:mb,backendName:"webgl",kernelFunc:gW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_e="return 1.0 / x;",n_e=kt({opSnippet:t_e}),r_e={kernelName:tf,backendName:"webgl",kernelFunc:n_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_e=yi+`
  return (x < 0.0) ? 0.0 : x;
`,i_e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,o_e=kt({opSnippet:s_e,packedOpSnippet:i_e}),a_e={kernelName:nf,backendName:"webgl",kernelFunc:o_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_e=yi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,u_e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,c_e=kt({opSnippet:l_e,packedOpSnippet:u_e}),h_e={kernelName:rf,backendName:"webgl",kernelFunc:c_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d_e{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const h=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f_e{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const h=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,u]=a,h=le().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new f_e(s.shape,l,u,i,o):new d_e(s.shape,l,u,i,o);return t.runWebGLProgram(h,[s],"float32")}const m_e={kernelName:zg,backendName:"webgl",kernelFunc:p_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g_e{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],u=[r&&o>1?o-1:o,r&&a>1?a-1:a],h=l[0]/u[0],d=l[1]/u[1],p=1/h,m=1/d,y=Math.ceil(p)*2+2,v=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${y});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y_e(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r,a=new g_e(i.shape,s.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const w_e={kernelName:wb,backendName:"webgl",kernelFunc:y_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v_e{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const h=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r],p=s?"0.5":"0.0";let m;i?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x_e{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,r,u];const h=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r],p=s?"0.5":"0.0";let m;i?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_e(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,u]=a,h=le().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new x_e(s.shape,l,u,i,o):new v_e(s.shape,l,u,i,o);return t.runWebGLProgram(h,[s],s.dtype)}const I_e={kernelName:Vg,backendName:"webgl",kernelFunc:b_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S_e{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],u=[r&&o>1?o-1:o,r&&a>1?a-1:a],h=l[0]/u[0],d=l[1]/u[1],p=1/h,m=1/d,y=Math.ceil(p)*2+2,v=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${y});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:o}=r,a=new S_e(i.shape,s.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const __e={kernelName:yb,backendName:"webgl",kernelFunc:T_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C_e{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>s(l)).join(","),o=Wt(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E_e{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=Ur("rc",r),i=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Wt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(s.slice())};
          if(${i}){
            result.g = ${u(s.slice())};
          }
          if(${o}) {
            result.b = ${h(s.slice())};
            if(${i}) {
              result.a = ${d(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(y){return p(y)}function u(y){return y[r-1]="("+y[r-1]+" + 1)",p(y)}function h(y){return y[r-2]="("+y[r-2]+" + 1)",p(y)}function d(y){return y[r-1]="("+y[r-1]+" + 1)",y[r-2]="("+y[r-2]+" + 1)",p(y)}function p(y){const v=e.map((S,C)=>m(C,y)),w=v.join(","),b=v.slice(-2).join(",");return`getChannel(getX(${w}), vec2(${b}))`}function m(y,v){return t.indexOf(y)!==-1&&e[y]!==1?`${e[y]} - ${v[y]} - 1`:`${v[y]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r,o=s.shape.length,a=ft(i,s.shape);if(o===0)return $s({inputs:{x:s},backend:t});const l=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new E_e(s.shape,a):new C_e(s.shape,a);return t.runWebGLProgram(l,[s],s.dtype)}const N_e={kernelName:Bg,backendName:"webgl",kernelFunc:k_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $_e{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_e={kernelName:Pb,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:o}=e,a=t,l=new $_e(r.shape,i),[u,h]=pk(o,r.shape[1],r.shape[2]),d=[[u,h,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(l,[r],r.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,D_e=kt({opSnippet:A_e}),O_e={kernelName:sf,backendName:"webgl",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_e="return inversesqrt(x);",F_e=kt({opSnippet:P_e,cpuKernelImpl:Kwe}),L_e={kernelName:of,backendName:"webgl",kernelFunc:F_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P2{constructor(e,t,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Wt(i.length),h=Wt(o.length);let d="";r===1?d="i":r===2&&(d="i, j");const p=`getIndices(${d})`;let m="";s===1?m="i":s===2&&(m="i, coords[1]");const y=`getUpdates(${m})`;let v="";l&&(v="coords[0], coords[1]");const w=`getDefaultValue(${v})`,b=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${b};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${y};
              found = true;
            }
          }
          setOutput(mix(${w}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M_e{constructor(e,t,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Wt(i.length),h=Wt(o.length);let d="";r===1?d="i":r===2&&(d="i, j");const p=`getIndices(${d})`;let m="";s===1?m="i":s===2&&(m="i, coords[1]");const y=`getUpdates(${m})`;let v="";l&&(v="coords[0], coords[1]");const w=`getDefaultValue(${v})`,b=t>1?"strides[j]":"strides",S=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${b};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${S};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${y};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${w}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_e(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=ru(i,s,o),p=[d/u,u];if(d===0)return t.makeTensorInfo(o,s.dtype);const m=Oe({inputs:{x:s},backend:t,attrs:{shape:[l,a]}}),y=Oe({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0]));let w;le().getBool("WEBGL_PACK")?w=new M_e(l,a,m.shape.length,y.shape.length,h,p):w=new P2(l,a,m.shape.length,y.shape.length,h,p);const b=t.runWebGLProgram(w,[y,m,v],y.dtype),S=Oe({inputs:{x:b},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v),S}const z_e={kernelName:vb,backendName:"webgl",kernelFunc:V_e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B_e{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=le().getNumber("WEBGL_VERSION")===2?i:o,l=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_e(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:o}=r,a=new B_e(s.shape[0],s.shape[1],i.shape[1],o),l=[[s.shape[1]]];return t.runWebGLProgram(a,[s,i],"int32",l)}const W_e={kernelName:bb,backendName:"webgl",kernelFunc:U_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j_e{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",s="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let h=0;h<t.length;h++)u.push(`${a[h]}`),h<e&&l.push(`${a[h]}`);s=l.join(),i=u.join()}const o=Wt(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_e(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e,o=new j_e(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(o,[r,s,i],rs(s.dtype,i.dtype))}const H_e={kernelName:Ug,backendName:"webgl",kernelFunc:G_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T1};
  float scale = ${_1};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,K_e=kt({opSnippet:q_e}),X_e={kernelName:af,backendName:"webgl",kernelFunc:K_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_e=zf+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Y_e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,J_e=kt({opSnippet:Q_e,packedOpSnippet:Y_e,cpuKernelImpl:Qwe}),Z_e={kernelName:hf,backendName:"webgl",kernelFunc:J_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eCe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,tCe=kt({opSnippet:eCe}),nCe={kernelName:cf,backendName:"webgl",kernelFunc:tCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rCe=zf+`
  return sin(x);
`,sCe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Bc}
  return result;
`,iCe=kt({opSnippet:rCe,packedOpSnippet:sCe}),oCe={kernelName:lf,backendName:"webgl",kernelFunc:iCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aCe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,lCe=kt({opSnippet:aCe}),uCe={kernelName:uf,backendName:"webgl",kernelFunc:lCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cCe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,hCe=kt({opSnippet:cCe}),dCe={kernelName:df,backendName:"webgl",kernelFunc:hCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fCe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:o}=r;B(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((b,S)=>b*S),l=[[0,0]];l.push(...o);for(let b=1+i.length;b<s.shape.length;++b)l.push([0,0]);const u=[],h=mW({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),d=wy(h.shape,i,a,!1),p=vy(d.length,i.length,!1),m=xy(h.shape,i,a,!1),y=Oe({inputs:{x:h},backend:t,attrs:{shape:d}}),v=Gr({inputs:{x:y},backend:t,attrs:{perm:p}}),w=Oe({inputs:{x:v},backend:t,attrs:{shape:m}});return u.push(h),u.push(y),u.push(v),u.forEach(b=>t.disposeIntermediateTensorInfo(b)),w},pCe={kernelName:Gg,backendName:"webgl",kernelFunc:fCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mCe(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(r.dataId),l=t.readSync(s.dataId),u=t.readSync(i.dataId),h=t.readSync(o.dataId)[0],[d,p,m,y,v]=Jwe(a,r.shape,r.dtype,l,s.dtype,u,h);return[t.makeTensorInfo(p,r.dtype,d),t.makeTensorInfo([p[0]],s.dtype,m),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(w=>Number(w)))),t.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}const gCe={kernelName:Ib,backendName:"webgl",kernelFunc:mCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yCe(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(s.dataId)),a=t.readSync(r.dataId),l=Array.from(t.readSync(i.dataId)),[u,h,d]=Zwe(a,r.shape,r.dtype,o,l);return[t.makeTensorInfo(h,r.dtype,u),t.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}const wCe={kernelName:Sb,backendName:"webgl",kernelFunc:yCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vCe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[u,h]=MU(o,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(h,r.dtype,u)}const xCe={kernelName:Tb,backendName:"webgl",kernelFunc:vCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bCe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(i.dataId),[u,h]=MU(o,r.shape,r.dtype,a,l);return t.makeTensorInfo(h,r.dtype,u)}const ICe={kernelName:_b,backendName:"webgl",kernelFunc:bCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SCe(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:p}=ru(i,s,a),m=!1;if(i.dtype==="string"){const b=t.bufferSync(s),S=t.bufferSync(i),C=ba(t.readSync(o.dataId)[0]),T=Xwe(b,S,a,p,h,u,l,d,C,m);return t.makeTensorInfo(a,T.dtype,T.values)}const y=new P2(u,l,s.shape.length,i.shape.length,d,[p,1],m),v=t.runWebGLProgram(y,[i,s,o],i.dtype),w=Oe({inputs:{x:v},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(v),w}const TCe={kernelName:Cb,backendName:"webgl",kernelFunc:SCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ce(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=ft(o,s.shape)[0],l=Nk(s,i,a),u=s.shape.length,h=new Array(u).fill(0),d=s.shape.slice();return l.map(p=>{const m=[...d];m[a]=p;const y=Bf({inputs:{x:s},backend:t,attrs:{begin:h,size:m}});return h[a]+=p,y})}const CCe={kernelName:Hg,backendName:"webgl",kernelFunc:_Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP="return sqrt(x);",ECe=kt({opSnippet:vP,packedOpSnippet:vP,cpuKernelImpl:eve}),kCe={kernelName:ff,backendName:"webgl",kernelFunc:ECe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NCe="return x * x;",$Ce=kt({opSnippet:NCe}),RCe={kernelName:Eb,backendName:"webgl",kernelFunc:$Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP="return (a - b) * (a - b);",ACe=br({opSnippet:xP,packedOpSnippet:xP}),DCe={kernelName:pf,backendName:"webgl",kernelFunc:ACe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OCe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(s.dataId),o=Ca(i),a=tve(o,"string",r);return t.makeTensorInfo(s.shape,"string",a)}const PCe={kernelName:Kg,backendName:"webgl",kernelFunc:OCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FCe({inputs:n,attrs:e,backend:t}){const{x:r}=n,s=yi+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new xo(r.shape,s);return t.runWebGLProgram(i,[r],r.dtype)}const LCe={kernelName:vf,backendName:"webgl",kernelFunc:FCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MCe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,i=Wt(r.length),o=Wt(r.length);let a="";if(s===1)a="coords * strides + begin";else{let l=0;a=r.map((u,h)=>(l++,r.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=r,{finalShapeSparse:m,finalShape:y,isIdentity:v,sliceDim0:w,isSimpleSlice:b,begin:S,end:C,strides:T}=ck(s.shape,i,o,a,l,u,h,d,p);let O;if(v)O=Oe({inputs:{x:s},backend:t,attrs:{shape:y}});else if(w||b){B(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const k=ak(S,C,T),$=Bf({inputs:{x:s},backend:t,attrs:{begin:S,size:k}});O=Oe({inputs:{x:$},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo($)}else if(t.shouldExecuteOnCPU([s])){const $=t.readSync(s.dataId),N=ht(s.shape,s.dtype,$),R=nve(m,N,T,S);O=t.makeTensorInfo(y,s.dtype,R.values)}else{const $=new MCe(S,T,m);O=t.runWebGLProgram($,[s],s.dtype)}const V=Oe({inputs:{x:O},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(O),V}const zCe={kernelName:kb,backendName:"webgl",kernelFunc:VCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BCe(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:h,dataSplits:d}=e,p=t.readSync(h.dataId),m=t.readSync(d.dataId),[y,v]=rve(p,m,s,i,o,a,l,u);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(d.shape,"int32",v)]}const UCe={kernelName:Nb,backendName:"webgl",kernelFunc:BCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WCe(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,h,d]=sve(a,l,s),p=h.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const jCe={kernelName:$b,backendName:"webgl",kernelFunc:WCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GCe(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=ive(o,s);return t.makeTensorInfo(i.shape,"int32",a)}const HCe={kernelName:Rb,backendName:"webgl",kernelFunc:GCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qCe="return tan(x);",KCe=kt({opSnippet:qCe}),XCe={kernelName:gf,backendName:"webgl",kernelFunc:KCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QCe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,YCe=kt({opSnippet:QCe}),JCe={kernelName:yf,backendName:"webgl",kernelFunc:YCe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZCe(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:s,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=ru(o,i,s.shape),p=[d/u,u];if(d===0)return t.makeTensorInfo(s.shape,i.dtype);const m=Oe({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),y=Oe({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),v=Oe({inputs:{x:s},backend:t,attrs:{shape:p}}),w=new P2(l,a,m.shape.length,y.shape.length,h,p,!1,!0),b=t.runWebGLProgram(w,[y,m,v],v.dtype),S=Oe({inputs:{x:b},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),S}const eEe={kernelName:xb,backendName:"webgl",kernelFunc:ZCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tEe{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[o]*t[o];this.outputShape=r,this.rank=r.length;const s=Wt(this.rank),i=nEe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function nEe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<n.length;s++)r.push(`imod(${t[s]}, ${n[s]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;if(s.dtype==="string"||s.shape.length>5){const l=t.readSync(s.dataId),u=s.dtype==="string"?l.map(p=>ba(p)):l,h=ht(s.shape,s.dtype,u),d=ave(h,i);return t.makeTensorInfo(d.shape,d.dtype,d.values)}const o=new tEe(s.shape,i);return t.runWebGLProgram(o,[s],s.dtype)}const rEe={kernelName:wf,backendName:"webgl",kernelFunc:yW};class sEe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class iEe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pu(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function bP(n){let e=1;for(;e<n;)e*=2;return e}function oEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:o}=r,a=le().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=le().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=s.shape,h=u[u.length-1];if(t.shouldExecuteOnCPU([s])||h<a||i>l){const R=t.readSync(s.dataId),[E,L]=lve(R,u,s.dtype,i,o);return[t.makeTensorInfo(E.shape,E.dtype,E.values),t.makeTensorInfo(L.shape,L.dtype,L.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,s.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(h===1)return[s,Fy({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const d=t.texData.get(s.dataId),p=d!==null&&d.isPacked,m=p?t.unpackTensor(s):s,v=fe(u)/h,w=Oe({inputs:{x:m},attrs:{shape:[v,h]},backend:t});p&&Pu(t,m);const b=bP(i),S=bP(h);let C=null;const T=()=>C===null?[w,w]:[w,C],O=(R,E,L)=>{const F=T(),G=new sEe(L),q=[[h],[C===null?1:0],[Number.NEGATIVE_INFINITY],[R],[E]],se=C;C=t.runWebGLProgram(G,F,"int32",q),Pu(t,se)};for(let R=1;R<b;R*=2){const E=R*2;for(let L=R;L>=1;L/=2)O(E,L,[v,S])}for(let R=S;R>b;R/=2){const E=T(),L=new iEe([v,R/2]),G=[[h],[C===null?1:0],[b]],Y=C;C=t.runWebGLProgram(L,E,"int32",G),Pu(t,Y);const q=b/2,se=q*2;for(let X=q;X>=1;X/=2)O(se,X,C.shape)}let V=C;C=Bf({inputs:{x:C},backend:t,attrs:{begin:0,size:[v,i]}}),Pu(t,V);let k=uW({inputs:{x:w,indices:C},backend:t,attrs:{axis:1,batchDims:1}});Pu(t,w);const $=u.slice(0,-1);$.push(i),V=C,C=Oe({inputs:{x:C},attrs:{shape:$},backend:t}),Pu(t,V);const N=k;return k=Oe({inputs:{x:k},attrs:{shape:$},backend:t}),Pu(t,N),[k,C]}const aEe={kernelName:Ab,backendName:"webgl",kernelFunc:oEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lEe{constructor(e,t,r,s,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let l;switch(s){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uEe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=r,[h,d,p,m]=s.shape,[y,v]=u??[d,p],w=[h,y,v,m],b=new lEe(d,p,o,a,l,w);return t.runWebGLProgram(b,[s,i],"float32")}const cEe={kernelName:Db,backendName:"webgl",kernelFunc:uEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hEe(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Of(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=uve(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}const dEe={kernelName:Ob,backendName:"webgl",kernelFunc:hEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fEe(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s,a=o.shape.length,l=s.shape[i],u=new Array(a-1);let h=0;for(let v=0;v<a;v++)v!==i&&(u[h++]=o.shape[v]);const d=[],p=new Array(a).fill(0),m=o.shape.slice();m[i]=1;const y=new Array(l);for(let v=0;v<y.length;v++){p[i]=v;const w=Bf({inputs:{x:o},backend:t,attrs:{begin:p,size:m}}),b=Oe({inputs:{x:w},backend:t,attrs:{shape:u}});y[v]=b,d.push(w)}return d.forEach(v=>t.disposeIntermediateTensorInfo(v)),y}const pEe={kernelName:Xg,backendName:"webgl",kernelFunc:fEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mEe{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/r);this.outputShape=[s,a];const l="0.0",u="sumValue",h=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `;let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let y="";i%r>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${y}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:o}=r,a=s.shape.length,l=[];let u=0;const h=dn([u],a);let d=s;h!=null&&(d=Gr({inputs:{x:s},backend:t,attrs:{perm:h}}),l.push(d),u=bn(1,a)[0]);const p=H3(d.shape,u,o),m=fe([d.shape[u]]),y=Oe({inputs:{x:d},backend:t,attrs:{shape:[-1,m]}});l.push(y);const v=Lb(s.dtype),w=(T,O,V,k,$)=>{const N=T.shape[0],R=T.shape[1],E=G3(R,$),L={windowSize:E,inSize:R,batchSize:N,numSegments:$},F=new mEe(L,O),G=t.compileAndRun(F,[T,V],k);if(l.push(G),G.shape[1]===$)return G;const Y=gW({backend:t,attrs:{start:0,stop:$,step:1,dtype:"float32"}}),q=yW({inputs:{x:Y},backend:t,attrs:{reps:[R/E]}});return l.push(Y),l.push(q),w(G,O,q,k,$)},b=w(y,"unsortedSegmentSum",i,v,o),S=Oe({inputs:{x:b},backend:t,attrs:{shape:p}});let C=S;if(h!=null){l.push(S);const T=Zl(h);C=Gr({inputs:{x:C},backend:t,attrs:{perm:T}})}return l.forEach(T=>t.disposeIntermediateTensorInfo(T)),C}const yEe={kernelName:Qg,backendName:"webgl",kernelFunc:gEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wEe=[txe,rxe,oxe,uxe,hxe,pxe,gxe,wxe,Ixe,Txe,Exe,$xe,Dxe,Lxe,zxe,Uxe,jxe,Kxe,Qxe,Jxe,nbe,ube,hbe,mbe,ybe,Sbe,_be,Nbe,Mve,Abe,Lbe,Bbe,qbe,Qbe,Jbe,e1e,n1e,o1e,u1e,d1e,p1e,g1e,w1e,b1e,S1e,E1e,N1e,A1e,P1e,L1e,B1e,G1e,X1e,J1e,tIe,nIe,sIe,oIe,lIe,cIe,dIe,gIe,vIe,IIe,TIe,EIe,$Ie,OIe,MIe,Lve,zIe,Pbe,WIe,HIe,XIe,zve,ZIe,rSe,iSe,uSe,dSe,gSe,vSe,SSe,ESe,$Se,ASe,FSe,MSe,zSe,jSe,HSe,KSe,QSe,JSe,nTe,oTe,cTe,wTe,Wve,ITe,_Te,kTe,RTe,vbe,OTe,FTe,MTe,BTe,GTe,Uve,qTe,XTe,YTe,ZTe,e_e,xbe,pTe,r_e,a_e,h_e,Gve,m_e,w_e,I_e,__e,N_e,R_e,O_e,L_e,z_e,W_e,H_e,X_e,Z_e,nCe,oCe,uCe,abe,gTe,dCe,pCe,gCe,wCe,xCe,ICe,TCe,CCe,kCe,RCe,DCe,PCe,LCe,zCe,UCe,jCe,HCe,mTe,Jve,XCe,JCe,eEe,rEe,aEe,cEe,Zve,dEe,pEe,yEe,PTe];for(const n of wEe)Fb(n);/** @license See the LICENSE file. */const vEe="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xEe={"tfjs-core":I3,"tfjs-backend-cpu":E4,"tfjs-backend-webgl":BU,"tfjs-data":RB,"tfjs-layers":M1,"tfjs-converter":fB,tfjs:vEe},bEe=Object.freeze(Object.defineProperty({__proto__:null,Abs:Xm,Acos:Td,Acosh:_d,AdadeltaOptimizer:YE,AdagradOptimizer:JE,AdamOptimizer:ZE,AdamaxOptimizer:ek,Add:Rc,AddN:Qm,All:Rx,Any:Ax,ArgMax:Ym,ArgMin:Jm,Asin:Cd,Asinh:Ed,Atan:kd,Atan2:$d,Atanh:Nd,AvgPool:Zm,AvgPool3D:eg,AvgPool3DGrad:Ox,AvgPoolGrad:Dx,BatchMatMul:tg,BatchToSpaceND:ng,Bincount:Px,BitwiseAnd:rg,BroadcastArgs:Fx,BroadcastTo:IM,Callback:lB,CallbackList:hz,Cast:Rd,Ceil:Ad,ClipByValue:Dd,Complex:Lx,ComplexAbs:sg,Concat:ig,Conv2D:og,Conv2DBackpropFilter:Mx,Conv2DBackpropInput:ag,Conv3D:lg,Conv3DBackpropFilterV2:Vx,Conv3DBackpropInputV2:zx,Cos:Od,Cosh:Pd,CropAndResize:Ux,Cumprod:Bx,Cumsum:ug,CustomCallback:fz,DataStorage:EC,DenseBincount:Wx,DepthToSpace:jx,DepthwiseConv2dNative:cg,DepthwiseConv2dNativeBackpropFilter:Gx,DepthwiseConv2dNativeBackpropInput:Hx,Diag:qx,Dilation2D:hg,Dilation2DBackpropFilter:Rv,Dilation2DBackpropInput:$v,Draw:Kx,get ENV(){return AC},EarlyStopping:uB,Einsum:Xx,Elu:Ld,EluGrad:Qx,Environment:xM,Equal:dg,Erf:Md,Exp:Vd,ExpandDims:fg,Expm1:zd,FFT:Yx,Fill:Jx,FlipLeftRight:Zx,Floor:Bd,FloorDiv:Ud,FromPixels:Av,FusedBatchNorm:pg,FusedConv2D:mm,FusedDepthwiseConv2D:gm,GPGPUContext:iv,GatherNd:eb,GatherV2:mg,GraphModel:a2,Greater:gg,GreaterEqual:Wd,History:dz,IFFT:tb,Identity:jd,Imag:nb,InputSpec:Nn,IsFinite:Gd,IsInf:Hd,IsNan:qd,KernelBackend:kx,LRN:Sg,LRNGrad:sb,LayerVariable:az,LayersModel:pa,LeakyRelu:yg,Less:wg,LessEqual:vg,LinSpace:rb,Log:Kd,Log1p:Xd,LogSoftmax:SM,LogicalAnd:xg,LogicalNot:bg,LogicalOr:Ig,LogicalXor:RX,LowerBound:AX,MathBackendCPU:$y,MathBackendWebGL:Oy,MatrixBandPart:DX,Max:Tg,MaxPool:_g,MaxPool3D:Cg,MaxPool3DGrad:ob,MaxPoolGrad:ib,MaxPoolWithArgmax:ab,Maximum:Qd,Mean:Eg,Min:kg,Minimum:Yd,MirrorPad:Ng,Mod:Jd,MomentumOptimizer:tk,Multinomial:lb,Multiply:Zd,Neg:$g,NonMaxSuppressionV3:ub,NonMaxSuppressionV4:cb,NonMaxSuppressionV5:hb,NotEqual:Rg,OP_SCOPE_SUFFIX:LC,OneHot:Dg,OnesLike:Ag,Optimizer:La,OptimizerConstructors:S3,Pack:Og,PadV2:Pg,Pool:OX,Pow:ef,Prelu:Fg,Prod:Lg,RMSPropOptimizer:nk,RNN:to,RaggedGather:db,RaggedRange:fb,RaggedTensorToTensor:pb,Range:mb,get Rank(){return VT},Real:gb,RealDiv:Fd,Reciprocal:tf,get Reduction(){return Br},Relu:nf,Relu6:rf,Reshape:Mg,ResizeBilinear:zg,ResizeBilinearGrad:wb,ResizeNearestNeighbor:Vg,ResizeNearestNeighborGrad:yb,Reverse:Bg,RotateWithOffset:Pb,Round:sf,Rsqrt:of,SGDOptimizer:x1,ScatterNd:vb,SearchSorted:bb,Select:Ug,Selu:af,Sequential:yc,Sigmoid:hf,Sign:cf,Sin:lf,Sinh:uf,Slice:Wg,Softmax:qg,Softplus:df,SpaceToBatchND:Gg,SparseFillEmptyRows:Ib,SparseReshape:Sb,SparseSegmentMean:Tb,SparseSegmentSum:_b,SparseToDense:Cb,SplitV:Hg,Sqrt:ff,Square:Eb,SquaredDifference:pf,StaticRegexReplace:Kg,Step:vf,StridedSlice:kb,StringNGrams:Nb,StringSplit:$b,StringToHashBucketFast:Rb,Sub:mf,Sum:jg,SymbolicTensor:Qi,Tan:gf,Tanh:yf,Tensor:Et,TensorBuffer:$n,TensorScatterUpdate:xb,Tile:wf,TopK:Ab,Transform:Db,Transpose:Ju,Unique:Ob,Unpack:Xg,UnsortedSegmentSum:Qg,UpperBound:PX,Variable:vm,ZerosLike:Yg,_FusedMatMul:pm,abs:En,acos:GC,acosh:HC,add:be,addN:ZM,all:zb,any:bm,argMax:cc,argMin:qC,asin:KC,asinh:XC,atan:QC,atan2:YC,atanh:JC,avgPool:ty,avgPool3d:eE,backend:VC,backend_util:K3,basicLSTMCell:eV,batchNorm:xf,batchNorm2d:tE,batchNorm3d:nE,batchNorm4d:rE,batchToSpaceND:ny,bincount:sE,bitwiseAnd:tV,booleanMaskAsync:VV,broadcastArgs:nV,broadcastTo:Zu,broadcast_util:dY,browser:Nne,buffer:ht,callbacks:Hle,cast:Re,ceil:iE,clipByValue:is,clone:ko,complex:Sa,concat:vn,concat1d:oE,concat2d:aE,concat3d:lE,concat4d:uE,constraints:Rie,conv1d:Bb,conv2d:Ta,conv2dTranspose:Ub,conv3d:hE,conv3dTranspose:dE,copyRegisteredKernels:VX,cos:ry,cosh:Wb,cosineWindow:d1,cumprod:Tm,cumsum:jb,customGrad:Lo,data:whe,denseBincount:Pv,deprecationWarn:g7,depthToSpace:fE,depthwiseConv2d:bf,deregisterOp:Xle,device_util:c7,diag:sV,dilation2d:pE,disableDeprecationWarnings:m7,dispose:ot,disposeVariables:y7,div:je,divNoNan:mE,dot:gE,dropout:HE,einsum:Bu,elu:If,enableDebugMode:p7,enableProdMode:f7,enclosingPowerOfTwo:qE,engine:Vi,ensureShape:iV,env:le,equal:Es,erf:Gb,euclideanNorm:wE,exp:os,expandDims:dr,expm1:vE,eye:Hb,fft:gy,fill:Ac,findBackend:S7,findBackendFactory:T7,floor:Tf,floorDiv:Vb,forceHalfFloat:UU,fused:KV,gather:_f,gatherND:WV,gather_util:$ne,getBackend:VM,getGradient:LT,getKernel:wm,getKernelsForBackend:Dv,gpgpu_util:ywe,grad:XY,grads:QY,greater:qr,greaterEqual:Oa,ifft:ud,imag:sy,image:di,inTopKAsync:jV,initializers:qie,input:Ez,io:ik,irfft:o1,isFinite:xE,isInf:bE,isNaN:IE,keep:Fn,kernel_impls:Vne,layers:Ile,leakyRelu:iy,less:id,lessEqual:eu,linalg:QE,linspace:lV,loadGraphModel:xce,loadGraphModelSync:bce,loadLayersModel:Loe,localResponseNormalization:SE,log:ks,log1p:oy,logSigmoid:TE,logSoftmax:Kb,logSumExp:ay,logicalAnd:pi,logicalNot:ly,logicalOr:Xb,logicalXor:_E,losses:t3,lowerBound:cV,matMul:dt,math:xne,max:Ks,maxPool:uy,maxPool3d:CE,maxPoolWithArgmax:hV,maximum:zo,mean:un,memory:GT,meshgrid:dV,metrics:Vle,min:sd,minimum:zl,mirrorPad:EE,mod:kE,model:zoe,models:zle,moments:cy,movingAverage:zV,mul:J,multiRNNCell:fV,multinomial:pV,neg:Qt,nextFrame:hk,norm:Sf,notEqual:fc,oneHot:od,ones:ts,onesLike:Ns,op:Q,outerProduct:mV,pad:Pa,pad1d:gV,pad2d:yV,pad3d:wV,pad4d:vV,pool:NE,pow:Fo,prelu:dy,print:jC,prod:$E,profile:w7,raggedGather:xV,raggedRange:bV,raggedTensorToTensor:IV,rand:SV,randomGamma:CV,randomNormal:Yb,randomStandardNormal:EV,randomUniform:tu,randomUniformInt:kV,range:pc,ready:b7,real:ad,reciprocal:FE,registerBackend:MC,registerCallbackConstructor:Uoe,registerGradient:TM,registerKernel:Fb,registerOp:Kle,regularizers:jle,relu:Zi,relu6:Jb,removeBackend:I7,reshape:ee,reverse:Xs,reverse1d:NV,reverse2d:$V,reverse3d:RV,reverse4d:AV,rfft:yy,round:Zb,rsqrt:e1,scalar:Xe,scatterND:BV,scatter_util:ZZ,searchSorted:Qb,selu:t1,separableConv2d:n1,sequential:Boe,serialization:ene,setBackend:x7,setPlatform:_7,setWebGLContext:j4,setdiff1dAsync:DV,shared:C4,sigmoid:ji,sign:LE,signal:e3,sin:r1,sinh:s1,slice:vt,slice1d:fy,slice2d:i1,slice3d:py,slice4d:ld,slice_util:b3,softmax:my,softplus:Dc,spaceToBatchND:hy,sparse:n3,sparseToDense:UV,spectral:ZV,split:ns,sqrt:Zn,square:Ut,squaredDifference:a1,squeeze:nu,stack:jr,step:Oc,stridedSlice:ME,string:r3,sub:Le,sum:ze,sumOutType:Lb,tan:VE,tanh:Vl,tensor:Cs,tensor1d:mr,tensor2d:Cl,tensor3d:zE,tensor4d:OV,tensor5d:PV,tensor6d:FV,tensorScatterUpdate:LV,tensor_util:i7,test_util:dZ,tidy:ae,tile:js,time:v7,topk:UE,train:Vu,transpose:yt,truncatedNormal:u1,unique:WE,unregisterGradient:MX,unregisterKernel:LX,unsortedSegmentSum:c1,unstack:Qs,upcastType:rs,upperBound:MV,util:qX,valueAndGrad:YY,valueAndGrads:JY,variable:jE,variableGrads:uV,version:xEe,version_converter:fB,version_core:I3,version_cpu:E4,version_layers:M1,version_webgl:BU,webgl:Fve,webgl_util:S0e,where:Qn,whereAsync:GE,zeros:kn,zerosLike:xt},Symbol.toStringTag,{value:"Module"})),Dm=A_(bEe);var Fu={},IP;function wW(){if(IP)return Fu;IP=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Fu,"__esModule",{value:!0}),Fu.cropTensor=Fu.capture=void 0;var n=Dm;function e(r,s){return n.tidy(function(){var i=n.browser.fromPixels(r),o=t(i,s),a=o.expandDims(0);return a.toFloat().div(n.scalar(127)).sub(n.scalar(1))})}Fu.capture=e;function t(r,s,i){var o=Math.min(r.shape[0],r.shape[1]),a=r.shape[0]/2,l=a-o/2,u=r.shape[1]/2,h=u-o/2;if(s&&!i){var d=r.slice([l,h,0],[o,o,3]);d=d.reshape([o*o,1,3]);var p=[.2989,.587,.114];return d=n.mul(d,p),d=d.reshape([o,o,3]),d=n.sum(d,-1),d=n.expandDims(d,-1),d}return r.slice([l,h,0],[o,o,3])}return Fu.cropTensor=t,Fu}var Fi={},SP;function vW(){if(SP)return Fi;SP=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.cropTo=Fi.resizeMinTo=Fi.resizeMaxTo=Fi.resize=void 0;var n=function(){return document.createElement("canvas")};function e(i,o,a){a===void 0&&(a=n()),a.width=i.width*o,a.height=i.height*o;var l=a.getContext("2d");return l.drawImage(i,0,0,a.width,a.height),a}Fi.resize=e;function t(i,o,a){a===void 0&&(a=n());var l=Math.max(i.width,i.height);return e(i,o/l,a)}Fi.resizeMaxTo=t;function r(i,o,a){a===void 0&&(a=n());var l=Math.min(i.width,i.height);return e(i,o/l,a)}Fi.resizeMinTo=r;function s(i,o,a,l){a===void 0&&(a=!1),l===void 0&&(l=n());var u=i.width,h=i.height;i instanceof HTMLVideoElement&&(u=i.videoWidth,h=i.videoHeight);var d=Math.min(u,h),p=o/d,m=Math.ceil(u*p),y=Math.ceil(h*p),v=m-o,w=y-o;l.width=l.height=o;var b=l.getContext("2d");return b.drawImage(i,~~(v/2)*-1,~~(w/2)*-1,m,y),a&&(b.scale(-1,1),b.drawImage(l,o*-1,0)),l}return Fi.cropTo=s,Fi}var Fp={},TP;function xW(){if(TP)return Fp;TP=1;/** @license See the LICENSE file. */Object.defineProperty(Fp,"__esModule",{value:!0}),Fp.version=void 0;var n="0.8.4-alpha2";return Fp.version=n,Fp}var _P;function bW(){return _P||(_P=1,function(n){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var e=Du&&Du.__awaiter||function(k,$,N,R){function E(L){return L instanceof N?L:new N(function(F){F(L)})}return new(N||(N=Promise))(function(L,F){function G(se){try{q(R.next(se))}catch(X){F(X)}}function Y(se){try{q(R.throw(se))}catch(X){F(X)}}function q(se){se.done?L(se.value):E(se.value).then(G,Y)}q((R=R.apply(k,$||[])).next())})},t=Du&&Du.__generator||function(k,$){var N={label:0,sent:function(){if(L[0]&1)throw L[1];return L[1]},trys:[],ops:[]},R,E,L,F;return F={next:G(0),throw:G(1),return:G(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function G(q){return function(se){return Y([q,se])}}function Y(q){if(R)throw new TypeError("Generator is already executing.");for(;N;)try{if(R=1,E&&(L=q[0]&2?E.return:q[0]?E.throw||((L=E.return)&&L.call(E),0):E.next)&&!(L=L.call(E,q[1])).done)return L;switch(E=0,L&&(q=[q[0]&2,L.value]),q[0]){case 0:case 1:L=q;break;case 4:return N.label++,{value:q[1],done:!1};case 5:N.label++,E=q[1],q=[0];continue;case 7:q=N.ops.pop(),N.trys.pop();continue;default:if(L=N.trys,!(L=L.length>0&&L[L.length-1])&&(q[0]===6||q[0]===2)){N=0;continue}if(q[0]===3&&(!L||q[1]>L[0]&&q[1]<L[3])){N.label=q[1];break}if(q[0]===6&&N.label<L[1]){N.label=L[1],L=q;break}if(L&&N.label<L[2]){N.label=L[2],N.ops.push(q);break}L[2]&&N.ops.pop(),N.trys.pop();continue}q=$.call(k,N)}catch(se){q=[6,se],E=0}finally{R=L=0}if(q[0]&5)throw q[1];return{value:q[0]?q[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.loadFromFiles=n.load=n.loadTruncatedMobileNet=n.CustomMobileNet=n.getTopKClasses=n.IMAGE_SIZE=void 0;var r=Dm,s=Dm,i=wW(),o=vW(),a=xW(),l=1,u="conv_pw_13_relu",h="out_relu",d=.25,p=.35;n.IMAGE_SIZE=224;var m=function(k){return k.packageVersion=k.packageVersion||a.version,k.packageName=k.packageName||"@teachablemachine/image",k.timeStamp=k.timeStamp||new Date().toISOString(),k.userMetadata=k.userMetadata||{},k.modelName=k.modelName||"untitled",k.labels=k.labels||[],k.imageSize=k.imageSize||n.IMAGE_SIZE,k},y=function(k){return!!k&&Array.isArray(k.labels)},v=function(k,$){if(k===1){if($!==.25&&$!==.5&&$!==.75&&$!==1)return console.warn("Invalid alpha. Options are: 0.25, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",d.toFixed(2)),d}else if($!==.35&&$!==.5&&$!==.75&&$!==1)return console.warn("Invalid alpha. Options are: 0.35, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",p.toFixed(2)),p;return $},w=function(k){if(k=k||{},k.checkpointUrl&&k.trainingLayer)return(k.alpha||k.version)&&console.warn("Checkpoint URL passed to modelOptions, alpha options are ignored"),[k.checkpointUrl,k.trainingLayer];if(k.version=k.version||l,k.version===1){k.alpha=k.alpha||d,k.alpha=v(k.version,k.alpha),console.log("Loading mobilenet "+k.version+" and alpha "+k.alpha);var $=k.alpha.toFixed(2);return $==="1.00"&&($="1.0"),["https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_"+$+"_"+n.IMAGE_SIZE+"/model.json",u]}else{if(k.version===2)return k.alpha=k.alpha||p,k.alpha=v(k.version,k.alpha),console.log("Loading mobilenet "+k.version+" and alpha "+k.alpha),["https://storage.googleapis.com/teachable-machine-models/mobilenet_v2_weights_tf_dim_ordering_tf_kernels_"+k.alpha.toFixed(2)+"_"+n.IMAGE_SIZE+"_no_top/model.json",h];throw new Error("MobileNet V"+k.version+" doesn't exist")}},b=function(k){return e(void 0,void 0,void 0,function(){var $,N;return t(this,function(R){switch(R.label){case 0:return typeof k!="string"?[3,3]:[4,fetch(k)];case 1:return N=R.sent(),[4,N.json()];case 2:return $=R.sent(),[3,4];case 3:if(y(k))$=k;else throw new Error("Invalid Metadata provided");R.label=4;case 4:return[2,m($)]}})})};function S(k,$,N){return N===void 0&&(N=3),e(this,void 0,void 0,function(){var R;return t(this,function(E){switch(E.label){case 0:return[4,$.data()];case 1:return R=E.sent(),[2,r.tidy(function(){N=Math.min(N,R.length);for(var L=[],F=0;F<R.length;F++)L.push({value:R[F],index:F});L.sort(function(se,X){return X.value-se.value});for(var G=new Float32Array(N),Y=new Int32Array(N),F=0;F<N;F++)G[F]=L[F].value,Y[F]=L[F].index;for(var q=[],F=0;F<Y.length;F++)q.push({className:k[Y[F]],probability:G[F]});return q})]}})})}n.getTopKClasses=S;var C=function(){function k($,N){this.model=$,this._metadata=m(N)}return Object.defineProperty(k,"EXPECTED_IMAGE_SIZE",{get:function(){return n.IMAGE_SIZE},enumerable:!1,configurable:!0}),k.prototype.getMetadata=function(){return this._metadata},k.prototype.getTotalClasses=function(){var $=this.model.output,N=$.shape[1];return N},k.prototype.getClassLabels=function(){return this._metadata.labels},k.prototype.predictTopK=function($,N,R){return N===void 0&&(N=10),R===void 0&&(R=!1),e(this,void 0,void 0,function(){var E,L,F,G=this;return t(this,function(Y){switch(Y.label){case 0:return E=o.cropTo($,this._metadata.imageSize,R),L=r.tidy(function(){var q=i.capture(E,G._metadata.grayscale);return G.model.predict(q)}),[4,S(this._metadata.labels,L,N)];case 1:return F=Y.sent(),s.dispose(L),[2,F]}})})},k.prototype.predict=function($,N){return N===void 0&&(N=!1),e(this,void 0,void 0,function(){var R,E,L,F,G,Y=this;return t(this,function(q){switch(q.label){case 0:return R=o.cropTo($,this._metadata.imageSize,N),E=r.tidy(function(){var se=i.capture(R,Y._metadata.grayscale);return Y.model.predict(se)}),[4,E.data()];case 1:for(L=q.sent(),F=[],G=0;G<L.length;G++)F.push({className:this._metadata.labels[G],probability:L[G]});return s.dispose(E),[2,F]}})})},k.prototype.dispose=function(){this.truncatedModel.dispose()},k}();n.CustomMobileNet=C;function T(k){return e(this,void 0,void 0,function(){var $,N,R,E,L,F,G,L,F,G;return t(this,function(Y){switch(Y.label){case 0:return $=w(k),N=$[0],R=$[1],[4,r.loadLayersModel(N)];case 1:return E=Y.sent(),k&&k.version===1?(L=E.getLayer(R),F=r.model({inputs:E.inputs,outputs:L.output}),G=r.sequential(),G.add(F),G.add(r.layers.flatten()),[2,G]):(L=E.getLayer(R),F=r.model({inputs:E.inputs,outputs:L.output}),G=r.sequential(),G.add(F),G.add(r.layers.globalAveragePooling2d({})),[2,G])}})})}n.loadTruncatedMobileNet=T;function O(k,$){return e(this,void 0,void 0,function(){var N,R,E;return t(this,function(L){switch(L.label){case 0:return[4,r.loadLayersModel(k)];case 1:return N=L.sent(),$?[4,b($)]:[3,3];case 2:return E=L.sent(),[3,4];case 3:E=null,L.label=4;case 4:return R=E,[2,new C(N,R)]}})})}n.load=O;function V(k,$,N){return e(this,void 0,void 0,function(){var R,E,L,F;return t(this,function(G){switch(G.label){case 0:return[4,r.loadLayersModel(r.io.browserFiles([k,$]))];case 1:return R=G.sent(),[4,new Response(N).json()];case 2:return E=G.sent(),N?[4,b(E)]:[3,4];case 3:return F=G.sent(),[3,5];case 4:F=null,G.label=5;case 5:return L=F,[2,new C(R,L)]}})})}n.loadFromFiles=V}(Du)),Du}var Vs={},CP;function IEe(){if(CP)return Vs;CP=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var n=Vs&&Vs.__extends||function(){var y=function(v,w){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,S){b.__proto__=S}||function(b,S){for(var C in S)S.hasOwnProperty(C)&&(b[C]=S[C])},y(v,w)};return function(v,w){y(v,w);function b(){this.constructor=v}v.prototype=w===null?Object.create(w):(b.prototype=w.prototype,new b)}}(),e=Vs&&Vs.__awaiter||function(y,v,w,b){function S(C){return C instanceof w?C:new w(function(T){T(C)})}return new(w||(w=Promise))(function(C,T){function O($){try{k(b.next($))}catch(N){T(N)}}function V($){try{k(b.throw($))}catch(N){T(N)}}function k($){$.done?C($.value):S($.value).then(O,V)}k((b=b.apply(y,v||[])).next())})},t=Vs&&Vs.__generator||function(y,v){var w={label:0,sent:function(){if(C[0]&1)throw C[1];return C[1]},trys:[],ops:[]},b,S,C,T;return T={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function O(k){return function($){return V([k,$])}}function V(k){if(b)throw new TypeError("Generator is already executing.");for(;w;)try{if(b=1,S&&(C=k[0]&2?S.return:k[0]?S.throw||((C=S.return)&&C.call(S),0):S.next)&&!(C=C.call(S,k[1])).done)return C;switch(S=0,C&&(k=[k[0]&2,C.value]),k[0]){case 0:case 1:C=k;break;case 4:return w.label++,{value:k[1],done:!1};case 5:w.label++,S=k[1],k=[0];continue;case 7:k=w.ops.pop(),w.trys.pop();continue;default:if(C=w.trys,!(C=C.length>0&&C[C.length-1])&&(k[0]===6||k[0]===2)){w=0;continue}if(k[0]===3&&(!C||k[1]>C[0]&&k[1]<C[3])){w.label=k[1];break}if(k[0]===6&&w.label<C[1]){w.label=C[1],C=k;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(k);break}C[2]&&w.ops.pop(),w.trys.pop();continue}k=v.call(y,w)}catch($){k=[6,$],S=0}finally{b=C=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}};Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.createTeachable=Vs.TeachableMobileNet=void 0;var r=Dm,s=Dm,i=wW(),o=bW(),a=pB(),l=.15,u=function(y){return typeof y.dataId=="object"&&typeof y.shape=="object"};function h(y,v){var w=new Array(v).fill(0);return w[y]=1,w}function d(y,v){for(var w,b=y.length,S=y.slice(),C=b-1;C>0;C-=1){var T=void 0;v?T=Math.floor(v()*(C+1)):T=Math.floor(Math.random()*(C+1)),w=[S[T],S[C]],S[C]=w[0],S[T]=w[1]}return S}var p=function(y){n(v,y);function v(w,b){var S=y.call(this,r.sequential(),b)||this;return S.totalSamples=0,S.examples=[],S.truncatedModel=w,S}return Object.defineProperty(v.prototype,"asSequentialModel",{get:function(){return this.model},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isTrained",{get:function(){return!!this.model&&this.model.layers&&this.model.layers.length>2},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isPrepared",{get:function(){return!!this.trainDataset},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"numClasses",{get:function(){return this._metadata.labels.length},enumerable:!1,configurable:!0}),v.prototype.addExample=function(w,b){return e(this,void 0,void 0,function(){var S,C,T;return t(this,function(O){return S=u(b)?b:i.capture(b,this._metadata.grayscale),C=this.truncatedModel.predict(S),T=C.dataSync(),S.dispose(),C.dispose(),this.examples[w].push(T),this.totalSamples++,[2]})})},v.prototype.predict=function(w,b){return b===void 0&&(b=!1),e(this,void 0,void 0,function(){return t(this,function(S){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,y.prototype.predict.call(this,w,b)]})})},v.prototype.predictTopK=function(w,b,S){return b===void 0&&(b=10),S===void 0&&(S=!1),e(this,void 0,void 0,function(){return t(this,function(C){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,y.prototype.predictTopK.call(this,w,b,S)]})})},v.prototype.prepare=function(){for(var w in this.examples)if(w.length===0)throw new Error("Add some examples before training");var b=this.convertToTfDataset();this.trainDataset=b.trainDataset,this.validationDataset=b.validationDataset},v.prototype.convertToTfDataset=function(){for(var w=0;w<this.examples.length;w++)this.examples[w]=d(this.examples[w],this.seed);for(var b=[],S=[],C=function(N){var R=h(N,T.numClasses),E=T.examples[N].length,L=Math.ceil(l*E),F=E-L,G=T.examples[N].slice(0,F).map(function(q){return{data:q,label:R}}),Y=T.examples[N].slice(F).map(function(q){return{data:q,label:R}});b=b.concat(G),S=S.concat(Y)},T=this,w=0;w<this.examples.length;w++)C(w);b=d(b,this.seed),S=d(S,this.seed);var O=r.data.array(b.map(function(N){return N.data})),V=r.data.array(S.map(function(N){return N.data})),k=r.data.array(b.map(function(N){return N.label})),$=r.data.array(S.map(function(N){return N.label}));return{trainDataset:r.data.zip({xs:O,ys:k}),validationDataset:r.data.zip({xs:V,ys:$})}},v.prototype.save=function(w,b){return e(this,void 0,void 0,function(){return t(this,function(S){return[2,this.model.save(w,b)]})})},v.prototype.train=function(w,b){return b===void 0&&(b={}),e(this,void 0,void 0,function(){var S,C,T,O,V,k,$,N,R,E=this;return t(this,function(L){switch(L.label){case 0:if(S=b.onTrainEnd||function(){},b.onTrainEnd=function(F){E.__stopTrainingResolve&&(E.__stopTrainingResolve(),E.__stopTrainingResolve=null),S(F)},this.isPrepared||this.prepare(),C=this.getLabels().length,s.util.assert(C===this.numClasses,function(){return"Can not train, has "+C+" labels and "+E.numClasses+" classes"}),T=this.truncatedModel.outputs[0].shape.slice(1),O=r.util.sizeFromShape(T),this.seed?V=r.initializers.varianceScaling({seed:3.14}):V=r.initializers.varianceScaling({}),this.trainingModel=r.sequential({layers:[r.layers.dense({inputShape:[O],units:w.denseUnits,activation:"relu",kernelInitializer:V,useBias:!0}),r.layers.dense({kernelInitializer:V,useBias:!1,activation:"softmax",units:this.numClasses})]}),k=r.train.adam(w.learningRate),this.trainingModel.compile({optimizer:k,loss:"categoricalCrossentropy",metrics:["accuracy"]}),!(w.batchSize>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction");return $=this.trainDataset.batch(w.batchSize),N=this.validationDataset.batch(w.batchSize),[4,this.trainingModel.fitDataset($,{epochs:w.epochs,validationData:N,callbacks:b})];case 1:return L.sent(),R=r.sequential(),R.add(this.truncatedModel),R.add(this.trainingModel),this.model=R,k.dispose(),[2,this.model]}})})},v.prototype.prepareDataset=function(){for(var w=0;w<this.numClasses;w++)this.examples[w]=[]},v.prototype.setLabel=function(w,b){this._metadata.labels[w]=b},v.prototype.setLabels=function(w){this._metadata.labels=w,this.prepareDataset()},v.prototype.getLabel=function(w){return this._metadata.labels[w]},v.prototype.getLabels=function(){return this._metadata.labels},v.prototype.setName=function(w){this._metadata.modelName=w},v.prototype.getName=function(){return this._metadata.modelName},v.prototype.stopTraining=function(){var w=this,b=new Promise(function(S,C){w.trainingModel.stopTraining=!0,w.__stopTrainingResolve=S});return b},v.prototype.dispose=function(){this.trainingModel.dispose(),y.prototype.dispose.call(this)},v.prototype.calculateAccuracyPerClass=function(){return e(this,void 0,void 0,function(){var w,b,S,C,T,O,V,k,$,N,se,R,E,L,F,G,Y,q,se,X=this;return t(this,function(re){switch(re.label){case 0:return w=this.validationDataset.mapAsync(function(ie){return e(X,void 0,void 0,function(){return t(this,function(j){return[2,ie.xs]})})}),b=this.validationDataset.mapAsync(function(ie){return e(X,void 0,void 0,function(){return t(this,function(j){return[2,ie.ys]})})}),S=Math.min(b.size,32),C=Math.ceil(b.size/S),T=w.batch(S),O=b.batch(S),[4,T.iterator()];case 1:return V=re.sent(),[4,O.iterator()];case 2:k=re.sent(),$=[],N=[],se=0,re.label=3;case 3:return se<C?[4,V.next()]:[3,7];case 4:return R=re.sent(),E=this.trainingModel.predict(R.value),L=E.argMax(1),$.push(L),[4,k.next()];case 5:F=re.sent(),G=F.value.argMax(1),N.push(G),R.value.dispose(),E.dispose(),F.value.dispose(),re.label=6;case 6:return se++,[3,3];case 7:if(Y=r.concat(N),q=r.concat($),C!==1)for(se=0;se<$.length;se++)$[se].dispose(),N[se].dispose();return[2,{reference:Y,predictions:q}]}})})},v.prototype.setSeed=function(w){this.seed=a(w)},v}(o.CustomMobileNet);Vs.TeachableMobileNet=p;function m(y,v){return e(this,void 0,void 0,function(){var w;return t(this,function(b){switch(b.label){case 0:return[4,o.loadTruncatedMobileNet(v)];case 1:return w=b.sent(),[2,new p(w,y)]}})})}return Vs.createTeachable=m,Vs}var Li={};function av(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?av=function(t){return typeof t}:av=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},av(n)}function F2(n,e,t){var r=t.value;if(typeof r!="function")throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(av(r)));var s=!1;return{configurable:!0,get:function(){if(s||this===n.prototype||this.hasOwnProperty(e)||typeof r!="function")return r;var o=r.bind(this);return s=!0,Object.defineProperty(this,e,{configurable:!0,get:function(){return o},set:function(l){r=l,delete this[e]}}),s=!1,o},set:function(o){r=o}}}function IW(n){var e;return typeof Reflect<"u"&&typeof Reflect.ownKeys=="function"?e=Reflect.ownKeys(n.prototype):(e=Object.getOwnPropertyNames(n.prototype),typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(n.prototype)))),e.forEach(function(t){if(t!=="constructor"){var r=Object.getOwnPropertyDescriptor(n.prototype,t);typeof r.value=="function"&&Object.defineProperty(n.prototype,t,F2(n,t,r))}}),n}function SEe(){return arguments.length===1?IW.apply(void 0,arguments):F2.apply(void 0,arguments)}const TEe=Object.freeze(Object.defineProperty({__proto__:null,boundClass:IW,boundMethod:F2,default:SEe},Symbol.toStringTag,{value:"Module"})),_Ee=A_(TEe);var EP;function CEe(){if(EP)return Li;EP=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var n=Li&&Li.__decorate||function(l,u,h,d){var p=arguments.length,m=p<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,h):d,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(l,u,h,d);else for(var v=l.length-1;v>=0;v--)(y=l[v])&&(m=(p<3?y(m):p>3?y(u,h,m):y(u,h))||m);return p>3&&m&&Object.defineProperty(u,h,m),m},e=Li&&Li.__awaiter||function(l,u,h,d){function p(m){return m instanceof h?m:new h(function(y){y(m)})}return new(h||(h=Promise))(function(m,y){function v(S){try{b(d.next(S))}catch(C){y(C)}}function w(S){try{b(d.throw(S))}catch(C){y(C)}}function b(S){S.done?m(S.value):p(S.value).then(v,w)}b((d=d.apply(l,u||[])).next())})},t=Li&&Li.__generator||function(l,u){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},d,p,m,y;return y={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function v(b){return function(S){return w([b,S])}}function w(b){if(d)throw new TypeError("Generator is already executing.");for(;h;)try{if(d=1,p&&(m=b[0]&2?p.return:b[0]?p.throw||((m=p.return)&&m.call(p),0):p.next)&&!(m=m.call(p,b[1])).done)return m;switch(p=0,m&&(b=[b[0]&2,m.value]),b[0]){case 0:case 1:m=b;break;case 4:return h.label++,{value:b[1],done:!1};case 5:h.label++,p=b[1],b=[0];continue;case 7:b=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(b[0]===6||b[0]===2)){h=0;continue}if(b[0]===3&&(!m||b[1]>m[0]&&b[1]<m[3])){h.label=b[1];break}if(b[0]===6&&h.label<m[1]){h.label=m[1],m=b;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(b);break}m[2]&&h.ops.pop(),h.trys.pop();continue}b=u.call(l,h)}catch(S){b=[6,S],p=0}finally{d=m=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}};Object.defineProperty(Li,"__esModule",{value:!0}),Li.Webcam=void 0;var r=_Ee,s=vW(),i={facingMode:"user",frameRate:24},o=function(l){return l.facingMode=l.facingMode||i.facingMode,l.frameRate=l.frameRate||i.frameRate,l.aspectRatio=l.aspectRatio||i.aspectRatio,l},a=function(){function l(u,h,d){u===void 0&&(u=400),h===void 0&&(h=400),d===void 0&&(d=!1),this.width=u,this.height=h,this.flip=d}return l.prototype.getWebcam=function(u){if(u===void 0&&(u={}),!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");u.width=640;var h=o(u),d=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:h}).then(function(p){return d.srcObject=p,d.addEventListener("loadedmetadata",function(m){var y=d.videoWidth,v=d.videoHeight;d.width=y,d.height=v}),d},function(){return Promise.reject("Could not open your camera. You may have denied access.")})},l.prototype.setup=function(u){return u===void 0&&(u={}),e(this,void 0,void 0,function(){var h;return t(this,function(d){switch(d.label){case 0:return this.webcam?[3,2]:(h=this,[4,this.getWebcam(u)]);case 1:h.webcam=d.sent(),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height),d.label=2;case 2:return[2]}})})},l.prototype.play=function(){var u=this.webcam.play();return u},l.prototype.pause=function(){this.webcam.pause()},l.prototype.stop=function(){this.stopStreamedVideo(this.webcam)},l.prototype.update=function(){this.renderCameraToCanvas()},l.prototype.stopStreamedVideo=function(u){var h=u.srcObject,d=h.getTracks();d.forEach(function(p){p.stop()}),u.srcObject=null},l.prototype.renderCameraToCanvas=function(){if(this.canvas&&this.webcam){var u=this.canvas.getContext("2d");if(this.webcam.videoWidth!==0){var h=s.cropTo(this.webcam,this.width,this.flip);u.drawImage(h,0,0)}}},n([r.default],l.prototype,"getWebcam",null),n([r.default],l.prototype,"setup",null),n([r.default],l.prototype,"play",null),n([r.default],l.prototype,"pause",null),n([r.default],l.prototype,"stop",null),n([r.default],l.prototype,"update",null),n([r.default],l.prototype,"stopStreamedVideo",null),n([r.default],l.prototype,"renderCameraToCanvas",null),l}();return Li.Webcam=a,Li}var kP;function EEe(){return kP||(kP=1,function(n){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(n,"__esModule",{value:!0});var e=bW();Object.defineProperty(n,"IMAGE_SIZE",{enumerable:!0,get:function(){return e.IMAGE_SIZE}}),Object.defineProperty(n,"CustomMobileNet",{enumerable:!0,get:function(){return e.CustomMobileNet}}),Object.defineProperty(n,"load",{enumerable:!0,get:function(){return e.load}}),Object.defineProperty(n,"loadFromFiles",{enumerable:!0,get:function(){return e.loadFromFiles}}),Object.defineProperty(n,"loadTruncatedMobileNet",{enumerable:!0,get:function(){return e.loadTruncatedMobileNet}});var t=IEe();Object.defineProperty(n,"TeachableMobileNet",{enumerable:!0,get:function(){return t.TeachableMobileNet}}),Object.defineProperty(n,"createTeachable",{enumerable:!0,get:function(){return t.createTeachable}});var r=CEe();Object.defineProperty(n,"Webcam",{enumerable:!0,get:function(){return r.Webcam}});var s=xW();Object.defineProperty(n,"version",{enumerable:!0,get:function(){return s.version}})}(US)),US}var kEe=EEe(),SW={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},NP=Ku.createContext&&Ku.createContext(SW),NEe=["attr","size","title"];function $Ee(n,e){if(n==null)return{};var t=REe(n,e),r,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function REe(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function rx(){return rx=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},rx.apply(this,arguments)}function $P(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function sx(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$P(Object(t),!0).forEach(function(r){AEe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$P(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function AEe(n,e,t){return e=DEe(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function DEe(n){var e=OEe(n,"string");return typeof e=="symbol"?e:e+""}function OEe(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function TW(n){return n&&n.map((e,t)=>Ku.createElement(e.tag,sx({key:t},e.attr),TW(e.child)))}function _W(n){return e=>Ku.createElement(PEe,rx({attr:sx({},n.attr)},e),TW(n.child))}function PEe(n){var e=t=>{var{attr:r,size:s,title:i}=n,o=$Ee(n,NEe),a=s||t.size||"1em",l;return t.className&&(l=t.className),n.className&&(l=(l?l+" ":"")+n.className),Ku.createElement("svg",rx({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:l,style:sx(sx({color:n.color||t.color},t.style),n.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),i&&Ku.createElement("title",null,i),n.children)};return NP!==void 0?Ku.createElement(NP.Consumer,null,t=>e(t)):e(SW)}function FEe(n){return _W({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M403.002 217.001C388.998 148.002 328.998 96 256 96c-57.998 0-107.998 32.998-132.998 81.001C63.002 183.002 16 233.998 16 296c0 65.996 53.999 120 120 120h260c55 0 100-45 100-100 0-52.998-40.996-96.001-92.998-98.999zM288 276v76h-64v-76h-68l100-100 100 100h-68z"},child:[]}]})(n)}const LEe=()=>{const[n,e]=ye.useState(null),[t,r]=ye.useState(null),[s,i]=ye.useState([]),[o,a]=ye.useState([]),[l,u]=ye.useState(null),[h,d]=ye.useState(0),[p,m]=ye.useState(!1),[y,v]=ye.useState(""),w=Fm(),b="https://teachablemachine.withgoogle.com/models/Y5i61Nfmy/";ye.useEffect(()=>{(async()=>{try{const E=await kEe.load(`${b}model.json`,`${b}metadata.json`);e(E)}catch(E){console.error("モデルのロードに失敗しました:",E)}})()},[]),ye.useEffect(()=>{(async()=>{const E=fa.currentUser;if(E){const L=Qu(Tl,"users",E.uid),F=await CC(L);F.exists()&&(u({...E,points:F.data().points||0}),d(F.data().points||0))}})()},[]);const S=R=>{const E=R.target.files[0];if(E){const L=URL.createObjectURL(E);r(L)}},C=async()=>{if(n&&t){m(!0);const R=document.createElement("img");R.src=t,R.onload=async()=>{const E=[];for(let G=0;G<5;G++){const Y=await n.predict(R);E.push(Y)}const L={};E.flat().forEach(G=>{L[G.className]||(L[G.className]={total:0,count:0}),L[G.className].total+=G.probability,L[G.className].count+=1});const F=Object.keys(L).map(G=>({className:G,probability:L[G].total/L[G].count}));F.sort((G,Y)=>Y.probability-G.probability),i(F),T(F,F[0].className),m(!1)}}},T=(R,E)=>{const L=R.filter(G=>G.className!==E).slice(0,3).map(G=>G.className),F=[E,...L].sort(()=>Math.random()-.5);a(F)},O=async R=>{var L;const E=(L=s[0])==null?void 0:L.className;R===E?(alert("正解！10ポイント加算！"),v(V(E)),await k(10)):(alert(`不正解…正解は: ${E}`),v(V(E)))},V=R=>({巻雲:`
        <h3>解析結果：巻雲 (Cirrus)</h3>
        <p><strong>別称:</strong> すじ雲</p>
        <p>巻雲は、氷の結晶で構成され、空に細長く広がる白い筋状の雲です。非常に高い場所（約6,000〜13,000m）に現れ、天気が安定しているときによく見られます。</p>
        <p><strong>雑学:</strong> 巻雲が広がると天気が下り坂になることが多いと言われています。</p>
      `,巻積雲:`
        <h3>解析結果：巻積雲 (Cirrocumulus)</h3>
        <p><strong>別称:</strong> うろこ雲、いわし雲</p>
        <p>小さな白い塊が群れをなすように広がる雲で、魚のうろこのように見えることから「うろこ雲」とも呼ばれます。</p>
      `,高層雲:`
        <h3>解析結果：高層雲 (Altostratus)</h3>
        <p>空一面を覆う薄い灰色の雲で、太陽や月の輪郭がぼんやりと見えることがあります。</p>
      `,乱層雲:`
        <h3>解析結果：乱層雲 (Nimbostratus)</h3>
        <p>厚い灰色の雲で、広範囲にわたって降雨や降雪をもたらします。</p>
      `,層積雲:`
        <h3>解析結果：層積雲 (Stratocumulus)</h3>
        <p>大きな塊状の雲で、空の一部または全体を覆うことがあります。</p>
      `,積雲:`
        <h3>解析結果：積雲 (Cumulus)</h3>
        <p>白くてふわふわした綿のような見た目の雲で、天気の良い日に見られることが多いです。</p>
      `,積乱雲:`
        <h3>解析結果：積乱雲 (Cumulonimbus)</h3>
        <p>巨大で縦に発達する雲で、雷雨や突風を伴うことがあります。</p>
      `})[R]||"情報が見つかりません。",k=async R=>{if(l){const E=Qu(Tl,"users",l.uid),L=h+R;await PT(E,{points:L}),d(L)}},$=()=>w("/"),N=async()=>{await $F(fa)};return Ce.jsxs("div",{className:"quiz-container",children:[Ce.jsx("header",{className:"header",children:Ce.jsxs("div",{className:"header-content",children:[Ce.jsx("h2",{children:"CloudQuest"}),l?Ce.jsx("button",{className:"logout-button",onClick:N,children:"ログアウト"}):Ce.jsx(wo,{to:"/login",className:"login-link",children:"ログイン"})]})}),l&&Ce.jsxs("div",{className:"user-info",children:[Ce.jsxs(wo,{to:"/accountSettings",children:["アカウント設定はこちらから →",Ce.jsx("br",{})]}),Ce.jsxs("span",{children:[l.username||"unknown"," ",l.points,"P"]})]}),Ce.jsxs("div",{className:"upload-container",children:[Ce.jsxs("label",{className:"file-label",children:[Ce.jsx("span",{className:"cloud-icon",children:Ce.jsx(FEe,{})}),p?Ce.jsx("p",{className:"loading-text",children:"AIによるクイズ作成中..."}):Ce.jsx("p",{className:"upload-text",children:"replace image"}),Ce.jsx("input",{type:"file",accept:"image/*",onChange:S})]}),t&&Ce.jsx("img",{src:t,alt:"Uploaded"})]}),Ce.jsx("button",{onClick:C,disabled:p,children:p?"予測中...":"クイズを開始"}),o.length>0&&Ce.jsxs("div",{children:[Ce.jsx("h2",{children:"Q. この雲はどれ？"}),o.map((R,E)=>Ce.jsx("button",{onClick:()=>O(R),children:R},E))]}),y&&Ce.jsx("div",{dangerouslySetInnerHTML:{__html:y}}),Ce.jsx("button",{onClick:$,children:"HOMEに戻る"})]})},MEe=()=>{const[n,e]=ye.useState(""),[t,r]=ye.useState(""),[s,i]=ye.useState(null),o=Fm(),a=async l=>{l.preventDefault();try{await Uq(fa,n,t),o("/")}catch{i("ログインに失敗しました。もう一度お試しください。")}};return Ce.jsxs("div",{className:"auth-container",children:[Ce.jsx("h2",{children:"ログイン"}),s&&Ce.jsx("p",{className:"error-message",children:s}),Ce.jsxs("form",{onSubmit:a,className:"auth-form",children:[Ce.jsx("input",{type:"email",placeholder:"メールアドレス",value:n,onChange:l=>e(l.target.value),required:!0,className:"auth-input"}),Ce.jsx("input",{type:"password",placeholder:"パスワード",value:t,onChange:l=>r(l.target.value),required:!0,className:"auth-input"}),Ce.jsx("button",{type:"submit",className:"auth-button",children:"ログイン"})]}),Ce.jsxs("p",{className:"auth-link",children:["新規登録が必要ですか？ ",Ce.jsx(wo,{to:"/signup",children:"こちら"})," から新規登録できます。"]})]})},VEe=()=>{const[n,e]=ye.useState(""),[t,r]=ye.useState(""),[s,i]=ye.useState(null),o=Fm(),a=async l=>{l.preventDefault();try{const h=(await Bq(fa,n,t)).user;await pX(Qu(Tl,"users",h.uid),{email:h.email,username:"unknown",points:0}),o("/")}catch{i("新規登録に失敗しました。もう一度お試しください。")}};return Ce.jsxs("div",{className:"auth-container",children:[Ce.jsx("h2",{children:"新規登録"}),s&&Ce.jsx("p",{className:"error-message",children:s}),Ce.jsxs("form",{onSubmit:a,className:"auth-form",children:[Ce.jsx("input",{type:"email",placeholder:"メールアドレス",value:n,onChange:l=>e(l.target.value),required:!0,className:"auth-input"}),Ce.jsx("input",{type:"password",placeholder:"パスワード",value:t,onChange:l=>r(l.target.value),required:!0,className:"auth-input"}),Ce.jsx("button",{type:"submit",className:"auth-button",children:"登録"})]}),Ce.jsxs("p",{className:"auth-link",children:["すでにアカウントをお持ちですか？ ",Ce.jsx(wo,{to:"/login",children:"こちら"})," からログインしてください。"]})]})};function zEe(n){return _W({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(n)}const BEe=()=>{const[n,e]=ye.useState(null),[t,r]=ye.useState(""),[s,i]=ye.useState(""),[o,a]=ye.useState(""),[l,u]=ye.useState(""),[h,d]=ye.useState(""),[p,m]=ye.useState(!1),y=Fm();ye.useEffect(()=>{(async()=>{const O=fa.currentUser;if(O){e(O);const V=Qu(Tl,"users",O.uid),k=await CC(V);k.exists()&&(r(k.data().username),i(O.email))}})()},[]);const v=async()=>{try{if(m(!0),n){const T=Qu(Tl,"users",n.uid);await PT(T,{username:t})}m(!1),alert("ユーザー名が更新されました！")}catch{m(!1),d("ユーザー名の更新に失敗しました。")}},w=async()=>{try{if(m(!0),n&&s!==n.email){await Wq(n,s);const T=Qu(Tl,"users",n.uid);await PT(T,{email:s})}m(!1),alert("メールアドレスが更新されました！")}catch{m(!1),d("メールアドレスの更新に失敗しました。")}},b=async()=>{try{if(m(!0),n&&o&&l){const T=fa.EmailAuthProvider.credential(n.email,l);await n.reauthenticateWithCredential(T),await jq(n,o)}m(!1),alert("パスワードが更新されました！")}catch{m(!1),d("パスワードの更新に失敗しました。")}},S=()=>{fa.signOut(),y("/login")},C=()=>{y(-1)};return Ce.jsxs("div",{className:"account-settings-container",children:[Ce.jsxs("div",{className:"back-button",onClick:C,children:[Ce.jsx(zEe,{size:24}),Ce.jsx("span",{children:"戻る"})]}),Ce.jsx("h2",{children:"アカウント設定"}),h&&Ce.jsx("p",{className:"error-message",children:h}),Ce.jsxs("div",{className:"form-group",children:[Ce.jsx("label",{children:"ユーザー名"}),Ce.jsx("input",{type:"text",value:t,onChange:T=>r(T.target.value),placeholder:"新しいユーザー名"}),Ce.jsx("button",{onClick:v,disabled:p,children:p?"更新中...":"ユーザー名更新"})]}),Ce.jsxs("div",{className:"form-group",children:[Ce.jsx("label",{children:"メールアドレス"}),Ce.jsx("input",{type:"email",value:s,onChange:T=>i(T.target.value),placeholder:"新しいメールアドレス"}),Ce.jsx("button",{onClick:w,disabled:p,children:p?"更新中...":"メールアドレス更新"})]}),Ce.jsxs("div",{className:"form-group",children:[Ce.jsx("label",{children:"現在のパスワード"}),Ce.jsx("input",{type:"password",value:l,onChange:T=>u(T.target.value),placeholder:"現在のパスワード"})]}),Ce.jsxs("div",{className:"form-group",children:[Ce.jsx("label",{children:"新しいパスワード"}),Ce.jsx("input",{type:"password",value:o,onChange:T=>a(T.target.value),placeholder:"新しいパスワード"}),Ce.jsx("button",{onClick:b,disabled:p,children:p?"更新中...":"パスワード更新"})]}),Ce.jsx("div",{className:"form-group",children:Ce.jsx("button",{onClick:S,children:"ログアウト"})})]})},UEe=()=>Ce.jsx(ZG,{children:Ce.jsx("div",{children:Ce.jsxs(NG,{children:[Ce.jsx(Ah,{path:"/",element:Ce.jsx(yX,{})})," ",Ce.jsx(Ah,{path:"/quiz",element:Ce.jsx(LEe,{})})," ",Ce.jsx(Ah,{path:"/login",element:Ce.jsx(MEe,{})}),Ce.jsx(Ah,{path:"/signup",element:Ce.jsx(VEe,{})}),Ce.jsx(Ah,{path:"/accountSettings",element:Ce.jsx(BEe,{})})]})})});Mj.createRoot(document.getElementById("root")).render(Ce.jsx(ye.StrictMode,{children:Ce.jsx(UEe,{})}));
