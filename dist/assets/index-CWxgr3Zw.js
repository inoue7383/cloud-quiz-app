(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();function pL(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function R1(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),e}var y0={exports:{}},qh={},w0={exports:{}},vt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qI;function fL(){if(qI)return vt;qI=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;function f(q){return q===null||typeof q!="object"?null:(q=p&&q[p]||q["@@iterator"],typeof q=="function"?q:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,x={};function b(q,ne,me){this.props=q,this.context=ne,this.refs=x,this.updater=me||g}b.prototype.isReactComponent={},b.prototype.setState=function(q,ne){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,ne,"setState")},b.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function _(){}_.prototype=b.prototype;function C(q,ne,me){this.props=q,this.context=ne,this.refs=x,this.updater=me||g}var T=C.prototype=new _;T.constructor=C,y(T,b.prototype),T.isPureReactComponent=!0;var D=Array.isArray,O=Object.prototype.hasOwnProperty,z={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function S(q,ne,me){var Ce,Te={},Re=null,De=null;if(ne!=null)for(Ce in ne.ref!==void 0&&(De=ne.ref),ne.key!==void 0&&(Re=""+ne.key),ne)O.call(ne,Ce)&&!I.hasOwnProperty(Ce)&&(Te[Ce]=ne[Ce]);var Oe=arguments.length-2;if(Oe===1)Te.children=me;else if(1<Oe){for(var ze=Array(Oe),ct=0;ct<Oe;ct++)ze[ct]=arguments[ct+2];Te.children=ze}if(q&&q.defaultProps)for(Ce in Oe=q.defaultProps,Oe)Te[Ce]===void 0&&(Te[Ce]=Oe[Ce]);return{$$typeof:r,type:q,key:Re,ref:De,props:Te,_owner:z.current}}function A(q,ne){return{$$typeof:r,type:q.type,key:ne,ref:q.ref,props:q.props,_owner:q._owner}}function N(q){return typeof q=="object"&&q!==null&&q.$$typeof===r}function P(q){var ne={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(me){return ne[me]})}var M=/\/+/g;function F(q,ne){return typeof q=="object"&&q!==null&&q.key!=null?P(""+q.key):ne.toString(36)}function G(q,ne,me,Ce,Te){var Re=typeof q;(Re==="undefined"||Re==="boolean")&&(q=null);var De=!1;if(q===null)De=!0;else switch(Re){case"string":case"number":De=!0;break;case"object":switch(q.$$typeof){case r:case t:De=!0}}if(De)return De=q,Te=Te(De),q=Ce===""?"."+F(De,0):Ce,D(Te)?(me="",q!=null&&(me=q.replace(M,"$&/")+"/"),G(Te,ne,me,"",function(ct){return ct})):Te!=null&&(N(Te)&&(Te=A(Te,me+(!Te.key||De&&De.key===Te.key?"":(""+Te.key).replace(M,"$&/")+"/")+q)),ne.push(Te)),1;if(De=0,Ce=Ce===""?".":Ce+":",D(q))for(var Oe=0;Oe<q.length;Oe++){Re=q[Oe];var ze=Ce+F(Re,Oe);De+=G(Re,ne,me,ze,Te)}else if(ze=f(q),typeof ze=="function")for(q=ze.call(q),Oe=0;!(Re=q.next()).done;)Re=Re.value,ze=Ce+F(Re,Oe++),De+=G(Re,ne,me,ze,Te);else if(Re==="object")throw ne=String(q),Error("Objects are not valid as a React child (found: "+(ne==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":ne)+"). If you meant to render a collection of children, use an array instead.");return De}function Z(q,ne,me){if(q==null)return q;var Ce=[],Te=0;return G(q,Ce,"","",function(Re){return ne.call(me,Re,Te++)}),Ce}function Y(q){if(q._status===-1){var ne=q._result;ne=ne(),ne.then(function(me){(q._status===0||q._status===-1)&&(q._status=1,q._result=me)},function(me){(q._status===0||q._status===-1)&&(q._status=2,q._result=me)}),q._status===-1&&(q._status=0,q._result=ne)}if(q._status===1)return q._result.default;throw q._result}var ee={current:null},H={transition:null},ie={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:H,ReactCurrentOwner:z};function J(){throw Error("act(...) is not supported in production builds of React.")}return vt.Children={map:Z,forEach:function(q,ne,me){Z(q,function(){ne.apply(this,arguments)},me)},count:function(q){var ne=0;return Z(q,function(){ne++}),ne},toArray:function(q){return Z(q,function(ne){return ne})||[]},only:function(q){if(!N(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},vt.Component=b,vt.Fragment=e,vt.Profiler=i,vt.PureComponent=C,vt.StrictMode=n,vt.Suspense=u,vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ie,vt.act=J,vt.cloneElement=function(q,ne,me){if(q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+q+".");var Ce=y({},q.props),Te=q.key,Re=q.ref,De=q._owner;if(ne!=null){if(ne.ref!==void 0&&(Re=ne.ref,De=z.current),ne.key!==void 0&&(Te=""+ne.key),q.type&&q.type.defaultProps)var Oe=q.type.defaultProps;for(ze in ne)O.call(ne,ze)&&!I.hasOwnProperty(ze)&&(Ce[ze]=ne[ze]===void 0&&Oe!==void 0?Oe[ze]:ne[ze])}var ze=arguments.length-2;if(ze===1)Ce.children=me;else if(1<ze){Oe=Array(ze);for(var ct=0;ct<ze;ct++)Oe[ct]=arguments[ct+2];Ce.children=Oe}return{$$typeof:r,type:q.type,key:Te,ref:Re,props:Ce,_owner:De}},vt.createContext=function(q){return q={$$typeof:a,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},q.Provider={$$typeof:o,_context:q},q.Consumer=q},vt.createElement=S,vt.createFactory=function(q){var ne=S.bind(null,q);return ne.type=q,ne},vt.createRef=function(){return{current:null}},vt.forwardRef=function(q){return{$$typeof:s,render:q}},vt.isValidElement=N,vt.lazy=function(q){return{$$typeof:d,_payload:{_status:-1,_result:q},_init:Y}},vt.memo=function(q,ne){return{$$typeof:c,type:q,compare:ne===void 0?null:ne}},vt.startTransition=function(q){var ne=H.transition;H.transition={};try{q()}finally{H.transition=ne}},vt.unstable_act=J,vt.useCallback=function(q,ne){return ee.current.useCallback(q,ne)},vt.useContext=function(q){return ee.current.useContext(q)},vt.useDebugValue=function(){},vt.useDeferredValue=function(q){return ee.current.useDeferredValue(q)},vt.useEffect=function(q,ne){return ee.current.useEffect(q,ne)},vt.useId=function(){return ee.current.useId()},vt.useImperativeHandle=function(q,ne,me){return ee.current.useImperativeHandle(q,ne,me)},vt.useInsertionEffect=function(q,ne){return ee.current.useInsertionEffect(q,ne)},vt.useLayoutEffect=function(q,ne){return ee.current.useLayoutEffect(q,ne)},vt.useMemo=function(q,ne){return ee.current.useMemo(q,ne)},vt.useReducer=function(q,ne,me){return ee.current.useReducer(q,ne,me)},vt.useRef=function(q){return ee.current.useRef(q)},vt.useState=function(q){return ee.current.useState(q)},vt.useSyncExternalStore=function(q,ne,me){return ee.current.useSyncExternalStore(q,ne,me)},vt.useTransition=function(){return ee.current.useTransition()},vt.version="18.3.1",vt}var HI;function k1(){return HI||(HI=1,w0.exports=fL()),w0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $I;function mL(){if($I)return qh;$I=1;var r=k1(),t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(s,u,c){var d,p={},f=null,g=null;c!==void 0&&(f=""+c),u.key!==void 0&&(f=""+u.key),u.ref!==void 0&&(g=u.ref);for(d in u)n.call(u,d)&&!o.hasOwnProperty(d)&&(p[d]=u[d]);if(s&&s.defaultProps)for(d in u=s.defaultProps,u)p[d]===void 0&&(p[d]=u[d]);return{$$typeof:t,type:s,key:f,ref:g,props:p,_owner:i.current}}return qh.Fragment=e,qh.jsx=a,qh.jsxs=a,qh}var GI;function gL(){return GI||(GI=1,y0.exports=mL()),y0.exports}var _e=gL(),fe=k1();const Nu=pL(fe);var qf={},b0={exports:{}},zr={},x0={exports:{}},_0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KI;function vL(){return KI||(KI=1,function(r){function t(H,ie){var J=H.length;H.push(ie);e:for(;0<J;){var q=J-1>>>1,ne=H[q];if(0<i(ne,ie))H[q]=ie,H[J]=ne,J=q;else break e}}function e(H){return H.length===0?null:H[0]}function n(H){if(H.length===0)return null;var ie=H[0],J=H.pop();if(J!==ie){H[0]=J;e:for(var q=0,ne=H.length,me=ne>>>1;q<me;){var Ce=2*(q+1)-1,Te=H[Ce],Re=Ce+1,De=H[Re];if(0>i(Te,J))Re<ne&&0>i(De,Te)?(H[q]=De,H[Re]=J,q=Re):(H[q]=Te,H[Ce]=J,q=Ce);else if(Re<ne&&0>i(De,J))H[q]=De,H[Re]=J,q=Re;else break e}}return ie}function i(H,ie){var J=H.sortIndex-ie.sortIndex;return J!==0?J:H.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();r.unstable_now=function(){return a.now()-s}}var u=[],c=[],d=1,p=null,f=3,g=!1,y=!1,x=!1,b=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(H){for(var ie=e(c);ie!==null;){if(ie.callback===null)n(c);else if(ie.startTime<=H)n(c),ie.sortIndex=ie.expirationTime,t(u,ie);else break;ie=e(c)}}function D(H){if(x=!1,T(H),!y)if(e(u)!==null)y=!0,Y(O);else{var ie=e(c);ie!==null&&ee(D,ie.startTime-H)}}function O(H,ie){y=!1,x&&(x=!1,_(S),S=-1),g=!0;var J=f;try{for(T(ie),p=e(u);p!==null&&(!(p.expirationTime>ie)||H&&!P());){var q=p.callback;if(typeof q=="function"){p.callback=null,f=p.priorityLevel;var ne=q(p.expirationTime<=ie);ie=r.unstable_now(),typeof ne=="function"?p.callback=ne:p===e(u)&&n(u),T(ie)}else n(u);p=e(u)}if(p!==null)var me=!0;else{var Ce=e(c);Ce!==null&&ee(D,Ce.startTime-ie),me=!1}return me}finally{p=null,f=J,g=!1}}var z=!1,I=null,S=-1,A=5,N=-1;function P(){return!(r.unstable_now()-N<A)}function M(){if(I!==null){var H=r.unstable_now();N=H;var ie=!0;try{ie=I(!0,H)}finally{ie?F():(z=!1,I=null)}}else z=!1}var F;if(typeof C=="function")F=function(){C(M)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Z=G.port2;G.port1.onmessage=M,F=function(){Z.postMessage(null)}}else F=function(){b(M,0)};function Y(H){I=H,z||(z=!0,F())}function ee(H,ie){S=b(function(){H(r.unstable_now())},ie)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(H){H.callback=null},r.unstable_continueExecution=function(){y||g||(y=!0,Y(O))},r.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<H?Math.floor(1e3/H):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return e(u)},r.unstable_next=function(H){switch(f){case 1:case 2:case 3:var ie=3;break;default:ie=f}var J=f;f=ie;try{return H()}finally{f=J}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(H,ie){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var J=f;f=H;try{return ie()}finally{f=J}},r.unstable_scheduleCallback=function(H,ie,J){var q=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?q+J:q):J=q,H){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=J+ne,H={id:d++,callback:ie,priorityLevel:H,startTime:J,expirationTime:ne,sortIndex:-1},J>q?(H.sortIndex=J,t(c,H),e(u)===null&&H===e(c)&&(x?(_(S),S=-1):x=!0,ee(D,J-q))):(H.sortIndex=ne,t(u,H),y||g||(y=!0,Y(O))),H},r.unstable_shouldYield=P,r.unstable_wrapCallback=function(H){var ie=f;return function(){var J=f;f=ie;try{return H.apply(this,arguments)}finally{f=J}}}}(_0)),_0}var XI;function yL(){return XI||(XI=1,x0.exports=vL()),x0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QI;function wL(){if(QI)return zr;QI=1;var r=k1(),t=yL();function e(l){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+l,m=1;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function o(l,h){a(l,h),a(l+"Capture",h)}function a(l,h){for(i[l]=h,l=0;l<h.length;l++)n.add(h[l])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function f(l){return u.call(p,l)?!0:u.call(d,l)?!1:c.test(l)?p[l]=!0:(d[l]=!0,!1)}function g(l,h,m,w){if(m!==null&&m.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return w?!1:m!==null?!m.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function y(l,h,m,w){if(h===null||typeof h>"u"||g(l,h,m,w))return!0;if(w)return!1;if(m!==null)switch(m.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function x(l,h,m,w,E,k,V){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=w,this.attributeNamespace=E,this.mustUseProperty=m,this.propertyName=l,this.type=h,this.sanitizeURL=k,this.removeEmptyString=V}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){b[l]=new x(l,0,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var h=l[0];b[h]=new x(h,1,!1,l[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){b[l]=new x(l,2,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){b[l]=new x(l,2,!1,l,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){b[l]=new x(l,3,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){b[l]=new x(l,3,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){b[l]=new x(l,4,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){b[l]=new x(l,6,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){b[l]=new x(l,5,!1,l.toLowerCase(),null,!1,!1)});var _=/[\-:]([a-z])/g;function C(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var h=l.replace(_,C);b[h]=new x(h,1,!1,l,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var h=l.replace(_,C);b[h]=new x(h,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var h=l.replace(_,C);b[h]=new x(h,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){b[l]=new x(l,1,!1,l.toLowerCase(),null,!1,!1)}),b.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){b[l]=new x(l,1,!1,l.toLowerCase(),null,!0,!0)});function T(l,h,m,w){var E=b.hasOwnProperty(h)?b[h]:null;(E!==null?E.type!==0:w||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(y(h,m,E,w)&&(m=null),w||E===null?f(h)&&(m===null?l.removeAttribute(h):l.setAttribute(h,""+m)):E.mustUseProperty?l[E.propertyName]=m===null?E.type===3?!1:"":m:(h=E.attributeName,w=E.attributeNamespace,m===null?l.removeAttribute(h):(E=E.type,m=E===3||E===4&&m===!0?"":""+m,w?l.setAttributeNS(w,h,m):l.setAttribute(h,m))))}var D=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.element"),z=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),P=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),H=Symbol.iterator;function ie(l){return l===null||typeof l!="object"?null:(l=H&&l[H]||l["@@iterator"],typeof l=="function"?l:null)}var J=Object.assign,q;function ne(l){if(q===void 0)try{throw Error()}catch(m){var h=m.stack.trim().match(/\n( *(at )?)/);q=h&&h[1]||""}return`
`+q+l}var me=!1;function Ce(l,h){if(!l||me)return"";me=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(le){var w=le}Reflect.construct(l,[],h)}else{try{h.call()}catch(le){w=le}l.call(h.prototype)}else{try{throw Error()}catch(le){w=le}l()}}catch(le){if(le&&w&&typeof le.stack=="string"){for(var E=le.stack.split(`
`),k=w.stack.split(`
`),V=E.length-1,$=k.length-1;1<=V&&0<=$&&E[V]!==k[$];)$--;for(;1<=V&&0<=$;V--,$--)if(E[V]!==k[$]){if(V!==1||$!==1)do if(V--,$--,0>$||E[V]!==k[$]){var Q=`
`+E[V].replace(" at new "," at ");return l.displayName&&Q.includes("<anonymous>")&&(Q=Q.replace("<anonymous>",l.displayName)),Q}while(1<=V&&0<=$);break}}}finally{me=!1,Error.prepareStackTrace=m}return(l=l?l.displayName||l.name:"")?ne(l):""}function Te(l){switch(l.tag){case 5:return ne(l.type);case 16:return ne("Lazy");case 13:return ne("Suspense");case 19:return ne("SuspenseList");case 0:case 2:case 15:return l=Ce(l.type,!1),l;case 11:return l=Ce(l.type.render,!1),l;case 1:return l=Ce(l.type,!0),l;default:return""}}function Re(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case I:return"Fragment";case z:return"Portal";case A:return"Profiler";case S:return"StrictMode";case F:return"Suspense";case G:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case P:return(l.displayName||"Context")+".Consumer";case N:return(l._context.displayName||"Context")+".Provider";case M:var h=l.render;return l=l.displayName,l||(l=h.displayName||h.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case Z:return h=l.displayName||null,h!==null?h:Re(l.type)||"Memo";case Y:h=l._payload,l=l._init;try{return Re(l(h))}catch{}}return null}function De(l){var h=l.type;switch(l.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=h.render,l=l.displayName||l.name||"",h.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Re(h);case 8:return h===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function Oe(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function ze(l){var h=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function ct(l){var h=ze(l)?"checked":"value",m=Object.getOwnPropertyDescriptor(l.constructor.prototype,h),w=""+l[h];if(!l.hasOwnProperty(h)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var E=m.get,k=m.set;return Object.defineProperty(l,h,{configurable:!0,get:function(){return E.call(this)},set:function(V){w=""+V,k.call(this,V)}}),Object.defineProperty(l,h,{enumerable:m.enumerable}),{getValue:function(){return w},setValue:function(V){w=""+V},stopTracking:function(){l._valueTracker=null,delete l[h]}}}}function Ze(l){l._valueTracker||(l._valueTracker=ct(l))}function wt(l){if(!l)return!1;var h=l._valueTracker;if(!h)return!0;var m=h.getValue(),w="";return l&&(w=ze(l)?l.checked?"true":"false":l.value),l=w,l!==m?(h.setValue(l),!0):!1}function ht(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function et(l,h){var m=h.checked;return J({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??l._wrapperState.initialChecked})}function Dt(l,h){var m=h.defaultValue==null?"":h.defaultValue,w=h.checked!=null?h.checked:h.defaultChecked;m=Oe(h.value!=null?h.value:m),l._wrapperState={initialChecked:w,initialValue:m,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function _t(l,h){h=h.checked,h!=null&&T(l,"checked",h,!1)}function vn(l,h){_t(l,h);var m=Oe(h.value),w=h.type;if(m!=null)w==="number"?(m===0&&l.value===""||l.value!=m)&&(l.value=""+m):l.value!==""+m&&(l.value=""+m);else if(w==="submit"||w==="reset"){l.removeAttribute("value");return}h.hasOwnProperty("value")?dn(l,h.type,m):h.hasOwnProperty("defaultValue")&&dn(l,h.type,Oe(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(l.defaultChecked=!!h.defaultChecked)}function lr(l,h,m){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var w=h.type;if(!(w!=="submit"&&w!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+l._wrapperState.initialValue,m||h===l.value||(l.value=h),l.defaultValue=h}m=l.name,m!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,m!==""&&(l.name=m)}function dn(l,h,m){(h!=="number"||ht(l.ownerDocument)!==l)&&(m==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+m&&(l.defaultValue=""+m))}var sn=Array.isArray;function Ht(l,h,m,w){if(l=l.options,h){h={};for(var E=0;E<m.length;E++)h["$"+m[E]]=!0;for(m=0;m<l.length;m++)E=h.hasOwnProperty("$"+l[m].value),l[m].selected!==E&&(l[m].selected=E),E&&w&&(l[m].defaultSelected=!0)}else{for(m=""+Oe(m),h=null,E=0;E<l.length;E++){if(l[E].value===m){l[E].selected=!0,w&&(l[E].defaultSelected=!0);return}h!==null||l[E].disabled||(h=l[E])}h!==null&&(h.selected=!0)}}function jn(l,h){if(h.dangerouslySetInnerHTML!=null)throw Error(e(91));return J({},h,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function at(l,h){var m=h.value;if(m==null){if(m=h.children,h=h.defaultValue,m!=null){if(h!=null)throw Error(e(92));if(sn(m)){if(1<m.length)throw Error(e(93));m=m[0]}h=m}h==null&&(h=""),m=h}l._wrapperState={initialValue:Oe(m)}}function En(l,h){var m=Oe(h.value),w=Oe(h.defaultValue);m!=null&&(m=""+m,m!==l.value&&(l.value=m),h.defaultValue==null&&l.defaultValue!==m&&(l.defaultValue=m)),w!=null&&(l.defaultValue=""+w)}function Qt(l){var h=l.textContent;h===l._wrapperState.initialValue&&h!==""&&h!==null&&(l.value=h)}function bt(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Lt(l,h){return l==null||l==="http://www.w3.org/1999/xhtml"?bt(h):l==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var Dn,tn=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,m,w,E){MSApp.execUnsafeLocalFunction(function(){return l(h,m,w,E)})}:l}(function(l,h){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=h;else{for(Dn=Dn||document.createElement("div"),Dn.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Dn.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;h.firstChild;)l.appendChild(h.firstChild)}});function cr(l,h){if(h){var m=l.firstChild;if(m&&m===l.lastChild&&m.nodeType===3){m.nodeValue=h;return}}l.textContent=h}var Wn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ti=["Webkit","ms","Moz","O"];Object.keys(Wn).forEach(function(l){Ti.forEach(function(h){h=h+l.charAt(0).toUpperCase()+l.substring(1),Wn[h]=Wn[l]})});function zo(l,h,m){return h==null||typeof h=="boolean"||h===""?"":m||typeof h!="number"||h===0||Wn.hasOwnProperty(l)&&Wn[l]?(""+h).trim():h+"px"}function Vo(l,h){l=l.style;for(var m in h)if(h.hasOwnProperty(m)){var w=m.indexOf("--")===0,E=zo(m,h[m],w);m==="float"&&(m="cssFloat"),w?l.setProperty(m,E):l[m]=E}}var Ai=J({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Bo(l,h){if(h){if(Ai[l]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(e(137,l));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(e(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(e(61))}if(h.style!=null&&typeof h.style!="object")throw Error(e(62))}}function Uo(l,h){if(l.indexOf("-")===-1)return typeof h.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qs=null;function cl(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var hl=null,fi=null,ao=null;function dl(l){if(l=Rh(l)){if(typeof hl!="function")throw Error(e(280));var h=l.stateNode;h&&(h=of(h),hl(l.stateNode,l.type,h))}}function so(l){fi?ao?ao.push(l):ao=[l]:fi=l}function ah(){if(fi){var l=fi,h=ao;if(ao=fi=null,dl(l),h)for(l=0;l<h.length;l++)dl(h[l])}}function Hs(l,h){return l(h)}function sh(){}var jo=!1;function uh(l,h,m){if(jo)return l(h,m);jo=!0;try{return Hs(l,h,m)}finally{jo=!1,(fi!==null||ao!==null)&&(sh(),ah())}}function yn(l,h){var m=l.stateNode;if(m===null)return null;var w=of(m);if(w===null)return null;m=w[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(l=l.type,w=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!w;break e;default:l=!1}if(l)return null;if(m&&typeof m!="function")throw Error(e(231,h,typeof m));return m}var pl=!1;if(s)try{var Ri={};Object.defineProperty(Ri,"passive",{get:function(){pl=!0}}),window.addEventListener("test",Ri,Ri),window.removeEventListener("test",Ri,Ri)}catch{pl=!1}function $s(l,h,m,w,E,k,V,$,Q){var le=Array.prototype.slice.call(arguments,3);try{h.apply(m,le)}catch(xe){this.onError(xe)}}var Gs=!1,fl=null,ki=!1,lh=null,$v={onError:function(l){Gs=!0,fl=l}};function ml(l,h,m,w,E,k,V,$,Q){Gs=!1,fl=null,$s.apply($v,arguments)}function Rp(l,h,m,w,E,k,V,$,Q){if(ml.apply(this,arguments),Gs){if(Gs){var le=fl;Gs=!1,fl=null}else throw Error(e(198));ki||(ki=!0,lh=le)}}function Ni(l){var h=l,m=l;if(l.alternate)for(;h.return;)h=h.return;else{l=h;do h=l,h.flags&4098&&(m=h.return),l=h.return;while(l)}return h.tag===3?m:null}function Ks(l){if(l.tag===13){var h=l.memoizedState;if(h===null&&(l=l.alternate,l!==null&&(h=l.memoizedState)),h!==null)return h.dehydrated}return null}function Di(l){if(Ni(l)!==l)throw Error(e(188))}function kp(l){var h=l.alternate;if(!h){if(h=Ni(l),h===null)throw Error(e(188));return h!==l?null:l}for(var m=l,w=h;;){var E=m.return;if(E===null)break;var k=E.alternate;if(k===null){if(w=E.return,w!==null){m=w;continue}break}if(E.child===k.child){for(k=E.child;k;){if(k===m)return Di(E),l;if(k===w)return Di(E),h;k=k.sibling}throw Error(e(188))}if(m.return!==w.return)m=E,w=k;else{for(var V=!1,$=E.child;$;){if($===m){V=!0,m=E,w=k;break}if($===w){V=!0,w=E,m=k;break}$=$.sibling}if(!V){for($=k.child;$;){if($===m){V=!0,m=k,w=E;break}if($===w){V=!0,w=k,m=E;break}$=$.sibling}if(!V)throw Error(e(189))}}if(m.alternate!==w)throw Error(e(190))}if(m.tag!==3)throw Error(e(188));return m.stateNode.current===m?l:h}function ch(l){return l=kp(l),l!==null?gl(l):null}function gl(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var h=gl(l);if(h!==null)return h;l=l.sibling}return null}var vl=t.unstable_scheduleCallback,hh=t.unstable_cancelCallback,Np=t.unstable_shouldYield,Gv=t.unstable_requestPaint,$t=t.unstable_now,Dp=t.unstable_getCurrentPriorityLevel,Xs=t.unstable_ImmediatePriority,Oa=t.unstable_UserBlockingPriority,mi=t.unstable_NormalPriority,dh=t.unstable_LowPriority,Op=t.unstable_IdlePriority,Qs=null,Xr=null;function Pp(l){if(Xr&&typeof Xr.onCommitFiberRoot=="function")try{Xr.onCommitFiberRoot(Qs,l,void 0,(l.current.flags&128)===128)}catch{}}var _r=Math.clz32?Math.clz32:Lp,ph=Math.log,Mp=Math.LN2;function Lp(l){return l>>>=0,l===0?32:31-(ph(l)/Mp|0)|0}var yl=64,wl=4194304;function Pa(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function Ys(l,h){var m=l.pendingLanes;if(m===0)return 0;var w=0,E=l.suspendedLanes,k=l.pingedLanes,V=m&268435455;if(V!==0){var $=V&~E;$!==0?w=Pa($):(k&=V,k!==0&&(w=Pa(k)))}else V=m&~E,V!==0?w=Pa(V):k!==0&&(w=Pa(k));if(w===0)return 0;if(h!==0&&h!==w&&!(h&E)&&(E=w&-w,k=h&-h,E>=k||E===16&&(k&4194240)!==0))return h;if(w&4&&(w|=m&16),h=l.entangledLanes,h!==0)for(l=l.entanglements,h&=w;0<h;)m=31-_r(h),E=1<<m,w|=l[m],h&=~E;return w}function Kv(l,h){switch(l){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wo(l,h){for(var m=l.suspendedLanes,w=l.pingedLanes,E=l.expirationTimes,k=l.pendingLanes;0<k;){var V=31-_r(k),$=1<<V,Q=E[V];Q===-1?(!($&m)||$&w)&&(E[V]=Kv($,h)):Q<=h&&(l.expiredLanes|=$),k&=~$}}function Qr(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function Js(){var l=yl;return yl<<=1,!(yl&4194240)&&(yl=64),l}function Ma(l){for(var h=[],m=0;31>m;m++)h.push(l);return h}function La(l,h,m){l.pendingLanes|=h,h!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,h=31-_r(h),l[h]=m}function Wt(l,h){var m=l.pendingLanes&~h;l.pendingLanes=h,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=h,l.mutableReadLanes&=h,l.entangledLanes&=h,h=l.entanglements;var w=l.eventTimes;for(l=l.expirationTimes;0<m;){var E=31-_r(m),k=1<<E;h[E]=0,w[E]=-1,l[E]=-1,m&=~k}}function Fa(l,h){var m=l.entangledLanes|=h;for(l=l.entanglements;m;){var w=31-_r(m),E=1<<w;E&h|l[w]&h&&(l[w]|=h),m&=~E}}var Tt=0;function za(l){return l&=-l,1<l?4<l?l&268435455?16:536870912:4:1}var Fp,bl,zp,Vp,Bp,fh=!1,uo=[],Zn=null,Oi=null,Pi=null,Va=new Map,gi=new Map,lo=[],Xv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Up(l,h){switch(l){case"focusin":case"focusout":Zn=null;break;case"dragenter":case"dragleave":Oi=null;break;case"mouseover":case"mouseout":Pi=null;break;case"pointerover":case"pointerout":Va.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":gi.delete(h.pointerId)}}function Nr(l,h,m,w,E,k){return l===null||l.nativeEvent!==k?(l={blockedOn:h,domEventName:m,eventSystemFlags:w,nativeEvent:k,targetContainers:[E]},h!==null&&(h=Rh(h),h!==null&&bl(h)),l):(l.eventSystemFlags|=w,h=l.targetContainers,E!==null&&h.indexOf(E)===-1&&h.push(E),l)}function Qv(l,h,m,w,E){switch(h){case"focusin":return Zn=Nr(Zn,l,h,m,w,E),!0;case"dragenter":return Oi=Nr(Oi,l,h,m,w,E),!0;case"mouseover":return Pi=Nr(Pi,l,h,m,w,E),!0;case"pointerover":var k=E.pointerId;return Va.set(k,Nr(Va.get(k)||null,l,h,m,w,E)),!0;case"gotpointercapture":return k=E.pointerId,gi.set(k,Nr(gi.get(k)||null,l,h,m,w,E)),!0}return!1}function jp(l){var h=ru(l.target);if(h!==null){var m=Ni(h);if(m!==null){if(h=m.tag,h===13){if(h=Ks(m),h!==null){l.blockedOn=h,Bp(l.priority,function(){zp(m)});return}}else if(h===3&&m.stateNode.current.memoizedState.isDehydrated){l.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}l.blockedOn=null}function qo(l){if(l.blockedOn!==null)return!1;for(var h=l.targetContainers;0<h.length;){var m=xl(l.domEventName,l.eventSystemFlags,h[0],l.nativeEvent);if(m===null){m=l.nativeEvent;var w=new m.constructor(m.type,m);qs=w,m.target.dispatchEvent(w),qs=null}else return h=Rh(m),h!==null&&bl(h),l.blockedOn=m,!1;h.shift()}return!0}function Zs(l,h,m){qo(l)&&m.delete(h)}function Wp(){fh=!1,Zn!==null&&qo(Zn)&&(Zn=null),Oi!==null&&qo(Oi)&&(Oi=null),Pi!==null&&qo(Pi)&&(Pi=null),Va.forEach(Zs),gi.forEach(Zs)}function Mi(l,h){l.blockedOn===h&&(l.blockedOn=null,fh||(fh=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Wp)))}function Li(l){function h(E){return Mi(E,l)}if(0<uo.length){Mi(uo[0],l);for(var m=1;m<uo.length;m++){var w=uo[m];w.blockedOn===l&&(w.blockedOn=null)}}for(Zn!==null&&Mi(Zn,l),Oi!==null&&Mi(Oi,l),Pi!==null&&Mi(Pi,l),Va.forEach(h),gi.forEach(h),m=0;m<lo.length;m++)w=lo[m],w.blockedOn===l&&(w.blockedOn=null);for(;0<lo.length&&(m=lo[0],m.blockedOn===null);)jp(m),m.blockedOn===null&&lo.shift()}var Ho=D.ReactCurrentBatchConfig,Ba=!0;function nn(l,h,m,w){var E=Tt,k=Ho.transition;Ho.transition=null;try{Tt=1,mh(l,h,m,w)}finally{Tt=E,Ho.transition=k}}function Yv(l,h,m,w){var E=Tt,k=Ho.transition;Ho.transition=null;try{Tt=4,mh(l,h,m,w)}finally{Tt=E,Ho.transition=k}}function mh(l,h,m,w){if(Ba){var E=xl(l,h,m,w);if(E===null)uy(l,h,w,eu,m),Up(l,w);else if(Qv(E,l,h,m,w))w.stopPropagation();else if(Up(l,w),h&4&&-1<Xv.indexOf(l)){for(;E!==null;){var k=Rh(E);if(k!==null&&Fp(k),k=xl(l,h,m,w),k===null&&uy(l,h,w,eu,m),k===E)break;E=k}E!==null&&w.stopPropagation()}else uy(l,h,w,null,m)}}var eu=null;function xl(l,h,m,w){if(eu=null,l=cl(w),l=ru(l),l!==null)if(h=Ni(l),h===null)l=null;else if(m=h.tag,m===13){if(l=Ks(h),l!==null)return l;l=null}else if(m===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;l=null}else h!==l&&(l=null);return eu=l,null}function gh(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Dp()){case Xs:return 1;case Oa:return 4;case mi:case dh:return 16;case Op:return 536870912;default:return 16}default:return 16}}var Yr=null,_l=null,Dr=null;function vh(){if(Dr)return Dr;var l,h=_l,m=h.length,w,E="value"in Yr?Yr.value:Yr.textContent,k=E.length;for(l=0;l<m&&h[l]===E[l];l++);var V=m-l;for(w=1;w<=V&&h[m-w]===E[k-w];w++);return Dr=E.slice(l,1<w?1-w:void 0)}function El(l){var h=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&h===13&&(l=13)):l=h,l===10&&(l=13),32<=l||l===13?l:0}function co(){return!0}function yh(){return!1}function er(l){function h(m,w,E,k,V){this._reactName=m,this._targetInst=E,this.type=w,this.nativeEvent=k,this.target=V,this.currentTarget=null;for(var $ in l)l.hasOwnProperty($)&&(m=l[$],this[$]=m?m(k):k[$]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?co:yh,this.isPropagationStopped=yh,this}return J(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=co)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=co)},persist:function(){},isPersistent:co}),h}var Fi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Il=er(Fi),ho=J({},Fi,{view:0,detail:0}),Jv=er(ho),Cl,$o,Ua,tu=J({},ho,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:po,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Ua&&(Ua&&l.type==="mousemove"?(Cl=l.screenX-Ua.screenX,$o=l.screenY-Ua.screenY):$o=Cl=0,Ua=l),Cl)},movementY:function(l){return"movementY"in l?l.movementY:$o}}),Sl=er(tu),wh=J({},tu,{dataTransfer:0}),qp=er(wh),Tl=J({},ho,{relatedTarget:0}),Al=er(Tl),Hp=J({},Fi,{animationName:0,elapsedTime:0,pseudoElement:0}),Go=er(Hp),$p=J({},Fi,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Gp=er($p),Kp=J({},Fi,{data:0}),bh=er(Kp),Rl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Er={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Qp(l){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(l):(l=Xp[l])?!!h[l]:!1}function po(){return Qp}var v=J({},ho,{key:function(l){if(l.key){var h=Rl[l.key]||l.key;if(h!=="Unidentified")return h}return l.type==="keypress"?(l=El(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?Er[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:po,charCode:function(l){return l.type==="keypress"?El(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?El(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),R=er(v),L=J({},tu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),U=er(L),oe=J({},ho,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:po}),pe=er(oe),Ae=J({},Fi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bt=er(Ae),On=J({},tu,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),Rt=er(On),qn=[9,13,27,32],In=s&&"CompositionEvent"in window,vi=null;s&&"documentMode"in document&&(vi=document.documentMode);var Jr=s&&"TextEvent"in window&&!vi,nu=s&&(!In||vi&&8<vi&&11>=vi),kl=" ",z_=!1;function V_(l,h){switch(l){case"keyup":return qn.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function B_(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Nl=!1;function cM(l,h){switch(l){case"compositionend":return B_(h);case"keypress":return h.which!==32?null:(z_=!0,kl);case"textInput":return l=h.data,l===kl&&z_?null:l;default:return null}}function hM(l,h){if(Nl)return l==="compositionend"||!In&&V_(l,h)?(l=vh(),Dr=_l=Yr=null,Nl=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return nu&&h.locale!=="ko"?null:h.data;default:return null}}var dM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function U_(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h==="input"?!!dM[l.type]:h==="textarea"}function j_(l,h,m,w){so(w),h=tf(h,"onChange"),0<h.length&&(m=new Il("onChange","change",null,m,w),l.push({event:m,listeners:h}))}var xh=null,_h=null;function pM(l){aE(l,0)}function Yp(l){var h=Ll(l);if(wt(h))return l}function fM(l,h){if(l==="change")return h}var W_=!1;if(s){var Zv;if(s){var ey="oninput"in document;if(!ey){var q_=document.createElement("div");q_.setAttribute("oninput","return;"),ey=typeof q_.oninput=="function"}Zv=ey}else Zv=!1;W_=Zv&&(!document.documentMode||9<document.documentMode)}function H_(){xh&&(xh.detachEvent("onpropertychange",$_),_h=xh=null)}function $_(l){if(l.propertyName==="value"&&Yp(_h)){var h=[];j_(h,_h,l,cl(l)),uh(pM,h)}}function mM(l,h,m){l==="focusin"?(H_(),xh=h,_h=m,xh.attachEvent("onpropertychange",$_)):l==="focusout"&&H_()}function gM(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Yp(_h)}function vM(l,h){if(l==="click")return Yp(h)}function yM(l,h){if(l==="input"||l==="change")return Yp(h)}function wM(l,h){return l===h&&(l!==0||1/l===1/h)||l!==l&&h!==h}var zi=typeof Object.is=="function"?Object.is:wM;function Eh(l,h){if(zi(l,h))return!0;if(typeof l!="object"||l===null||typeof h!="object"||h===null)return!1;var m=Object.keys(l),w=Object.keys(h);if(m.length!==w.length)return!1;for(w=0;w<m.length;w++){var E=m[w];if(!u.call(h,E)||!zi(l[E],h[E]))return!1}return!0}function G_(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function K_(l,h){var m=G_(l);l=0;for(var w;m;){if(m.nodeType===3){if(w=l+m.textContent.length,l<=h&&w>=h)return{node:m,offset:h-l};l=w}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=G_(m)}}function X_(l,h){return l&&h?l===h?!0:l&&l.nodeType===3?!1:h&&h.nodeType===3?X_(l,h.parentNode):"contains"in l?l.contains(h):l.compareDocumentPosition?!!(l.compareDocumentPosition(h)&16):!1:!1}function Q_(){for(var l=window,h=ht();h instanceof l.HTMLIFrameElement;){try{var m=typeof h.contentWindow.location.href=="string"}catch{m=!1}if(m)l=h.contentWindow;else break;h=ht(l.document)}return h}function ty(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h&&(h==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||h==="textarea"||l.contentEditable==="true")}function bM(l){var h=Q_(),m=l.focusedElem,w=l.selectionRange;if(h!==m&&m&&m.ownerDocument&&X_(m.ownerDocument.documentElement,m)){if(w!==null&&ty(m)){if(h=w.start,l=w.end,l===void 0&&(l=h),"selectionStart"in m)m.selectionStart=h,m.selectionEnd=Math.min(l,m.value.length);else if(l=(h=m.ownerDocument||document)&&h.defaultView||window,l.getSelection){l=l.getSelection();var E=m.textContent.length,k=Math.min(w.start,E);w=w.end===void 0?k:Math.min(w.end,E),!l.extend&&k>w&&(E=w,w=k,k=E),E=K_(m,k);var V=K_(m,w);E&&V&&(l.rangeCount!==1||l.anchorNode!==E.node||l.anchorOffset!==E.offset||l.focusNode!==V.node||l.focusOffset!==V.offset)&&(h=h.createRange(),h.setStart(E.node,E.offset),l.removeAllRanges(),k>w?(l.addRange(h),l.extend(V.node,V.offset)):(h.setEnd(V.node,V.offset),l.addRange(h)))}}for(h=[],l=m;l=l.parentNode;)l.nodeType===1&&h.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<h.length;m++)l=h[m],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var xM=s&&"documentMode"in document&&11>=document.documentMode,Dl=null,ny=null,Ih=null,ry=!1;function Y_(l,h,m){var w=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;ry||Dl==null||Dl!==ht(w)||(w=Dl,"selectionStart"in w&&ty(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Ih&&Eh(Ih,w)||(Ih=w,w=tf(ny,"onSelect"),0<w.length&&(h=new Il("onSelect","select",null,h,m),l.push({event:h,listeners:w}),h.target=Dl)))}function Jp(l,h){var m={};return m[l.toLowerCase()]=h.toLowerCase(),m["Webkit"+l]="webkit"+h,m["Moz"+l]="moz"+h,m}var Ol={animationend:Jp("Animation","AnimationEnd"),animationiteration:Jp("Animation","AnimationIteration"),animationstart:Jp("Animation","AnimationStart"),transitionend:Jp("Transition","TransitionEnd")},iy={},J_={};s&&(J_=document.createElement("div").style,"AnimationEvent"in window||(delete Ol.animationend.animation,delete Ol.animationiteration.animation,delete Ol.animationstart.animation),"TransitionEvent"in window||delete Ol.transitionend.transition);function Zp(l){if(iy[l])return iy[l];if(!Ol[l])return l;var h=Ol[l],m;for(m in h)if(h.hasOwnProperty(m)&&m in J_)return iy[l]=h[m];return l}var Z_=Zp("animationend"),eE=Zp("animationiteration"),tE=Zp("animationstart"),nE=Zp("transitionend"),rE=new Map,iE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ja(l,h){rE.set(l,h),o(h,[l])}for(var oy=0;oy<iE.length;oy++){var ay=iE[oy],_M=ay.toLowerCase(),EM=ay[0].toUpperCase()+ay.slice(1);ja(_M,"on"+EM)}ja(Z_,"onAnimationEnd"),ja(eE,"onAnimationIteration"),ja(tE,"onAnimationStart"),ja("dblclick","onDoubleClick"),ja("focusin","onFocus"),ja("focusout","onBlur"),ja(nE,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ch="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IM=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ch));function oE(l,h,m){var w=l.type||"unknown-event";l.currentTarget=m,Rp(w,h,void 0,l),l.currentTarget=null}function aE(l,h){h=(h&4)!==0;for(var m=0;m<l.length;m++){var w=l[m],E=w.event;w=w.listeners;e:{var k=void 0;if(h)for(var V=w.length-1;0<=V;V--){var $=w[V],Q=$.instance,le=$.currentTarget;if($=$.listener,Q!==k&&E.isPropagationStopped())break e;oE(E,$,le),k=Q}else for(V=0;V<w.length;V++){if($=w[V],Q=$.instance,le=$.currentTarget,$=$.listener,Q!==k&&E.isPropagationStopped())break e;oE(E,$,le),k=Q}}}if(ki)throw l=lh,ki=!1,lh=null,l}function Yt(l,h){var m=h[fy];m===void 0&&(m=h[fy]=new Set);var w=l+"__bubble";m.has(w)||(sE(h,l,2,!1),m.add(w))}function sy(l,h,m){var w=0;h&&(w|=4),sE(m,l,w,h)}var ef="_reactListening"+Math.random().toString(36).slice(2);function Sh(l){if(!l[ef]){l[ef]=!0,n.forEach(function(m){m!=="selectionchange"&&(IM.has(m)||sy(m,!1,l),sy(m,!0,l))});var h=l.nodeType===9?l:l.ownerDocument;h===null||h[ef]||(h[ef]=!0,sy("selectionchange",!1,h))}}function sE(l,h,m,w){switch(gh(h)){case 1:var E=nn;break;case 4:E=Yv;break;default:E=mh}m=E.bind(null,h,m,l),E=void 0,!pl||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(E=!0),w?E!==void 0?l.addEventListener(h,m,{capture:!0,passive:E}):l.addEventListener(h,m,!0):E!==void 0?l.addEventListener(h,m,{passive:E}):l.addEventListener(h,m,!1)}function uy(l,h,m,w,E){var k=w;if(!(h&1)&&!(h&2)&&w!==null)e:for(;;){if(w===null)return;var V=w.tag;if(V===3||V===4){var $=w.stateNode.containerInfo;if($===E||$.nodeType===8&&$.parentNode===E)break;if(V===4)for(V=w.return;V!==null;){var Q=V.tag;if((Q===3||Q===4)&&(Q=V.stateNode.containerInfo,Q===E||Q.nodeType===8&&Q.parentNode===E))return;V=V.return}for(;$!==null;){if(V=ru($),V===null)return;if(Q=V.tag,Q===5||Q===6){w=k=V;continue e}$=$.parentNode}}w=w.return}uh(function(){var le=k,xe=cl(m),Ie=[];e:{var we=rE.get(l);if(we!==void 0){var Pe=Il,Be=l;switch(l){case"keypress":if(El(m)===0)break e;case"keydown":case"keyup":Pe=R;break;case"focusin":Be="focus",Pe=Al;break;case"focusout":Be="blur",Pe=Al;break;case"beforeblur":case"afterblur":Pe=Al;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pe=Sl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pe=qp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pe=pe;break;case Z_:case eE:case tE:Pe=Go;break;case nE:Pe=Bt;break;case"scroll":Pe=Jv;break;case"wheel":Pe=Rt;break;case"copy":case"cut":case"paste":Pe=Gp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pe=U}var We=(h&4)!==0,wn=!We&&l==="scroll",ae=We?we!==null?we+"Capture":null:we;We=[];for(var te=le,se;te!==null;){se=te;var Se=se.stateNode;if(se.tag===5&&Se!==null&&(se=Se,ae!==null&&(Se=yn(te,ae),Se!=null&&We.push(Th(te,Se,se)))),wn)break;te=te.return}0<We.length&&(we=new Pe(we,Be,null,m,xe),Ie.push({event:we,listeners:We}))}}if(!(h&7)){e:{if(we=l==="mouseover"||l==="pointerover",Pe=l==="mouseout"||l==="pointerout",we&&m!==qs&&(Be=m.relatedTarget||m.fromElement)&&(ru(Be)||Be[Ko]))break e;if((Pe||we)&&(we=xe.window===xe?xe:(we=xe.ownerDocument)?we.defaultView||we.parentWindow:window,Pe?(Be=m.relatedTarget||m.toElement,Pe=le,Be=Be?ru(Be):null,Be!==null&&(wn=Ni(Be),Be!==wn||Be.tag!==5&&Be.tag!==6)&&(Be=null)):(Pe=null,Be=le),Pe!==Be)){if(We=Sl,Se="onMouseLeave",ae="onMouseEnter",te="mouse",(l==="pointerout"||l==="pointerover")&&(We=U,Se="onPointerLeave",ae="onPointerEnter",te="pointer"),wn=Pe==null?we:Ll(Pe),se=Be==null?we:Ll(Be),we=new We(Se,te+"leave",Pe,m,xe),we.target=wn,we.relatedTarget=se,Se=null,ru(xe)===le&&(We=new We(ae,te+"enter",Be,m,xe),We.target=se,We.relatedTarget=wn,Se=We),wn=Se,Pe&&Be)t:{for(We=Pe,ae=Be,te=0,se=We;se;se=Pl(se))te++;for(se=0,Se=ae;Se;Se=Pl(Se))se++;for(;0<te-se;)We=Pl(We),te--;for(;0<se-te;)ae=Pl(ae),se--;for(;te--;){if(We===ae||ae!==null&&We===ae.alternate)break t;We=Pl(We),ae=Pl(ae)}We=null}else We=null;Pe!==null&&uE(Ie,we,Pe,We,!1),Be!==null&&wn!==null&&uE(Ie,wn,Be,We,!0)}}e:{if(we=le?Ll(le):window,Pe=we.nodeName&&we.nodeName.toLowerCase(),Pe==="select"||Pe==="input"&&we.type==="file")var qe=fM;else if(U_(we))if(W_)qe=yM;else{qe=gM;var Ke=mM}else(Pe=we.nodeName)&&Pe.toLowerCase()==="input"&&(we.type==="checkbox"||we.type==="radio")&&(qe=vM);if(qe&&(qe=qe(l,le))){j_(Ie,qe,m,xe);break e}Ke&&Ke(l,we,le),l==="focusout"&&(Ke=we._wrapperState)&&Ke.controlled&&we.type==="number"&&dn(we,"number",we.value)}switch(Ke=le?Ll(le):window,l){case"focusin":(U_(Ke)||Ke.contentEditable==="true")&&(Dl=Ke,ny=le,Ih=null);break;case"focusout":Ih=ny=Dl=null;break;case"mousedown":ry=!0;break;case"contextmenu":case"mouseup":case"dragend":ry=!1,Y_(Ie,m,xe);break;case"selectionchange":if(xM)break;case"keydown":case"keyup":Y_(Ie,m,xe)}var Xe;if(In)e:{switch(l){case"compositionstart":var tt="onCompositionStart";break e;case"compositionend":tt="onCompositionEnd";break e;case"compositionupdate":tt="onCompositionUpdate";break e}tt=void 0}else Nl?V_(l,m)&&(tt="onCompositionEnd"):l==="keydown"&&m.keyCode===229&&(tt="onCompositionStart");tt&&(nu&&m.locale!=="ko"&&(Nl||tt!=="onCompositionStart"?tt==="onCompositionEnd"&&Nl&&(Xe=vh()):(Yr=xe,_l="value"in Yr?Yr.value:Yr.textContent,Nl=!0)),Ke=tf(le,tt),0<Ke.length&&(tt=new bh(tt,l,null,m,xe),Ie.push({event:tt,listeners:Ke}),Xe?tt.data=Xe:(Xe=B_(m),Xe!==null&&(tt.data=Xe)))),(Xe=Jr?cM(l,m):hM(l,m))&&(le=tf(le,"onBeforeInput"),0<le.length&&(xe=new bh("onBeforeInput","beforeinput",null,m,xe),Ie.push({event:xe,listeners:le}),xe.data=Xe))}aE(Ie,h)})}function Th(l,h,m){return{instance:l,listener:h,currentTarget:m}}function tf(l,h){for(var m=h+"Capture",w=[];l!==null;){var E=l,k=E.stateNode;E.tag===5&&k!==null&&(E=k,k=yn(l,m),k!=null&&w.unshift(Th(l,k,E)),k=yn(l,h),k!=null&&w.push(Th(l,k,E))),l=l.return}return w}function Pl(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function uE(l,h,m,w,E){for(var k=h._reactName,V=[];m!==null&&m!==w;){var $=m,Q=$.alternate,le=$.stateNode;if(Q!==null&&Q===w)break;$.tag===5&&le!==null&&($=le,E?(Q=yn(m,k),Q!=null&&V.unshift(Th(m,Q,$))):E||(Q=yn(m,k),Q!=null&&V.push(Th(m,Q,$)))),m=m.return}V.length!==0&&l.push({event:h,listeners:V})}var CM=/\r\n?/g,SM=/\u0000|\uFFFD/g;function lE(l){return(typeof l=="string"?l:""+l).replace(CM,`
`).replace(SM,"")}function nf(l,h,m){if(h=lE(h),lE(l)!==h&&m)throw Error(e(425))}function rf(){}var ly=null,cy=null;function hy(l,h){return l==="textarea"||l==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var dy=typeof setTimeout=="function"?setTimeout:void 0,TM=typeof clearTimeout=="function"?clearTimeout:void 0,cE=typeof Promise=="function"?Promise:void 0,AM=typeof queueMicrotask=="function"?queueMicrotask:typeof cE<"u"?function(l){return cE.resolve(null).then(l).catch(RM)}:dy;function RM(l){setTimeout(function(){throw l})}function py(l,h){var m=h,w=0;do{var E=m.nextSibling;if(l.removeChild(m),E&&E.nodeType===8)if(m=E.data,m==="/$"){if(w===0){l.removeChild(E),Li(h);return}w--}else m!=="$"&&m!=="$?"&&m!=="$!"||w++;m=E}while(m);Li(h)}function Wa(l){for(;l!=null;l=l.nextSibling){var h=l.nodeType;if(h===1||h===3)break;if(h===8){if(h=l.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return l}function hE(l){l=l.previousSibling;for(var h=0;l;){if(l.nodeType===8){var m=l.data;if(m==="$"||m==="$!"||m==="$?"){if(h===0)return l;h--}else m==="/$"&&h++}l=l.previousSibling}return null}var Ml=Math.random().toString(36).slice(2),fo="__reactFiber$"+Ml,Ah="__reactProps$"+Ml,Ko="__reactContainer$"+Ml,fy="__reactEvents$"+Ml,kM="__reactListeners$"+Ml,NM="__reactHandles$"+Ml;function ru(l){var h=l[fo];if(h)return h;for(var m=l.parentNode;m;){if(h=m[Ko]||m[fo]){if(m=h.alternate,h.child!==null||m!==null&&m.child!==null)for(l=hE(l);l!==null;){if(m=l[fo])return m;l=hE(l)}return h}l=m,m=l.parentNode}return null}function Rh(l){return l=l[fo]||l[Ko],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function Ll(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(e(33))}function of(l){return l[Ah]||null}var my=[],Fl=-1;function qa(l){return{current:l}}function Jt(l){0>Fl||(l.current=my[Fl],my[Fl]=null,Fl--)}function Gt(l,h){Fl++,my[Fl]=l.current,l.current=h}var Ha={},hr=qa(Ha),Or=qa(!1),iu=Ha;function zl(l,h){var m=l.type.contextTypes;if(!m)return Ha;var w=l.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===h)return w.__reactInternalMemoizedMaskedChildContext;var E={},k;for(k in m)E[k]=h[k];return w&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=h,l.__reactInternalMemoizedMaskedChildContext=E),E}function Pr(l){return l=l.childContextTypes,l!=null}function af(){Jt(Or),Jt(hr)}function dE(l,h,m){if(hr.current!==Ha)throw Error(e(168));Gt(hr,h),Gt(Or,m)}function pE(l,h,m){var w=l.stateNode;if(h=h.childContextTypes,typeof w.getChildContext!="function")return m;w=w.getChildContext();for(var E in w)if(!(E in h))throw Error(e(108,De(l)||"Unknown",E));return J({},m,w)}function sf(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||Ha,iu=hr.current,Gt(hr,l),Gt(Or,Or.current),!0}function fE(l,h,m){var w=l.stateNode;if(!w)throw Error(e(169));m?(l=pE(l,h,iu),w.__reactInternalMemoizedMergedChildContext=l,Jt(Or),Jt(hr),Gt(hr,l)):Jt(Or),Gt(Or,m)}var Xo=null,uf=!1,gy=!1;function mE(l){Xo===null?Xo=[l]:Xo.push(l)}function DM(l){uf=!0,mE(l)}function $a(){if(!gy&&Xo!==null){gy=!0;var l=0,h=Tt;try{var m=Xo;for(Tt=1;l<m.length;l++){var w=m[l];do w=w(!0);while(w!==null)}Xo=null,uf=!1}catch(E){throw Xo!==null&&(Xo=Xo.slice(l+1)),vl(Xs,$a),E}finally{Tt=h,gy=!1}}return null}var Vl=[],Bl=0,lf=null,cf=0,yi=[],wi=0,ou=null,Qo=1,Yo="";function au(l,h){Vl[Bl++]=cf,Vl[Bl++]=lf,lf=l,cf=h}function gE(l,h,m){yi[wi++]=Qo,yi[wi++]=Yo,yi[wi++]=ou,ou=l;var w=Qo;l=Yo;var E=32-_r(w)-1;w&=~(1<<E),m+=1;var k=32-_r(h)+E;if(30<k){var V=E-E%5;k=(w&(1<<V)-1).toString(32),w>>=V,E-=V,Qo=1<<32-_r(h)+E|m<<E|w,Yo=k+l}else Qo=1<<k|m<<E|w,Yo=l}function vy(l){l.return!==null&&(au(l,1),gE(l,1,0))}function yy(l){for(;l===lf;)lf=Vl[--Bl],Vl[Bl]=null,cf=Vl[--Bl],Vl[Bl]=null;for(;l===ou;)ou=yi[--wi],yi[wi]=null,Yo=yi[--wi],yi[wi]=null,Qo=yi[--wi],yi[wi]=null}var Zr=null,ei=null,rn=!1,Vi=null;function vE(l,h){var m=Ei(5,null,null,0);m.elementType="DELETED",m.stateNode=h,m.return=l,h=l.deletions,h===null?(l.deletions=[m],l.flags|=16):h.push(m)}function yE(l,h){switch(l.tag){case 5:var m=l.type;return h=h.nodeType!==1||m.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(l.stateNode=h,Zr=l,ei=Wa(h.firstChild),!0):!1;case 6:return h=l.pendingProps===""||h.nodeType!==3?null:h,h!==null?(l.stateNode=h,Zr=l,ei=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(m=ou!==null?{id:Qo,overflow:Yo}:null,l.memoizedState={dehydrated:h,treeContext:m,retryLane:1073741824},m=Ei(18,null,null,0),m.stateNode=h,m.return=l,l.child=m,Zr=l,ei=null,!0):!1;default:return!1}}function wy(l){return(l.mode&1)!==0&&(l.flags&128)===0}function by(l){if(rn){var h=ei;if(h){var m=h;if(!yE(l,h)){if(wy(l))throw Error(e(418));h=Wa(m.nextSibling);var w=Zr;h&&yE(l,h)?vE(w,m):(l.flags=l.flags&-4097|2,rn=!1,Zr=l)}}else{if(wy(l))throw Error(e(418));l.flags=l.flags&-4097|2,rn=!1,Zr=l}}}function wE(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;Zr=l}function hf(l){if(l!==Zr)return!1;if(!rn)return wE(l),rn=!0,!1;var h;if((h=l.tag!==3)&&!(h=l.tag!==5)&&(h=l.type,h=h!=="head"&&h!=="body"&&!hy(l.type,l.memoizedProps)),h&&(h=ei)){if(wy(l))throw bE(),Error(e(418));for(;h;)vE(l,h),h=Wa(h.nextSibling)}if(wE(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(e(317));e:{for(l=l.nextSibling,h=0;l;){if(l.nodeType===8){var m=l.data;if(m==="/$"){if(h===0){ei=Wa(l.nextSibling);break e}h--}else m!=="$"&&m!=="$!"&&m!=="$?"||h++}l=l.nextSibling}ei=null}}else ei=Zr?Wa(l.stateNode.nextSibling):null;return!0}function bE(){for(var l=ei;l;)l=Wa(l.nextSibling)}function Ul(){ei=Zr=null,rn=!1}function xy(l){Vi===null?Vi=[l]:Vi.push(l)}var OM=D.ReactCurrentBatchConfig;function kh(l,h,m){if(l=m.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(e(309));var w=m.stateNode}if(!w)throw Error(e(147,l));var E=w,k=""+l;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===k?h.ref:(h=function(V){var $=E.refs;V===null?delete $[k]:$[k]=V},h._stringRef=k,h)}if(typeof l!="string")throw Error(e(284));if(!m._owner)throw Error(e(290,l))}return l}function df(l,h){throw l=Object.prototype.toString.call(h),Error(e(31,l==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":l))}function xE(l){var h=l._init;return h(l._payload)}function _E(l){function h(ae,te){if(l){var se=ae.deletions;se===null?(ae.deletions=[te],ae.flags|=16):se.push(te)}}function m(ae,te){if(!l)return null;for(;te!==null;)h(ae,te),te=te.sibling;return null}function w(ae,te){for(ae=new Map;te!==null;)te.key!==null?ae.set(te.key,te):ae.set(te.index,te),te=te.sibling;return ae}function E(ae,te){return ae=es(ae,te),ae.index=0,ae.sibling=null,ae}function k(ae,te,se){return ae.index=se,l?(se=ae.alternate,se!==null?(se=se.index,se<te?(ae.flags|=2,te):se):(ae.flags|=2,te)):(ae.flags|=1048576,te)}function V(ae){return l&&ae.alternate===null&&(ae.flags|=2),ae}function $(ae,te,se,Se){return te===null||te.tag!==6?(te=d0(se,ae.mode,Se),te.return=ae,te):(te=E(te,se),te.return=ae,te)}function Q(ae,te,se,Se){var qe=se.type;return qe===I?xe(ae,te,se.props.children,Se,se.key):te!==null&&(te.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===Y&&xE(qe)===te.type)?(Se=E(te,se.props),Se.ref=kh(ae,te,se),Se.return=ae,Se):(Se=Lf(se.type,se.key,se.props,null,ae.mode,Se),Se.ref=kh(ae,te,se),Se.return=ae,Se)}function le(ae,te,se,Se){return te===null||te.tag!==4||te.stateNode.containerInfo!==se.containerInfo||te.stateNode.implementation!==se.implementation?(te=p0(se,ae.mode,Se),te.return=ae,te):(te=E(te,se.children||[]),te.return=ae,te)}function xe(ae,te,se,Se,qe){return te===null||te.tag!==7?(te=fu(se,ae.mode,Se,qe),te.return=ae,te):(te=E(te,se),te.return=ae,te)}function Ie(ae,te,se){if(typeof te=="string"&&te!==""||typeof te=="number")return te=d0(""+te,ae.mode,se),te.return=ae,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case O:return se=Lf(te.type,te.key,te.props,null,ae.mode,se),se.ref=kh(ae,null,te),se.return=ae,se;case z:return te=p0(te,ae.mode,se),te.return=ae,te;case Y:var Se=te._init;return Ie(ae,Se(te._payload),se)}if(sn(te)||ie(te))return te=fu(te,ae.mode,se,null),te.return=ae,te;df(ae,te)}return null}function we(ae,te,se,Se){var qe=te!==null?te.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return qe!==null?null:$(ae,te,""+se,Se);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case O:return se.key===qe?Q(ae,te,se,Se):null;case z:return se.key===qe?le(ae,te,se,Se):null;case Y:return qe=se._init,we(ae,te,qe(se._payload),Se)}if(sn(se)||ie(se))return qe!==null?null:xe(ae,te,se,Se,null);df(ae,se)}return null}function Pe(ae,te,se,Se,qe){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return ae=ae.get(se)||null,$(te,ae,""+Se,qe);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case O:return ae=ae.get(Se.key===null?se:Se.key)||null,Q(te,ae,Se,qe);case z:return ae=ae.get(Se.key===null?se:Se.key)||null,le(te,ae,Se,qe);case Y:var Ke=Se._init;return Pe(ae,te,se,Ke(Se._payload),qe)}if(sn(Se)||ie(Se))return ae=ae.get(se)||null,xe(te,ae,Se,qe,null);df(te,Se)}return null}function Be(ae,te,se,Se){for(var qe=null,Ke=null,Xe=te,tt=te=0,Gn=null;Xe!==null&&tt<se.length;tt++){Xe.index>tt?(Gn=Xe,Xe=null):Gn=Xe.sibling;var Mt=we(ae,Xe,se[tt],Se);if(Mt===null){Xe===null&&(Xe=Gn);break}l&&Xe&&Mt.alternate===null&&h(ae,Xe),te=k(Mt,te,tt),Ke===null?qe=Mt:Ke.sibling=Mt,Ke=Mt,Xe=Gn}if(tt===se.length)return m(ae,Xe),rn&&au(ae,tt),qe;if(Xe===null){for(;tt<se.length;tt++)Xe=Ie(ae,se[tt],Se),Xe!==null&&(te=k(Xe,te,tt),Ke===null?qe=Xe:Ke.sibling=Xe,Ke=Xe);return rn&&au(ae,tt),qe}for(Xe=w(ae,Xe);tt<se.length;tt++)Gn=Pe(Xe,ae,tt,se[tt],Se),Gn!==null&&(l&&Gn.alternate!==null&&Xe.delete(Gn.key===null?tt:Gn.key),te=k(Gn,te,tt),Ke===null?qe=Gn:Ke.sibling=Gn,Ke=Gn);return l&&Xe.forEach(function(ts){return h(ae,ts)}),rn&&au(ae,tt),qe}function We(ae,te,se,Se){var qe=ie(se);if(typeof qe!="function")throw Error(e(150));if(se=qe.call(se),se==null)throw Error(e(151));for(var Ke=qe=null,Xe=te,tt=te=0,Gn=null,Mt=se.next();Xe!==null&&!Mt.done;tt++,Mt=se.next()){Xe.index>tt?(Gn=Xe,Xe=null):Gn=Xe.sibling;var ts=we(ae,Xe,Mt.value,Se);if(ts===null){Xe===null&&(Xe=Gn);break}l&&Xe&&ts.alternate===null&&h(ae,Xe),te=k(ts,te,tt),Ke===null?qe=ts:Ke.sibling=ts,Ke=ts,Xe=Gn}if(Mt.done)return m(ae,Xe),rn&&au(ae,tt),qe;if(Xe===null){for(;!Mt.done;tt++,Mt=se.next())Mt=Ie(ae,Mt.value,Se),Mt!==null&&(te=k(Mt,te,tt),Ke===null?qe=Mt:Ke.sibling=Mt,Ke=Mt);return rn&&au(ae,tt),qe}for(Xe=w(ae,Xe);!Mt.done;tt++,Mt=se.next())Mt=Pe(Xe,ae,tt,Mt.value,Se),Mt!==null&&(l&&Mt.alternate!==null&&Xe.delete(Mt.key===null?tt:Mt.key),te=k(Mt,te,tt),Ke===null?qe=Mt:Ke.sibling=Mt,Ke=Mt);return l&&Xe.forEach(function(dL){return h(ae,dL)}),rn&&au(ae,tt),qe}function wn(ae,te,se,Se){if(typeof se=="object"&&se!==null&&se.type===I&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case O:e:{for(var qe=se.key,Ke=te;Ke!==null;){if(Ke.key===qe){if(qe=se.type,qe===I){if(Ke.tag===7){m(ae,Ke.sibling),te=E(Ke,se.props.children),te.return=ae,ae=te;break e}}else if(Ke.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===Y&&xE(qe)===Ke.type){m(ae,Ke.sibling),te=E(Ke,se.props),te.ref=kh(ae,Ke,se),te.return=ae,ae=te;break e}m(ae,Ke);break}else h(ae,Ke);Ke=Ke.sibling}se.type===I?(te=fu(se.props.children,ae.mode,Se,se.key),te.return=ae,ae=te):(Se=Lf(se.type,se.key,se.props,null,ae.mode,Se),Se.ref=kh(ae,te,se),Se.return=ae,ae=Se)}return V(ae);case z:e:{for(Ke=se.key;te!==null;){if(te.key===Ke)if(te.tag===4&&te.stateNode.containerInfo===se.containerInfo&&te.stateNode.implementation===se.implementation){m(ae,te.sibling),te=E(te,se.children||[]),te.return=ae,ae=te;break e}else{m(ae,te);break}else h(ae,te);te=te.sibling}te=p0(se,ae.mode,Se),te.return=ae,ae=te}return V(ae);case Y:return Ke=se._init,wn(ae,te,Ke(se._payload),Se)}if(sn(se))return Be(ae,te,se,Se);if(ie(se))return We(ae,te,se,Se);df(ae,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,te!==null&&te.tag===6?(m(ae,te.sibling),te=E(te,se),te.return=ae,ae=te):(m(ae,te),te=d0(se,ae.mode,Se),te.return=ae,ae=te),V(ae)):m(ae,te)}return wn}var jl=_E(!0),EE=_E(!1),pf=qa(null),ff=null,Wl=null,_y=null;function Ey(){_y=Wl=ff=null}function Iy(l){var h=pf.current;Jt(pf),l._currentValue=h}function Cy(l,h,m){for(;l!==null;){var w=l.alternate;if((l.childLanes&h)!==h?(l.childLanes|=h,w!==null&&(w.childLanes|=h)):w!==null&&(w.childLanes&h)!==h&&(w.childLanes|=h),l===m)break;l=l.return}}function ql(l,h){ff=l,_y=Wl=null,l=l.dependencies,l!==null&&l.firstContext!==null&&(l.lanes&h&&(Mr=!0),l.firstContext=null)}function bi(l){var h=l._currentValue;if(_y!==l)if(l={context:l,memoizedValue:h,next:null},Wl===null){if(ff===null)throw Error(e(308));Wl=l,ff.dependencies={lanes:0,firstContext:l}}else Wl=Wl.next=l;return h}var su=null;function Sy(l){su===null?su=[l]:su.push(l)}function IE(l,h,m,w){var E=h.interleaved;return E===null?(m.next=m,Sy(h)):(m.next=E.next,E.next=m),h.interleaved=m,Jo(l,w)}function Jo(l,h){l.lanes|=h;var m=l.alternate;for(m!==null&&(m.lanes|=h),m=l,l=l.return;l!==null;)l.childLanes|=h,m=l.alternate,m!==null&&(m.childLanes|=h),m=l,l=l.return;return m.tag===3?m.stateNode:null}var Ga=!1;function Ty(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CE(l,h){l=l.updateQueue,h.updateQueue===l&&(h.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function Zo(l,h){return{eventTime:l,lane:h,tag:0,payload:null,callback:null,next:null}}function Ka(l,h,m){var w=l.updateQueue;if(w===null)return null;if(w=w.shared,Ot&2){var E=w.pending;return E===null?h.next=h:(h.next=E.next,E.next=h),w.pending=h,Jo(l,m)}return E=w.interleaved,E===null?(h.next=h,Sy(w)):(h.next=E.next,E.next=h),w.interleaved=h,Jo(l,m)}function mf(l,h,m){if(h=h.updateQueue,h!==null&&(h=h.shared,(m&4194240)!==0)){var w=h.lanes;w&=l.pendingLanes,m|=w,h.lanes=m,Fa(l,m)}}function SE(l,h){var m=l.updateQueue,w=l.alternate;if(w!==null&&(w=w.updateQueue,m===w)){var E=null,k=null;if(m=m.firstBaseUpdate,m!==null){do{var V={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};k===null?E=k=V:k=k.next=V,m=m.next}while(m!==null);k===null?E=k=h:k=k.next=h}else E=k=h;m={baseState:w.baseState,firstBaseUpdate:E,lastBaseUpdate:k,shared:w.shared,effects:w.effects},l.updateQueue=m;return}l=m.lastBaseUpdate,l===null?m.firstBaseUpdate=h:l.next=h,m.lastBaseUpdate=h}function gf(l,h,m,w){var E=l.updateQueue;Ga=!1;var k=E.firstBaseUpdate,V=E.lastBaseUpdate,$=E.shared.pending;if($!==null){E.shared.pending=null;var Q=$,le=Q.next;Q.next=null,V===null?k=le:V.next=le,V=Q;var xe=l.alternate;xe!==null&&(xe=xe.updateQueue,$=xe.lastBaseUpdate,$!==V&&($===null?xe.firstBaseUpdate=le:$.next=le,xe.lastBaseUpdate=Q))}if(k!==null){var Ie=E.baseState;V=0,xe=le=Q=null,$=k;do{var we=$.lane,Pe=$.eventTime;if((w&we)===we){xe!==null&&(xe=xe.next={eventTime:Pe,lane:0,tag:$.tag,payload:$.payload,callback:$.callback,next:null});e:{var Be=l,We=$;switch(we=h,Pe=m,We.tag){case 1:if(Be=We.payload,typeof Be=="function"){Ie=Be.call(Pe,Ie,we);break e}Ie=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=We.payload,we=typeof Be=="function"?Be.call(Pe,Ie,we):Be,we==null)break e;Ie=J({},Ie,we);break e;case 2:Ga=!0}}$.callback!==null&&$.lane!==0&&(l.flags|=64,we=E.effects,we===null?E.effects=[$]:we.push($))}else Pe={eventTime:Pe,lane:we,tag:$.tag,payload:$.payload,callback:$.callback,next:null},xe===null?(le=xe=Pe,Q=Ie):xe=xe.next=Pe,V|=we;if($=$.next,$===null){if($=E.shared.pending,$===null)break;we=$,$=we.next,we.next=null,E.lastBaseUpdate=we,E.shared.pending=null}}while(!0);if(xe===null&&(Q=Ie),E.baseState=Q,E.firstBaseUpdate=le,E.lastBaseUpdate=xe,h=E.shared.interleaved,h!==null){E=h;do V|=E.lane,E=E.next;while(E!==h)}else k===null&&(E.shared.lanes=0);cu|=V,l.lanes=V,l.memoizedState=Ie}}function TE(l,h,m){if(l=h.effects,h.effects=null,l!==null)for(h=0;h<l.length;h++){var w=l[h],E=w.callback;if(E!==null){if(w.callback=null,w=m,typeof E!="function")throw Error(e(191,E));E.call(w)}}}var Nh={},mo=qa(Nh),Dh=qa(Nh),Oh=qa(Nh);function uu(l){if(l===Nh)throw Error(e(174));return l}function Ay(l,h){switch(Gt(Oh,h),Gt(Dh,l),Gt(mo,Nh),l=h.nodeType,l){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:Lt(null,"");break;default:l=l===8?h.parentNode:h,h=l.namespaceURI||null,l=l.tagName,h=Lt(h,l)}Jt(mo),Gt(mo,h)}function Hl(){Jt(mo),Jt(Dh),Jt(Oh)}function AE(l){uu(Oh.current);var h=uu(mo.current),m=Lt(h,l.type);h!==m&&(Gt(Dh,l),Gt(mo,m))}function Ry(l){Dh.current===l&&(Jt(mo),Jt(Dh))}var un=qa(0);function vf(l){for(var h=l;h!==null;){if(h.tag===13){var m=h.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if(h.flags&128)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var ky=[];function Ny(){for(var l=0;l<ky.length;l++)ky[l]._workInProgressVersionPrimary=null;ky.length=0}var yf=D.ReactCurrentDispatcher,Dy=D.ReactCurrentBatchConfig,lu=0,ln=null,Pn=null,Hn=null,wf=!1,Ph=!1,Mh=0,PM=0;function dr(){throw Error(e(321))}function Oy(l,h){if(h===null)return!1;for(var m=0;m<h.length&&m<l.length;m++)if(!zi(l[m],h[m]))return!1;return!0}function Py(l,h,m,w,E,k){if(lu=k,ln=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,yf.current=l===null||l.memoizedState===null?zM:VM,l=m(w,E),Ph){k=0;do{if(Ph=!1,Mh=0,25<=k)throw Error(e(301));k+=1,Hn=Pn=null,h.updateQueue=null,yf.current=BM,l=m(w,E)}while(Ph)}if(yf.current=_f,h=Pn!==null&&Pn.next!==null,lu=0,Hn=Pn=ln=null,wf=!1,h)throw Error(e(300));return l}function My(){var l=Mh!==0;return Mh=0,l}function go(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hn===null?ln.memoizedState=Hn=l:Hn=Hn.next=l,Hn}function xi(){if(Pn===null){var l=ln.alternate;l=l!==null?l.memoizedState:null}else l=Pn.next;var h=Hn===null?ln.memoizedState:Hn.next;if(h!==null)Hn=h,Pn=l;else{if(l===null)throw Error(e(310));Pn=l,l={memoizedState:Pn.memoizedState,baseState:Pn.baseState,baseQueue:Pn.baseQueue,queue:Pn.queue,next:null},Hn===null?ln.memoizedState=Hn=l:Hn=Hn.next=l}return Hn}function Lh(l,h){return typeof h=="function"?h(l):h}function Ly(l){var h=xi(),m=h.queue;if(m===null)throw Error(e(311));m.lastRenderedReducer=l;var w=Pn,E=w.baseQueue,k=m.pending;if(k!==null){if(E!==null){var V=E.next;E.next=k.next,k.next=V}w.baseQueue=E=k,m.pending=null}if(E!==null){k=E.next,w=w.baseState;var $=V=null,Q=null,le=k;do{var xe=le.lane;if((lu&xe)===xe)Q!==null&&(Q=Q.next={lane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),w=le.hasEagerState?le.eagerState:l(w,le.action);else{var Ie={lane:xe,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null};Q===null?($=Q=Ie,V=w):Q=Q.next=Ie,ln.lanes|=xe,cu|=xe}le=le.next}while(le!==null&&le!==k);Q===null?V=w:Q.next=$,zi(w,h.memoizedState)||(Mr=!0),h.memoizedState=w,h.baseState=V,h.baseQueue=Q,m.lastRenderedState=w}if(l=m.interleaved,l!==null){E=l;do k=E.lane,ln.lanes|=k,cu|=k,E=E.next;while(E!==l)}else E===null&&(m.lanes=0);return[h.memoizedState,m.dispatch]}function Fy(l){var h=xi(),m=h.queue;if(m===null)throw Error(e(311));m.lastRenderedReducer=l;var w=m.dispatch,E=m.pending,k=h.memoizedState;if(E!==null){m.pending=null;var V=E=E.next;do k=l(k,V.action),V=V.next;while(V!==E);zi(k,h.memoizedState)||(Mr=!0),h.memoizedState=k,h.baseQueue===null&&(h.baseState=k),m.lastRenderedState=k}return[k,w]}function RE(){}function kE(l,h){var m=ln,w=xi(),E=h(),k=!zi(w.memoizedState,E);if(k&&(w.memoizedState=E,Mr=!0),w=w.queue,zy(OE.bind(null,m,w,l),[l]),w.getSnapshot!==h||k||Hn!==null&&Hn.memoizedState.tag&1){if(m.flags|=2048,Fh(9,DE.bind(null,m,w,E,h),void 0,null),$n===null)throw Error(e(349));lu&30||NE(m,h,E)}return E}function NE(l,h,m){l.flags|=16384,l={getSnapshot:h,value:m},h=ln.updateQueue,h===null?(h={lastEffect:null,stores:null},ln.updateQueue=h,h.stores=[l]):(m=h.stores,m===null?h.stores=[l]:m.push(l))}function DE(l,h,m,w){h.value=m,h.getSnapshot=w,PE(h)&&ME(l)}function OE(l,h,m){return m(function(){PE(h)&&ME(l)})}function PE(l){var h=l.getSnapshot;l=l.value;try{var m=h();return!zi(l,m)}catch{return!0}}function ME(l){var h=Jo(l,1);h!==null&&Wi(h,l,1,-1)}function LE(l){var h=go();return typeof l=="function"&&(l=l()),h.memoizedState=h.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lh,lastRenderedState:l},h.queue=l,l=l.dispatch=FM.bind(null,ln,l),[h.memoizedState,l]}function Fh(l,h,m,w){return l={tag:l,create:h,destroy:m,deps:w,next:null},h=ln.updateQueue,h===null?(h={lastEffect:null,stores:null},ln.updateQueue=h,h.lastEffect=l.next=l):(m=h.lastEffect,m===null?h.lastEffect=l.next=l:(w=m.next,m.next=l,l.next=w,h.lastEffect=l)),l}function FE(){return xi().memoizedState}function bf(l,h,m,w){var E=go();ln.flags|=l,E.memoizedState=Fh(1|h,m,void 0,w===void 0?null:w)}function xf(l,h,m,w){var E=xi();w=w===void 0?null:w;var k=void 0;if(Pn!==null){var V=Pn.memoizedState;if(k=V.destroy,w!==null&&Oy(w,V.deps)){E.memoizedState=Fh(h,m,k,w);return}}ln.flags|=l,E.memoizedState=Fh(1|h,m,k,w)}function zE(l,h){return bf(8390656,8,l,h)}function zy(l,h){return xf(2048,8,l,h)}function VE(l,h){return xf(4,2,l,h)}function BE(l,h){return xf(4,4,l,h)}function UE(l,h){if(typeof h=="function")return l=l(),h(l),function(){h(null)};if(h!=null)return l=l(),h.current=l,function(){h.current=null}}function jE(l,h,m){return m=m!=null?m.concat([l]):null,xf(4,4,UE.bind(null,h,l),m)}function Vy(){}function WE(l,h){var m=xi();h=h===void 0?null:h;var w=m.memoizedState;return w!==null&&h!==null&&Oy(h,w[1])?w[0]:(m.memoizedState=[l,h],l)}function qE(l,h){var m=xi();h=h===void 0?null:h;var w=m.memoizedState;return w!==null&&h!==null&&Oy(h,w[1])?w[0]:(l=l(),m.memoizedState=[l,h],l)}function HE(l,h,m){return lu&21?(zi(m,h)||(m=Js(),ln.lanes|=m,cu|=m,l.baseState=!0),h):(l.baseState&&(l.baseState=!1,Mr=!0),l.memoizedState=m)}function MM(l,h){var m=Tt;Tt=m!==0&&4>m?m:4,l(!0);var w=Dy.transition;Dy.transition={};try{l(!1),h()}finally{Tt=m,Dy.transition=w}}function $E(){return xi().memoizedState}function LM(l,h,m){var w=Ja(l);if(m={lane:w,action:m,hasEagerState:!1,eagerState:null,next:null},GE(l))KE(h,m);else if(m=IE(l,h,m,w),m!==null){var E=Cr();Wi(m,l,w,E),XE(m,h,w)}}function FM(l,h,m){var w=Ja(l),E={lane:w,action:m,hasEagerState:!1,eagerState:null,next:null};if(GE(l))KE(h,E);else{var k=l.alternate;if(l.lanes===0&&(k===null||k.lanes===0)&&(k=h.lastRenderedReducer,k!==null))try{var V=h.lastRenderedState,$=k(V,m);if(E.hasEagerState=!0,E.eagerState=$,zi($,V)){var Q=h.interleaved;Q===null?(E.next=E,Sy(h)):(E.next=Q.next,Q.next=E),h.interleaved=E;return}}catch{}finally{}m=IE(l,h,E,w),m!==null&&(E=Cr(),Wi(m,l,w,E),XE(m,h,w))}}function GE(l){var h=l.alternate;return l===ln||h!==null&&h===ln}function KE(l,h){Ph=wf=!0;var m=l.pending;m===null?h.next=h:(h.next=m.next,m.next=h),l.pending=h}function XE(l,h,m){if(m&4194240){var w=h.lanes;w&=l.pendingLanes,m|=w,h.lanes=m,Fa(l,m)}}var _f={readContext:bi,useCallback:dr,useContext:dr,useEffect:dr,useImperativeHandle:dr,useInsertionEffect:dr,useLayoutEffect:dr,useMemo:dr,useReducer:dr,useRef:dr,useState:dr,useDebugValue:dr,useDeferredValue:dr,useTransition:dr,useMutableSource:dr,useSyncExternalStore:dr,useId:dr,unstable_isNewReconciler:!1},zM={readContext:bi,useCallback:function(l,h){return go().memoizedState=[l,h===void 0?null:h],l},useContext:bi,useEffect:zE,useImperativeHandle:function(l,h,m){return m=m!=null?m.concat([l]):null,bf(4194308,4,UE.bind(null,h,l),m)},useLayoutEffect:function(l,h){return bf(4194308,4,l,h)},useInsertionEffect:function(l,h){return bf(4,2,l,h)},useMemo:function(l,h){var m=go();return h=h===void 0?null:h,l=l(),m.memoizedState=[l,h],l},useReducer:function(l,h,m){var w=go();return h=m!==void 0?m(h):h,w.memoizedState=w.baseState=h,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:h},w.queue=l,l=l.dispatch=LM.bind(null,ln,l),[w.memoizedState,l]},useRef:function(l){var h=go();return l={current:l},h.memoizedState=l},useState:LE,useDebugValue:Vy,useDeferredValue:function(l){return go().memoizedState=l},useTransition:function(){var l=LE(!1),h=l[0];return l=MM.bind(null,l[1]),go().memoizedState=l,[h,l]},useMutableSource:function(){},useSyncExternalStore:function(l,h,m){var w=ln,E=go();if(rn){if(m===void 0)throw Error(e(407));m=m()}else{if(m=h(),$n===null)throw Error(e(349));lu&30||NE(w,h,m)}E.memoizedState=m;var k={value:m,getSnapshot:h};return E.queue=k,zE(OE.bind(null,w,k,l),[l]),w.flags|=2048,Fh(9,DE.bind(null,w,k,m,h),void 0,null),m},useId:function(){var l=go(),h=$n.identifierPrefix;if(rn){var m=Yo,w=Qo;m=(w&~(1<<32-_r(w)-1)).toString(32)+m,h=":"+h+"R"+m,m=Mh++,0<m&&(h+="H"+m.toString(32)),h+=":"}else m=PM++,h=":"+h+"r"+m.toString(32)+":";return l.memoizedState=h},unstable_isNewReconciler:!1},VM={readContext:bi,useCallback:WE,useContext:bi,useEffect:zy,useImperativeHandle:jE,useInsertionEffect:VE,useLayoutEffect:BE,useMemo:qE,useReducer:Ly,useRef:FE,useState:function(){return Ly(Lh)},useDebugValue:Vy,useDeferredValue:function(l){var h=xi();return HE(h,Pn.memoizedState,l)},useTransition:function(){var l=Ly(Lh)[0],h=xi().memoizedState;return[l,h]},useMutableSource:RE,useSyncExternalStore:kE,useId:$E,unstable_isNewReconciler:!1},BM={readContext:bi,useCallback:WE,useContext:bi,useEffect:zy,useImperativeHandle:jE,useInsertionEffect:VE,useLayoutEffect:BE,useMemo:qE,useReducer:Fy,useRef:FE,useState:function(){return Fy(Lh)},useDebugValue:Vy,useDeferredValue:function(l){var h=xi();return Pn===null?h.memoizedState=l:HE(h,Pn.memoizedState,l)},useTransition:function(){var l=Fy(Lh)[0],h=xi().memoizedState;return[l,h]},useMutableSource:RE,useSyncExternalStore:kE,useId:$E,unstable_isNewReconciler:!1};function Bi(l,h){if(l&&l.defaultProps){h=J({},h),l=l.defaultProps;for(var m in l)h[m]===void 0&&(h[m]=l[m]);return h}return h}function By(l,h,m,w){h=l.memoizedState,m=m(w,h),m=m==null?h:J({},h,m),l.memoizedState=m,l.lanes===0&&(l.updateQueue.baseState=m)}var Ef={isMounted:function(l){return(l=l._reactInternals)?Ni(l)===l:!1},enqueueSetState:function(l,h,m){l=l._reactInternals;var w=Cr(),E=Ja(l),k=Zo(w,E);k.payload=h,m!=null&&(k.callback=m),h=Ka(l,k,E),h!==null&&(Wi(h,l,E,w),mf(h,l,E))},enqueueReplaceState:function(l,h,m){l=l._reactInternals;var w=Cr(),E=Ja(l),k=Zo(w,E);k.tag=1,k.payload=h,m!=null&&(k.callback=m),h=Ka(l,k,E),h!==null&&(Wi(h,l,E,w),mf(h,l,E))},enqueueForceUpdate:function(l,h){l=l._reactInternals;var m=Cr(),w=Ja(l),E=Zo(m,w);E.tag=2,h!=null&&(E.callback=h),h=Ka(l,E,w),h!==null&&(Wi(h,l,w,m),mf(h,l,w))}};function QE(l,h,m,w,E,k,V){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(w,k,V):h.prototype&&h.prototype.isPureReactComponent?!Eh(m,w)||!Eh(E,k):!0}function YE(l,h,m){var w=!1,E=Ha,k=h.contextType;return typeof k=="object"&&k!==null?k=bi(k):(E=Pr(h)?iu:hr.current,w=h.contextTypes,k=(w=w!=null)?zl(l,E):Ha),h=new h(m,k),l.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Ef,l.stateNode=h,h._reactInternals=l,w&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=E,l.__reactInternalMemoizedMaskedChildContext=k),h}function JE(l,h,m,w){l=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(m,w),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(m,w),h.state!==l&&Ef.enqueueReplaceState(h,h.state,null)}function Uy(l,h,m,w){var E=l.stateNode;E.props=m,E.state=l.memoizedState,E.refs={},Ty(l);var k=h.contextType;typeof k=="object"&&k!==null?E.context=bi(k):(k=Pr(h)?iu:hr.current,E.context=zl(l,k)),E.state=l.memoizedState,k=h.getDerivedStateFromProps,typeof k=="function"&&(By(l,h,k,m),E.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(h=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),h!==E.state&&Ef.enqueueReplaceState(E,E.state,null),gf(l,m,E,w),E.state=l.memoizedState),typeof E.componentDidMount=="function"&&(l.flags|=4194308)}function $l(l,h){try{var m="",w=h;do m+=Te(w),w=w.return;while(w);var E=m}catch(k){E=`
Error generating stack: `+k.message+`
`+k.stack}return{value:l,source:h,stack:E,digest:null}}function jy(l,h,m){return{value:l,source:null,stack:m??null,digest:h??null}}function Wy(l,h){try{console.error(h.value)}catch(m){setTimeout(function(){throw m})}}var UM=typeof WeakMap=="function"?WeakMap:Map;function ZE(l,h,m){m=Zo(-1,m),m.tag=3,m.payload={element:null};var w=h.value;return m.callback=function(){kf||(kf=!0,i0=w),Wy(l,h)},m}function eI(l,h,m){m=Zo(-1,m),m.tag=3;var w=l.type.getDerivedStateFromError;if(typeof w=="function"){var E=h.value;m.payload=function(){return w(E)},m.callback=function(){Wy(l,h)}}var k=l.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(m.callback=function(){Wy(l,h),typeof w!="function"&&(Qa===null?Qa=new Set([this]):Qa.add(this));var V=h.stack;this.componentDidCatch(h.value,{componentStack:V!==null?V:""})}),m}function tI(l,h,m){var w=l.pingCache;if(w===null){w=l.pingCache=new UM;var E=new Set;w.set(h,E)}else E=w.get(h),E===void 0&&(E=new Set,w.set(h,E));E.has(m)||(E.add(m),l=tL.bind(null,l,h,m),h.then(l,l))}function nI(l){do{var h;if((h=l.tag===13)&&(h=l.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return l;l=l.return}while(l!==null);return null}function rI(l,h,m,w,E){return l.mode&1?(l.flags|=65536,l.lanes=E,l):(l===h?l.flags|=65536:(l.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(h=Zo(-1,1),h.tag=2,Ka(m,h,1))),m.lanes|=1),l)}var jM=D.ReactCurrentOwner,Mr=!1;function Ir(l,h,m,w){h.child=l===null?EE(h,null,m,w):jl(h,l.child,m,w)}function iI(l,h,m,w,E){m=m.render;var k=h.ref;return ql(h,E),w=Py(l,h,m,w,k,E),m=My(),l!==null&&!Mr?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~E,ea(l,h,E)):(rn&&m&&vy(h),h.flags|=1,Ir(l,h,w,E),h.child)}function oI(l,h,m,w,E){if(l===null){var k=m.type;return typeof k=="function"&&!h0(k)&&k.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(h.tag=15,h.type=k,aI(l,h,k,w,E)):(l=Lf(m.type,null,w,h,h.mode,E),l.ref=h.ref,l.return=h,h.child=l)}if(k=l.child,!(l.lanes&E)){var V=k.memoizedProps;if(m=m.compare,m=m!==null?m:Eh,m(V,w)&&l.ref===h.ref)return ea(l,h,E)}return h.flags|=1,l=es(k,w),l.ref=h.ref,l.return=h,h.child=l}function aI(l,h,m,w,E){if(l!==null){var k=l.memoizedProps;if(Eh(k,w)&&l.ref===h.ref)if(Mr=!1,h.pendingProps=w=k,(l.lanes&E)!==0)l.flags&131072&&(Mr=!0);else return h.lanes=l.lanes,ea(l,h,E)}return qy(l,h,m,w,E)}function sI(l,h,m){var w=h.pendingProps,E=w.children,k=l!==null?l.memoizedState:null;if(w.mode==="hidden")if(!(h.mode&1))h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gt(Kl,ti),ti|=m;else{if(!(m&1073741824))return l=k!==null?k.baseLanes|m:m,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:l,cachePool:null,transitions:null},h.updateQueue=null,Gt(Kl,ti),ti|=l,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},w=k!==null?k.baseLanes:m,Gt(Kl,ti),ti|=w}else k!==null?(w=k.baseLanes|m,h.memoizedState=null):w=m,Gt(Kl,ti),ti|=w;return Ir(l,h,E,m),h.child}function uI(l,h){var m=h.ref;(l===null&&m!==null||l!==null&&l.ref!==m)&&(h.flags|=512,h.flags|=2097152)}function qy(l,h,m,w,E){var k=Pr(m)?iu:hr.current;return k=zl(h,k),ql(h,E),m=Py(l,h,m,w,k,E),w=My(),l!==null&&!Mr?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~E,ea(l,h,E)):(rn&&w&&vy(h),h.flags|=1,Ir(l,h,m,E),h.child)}function lI(l,h,m,w,E){if(Pr(m)){var k=!0;sf(h)}else k=!1;if(ql(h,E),h.stateNode===null)Cf(l,h),YE(h,m,w),Uy(h,m,w,E),w=!0;else if(l===null){var V=h.stateNode,$=h.memoizedProps;V.props=$;var Q=V.context,le=m.contextType;typeof le=="object"&&le!==null?le=bi(le):(le=Pr(m)?iu:hr.current,le=zl(h,le));var xe=m.getDerivedStateFromProps,Ie=typeof xe=="function"||typeof V.getSnapshotBeforeUpdate=="function";Ie||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||($!==w||Q!==le)&&JE(h,V,w,le),Ga=!1;var we=h.memoizedState;V.state=we,gf(h,w,V,E),Q=h.memoizedState,$!==w||we!==Q||Or.current||Ga?(typeof xe=="function"&&(By(h,m,xe,w),Q=h.memoizedState),($=Ga||QE(h,m,$,w,we,Q,le))?(Ie||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount()),typeof V.componentDidMount=="function"&&(h.flags|=4194308)):(typeof V.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=w,h.memoizedState=Q),V.props=w,V.state=Q,V.context=le,w=$):(typeof V.componentDidMount=="function"&&(h.flags|=4194308),w=!1)}else{V=h.stateNode,CE(l,h),$=h.memoizedProps,le=h.type===h.elementType?$:Bi(h.type,$),V.props=le,Ie=h.pendingProps,we=V.context,Q=m.contextType,typeof Q=="object"&&Q!==null?Q=bi(Q):(Q=Pr(m)?iu:hr.current,Q=zl(h,Q));var Pe=m.getDerivedStateFromProps;(xe=typeof Pe=="function"||typeof V.getSnapshotBeforeUpdate=="function")||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||($!==Ie||we!==Q)&&JE(h,V,w,Q),Ga=!1,we=h.memoizedState,V.state=we,gf(h,w,V,E);var Be=h.memoizedState;$!==Ie||we!==Be||Or.current||Ga?(typeof Pe=="function"&&(By(h,m,Pe,w),Be=h.memoizedState),(le=Ga||QE(h,m,le,w,we,Be,Q)||!1)?(xe||typeof V.UNSAFE_componentWillUpdate!="function"&&typeof V.componentWillUpdate!="function"||(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(w,Be,Q),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(w,Be,Q)),typeof V.componentDidUpdate=="function"&&(h.flags|=4),typeof V.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof V.componentDidUpdate!="function"||$===l.memoizedProps&&we===l.memoizedState||(h.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||$===l.memoizedProps&&we===l.memoizedState||(h.flags|=1024),h.memoizedProps=w,h.memoizedState=Be),V.props=w,V.state=Be,V.context=Q,w=le):(typeof V.componentDidUpdate!="function"||$===l.memoizedProps&&we===l.memoizedState||(h.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||$===l.memoizedProps&&we===l.memoizedState||(h.flags|=1024),w=!1)}return Hy(l,h,m,w,k,E)}function Hy(l,h,m,w,E,k){uI(l,h);var V=(h.flags&128)!==0;if(!w&&!V)return E&&fE(h,m,!1),ea(l,h,k);w=h.stateNode,jM.current=h;var $=V&&typeof m.getDerivedStateFromError!="function"?null:w.render();return h.flags|=1,l!==null&&V?(h.child=jl(h,l.child,null,k),h.child=jl(h,null,$,k)):Ir(l,h,$,k),h.memoizedState=w.state,E&&fE(h,m,!0),h.child}function cI(l){var h=l.stateNode;h.pendingContext?dE(l,h.pendingContext,h.pendingContext!==h.context):h.context&&dE(l,h.context,!1),Ay(l,h.containerInfo)}function hI(l,h,m,w,E){return Ul(),xy(E),h.flags|=256,Ir(l,h,m,w),h.child}var $y={dehydrated:null,treeContext:null,retryLane:0};function Gy(l){return{baseLanes:l,cachePool:null,transitions:null}}function dI(l,h,m){var w=h.pendingProps,E=un.current,k=!1,V=(h.flags&128)!==0,$;if(($=V)||($=l!==null&&l.memoizedState===null?!1:(E&2)!==0),$?(k=!0,h.flags&=-129):(l===null||l.memoizedState!==null)&&(E|=1),Gt(un,E&1),l===null)return by(h),l=h.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?(h.mode&1?l.data==="$!"?h.lanes=8:h.lanes=1073741824:h.lanes=1,null):(V=w.children,l=w.fallback,k?(w=h.mode,k=h.child,V={mode:"hidden",children:V},!(w&1)&&k!==null?(k.childLanes=0,k.pendingProps=V):k=Ff(V,w,0,null),l=fu(l,w,m,null),k.return=h,l.return=h,k.sibling=l,h.child=k,h.child.memoizedState=Gy(m),h.memoizedState=$y,l):Ky(h,V));if(E=l.memoizedState,E!==null&&($=E.dehydrated,$!==null))return WM(l,h,V,w,$,E,m);if(k){k=w.fallback,V=h.mode,E=l.child,$=E.sibling;var Q={mode:"hidden",children:w.children};return!(V&1)&&h.child!==E?(w=h.child,w.childLanes=0,w.pendingProps=Q,h.deletions=null):(w=es(E,Q),w.subtreeFlags=E.subtreeFlags&14680064),$!==null?k=es($,k):(k=fu(k,V,m,null),k.flags|=2),k.return=h,w.return=h,w.sibling=k,h.child=w,w=k,k=h.child,V=l.child.memoizedState,V=V===null?Gy(m):{baseLanes:V.baseLanes|m,cachePool:null,transitions:V.transitions},k.memoizedState=V,k.childLanes=l.childLanes&~m,h.memoizedState=$y,w}return k=l.child,l=k.sibling,w=es(k,{mode:"visible",children:w.children}),!(h.mode&1)&&(w.lanes=m),w.return=h,w.sibling=null,l!==null&&(m=h.deletions,m===null?(h.deletions=[l],h.flags|=16):m.push(l)),h.child=w,h.memoizedState=null,w}function Ky(l,h){return h=Ff({mode:"visible",children:h},l.mode,0,null),h.return=l,l.child=h}function If(l,h,m,w){return w!==null&&xy(w),jl(h,l.child,null,m),l=Ky(h,h.pendingProps.children),l.flags|=2,h.memoizedState=null,l}function WM(l,h,m,w,E,k,V){if(m)return h.flags&256?(h.flags&=-257,w=jy(Error(e(422))),If(l,h,V,w)):h.memoizedState!==null?(h.child=l.child,h.flags|=128,null):(k=w.fallback,E=h.mode,w=Ff({mode:"visible",children:w.children},E,0,null),k=fu(k,E,V,null),k.flags|=2,w.return=h,k.return=h,w.sibling=k,h.child=w,h.mode&1&&jl(h,l.child,null,V),h.child.memoizedState=Gy(V),h.memoizedState=$y,k);if(!(h.mode&1))return If(l,h,V,null);if(E.data==="$!"){if(w=E.nextSibling&&E.nextSibling.dataset,w)var $=w.dgst;return w=$,k=Error(e(419)),w=jy(k,w,void 0),If(l,h,V,w)}if($=(V&l.childLanes)!==0,Mr||$){if(w=$n,w!==null){switch(V&-V){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=E&(w.suspendedLanes|V)?0:E,E!==0&&E!==k.retryLane&&(k.retryLane=E,Jo(l,E),Wi(w,l,E,-1))}return c0(),w=jy(Error(e(421))),If(l,h,V,w)}return E.data==="$?"?(h.flags|=128,h.child=l.child,h=nL.bind(null,l),E._reactRetry=h,null):(l=k.treeContext,ei=Wa(E.nextSibling),Zr=h,rn=!0,Vi=null,l!==null&&(yi[wi++]=Qo,yi[wi++]=Yo,yi[wi++]=ou,Qo=l.id,Yo=l.overflow,ou=h),h=Ky(h,w.children),h.flags|=4096,h)}function pI(l,h,m){l.lanes|=h;var w=l.alternate;w!==null&&(w.lanes|=h),Cy(l.return,h,m)}function Xy(l,h,m,w,E){var k=l.memoizedState;k===null?l.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:w,tail:m,tailMode:E}:(k.isBackwards=h,k.rendering=null,k.renderingStartTime=0,k.last=w,k.tail=m,k.tailMode=E)}function fI(l,h,m){var w=h.pendingProps,E=w.revealOrder,k=w.tail;if(Ir(l,h,w.children,m),w=un.current,w&2)w=w&1|2,h.flags|=128;else{if(l!==null&&l.flags&128)e:for(l=h.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&pI(l,m,h);else if(l.tag===19)pI(l,m,h);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===h)break e;for(;l.sibling===null;){if(l.return===null||l.return===h)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}w&=1}if(Gt(un,w),!(h.mode&1))h.memoizedState=null;else switch(E){case"forwards":for(m=h.child,E=null;m!==null;)l=m.alternate,l!==null&&vf(l)===null&&(E=m),m=m.sibling;m=E,m===null?(E=h.child,h.child=null):(E=m.sibling,m.sibling=null),Xy(h,!1,E,m,k);break;case"backwards":for(m=null,E=h.child,h.child=null;E!==null;){if(l=E.alternate,l!==null&&vf(l)===null){h.child=E;break}l=E.sibling,E.sibling=m,m=E,E=l}Xy(h,!0,m,null,k);break;case"together":Xy(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Cf(l,h){!(h.mode&1)&&l!==null&&(l.alternate=null,h.alternate=null,h.flags|=2)}function ea(l,h,m){if(l!==null&&(h.dependencies=l.dependencies),cu|=h.lanes,!(m&h.childLanes))return null;if(l!==null&&h.child!==l.child)throw Error(e(153));if(h.child!==null){for(l=h.child,m=es(l,l.pendingProps),h.child=m,m.return=h;l.sibling!==null;)l=l.sibling,m=m.sibling=es(l,l.pendingProps),m.return=h;m.sibling=null}return h.child}function qM(l,h,m){switch(h.tag){case 3:cI(h),Ul();break;case 5:AE(h);break;case 1:Pr(h.type)&&sf(h);break;case 4:Ay(h,h.stateNode.containerInfo);break;case 10:var w=h.type._context,E=h.memoizedProps.value;Gt(pf,w._currentValue),w._currentValue=E;break;case 13:if(w=h.memoizedState,w!==null)return w.dehydrated!==null?(Gt(un,un.current&1),h.flags|=128,null):m&h.child.childLanes?dI(l,h,m):(Gt(un,un.current&1),l=ea(l,h,m),l!==null?l.sibling:null);Gt(un,un.current&1);break;case 19:if(w=(m&h.childLanes)!==0,l.flags&128){if(w)return fI(l,h,m);h.flags|=128}if(E=h.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Gt(un,un.current),w)break;return null;case 22:case 23:return h.lanes=0,sI(l,h,m)}return ea(l,h,m)}var mI,Qy,gI,vI;mI=function(l,h){for(var m=h.child;m!==null;){if(m.tag===5||m.tag===6)l.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},Qy=function(){},gI=function(l,h,m,w){var E=l.memoizedProps;if(E!==w){l=h.stateNode,uu(mo.current);var k=null;switch(m){case"input":E=et(l,E),w=et(l,w),k=[];break;case"select":E=J({},E,{value:void 0}),w=J({},w,{value:void 0}),k=[];break;case"textarea":E=jn(l,E),w=jn(l,w),k=[];break;default:typeof E.onClick!="function"&&typeof w.onClick=="function"&&(l.onclick=rf)}Bo(m,w);var V;m=null;for(le in E)if(!w.hasOwnProperty(le)&&E.hasOwnProperty(le)&&E[le]!=null)if(le==="style"){var $=E[le];for(V in $)$.hasOwnProperty(V)&&(m||(m={}),m[V]="")}else le!=="dangerouslySetInnerHTML"&&le!=="children"&&le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&le!=="autoFocus"&&(i.hasOwnProperty(le)?k||(k=[]):(k=k||[]).push(le,null));for(le in w){var Q=w[le];if($=E!=null?E[le]:void 0,w.hasOwnProperty(le)&&Q!==$&&(Q!=null||$!=null))if(le==="style")if($){for(V in $)!$.hasOwnProperty(V)||Q&&Q.hasOwnProperty(V)||(m||(m={}),m[V]="");for(V in Q)Q.hasOwnProperty(V)&&$[V]!==Q[V]&&(m||(m={}),m[V]=Q[V])}else m||(k||(k=[]),k.push(le,m)),m=Q;else le==="dangerouslySetInnerHTML"?(Q=Q?Q.__html:void 0,$=$?$.__html:void 0,Q!=null&&$!==Q&&(k=k||[]).push(le,Q)):le==="children"?typeof Q!="string"&&typeof Q!="number"||(k=k||[]).push(le,""+Q):le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&(i.hasOwnProperty(le)?(Q!=null&&le==="onScroll"&&Yt("scroll",l),k||$===Q||(k=[])):(k=k||[]).push(le,Q))}m&&(k=k||[]).push("style",m);var le=k;(h.updateQueue=le)&&(h.flags|=4)}},vI=function(l,h,m,w){m!==w&&(h.flags|=4)};function zh(l,h){if(!rn)switch(l.tailMode){case"hidden":h=l.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l.tail=null:m.sibling=null;break;case"collapsed":m=l.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?h||l.tail===null?l.tail=null:l.tail.sibling=null:w.sibling=null}}function pr(l){var h=l.alternate!==null&&l.alternate.child===l.child,m=0,w=0;if(h)for(var E=l.child;E!==null;)m|=E.lanes|E.childLanes,w|=E.subtreeFlags&14680064,w|=E.flags&14680064,E.return=l,E=E.sibling;else for(E=l.child;E!==null;)m|=E.lanes|E.childLanes,w|=E.subtreeFlags,w|=E.flags,E.return=l,E=E.sibling;return l.subtreeFlags|=w,l.childLanes=m,h}function HM(l,h,m){var w=h.pendingProps;switch(yy(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pr(h),null;case 1:return Pr(h.type)&&af(),pr(h),null;case 3:return w=h.stateNode,Hl(),Jt(Or),Jt(hr),Ny(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(l===null||l.child===null)&&(hf(h)?h.flags|=4:l===null||l.memoizedState.isDehydrated&&!(h.flags&256)||(h.flags|=1024,Vi!==null&&(s0(Vi),Vi=null))),Qy(l,h),pr(h),null;case 5:Ry(h);var E=uu(Oh.current);if(m=h.type,l!==null&&h.stateNode!=null)gI(l,h,m,w,E),l.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!w){if(h.stateNode===null)throw Error(e(166));return pr(h),null}if(l=uu(mo.current),hf(h)){w=h.stateNode,m=h.type;var k=h.memoizedProps;switch(w[fo]=h,w[Ah]=k,l=(h.mode&1)!==0,m){case"dialog":Yt("cancel",w),Yt("close",w);break;case"iframe":case"object":case"embed":Yt("load",w);break;case"video":case"audio":for(E=0;E<Ch.length;E++)Yt(Ch[E],w);break;case"source":Yt("error",w);break;case"img":case"image":case"link":Yt("error",w),Yt("load",w);break;case"details":Yt("toggle",w);break;case"input":Dt(w,k),Yt("invalid",w);break;case"select":w._wrapperState={wasMultiple:!!k.multiple},Yt("invalid",w);break;case"textarea":at(w,k),Yt("invalid",w)}Bo(m,k),E=null;for(var V in k)if(k.hasOwnProperty(V)){var $=k[V];V==="children"?typeof $=="string"?w.textContent!==$&&(k.suppressHydrationWarning!==!0&&nf(w.textContent,$,l),E=["children",$]):typeof $=="number"&&w.textContent!==""+$&&(k.suppressHydrationWarning!==!0&&nf(w.textContent,$,l),E=["children",""+$]):i.hasOwnProperty(V)&&$!=null&&V==="onScroll"&&Yt("scroll",w)}switch(m){case"input":Ze(w),lr(w,k,!0);break;case"textarea":Ze(w),Qt(w);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(w.onclick=rf)}w=E,h.updateQueue=w,w!==null&&(h.flags|=4)}else{V=E.nodeType===9?E:E.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=bt(m)),l==="http://www.w3.org/1999/xhtml"?m==="script"?(l=V.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof w.is=="string"?l=V.createElement(m,{is:w.is}):(l=V.createElement(m),m==="select"&&(V=l,w.multiple?V.multiple=!0:w.size&&(V.size=w.size))):l=V.createElementNS(l,m),l[fo]=h,l[Ah]=w,mI(l,h,!1,!1),h.stateNode=l;e:{switch(V=Uo(m,w),m){case"dialog":Yt("cancel",l),Yt("close",l),E=w;break;case"iframe":case"object":case"embed":Yt("load",l),E=w;break;case"video":case"audio":for(E=0;E<Ch.length;E++)Yt(Ch[E],l);E=w;break;case"source":Yt("error",l),E=w;break;case"img":case"image":case"link":Yt("error",l),Yt("load",l),E=w;break;case"details":Yt("toggle",l),E=w;break;case"input":Dt(l,w),E=et(l,w),Yt("invalid",l);break;case"option":E=w;break;case"select":l._wrapperState={wasMultiple:!!w.multiple},E=J({},w,{value:void 0}),Yt("invalid",l);break;case"textarea":at(l,w),E=jn(l,w),Yt("invalid",l);break;default:E=w}Bo(m,E),$=E;for(k in $)if($.hasOwnProperty(k)){var Q=$[k];k==="style"?Vo(l,Q):k==="dangerouslySetInnerHTML"?(Q=Q?Q.__html:void 0,Q!=null&&tn(l,Q)):k==="children"?typeof Q=="string"?(m!=="textarea"||Q!=="")&&cr(l,Q):typeof Q=="number"&&cr(l,""+Q):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(i.hasOwnProperty(k)?Q!=null&&k==="onScroll"&&Yt("scroll",l):Q!=null&&T(l,k,Q,V))}switch(m){case"input":Ze(l),lr(l,w,!1);break;case"textarea":Ze(l),Qt(l);break;case"option":w.value!=null&&l.setAttribute("value",""+Oe(w.value));break;case"select":l.multiple=!!w.multiple,k=w.value,k!=null?Ht(l,!!w.multiple,k,!1):w.defaultValue!=null&&Ht(l,!!w.multiple,w.defaultValue,!0);break;default:typeof E.onClick=="function"&&(l.onclick=rf)}switch(m){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}}w&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return pr(h),null;case 6:if(l&&h.stateNode!=null)vI(l,h,l.memoizedProps,w);else{if(typeof w!="string"&&h.stateNode===null)throw Error(e(166));if(m=uu(Oh.current),uu(mo.current),hf(h)){if(w=h.stateNode,m=h.memoizedProps,w[fo]=h,(k=w.nodeValue!==m)&&(l=Zr,l!==null))switch(l.tag){case 3:nf(w.nodeValue,m,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&nf(w.nodeValue,m,(l.mode&1)!==0)}k&&(h.flags|=4)}else w=(m.nodeType===9?m:m.ownerDocument).createTextNode(w),w[fo]=h,h.stateNode=w}return pr(h),null;case 13:if(Jt(un),w=h.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(rn&&ei!==null&&h.mode&1&&!(h.flags&128))bE(),Ul(),h.flags|=98560,k=!1;else if(k=hf(h),w!==null&&w.dehydrated!==null){if(l===null){if(!k)throw Error(e(318));if(k=h.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(e(317));k[fo]=h}else Ul(),!(h.flags&128)&&(h.memoizedState=null),h.flags|=4;pr(h),k=!1}else Vi!==null&&(s0(Vi),Vi=null),k=!0;if(!k)return h.flags&65536?h:null}return h.flags&128?(h.lanes=m,h):(w=w!==null,w!==(l!==null&&l.memoizedState!==null)&&w&&(h.child.flags|=8192,h.mode&1&&(l===null||un.current&1?Mn===0&&(Mn=3):c0())),h.updateQueue!==null&&(h.flags|=4),pr(h),null);case 4:return Hl(),Qy(l,h),l===null&&Sh(h.stateNode.containerInfo),pr(h),null;case 10:return Iy(h.type._context),pr(h),null;case 17:return Pr(h.type)&&af(),pr(h),null;case 19:if(Jt(un),k=h.memoizedState,k===null)return pr(h),null;if(w=(h.flags&128)!==0,V=k.rendering,V===null)if(w)zh(k,!1);else{if(Mn!==0||l!==null&&l.flags&128)for(l=h.child;l!==null;){if(V=vf(l),V!==null){for(h.flags|=128,zh(k,!1),w=V.updateQueue,w!==null&&(h.updateQueue=w,h.flags|=4),h.subtreeFlags=0,w=m,m=h.child;m!==null;)k=m,l=w,k.flags&=14680066,V=k.alternate,V===null?(k.childLanes=0,k.lanes=l,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=V.childLanes,k.lanes=V.lanes,k.child=V.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=V.memoizedProps,k.memoizedState=V.memoizedState,k.updateQueue=V.updateQueue,k.type=V.type,l=V.dependencies,k.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),m=m.sibling;return Gt(un,un.current&1|2),h.child}l=l.sibling}k.tail!==null&&$t()>Xl&&(h.flags|=128,w=!0,zh(k,!1),h.lanes=4194304)}else{if(!w)if(l=vf(V),l!==null){if(h.flags|=128,w=!0,m=l.updateQueue,m!==null&&(h.updateQueue=m,h.flags|=4),zh(k,!0),k.tail===null&&k.tailMode==="hidden"&&!V.alternate&&!rn)return pr(h),null}else 2*$t()-k.renderingStartTime>Xl&&m!==1073741824&&(h.flags|=128,w=!0,zh(k,!1),h.lanes=4194304);k.isBackwards?(V.sibling=h.child,h.child=V):(m=k.last,m!==null?m.sibling=V:h.child=V,k.last=V)}return k.tail!==null?(h=k.tail,k.rendering=h,k.tail=h.sibling,k.renderingStartTime=$t(),h.sibling=null,m=un.current,Gt(un,w?m&1|2:m&1),h):(pr(h),null);case 22:case 23:return l0(),w=h.memoizedState!==null,l!==null&&l.memoizedState!==null!==w&&(h.flags|=8192),w&&h.mode&1?ti&1073741824&&(pr(h),h.subtreeFlags&6&&(h.flags|=8192)):pr(h),null;case 24:return null;case 25:return null}throw Error(e(156,h.tag))}function $M(l,h){switch(yy(h),h.tag){case 1:return Pr(h.type)&&af(),l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 3:return Hl(),Jt(Or),Jt(hr),Ny(),l=h.flags,l&65536&&!(l&128)?(h.flags=l&-65537|128,h):null;case 5:return Ry(h),null;case 13:if(Jt(un),l=h.memoizedState,l!==null&&l.dehydrated!==null){if(h.alternate===null)throw Error(e(340));Ul()}return l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 19:return Jt(un),null;case 4:return Hl(),null;case 10:return Iy(h.type._context),null;case 22:case 23:return l0(),null;case 24:return null;default:return null}}var Sf=!1,fr=!1,GM=typeof WeakSet=="function"?WeakSet:Set,Le=null;function Gl(l,h){var m=l.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(w){pn(l,h,w)}else m.current=null}function Yy(l,h,m){try{m()}catch(w){pn(l,h,w)}}var yI=!1;function KM(l,h){if(ly=Ba,l=Q_(),ty(l)){if("selectionStart"in l)var m={start:l.selectionStart,end:l.selectionEnd};else e:{m=(m=l.ownerDocument)&&m.defaultView||window;var w=m.getSelection&&m.getSelection();if(w&&w.rangeCount!==0){m=w.anchorNode;var E=w.anchorOffset,k=w.focusNode;w=w.focusOffset;try{m.nodeType,k.nodeType}catch{m=null;break e}var V=0,$=-1,Q=-1,le=0,xe=0,Ie=l,we=null;t:for(;;){for(var Pe;Ie!==m||E!==0&&Ie.nodeType!==3||($=V+E),Ie!==k||w!==0&&Ie.nodeType!==3||(Q=V+w),Ie.nodeType===3&&(V+=Ie.nodeValue.length),(Pe=Ie.firstChild)!==null;)we=Ie,Ie=Pe;for(;;){if(Ie===l)break t;if(we===m&&++le===E&&($=V),we===k&&++xe===w&&(Q=V),(Pe=Ie.nextSibling)!==null)break;Ie=we,we=Ie.parentNode}Ie=Pe}m=$===-1||Q===-1?null:{start:$,end:Q}}else m=null}m=m||{start:0,end:0}}else m=null;for(cy={focusedElem:l,selectionRange:m},Ba=!1,Le=h;Le!==null;)if(h=Le,l=h.child,(h.subtreeFlags&1028)!==0&&l!==null)l.return=h,Le=l;else for(;Le!==null;){h=Le;try{var Be=h.alternate;if(h.flags&1024)switch(h.tag){case 0:case 11:case 15:break;case 1:if(Be!==null){var We=Be.memoizedProps,wn=Be.memoizedState,ae=h.stateNode,te=ae.getSnapshotBeforeUpdate(h.elementType===h.type?We:Bi(h.type,We),wn);ae.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var se=h.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(e(163))}}catch(Se){pn(h,h.return,Se)}if(l=h.sibling,l!==null){l.return=h.return,Le=l;break}Le=h.return}return Be=yI,yI=!1,Be}function Vh(l,h,m){var w=h.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var E=w=w.next;do{if((E.tag&l)===l){var k=E.destroy;E.destroy=void 0,k!==void 0&&Yy(h,m,k)}E=E.next}while(E!==w)}}function Tf(l,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var m=h=h.next;do{if((m.tag&l)===l){var w=m.create;m.destroy=w()}m=m.next}while(m!==h)}}function Jy(l){var h=l.ref;if(h!==null){var m=l.stateNode;switch(l.tag){case 5:l=m;break;default:l=m}typeof h=="function"?h(l):h.current=l}}function wI(l){var h=l.alternate;h!==null&&(l.alternate=null,wI(h)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(h=l.stateNode,h!==null&&(delete h[fo],delete h[Ah],delete h[fy],delete h[kM],delete h[NM])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function bI(l){return l.tag===5||l.tag===3||l.tag===4}function xI(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||bI(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Zy(l,h,m){var w=l.tag;if(w===5||w===6)l=l.stateNode,h?m.nodeType===8?m.parentNode.insertBefore(l,h):m.insertBefore(l,h):(m.nodeType===8?(h=m.parentNode,h.insertBefore(l,m)):(h=m,h.appendChild(l)),m=m._reactRootContainer,m!=null||h.onclick!==null||(h.onclick=rf));else if(w!==4&&(l=l.child,l!==null))for(Zy(l,h,m),l=l.sibling;l!==null;)Zy(l,h,m),l=l.sibling}function e0(l,h,m){var w=l.tag;if(w===5||w===6)l=l.stateNode,h?m.insertBefore(l,h):m.appendChild(l);else if(w!==4&&(l=l.child,l!==null))for(e0(l,h,m),l=l.sibling;l!==null;)e0(l,h,m),l=l.sibling}var tr=null,Ui=!1;function Xa(l,h,m){for(m=m.child;m!==null;)_I(l,h,m),m=m.sibling}function _I(l,h,m){if(Xr&&typeof Xr.onCommitFiberUnmount=="function")try{Xr.onCommitFiberUnmount(Qs,m)}catch{}switch(m.tag){case 5:fr||Gl(m,h);case 6:var w=tr,E=Ui;tr=null,Xa(l,h,m),tr=w,Ui=E,tr!==null&&(Ui?(l=tr,m=m.stateNode,l.nodeType===8?l.parentNode.removeChild(m):l.removeChild(m)):tr.removeChild(m.stateNode));break;case 18:tr!==null&&(Ui?(l=tr,m=m.stateNode,l.nodeType===8?py(l.parentNode,m):l.nodeType===1&&py(l,m),Li(l)):py(tr,m.stateNode));break;case 4:w=tr,E=Ui,tr=m.stateNode.containerInfo,Ui=!0,Xa(l,h,m),tr=w,Ui=E;break;case 0:case 11:case 14:case 15:if(!fr&&(w=m.updateQueue,w!==null&&(w=w.lastEffect,w!==null))){E=w=w.next;do{var k=E,V=k.destroy;k=k.tag,V!==void 0&&(k&2||k&4)&&Yy(m,h,V),E=E.next}while(E!==w)}Xa(l,h,m);break;case 1:if(!fr&&(Gl(m,h),w=m.stateNode,typeof w.componentWillUnmount=="function"))try{w.props=m.memoizedProps,w.state=m.memoizedState,w.componentWillUnmount()}catch($){pn(m,h,$)}Xa(l,h,m);break;case 21:Xa(l,h,m);break;case 22:m.mode&1?(fr=(w=fr)||m.memoizedState!==null,Xa(l,h,m),fr=w):Xa(l,h,m);break;default:Xa(l,h,m)}}function EI(l){var h=l.updateQueue;if(h!==null){l.updateQueue=null;var m=l.stateNode;m===null&&(m=l.stateNode=new GM),h.forEach(function(w){var E=rL.bind(null,l,w);m.has(w)||(m.add(w),w.then(E,E))})}}function ji(l,h){var m=h.deletions;if(m!==null)for(var w=0;w<m.length;w++){var E=m[w];try{var k=l,V=h,$=V;e:for(;$!==null;){switch($.tag){case 5:tr=$.stateNode,Ui=!1;break e;case 3:tr=$.stateNode.containerInfo,Ui=!0;break e;case 4:tr=$.stateNode.containerInfo,Ui=!0;break e}$=$.return}if(tr===null)throw Error(e(160));_I(k,V,E),tr=null,Ui=!1;var Q=E.alternate;Q!==null&&(Q.return=null),E.return=null}catch(le){pn(E,h,le)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)II(h,l),h=h.sibling}function II(l,h){var m=l.alternate,w=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(ji(h,l),vo(l),w&4){try{Vh(3,l,l.return),Tf(3,l)}catch(We){pn(l,l.return,We)}try{Vh(5,l,l.return)}catch(We){pn(l,l.return,We)}}break;case 1:ji(h,l),vo(l),w&512&&m!==null&&Gl(m,m.return);break;case 5:if(ji(h,l),vo(l),w&512&&m!==null&&Gl(m,m.return),l.flags&32){var E=l.stateNode;try{cr(E,"")}catch(We){pn(l,l.return,We)}}if(w&4&&(E=l.stateNode,E!=null)){var k=l.memoizedProps,V=m!==null?m.memoizedProps:k,$=l.type,Q=l.updateQueue;if(l.updateQueue=null,Q!==null)try{$==="input"&&k.type==="radio"&&k.name!=null&&_t(E,k),Uo($,V);var le=Uo($,k);for(V=0;V<Q.length;V+=2){var xe=Q[V],Ie=Q[V+1];xe==="style"?Vo(E,Ie):xe==="dangerouslySetInnerHTML"?tn(E,Ie):xe==="children"?cr(E,Ie):T(E,xe,Ie,le)}switch($){case"input":vn(E,k);break;case"textarea":En(E,k);break;case"select":var we=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!k.multiple;var Pe=k.value;Pe!=null?Ht(E,!!k.multiple,Pe,!1):we!==!!k.multiple&&(k.defaultValue!=null?Ht(E,!!k.multiple,k.defaultValue,!0):Ht(E,!!k.multiple,k.multiple?[]:"",!1))}E[Ah]=k}catch(We){pn(l,l.return,We)}}break;case 6:if(ji(h,l),vo(l),w&4){if(l.stateNode===null)throw Error(e(162));E=l.stateNode,k=l.memoizedProps;try{E.nodeValue=k}catch(We){pn(l,l.return,We)}}break;case 3:if(ji(h,l),vo(l),w&4&&m!==null&&m.memoizedState.isDehydrated)try{Li(h.containerInfo)}catch(We){pn(l,l.return,We)}break;case 4:ji(h,l),vo(l);break;case 13:ji(h,l),vo(l),E=l.child,E.flags&8192&&(k=E.memoizedState!==null,E.stateNode.isHidden=k,!k||E.alternate!==null&&E.alternate.memoizedState!==null||(r0=$t())),w&4&&EI(l);break;case 22:if(xe=m!==null&&m.memoizedState!==null,l.mode&1?(fr=(le=fr)||xe,ji(h,l),fr=le):ji(h,l),vo(l),w&8192){if(le=l.memoizedState!==null,(l.stateNode.isHidden=le)&&!xe&&l.mode&1)for(Le=l,xe=l.child;xe!==null;){for(Ie=Le=xe;Le!==null;){switch(we=Le,Pe=we.child,we.tag){case 0:case 11:case 14:case 15:Vh(4,we,we.return);break;case 1:Gl(we,we.return);var Be=we.stateNode;if(typeof Be.componentWillUnmount=="function"){w=we,m=we.return;try{h=w,Be.props=h.memoizedProps,Be.state=h.memoizedState,Be.componentWillUnmount()}catch(We){pn(w,m,We)}}break;case 5:Gl(we,we.return);break;case 22:if(we.memoizedState!==null){TI(Ie);continue}}Pe!==null?(Pe.return=we,Le=Pe):TI(Ie)}xe=xe.sibling}e:for(xe=null,Ie=l;;){if(Ie.tag===5){if(xe===null){xe=Ie;try{E=Ie.stateNode,le?(k=E.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):($=Ie.stateNode,Q=Ie.memoizedProps.style,V=Q!=null&&Q.hasOwnProperty("display")?Q.display:null,$.style.display=zo("display",V))}catch(We){pn(l,l.return,We)}}}else if(Ie.tag===6){if(xe===null)try{Ie.stateNode.nodeValue=le?"":Ie.memoizedProps}catch(We){pn(l,l.return,We)}}else if((Ie.tag!==22&&Ie.tag!==23||Ie.memoizedState===null||Ie===l)&&Ie.child!==null){Ie.child.return=Ie,Ie=Ie.child;continue}if(Ie===l)break e;for(;Ie.sibling===null;){if(Ie.return===null||Ie.return===l)break e;xe===Ie&&(xe=null),Ie=Ie.return}xe===Ie&&(xe=null),Ie.sibling.return=Ie.return,Ie=Ie.sibling}}break;case 19:ji(h,l),vo(l),w&4&&EI(l);break;case 21:break;default:ji(h,l),vo(l)}}function vo(l){var h=l.flags;if(h&2){try{e:{for(var m=l.return;m!==null;){if(bI(m)){var w=m;break e}m=m.return}throw Error(e(160))}switch(w.tag){case 5:var E=w.stateNode;w.flags&32&&(cr(E,""),w.flags&=-33);var k=xI(l);e0(l,k,E);break;case 3:case 4:var V=w.stateNode.containerInfo,$=xI(l);Zy(l,$,V);break;default:throw Error(e(161))}}catch(Q){pn(l,l.return,Q)}l.flags&=-3}h&4096&&(l.flags&=-4097)}function XM(l,h,m){Le=l,CI(l)}function CI(l,h,m){for(var w=(l.mode&1)!==0;Le!==null;){var E=Le,k=E.child;if(E.tag===22&&w){var V=E.memoizedState!==null||Sf;if(!V){var $=E.alternate,Q=$!==null&&$.memoizedState!==null||fr;$=Sf;var le=fr;if(Sf=V,(fr=Q)&&!le)for(Le=E;Le!==null;)V=Le,Q=V.child,V.tag===22&&V.memoizedState!==null?AI(E):Q!==null?(Q.return=V,Le=Q):AI(E);for(;k!==null;)Le=k,CI(k),k=k.sibling;Le=E,Sf=$,fr=le}SI(l)}else E.subtreeFlags&8772&&k!==null?(k.return=E,Le=k):SI(l)}}function SI(l){for(;Le!==null;){var h=Le;if(h.flags&8772){var m=h.alternate;try{if(h.flags&8772)switch(h.tag){case 0:case 11:case 15:fr||Tf(5,h);break;case 1:var w=h.stateNode;if(h.flags&4&&!fr)if(m===null)w.componentDidMount();else{var E=h.elementType===h.type?m.memoizedProps:Bi(h.type,m.memoizedProps);w.componentDidUpdate(E,m.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var k=h.updateQueue;k!==null&&TE(h,k,w);break;case 3:var V=h.updateQueue;if(V!==null){if(m=null,h.child!==null)switch(h.child.tag){case 5:m=h.child.stateNode;break;case 1:m=h.child.stateNode}TE(h,V,m)}break;case 5:var $=h.stateNode;if(m===null&&h.flags&4){m=$;var Q=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":Q.autoFocus&&m.focus();break;case"img":Q.src&&(m.src=Q.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var le=h.alternate;if(le!==null){var xe=le.memoizedState;if(xe!==null){var Ie=xe.dehydrated;Ie!==null&&Li(Ie)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(e(163))}fr||h.flags&512&&Jy(h)}catch(we){pn(h,h.return,we)}}if(h===l){Le=null;break}if(m=h.sibling,m!==null){m.return=h.return,Le=m;break}Le=h.return}}function TI(l){for(;Le!==null;){var h=Le;if(h===l){Le=null;break}var m=h.sibling;if(m!==null){m.return=h.return,Le=m;break}Le=h.return}}function AI(l){for(;Le!==null;){var h=Le;try{switch(h.tag){case 0:case 11:case 15:var m=h.return;try{Tf(4,h)}catch(Q){pn(h,m,Q)}break;case 1:var w=h.stateNode;if(typeof w.componentDidMount=="function"){var E=h.return;try{w.componentDidMount()}catch(Q){pn(h,E,Q)}}var k=h.return;try{Jy(h)}catch(Q){pn(h,k,Q)}break;case 5:var V=h.return;try{Jy(h)}catch(Q){pn(h,V,Q)}}}catch(Q){pn(h,h.return,Q)}if(h===l){Le=null;break}var $=h.sibling;if($!==null){$.return=h.return,Le=$;break}Le=h.return}}var QM=Math.ceil,Af=D.ReactCurrentDispatcher,t0=D.ReactCurrentOwner,_i=D.ReactCurrentBatchConfig,Ot=0,$n=null,Cn=null,nr=0,ti=0,Kl=qa(0),Mn=0,Bh=null,cu=0,Rf=0,n0=0,Uh=null,Lr=null,r0=0,Xl=1/0,ta=null,kf=!1,i0=null,Qa=null,Nf=!1,Ya=null,Df=0,jh=0,o0=null,Of=-1,Pf=0;function Cr(){return Ot&6?$t():Of!==-1?Of:Of=$t()}function Ja(l){return l.mode&1?Ot&2&&nr!==0?nr&-nr:OM.transition!==null?(Pf===0&&(Pf=Js()),Pf):(l=Tt,l!==0||(l=window.event,l=l===void 0?16:gh(l.type)),l):1}function Wi(l,h,m,w){if(50<jh)throw jh=0,o0=null,Error(e(185));La(l,m,w),(!(Ot&2)||l!==$n)&&(l===$n&&(!(Ot&2)&&(Rf|=m),Mn===4&&Za(l,nr)),Fr(l,w),m===1&&Ot===0&&!(h.mode&1)&&(Xl=$t()+500,uf&&$a()))}function Fr(l,h){var m=l.callbackNode;Wo(l,h);var w=Ys(l,l===$n?nr:0);if(w===0)m!==null&&hh(m),l.callbackNode=null,l.callbackPriority=0;else if(h=w&-w,l.callbackPriority!==h){if(m!=null&&hh(m),h===1)l.tag===0?DM(kI.bind(null,l)):mE(kI.bind(null,l)),AM(function(){!(Ot&6)&&$a()}),m=null;else{switch(za(w)){case 1:m=Xs;break;case 4:m=Oa;break;case 16:m=mi;break;case 536870912:m=Op;break;default:m=mi}m=zI(m,RI.bind(null,l))}l.callbackPriority=h,l.callbackNode=m}}function RI(l,h){if(Of=-1,Pf=0,Ot&6)throw Error(e(327));var m=l.callbackNode;if(Ql()&&l.callbackNode!==m)return null;var w=Ys(l,l===$n?nr:0);if(w===0)return null;if(w&30||w&l.expiredLanes||h)h=Mf(l,w);else{h=w;var E=Ot;Ot|=2;var k=DI();($n!==l||nr!==h)&&(ta=null,Xl=$t()+500,du(l,h));do try{ZM();break}catch($){NI(l,$)}while(!0);Ey(),Af.current=k,Ot=E,Cn!==null?h=0:($n=null,nr=0,h=Mn)}if(h!==0){if(h===2&&(E=Qr(l),E!==0&&(w=E,h=a0(l,E))),h===1)throw m=Bh,du(l,0),Za(l,w),Fr(l,$t()),m;if(h===6)Za(l,w);else{if(E=l.current.alternate,!(w&30)&&!YM(E)&&(h=Mf(l,w),h===2&&(k=Qr(l),k!==0&&(w=k,h=a0(l,k))),h===1))throw m=Bh,du(l,0),Za(l,w),Fr(l,$t()),m;switch(l.finishedWork=E,l.finishedLanes=w,h){case 0:case 1:throw Error(e(345));case 2:pu(l,Lr,ta);break;case 3:if(Za(l,w),(w&130023424)===w&&(h=r0+500-$t(),10<h)){if(Ys(l,0)!==0)break;if(E=l.suspendedLanes,(E&w)!==w){Cr(),l.pingedLanes|=l.suspendedLanes&E;break}l.timeoutHandle=dy(pu.bind(null,l,Lr,ta),h);break}pu(l,Lr,ta);break;case 4:if(Za(l,w),(w&4194240)===w)break;for(h=l.eventTimes,E=-1;0<w;){var V=31-_r(w);k=1<<V,V=h[V],V>E&&(E=V),w&=~k}if(w=E,w=$t()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*QM(w/1960))-w,10<w){l.timeoutHandle=dy(pu.bind(null,l,Lr,ta),w);break}pu(l,Lr,ta);break;case 5:pu(l,Lr,ta);break;default:throw Error(e(329))}}}return Fr(l,$t()),l.callbackNode===m?RI.bind(null,l):null}function a0(l,h){var m=Uh;return l.current.memoizedState.isDehydrated&&(du(l,h).flags|=256),l=Mf(l,h),l!==2&&(h=Lr,Lr=m,h!==null&&s0(h)),l}function s0(l){Lr===null?Lr=l:Lr.push.apply(Lr,l)}function YM(l){for(var h=l;;){if(h.flags&16384){var m=h.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var w=0;w<m.length;w++){var E=m[w],k=E.getSnapshot;E=E.value;try{if(!zi(k(),E))return!1}catch{return!1}}}if(m=h.child,h.subtreeFlags&16384&&m!==null)m.return=h,h=m;else{if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Za(l,h){for(h&=~n0,h&=~Rf,l.suspendedLanes|=h,l.pingedLanes&=~h,l=l.expirationTimes;0<h;){var m=31-_r(h),w=1<<m;l[m]=-1,h&=~w}}function kI(l){if(Ot&6)throw Error(e(327));Ql();var h=Ys(l,0);if(!(h&1))return Fr(l,$t()),null;var m=Mf(l,h);if(l.tag!==0&&m===2){var w=Qr(l);w!==0&&(h=w,m=a0(l,w))}if(m===1)throw m=Bh,du(l,0),Za(l,h),Fr(l,$t()),m;if(m===6)throw Error(e(345));return l.finishedWork=l.current.alternate,l.finishedLanes=h,pu(l,Lr,ta),Fr(l,$t()),null}function u0(l,h){var m=Ot;Ot|=1;try{return l(h)}finally{Ot=m,Ot===0&&(Xl=$t()+500,uf&&$a())}}function hu(l){Ya!==null&&Ya.tag===0&&!(Ot&6)&&Ql();var h=Ot;Ot|=1;var m=_i.transition,w=Tt;try{if(_i.transition=null,Tt=1,l)return l()}finally{Tt=w,_i.transition=m,Ot=h,!(Ot&6)&&$a()}}function l0(){ti=Kl.current,Jt(Kl)}function du(l,h){l.finishedWork=null,l.finishedLanes=0;var m=l.timeoutHandle;if(m!==-1&&(l.timeoutHandle=-1,TM(m)),Cn!==null)for(m=Cn.return;m!==null;){var w=m;switch(yy(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&af();break;case 3:Hl(),Jt(Or),Jt(hr),Ny();break;case 5:Ry(w);break;case 4:Hl();break;case 13:Jt(un);break;case 19:Jt(un);break;case 10:Iy(w.type._context);break;case 22:case 23:l0()}m=m.return}if($n=l,Cn=l=es(l.current,null),nr=ti=h,Mn=0,Bh=null,n0=Rf=cu=0,Lr=Uh=null,su!==null){for(h=0;h<su.length;h++)if(m=su[h],w=m.interleaved,w!==null){m.interleaved=null;var E=w.next,k=m.pending;if(k!==null){var V=k.next;k.next=E,w.next=V}m.pending=w}su=null}return l}function NI(l,h){do{var m=Cn;try{if(Ey(),yf.current=_f,wf){for(var w=ln.memoizedState;w!==null;){var E=w.queue;E!==null&&(E.pending=null),w=w.next}wf=!1}if(lu=0,Hn=Pn=ln=null,Ph=!1,Mh=0,t0.current=null,m===null||m.return===null){Mn=1,Bh=h,Cn=null;break}e:{var k=l,V=m.return,$=m,Q=h;if(h=nr,$.flags|=32768,Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var le=Q,xe=$,Ie=xe.tag;if(!(xe.mode&1)&&(Ie===0||Ie===11||Ie===15)){var we=xe.alternate;we?(xe.updateQueue=we.updateQueue,xe.memoizedState=we.memoizedState,xe.lanes=we.lanes):(xe.updateQueue=null,xe.memoizedState=null)}var Pe=nI(V);if(Pe!==null){Pe.flags&=-257,rI(Pe,V,$,k,h),Pe.mode&1&&tI(k,le,h),h=Pe,Q=le;var Be=h.updateQueue;if(Be===null){var We=new Set;We.add(Q),h.updateQueue=We}else Be.add(Q);break e}else{if(!(h&1)){tI(k,le,h),c0();break e}Q=Error(e(426))}}else if(rn&&$.mode&1){var wn=nI(V);if(wn!==null){!(wn.flags&65536)&&(wn.flags|=256),rI(wn,V,$,k,h),xy($l(Q,$));break e}}k=Q=$l(Q,$),Mn!==4&&(Mn=2),Uh===null?Uh=[k]:Uh.push(k),k=V;do{switch(k.tag){case 3:k.flags|=65536,h&=-h,k.lanes|=h;var ae=ZE(k,Q,h);SE(k,ae);break e;case 1:$=Q;var te=k.type,se=k.stateNode;if(!(k.flags&128)&&(typeof te.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(Qa===null||!Qa.has(se)))){k.flags|=65536,h&=-h,k.lanes|=h;var Se=eI(k,$,h);SE(k,Se);break e}}k=k.return}while(k!==null)}PI(m)}catch(qe){h=qe,Cn===m&&m!==null&&(Cn=m=m.return);continue}break}while(!0)}function DI(){var l=Af.current;return Af.current=_f,l===null?_f:l}function c0(){(Mn===0||Mn===3||Mn===2)&&(Mn=4),$n===null||!(cu&268435455)&&!(Rf&268435455)||Za($n,nr)}function Mf(l,h){var m=Ot;Ot|=2;var w=DI();($n!==l||nr!==h)&&(ta=null,du(l,h));do try{JM();break}catch(E){NI(l,E)}while(!0);if(Ey(),Ot=m,Af.current=w,Cn!==null)throw Error(e(261));return $n=null,nr=0,Mn}function JM(){for(;Cn!==null;)OI(Cn)}function ZM(){for(;Cn!==null&&!Np();)OI(Cn)}function OI(l){var h=FI(l.alternate,l,ti);l.memoizedProps=l.pendingProps,h===null?PI(l):Cn=h,t0.current=null}function PI(l){var h=l;do{var m=h.alternate;if(l=h.return,h.flags&32768){if(m=$M(m,h),m!==null){m.flags&=32767,Cn=m;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{Mn=6,Cn=null;return}}else if(m=HM(m,h,ti),m!==null){Cn=m;return}if(h=h.sibling,h!==null){Cn=h;return}Cn=h=l}while(h!==null);Mn===0&&(Mn=5)}function pu(l,h,m){var w=Tt,E=_i.transition;try{_i.transition=null,Tt=1,eL(l,h,m,w)}finally{_i.transition=E,Tt=w}return null}function eL(l,h,m,w){do Ql();while(Ya!==null);if(Ot&6)throw Error(e(327));m=l.finishedWork;var E=l.finishedLanes;if(m===null)return null;if(l.finishedWork=null,l.finishedLanes=0,m===l.current)throw Error(e(177));l.callbackNode=null,l.callbackPriority=0;var k=m.lanes|m.childLanes;if(Wt(l,k),l===$n&&(Cn=$n=null,nr=0),!(m.subtreeFlags&2064)&&!(m.flags&2064)||Nf||(Nf=!0,zI(mi,function(){return Ql(),null})),k=(m.flags&15990)!==0,m.subtreeFlags&15990||k){k=_i.transition,_i.transition=null;var V=Tt;Tt=1;var $=Ot;Ot|=4,t0.current=null,KM(l,m),II(m,l),bM(cy),Ba=!!ly,cy=ly=null,l.current=m,XM(m),Gv(),Ot=$,Tt=V,_i.transition=k}else l.current=m;if(Nf&&(Nf=!1,Ya=l,Df=E),k=l.pendingLanes,k===0&&(Qa=null),Pp(m.stateNode),Fr(l,$t()),h!==null)for(w=l.onRecoverableError,m=0;m<h.length;m++)E=h[m],w(E.value,{componentStack:E.stack,digest:E.digest});if(kf)throw kf=!1,l=i0,i0=null,l;return Df&1&&l.tag!==0&&Ql(),k=l.pendingLanes,k&1?l===o0?jh++:(jh=0,o0=l):jh=0,$a(),null}function Ql(){if(Ya!==null){var l=za(Df),h=_i.transition,m=Tt;try{if(_i.transition=null,Tt=16>l?16:l,Ya===null)var w=!1;else{if(l=Ya,Ya=null,Df=0,Ot&6)throw Error(e(331));var E=Ot;for(Ot|=4,Le=l.current;Le!==null;){var k=Le,V=k.child;if(Le.flags&16){var $=k.deletions;if($!==null){for(var Q=0;Q<$.length;Q++){var le=$[Q];for(Le=le;Le!==null;){var xe=Le;switch(xe.tag){case 0:case 11:case 15:Vh(8,xe,k)}var Ie=xe.child;if(Ie!==null)Ie.return=xe,Le=Ie;else for(;Le!==null;){xe=Le;var we=xe.sibling,Pe=xe.return;if(wI(xe),xe===le){Le=null;break}if(we!==null){we.return=Pe,Le=we;break}Le=Pe}}}var Be=k.alternate;if(Be!==null){var We=Be.child;if(We!==null){Be.child=null;do{var wn=We.sibling;We.sibling=null,We=wn}while(We!==null)}}Le=k}}if(k.subtreeFlags&2064&&V!==null)V.return=k,Le=V;else e:for(;Le!==null;){if(k=Le,k.flags&2048)switch(k.tag){case 0:case 11:case 15:Vh(9,k,k.return)}var ae=k.sibling;if(ae!==null){ae.return=k.return,Le=ae;break e}Le=k.return}}var te=l.current;for(Le=te;Le!==null;){V=Le;var se=V.child;if(V.subtreeFlags&2064&&se!==null)se.return=V,Le=se;else e:for(V=te;Le!==null;){if($=Le,$.flags&2048)try{switch($.tag){case 0:case 11:case 15:Tf(9,$)}}catch(qe){pn($,$.return,qe)}if($===V){Le=null;break e}var Se=$.sibling;if(Se!==null){Se.return=$.return,Le=Se;break e}Le=$.return}}if(Ot=E,$a(),Xr&&typeof Xr.onPostCommitFiberRoot=="function")try{Xr.onPostCommitFiberRoot(Qs,l)}catch{}w=!0}return w}finally{Tt=m,_i.transition=h}}return!1}function MI(l,h,m){h=$l(m,h),h=ZE(l,h,1),l=Ka(l,h,1),h=Cr(),l!==null&&(La(l,1,h),Fr(l,h))}function pn(l,h,m){if(l.tag===3)MI(l,l,m);else for(;h!==null;){if(h.tag===3){MI(h,l,m);break}else if(h.tag===1){var w=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Qa===null||!Qa.has(w))){l=$l(m,l),l=eI(h,l,1),h=Ka(h,l,1),l=Cr(),h!==null&&(La(h,1,l),Fr(h,l));break}}h=h.return}}function tL(l,h,m){var w=l.pingCache;w!==null&&w.delete(h),h=Cr(),l.pingedLanes|=l.suspendedLanes&m,$n===l&&(nr&m)===m&&(Mn===4||Mn===3&&(nr&130023424)===nr&&500>$t()-r0?du(l,0):n0|=m),Fr(l,h)}function LI(l,h){h===0&&(l.mode&1?(h=wl,wl<<=1,!(wl&130023424)&&(wl=4194304)):h=1);var m=Cr();l=Jo(l,h),l!==null&&(La(l,h,m),Fr(l,m))}function nL(l){var h=l.memoizedState,m=0;h!==null&&(m=h.retryLane),LI(l,m)}function rL(l,h){var m=0;switch(l.tag){case 13:var w=l.stateNode,E=l.memoizedState;E!==null&&(m=E.retryLane);break;case 19:w=l.stateNode;break;default:throw Error(e(314))}w!==null&&w.delete(h),LI(l,m)}var FI;FI=function(l,h,m){if(l!==null)if(l.memoizedProps!==h.pendingProps||Or.current)Mr=!0;else{if(!(l.lanes&m)&&!(h.flags&128))return Mr=!1,qM(l,h,m);Mr=!!(l.flags&131072)}else Mr=!1,rn&&h.flags&1048576&&gE(h,cf,h.index);switch(h.lanes=0,h.tag){case 2:var w=h.type;Cf(l,h),l=h.pendingProps;var E=zl(h,hr.current);ql(h,m),E=Py(null,h,w,l,E,m);var k=My();return h.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Pr(w)?(k=!0,sf(h)):k=!1,h.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,Ty(h),E.updater=Ef,h.stateNode=E,E._reactInternals=h,Uy(h,w,l,m),h=Hy(null,h,w,!0,k,m)):(h.tag=0,rn&&k&&vy(h),Ir(null,h,E,m),h=h.child),h;case 16:w=h.elementType;e:{switch(Cf(l,h),l=h.pendingProps,E=w._init,w=E(w._payload),h.type=w,E=h.tag=oL(w),l=Bi(w,l),E){case 0:h=qy(null,h,w,l,m);break e;case 1:h=lI(null,h,w,l,m);break e;case 11:h=iI(null,h,w,l,m);break e;case 14:h=oI(null,h,w,Bi(w.type,l),m);break e}throw Error(e(306,w,""))}return h;case 0:return w=h.type,E=h.pendingProps,E=h.elementType===w?E:Bi(w,E),qy(l,h,w,E,m);case 1:return w=h.type,E=h.pendingProps,E=h.elementType===w?E:Bi(w,E),lI(l,h,w,E,m);case 3:e:{if(cI(h),l===null)throw Error(e(387));w=h.pendingProps,k=h.memoizedState,E=k.element,CE(l,h),gf(h,w,null,m);var V=h.memoizedState;if(w=V.element,k.isDehydrated)if(k={element:w,isDehydrated:!1,cache:V.cache,pendingSuspenseBoundaries:V.pendingSuspenseBoundaries,transitions:V.transitions},h.updateQueue.baseState=k,h.memoizedState=k,h.flags&256){E=$l(Error(e(423)),h),h=hI(l,h,w,m,E);break e}else if(w!==E){E=$l(Error(e(424)),h),h=hI(l,h,w,m,E);break e}else for(ei=Wa(h.stateNode.containerInfo.firstChild),Zr=h,rn=!0,Vi=null,m=EE(h,null,w,m),h.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(Ul(),w===E){h=ea(l,h,m);break e}Ir(l,h,w,m)}h=h.child}return h;case 5:return AE(h),l===null&&by(h),w=h.type,E=h.pendingProps,k=l!==null?l.memoizedProps:null,V=E.children,hy(w,E)?V=null:k!==null&&hy(w,k)&&(h.flags|=32),uI(l,h),Ir(l,h,V,m),h.child;case 6:return l===null&&by(h),null;case 13:return dI(l,h,m);case 4:return Ay(h,h.stateNode.containerInfo),w=h.pendingProps,l===null?h.child=jl(h,null,w,m):Ir(l,h,w,m),h.child;case 11:return w=h.type,E=h.pendingProps,E=h.elementType===w?E:Bi(w,E),iI(l,h,w,E,m);case 7:return Ir(l,h,h.pendingProps,m),h.child;case 8:return Ir(l,h,h.pendingProps.children,m),h.child;case 12:return Ir(l,h,h.pendingProps.children,m),h.child;case 10:e:{if(w=h.type._context,E=h.pendingProps,k=h.memoizedProps,V=E.value,Gt(pf,w._currentValue),w._currentValue=V,k!==null)if(zi(k.value,V)){if(k.children===E.children&&!Or.current){h=ea(l,h,m);break e}}else for(k=h.child,k!==null&&(k.return=h);k!==null;){var $=k.dependencies;if($!==null){V=k.child;for(var Q=$.firstContext;Q!==null;){if(Q.context===w){if(k.tag===1){Q=Zo(-1,m&-m),Q.tag=2;var le=k.updateQueue;if(le!==null){le=le.shared;var xe=le.pending;xe===null?Q.next=Q:(Q.next=xe.next,xe.next=Q),le.pending=Q}}k.lanes|=m,Q=k.alternate,Q!==null&&(Q.lanes|=m),Cy(k.return,m,h),$.lanes|=m;break}Q=Q.next}}else if(k.tag===10)V=k.type===h.type?null:k.child;else if(k.tag===18){if(V=k.return,V===null)throw Error(e(341));V.lanes|=m,$=V.alternate,$!==null&&($.lanes|=m),Cy(V,m,h),V=k.sibling}else V=k.child;if(V!==null)V.return=k;else for(V=k;V!==null;){if(V===h){V=null;break}if(k=V.sibling,k!==null){k.return=V.return,V=k;break}V=V.return}k=V}Ir(l,h,E.children,m),h=h.child}return h;case 9:return E=h.type,w=h.pendingProps.children,ql(h,m),E=bi(E),w=w(E),h.flags|=1,Ir(l,h,w,m),h.child;case 14:return w=h.type,E=Bi(w,h.pendingProps),E=Bi(w.type,E),oI(l,h,w,E,m);case 15:return aI(l,h,h.type,h.pendingProps,m);case 17:return w=h.type,E=h.pendingProps,E=h.elementType===w?E:Bi(w,E),Cf(l,h),h.tag=1,Pr(w)?(l=!0,sf(h)):l=!1,ql(h,m),YE(h,w,E),Uy(h,w,E,m),Hy(null,h,w,!0,l,m);case 19:return fI(l,h,m);case 22:return sI(l,h,m)}throw Error(e(156,h.tag))};function zI(l,h){return vl(l,h)}function iL(l,h,m,w){this.tag=l,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ei(l,h,m,w){return new iL(l,h,m,w)}function h0(l){return l=l.prototype,!(!l||!l.isReactComponent)}function oL(l){if(typeof l=="function")return h0(l)?1:0;if(l!=null){if(l=l.$$typeof,l===M)return 11;if(l===Z)return 14}return 2}function es(l,h){var m=l.alternate;return m===null?(m=Ei(l.tag,h,l.key,l.mode),m.elementType=l.elementType,m.type=l.type,m.stateNode=l.stateNode,m.alternate=l,l.alternate=m):(m.pendingProps=h,m.type=l.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=l.flags&14680064,m.childLanes=l.childLanes,m.lanes=l.lanes,m.child=l.child,m.memoizedProps=l.memoizedProps,m.memoizedState=l.memoizedState,m.updateQueue=l.updateQueue,h=l.dependencies,m.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},m.sibling=l.sibling,m.index=l.index,m.ref=l.ref,m}function Lf(l,h,m,w,E,k){var V=2;if(w=l,typeof l=="function")h0(l)&&(V=1);else if(typeof l=="string")V=5;else e:switch(l){case I:return fu(m.children,E,k,h);case S:V=8,E|=8;break;case A:return l=Ei(12,m,h,E|2),l.elementType=A,l.lanes=k,l;case F:return l=Ei(13,m,h,E),l.elementType=F,l.lanes=k,l;case G:return l=Ei(19,m,h,E),l.elementType=G,l.lanes=k,l;case ee:return Ff(m,E,k,h);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case N:V=10;break e;case P:V=9;break e;case M:V=11;break e;case Z:V=14;break e;case Y:V=16,w=null;break e}throw Error(e(130,l==null?l:typeof l,""))}return h=Ei(V,m,h,E),h.elementType=l,h.type=w,h.lanes=k,h}function fu(l,h,m,w){return l=Ei(7,l,w,h),l.lanes=m,l}function Ff(l,h,m,w){return l=Ei(22,l,w,h),l.elementType=ee,l.lanes=m,l.stateNode={isHidden:!1},l}function d0(l,h,m){return l=Ei(6,l,null,h),l.lanes=m,l}function p0(l,h,m){return h=Ei(4,l.children!==null?l.children:[],l.key,h),h.lanes=m,h.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},h}function aL(l,h,m,w,E){this.tag=h,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ma(0),this.expirationTimes=Ma(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ma(0),this.identifierPrefix=w,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function f0(l,h,m,w,E,k,V,$,Q){return l=new aL(l,h,m,$,Q),h===1?(h=1,k===!0&&(h|=8)):h=0,k=Ei(3,null,null,h),l.current=k,k.stateNode=l,k.memoizedState={element:w,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ty(k),l}function sL(l,h,m){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:z,key:w==null?null:""+w,children:l,containerInfo:h,implementation:m}}function VI(l){if(!l)return Ha;l=l._reactInternals;e:{if(Ni(l)!==l||l.tag!==1)throw Error(e(170));var h=l;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Pr(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(e(171))}if(l.tag===1){var m=l.type;if(Pr(m))return pE(l,m,h)}return h}function BI(l,h,m,w,E,k,V,$,Q){return l=f0(m,w,!0,l,E,k,V,$,Q),l.context=VI(null),m=l.current,w=Cr(),E=Ja(m),k=Zo(w,E),k.callback=h??null,Ka(m,k,E),l.current.lanes=E,La(l,E,w),Fr(l,w),l}function zf(l,h,m,w){var E=h.current,k=Cr(),V=Ja(E);return m=VI(m),h.context===null?h.context=m:h.pendingContext=m,h=Zo(k,V),h.payload={element:l},w=w===void 0?null:w,w!==null&&(h.callback=w),l=Ka(E,h,V),l!==null&&(Wi(l,E,V,k),mf(l,E,V)),V}function Vf(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function UI(l,h){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var m=l.retryLane;l.retryLane=m!==0&&m<h?m:h}}function m0(l,h){UI(l,h),(l=l.alternate)&&UI(l,h)}function uL(){return null}var jI=typeof reportError=="function"?reportError:function(l){console.error(l)};function g0(l){this._internalRoot=l}Bf.prototype.render=g0.prototype.render=function(l){var h=this._internalRoot;if(h===null)throw Error(e(409));zf(l,h,null,null)},Bf.prototype.unmount=g0.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var h=l.containerInfo;hu(function(){zf(null,l,null,null)}),h[Ko]=null}};function Bf(l){this._internalRoot=l}Bf.prototype.unstable_scheduleHydration=function(l){if(l){var h=Vp();l={blockedOn:null,target:l,priority:h};for(var m=0;m<lo.length&&h!==0&&h<lo[m].priority;m++);lo.splice(m,0,l),m===0&&jp(l)}};function v0(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function Uf(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function WI(){}function lL(l,h,m,w,E){if(E){if(typeof w=="function"){var k=w;w=function(){var le=Vf(V);k.call(le)}}var V=BI(h,w,l,0,null,!1,!1,"",WI);return l._reactRootContainer=V,l[Ko]=V.current,Sh(l.nodeType===8?l.parentNode:l),hu(),V}for(;E=l.lastChild;)l.removeChild(E);if(typeof w=="function"){var $=w;w=function(){var le=Vf(Q);$.call(le)}}var Q=f0(l,0,!1,null,null,!1,!1,"",WI);return l._reactRootContainer=Q,l[Ko]=Q.current,Sh(l.nodeType===8?l.parentNode:l),hu(function(){zf(h,Q,m,w)}),Q}function jf(l,h,m,w,E){var k=m._reactRootContainer;if(k){var V=k;if(typeof E=="function"){var $=E;E=function(){var Q=Vf(V);$.call(Q)}}zf(h,V,l,E)}else V=lL(m,h,l,E,w);return Vf(V)}Fp=function(l){switch(l.tag){case 3:var h=l.stateNode;if(h.current.memoizedState.isDehydrated){var m=Pa(h.pendingLanes);m!==0&&(Fa(h,m|1),Fr(h,$t()),!(Ot&6)&&(Xl=$t()+500,$a()))}break;case 13:hu(function(){var w=Jo(l,1);if(w!==null){var E=Cr();Wi(w,l,1,E)}}),m0(l,1)}},bl=function(l){if(l.tag===13){var h=Jo(l,134217728);if(h!==null){var m=Cr();Wi(h,l,134217728,m)}m0(l,134217728)}},zp=function(l){if(l.tag===13){var h=Ja(l),m=Jo(l,h);if(m!==null){var w=Cr();Wi(m,l,h,w)}m0(l,h)}},Vp=function(){return Tt},Bp=function(l,h){var m=Tt;try{return Tt=l,h()}finally{Tt=m}},hl=function(l,h,m){switch(h){case"input":if(vn(l,m),h=m.name,m.type==="radio"&&h!=null){for(m=l;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<m.length;h++){var w=m[h];if(w!==l&&w.form===l.form){var E=of(w);if(!E)throw Error(e(90));wt(w),vn(w,E)}}}break;case"textarea":En(l,m);break;case"select":h=m.value,h!=null&&Ht(l,!!m.multiple,h,!1)}},Hs=u0,sh=hu;var cL={usingClientEntryPoint:!1,Events:[Rh,Ll,of,so,ah,u0]},Wh={findFiberByHostInstance:ru,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hL={bundleType:Wh.bundleType,version:Wh.version,rendererPackageName:Wh.rendererPackageName,rendererConfig:Wh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:D.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=ch(l),l===null?null:l.stateNode},findFiberByHostInstance:Wh.findFiberByHostInstance||uL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wf.isDisabled&&Wf.supportsFiber)try{Qs=Wf.inject(hL),Xr=Wf}catch{}}return zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cL,zr.createPortal=function(l,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v0(h))throw Error(e(200));return sL(l,h,null,m)},zr.createRoot=function(l,h){if(!v0(l))throw Error(e(299));var m=!1,w="",E=jI;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(w=h.identifierPrefix),h.onRecoverableError!==void 0&&(E=h.onRecoverableError)),h=f0(l,1,!1,null,null,m,!1,w,E),l[Ko]=h.current,Sh(l.nodeType===8?l.parentNode:l),new g0(h)},zr.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var h=l._reactInternals;if(h===void 0)throw typeof l.render=="function"?Error(e(188)):(l=Object.keys(l).join(","),Error(e(268,l)));return l=ch(h),l=l===null?null:l.stateNode,l},zr.flushSync=function(l){return hu(l)},zr.hydrate=function(l,h,m){if(!Uf(h))throw Error(e(200));return jf(null,l,h,!0,m)},zr.hydrateRoot=function(l,h,m){if(!v0(l))throw Error(e(405));var w=m!=null&&m.hydratedSources||null,E=!1,k="",V=jI;if(m!=null&&(m.unstable_strictMode===!0&&(E=!0),m.identifierPrefix!==void 0&&(k=m.identifierPrefix),m.onRecoverableError!==void 0&&(V=m.onRecoverableError)),h=BI(h,null,l,1,m??null,E,!1,k,V),l[Ko]=h.current,Sh(l),w)for(l=0;l<w.length;l++)m=w[l],E=m._getVersion,E=E(m._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[m,E]:h.mutableSourceEagerHydrationData.push(m,E);return new Bf(h)},zr.render=function(l,h,m){if(!Uf(h))throw Error(e(200));return jf(null,l,h,!1,m)},zr.unmountComponentAtNode=function(l){if(!Uf(l))throw Error(e(40));return l._reactRootContainer?(hu(function(){jf(null,null,l,!1,function(){l._reactRootContainer=null,l[Ko]=null})}),!0):!1},zr.unstable_batchedUpdates=u0,zr.unstable_renderSubtreeIntoContainer=function(l,h,m,w){if(!Uf(m))throw Error(e(200));if(l==null||l._reactInternals===void 0)throw Error(e(38));return jf(l,h,m,!1,w)},zr.version="18.3.1-next-f1338f8080-20240426",zr}var YI;function bL(){if(YI)return b0.exports;YI=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),b0.exports=wL(),b0.exports}var JI;function xL(){if(JI)return qf;JI=1;var r=bL();return qf.createRoot=r.createRoot,qf.hydrateRoot=r.hydrateRoot,qf}var _L=xL(),Hh={},ZI;function EL(){if(ZI)return Hh;ZI=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.parse=a,Hh.serialize=c;const r=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,e=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,o=(()=>{const f=function(){};return f.prototype=Object.create(null),f})();function a(f,g){const y=new o,x=f.length;if(x<2)return y;const b=(g==null?void 0:g.decode)||d;let _=0;do{const C=f.indexOf("=",_);if(C===-1)break;const T=f.indexOf(";",_),D=T===-1?x:T;if(C>D){_=f.lastIndexOf(";",C-1)+1;continue}const O=s(f,_,C),z=u(f,C,O),I=f.slice(O,z);if(y[I]===void 0){let S=s(f,C+1,D),A=u(f,D,S);const N=b(f.slice(S,A));y[I]=N}_=D+1}while(_<x);return y}function s(f,g,y){do{const x=f.charCodeAt(g);if(x!==32&&x!==9)return g}while(++g<y);return y}function u(f,g,y){for(;g>y;){const x=f.charCodeAt(--g);if(x!==32&&x!==9)return g+1}return y}function c(f,g,y){const x=(y==null?void 0:y.encode)||encodeURIComponent;if(!r.test(f))throw new TypeError(`argument name is invalid: ${f}`);const b=x(g);if(!t.test(b))throw new TypeError(`argument val is invalid: ${g}`);let _=f+"="+b;if(!y)return _;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);_+="; Max-Age="+y.maxAge}if(y.domain){if(!e.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);_+="; Domain="+y.domain}if(y.path){if(!n.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);_+="; Path="+y.path}if(y.expires){if(!p(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);_+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(_+="; HttpOnly"),y.secure&&(_+="; Secure"),y.partitioned&&(_+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":_+="; Priority=Low";break;case"medium":_+="; Priority=Medium";break;case"high":_+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":_+="; SameSite=Strict";break;case"lax":_+="; SameSite=Lax";break;case"none":_+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return _}function d(f){if(f.indexOf("%")===-1)return f;try{return decodeURIComponent(f)}catch{return f}}function p(f){return i.call(f)==="[object Date]"}return Hh}EL();/**
 * react-router v7.0.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var eC="popstate";function IL(r={}){function t(n,i){let{pathname:o,search:a,hash:s}=n.location;return dw("",{pathname:o,search:a,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function e(n,i){return typeof i=="string"?i:bd(i)}return SL(t,e,null,r)}function cn(r,t){if(r===!1||r===null||typeof r>"u")throw new Error(t)}function Ps(r,t){if(!r){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function CL(){return Math.random().toString(36).substring(2,10)}function tC(r,t){return{usr:r.state,key:r.key,idx:t}}function dw(r,t,e=null,n){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof t=="string"?Uc(t):t,state:e,key:t&&t.key||n||CL()}}function bd({pathname:r="/",search:t="",hash:e=""}){return t&&t!=="?"&&(r+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(r+=e.charAt(0)==="#"?e:"#"+e),r}function Uc(r){let t={};if(r){let e=r.indexOf("#");e>=0&&(t.hash=r.substring(e),r=r.substring(0,e));let n=r.indexOf("?");n>=0&&(t.search=r.substring(n),r=r.substring(0,n)),r&&(t.pathname=r)}return t}function SL(r,t,e,n={}){let{window:i=document.defaultView,v5Compat:o=!1}=n,a=i.history,s="POP",u=null,c=d();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function d(){return(a.state||{idx:null}).idx}function p(){s="POP";let b=d(),_=b==null?null:b-c;c=b,u&&u({action:s,location:x.location,delta:_})}function f(b,_){s="PUSH";let C=dw(x.location,b,_);c=d()+1;let T=tC(C,c),D=x.createHref(C);try{a.pushState(T,"",D)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;i.location.assign(D)}o&&u&&u({action:s,location:x.location,delta:1})}function g(b,_){s="REPLACE";let C=dw(x.location,b,_);c=d();let T=tC(C,c),D=x.createHref(C);a.replaceState(T,"",D),o&&u&&u({action:s,location:x.location,delta:0})}function y(b){let _=i.location.origin!=="null"?i.location.origin:i.location.href,C=typeof b=="string"?b:bd(b);return C=C.replace(/ $/,"%20"),cn(_,`No window.location.(origin|href) available to create URL for href: ${C}`),new URL(C,_)}let x={get action(){return s},get location(){return r(i,a)},listen(b){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(eC,p),u=b,()=>{i.removeEventListener(eC,p),u=null}},createHref(b){return t(i,b)},createURL:y,encodeLocation(b){let _=y(b);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:f,replace:g,go(b){return a.go(b)}};return x}function HT(r,t,e="/"){return TL(r,t,e,!1)}function TL(r,t,e,n){let i=typeof t=="string"?Uc(t):t,o=Es(i.pathname||"/",e);if(o==null)return null;let a=$T(r);AL(a);let s=null;for(let u=0;s==null&&u<a.length;++u){let c=VL(o);s=FL(a[u],c,n)}return s}function $T(r,t=[],e=[],n=""){let i=(o,a,s)=>{let u={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};u.relativePath.startsWith("/")&&(cn(u.relativePath.startsWith(n),`Absolute route path "${u.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(n.length));let c=ca([n,u.relativePath]),d=e.concat(u);o.children&&o.children.length>0&&(cn(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),$T(o.children,t,d,c)),!(o.path==null&&!o.index)&&t.push({path:c,score:ML(c,o.index),routesMeta:d})};return r.forEach((o,a)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))i(o,a);else for(let u of GT(o.path))i(o,a,u)}),t}function GT(r){let t=r.split("/");if(t.length===0)return[];let[e,...n]=t,i=e.endsWith("?"),o=e.replace(/\?$/,"");if(n.length===0)return i?[o,""]:[o];let a=GT(n.join("/")),s=[];return s.push(...a.map(u=>u===""?o:[o,u].join("/"))),i&&s.push(...a),s.map(u=>r.startsWith("/")&&u===""?"/":u)}function AL(r){r.sort((t,e)=>t.score!==e.score?e.score-t.score:LL(t.routesMeta.map(n=>n.childrenIndex),e.routesMeta.map(n=>n.childrenIndex)))}var RL=/^:[\w-]+$/,kL=3,NL=2,DL=1,OL=10,PL=-2,nC=r=>r==="*";function ML(r,t){let e=r.split("/"),n=e.length;return e.some(nC)&&(n+=PL),t&&(n+=NL),e.filter(i=>!nC(i)).reduce((i,o)=>i+(RL.test(o)?kL:o===""?DL:OL),n)}function LL(r,t){return r.length===t.length&&r.slice(0,-1).every((n,i)=>n===t[i])?r[r.length-1]-t[t.length-1]:0}function FL(r,t,e=!1){let{routesMeta:n}=r,i={},o="/",a=[];for(let s=0;s<n.length;++s){let u=n[s],c=s===n.length-1,d=o==="/"?t:t.slice(o.length)||"/",p=Bm({path:u.relativePath,caseSensitive:u.caseSensitive,end:c},d),f=u.route;if(!p&&c&&e&&!n[n.length-1].route.index&&(p=Bm({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},d)),!p)return null;Object.assign(i,p.params),a.push({params:i,pathname:ca([o,p.pathname]),pathnameBase:WL(ca([o,p.pathnameBase])),route:f}),p.pathnameBase!=="/"&&(o=ca([o,p.pathnameBase]))}return a}function Bm(r,t){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[e,n]=zL(r.path,r.caseSensitive,r.end),i=t.match(e);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:n.reduce((c,{paramName:d,isOptional:p},f)=>{if(d==="*"){let y=s[f]||"";a=o.slice(0,o.length-y.length).replace(/(.)\/+$/,"$1")}const g=s[f];return p&&!g?c[d]=void 0:c[d]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:o,pathnameBase:a,pattern:r}}function zL(r,t=!1,e=!0){Ps(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,u)=>(n.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function VL(r){try{return r.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Ps(!1,`The URL path "${r}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),r}}function Es(r,t){if(t==="/")return r;if(!r.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,n=r.charAt(e);return n&&n!=="/"?null:r.slice(e)||"/"}function BL(r,t="/"){let{pathname:e,search:n="",hash:i=""}=typeof r=="string"?Uc(r):r;return{pathname:e?e.startsWith("/")?e:UL(e,t):t,search:qL(n),hash:HL(i)}}function UL(r,t){let e=t.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?e.length>1&&e.pop():i!=="."&&e.push(i)}),e.length>1?e.join("/"):"/"}function E0(r,t,e,n){return`Cannot include a '${r}' character in a manually specified \`to.${t}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function jL(r){return r.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function KT(r){let t=jL(r);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function XT(r,t,e,n=!1){let i;typeof r=="string"?i=Uc(r):(i={...r},cn(!i.pathname||!i.pathname.includes("?"),E0("?","pathname","search",i)),cn(!i.pathname||!i.pathname.includes("#"),E0("#","pathname","hash",i)),cn(!i.search||!i.search.includes("#"),E0("#","search","hash",i)));let o=r===""||i.pathname==="",a=o?"/":i.pathname,s;if(a==null)s=e;else{let p=t.length-1;if(!n&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),p-=1;i.pathname=f.join("/")}s=p>=0?t[p]:"/"}let u=BL(i,s),c=a&&a!=="/"&&a.endsWith("/"),d=(o||a===".")&&e.endsWith("/");return!u.pathname.endsWith("/")&&(c||d)&&(u.pathname+="/"),u}var ca=r=>r.join("/").replace(/\/\/+/g,"/"),WL=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),qL=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,HL=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function $L(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var QT=["POST","PUT","PATCH","DELETE"];new Set(QT);var GL=["GET",...QT];new Set(GL);var jc=fe.createContext(null);jc.displayName="DataRouter";var Sg=fe.createContext(null);Sg.displayName="DataRouterState";var YT=fe.createContext({isTransitioning:!1});YT.displayName="ViewTransition";var KL=fe.createContext(new Map);KL.displayName="Fetchers";var XL=fe.createContext(null);XL.displayName="Await";var Po=fe.createContext(null);Po.displayName="Navigation";var Hd=fe.createContext(null);Hd.displayName="Location";var Ca=fe.createContext({outlet:null,matches:[],isDataRoute:!1});Ca.displayName="Route";var N1=fe.createContext(null);N1.displayName="RouteError";function QL(r,{relative:t}={}){cn($d(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:n}=fe.useContext(Po),{hash:i,pathname:o,search:a}=Kd(r,{relative:t}),s=o;return e!=="/"&&(s=o==="/"?e:ca([e,o])),n.createHref({pathname:s,search:a,hash:i})}function $d(){return fe.useContext(Hd)!=null}function Xu(){return cn($d(),"useLocation() may be used only in the context of a <Router> component."),fe.useContext(Hd).location}var JT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ZT(r){fe.useContext(Po).static||fe.useLayoutEffect(r)}function Gd(){let{isDataRoute:r}=fe.useContext(Ca);return r?lF():YL()}function YL(){cn($d(),"useNavigate() may be used only in the context of a <Router> component.");let r=fe.useContext(jc),{basename:t,navigator:e}=fe.useContext(Po),{matches:n}=fe.useContext(Ca),{pathname:i}=Xu(),o=JSON.stringify(KT(n)),a=fe.useRef(!1);return ZT(()=>{a.current=!0}),fe.useCallback((u,c={})=>{if(Ps(a.current,JT),!a.current)return;if(typeof u=="number"){e.go(u);return}let d=XT(u,JSON.parse(o),i,c.relative==="path");r==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:ca([t,d.pathname])),(c.replace?e.replace:e.push)(d,c.state,c)},[t,e,o,i,r])}fe.createContext(null);function Kd(r,{relative:t}={}){let{matches:e}=fe.useContext(Ca),{pathname:n}=Xu(),i=JSON.stringify(KT(e));return fe.useMemo(()=>XT(r,JSON.parse(i),n,t==="path"),[r,i,n,t])}function JL(r,t){return e2(r,t)}function e2(r,t,e,n){var x;cn($d(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=fe.useContext(Po),{matches:o}=fe.useContext(Ca),a=o[o.length-1],s=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let c=Xu(),d;if(t){let b=typeof t=="string"?Uc(t):t;cn(u==="/"||((x=b.pathname)==null?void 0:x.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${b.pathname}" was given in the \`location\` prop.`),d=b}else d=c;let p=d.pathname||"/",f=p;if(u!=="/"){let b=u.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(b.length).join("/")}let g=HT(r,{pathname:f}),y=rF(g&&g.map(b=>Object.assign({},b,{params:Object.assign({},s,b.params),pathname:ca([u,i.encodeLocation?i.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?u:ca([u,i.encodeLocation?i.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),o,e,n);return t&&y?fe.createElement(Hd.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...d},navigationType:"POP"}},y):y}function ZL(){let r=uF(),t=$L(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),e=r instanceof Error?r.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},t),e?fe.createElement("pre",{style:i},e):null,null)}var eF=fe.createElement(ZL,null),tF=class extends fe.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,t){return t.location!==r.location||t.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:t.error,location:t.location,revalidation:r.revalidation||t.revalidation}}componentDidCatch(r,t){console.error("React Router caught the following error during render",r,t)}render(){return this.state.error!==void 0?fe.createElement(Ca.Provider,{value:this.props.routeContext},fe.createElement(N1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function nF({routeContext:r,match:t,children:e}){let n=fe.useContext(jc);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),fe.createElement(Ca.Provider,{value:r},e)}function rF(r,t=[],e=null,n=null){if(r==null){if(!e)return null;if(e.errors)r=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)r=e.matches;else return null}let i=r,o=e==null?void 0:e.errors;if(o!=null){let u=i.findIndex(c=>c.route.id&&(o==null?void 0:o[c.route.id])!==void 0);cn(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,u+1))}let a=!1,s=-1;if(e)for(let u=0;u<i.length;u++){let c=i[u];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(s=u),c.route.id){let{loaderData:d,errors:p}=e,f=c.route.loader&&!d.hasOwnProperty(c.route.id)&&(!p||p[c.route.id]===void 0);if(c.route.lazy||f){a=!0,s>=0?i=i.slice(0,s+1):i=[i[0]];break}}}return i.reduceRight((u,c,d)=>{let p,f=!1,g=null,y=null;e&&(p=o&&c.route.id?o[c.route.id]:void 0,g=c.route.errorElement||eF,a&&(s<0&&d===0?(cF("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),f=!0,y=null):s===d&&(f=!0,y=c.route.hydrateFallbackElement||null)));let x=t.concat(i.slice(0,d+1)),b=()=>{let _;return p?_=g:f?_=y:c.route.Component?_=fe.createElement(c.route.Component,null):c.route.element?_=c.route.element:_=u,fe.createElement(nF,{match:c,routeContext:{outlet:u,matches:x,isDataRoute:e!=null},children:_})};return e&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?fe.createElement(tF,{location:e.location,revalidation:e.revalidation,component:g,error:p,children:b(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):b()},null)}function D1(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function iF(r){let t=fe.useContext(jc);return cn(t,D1(r)),t}function oF(r){let t=fe.useContext(Sg);return cn(t,D1(r)),t}function aF(r){let t=fe.useContext(Ca);return cn(t,D1(r)),t}function O1(r){let t=aF(r),e=t.matches[t.matches.length-1];return cn(e.route.id,`${r} can only be used on routes that contain a unique "id"`),e.route.id}function sF(){return O1("useRouteId")}function uF(){var n;let r=fe.useContext(N1),t=oF("useRouteError"),e=O1("useRouteError");return r!==void 0?r:(n=t.errors)==null?void 0:n[e]}function lF(){let{router:r}=iF("useNavigate"),t=O1("useNavigate"),e=fe.useRef(!1);return ZT(()=>{e.current=!0}),fe.useCallback(async(i,o={})=>{Ps(e.current,JT),e.current&&(typeof i=="number"?r.navigate(i):await r.navigate(i,{fromRouteId:t,...o}))},[r,t])}var rC={};function cF(r,t,e){rC[r]||(rC[r]=!0,Ps(!1,e))}fe.memo(hF);function hF({routes:r,future:t,state:e}){return e2(r,void 0,e,t)}function Zl(r){cn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function dF({basename:r="/",children:t=null,location:e,navigationType:n="POP",navigator:i,static:o=!1}){cn(!$d(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=r.replace(/^\/*/,"/"),s=fe.useMemo(()=>({basename:a,navigator:i,static:o,future:{}}),[a,i,o]);typeof e=="string"&&(e=Uc(e));let{pathname:u="/",search:c="",hash:d="",state:p=null,key:f="default"}=e,g=fe.useMemo(()=>{let y=Es(u,a);return y==null?null:{location:{pathname:y,search:c,hash:d,state:p,key:f},navigationType:n}},[a,u,c,d,p,f,n]);return Ps(g!=null,`<Router basename="${a}"> is not able to match the URL "${u}${c}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:fe.createElement(Po.Provider,{value:s},fe.createElement(Hd.Provider,{children:t,value:g}))}function pF({children:r,location:t}){return JL(pw(r),t)}function pw(r,t=[]){let e=[];return fe.Children.forEach(r,(n,i)=>{if(!fe.isValidElement(n))return;let o=[...t,i];if(n.type===fe.Fragment){e.push.apply(e,pw(n.props.children,o));return}cn(n.type===Zl,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),cn(!n.props.index||!n.props.children,"An index route cannot have child routes.");let a={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=pw(n.props.children,o)),e.push(a)}),e}var dm="get",pm="application/x-www-form-urlencoded";function Tg(r){return r!=null&&typeof r.tagName=="string"}function fF(r){return Tg(r)&&r.tagName.toLowerCase()==="button"}function mF(r){return Tg(r)&&r.tagName.toLowerCase()==="form"}function gF(r){return Tg(r)&&r.tagName.toLowerCase()==="input"}function vF(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function yF(r,t){return r.button===0&&(!t||t==="_self")&&!vF(r)}var Hf=null;function wF(){if(Hf===null)try{new FormData(document.createElement("form"),0),Hf=!1}catch{Hf=!0}return Hf}var bF=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function I0(r){return r!=null&&!bF.has(r)?(Ps(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${pm}"`),null):r}function xF(r,t){let e,n,i,o,a;if(mF(r)){let s=r.getAttribute("action");n=s?Es(s,t):null,e=r.getAttribute("method")||dm,i=I0(r.getAttribute("enctype"))||pm,o=new FormData(r)}else if(fF(r)||gF(r)&&(r.type==="submit"||r.type==="image")){let s=r.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=r.getAttribute("formaction")||s.getAttribute("action");if(n=u?Es(u,t):null,e=r.getAttribute("formmethod")||s.getAttribute("method")||dm,i=I0(r.getAttribute("formenctype"))||I0(s.getAttribute("enctype"))||pm,o=new FormData(s,r),!wF()){let{name:c,type:d,value:p}=r;if(d==="image"){let f=c?`${c}.`:"";o.append(`${f}x`,"0"),o.append(`${f}y`,"0")}else c&&o.append(c,p)}}else{if(Tg(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=dm,n=null,i=pm,a=r}return o&&i==="text/plain"&&(a=o,o=void 0),{action:n,method:e.toLowerCase(),encType:i,formData:o,body:a}}function P1(r,t){if(r===!1||r===null||typeof r>"u")throw new Error(t)}async function _F(r,t){if(r.id in t)return t[r.id];try{let e=await import(r.module);return t[r.id]=e,e}catch(e){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function EF(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function IF(r,t,e){let n=await Promise.all(r.map(async i=>{let o=t.routes[i.route.id];if(o){let a=await _F(o,e);return a.links?a.links():[]}return[]}));return AF(n.flat(1).filter(EF).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function iC(r,t,e,n,i,o){let a=(u,c)=>e[c]?u.route.id!==e[c].route.id:!0,s=(u,c)=>{var d;return e[c].pathname!==u.pathname||((d=e[c].route.path)==null?void 0:d.endsWith("*"))&&e[c].params["*"]!==u.params["*"]};return o==="assets"?t.filter((u,c)=>a(u,c)||s(u,c)):o==="data"?t.filter((u,c)=>{var p;let d=n.routes[u.route.id];if(!d||!d.hasLoader)return!1;if(a(u,c)||s(u,c))return!0;if(u.route.shouldRevalidate){let f=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((p=e[0])==null?void 0:p.params)||{},nextUrl:new URL(r,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function CF(r,t){return SF(r.map(e=>{let n=t.routes[e.route.id];if(!n)return[];let i=[n.module];return n.imports&&(i=i.concat(n.imports)),i}).flat(1))}function SF(r){return[...new Set(r)]}function TF(r){let t={},e=Object.keys(r).sort();for(let n of e)t[n]=r[n];return t}function AF(r,t){let e=new Set;return new Set(t),r.reduce((n,i)=>{let o=JSON.stringify(TF(i));return e.has(o)||(e.add(o),n.push({key:o,link:i})),n},[])}function RF(r){let t=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return t.pathname==="/"?t.pathname="_root.data":t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function kF(){let r=fe.useContext(jc);return P1(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function NF(){let r=fe.useContext(Sg);return P1(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var M1=fe.createContext(void 0);M1.displayName="FrameworkContext";function t2(){let r=fe.useContext(M1);return P1(r,"You must render this element inside a <HydratedRouter> element"),r}function DF(r,t){let e=fe.useContext(M1),[n,i]=fe.useState(!1),[o,a]=fe.useState(!1),{onFocus:s,onBlur:u,onMouseEnter:c,onMouseLeave:d,onTouchStart:p}=t,f=fe.useRef(null);fe.useEffect(()=>{if(r==="render"&&a(!0),r==="viewport"){let x=_=>{_.forEach(C=>{a(C.isIntersecting)})},b=new IntersectionObserver(x,{threshold:.5});return f.current&&b.observe(f.current),()=>{b.disconnect()}}},[r]),fe.useEffect(()=>{if(n){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[n]);let g=()=>{i(!0)},y=()=>{i(!1),a(!1)};return e?r!=="intent"?[o,f,{}]:[o,f,{onFocus:$h(s,g),onBlur:$h(u,y),onMouseEnter:$h(c,g),onMouseLeave:$h(d,y),onTouchStart:$h(p,g)}]:[!1,f,{}]}function $h(r,t){return e=>{r&&r(e),e.defaultPrevented||t(e)}}function OF({page:r,...t}){let{router:e}=kF(),n=fe.useMemo(()=>HT(e.routes,r,e.basename),[e.routes,r,e.basename]);return n?fe.createElement(MF,{page:r,matches:n,...t}):(console.warn(`Tried to prefetch ${r} but no routes matched.`),null)}function PF(r){let{manifest:t,routeModules:e}=t2(),[n,i]=fe.useState([]);return fe.useEffect(()=>{let o=!1;return IF(r,t,e).then(a=>{o||i(a)}),()=>{o=!0}},[r,t,e]),n}function MF({page:r,matches:t,...e}){let n=Xu(),{manifest:i,routeModules:o}=t2(),{loaderData:a,matches:s}=NF(),u=fe.useMemo(()=>iC(r,t,s,i,n,"data"),[r,t,s,i,n]),c=fe.useMemo(()=>iC(r,t,s,i,n,"assets"),[r,t,s,i,n]),d=fe.useMemo(()=>{if(r===n.pathname+n.search+n.hash)return[];let g=new Set,y=!1;if(t.forEach(b=>{var C;let _=i.routes[b.route.id];!_||!_.hasLoader||(!u.some(T=>T.route.id===b.route.id)&&b.route.id in a&&((C=o[b.route.id])!=null&&C.shouldRevalidate)||_.hasClientLoader?y=!0:g.add(b.route.id))}),g.size===0)return[];let x=RF(r);return y&&g.size>0&&x.searchParams.set("_routes",t.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[x.pathname+x.search]},[a,n,i,u,t,r,o]),p=fe.useMemo(()=>CF(c,i),[c,i]),f=PF(c);return fe.createElement(fe.Fragment,null,d.map(g=>fe.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...e})),p.map(g=>fe.createElement("link",{key:g,rel:"modulepreload",href:g,...e})),f.map(({key:g,link:y})=>fe.createElement("link",{key:g,...y})))}function LF(...r){return t=>{r.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var n2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{n2&&(window.__reactRouterVersion="7.0.1")}catch{}function FF({basename:r,children:t,window:e}){let n=fe.useRef();n.current==null&&(n.current=IL({window:e,v5Compat:!0}));let i=n.current,[o,a]=fe.useState({action:i.action,location:i.location}),s=fe.useCallback(u=>{fe.startTransition(()=>a(u))},[a]);return fe.useLayoutEffect(()=>i.listen(s),[i,s]),fe.createElement(dF,{basename:r,children:t,location:o.location,navigationType:o.action,navigator:i})}var r2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bo=fe.forwardRef(function({onClick:t,discover:e="render",prefetch:n="none",relative:i,reloadDocument:o,replace:a,state:s,target:u,to:c,preventScrollReset:d,viewTransition:p,...f},g){let{basename:y}=fe.useContext(Po),x=typeof c=="string"&&r2.test(c),b,_=!1;if(typeof c=="string"&&x&&(b=c,n2))try{let A=new URL(window.location.href),N=c.startsWith("//")?new URL(A.protocol+c):new URL(c),P=Es(N.pathname,y);N.origin===A.origin&&P!=null?c=P+N.search+N.hash:_=!0}catch{Ps(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=QL(c,{relative:i}),[T,D,O]=DF(n,f),z=UF(c,{replace:a,state:s,target:u,preventScrollReset:d,relative:i,viewTransition:p});function I(A){t&&t(A),A.defaultPrevented||z(A)}let S=fe.createElement("a",{...f,...O,href:b||C,onClick:_||o?t:I,ref:LF(g,D),target:u,"data-discover":!x&&e==="render"?"true":void 0});return T&&!x?fe.createElement(fe.Fragment,null,S,fe.createElement(OF,{page:C})):S});bo.displayName="Link";var zF=fe.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:n="",end:i=!1,style:o,to:a,viewTransition:s,children:u,...c},d){let p=Kd(a,{relative:c.relative}),f=Xu(),g=fe.useContext(Sg),{navigator:y,basename:x}=fe.useContext(Po),b=g!=null&&$F(p)&&s===!0,_=y.encodeLocation?y.encodeLocation(p).pathname:p.pathname,C=f.pathname,T=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;e||(C=C.toLowerCase(),T=T?T.toLowerCase():null,_=_.toLowerCase()),T&&x&&(T=Es(T,x)||T);const D=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let O=C===_||!i&&C.startsWith(_)&&C.charAt(D)==="/",z=T!=null&&(T===_||!i&&T.startsWith(_)&&T.charAt(_.length)==="/"),I={isActive:O,isPending:z,isTransitioning:b},S=O?t:void 0,A;typeof n=="function"?A=n(I):A=[n,O?"active":null,z?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let N=typeof o=="function"?o(I):o;return fe.createElement(bo,{...c,"aria-current":S,className:A,ref:d,style:N,to:a,viewTransition:s},typeof u=="function"?u(I):u)});zF.displayName="NavLink";var VF=fe.forwardRef(({discover:r="render",fetcherKey:t,navigate:e,reloadDocument:n,replace:i,state:o,method:a=dm,action:s,onSubmit:u,relative:c,preventScrollReset:d,viewTransition:p,...f},g)=>{let y=qF(),x=HF(s,{relative:c}),b=a.toLowerCase()==="get"?"get":"post",_=typeof s=="string"&&r2.test(s),C=T=>{if(u&&u(T),T.defaultPrevented)return;T.preventDefault();let D=T.nativeEvent.submitter,O=(D==null?void 0:D.getAttribute("formmethod"))||a;y(D||T.currentTarget,{fetcherKey:t,method:O,navigate:e,replace:i,state:o,relative:c,preventScrollReset:d,viewTransition:p})};return fe.createElement("form",{ref:g,method:b,action:x,onSubmit:n?u:C,...f,"data-discover":!_&&r==="render"?"true":void 0})});VF.displayName="Form";function BF(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function i2(r){let t=fe.useContext(jc);return cn(t,BF(r)),t}function UF(r,{target:t,replace:e,state:n,preventScrollReset:i,relative:o,viewTransition:a}={}){let s=Gd(),u=Xu(),c=Kd(r,{relative:o});return fe.useCallback(d=>{if(yF(d,t)){d.preventDefault();let p=e!==void 0?e:bd(u)===bd(c);s(r,{replace:p,state:n,preventScrollReset:i,relative:o,viewTransition:a})}},[u,s,c,e,n,t,r,i,o,a])}var jF=0,WF=()=>`__${String(++jF)}__`;function qF(){let{router:r}=i2("useSubmit"),{basename:t}=fe.useContext(Po),e=sF();return fe.useCallback(async(n,i={})=>{let{action:o,method:a,encType:s,formData:u,body:c}=xF(n,t);if(i.navigate===!1){let d=i.fetcherKey||WF();await r.fetch(d,e,i.action||o,{preventScrollReset:i.preventScrollReset,formData:u,body:c,formMethod:i.method||a,formEncType:i.encType||s,flushSync:i.flushSync})}else await r.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:u,body:c,formMethod:i.method||a,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:e,flushSync:i.flushSync,viewTransition:i.viewTransition})},[r,t,e])}function HF(r,{relative:t}={}){let{basename:e}=fe.useContext(Po),n=fe.useContext(Ca);cn(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),o={...Kd(r||".",{relative:t})},a=Xu();if(r==null){o.search=a.search;let s=new URLSearchParams(o.search),u=s.getAll("index");if(u.some(d=>d==="")){s.delete("index"),u.filter(p=>p).forEach(p=>s.append("index",p));let d=s.toString();o.search=d?`?${d}`:""}}return(!r||r===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(o.pathname=o.pathname==="/"?e:ca([e,o.pathname])),bd(o)}function $F(r,t={}){let e=fe.useContext(YT);cn(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=i2("useViewTransitionState"),i=Kd(r,{relative:t.relative});if(!e.isTransitioning)return!1;let o=Es(e.currentLocation.pathname,n)||e.currentLocation.pathname,a=Es(e.nextLocation.pathname,n)||e.nextLocation.pathname;return Bm(i.pathname,a)!=null||Bm(i.pathname,o)!=null}new TextEncoder;var oC={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128)}return t},GF=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const i=r[e++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const o=r[e++];t[n++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=r[e++],a=r[e++],s=r[e++],u=((i&7)<<18|(o&63)<<12|(a&63)<<6|s&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const o=r[e++],a=r[e++];t[n++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return t.join("")},a2={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const o=r[i],a=i+1<r.length,s=a?r[i+1]:0,u=i+2<r.length,c=u?r[i+2]:0,d=o>>2,p=(o&3)<<4|s>>4;let f=(s&15)<<2|c>>6,g=c&63;u||(g=64,a||(f=64)),n.push(e[d],e[p],e[f],e[g])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(o2(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):GF(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const o=e[r.charAt(i++)],s=i<r.length?e[r.charAt(i)]:0;++i;const c=i<r.length?e[r.charAt(i)]:64;++i;const p=i<r.length?e[r.charAt(i)]:64;if(++i,o==null||s==null||c==null||p==null)throw new KF;const f=o<<2|s>>4;if(n.push(f),c!==64){const g=s<<4&240|c>>2;if(n.push(g),p!==64){const y=c<<6&192|p;n.push(y)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class KF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const XF=function(r){const t=o2(r);return a2.encodeByteArray(t,!0)},Um=function(r){return XF(r).replace(/\./g,"")},s2=function(r){try{return a2.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YF=()=>QF().__FIREBASE_DEFAULTS__,JF=()=>{if(typeof process>"u"||typeof oC>"u")return;const r=oC.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},ZF=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&s2(r[1]);return t&&JSON.parse(t)},Ag=()=>{try{return YF()||JF()||ZF()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},u2=r=>{var t,e;return(e=(t=Ag())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[r]},e3=r=>{const t=u2(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},l2=()=>{var r;return(r=Ag())===null||r===void 0?void 0:r.config},c2=r=>{var t;return(t=Ag())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n3(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",i=r.iat||0,o=r.sub||r.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},r);return[Um(JSON.stringify(e)),Um(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function r3(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wr())}function i3(){var r;const t=(r=Ag())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function o3(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function a3(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function s3(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function u3(){const r=wr();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function l3(){return!i3()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function c3(){try{return typeof indexedDB=="object"}catch{return!1}}function h3(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var o;t(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d3="FirebaseError";class Sa extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=d3,Object.setPrototypeOf(this,Sa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xd.prototype.create)}}class Xd{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,o=this.errors[t],a=o?p3(o,n):"Error",s=`${this.serviceName}: ${a} (${i}).`;return new Sa(i,s,n)}}function p3(r,t){return r.replace(f3,(e,n)=>{const i=t[n];return i!=null?String(i):`<${n}?>`})}const f3=/\{\$([^}]+)}/g;function m3(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function jm(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const i of e){if(!n.includes(i))return!1;const o=r[i],a=t[i];if(aC(o)&&aC(a)){if(!jm(o,a))return!1}else if(o!==a)return!1}for(const i of n)if(!e.includes(i))return!1;return!0}function aC(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(r){const t=[];for(const[e,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function ed(r){const t={};return r.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,o]=n.split("=");t[decodeURIComponent(i)]=decodeURIComponent(o)}}),t}function td(r){const t=r.indexOf("?");if(!t)return"";const e=r.indexOf("#",t);return r.substring(t,e>0?e:void 0)}function g3(r,t){const e=new v3(r,t);return e.subscribe.bind(e)}class v3{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let i;if(t===void 0&&e===void 0&&n===void 0)throw new Error("Missing Observer.");y3(t,["next","error","complete"])?i=t:i={next:t,error:e,complete:n},i.next===void 0&&(i.next=C0),i.error===void 0&&(i.error=C0),i.complete===void 0&&(i.complete=C0);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function y3(r,t){if(typeof r!="object"||r===null)return!1;for(const e of t)if(e in r&&typeof r[e]=="function")return!0;return!1}function C0(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(r){return r&&r._delegate?r._delegate:r}class Vu{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w3{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new t3;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(e=t==null?void 0:t.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(x3(t))try{this.getOrInitializeService({instanceIdentifier:wu})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:i});n.resolve(o)}catch{}}}}clearInstance(t=wu){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=wu){return this.instances.has(t)}getOptions(t=wu){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[o,a]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(o);n===s&&a.resolve(i)}return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),o=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;o.add(t),this.onInitCallbacks.set(i,o);const a=this.instances.get(i);return a&&t(a,i),()=>{o.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:b3(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=wu){return this.component?this.component.multipleInstances?t:wu:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function b3(r){return r===wu?void 0:r}function x3(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _3{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new w3(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Et||(Et={}));const E3={debug:Et.DEBUG,verbose:Et.VERBOSE,info:Et.INFO,warn:Et.WARN,error:Et.ERROR,silent:Et.SILENT},I3=Et.INFO,C3={[Et.DEBUG]:"log",[Et.VERBOSE]:"log",[Et.INFO]:"info",[Et.WARN]:"warn",[Et.ERROR]:"error"},S3=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),i=C3[t];if(i)console[i](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class L1{constructor(t){this.name=t,this._logLevel=I3,this._logHandler=S3,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Et))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?E3[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Et.DEBUG,...t),this._logHandler(this,Et.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Et.VERBOSE,...t),this._logHandler(this,Et.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Et.INFO,...t),this._logHandler(this,Et.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Et.WARN,...t),this._logHandler(this,Et.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Et.ERROR,...t),this._logHandler(this,Et.ERROR,...t)}}const T3=(r,t)=>t.some(e=>r instanceof e);let sC,uC;function A3(){return sC||(sC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function R3(){return uC||(uC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const h2=new WeakMap,fw=new WeakMap,d2=new WeakMap,S0=new WeakMap,F1=new WeakMap;function k3(r){const t=new Promise((e,n)=>{const i=()=>{r.removeEventListener("success",o),r.removeEventListener("error",a)},o=()=>{e(fs(r.result)),i()},a=()=>{n(r.error),i()};r.addEventListener("success",o),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&h2.set(e,r)}).catch(()=>{}),F1.set(t,r),t}function N3(r){if(fw.has(r))return;const t=new Promise((e,n)=>{const i=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",a),r.removeEventListener("abort",a)},o=()=>{e(),i()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",o),r.addEventListener("error",a),r.addEventListener("abort",a)});fw.set(r,t)}let mw={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return fw.get(r);if(t==="objectStoreNames")return r.objectStoreNames||d2.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return fs(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function D3(r){mw=r(mw)}function O3(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(T0(this),t,...e);return d2.set(n,t.sort?t.sort():[t]),fs(n)}:R3().includes(r)?function(...t){return r.apply(T0(this),t),fs(h2.get(this))}:function(...t){return fs(r.apply(T0(this),t))}}function P3(r){return typeof r=="function"?O3(r):(r instanceof IDBTransaction&&N3(r),T3(r,A3())?new Proxy(r,mw):r)}function fs(r){if(r instanceof IDBRequest)return k3(r);if(S0.has(r))return S0.get(r);const t=P3(r);return t!==r&&(S0.set(r,t),F1.set(t,r)),t}const T0=r=>F1.get(r);function M3(r,t,{blocked:e,upgrade:n,blocking:i,terminated:o}={}){const a=indexedDB.open(r,t),s=fs(a);return n&&a.addEventListener("upgradeneeded",u=>{n(fs(a.result),u.oldVersion,u.newVersion,fs(a.transaction),u)}),e&&a.addEventListener("blocked",u=>e(u.oldVersion,u.newVersion,u)),s.then(u=>{o&&u.addEventListener("close",()=>o()),i&&u.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),s}const L3=["get","getKey","getAll","getAllKeys","count"],F3=["put","add","delete","clear"],A0=new Map;function lC(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(A0.get(t))return A0.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,i=F3.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(i||L3.includes(e)))return;const o=async function(a,...s){const u=this.transaction(a,i?"readwrite":"readonly");let c=u.store;return n&&(c=c.index(s.shift())),(await Promise.all([c[e](...s),i&&u.done]))[0]};return A0.set(t,o),o}D3(r=>({...r,get:(t,e,n)=>lC(t,e)||r.get(t,e,n),has:(t,e)=>!!lC(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z3{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(V3(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function V3(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const gw="@firebase/app",cC="0.10.16";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const va=new L1("@firebase/app"),B3="@firebase/app-compat",U3="@firebase/analytics-compat",j3="@firebase/analytics",W3="@firebase/app-check-compat",q3="@firebase/app-check",H3="@firebase/auth",$3="@firebase/auth-compat",G3="@firebase/database",K3="@firebase/data-connect",X3="@firebase/database-compat",Q3="@firebase/functions",Y3="@firebase/functions-compat",J3="@firebase/installations",Z3="@firebase/installations-compat",e4="@firebase/messaging",t4="@firebase/messaging-compat",n4="@firebase/performance",r4="@firebase/performance-compat",i4="@firebase/remote-config",o4="@firebase/remote-config-compat",a4="@firebase/storage",s4="@firebase/storage-compat",u4="@firebase/firestore",l4="@firebase/vertexai",c4="@firebase/firestore-compat",h4="firebase",d4="11.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw="[DEFAULT]",p4={[gw]:"fire-core",[B3]:"fire-core-compat",[j3]:"fire-analytics",[U3]:"fire-analytics-compat",[q3]:"fire-app-check",[W3]:"fire-app-check-compat",[H3]:"fire-auth",[$3]:"fire-auth-compat",[G3]:"fire-rtdb",[K3]:"fire-data-connect",[X3]:"fire-rtdb-compat",[Q3]:"fire-fn",[Y3]:"fire-fn-compat",[J3]:"fire-iid",[Z3]:"fire-iid-compat",[e4]:"fire-fcm",[t4]:"fire-fcm-compat",[n4]:"fire-perf",[r4]:"fire-perf-compat",[i4]:"fire-rc",[o4]:"fire-rc-compat",[a4]:"fire-gcs",[s4]:"fire-gcs-compat",[u4]:"fire-fst",[c4]:"fire-fst-compat",[l4]:"fire-vertex","fire-js":"fire-js",[h4]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm=new Map,f4=new Map,yw=new Map;function hC(r,t){try{r.container.addComponent(t)}catch(e){va.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function yc(r){const t=r.name;if(yw.has(t))return va.debug(`There were multiple attempts to register component ${t}.`),!1;yw.set(t,r);for(const e of Wm.values())hC(e,r);for(const e of f4.values())hC(e,r);return!0}function z1(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function Gi(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ms=new Xd("app","Firebase",m4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Vu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ms.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc=d4;function p2(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n=Object.assign({name:vw,automaticDataCollectionEnabled:!1},t),i=n.name;if(typeof i!="string"||!i)throw ms.create("bad-app-name",{appName:String(i)});if(e||(e=l2()),!e)throw ms.create("no-options");const o=Wm.get(i);if(o){if(jm(e,o.options)&&jm(n,o.config))return o;throw ms.create("duplicate-app",{appName:i})}const a=new _3(i);for(const u of yw.values())a.addComponent(u);const s=new g4(e,n,a);return Wm.set(i,s),s}function f2(r=vw){const t=Wm.get(r);if(!t&&r===vw&&l2())return p2();if(!t)throw ms.create("no-app",{appName:r});return t}function gs(r,t,e){var n;let i=(n=p4[r])!==null&&n!==void 0?n:r;e&&(i+=`-${e}`);const o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const s=[`Unable to register library "${i}" with version "${t}":`];o&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&s.push("and"),a&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),va.warn(s.join(" "));return}yc(new Vu(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4="firebase-heartbeat-database",y4=1,xd="firebase-heartbeat-store";let R0=null;function m2(){return R0||(R0=M3(v4,y4,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(xd)}catch(e){console.warn(e)}}}}).catch(r=>{throw ms.create("idb-open",{originalErrorMessage:r.message})})),R0}async function w4(r){try{const e=(await m2()).transaction(xd),n=await e.objectStore(xd).get(g2(r));return await e.done,n}catch(t){if(t instanceof Sa)va.warn(t.message);else{const e=ms.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});va.warn(e.message)}}}async function dC(r,t){try{const n=(await m2()).transaction(xd,"readwrite");await n.objectStore(xd).put(t,g2(r)),await n.done}catch(e){if(e instanceof Sa)va.warn(e.message);else{const n=ms.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});va.warn(n.message)}}}function g2(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4=1024,x4=30*24*60*60*1e3;class _4{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new I4(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var t,e;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=pC();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const s=new Date(a.date).valueOf();return Date.now()-s<=x4}),this._storage.overwrite(this._heartbeatsCache))}catch(n){va.warn(n)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=pC(),{heartbeatsToSend:n,unsentEntries:i}=E4(this._heartbeatsCache.heartbeats),o=Um(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(e){return va.warn(e),""}}}function pC(){return new Date().toISOString().substring(0,10)}function E4(r,t=b4){const e=[];let n=r.slice();for(const i of r){const o=e.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),fC(e)>t){o.dates.pop();break}}else if(e.push({agent:i.agent,dates:[i.date]}),fC(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class I4{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return c3()?h3().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await w4(this.app);return e!=null&&e.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return dC(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return dC(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function fC(r){return Um(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C4(r){yc(new Vu("platform-logger",t=>new z3(t),"PRIVATE")),yc(new Vu("heartbeat",t=>new _4(t),"PRIVATE")),gs(gw,cC,r),gs(gw,cC,"esm2017"),gs("fire-js","")}C4("");var S4="firebase",T4="11.0.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gs(S4,T4,"app");function V1(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function v2(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const A4=v2,y2=new Xd("auth","Firebase",v2());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qm=new L1("@firebase/auth");function R4(r,...t){qm.logLevel<=Et.WARN&&qm.warn(`Auth (${Wc}): ${r}`,...t)}function fm(r,...t){qm.logLevel<=Et.ERROR&&qm.error(`Auth (${Wc}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yi(r,...t){throw B1(r,...t)}function _o(r,...t){return B1(r,...t)}function w2(r,t,e){const n=Object.assign(Object.assign({},A4()),{[t]:e});return new Xd("auth","Firebase",n).create(t,{appName:r.name})}function Eo(r){return w2(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function B1(r,...t){if(typeof r!="string"){const e=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(e,...n)}return y2.create(r,...t)}function Je(r,t,...e){if(!r)throw B1(t,...e)}function sa(r){const t="INTERNAL ASSERTION FAILED: "+r;throw fm(t),new Error(t)}function ya(r,t){r||sa(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ww(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function k4(){return mC()==="http:"||mC()==="https:"}function mC(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N4(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(k4()||a3()||"connection"in navigator)?navigator.onLine:!0}function D4(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(t,e){this.shortDelay=t,this.longDelay=e,ya(e>t,"Short delay should be less than long delay!"),this.isMobile=r3()||s3()}get(){return N4()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U1(r,t){ya(r.emulator,"Emulator should always be set here");const{url:e}=r.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b2{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;sa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;sa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;sa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O4={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4=new Yd(3e4,6e4);function Ms(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Ta(r,t,e,n,i={}){return x2(r,i,async()=>{let o={},a={};n&&(t==="GET"?a=n:o={body:JSON.stringify(n)});const s=Qd(Object.assign({key:r.config.apiKey},a)).slice(1),u=await r._getAdditionalHeaders();u["Content-Type"]="application/json",r.languageCode&&(u["X-Firebase-Locale"]=r.languageCode);const c=Object.assign({method:t,headers:u},o);return o3()||(c.referrerPolicy="no-referrer"),b2.fetch()(_2(r,r.config.apiHost,e,s),c)})}async function x2(r,t,e){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},O4),t);try{const i=new L4(r),o=await Promise.race([e(),i.promise]);i.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw $f(r,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const s=o.ok?a.errorMessage:a.error.message,[u,c]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw $f(r,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw $f(r,"email-already-in-use",a);if(u==="USER_DISABLED")throw $f(r,"user-disabled",a);const d=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw w2(r,d,c);Yi(r,d)}}catch(i){if(i instanceof Sa)throw i;Yi(r,"network-request-failed",{message:String(i)})}}async function Jd(r,t,e,n,i={}){const o=await Ta(r,t,e,n,i);return"mfaPendingCredential"in o&&Yi(r,"multi-factor-auth-required",{_serverResponse:o}),o}function _2(r,t,e,n){const i=`${t}${e}?${n}`;return r.config.emulator?U1(r.config,i):`${r.config.apiScheme}://${i}`}function M4(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class L4{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,n)=>{this.timer=setTimeout(()=>n(_o(this.auth,"network-request-failed")),P4.get())})}}function $f(r,t,e){const n={appName:r.name};e.email&&(n.email=e.email),e.phoneNumber&&(n.phoneNumber=e.phoneNumber);const i=_o(r,t,n);return i.customData._tokenResponse=e,i}function gC(r){return r!==void 0&&r.enterprise!==void 0}class F4{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return M4(e.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function z4(r,t){return Ta(r,"GET","/v2/recaptchaConfig",Ms(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V4(r,t){return Ta(r,"POST","/v1/accounts:delete",t)}async function E2(r,t){return Ta(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function B4(r,t=!1){const e=Bn(r),n=await e.getIdToken(t),i=j1(n);Je(i&&i.exp&&i.auth_time&&i.iat,e.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,a=o==null?void 0:o.sign_in_provider;return{claims:i,token:n,authTime:hd(k0(i.auth_time)),issuedAtTime:hd(k0(i.iat)),expirationTime:hd(k0(i.exp)),signInProvider:a||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function k0(r){return Number(r)*1e3}function j1(r){const[t,e,n]=r.split(".");if(t===void 0||e===void 0||n===void 0)return fm("JWT malformed, contained fewer than 3 sections"),null;try{const i=s2(e);return i?JSON.parse(i):(fm("Failed to decode base64 JWT payload"),null)}catch(i){return fm("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function vC(r){const t=j1(r);return Je(t,"internal-error"),Je(typeof t.exp<"u","internal-error"),Je(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wc(r,t,e=!1){if(e)return t;try{return await t}catch(n){throw n instanceof Sa&&U4(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function U4({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=hd(this.lastLoginAt),this.creationTime=hd(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hm(r){var t;const e=r.auth,n=await r.getIdToken(),i=await wc(r,E2(e,{idToken:n}));Je(i==null?void 0:i.users.length,e,"internal-error");const o=i.users[0];r._notifyReloadListener(o);const a=!((t=o.providerUserInfo)===null||t===void 0)&&t.length?I2(o.providerUserInfo):[],s=q4(r.providerData,a),u=r.isAnonymous,c=!(r.email&&o.passwordHash)&&!(s!=null&&s.length),d=u?c:!1,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:s,metadata:new bw(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(r,p)}async function W4(r){const t=Bn(r);await Hm(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function q4(r,t){return[...r.filter(n=>!t.some(i=>i.providerId===n.providerId)),...t]}function I2(r){return r.map(t=>{var{providerId:e}=t,n=V1(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H4(r,t){const e=await x2(r,{},async()=>{const n=Qd({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:o}=r.config,a=_2(r,i,"/v1/token",`key=${o}`),s=await r._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",b2.fetch()(a,{method:"POST",headers:s,body:n})});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function $4(r,t){return Ta(r,"POST","/v2/accounts:revokeToken",Ms(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Je(t.idToken,"internal-error"),Je(typeof t.idToken<"u","internal-error"),Je(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):vC(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Je(t.length!==0,"internal-error");const e=vC(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(Je(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:i,expiresIn:o}=await H4(t,e);this.updateTokensAndExpiration(n,i,Number(o))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:o}=e,a=new cc;return n&&(Je(typeof n=="string","internal-error",{appName:t}),a.refreshToken=n),i&&(Je(typeof i=="string","internal-error",{appName:t}),a.accessToken=i),o&&(Je(typeof o=="number","internal-error",{appName:t}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new cc,this.toJSON())}_performRefresh(){return sa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(r,t){Je(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class ua{constructor(t){var{uid:e,auth:n,stsTokenManager:i}=t,o=V1(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new j4(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new bw(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(t){const e=await wc(this,this.stsTokenManager.getToken(this.auth,t));return Je(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return B4(this,t)}reload(){return W4(this)}_assign(t){this!==t&&(Je(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>Object.assign({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new ua(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){Je(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await Hm(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Gi(this.auth.app))return Promise.reject(Eo(this.auth));const t=await this.getIdToken();return await wc(this,V4(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,i,o,a,s,u,c,d;const p=(n=e.displayName)!==null&&n!==void 0?n:void 0,f=(i=e.email)!==null&&i!==void 0?i:void 0,g=(o=e.phoneNumber)!==null&&o!==void 0?o:void 0,y=(a=e.photoURL)!==null&&a!==void 0?a:void 0,x=(s=e.tenantId)!==null&&s!==void 0?s:void 0,b=(u=e._redirectEventId)!==null&&u!==void 0?u:void 0,_=(c=e.createdAt)!==null&&c!==void 0?c:void 0,C=(d=e.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:T,emailVerified:D,isAnonymous:O,providerData:z,stsTokenManager:I}=e;Je(T&&I,t,"internal-error");const S=cc.fromJSON(this.name,I);Je(typeof T=="string",t,"internal-error"),ns(p,t.name),ns(f,t.name),Je(typeof D=="boolean",t,"internal-error"),Je(typeof O=="boolean",t,"internal-error"),ns(g,t.name),ns(y,t.name),ns(x,t.name),ns(b,t.name),ns(_,t.name),ns(C,t.name);const A=new ua({uid:T,auth:t,email:f,emailVerified:D,displayName:p,isAnonymous:O,photoURL:y,phoneNumber:g,tenantId:x,stsTokenManager:S,createdAt:_,lastLoginAt:C});return z&&Array.isArray(z)&&(A.providerData=z.map(N=>Object.assign({},N))),b&&(A._redirectEventId=b),A}static async _fromIdTokenResponse(t,e,n=!1){const i=new cc;i.updateFromServerResponse(e);const o=new ua({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await Hm(o),o}static async _fromGetAccountInfoResponse(t,e,n){const i=e.users[0];Je(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?I2(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(o!=null&&o.length),s=new cc;s.updateFromIdToken(n);const u=new ua({uid:i.localId,auth:t,stsTokenManager:s,isAnonymous:a}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new bw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(o!=null&&o.length)};return Object.assign(u,c),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC=new Map;function la(r){ya(r instanceof Function,"Expected a class definition");let t=yC.get(r);return t?(ya(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,yC.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}C2.type="NONE";const wC=C2;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(r,t,e){return`firebase:${r}:${t}:${e}`}class hc{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:o}=this.auth;this.fullUserKey=mm(this.userKey,i.apiKey,o),this.fullPersistenceKey=mm("persistence",i.apiKey,o),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?ua._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new hc(la(wC),t,n);const i=(await Promise.all(e.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let o=i[0]||la(wC);const a=mm(n,t.config.apiKey,t.name);let s=null;for(const c of e)try{const d=await c._get(a);if(d){const p=ua._fromJSON(t,d);c!==o&&(s=p),o=c;break}}catch{}const u=i.filter(c=>c._shouldAllowMigration);return!o._shouldAllowMigration||!u.length?new hc(o,t,n):(o=u[0],s&&await o._set(a,s.toJSON()),await Promise.all(e.map(async c=>{if(c!==o)try{await c._remove(a)}catch{}})),new hc(o,t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bC(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(R2(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(S2(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(N2(t))return"Blackberry";if(D2(t))return"Webos";if(T2(t))return"Safari";if((t.includes("chrome/")||A2(t))&&!t.includes("edge/"))return"Chrome";if(k2(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(e);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function S2(r=wr()){return/firefox\//i.test(r)}function T2(r=wr()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function A2(r=wr()){return/crios\//i.test(r)}function R2(r=wr()){return/iemobile/i.test(r)}function k2(r=wr()){return/android/i.test(r)}function N2(r=wr()){return/blackberry/i.test(r)}function D2(r=wr()){return/webos/i.test(r)}function W1(r=wr()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function G4(r=wr()){var t;return W1(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function K4(){return u3()&&document.documentMode===10}function O2(r=wr()){return W1(r)||k2(r)||D2(r)||N2(r)||/windows phone/i.test(r)||R2(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P2(r,t=[]){let e;switch(r){case"Browser":e=bC(wr());break;case"Worker":e=`${bC(wr())}-${r}`;break;default:e=r}const n=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${Wc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=o=>new Promise((a,s)=>{try{const u=t(o);a(u)}catch(u){s(u)}});n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(n){e.reverse();for(const i of e)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q4(r,t={}){return Ta(r,"GET","/v2/passwordPolicy",Ms(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y4=6;class J4{constructor(t){var e,n,i,o;const a=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(e=a.minPasswordLength)!==null&&e!==void 0?e:Y4,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=t.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=t.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,n,i,o,a,s;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,u),this.validatePasswordCharacterOptions(t,u),u.isValid&&(u.isValid=(e=u.meetsMinPasswordLength)!==null&&e!==void 0?e:!0),u.isValid&&(u.isValid=(n=u.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(o=u.containsUppercaseLetter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(s=u.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),u}validatePasswordLengthOptions(t,e){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(e.meetsMinPasswordLength=t.length>=n),i&&(e.meetsMaxPasswordLength=t.length<=i)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let n;for(let i=0;i<t.length;i++)n=t.charAt(i),this.updatePasswordCharacterOptionsStatuses(e,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(t,e,n,i,o){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(t,e,n,i){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xC(this),this.idTokenSubscription=new xC(this),this.beforeStateQueue=new X4(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=y2,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=la(e)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await hc.create(this,t),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await E2(this,{idToken:t}),n=await ua._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(Gi(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(s,s))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,o=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId,s=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(t);(!a||a===s)&&(u!=null&&u.user)&&(i=u.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Je(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await Hm(t)}catch(e){if((e==null?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=D4()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Gi(this.app))return Promise.reject(Eo(this));const e=t?Bn(t):null;return e&&Je(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Je(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Gi(this.app)?Promise.reject(Eo(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Gi(this.app)?Promise.reject(Eo(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(la(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Q4(this),e=new J4(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Xd("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged(()=>{n(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(n.tenantId=this.tenantId),await $4(this,n)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&la(t)||this._popupRedirectResolver;Je(e,this,"argument-error"),this.redirectPersistenceManager=await hc.create(this,[la(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue(async()=>{}),((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const o=typeof e=="function"?e:e.next.bind(e);let a=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Je(s,this,"internal-error"),s.then(()=>{a||o(this.currentUser)}),typeof e=="function"){const u=t.addObserver(e,n,i);return()=>{a=!0,u()}}else{const u=t.addObserver(e);return()=>{a=!0,u()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Je(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=P2(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return e!=null&&e.error&&R4(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Qu(r){return Bn(r)}class xC{constructor(t){this.auth=t,this.observer=null,this.addObserver=g3(e=>this.observer=e)}get next(){return Je(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rg={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ez(r){Rg=r}function M2(r){return Rg.loadJS(r)}function tz(){return Rg.recaptchaEnterpriseScript}function nz(){return Rg.gapiScript}function rz(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class iz{constructor(){this.enterprise=new oz}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class oz{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const az="recaptcha-enterprise",L2="NO_RECAPTCHA";class sz{constructor(t){this.type=az,this.auth=Qu(t)}async verify(t="verify",e=!1){async function n(o){if(!e){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,s)=>{z4(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const c=new F4(u);return o.tenantId==null?o._agentRecaptchaConfig=c:o._tenantRecaptchaConfigs[o.tenantId]=c,a(c.siteKey)}}).catch(u=>{s(u)})})}function i(o,a,s){const u=window.grecaptcha;gC(u)?u.enterprise.ready(()=>{u.enterprise.execute(o,{action:t}).then(c=>{a(c)}).catch(()=>{a(L2)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new iz().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{n(this.auth).then(s=>{if(!e&&gC(window.grecaptcha))i(s,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=tz();u.length!==0&&(u+=s),M2(u).then(()=>{i(s,o,a)}).catch(c=>{a(c)})}}).catch(s=>{a(s)})})}}async function _C(r,t,e,n=!1,i=!1){const o=new sz(r);let a;if(i)a=L2;else try{a=await o.verify(e)}catch{a=await o.verify(e,!0)}const s=Object.assign({},t);if(e==="mfaSmsEnrollment"||e==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const u=s.phoneEnrollmentInfo.phoneNumber,c=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const u=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return n?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function xw(r,t,e,n,i){var o;if(!((o=r._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await _C(r,t,e,e==="getOobCode");return n(r,a)}else return n(r,t).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${e} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await _C(r,t,e,e==="getOobCode");return n(r,s)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uz(r,t){const e=z1(r,"auth");if(e.isInitialized()){const i=e.getImmediate(),o=e.getOptions();if(jm(o,t??{}))return i;Yi(i,"already-initialized")}return e.initialize({options:t})}function lz(r,t){const e=(t==null?void 0:t.persistence)||[],n=(Array.isArray(e)?e:[e]).map(la);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(n,t==null?void 0:t.popupRedirectResolver)}function cz(r,t,e){const n=Qu(r);Je(n._canInitEmulator,n,"emulator-config-failed"),Je(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=!1,o=F2(t),{host:a,port:s}=hz(t),u=s===null?"":`:${s}`;n.config.emulator={url:`${o}//${a}${u}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:a,port:s,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})}),dz()}function F2(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function hz(r){const t=F2(r),e=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!e)return{host:"",port:null};const n=e[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const o=i[1];return{host:o,port:EC(n.substr(o.length+1))}}else{const[o,a]=n.split(":");return{host:o,port:EC(a)}}}function EC(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function dz(){function r(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return sa("not implemented")}_getIdTokenResponse(t){return sa("not implemented")}_linkToIdToken(t,e){return sa("not implemented")}_getReauthenticationResolver(t){return sa("not implemented")}}async function pz(r,t){return Ta(r,"POST","/v1/accounts:update",t)}async function fz(r,t){return Ta(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mz(r,t){return Jd(r,"POST","/v1/accounts:signInWithPassword",Ms(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gz(r,t){return Jd(r,"POST","/v1/accounts:signInWithEmailLink",Ms(r,t))}async function vz(r,t){return Jd(r,"POST","/v1/accounts:signInWithEmailLink",Ms(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d extends q1{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new _d(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new _d(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t;if(e!=null&&e.email&&(e!=null&&e.password)){if(e.signInMethod==="password")return this._fromEmailAndPassword(e.email,e.password);if(e.signInMethod==="emailLink")return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const e={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xw(t,e,"signInWithPassword",mz);case"emailLink":return gz(t,{email:this._email,oobCode:this._password});default:Yi(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":const n={idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xw(t,n,"signUpPassword",fz);case"emailLink":return vz(t,{idToken:e,email:this._email,oobCode:this._password});default:Yi(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dc(r,t){return Jd(r,"POST","/v1/accounts:signInWithIdp",Ms(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yz="http://localhost";class Bu extends q1{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Bu(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Yi("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:i}=e,o=V1(e,["providerId","signInMethod"]);if(!n||!i)return null;const a=new Bu(n,i);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(t){const e=this.buildRequest();return dc(t,e)}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,dc(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,dc(t,e)}buildRequest(){const t={requestUri:yz,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Qd(e)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wz(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function bz(r){const t=ed(td(r)).link,e=t?ed(td(t)).deep_link_id:null,n=ed(td(r)).deep_link_id;return(n?ed(td(n)).link:null)||n||e||t||r}class H1{constructor(t){var e,n,i,o,a,s;const u=ed(td(t)),c=(e=u.apiKey)!==null&&e!==void 0?e:null,d=(n=u.oobCode)!==null&&n!==void 0?n:null,p=wz((i=u.mode)!==null&&i!==void 0?i:null);Je(c&&d&&p,"argument-error"),this.apiKey=c,this.operation=p,this.code=d,this.continueUrl=(o=u.continueUrl)!==null&&o!==void 0?o:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(t){const e=bz(t);try{return new H1(e)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(){this.providerId=qc.PROVIDER_ID}static credential(t,e){return _d._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=H1.parseLink(e);return Je(n,"argument-error"),_d._fromEmailAndCode(t,n.code,n.tenantId)}}qc.PROVIDER_ID="password";qc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";qc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd extends z2{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os extends Zd{constructor(){super("facebook.com")}static credential(t){return Bu._fromParams({providerId:os.PROVIDER_ID,signInMethod:os.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return os.credentialFromTaggedObject(t)}static credentialFromError(t){return os.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return os.credential(t.oauthAccessToken)}catch{return null}}}os.FACEBOOK_SIGN_IN_METHOD="facebook.com";os.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as extends Zd{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Bu._fromParams({providerId:as.PROVIDER_ID,signInMethod:as.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return as.credentialFromTaggedObject(t)}static credentialFromError(t){return as.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return as.credential(e,n)}catch{return null}}}as.GOOGLE_SIGN_IN_METHOD="google.com";as.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss extends Zd{constructor(){super("github.com")}static credential(t){return Bu._fromParams({providerId:ss.PROVIDER_ID,signInMethod:ss.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ss.credentialFromTaggedObject(t)}static credentialFromError(t){return ss.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ss.credential(t.oauthAccessToken)}catch{return null}}}ss.GITHUB_SIGN_IN_METHOD="github.com";ss.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us extends Zd{constructor(){super("twitter.com")}static credential(t,e){return Bu._fromParams({providerId:us.PROVIDER_ID,signInMethod:us.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return us.credentialFromTaggedObject(t)}static credentialFromError(t){return us.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return us.credential(e,n)}catch{return null}}}us.TWITTER_SIGN_IN_METHOD="twitter.com";us.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xz(r,t){return Jd(r,"POST","/v1/accounts:signUp",Ms(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const o=await ua._fromIdTokenResponse(t,n,i),a=IC(n);return new Uu({user:o,providerId:a,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=IC(n);return new Uu({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function IC(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m extends Sa{constructor(t,e,n,i){var o;super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,$m.prototype),this.customData={appName:t.name,tenantId:(o=t.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new $m(t,e,n,i)}}function V2(r,t,e,n){return(t==="reauthenticate"?e._getReauthenticationResolver(r):e._getIdTokenResponse(r)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?$m._fromErrorAndOperation(r,o,t,n):o})}async function _z(r,t,e=!1){const n=await wc(r,t._linkToIdToken(r.auth,await r.getIdToken()),e);return Uu._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ez(r,t,e=!1){const{auth:n}=r;if(Gi(n.app))return Promise.reject(Eo(n));const i="reauthenticate";try{const o=await wc(r,V2(n,i,t,r),e);Je(o.idToken,n,"internal-error");const a=j1(o.idToken);Je(a,n,"internal-error");const{sub:s}=a;return Je(r.uid===s,n,"user-mismatch"),Uu._forOperation(r,i,o)}catch(o){throw(o==null?void 0:o.code)==="auth/user-not-found"&&Yi(n,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B2(r,t,e=!1){if(Gi(r.app))return Promise.reject(Eo(r));const n="signIn",i=await V2(r,n,t),o=await Uu._fromIdTokenResponse(r,n,i);return e||await r._updateCurrentUser(o.user),o}async function Iz(r,t){return B2(Qu(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U2(r){const t=Qu(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Cz(r,t,e){if(Gi(r.app))return Promise.reject(Eo(r));const n=Qu(r),a=await xw(n,{returnSecureToken:!0,email:t,password:e,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xz).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&U2(r),u}),s=await Uu._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(s.user),s}function Sz(r,t,e){return Gi(r.app)?Promise.reject(Eo(r)):Iz(Bn(r),qc.credential(t,e)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&U2(r),n})}function Tz(r,t){const e=Bn(r);return Gi(e.auth.app)?Promise.reject(Eo(e.auth)):j2(e,t,null)}function Az(r,t){return j2(Bn(r),null,t)}async function j2(r,t,e){const{auth:n}=r,o={idToken:await r.getIdToken(),returnSecureToken:!0};t&&(o.email=t),e&&(o.password=e);const a=await wc(r,pz(n,o));await r._updateTokensIfNecessary(a,!0)}function Rz(r,t,e,n){return Bn(r).onIdTokenChanged(t,e,n)}function kz(r,t,e){return Bn(r).beforeAuthStateChanged(t,e)}function Nz(r,t,e,n){return Bn(r).onAuthStateChanged(t,e,n)}function W2(r){return Bn(r).signOut()}const Gm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Gm,"1"),this.storage.removeItem(Gm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dz=1e3,Oz=10;class H2 extends q2{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=O2(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((a,s,u)=>{this.notifyListeners(a,u)});return}const n=t.key;e?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(n);!e&&this.localCache[n]===a||this.notifyListeners(n,a)},o=this.storage.getItem(n);K4()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,Oz):i()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)})},Dz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}H2.type="LOCAL";const Pz=H2;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2 extends q2{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}$2.type="SESSION";const G2=$2;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mz(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(i=>i.isListeningto(t));if(e)return e;const n=new kg(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:o}=e.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const s=Array.from(a).map(async c=>c(e.origin,o)),u=await Mz(s);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:u})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}kg.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $1(r="",t=10){let e="";for(let n=0;n<t;n++)e+=Math.floor(Math.random()*10);return r+e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lz{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((s,u)=>{const c=$1("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},n);a={messageChannel:i,onMessage(p){const f=p;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(d),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),s(f.data.response);break;default:clearTimeout(d),clearTimeout(o),u(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(){return window}function Fz(r){Io().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K2(){return typeof Io().WorkerGlobalScope<"u"&&typeof Io().importScripts=="function"}async function zz(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Vz(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function Bz(){return K2()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2="firebaseLocalStorageDb",Uz=1,Km="firebaseLocalStorage",Q2="fbase_key";class ep{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function Ng(r,t){return r.transaction([Km],t?"readwrite":"readonly").objectStore(Km)}function jz(){const r=indexedDB.deleteDatabase(X2);return new ep(r).toPromise()}function _w(){const r=indexedDB.open(X2,Uz);return new Promise((t,e)=>{r.addEventListener("error",()=>{e(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Km,{keyPath:Q2})}catch(i){e(i)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Km)?t(n):(n.close(),await jz(),t(await _w()))})})}async function CC(r,t,e){const n=Ng(r,!0).put({[Q2]:t,value:e});return new ep(n).toPromise()}async function Wz(r,t){const e=Ng(r,!1).get(t),n=await new ep(e).toPromise();return n===void 0?null:n.value}function SC(r,t){const e=Ng(r,!0).delete(t);return new ep(e).toPromise()}const qz=800,Hz=3;class Y2{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _w(),this.db)}async _withRetries(t){let e=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(e++>Hz)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return K2()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=kg._getInstance(Bz()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){var t,e;if(this.activeServiceWorker=await zz(),!this.activeServiceWorker)return;this.sender=new Lz(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((t=n[0])===null||t===void 0)&&t.fulfilled&&!((e=n[0])===null||e===void 0)&&e.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Vz()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await _w();return await CC(t,Gm,"1"),await SC(t,Gm),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(n=>CC(n,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(n=>Wz(n,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>SC(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(i=>{const o=Ng(i,!1).getAll();return new ep(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],n=new Set;if(t.length!==0)for(const{fbase_key:i,value:o}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),e.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),e.push(i));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Y2.type="LOCAL";const $z=Y2;new Yd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gz(r,t){return t?la(t):(Je(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1 extends q1{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return dc(t,this._buildIdpRequest())}_linkToIdToken(t,e){return dc(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return dc(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Kz(r){return B2(r.auth,new G1(r),r.bypassAuthState)}function Xz(r){const{auth:t,user:e}=r;return Je(e,t,"internal-error"),Ez(e,new G1(r),r.bypassAuthState)}async function Qz(r){const{auth:t,user:e}=r;return Je(e,t,"internal-error"),_z(e,new G1(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J2{constructor(t,e,n,i,o=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:o,error:a,type:s}=t;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:e,sessionId:n,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(c){this.reject(c)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Kz;case"linkViaPopup":case"linkViaRedirect":return Qz;case"reauthViaPopup":case"reauthViaRedirect":return Xz;default:Yi(this.auth,"internal-error")}}resolve(t){ya(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){ya(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yz=new Yd(2e3,1e4);class uc extends J2{constructor(t,e,n,i,o){super(t,e,i,o),this.provider=n,this.authWindow=null,this.pollId=null,uc.currentPopupAction&&uc.currentPopupAction.cancel(),uc.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Je(t,this.auth,"internal-error"),t}async onExecution(){ya(this.filter.length===1,"Popup operations only handle one event");const t=$1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(_o(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(_o(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,uc.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;if(!((n=(e=this.authWindow)===null||e===void 0?void 0:e.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_o(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Yz.get())};t()}}uc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jz="pendingRedirect",gm=new Map;class Zz extends J2{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=gm.get(this.auth._key());if(!t){try{const n=await eV(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}gm.set(this.auth._key(),t)}return this.bypassAuthState||gm.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eV(r,t){const e=rV(t),n=nV(r);if(!await n._isAvailable())return!1;const i=await n._get(e)==="true";return await n._remove(e),i}function tV(r,t){gm.set(r._key(),t)}function nV(r){return la(r._redirectPersistence)}function rV(r){return mm(Jz,r.config.apiKey,r.name)}async function iV(r,t,e=!1){if(Gi(r.app))return Promise.reject(Eo(r));const n=Qu(r),i=Gz(n,t),a=await new Zz(n,i,e).execute();return a&&!e&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oV=10*60*1e3;class aV{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!sV(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Z2(t)){const i=((n=t.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";e.onError(_o(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=oV&&this.cachedEventUids.clear(),this.cachedEventUids.has(TC(t))}saveEventToCache(t){this.cachedEventUids.add(TC(t)),this.lastProcessedEventTime=Date.now()}}function TC(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function Z2({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function sV(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Z2(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uV(r,t={}){return Ta(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cV=/^https?/;async function hV(r){if(r.config.emulator)return;const{authorizedDomains:t}=await uV(r);for(const e of t)try{if(dV(e))return}catch{}Yi(r,"unauthorized-domain")}function dV(r){const t=ww(),{protocol:e,hostname:n}=new URL(t);if(r.startsWith("chrome-extension://")){const a=new URL(r);return a.hostname===""&&n===""?e==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&a.hostname===n}if(!cV.test(e))return!1;if(lV.test(r))return n===r;const i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pV=new Yd(3e4,6e4);function AC(){const r=Io().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let e=0;e<r.CP.length;e++)r.CP[e]=null}}function fV(r){return new Promise((t,e)=>{var n,i,o;function a(){AC(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{AC(),e(_o(r,"network-request-failed"))},timeout:pV.get()})}if(!((i=(n=Io().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)t(gapi.iframes.getContext());else if(!((o=Io().gapi)===null||o===void 0)&&o.load)a();else{const s=rz("iframefcb");return Io()[s]=()=>{gapi.load?a():e(_o(r,"network-request-failed"))},M2(`${nz()}?onload=${s}`).catch(u=>e(u))}}).catch(t=>{throw vm=null,t})}let vm=null;function mV(r){return vm=vm||fV(r),vm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=new Yd(5e3,15e3),vV="__/auth/iframe",yV="emulator/auth/iframe",wV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xV(r){const t=r.config;Je(t.authDomain,r,"auth-domain-config-required");const e=t.emulator?U1(t,yV):`https://${r.config.authDomain}/${vV}`,n={apiKey:t.apiKey,appName:r.name,v:Wc},i=bV.get(r.config.apiHost);i&&(n.eid=i);const o=r._getFrameworks();return o.length&&(n.fw=o.join(",")),`${e}?${Qd(n).slice(1)}`}async function _V(r){const t=await mV(r),e=Io().gapi;return Je(e,r,"internal-error"),t.open({where:document.body,url:xV(r),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wV,dontclear:!0},n=>new Promise(async(i,o)=>{await n.restyle({setHideOnLeave:!1});const a=_o(r,"network-request-failed"),s=Io().setTimeout(()=>{o(a)},gV.get());function u(){Io().clearTimeout(s),i(n)}n.ping(u).then(u,()=>{o(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},IV=500,CV=600,SV="_blank",TV="http://localhost";class RC{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AV(r,t,e,n=IV,i=CV){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let s="";const u=Object.assign(Object.assign({},EV),{width:n.toString(),height:i.toString(),top:o,left:a}),c=wr().toLowerCase();e&&(s=A2(c)?SV:e),S2(c)&&(t=t||TV,u.scrollbars="yes");const d=Object.entries(u).reduce((f,[g,y])=>`${f}${g}=${y},`,"");if(G4(c)&&s!=="_self")return RV(t||"",s),new RC(null);const p=window.open(t||"",s,d);Je(p,r,"popup-blocked");try{p.focus()}catch{}return new RC(p)}function RV(r,t){const e=document.createElement("a");e.href=r,e.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kV="__/auth/handler",NV="emulator/auth/handler",DV=encodeURIComponent("fac");async function kC(r,t,e,n,i,o){Je(r.config.authDomain,r,"auth-domain-config-required"),Je(r.config.apiKey,r,"invalid-api-key");const a={apiKey:r.config.apiKey,appName:r.name,authType:e,redirectUrl:n,v:Wc,eventId:i};if(t instanceof z2){t.setDefaultLanguage(r.languageCode),a.providerId=t.providerId||"",m3(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[d,p]of Object.entries({}))a[d]=p}if(t instanceof Zd){const d=t.getScopes().filter(p=>p!=="");d.length>0&&(a.scopes=d.join(","))}r.tenantId&&(a.tid=r.tenantId);const s=a;for(const d of Object.keys(s))s[d]===void 0&&delete s[d];const u=await r._getAppCheckToken(),c=u?`#${DV}=${encodeURIComponent(u)}`:"";return`${OV(r)}?${Qd(s).slice(1)}${c}`}function OV({config:r}){return r.emulator?U1(r,NV):`https://${r.authDomain}/${kV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N0="webStorageSupport";class PV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=G2,this._completeRedirectFn=iV,this._overrideRedirectResult=tV}async _openPopup(t,e,n,i){var o;ya((o=this.eventManagers[t._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");const a=await kC(t,e,n,ww(),i);return AV(t,a,$1())}async _openRedirect(t,e,n,i){await this._originValidation(t);const o=await kC(t,e,n,ww(),i);return Fz(o),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:i,promise:o}=this.eventManagers[e];return i?Promise.resolve(i):(ya(o,"If manager is not set, promise should be"),o)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch(()=>{delete this.eventManagers[e]}),n}async initAndGetManager(t){const e=await _V(t),n=new aV(t);return e.register("authEvent",i=>(Je(i==null?void 0:i.authEvent,t,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(N0,{type:N0},i=>{var o;const a=(o=i==null?void 0:i[0])===null||o===void 0?void 0:o[N0];a!==void 0&&e(!!a),Yi(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=hV(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return O2()||T2()||W1()}}const MV=PV;var NC="@firebase/auth",DC="1.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(n=>{t((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Je(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FV(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function zV(r){yc(new Vu("auth",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:a,authDomain:s}=n.options;Je(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:a,authDomain:s,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:P2(r)},c=new Z4(n,i,o,u);return lz(c,e),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,n)=>{t.getProvider("auth-internal").initialize()})),yc(new Vu("auth-internal",t=>{const e=Qu(t.getProvider("auth").getImmediate());return(n=>new LV(n))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),gs(NC,DC,FV(r)),gs(NC,DC,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VV=5*60,BV=c2("authIdTokenMaxAge")||VV;let OC=null;const UV=r=>async t=>{const e=t&&await t.getIdTokenResult(),n=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>BV)return;const i=e==null?void 0:e.token;OC!==i&&(OC=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function jV(r=f2()){const t=z1(r,"auth");if(t.isInitialized())return t.getImmediate();const e=uz(r,{popupRedirectResolver:MV,persistence:[$z,Pz,G2]}),n=c2("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(n,location.origin);if(location.origin===o.origin){const a=UV(o.toString());kz(e,a,()=>a(e.currentUser)),Rz(e,s=>a(s))}}const i=u2("auth");return i&&cz(e,`http://${i}`),e}function WV(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}ez({loadJS(r){return new Promise((t,e)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=t,n.onerror=i=>{const o=_o("internal-error");o.customData=i,e(o)},n.type="text/javascript",n.charset="UTF-8",WV().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});zV("Browser");var PC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Du,eA;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(I,S){function A(){}A.prototype=S.prototype,I.D=S.prototype,I.prototype=new A,I.prototype.constructor=I,I.C=function(N,P,M){for(var F=Array(arguments.length-2),G=2;G<arguments.length;G++)F[G-2]=arguments[G];return S.prototype[P].apply(N,F)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,S,A){A||(A=0);var N=Array(16);if(typeof S=="string")for(var P=0;16>P;++P)N[P]=S.charCodeAt(A++)|S.charCodeAt(A++)<<8|S.charCodeAt(A++)<<16|S.charCodeAt(A++)<<24;else for(P=0;16>P;++P)N[P]=S[A++]|S[A++]<<8|S[A++]<<16|S[A++]<<24;S=I.g[0],A=I.g[1],P=I.g[2];var M=I.g[3],F=S+(M^A&(P^M))+N[0]+3614090360&4294967295;S=A+(F<<7&4294967295|F>>>25),F=M+(P^S&(A^P))+N[1]+3905402710&4294967295,M=S+(F<<12&4294967295|F>>>20),F=P+(A^M&(S^A))+N[2]+606105819&4294967295,P=M+(F<<17&4294967295|F>>>15),F=A+(S^P&(M^S))+N[3]+3250441966&4294967295,A=P+(F<<22&4294967295|F>>>10),F=S+(M^A&(P^M))+N[4]+4118548399&4294967295,S=A+(F<<7&4294967295|F>>>25),F=M+(P^S&(A^P))+N[5]+1200080426&4294967295,M=S+(F<<12&4294967295|F>>>20),F=P+(A^M&(S^A))+N[6]+2821735955&4294967295,P=M+(F<<17&4294967295|F>>>15),F=A+(S^P&(M^S))+N[7]+4249261313&4294967295,A=P+(F<<22&4294967295|F>>>10),F=S+(M^A&(P^M))+N[8]+1770035416&4294967295,S=A+(F<<7&4294967295|F>>>25),F=M+(P^S&(A^P))+N[9]+2336552879&4294967295,M=S+(F<<12&4294967295|F>>>20),F=P+(A^M&(S^A))+N[10]+4294925233&4294967295,P=M+(F<<17&4294967295|F>>>15),F=A+(S^P&(M^S))+N[11]+2304563134&4294967295,A=P+(F<<22&4294967295|F>>>10),F=S+(M^A&(P^M))+N[12]+1804603682&4294967295,S=A+(F<<7&4294967295|F>>>25),F=M+(P^S&(A^P))+N[13]+4254626195&4294967295,M=S+(F<<12&4294967295|F>>>20),F=P+(A^M&(S^A))+N[14]+2792965006&4294967295,P=M+(F<<17&4294967295|F>>>15),F=A+(S^P&(M^S))+N[15]+1236535329&4294967295,A=P+(F<<22&4294967295|F>>>10),F=S+(P^M&(A^P))+N[1]+4129170786&4294967295,S=A+(F<<5&4294967295|F>>>27),F=M+(A^P&(S^A))+N[6]+3225465664&4294967295,M=S+(F<<9&4294967295|F>>>23),F=P+(S^A&(M^S))+N[11]+643717713&4294967295,P=M+(F<<14&4294967295|F>>>18),F=A+(M^S&(P^M))+N[0]+3921069994&4294967295,A=P+(F<<20&4294967295|F>>>12),F=S+(P^M&(A^P))+N[5]+3593408605&4294967295,S=A+(F<<5&4294967295|F>>>27),F=M+(A^P&(S^A))+N[10]+38016083&4294967295,M=S+(F<<9&4294967295|F>>>23),F=P+(S^A&(M^S))+N[15]+3634488961&4294967295,P=M+(F<<14&4294967295|F>>>18),F=A+(M^S&(P^M))+N[4]+3889429448&4294967295,A=P+(F<<20&4294967295|F>>>12),F=S+(P^M&(A^P))+N[9]+568446438&4294967295,S=A+(F<<5&4294967295|F>>>27),F=M+(A^P&(S^A))+N[14]+3275163606&4294967295,M=S+(F<<9&4294967295|F>>>23),F=P+(S^A&(M^S))+N[3]+4107603335&4294967295,P=M+(F<<14&4294967295|F>>>18),F=A+(M^S&(P^M))+N[8]+1163531501&4294967295,A=P+(F<<20&4294967295|F>>>12),F=S+(P^M&(A^P))+N[13]+2850285829&4294967295,S=A+(F<<5&4294967295|F>>>27),F=M+(A^P&(S^A))+N[2]+4243563512&4294967295,M=S+(F<<9&4294967295|F>>>23),F=P+(S^A&(M^S))+N[7]+1735328473&4294967295,P=M+(F<<14&4294967295|F>>>18),F=A+(M^S&(P^M))+N[12]+2368359562&4294967295,A=P+(F<<20&4294967295|F>>>12),F=S+(A^P^M)+N[5]+4294588738&4294967295,S=A+(F<<4&4294967295|F>>>28),F=M+(S^A^P)+N[8]+2272392833&4294967295,M=S+(F<<11&4294967295|F>>>21),F=P+(M^S^A)+N[11]+1839030562&4294967295,P=M+(F<<16&4294967295|F>>>16),F=A+(P^M^S)+N[14]+4259657740&4294967295,A=P+(F<<23&4294967295|F>>>9),F=S+(A^P^M)+N[1]+2763975236&4294967295,S=A+(F<<4&4294967295|F>>>28),F=M+(S^A^P)+N[4]+1272893353&4294967295,M=S+(F<<11&4294967295|F>>>21),F=P+(M^S^A)+N[7]+4139469664&4294967295,P=M+(F<<16&4294967295|F>>>16),F=A+(P^M^S)+N[10]+3200236656&4294967295,A=P+(F<<23&4294967295|F>>>9),F=S+(A^P^M)+N[13]+681279174&4294967295,S=A+(F<<4&4294967295|F>>>28),F=M+(S^A^P)+N[0]+3936430074&4294967295,M=S+(F<<11&4294967295|F>>>21),F=P+(M^S^A)+N[3]+3572445317&4294967295,P=M+(F<<16&4294967295|F>>>16),F=A+(P^M^S)+N[6]+76029189&4294967295,A=P+(F<<23&4294967295|F>>>9),F=S+(A^P^M)+N[9]+3654602809&4294967295,S=A+(F<<4&4294967295|F>>>28),F=M+(S^A^P)+N[12]+3873151461&4294967295,M=S+(F<<11&4294967295|F>>>21),F=P+(M^S^A)+N[15]+530742520&4294967295,P=M+(F<<16&4294967295|F>>>16),F=A+(P^M^S)+N[2]+3299628645&4294967295,A=P+(F<<23&4294967295|F>>>9),F=S+(P^(A|~M))+N[0]+4096336452&4294967295,S=A+(F<<6&4294967295|F>>>26),F=M+(A^(S|~P))+N[7]+1126891415&4294967295,M=S+(F<<10&4294967295|F>>>22),F=P+(S^(M|~A))+N[14]+2878612391&4294967295,P=M+(F<<15&4294967295|F>>>17),F=A+(M^(P|~S))+N[5]+4237533241&4294967295,A=P+(F<<21&4294967295|F>>>11),F=S+(P^(A|~M))+N[12]+1700485571&4294967295,S=A+(F<<6&4294967295|F>>>26),F=M+(A^(S|~P))+N[3]+2399980690&4294967295,M=S+(F<<10&4294967295|F>>>22),F=P+(S^(M|~A))+N[10]+4293915773&4294967295,P=M+(F<<15&4294967295|F>>>17),F=A+(M^(P|~S))+N[1]+2240044497&4294967295,A=P+(F<<21&4294967295|F>>>11),F=S+(P^(A|~M))+N[8]+1873313359&4294967295,S=A+(F<<6&4294967295|F>>>26),F=M+(A^(S|~P))+N[15]+4264355552&4294967295,M=S+(F<<10&4294967295|F>>>22),F=P+(S^(M|~A))+N[6]+2734768916&4294967295,P=M+(F<<15&4294967295|F>>>17),F=A+(M^(P|~S))+N[13]+1309151649&4294967295,A=P+(F<<21&4294967295|F>>>11),F=S+(P^(A|~M))+N[4]+4149444226&4294967295,S=A+(F<<6&4294967295|F>>>26),F=M+(A^(S|~P))+N[11]+3174756917&4294967295,M=S+(F<<10&4294967295|F>>>22),F=P+(S^(M|~A))+N[2]+718787259&4294967295,P=M+(F<<15&4294967295|F>>>17),F=A+(M^(P|~S))+N[9]+3951481745&4294967295,I.g[0]=I.g[0]+S&4294967295,I.g[1]=I.g[1]+(P+(F<<21&4294967295|F>>>11))&4294967295,I.g[2]=I.g[2]+P&4294967295,I.g[3]=I.g[3]+M&4294967295}n.prototype.u=function(I,S){S===void 0&&(S=I.length);for(var A=S-this.blockSize,N=this.B,P=this.h,M=0;M<S;){if(P==0)for(;M<=A;)i(this,I,M),M+=this.blockSize;if(typeof I=="string"){for(;M<S;)if(N[P++]=I.charCodeAt(M++),P==this.blockSize){i(this,N),P=0;break}}else for(;M<S;)if(N[P++]=I[M++],P==this.blockSize){i(this,N),P=0;break}}this.h=P,this.o+=S},n.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var S=1;S<I.length-8;++S)I[S]=0;var A=8*this.o;for(S=I.length-8;S<I.length;++S)I[S]=A&255,A/=256;for(this.u(I),I=Array(16),S=A=0;4>S;++S)for(var N=0;32>N;N+=8)I[A++]=this.g[S]>>>N&255;return I};function o(I,S){var A=s;return Object.prototype.hasOwnProperty.call(A,I)?A[I]:A[I]=S(I)}function a(I,S){this.h=S;for(var A=[],N=!0,P=I.length-1;0<=P;P--){var M=I[P]|0;N&&M==S||(A[P]=M,N=!1)}this.g=A}var s={};function u(I){return-128<=I&&128>I?o(I,function(S){return new a([S|0],0>S?-1:0)}):new a([I|0],0>I?-1:0)}function c(I){if(isNaN(I)||!isFinite(I))return p;if(0>I)return b(c(-I));for(var S=[],A=1,N=0;I>=A;N++)S[N]=I/A|0,A*=4294967296;return new a(S,0)}function d(I,S){if(I.length==0)throw Error("number format error: empty string");if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(I.charAt(0)=="-")return b(d(I.substring(1),S));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=c(Math.pow(S,8)),N=p,P=0;P<I.length;P+=8){var M=Math.min(8,I.length-P),F=parseInt(I.substring(P,P+M),S);8>M?(M=c(Math.pow(S,M)),N=N.j(M).add(c(F))):(N=N.j(A),N=N.add(c(F)))}return N}var p=u(0),f=u(1),g=u(16777216);r=a.prototype,r.m=function(){if(x(this))return-b(this).m();for(var I=0,S=1,A=0;A<this.g.length;A++){var N=this.i(A);I+=(0<=N?N:4294967296+N)*S,S*=4294967296}return I},r.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(y(this))return"0";if(x(this))return"-"+b(this).toString(I);for(var S=c(Math.pow(I,6)),A=this,N="";;){var P=D(A,S).g;A=_(A,P.j(S));var M=((0<A.g.length?A.g[0]:A.h)>>>0).toString(I);if(A=P,y(A))return M+N;for(;6>M.length;)M="0"+M;N=M+N}},r.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function y(I){if(I.h!=0)return!1;for(var S=0;S<I.g.length;S++)if(I.g[S]!=0)return!1;return!0}function x(I){return I.h==-1}r.l=function(I){return I=_(this,I),x(I)?-1:y(I)?0:1};function b(I){for(var S=I.g.length,A=[],N=0;N<S;N++)A[N]=~I.g[N];return new a(A,~I.h).add(f)}r.abs=function(){return x(this)?b(this):this},r.add=function(I){for(var S=Math.max(this.g.length,I.g.length),A=[],N=0,P=0;P<=S;P++){var M=N+(this.i(P)&65535)+(I.i(P)&65535),F=(M>>>16)+(this.i(P)>>>16)+(I.i(P)>>>16);N=F>>>16,M&=65535,F&=65535,A[P]=F<<16|M}return new a(A,A[A.length-1]&-2147483648?-1:0)};function _(I,S){return I.add(b(S))}r.j=function(I){if(y(this)||y(I))return p;if(x(this))return x(I)?b(this).j(b(I)):b(b(this).j(I));if(x(I))return b(this.j(b(I)));if(0>this.l(g)&&0>I.l(g))return c(this.m()*I.m());for(var S=this.g.length+I.g.length,A=[],N=0;N<2*S;N++)A[N]=0;for(N=0;N<this.g.length;N++)for(var P=0;P<I.g.length;P++){var M=this.i(N)>>>16,F=this.i(N)&65535,G=I.i(P)>>>16,Z=I.i(P)&65535;A[2*N+2*P]+=F*Z,C(A,2*N+2*P),A[2*N+2*P+1]+=M*Z,C(A,2*N+2*P+1),A[2*N+2*P+1]+=F*G,C(A,2*N+2*P+1),A[2*N+2*P+2]+=M*G,C(A,2*N+2*P+2)}for(N=0;N<S;N++)A[N]=A[2*N+1]<<16|A[2*N];for(N=S;N<2*S;N++)A[N]=0;return new a(A,0)};function C(I,S){for(;(I[S]&65535)!=I[S];)I[S+1]+=I[S]>>>16,I[S]&=65535,S++}function T(I,S){this.g=I,this.h=S}function D(I,S){if(y(S))throw Error("division by zero");if(y(I))return new T(p,p);if(x(I))return S=D(b(I),S),new T(b(S.g),b(S.h));if(x(S))return S=D(I,b(S)),new T(b(S.g),S.h);if(30<I.g.length){if(x(I)||x(S))throw Error("slowDivide_ only works with positive integers.");for(var A=f,N=S;0>=N.l(I);)A=O(A),N=O(N);var P=z(A,1),M=z(N,1);for(N=z(N,2),A=z(A,2);!y(N);){var F=M.add(N);0>=F.l(I)&&(P=P.add(A),M=F),N=z(N,1),A=z(A,1)}return S=_(I,P.j(S)),new T(P,S)}for(P=p;0<=I.l(S);){for(A=Math.max(1,Math.floor(I.m()/S.m())),N=Math.ceil(Math.log(A)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),M=c(A),F=M.j(S);x(F)||0<F.l(I);)A-=N,M=c(A),F=M.j(S);y(M)&&(M=f),P=P.add(M),I=_(I,F)}return new T(P,I)}r.A=function(I){return D(this,I).h},r.and=function(I){for(var S=Math.max(this.g.length,I.g.length),A=[],N=0;N<S;N++)A[N]=this.i(N)&I.i(N);return new a(A,this.h&I.h)},r.or=function(I){for(var S=Math.max(this.g.length,I.g.length),A=[],N=0;N<S;N++)A[N]=this.i(N)|I.i(N);return new a(A,this.h|I.h)},r.xor=function(I){for(var S=Math.max(this.g.length,I.g.length),A=[],N=0;N<S;N++)A[N]=this.i(N)^I.i(N);return new a(A,this.h^I.h)};function O(I){for(var S=I.g.length+1,A=[],N=0;N<S;N++)A[N]=I.i(N)<<1|I.i(N-1)>>>31;return new a(A,I.h)}function z(I,S){var A=S>>5;S%=32;for(var N=I.g.length-A,P=[],M=0;M<N;M++)P[M]=0<S?I.i(M+A)>>>S|I.i(M+A+1)<<32-S:I.i(M+A);return new a(P,I.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,eA=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=d,Du=a}).apply(typeof PC<"u"?PC:typeof self<"u"?self:typeof window<"u"?window:{});var Gf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var tA,nd,nA,ym,Ew,rA,iA,oA;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,R,L){return v==Array.prototype||v==Object.prototype||(v[R]=L.value),v};function e(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof Gf=="object"&&Gf];for(var R=0;R<v.length;++R){var L=v[R];if(L&&L.Math==Math)return L}throw Error("Cannot find global object")}var n=e(this);function i(v,R){if(R)e:{var L=n;v=v.split(".");for(var U=0;U<v.length-1;U++){var oe=v[U];if(!(oe in L))break e;L=L[oe]}v=v[v.length-1],U=L[v],R=R(U),R!=U&&R!=null&&t(L,v,{configurable:!0,writable:!0,value:R})}}function o(v,R){v instanceof String&&(v+="");var L=0,U=!1,oe={next:function(){if(!U&&L<v.length){var pe=L++;return{value:R(pe,v[pe]),done:!1}}return U=!0,{done:!0,value:void 0}}};return oe[Symbol.iterator]=function(){return oe},oe}i("Array.prototype.values",function(v){return v||function(){return o(this,function(R,L){return L})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},s=this||self;function u(v){var R=typeof v;return R=R!="object"?R:v?Array.isArray(v)?"array":R:"null",R=="array"||R=="object"&&typeof v.length=="number"}function c(v){var R=typeof v;return R=="object"&&v!=null||R=="function"}function d(v,R,L){return v.call.apply(v.bind,arguments)}function p(v,R,L){if(!v)throw Error();if(2<arguments.length){var U=Array.prototype.slice.call(arguments,2);return function(){var oe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(oe,U),v.apply(R,oe)}}return function(){return v.apply(R,arguments)}}function f(v,R,L){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,f.apply(null,arguments)}function g(v,R){var L=Array.prototype.slice.call(arguments,1);return function(){var U=L.slice();return U.push.apply(U,arguments),v.apply(this,U)}}function y(v,R){function L(){}L.prototype=R.prototype,v.aa=R.prototype,v.prototype=new L,v.prototype.constructor=v,v.Qb=function(U,oe,pe){for(var Ae=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)Ae[Bt-2]=arguments[Bt];return R.prototype[oe].apply(U,Ae)}}function x(v){const R=v.length;if(0<R){const L=Array(R);for(let U=0;U<R;U++)L[U]=v[U];return L}return[]}function b(v,R){for(let L=1;L<arguments.length;L++){const U=arguments[L];if(u(U)){const oe=v.length||0,pe=U.length||0;v.length=oe+pe;for(let Ae=0;Ae<pe;Ae++)v[oe+Ae]=U[Ae]}else v.push(U)}}class _{constructor(R,L){this.i=R,this.j=L,this.h=0,this.g=null}get(){let R;return 0<this.h?(this.h--,R=this.g,this.g=R.next,R.next=null):R=this.i(),R}}function C(v){return/^[\s\xa0]*$/.test(v)}function T(){var v=s.navigator;return v&&(v=v.userAgent)?v:""}function D(v){return D[" "](v),v}D[" "]=function(){};var O=T().indexOf("Gecko")!=-1&&!(T().toLowerCase().indexOf("webkit")!=-1&&T().indexOf("Edge")==-1)&&!(T().indexOf("Trident")!=-1||T().indexOf("MSIE")!=-1)&&T().indexOf("Edge")==-1;function z(v,R,L){for(const U in v)R.call(L,v[U],U,v)}function I(v,R){for(const L in v)R.call(void 0,v[L],L,v)}function S(v){const R={};for(const L in v)R[L]=v[L];return R}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(v,R){let L,U;for(let oe=1;oe<arguments.length;oe++){U=arguments[oe];for(L in U)v[L]=U[L];for(let pe=0;pe<A.length;pe++)L=A[pe],Object.prototype.hasOwnProperty.call(U,L)&&(v[L]=U[L])}}function P(v){var R=1;v=v.split(":");const L=[];for(;0<R&&v.length;)L.push(v.shift()),R--;return v.length&&L.push(v.join(":")),L}function M(v){s.setTimeout(()=>{throw v},0)}function F(){var v=ie;let R=null;return v.g&&(R=v.g,v.g=v.g.next,v.g||(v.h=null),R.next=null),R}class G{constructor(){this.h=this.g=null}add(R,L){const U=Z.get();U.set(R,L),this.h?this.h.next=U:this.g=U,this.h=U}}var Z=new _(()=>new Y,v=>v.reset());class Y{constructor(){this.next=this.g=this.h=null}set(R,L){this.h=R,this.g=L,this.next=null}reset(){this.next=this.g=this.h=null}}let ee,H=!1,ie=new G,J=()=>{const v=s.Promise.resolve(void 0);ee=()=>{v.then(q)}};var q=()=>{for(var v;v=F();){try{v.h.call(v.g)}catch(L){M(L)}var R=Z;R.j(v),100>R.h&&(R.h++,v.next=R.g,R.g=v)}H=!1};function ne(){this.s=this.s,this.C=this.C}ne.prototype.s=!1,ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(v,R){this.type=v,this.g=this.target=R,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var Ce=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var v=!1,R=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const L=()=>{};s.addEventListener("test",L,R),s.removeEventListener("test",L,R)}catch{}return v}();function Te(v,R){if(me.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v){var L=this.type=v.type,U=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;if(this.target=v.target||v.srcElement,this.g=R,R=v.relatedTarget){if(O){e:{try{D(R.nodeName);var oe=!0;break e}catch{}oe=!1}oe||(R=null)}}else L=="mouseover"?R=v.fromElement:L=="mouseout"&&(R=v.toElement);this.relatedTarget=R,U?(this.clientX=U.clientX!==void 0?U.clientX:U.pageX,this.clientY=U.clientY!==void 0?U.clientY:U.pageY,this.screenX=U.screenX||0,this.screenY=U.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=typeof v.pointerType=="string"?v.pointerType:Re[v.pointerType]||"",this.state=v.state,this.i=v,v.defaultPrevented&&Te.aa.h.call(this)}}y(Te,me);var Re={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.aa.h.call(this);var v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var De="closure_listenable_"+(1e6*Math.random()|0),Oe=0;function ze(v,R,L,U,oe){this.listener=v,this.proxy=null,this.src=R,this.type=L,this.capture=!!U,this.ha=oe,this.key=++Oe,this.da=this.fa=!1}function ct(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function Ze(v){this.src=v,this.g={},this.h=0}Ze.prototype.add=function(v,R,L,U,oe){var pe=v.toString();v=this.g[pe],v||(v=this.g[pe]=[],this.h++);var Ae=ht(v,R,U,oe);return-1<Ae?(R=v[Ae],L||(R.fa=!1)):(R=new ze(R,this.src,pe,!!U,oe),R.fa=L,v.push(R)),R};function wt(v,R){var L=R.type;if(L in v.g){var U=v.g[L],oe=Array.prototype.indexOf.call(U,R,void 0),pe;(pe=0<=oe)&&Array.prototype.splice.call(U,oe,1),pe&&(ct(R),v.g[L].length==0&&(delete v.g[L],v.h--))}}function ht(v,R,L,U){for(var oe=0;oe<v.length;++oe){var pe=v[oe];if(!pe.da&&pe.listener==R&&pe.capture==!!L&&pe.ha==U)return oe}return-1}var et="closure_lm_"+(1e6*Math.random()|0),Dt={};function _t(v,R,L,U,oe){if(Array.isArray(R)){for(var pe=0;pe<R.length;pe++)_t(v,R[pe],L,U,oe);return null}return L=Qt(L),v&&v[De]?v.K(R,L,c(U)?!!U.capture:!!U,oe):vn(v,R,L,!1,U,oe)}function vn(v,R,L,U,oe,pe){if(!R)throw Error("Invalid event type");var Ae=c(oe)?!!oe.capture:!!oe,Bt=at(v);if(Bt||(v[et]=Bt=new Ze(v)),L=Bt.add(R,L,U,Ae,pe),L.proxy)return L;if(U=lr(),L.proxy=U,U.src=v,U.listener=L,v.addEventListener)Ce||(oe=Ae),oe===void 0&&(oe=!1),v.addEventListener(R.toString(),U,oe);else if(v.attachEvent)v.attachEvent(Ht(R.toString()),U);else if(v.addListener&&v.removeListener)v.addListener(U);else throw Error("addEventListener and attachEvent are unavailable.");return L}function lr(){function v(L){return R.call(v.src,v.listener,L)}const R=jn;return v}function dn(v,R,L,U,oe){if(Array.isArray(R))for(var pe=0;pe<R.length;pe++)dn(v,R[pe],L,U,oe);else U=c(U)?!!U.capture:!!U,L=Qt(L),v&&v[De]?(v=v.i,R=String(R).toString(),R in v.g&&(pe=v.g[R],L=ht(pe,L,U,oe),-1<L&&(ct(pe[L]),Array.prototype.splice.call(pe,L,1),pe.length==0&&(delete v.g[R],v.h--)))):v&&(v=at(v))&&(R=v.g[R.toString()],v=-1,R&&(v=ht(R,L,U,oe)),(L=-1<v?R[v]:null)&&sn(L))}function sn(v){if(typeof v!="number"&&v&&!v.da){var R=v.src;if(R&&R[De])wt(R.i,v);else{var L=v.type,U=v.proxy;R.removeEventListener?R.removeEventListener(L,U,v.capture):R.detachEvent?R.detachEvent(Ht(L),U):R.addListener&&R.removeListener&&R.removeListener(U),(L=at(R))?(wt(L,v),L.h==0&&(L.src=null,R[et]=null)):ct(v)}}}function Ht(v){return v in Dt?Dt[v]:Dt[v]="on"+v}function jn(v,R){if(v.da)v=!0;else{R=new Te(R,this);var L=v.listener,U=v.ha||v.src;v.fa&&sn(v),v=L.call(U,R)}return v}function at(v){return v=v[et],v instanceof Ze?v:null}var En="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qt(v){return typeof v=="function"?v:(v[En]||(v[En]=function(R){return v.handleEvent(R)}),v[En])}function bt(){ne.call(this),this.i=new Ze(this),this.M=this,this.F=null}y(bt,ne),bt.prototype[De]=!0,bt.prototype.removeEventListener=function(v,R,L,U){dn(this,v,R,L,U)};function Lt(v,R){var L,U=v.F;if(U)for(L=[];U;U=U.F)L.push(U);if(v=v.M,U=R.type||R,typeof R=="string")R=new me(R,v);else if(R instanceof me)R.target=R.target||v;else{var oe=R;R=new me(U,v),N(R,oe)}if(oe=!0,L)for(var pe=L.length-1;0<=pe;pe--){var Ae=R.g=L[pe];oe=Dn(Ae,U,!0,R)&&oe}if(Ae=R.g=v,oe=Dn(Ae,U,!0,R)&&oe,oe=Dn(Ae,U,!1,R)&&oe,L)for(pe=0;pe<L.length;pe++)Ae=R.g=L[pe],oe=Dn(Ae,U,!1,R)&&oe}bt.prototype.N=function(){if(bt.aa.N.call(this),this.i){var v=this.i,R;for(R in v.g){for(var L=v.g[R],U=0;U<L.length;U++)ct(L[U]);delete v.g[R],v.h--}}this.F=null},bt.prototype.K=function(v,R,L,U){return this.i.add(String(v),R,!1,L,U)},bt.prototype.L=function(v,R,L,U){return this.i.add(String(v),R,!0,L,U)};function Dn(v,R,L,U){if(R=v.i.g[String(R)],!R)return!0;R=R.concat();for(var oe=!0,pe=0;pe<R.length;++pe){var Ae=R[pe];if(Ae&&!Ae.da&&Ae.capture==L){var Bt=Ae.listener,On=Ae.ha||Ae.src;Ae.fa&&wt(v.i,Ae),oe=Bt.call(On,U)!==!1&&oe}}return oe&&!U.defaultPrevented}function tn(v,R,L){if(typeof v=="function")L&&(v=f(v,L));else if(v&&typeof v.handleEvent=="function")v=f(v.handleEvent,v);else throw Error("Invalid listener argument");return 2147483647<Number(R)?-1:s.setTimeout(v,R||0)}function cr(v){v.g=tn(()=>{v.g=null,v.i&&(v.i=!1,cr(v))},v.l);const R=v.h;v.h=null,v.m.apply(null,R)}class Wn extends ne{constructor(R,L){super(),this.m=R,this.l=L,this.h=null,this.i=!1,this.g=null}j(R){this.h=arguments,this.g?this.i=!0:cr(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ti(v){ne.call(this),this.h=v,this.g={}}y(Ti,ne);var zo=[];function Vo(v){z(v.g,function(R,L){this.g.hasOwnProperty(L)&&sn(R)},v),v.g={}}Ti.prototype.N=function(){Ti.aa.N.call(this),Vo(this)},Ti.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ai=s.JSON.stringify,Bo=s.JSON.parse,Uo=class{stringify(v){return s.JSON.stringify(v,void 0)}parse(v){return s.JSON.parse(v,void 0)}};function qs(){}qs.prototype.h=null;function cl(v){return v.h||(v.h=v.i())}function hl(){}var fi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ao(){me.call(this,"d")}y(ao,me);function dl(){me.call(this,"c")}y(dl,me);var so={},ah=null;function Hs(){return ah=ah||new bt}so.La="serverreachability";function sh(v){me.call(this,so.La,v)}y(sh,me);function jo(v){const R=Hs();Lt(R,new sh(R))}so.STAT_EVENT="statevent";function uh(v,R){me.call(this,so.STAT_EVENT,v),this.stat=R}y(uh,me);function yn(v){const R=Hs();Lt(R,new uh(R,v))}so.Ma="timingevent";function pl(v,R){me.call(this,so.Ma,v),this.size=R}y(pl,me);function Ri(v,R){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){v()},R)}function $s(){this.g=!0}$s.prototype.xa=function(){this.g=!1};function Gs(v,R,L,U,oe,pe){v.info(function(){if(v.g)if(pe)for(var Ae="",Bt=pe.split("&"),On=0;On<Bt.length;On++){var Rt=Bt[On].split("=");if(1<Rt.length){var qn=Rt[0];Rt=Rt[1];var In=qn.split("_");Ae=2<=In.length&&In[1]=="type"?Ae+(qn+"="+Rt+"&"):Ae+(qn+"=redacted&")}}else Ae=null;else Ae=pe;return"XMLHTTP REQ ("+U+") [attempt "+oe+"]: "+R+`
`+L+`
`+Ae})}function fl(v,R,L,U,oe,pe,Ae){v.info(function(){return"XMLHTTP RESP ("+U+") [ attempt "+oe+"]: "+R+`
`+L+`
`+pe+" "+Ae})}function ki(v,R,L,U){v.info(function(){return"XMLHTTP TEXT ("+R+"): "+$v(v,L)+(U?" "+U:"")})}function lh(v,R){v.info(function(){return"TIMEOUT: "+R})}$s.prototype.info=function(){};function $v(v,R){if(!v.g)return R;if(!R)return null;try{var L=JSON.parse(R);if(L){for(v=0;v<L.length;v++)if(Array.isArray(L[v])){var U=L[v];if(!(2>U.length)){var oe=U[1];if(Array.isArray(oe)&&!(1>oe.length)){var pe=oe[0];if(pe!="noop"&&pe!="stop"&&pe!="close")for(var Ae=1;Ae<oe.length;Ae++)oe[Ae]=""}}}}return Ai(L)}catch{return R}}var ml={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Rp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ni;function Ks(){}y(Ks,qs),Ks.prototype.g=function(){return new XMLHttpRequest},Ks.prototype.i=function(){return{}},Ni=new Ks;function Di(v,R,L,U){this.j=v,this.i=R,this.l=L,this.R=U||1,this.U=new Ti(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new kp}function kp(){this.i=null,this.g="",this.h=!1}var ch={},gl={};function vl(v,R,L){v.L=1,v.v=Fa(Qr(R)),v.m=L,v.P=!0,hh(v,null)}function hh(v,R){v.F=Date.now(),$t(v),v.A=Qr(v.v);var L=v.A,U=v.R;Array.isArray(U)||(U=[String(U)]),Va(L.i,"t",U),v.C=0,L=v.j.J,v.h=new kp,v.g=Kp(v.j,L?R:null,!v.m),0<v.O&&(v.M=new Wn(f(v.Y,v,v.g),v.O)),R=v.U,L=v.g,U=v.ca;var oe="readystatechange";Array.isArray(oe)||(oe&&(zo[0]=oe.toString()),oe=zo);for(var pe=0;pe<oe.length;pe++){var Ae=_t(L,oe[pe],U||R.handleEvent,!1,R.h||R);if(!Ae)break;R.g[Ae.key]=Ae}R=v.H?S(v.H):{},v.m?(v.u||(v.u="POST"),R["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.A,v.u,v.m,R)):(v.u="GET",v.g.ea(v.A,v.u,null,R)),jo(),Gs(v.i,v.u,v.A,v.l,v.R,v.m)}Di.prototype.ca=function(v){v=v.target;const R=this.M;R&&Dr(v)==3?R.j():this.Y(v)},Di.prototype.Y=function(v){try{if(v==this.g)e:{const In=Dr(this.g);var R=this.g.Ba();const vi=this.g.Z();if(!(3>In)&&(In!=3||this.g&&(this.h.h||this.g.oa()||vh(this.g)))){this.J||In!=4||R==7||(R==8||0>=vi?jo(3):jo(2)),Xs(this);var L=this.g.Z();this.X=L;t:if(Np(this)){var U=vh(this.g);v="";var oe=U.length,pe=Dr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){mi(this),Oa(this);var Ae="";break t}this.h.i=new s.TextDecoder}for(R=0;R<oe;R++)this.h.h=!0,v+=this.h.i.decode(U[R],{stream:!(pe&&R==oe-1)});U.length=0,this.h.g+=v,this.C=0,Ae=this.h.g}else Ae=this.g.oa();if(this.o=L==200,fl(this.i,this.u,this.A,this.l,this.R,In,L),this.o){if(this.T&&!this.K){t:{if(this.g){var Bt,On=this.g;if((Bt=On.g?On.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(Bt)){var Rt=Bt;break t}}Rt=null}if(L=Rt)ki(this.i,this.l,L,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,dh(this,L);else{this.o=!1,this.s=3,yn(12),mi(this),Oa(this);break e}}if(this.P){L=!0;let Jr;for(;!this.J&&this.C<Ae.length;)if(Jr=Gv(this,Ae),Jr==gl){In==4&&(this.s=4,yn(14),L=!1),ki(this.i,this.l,null,"[Incomplete Response]");break}else if(Jr==ch){this.s=4,yn(15),ki(this.i,this.l,Ae,"[Invalid Chunk]"),L=!1;break}else ki(this.i,this.l,Jr,null),dh(this,Jr);if(Np(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),In!=4||Ae.length!=0||this.h.h||(this.s=1,yn(16),L=!1),this.o=this.o&&L,!L)ki(this.i,this.l,Ae,"[Invalid Chunked Response]"),mi(this),Oa(this);else if(0<Ae.length&&!this.W){this.W=!0;var qn=this.j;qn.g==this&&qn.ba&&!qn.M&&(qn.j.info("Great, no buffering proxy detected. Bytes received: "+Ae.length),wh(qn),qn.M=!0,yn(11))}}else ki(this.i,this.l,Ae,null),dh(this,Ae);In==4&&mi(this),this.o&&!this.J&&(In==4?Al(this.j,this):(this.o=!1,$t(this)))}else El(this.g),L==400&&0<Ae.indexOf("Unknown SID")?(this.s=3,yn(12)):(this.s=0,yn(13)),mi(this),Oa(this)}}}catch{}finally{}};function Np(v){return v.g?v.u=="GET"&&v.L!=2&&v.j.Ca:!1}function Gv(v,R){var L=v.C,U=R.indexOf(`
`,L);return U==-1?gl:(L=Number(R.substring(L,U)),isNaN(L)?ch:(U+=1,U+L>R.length?gl:(R=R.slice(U,U+L),v.C=U+L,R)))}Di.prototype.cancel=function(){this.J=!0,mi(this)};function $t(v){v.S=Date.now()+v.I,Dp(v,v.I)}function Dp(v,R){if(v.B!=null)throw Error("WatchDog timer not null");v.B=Ri(f(v.ba,v),R)}function Xs(v){v.B&&(s.clearTimeout(v.B),v.B=null)}Di.prototype.ba=function(){this.B=null;const v=Date.now();0<=v-this.S?(lh(this.i,this.A),this.L!=2&&(jo(),yn(17)),mi(this),this.s=2,Oa(this)):Dp(this,this.S-v)};function Oa(v){v.j.G==0||v.J||Al(v.j,v)}function mi(v){Xs(v);var R=v.M;R&&typeof R.ma=="function"&&R.ma(),v.M=null,Vo(v.U),v.g&&(R=v.g,v.g=null,R.abort(),R.ma())}function dh(v,R){try{var L=v.j;if(L.G!=0&&(L.g==v||_r(L.h,v))){if(!v.K&&_r(L.h,v)&&L.G==3){try{var U=L.Da.g.parse(R)}catch{U=null}if(Array.isArray(U)&&U.length==3){var oe=U;if(oe[0]==0){e:if(!L.u){if(L.g)if(L.g.F+3e3<v.F)Tl(L),Fi(L);else break e;Sl(L),yn(18)}}else L.za=oe[1],0<L.za-L.T&&37500>oe[2]&&L.F&&L.v==0&&!L.C&&(L.C=Ri(f(L.Za,L),6e3));if(1>=Pp(L.h)&&L.ca){try{L.ca()}catch{}L.ca=void 0}}else Go(L,11)}else if((v.K||L.g==v)&&Tl(L),!C(R))for(oe=L.Da.g.parse(R),R=0;R<oe.length;R++){let Rt=oe[R];if(L.T=Rt[0],Rt=Rt[1],L.G==2)if(Rt[0]=="c"){L.K=Rt[1],L.ia=Rt[2];const qn=Rt[3];qn!=null&&(L.la=qn,L.j.info("VER="+L.la));const In=Rt[4];In!=null&&(L.Aa=In,L.j.info("SVER="+L.Aa));const vi=Rt[5];vi!=null&&typeof vi=="number"&&0<vi&&(U=1.5*vi,L.L=U,L.j.info("backChannelRequestTimeoutMs_="+U)),U=L;const Jr=v.g;if(Jr){const nu=Jr.g?Jr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(nu){var pe=U.h;pe.g||nu.indexOf("spdy")==-1&&nu.indexOf("quic")==-1&&nu.indexOf("h2")==-1||(pe.j=pe.l,pe.g=new Set,pe.h&&(ph(pe,pe.h),pe.h=null))}if(U.D){const kl=Jr.g?Jr.g.getResponseHeader("X-HTTP-Session-Id"):null;kl&&(U.ya=kl,Wt(U.I,U.D,kl))}}L.G=3,L.l&&L.l.ua(),L.ba&&(L.R=Date.now()-v.F,L.j.info("Handshake RTT: "+L.R+"ms")),U=L;var Ae=v;if(U.qa=Gp(U,U.J?U.ia:null,U.W),Ae.K){Mp(U.h,Ae);var Bt=Ae,On=U.L;On&&(Bt.I=On),Bt.B&&(Xs(Bt),$t(Bt)),U.g=Ae}else tu(U);0<L.i.length&&ho(L)}else Rt[0]!="stop"&&Rt[0]!="close"||Go(L,7);else L.G==3&&(Rt[0]=="stop"||Rt[0]=="close"?Rt[0]=="stop"?Go(L,7):er(L):Rt[0]!="noop"&&L.l&&L.l.ta(Rt),L.v=0)}}jo(4)}catch{}}var Op=class{constructor(v,R){this.g=v,this.map=R}};function Qs(v){this.l=v||10,s.PerformanceNavigationTiming?(v=s.performance.getEntriesByType("navigation"),v=0<v.length&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xr(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function Pp(v){return v.h?1:v.g?v.g.size:0}function _r(v,R){return v.h?v.h==R:v.g?v.g.has(R):!1}function ph(v,R){v.g?v.g.add(R):v.h=R}function Mp(v,R){v.h&&v.h==R?v.h=null:v.g&&v.g.has(R)&&v.g.delete(R)}Qs.prototype.cancel=function(){if(this.i=Lp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function Lp(v){if(v.h!=null)return v.i.concat(v.h.D);if(v.g!=null&&v.g.size!==0){let R=v.i;for(const L of v.g.values())R=R.concat(L.D);return R}return x(v.i)}function yl(v){if(v.V&&typeof v.V=="function")return v.V();if(typeof Map<"u"&&v instanceof Map||typeof Set<"u"&&v instanceof Set)return Array.from(v.values());if(typeof v=="string")return v.split("");if(u(v)){for(var R=[],L=v.length,U=0;U<L;U++)R.push(v[U]);return R}R=[],L=0;for(U in v)R[L++]=v[U];return R}function wl(v){if(v.na&&typeof v.na=="function")return v.na();if(!v.V||typeof v.V!="function"){if(typeof Map<"u"&&v instanceof Map)return Array.from(v.keys());if(!(typeof Set<"u"&&v instanceof Set)){if(u(v)||typeof v=="string"){var R=[];v=v.length;for(var L=0;L<v;L++)R.push(L);return R}R=[],L=0;for(const U in v)R[L++]=U;return R}}}function Pa(v,R){if(v.forEach&&typeof v.forEach=="function")v.forEach(R,void 0);else if(u(v)||typeof v=="string")Array.prototype.forEach.call(v,R,void 0);else for(var L=wl(v),U=yl(v),oe=U.length,pe=0;pe<oe;pe++)R.call(void 0,U[pe],L&&L[pe],v)}var Ys=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kv(v,R){if(v){v=v.split("&");for(var L=0;L<v.length;L++){var U=v[L].indexOf("="),oe=null;if(0<=U){var pe=v[L].substring(0,U);oe=v[L].substring(U+1)}else pe=v[L];R(pe,oe?decodeURIComponent(oe.replace(/\+/g," ")):"")}}}function Wo(v){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,v instanceof Wo){this.h=v.h,Js(this,v.j),this.o=v.o,this.g=v.g,Ma(this,v.s),this.l=v.l;var R=v.i,L=new uo;L.i=R.i,R.g&&(L.g=new Map(R.g),L.h=R.h),La(this,L),this.m=v.m}else v&&(R=String(v).match(Ys))?(this.h=!1,Js(this,R[1]||"",!0),this.o=Tt(R[2]||""),this.g=Tt(R[3]||"",!0),Ma(this,R[4]),this.l=Tt(R[5]||"",!0),La(this,R[6]||"",!0),this.m=Tt(R[7]||"")):(this.h=!1,this.i=new uo(null,this.h))}Wo.prototype.toString=function(){var v=[],R=this.j;R&&v.push(za(R,bl,!0),":");var L=this.g;return(L||R=="file")&&(v.push("//"),(R=this.o)&&v.push(za(R,bl,!0),"@"),v.push(encodeURIComponent(String(L)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L=this.s,L!=null&&v.push(":",String(L))),(L=this.l)&&(this.g&&L.charAt(0)!="/"&&v.push("/"),v.push(za(L,L.charAt(0)=="/"?Vp:zp,!0))),(L=this.i.toString())&&v.push("?",L),(L=this.m)&&v.push("#",za(L,fh)),v.join("")};function Qr(v){return new Wo(v)}function Js(v,R,L){v.j=L?Tt(R,!0):R,v.j&&(v.j=v.j.replace(/:$/,""))}function Ma(v,R){if(R){if(R=Number(R),isNaN(R)||0>R)throw Error("Bad port number "+R);v.s=R}else v.s=null}function La(v,R,L){R instanceof uo?(v.i=R,lo(v.i,v.h)):(L||(R=za(R,Bp)),v.i=new uo(R,v.h))}function Wt(v,R,L){v.i.set(R,L)}function Fa(v){return Wt(v,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),v}function Tt(v,R){return v?R?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function za(v,R,L){return typeof v=="string"?(v=encodeURI(v).replace(R,Fp),L&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function Fp(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var bl=/[#\/\?@]/g,zp=/[#\?:]/g,Vp=/[#\?]/g,Bp=/[#\?@]/g,fh=/#/g;function uo(v,R){this.h=this.g=null,this.i=v||null,this.j=!!R}function Zn(v){v.g||(v.g=new Map,v.h=0,v.i&&Kv(v.i,function(R,L){v.add(decodeURIComponent(R.replace(/\+/g," ")),L)}))}r=uo.prototype,r.add=function(v,R){Zn(this),this.i=null,v=gi(this,v);var L=this.g.get(v);return L||this.g.set(v,L=[]),L.push(R),this.h+=1,this};function Oi(v,R){Zn(v),R=gi(v,R),v.g.has(R)&&(v.i=null,v.h-=v.g.get(R).length,v.g.delete(R))}function Pi(v,R){return Zn(v),R=gi(v,R),v.g.has(R)}r.forEach=function(v,R){Zn(this),this.g.forEach(function(L,U){L.forEach(function(oe){v.call(R,oe,U,this)},this)},this)},r.na=function(){Zn(this);const v=Array.from(this.g.values()),R=Array.from(this.g.keys()),L=[];for(let U=0;U<R.length;U++){const oe=v[U];for(let pe=0;pe<oe.length;pe++)L.push(R[U])}return L},r.V=function(v){Zn(this);let R=[];if(typeof v=="string")Pi(this,v)&&(R=R.concat(this.g.get(gi(this,v))));else{v=Array.from(this.g.values());for(let L=0;L<v.length;L++)R=R.concat(v[L])}return R},r.set=function(v,R){return Zn(this),this.i=null,v=gi(this,v),Pi(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[R]),this.h+=1,this},r.get=function(v,R){return v?(v=this.V(v),0<v.length?String(v[0]):R):R};function Va(v,R,L){Oi(v,R),0<L.length&&(v.i=null,v.g.set(gi(v,R),x(L)),v.h+=L.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],R=Array.from(this.g.keys());for(var L=0;L<R.length;L++){var U=R[L];const pe=encodeURIComponent(String(U)),Ae=this.V(U);for(U=0;U<Ae.length;U++){var oe=pe;Ae[U]!==""&&(oe+="="+encodeURIComponent(String(Ae[U]))),v.push(oe)}}return this.i=v.join("&")};function gi(v,R){return R=String(R),v.j&&(R=R.toLowerCase()),R}function lo(v,R){R&&!v.j&&(Zn(v),v.i=null,v.g.forEach(function(L,U){var oe=U.toLowerCase();U!=oe&&(Oi(this,U),Va(this,oe,L))},v)),v.j=R}function Xv(v,R){const L=new $s;if(s.Image){const U=new Image;U.onload=g(Nr,L,"TestLoadImage: loaded",!0,R,U),U.onerror=g(Nr,L,"TestLoadImage: error",!1,R,U),U.onabort=g(Nr,L,"TestLoadImage: abort",!1,R,U),U.ontimeout=g(Nr,L,"TestLoadImage: timeout",!1,R,U),s.setTimeout(function(){U.ontimeout&&U.ontimeout()},1e4),U.src=v}else R(!1)}function Up(v,R){const L=new $s,U=new AbortController,oe=setTimeout(()=>{U.abort(),Nr(L,"TestPingServer: timeout",!1,R)},1e4);fetch(v,{signal:U.signal}).then(pe=>{clearTimeout(oe),pe.ok?Nr(L,"TestPingServer: ok",!0,R):Nr(L,"TestPingServer: server error",!1,R)}).catch(()=>{clearTimeout(oe),Nr(L,"TestPingServer: error",!1,R)})}function Nr(v,R,L,U,oe){try{oe&&(oe.onload=null,oe.onerror=null,oe.onabort=null,oe.ontimeout=null),U(L)}catch{}}function Qv(){this.g=new Uo}function jp(v,R,L){const U=L||"";try{Pa(v,function(oe,pe){let Ae=oe;c(oe)&&(Ae=Ai(oe)),R.push(U+pe+"="+encodeURIComponent(Ae))})}catch(oe){throw R.push(U+"type="+encodeURIComponent("_badmap")),oe}}function qo(v){this.l=v.Ub||null,this.j=v.eb||!1}y(qo,qs),qo.prototype.g=function(){return new Zs(this.l,this.j)},qo.prototype.i=function(v){return function(){return v}}({});function Zs(v,R){bt.call(this),this.D=v,this.o=R,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(Zs,bt),r=Zs.prototype,r.open=function(v,R){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=v,this.A=R,this.readyState=1,Li(this)},r.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const R={headers:this.u,method:this.B,credentials:this.m,cache:void 0};v&&(R.body=v),(this.D||s).fetch(new Request(this.A,R)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Mi(this)),this.readyState=0},r.Sa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,Li(this)),this.g&&(this.readyState=3,Li(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Wp(this)}else v.text().then(this.Ra.bind(this),this.ga.bind(this))};function Wp(v){v.j.read().then(v.Pa.bind(v)).catch(v.ga.bind(v))}r.Pa=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var R=v.value?v.value:new Uint8Array(0);(R=this.v.decode(R,{stream:!v.done}))&&(this.response=this.responseText+=R)}v.done?Mi(this):Li(this),this.readyState==3&&Wp(this)}},r.Ra=function(v){this.g&&(this.response=this.responseText=v,Mi(this))},r.Qa=function(v){this.g&&(this.response=v,Mi(this))},r.ga=function(){this.g&&Mi(this)};function Mi(v){v.readyState=4,v.l=null,v.j=null,v.v=null,Li(v)}r.setRequestHeader=function(v,R){this.u.append(v,R)},r.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],R=this.h.entries();for(var L=R.next();!L.done;)L=L.value,v.push(L[0]+": "+L[1]),L=R.next();return v.join(`\r
`)};function Li(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(Zs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function Ho(v){let R="";return z(v,function(L,U){R+=U,R+=":",R+=L,R+=`\r
`}),R}function Ba(v,R,L){e:{for(U in L){var U=!1;break e}U=!0}U||(L=Ho(L),typeof v=="string"?L!=null&&encodeURIComponent(String(L)):Wt(v,R,L))}function nn(v){bt.call(this),this.headers=new Map,this.o=v||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(nn,bt);var Yv=/^https?$/i,mh=["POST","PUT"];r=nn.prototype,r.Ha=function(v){this.J=v},r.ea=function(v,R,L,U){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);R=R?R.toUpperCase():"GET",this.D=v,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ni.g(),this.v=this.o?cl(this.o):cl(Ni),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(R,String(v),!0),this.B=!1}catch(pe){eu(this,pe);return}if(v=L||"",L=new Map(this.headers),U)if(Object.getPrototypeOf(U)===Object.prototype)for(var oe in U)L.set(oe,U[oe]);else if(typeof U.keys=="function"&&typeof U.get=="function")for(const pe of U.keys())L.set(pe,U.get(pe));else throw Error("Unknown input type for opt_headers: "+String(U));U=Array.from(L.keys()).find(pe=>pe.toLowerCase()=="content-type"),oe=s.FormData&&v instanceof s.FormData,!(0<=Array.prototype.indexOf.call(mh,R,void 0))||U||oe||L.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pe,Ae]of L)this.g.setRequestHeader(pe,Ae);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{_l(this),this.u=!0,this.g.send(v),this.u=!1}catch(pe){eu(this,pe)}};function eu(v,R){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=R,v.m=5,xl(v),Yr(v)}function xl(v){v.A||(v.A=!0,Lt(v,"complete"),Lt(v,"error"))}r.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=v||7,Lt(this,"complete"),Lt(this,"abort"),Yr(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Yr(this,!0)),nn.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?gh(this):this.bb())},r.bb=function(){gh(this)};function gh(v){if(v.h&&typeof a<"u"&&(!v.v[1]||Dr(v)!=4||v.Z()!=2)){if(v.u&&Dr(v)==4)tn(v.Ea,0,v);else if(Lt(v,"readystatechange"),Dr(v)==4){v.h=!1;try{const Ae=v.Z();e:switch(Ae){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var R=!0;break e;default:R=!1}var L;if(!(L=R)){var U;if(U=Ae===0){var oe=String(v.D).match(Ys)[1]||null;!oe&&s.self&&s.self.location&&(oe=s.self.location.protocol.slice(0,-1)),U=!Yv.test(oe?oe.toLowerCase():"")}L=U}if(L)Lt(v,"complete"),Lt(v,"success");else{v.m=6;try{var pe=2<Dr(v)?v.g.statusText:""}catch{pe=""}v.l=pe+" ["+v.Z()+"]",xl(v)}}finally{Yr(v)}}}}function Yr(v,R){if(v.g){_l(v);const L=v.g,U=v.v[0]?()=>{}:null;v.g=null,v.v=null,R||Lt(v,"ready");try{L.onreadystatechange=U}catch{}}}function _l(v){v.I&&(s.clearTimeout(v.I),v.I=null)}r.isActive=function(){return!!this.g};function Dr(v){return v.g?v.g.readyState:0}r.Z=function(){try{return 2<Dr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(v){if(this.g){var R=this.g.responseText;return v&&R.indexOf(v)==0&&(R=R.substring(v.length)),Bo(R)}};function vh(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.H){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function El(v){const R={};v=(v.g&&2<=Dr(v)&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let U=0;U<v.length;U++){if(C(v[U]))continue;var L=P(v[U]);const oe=L[0];if(L=L[1],typeof L!="string")continue;L=L.trim();const pe=R[oe]||[];R[oe]=pe,pe.push(L)}I(R,function(U){return U.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function co(v,R,L){return L&&L.internalChannelParams&&L.internalChannelParams[v]||R}function yh(v){this.Aa=0,this.i=[],this.j=new $s,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=co("failFast",!1,v),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=co("baseRetryDelayMs",5e3,v),this.cb=co("retryDelaySeedMs",1e4,v),this.Wa=co("forwardChannelMaxRetries",2,v),this.wa=co("forwardChannelRequestTimeoutMs",2e4,v),this.pa=v&&v.xmlHttpFactory||void 0,this.Xa=v&&v.Tb||void 0,this.Ca=v&&v.useFetchStreams||!1,this.L=void 0,this.J=v&&v.supportsCrossDomainXhr||!1,this.K="",this.h=new Qs(v&&v.concurrentRequestLimit),this.Da=new Qv,this.P=v&&v.fastHandshake||!1,this.O=v&&v.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=v&&v.Rb||!1,v&&v.xa&&this.j.xa(),v&&v.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&v&&v.detectBufferingProxy||!1,this.ja=void 0,v&&v.longPollingTimeout&&0<v.longPollingTimeout&&(this.ja=v.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=yh.prototype,r.la=8,r.G=1,r.connect=function(v,R,L,U){yn(0),this.W=v,this.H=R||{},L&&U!==void 0&&(this.H.OSID=L,this.H.OAID=U),this.F=this.X,this.I=Gp(this,null,this.W),ho(this)};function er(v){if(Il(v),v.G==3){var R=v.U++,L=Qr(v.I);if(Wt(L,"SID",v.K),Wt(L,"RID",R),Wt(L,"TYPE","terminate"),$o(v,L),R=new Di(v,v.j,R),R.L=2,R.v=Fa(Qr(L)),L=!1,s.navigator&&s.navigator.sendBeacon)try{L=s.navigator.sendBeacon(R.v.toString(),"")}catch{}!L&&s.Image&&(new Image().src=R.v,L=!0),L||(R.g=Kp(R.j,null),R.g.ea(R.v)),R.F=Date.now(),$t(R)}$p(v)}function Fi(v){v.g&&(wh(v),v.g.cancel(),v.g=null)}function Il(v){Fi(v),v.u&&(s.clearTimeout(v.u),v.u=null),Tl(v),v.h.cancel(),v.s&&(typeof v.s=="number"&&s.clearTimeout(v.s),v.s=null)}function ho(v){if(!Xr(v.h)&&!v.s){v.s=!0;var R=v.Ga;ee||J(),H||(ee(),H=!0),ie.add(R,v),v.B=0}}function Jv(v,R){return Pp(v.h)>=v.h.j-(v.s?1:0)?!1:v.s?(v.i=R.D.concat(v.i),!0):v.G==1||v.G==2||v.B>=(v.Va?0:v.Wa)?!1:(v.s=Ri(f(v.Ga,v,R),Hp(v,v.B)),v.B++,!0)}r.Ga=function(v){if(this.s)if(this.s=null,this.G==1){if(!v){this.U=Math.floor(1e5*Math.random()),v=this.U++;const oe=new Di(this,this.j,v);let pe=this.o;if(this.S&&(pe?(pe=S(pe),N(pe,this.S)):pe=this.S),this.m!==null||this.O||(oe.H=pe,pe=null),this.P)e:{for(var R=0,L=0;L<this.i.length;L++){t:{var U=this.i[L];if("__data__"in U.map&&(U=U.map.__data__,typeof U=="string")){U=U.length;break t}U=void 0}if(U===void 0)break;if(R+=U,4096<R){R=L;break e}if(R===4096||L===this.i.length-1){R=L+1;break e}}R=1e3}else R=1e3;R=Ua(this,oe,R),L=Qr(this.I),Wt(L,"RID",v),Wt(L,"CVER",22),this.D&&Wt(L,"X-HTTP-Session-Id",this.D),$o(this,L),pe&&(this.O?R="headers="+encodeURIComponent(String(Ho(pe)))+"&"+R:this.m&&Ba(L,this.m,pe)),ph(this.h,oe),this.Ua&&Wt(L,"TYPE","init"),this.P?(Wt(L,"$req",R),Wt(L,"SID","null"),oe.T=!0,vl(oe,L,null)):vl(oe,L,R),this.G=2}}else this.G==3&&(v?Cl(this,v):this.i.length==0||Xr(this.h)||Cl(this))};function Cl(v,R){var L;R?L=R.l:L=v.U++;const U=Qr(v.I);Wt(U,"SID",v.K),Wt(U,"RID",L),Wt(U,"AID",v.T),$o(v,U),v.m&&v.o&&Ba(U,v.m,v.o),L=new Di(v,v.j,L,v.B+1),v.m===null&&(L.H=v.o),R&&(v.i=R.D.concat(v.i)),R=Ua(v,L,1e3),L.I=Math.round(.5*v.wa)+Math.round(.5*v.wa*Math.random()),ph(v.h,L),vl(L,U,R)}function $o(v,R){v.H&&z(v.H,function(L,U){Wt(R,U,L)}),v.l&&Pa({},function(L,U){Wt(R,U,L)})}function Ua(v,R,L){L=Math.min(v.i.length,L);var U=v.l?f(v.l.Na,v.l,v):null;e:{var oe=v.i;let pe=-1;for(;;){const Ae=["count="+L];pe==-1?0<L?(pe=oe[0].g,Ae.push("ofs="+pe)):pe=0:Ae.push("ofs="+pe);let Bt=!0;for(let On=0;On<L;On++){let Rt=oe[On].g;const qn=oe[On].map;if(Rt-=pe,0>Rt)pe=Math.max(0,oe[On].g-100),Bt=!1;else try{jp(qn,Ae,"req"+Rt+"_")}catch{U&&U(qn)}}if(Bt){U=Ae.join("&");break e}}}return v=v.i.splice(0,L),R.D=v,U}function tu(v){if(!v.g&&!v.u){v.Y=1;var R=v.Fa;ee||J(),H||(ee(),H=!0),ie.add(R,v),v.v=0}}function Sl(v){return v.g||v.u||3<=v.v?!1:(v.Y++,v.u=Ri(f(v.Fa,v),Hp(v,v.v)),v.v++,!0)}r.Fa=function(){if(this.u=null,qp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var v=2*this.R;this.j.info("BP detection timer enabled: "+v),this.A=Ri(f(this.ab,this),v)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,yn(10),Fi(this),qp(this))};function wh(v){v.A!=null&&(s.clearTimeout(v.A),v.A=null)}function qp(v){v.g=new Di(v,v.j,"rpc",v.Y),v.m===null&&(v.g.H=v.o),v.g.O=0;var R=Qr(v.qa);Wt(R,"RID","rpc"),Wt(R,"SID",v.K),Wt(R,"AID",v.T),Wt(R,"CI",v.F?"0":"1"),!v.F&&v.ja&&Wt(R,"TO",v.ja),Wt(R,"TYPE","xmlhttp"),$o(v,R),v.m&&v.o&&Ba(R,v.m,v.o),v.L&&(v.g.I=v.L);var L=v.g;v=v.ia,L.L=1,L.v=Fa(Qr(R)),L.m=null,L.P=!0,hh(L,v)}r.Za=function(){this.C!=null&&(this.C=null,Fi(this),Sl(this),yn(19))};function Tl(v){v.C!=null&&(s.clearTimeout(v.C),v.C=null)}function Al(v,R){var L=null;if(v.g==R){Tl(v),wh(v),v.g=null;var U=2}else if(_r(v.h,R))L=R.D,Mp(v.h,R),U=1;else return;if(v.G!=0){if(R.o)if(U==1){L=R.m?R.m.length:0,R=Date.now()-R.F;var oe=v.B;U=Hs(),Lt(U,new pl(U,L)),ho(v)}else tu(v);else if(oe=R.s,oe==3||oe==0&&0<R.X||!(U==1&&Jv(v,R)||U==2&&Sl(v)))switch(L&&0<L.length&&(R=v.h,R.i=R.i.concat(L)),oe){case 1:Go(v,5);break;case 4:Go(v,10);break;case 3:Go(v,6);break;default:Go(v,2)}}}function Hp(v,R){let L=v.Ta+Math.floor(Math.random()*v.cb);return v.isActive()||(L*=2),L*R}function Go(v,R){if(v.j.info("Error code "+R),R==2){var L=f(v.fb,v),U=v.Xa;const oe=!U;U=new Wo(U||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||Js(U,"https"),Fa(U),oe?Xv(U.toString(),L):Up(U.toString(),L)}else yn(2);v.G=0,v.l&&v.l.sa(R),$p(v),Il(v)}r.fb=function(v){v?(this.j.info("Successfully pinged google.com"),yn(2)):(this.j.info("Failed to ping google.com"),yn(1))};function $p(v){if(v.G=0,v.ka=[],v.l){const R=Lp(v.h);(R.length!=0||v.i.length!=0)&&(b(v.ka,R),b(v.ka,v.i),v.h.i.length=0,x(v.i),v.i.length=0),v.l.ra()}}function Gp(v,R,L){var U=L instanceof Wo?Qr(L):new Wo(L);if(U.g!="")R&&(U.g=R+"."+U.g),Ma(U,U.s);else{var oe=s.location;U=oe.protocol,R=R?R+"."+oe.hostname:oe.hostname,oe=+oe.port;var pe=new Wo(null);U&&Js(pe,U),R&&(pe.g=R),oe&&Ma(pe,oe),L&&(pe.l=L),U=pe}return L=v.D,R=v.ya,L&&R&&Wt(U,L,R),Wt(U,"VER",v.la),$o(v,U),U}function Kp(v,R,L){if(R&&!v.J)throw Error("Can't create secondary domain capable XhrIo object.");return R=v.Ca&&!v.pa?new nn(new qo({eb:L})):new nn(v.pa),R.Ha(v.J),R}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function bh(){}r=bh.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Rl(){}Rl.prototype.g=function(v,R){return new Er(v,R)};function Er(v,R){bt.call(this),this.g=new yh(R),this.l=v,this.h=R&&R.messageUrlParams||null,v=R&&R.messageHeaders||null,R&&R.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=R&&R.initMessageHeaders||null,R&&R.messageContentType&&(v?v["X-WebChannel-Content-Type"]=R.messageContentType:v={"X-WebChannel-Content-Type":R.messageContentType}),R&&R.va&&(v?v["X-WebChannel-Client-Profile"]=R.va:v={"X-WebChannel-Client-Profile":R.va}),this.g.S=v,(v=R&&R.Sb)&&!C(v)&&(this.g.m=v),this.v=R&&R.supportsCrossDomainXhr||!1,this.u=R&&R.sendRawJson||!1,(R=R&&R.httpSessionIdParam)&&!C(R)&&(this.g.D=R,v=this.h,v!==null&&R in v&&(v=this.h,R in v&&delete v[R])),this.j=new po(this)}y(Er,bt),Er.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Er.prototype.close=function(){er(this.g)},Er.prototype.o=function(v){var R=this.g;if(typeof v=="string"){var L={};L.__data__=v,v=L}else this.u&&(L={},L.__data__=Ai(v),v=L);R.i.push(new Op(R.Ya++,v)),R.G==3&&ho(R)},Er.prototype.N=function(){this.g.l=null,delete this.j,er(this.g),delete this.g,Er.aa.N.call(this)};function Xp(v){ao.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var R=v.__sm__;if(R){e:{for(const L in R){v=L;break e}v=void 0}(this.i=v)&&(v=this.i,R=R!==null&&v in R?R[v]:void 0),this.data=R}else this.data=v}y(Xp,ao);function Qp(){dl.call(this),this.status=1}y(Qp,dl);function po(v){this.g=v}y(po,bh),po.prototype.ua=function(){Lt(this.g,"a")},po.prototype.ta=function(v){Lt(this.g,new Xp(v))},po.prototype.sa=function(v){Lt(this.g,new Qp)},po.prototype.ra=function(){Lt(this.g,"b")},Rl.prototype.createWebChannel=Rl.prototype.g,Er.prototype.send=Er.prototype.o,Er.prototype.open=Er.prototype.m,Er.prototype.close=Er.prototype.close,oA=function(){return new Rl},iA=function(){return Hs()},rA=so,Ew={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ml.NO_ERROR=0,ml.TIMEOUT=8,ml.HTTP_ERROR=6,ym=ml,Rp.COMPLETE="complete",nA=Rp,hl.EventType=fi,fi.OPEN="a",fi.CLOSE="b",fi.ERROR="c",fi.MESSAGE="d",bt.prototype.listen=bt.prototype.K,nd=hl,nn.prototype.listenOnce=nn.prototype.L,nn.prototype.getLastError=nn.prototype.Ka,nn.prototype.getLastErrorCode=nn.prototype.Ba,nn.prototype.getStatus=nn.prototype.Z,nn.prototype.getResponseJson=nn.prototype.Oa,nn.prototype.getResponseText=nn.prototype.oa,nn.prototype.send=nn.prototype.ea,nn.prototype.setWithCredentials=nn.prototype.Ha,tA=nn}).apply(typeof Gf<"u"?Gf:typeof self<"u"?self:typeof window<"u"?window:{});const MC="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}gr.UNAUTHENTICATED=new gr(null),gr.GOOGLE_CREDENTIALS=new gr("google-credentials-uid"),gr.FIRST_PARTY=new gr("first-party-uid"),gr.MOCK_USER=new gr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hc="11.0.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ju=new L1("@firebase/firestore");function ec(){return ju.logLevel}function Me(r,...t){if(ju.logLevel<=Et.DEBUG){const e=t.map(K1);ju.debug(`Firestore (${Hc}): ${r}`,...e)}}function wa(r,...t){if(ju.logLevel<=Et.ERROR){const e=t.map(K1);ju.error(`Firestore (${Hc}): ${r}`,...e)}}function bc(r,...t){if(ju.logLevel<=Et.WARN){const e=t.map(K1);ju.warn(`Firestore (${Hc}): ${r}`,...e)}}function K1(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(e){return JSON.stringify(e)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function it(r="Unexpected state"){const t=`FIRESTORE (${Hc}) INTERNAL ASSERTION FAILED: `+r;throw wa(t),new Error(t)}function Vt(r,t){r||it()}function lt(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $e extends Sa{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class qV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(gr.UNAUTHENTICATED))}shutdown(){}}class HV{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class $V{constructor(t){this.t=t,this.currentUser=gr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Vt(this.o===void 0);let n=this.i;const i=u=>this.i!==n?(n=this.i,e(u)):Promise.resolve();let o=new ha;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ha,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const u=o;t.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},s=u=>{Me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>s(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?s(u):(Me("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ha)}},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(Me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Vt(typeof n.accessToken=="string"),new aA(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Vt(t===null||typeof t=="string"),new gr(t)}}class GV{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=gr.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class KV{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new GV(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(gr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class XV{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class QV{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){Vt(this.o===void 0);const n=o=>{o.error!=null&&Me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.R;return this.R=o.token,Me("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>n(o))};const i=o=>{Me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?i(o):Me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(Vt(typeof e.token=="string"),this.R=e.token,new XV(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YV(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const i=YV(40);for(let o=0;o<i.length;++o)n.length<20&&i[o]<e&&(n+=t.charAt(i[o]%t.length))}return n}}function At(r,t){return r<t?-1:r>t?1:0}function xc(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{static now(){return zn.fromMillis(Date.now())}static fromDate(t){return zn.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new zn(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new $e(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new $e(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new $e(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new $e(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?At(this.nanoseconds,t.nanoseconds):At(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{static fromTimestamp(t){return new ut(t)}static min(){return new ut(new zn(0,0))}static max(){return new ut(new zn(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(t,e,n){e===void 0?e=0:e>t.length&&it(),n===void 0?n=t.length-e:n>t.length-e&&it(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return Ed.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ed?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const o=t.get(i),a=e.get(i);if(o<a)return-1;if(o>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class on extends Ed{construct(t,e,n){return new on(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new $e(Ee.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new on(e)}static emptyPath(){return new on([])}}const JV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ar extends Ed{construct(t,e,n){return new ar(t,e,n)}static isValidIdentifier(t){return JV.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ar.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ar(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const o=()=>{if(n.length===0)throw new $e(Ee.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;i<t.length;){const s=t[i];if(s==="\\"){if(i+1===t.length)throw new $e(Ee.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const u=t[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new $e(Ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,i+=2}else s==="`"?(a=!a,i++):s!=="."||a?(n+=s,i++):(o(),i++)}if(o(),a)throw new $e(Ee.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ar(e)}static emptyPath(){return new ar([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(t){this.path=t}static fromPath(t){return new Qe(on.fromString(t))}static fromName(t){return new Qe(on.fromString(t).popFirst(5))}static empty(){return new Qe(on.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&on.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return on.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Qe(new on(t.slice()))}}function ZV(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=ut.fromTimestamp(n===1e9?new zn(e+1,0):new zn(e,n));return new Is(i,Qe.empty(),t)}function eB(r){return new Is(r.readTime,r.key,-1)}class Is{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Is(ut.min(),Qe.empty(),-1)}static max(){return new Is(ut.max(),Qe.empty(),-1)}}function tB(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=Qe.comparator(r.documentKey,t.documentKey),e!==0?e:At(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nB="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rB{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $c(r){if(r.code!==Ee.FAILED_PRECONDITION||r.message!==nB)throw r;Me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&it(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ve((n,i)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(n,i)},this.catchCallback=o=>{this.wrapFailure(e,o).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof ve?e:ve.resolve(e)}catch(e){return ve.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):ve.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):ve.reject(e)}static resolve(t){return new ve((e,n)=>{e(t)})}static reject(t){return new ve((e,n)=>{n(t)})}static waitFor(t){return new ve((e,n)=>{let i=0,o=0,a=!1;t.forEach(s=>{++i,s.next(()=>{++o,a&&o===i&&e()},u=>n(u))}),a=!0,o===i&&e()})}static or(t){let e=ve.resolve(!1);for(const n of t)e=e.next(i=>i?ve.resolve(i):n());return e}static forEach(t,e){const n=[];return t.forEach((i,o)=>{n.push(e.call(this,i,o))}),this.waitFor(n)}static mapArray(t,e){return new ve((n,i)=>{const o=t.length,a=new Array(o);let s=0;for(let u=0;u<o;u++){const c=u;e(t[c]).next(d=>{a[c]=d,++s,s===o&&n(a)},d=>i(d))}})}static doWhile(t,e){return new ve((n,i)=>{const o=()=>{t()===!0?e().next(()=>{o()},i):n()};o()})}}function iB(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Gc(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ie(n),this.se=n=>e.writeSequenceNumber(n))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}Dg.oe=-1;function Og(r){return r==null}function Xm(r){return r===0&&1/r==-1/0}function oB(r){return typeof r=="number"&&Number.isInteger(r)&&!Xm(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aB(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=LC(t)),t=sB(r.get(e),t);return LC(t)}function sB(r,t){let e=t;const n=r.length;for(let i=0;i<n;i++){const o=r.charAt(i);switch(o){case"\0":e+="";break;case"":e+="";break;default:e+=o}}return e}function LC(r){return r+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FC(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Ls(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function uA(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(t,e){this.comparator=t,this.root=e||rr.EMPTY}insert(t,e){return new hn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,rr.BLACK,null,null))}remove(t){return new hn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,rr.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Kf(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Kf(this.root,t,this.comparator,!1)}getReverseIterator(){return new Kf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Kf(this.root,t,this.comparator,!0)}}class Kf{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?n(t.key,e):1,e&&i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class rr{constructor(t,e,n,i,o){this.key=t,this.value=e,this.color=n??rr.RED,this.left=i??rr.EMPTY,this.right=o??rr.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,o){return new rr(t??this.key,e??this.value,n??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const o=n(t,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(t,e,n),null):o===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return rr.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return rr.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,rr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,rr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw it();const t=this.left.check();if(t!==this.right.check())throw it();return t+(this.isRed()?0:1)}}rr.EMPTY=null,rr.RED=!0,rr.BLACK=!1;rr.EMPTY=new class{constructor(){this.size=0}get key(){throw it()}get value(){throw it()}get color(){throw it()}get left(){throw it()}get right(){throw it()}copy(t,e,n,i,o){return this}insert(t,e,n){return new rr(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(t){this.comparator=t,this.data=new hn(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new zC(this.data.getIterator())}getIteratorFrom(t){return new zC(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof Vn)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const i=e.getNext().key,o=n.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Vn(this.comparator);return e.data=t,e}}class zC{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(t){this.fields=t,t.sort(ar.comparator)}static empty(){return new ai([])}unionWith(t){let e=new Vn(ar.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new ai(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return xc(this.fields,t.fields,(e,n)=>e.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new lA("Invalid base64 string: "+o):o}}(t);return new ur(e)}static fromUint8Array(t){const e=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(t);return new ur(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return At(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ur.EMPTY_BYTE_STRING=new ur("");const uB=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cs(r){if(Vt(!!r),typeof r=="string"){let t=0;const e=uB.exec(r);if(Vt(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:bn(r.seconds),nanos:bn(r.nanos)}}function bn(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Ss(r){return typeof r=="string"?ur.fromBase64String(r):ur.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X1(r){var t,e;return((e=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Pg(r){const t=r.mapValue.fields.__previous_value__;return X1(t)?Pg(t):t}function Id(r){const t=Cs(r.mapValue.fields.__local_write_time__.timestampValue);return new zn(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lB{constructor(t,e,n,i,o,a,s,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=s,this.longPollingOptions=u,this.useFetchStreams=c}}class Cd{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Cd("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof Cd&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ts(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?X1(r)?4:hB(r)?9007199254740991:cB(r)?10:11:it()}function Ro(r,t){if(r===t)return!0;const e=Ts(r);if(e!==Ts(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Id(r).isEqual(Id(t));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const a=Cs(i.timestampValue),s=Cs(o.timestampValue);return a.seconds===s.seconds&&a.nanos===s.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,o){return Ss(i.bytesValue).isEqual(Ss(o.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,o){return bn(i.geoPointValue.latitude)===bn(o.geoPointValue.latitude)&&bn(i.geoPointValue.longitude)===bn(o.geoPointValue.longitude)}(r,t);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return bn(i.integerValue)===bn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const a=bn(i.doubleValue),s=bn(o.doubleValue);return a===s?Xm(a)===Xm(s):isNaN(a)&&isNaN(s)}return!1}(r,t);case 9:return xc(r.arrayValue.values||[],t.arrayValue.values||[],Ro);case 10:case 11:return function(i,o){const a=i.mapValue.fields||{},s=o.mapValue.fields||{};if(FC(a)!==FC(s))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(s[u]===void 0||!Ro(a[u],s[u])))return!1;return!0}(r,t);default:return it()}}function Sd(r,t){return(r.values||[]).find(e=>Ro(e,t))!==void 0}function _c(r,t){if(r===t)return 0;const e=Ts(r),n=Ts(t);if(e!==n)return At(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return At(r.booleanValue,t.booleanValue);case 2:return function(o,a){const s=bn(o.integerValue||o.doubleValue),u=bn(a.integerValue||a.doubleValue);return s<u?-1:s>u?1:s===u?0:isNaN(s)?isNaN(u)?0:-1:1}(r,t);case 3:return VC(r.timestampValue,t.timestampValue);case 4:return VC(Id(r),Id(t));case 5:return At(r.stringValue,t.stringValue);case 6:return function(o,a){const s=Ss(o),u=Ss(a);return s.compareTo(u)}(r.bytesValue,t.bytesValue);case 7:return function(o,a){const s=o.split("/"),u=a.split("/");for(let c=0;c<s.length&&c<u.length;c++){const d=At(s[c],u[c]);if(d!==0)return d}return At(s.length,u.length)}(r.referenceValue,t.referenceValue);case 8:return function(o,a){const s=At(bn(o.latitude),bn(a.latitude));return s!==0?s:At(bn(o.longitude),bn(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return BC(r.arrayValue,t.arrayValue);case 10:return function(o,a){var s,u,c,d;const p=o.fields||{},f=a.fields||{},g=(s=p.value)===null||s===void 0?void 0:s.arrayValue,y=(u=f.value)===null||u===void 0?void 0:u.arrayValue,x=At(((c=g==null?void 0:g.values)===null||c===void 0?void 0:c.length)||0,((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:BC(g,y)}(r.mapValue,t.mapValue);case 11:return function(o,a){if(o===Xf.mapValue&&a===Xf.mapValue)return 0;if(o===Xf.mapValue)return 1;if(a===Xf.mapValue)return-1;const s=o.fields||{},u=Object.keys(s),c=a.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let p=0;p<u.length&&p<d.length;++p){const f=At(u[p],d[p]);if(f!==0)return f;const g=_c(s[u[p]],c[d[p]]);if(g!==0)return g}return At(u.length,d.length)}(r.mapValue,t.mapValue);default:throw it()}}function VC(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return At(r,t);const e=Cs(r),n=Cs(t),i=At(e.seconds,n.seconds);return i!==0?i:At(e.nanos,n.nanos)}function BC(r,t){const e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){const o=_c(e[i],n[i]);if(o)return o}return At(e.length,n.length)}function Ec(r){return Iw(r)}function Iw(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){const n=Cs(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Ss(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return Qe.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(const o of e.values||[])i?i=!1:n+=",",n+=Iw(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){const n=Object.keys(e.fields||{}).sort();let i="{",o=!0;for(const a of n)o?o=!1:i+=",",i+=`${a}:${Iw(e.fields[a])}`;return i+"}"}(r.mapValue):it()}function wm(r){switch(Ts(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Pg(r);return t?16+wm(t):16;case 5:return 2*r.stringValue.length;case 6:return Ss(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,o)=>i+wm(o),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return Ls(n.fields,(o,a)=>{i+=o.length+wm(a)}),i}(r.mapValue);default:throw it()}}function Cw(r){return!!r&&"integerValue"in r}function Q1(r){return!!r&&"arrayValue"in r}function UC(r){return!!r&&"nullValue"in r}function jC(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function bm(r){return!!r&&"mapValue"in r}function cB(r){var t,e;return((e=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function dd(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return Ls(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=dd(n)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=dd(r.arrayValue.values[e]);return t}return Object.assign({},r)}function hB(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(t){this.value=t}static empty(){return new jr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!bm(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=dd(e)}setAll(t){let e=ar.emptyPath(),n={},i=[];t.forEach((a,s)=>{if(!e.isImmediateParentOf(s)){const u=this.getFieldsMap(e);this.applyChanges(u,n,i),n={},i=[],e=s.popLast()}a?n[s.lastSegment()]=dd(a):i.push(s.lastSegment())});const o=this.getFieldsMap(e);this.applyChanges(o,n,i)}delete(t){const e=this.field(t.popLast());bm(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ro(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];bm(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Ls(e,(i,o)=>t[i]=o);for(const i of n)delete t[i]}clone(){return new jr(dd(this.value))}}function cA(r){const t=[];return Ls(r.fields,(e,n)=>{const i=new ar([e]);if(bm(n)){const o=cA(n.mapValue).fields;if(o.length===0)t.push(i);else for(const a of o)t.push(i.child(a))}else t.push(i)}),new ai(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(t,e,n,i,o,a,s){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=o,this.data=a,this.documentState=s}static newInvalidDocument(t){return new vr(t,0,ut.min(),ut.min(),ut.min(),jr.empty(),0)}static newFoundDocument(t,e,n,i){return new vr(t,1,e,ut.min(),n,i,0)}static newNoDocument(t,e){return new vr(t,2,e,ut.min(),ut.min(),jr.empty(),0)}static newUnknownDocument(t,e){return new vr(t,3,e,ut.min(),ut.min(),jr.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ut.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=jr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=jr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ut.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof vr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new vr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(t,e){this.position=t,this.inclusive=e}}function WC(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){const o=t[i],a=r.position[i];if(o.field.isKeyField()?n=Qe.comparator(Qe.fromName(a.referenceValue),e.key):n=_c(a,e.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function qC(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Ro(r.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(t,e="asc"){this.field=t,this.dir=e}}function dB(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{}class Fn extends hA{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new fB(t,e,n):e==="array-contains"?new vB(t,n):e==="in"?new yB(t,n):e==="not-in"?new wB(t,n):e==="array-contains-any"?new bB(t,n):new Fn(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new mB(t,n):new gB(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(_c(e,this.value)):e!==null&&Ts(this.value)===Ts(e)&&this.matchesComparison(_c(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return it()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ko extends hA{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new ko(t,e)}matches(t){return dA(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function dA(r){return r.op==="and"}function pA(r){return pB(r)&&dA(r)}function pB(r){for(const t of r.filters)if(t instanceof ko)return!1;return!0}function Sw(r){if(r instanceof Fn)return r.field.canonicalString()+r.op.toString()+Ec(r.value);if(pA(r))return r.filters.map(t=>Sw(t)).join(",");{const t=r.filters.map(e=>Sw(e)).join(",");return`${r.op}(${t})`}}function fA(r,t){return r instanceof Fn?function(n,i){return i instanceof Fn&&n.op===i.op&&n.field.isEqual(i.field)&&Ro(n.value,i.value)}(r,t):r instanceof ko?function(n,i){return i instanceof ko&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((o,a,s)=>o&&fA(a,i.filters[s]),!0):!1}(r,t):void it()}function mA(r){return r instanceof Fn?function(e){return`${e.field.canonicalString()} ${e.op} ${Ec(e.value)}`}(r):r instanceof ko?function(e){return e.op.toString()+" {"+e.getFilters().map(mA).join(" ,")+"}"}(r):"Filter"}class fB extends Fn{constructor(t,e,n){super(t,e,n),this.key=Qe.fromName(n.referenceValue)}matches(t){const e=Qe.comparator(t.key,this.key);return this.matchesComparison(e)}}class mB extends Fn{constructor(t,e){super(t,"in",e),this.keys=gA("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class gB extends Fn{constructor(t,e){super(t,"not-in",e),this.keys=gA("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function gA(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>Qe.fromName(n.referenceValue))}class vB extends Fn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Q1(e)&&Sd(e.arrayValue,this.value)}}class yB extends Fn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Sd(this.value.arrayValue,e)}}class wB extends Fn{constructor(t,e){super(t,"not-in",e)}matches(t){if(Sd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&!Sd(this.value.arrayValue,e)}}class bB extends Fn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Q1(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Sd(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xB{constructor(t,e=null,n=[],i=[],o=null,a=null,s=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=o,this.startAt=a,this.endAt=s,this.ue=null}}function HC(r,t=null,e=[],n=[],i=null,o=null,a=null){return new xB(r,t,e,n,i,o,a)}function Y1(r){const t=lt(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Sw(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(o){return o.field.canonicalString()+o.dir}(n)).join(","),Og(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Ec(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Ec(n)).join(",")),t.ue=e}return t.ue}function J1(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!dB(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!fA(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!qC(r.startAt,t.startAt)&&qC(r.endAt,t.endAt)}function Tw(r){return Qe.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(t,e=null,n=[],i=[],o=null,a="F",s=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=o,this.limitType=a,this.startAt=s,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function _B(r,t,e,n,i,o,a,s){return new Mg(r,t,e,n,i,o,a,s)}function Z1(r){return new Mg(r)}function $C(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function EB(r){return r.collectionGroup!==null}function pd(r){const t=lt(r);if(t.ce===null){t.ce=[];const e=new Set;for(const o of t.explicitOrderBy)t.ce.push(o),e.add(o.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let s=new Vn(ar.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(s=s.add(c.field))})}),s})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.ce.push(new Ym(o,n))}),e.has(ar.keyField().canonicalString())||t.ce.push(new Ym(ar.keyField(),n))}return t.ce}function Co(r){const t=lt(r);return t.le||(t.le=IB(t,pd(r))),t.le}function IB(r,t){if(r.limitType==="F")return HC(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{const o=i.dir==="desc"?"asc":"desc";return new Ym(i.field,o)});const e=r.endAt?new Qm(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Qm(r.startAt.position,r.startAt.inclusive):null;return HC(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Aw(r,t,e){return new Mg(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Lg(r,t){return J1(Co(r),Co(t))&&r.limitType===t.limitType}function vA(r){return`${Y1(Co(r))}|lt:${r.limitType}`}function tc(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>mA(i)).join(", ")}]`),Og(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>Ec(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>Ec(i)).join(",")),`Target(${n})`}(Co(r))}; limitType=${r.limitType})`}function Fg(r,t){return t.isFoundDocument()&&function(n,i){const o=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):Qe.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,t)&&function(n,i){for(const o of pd(n))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(r,t)&&function(n,i){for(const o of n.filters)if(!o.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,s,u){const c=WC(a,s,u);return a.inclusive?c<=0:c<0}(n.startAt,pd(n),i)||n.endAt&&!function(a,s,u){const c=WC(a,s,u);return a.inclusive?c>=0:c>0}(n.endAt,pd(n),i))}(r,t)}function CB(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function yA(r){return(t,e)=>{let n=!1;for(const i of pd(r)){const o=SB(i,t,e);if(o!==0)return o;n=n||i.field.isKeyField()}return 0}}function SB(r,t,e){const n=r.field.isKeyField()?Qe.comparator(t.key,e.key):function(o,a,s){const u=a.data.field(o),c=s.data.field(o);return u!==null&&c!==null?_c(u,c):it()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return it()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[i,o]of n)if(this.equalsFn(i,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Ls(this.inner,(e,n)=>{for(const[i,o]of n)t(i,o)})}isEmpty(){return uA(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TB=new hn(Qe.comparator);function ba(){return TB}const wA=new hn(Qe.comparator);function rd(...r){let t=wA;for(const e of r)t=t.insert(e.key,e);return t}function bA(r){let t=wA;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Su(){return fd()}function xA(){return fd()}function fd(){return new Yu(r=>r.toString(),(r,t)=>r.isEqual(t))}const AB=new hn(Qe.comparator),RB=new Vn(Qe.comparator);function It(...r){let t=RB;for(const e of r)t=t.add(e);return t}const kB=new Vn(At);function NB(){return kB}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xm(t)?"-0":t}}function _A(r){return{integerValue:""+r}}function DB(r,t){return oB(t)?_A(t):eb(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(){this._=void 0}}function OB(r,t,e){return r instanceof Jm?function(i,o){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&X1(o)&&(o=Pg(o)),o&&(a.fields.__previous_value__=o),{mapValue:a}}(e,t):r instanceof Td?IA(r,t):r instanceof Ad?CA(r,t):function(i,o){const a=EA(i,o),s=GC(a)+GC(i.Pe);return Cw(a)&&Cw(i.Pe)?_A(s):eb(i.serializer,s)}(r,t)}function PB(r,t,e){return r instanceof Td?IA(r,t):r instanceof Ad?CA(r,t):e}function EA(r,t){return r instanceof Zm?function(n){return Cw(n)||function(o){return!!o&&"doubleValue"in o}(n)}(t)?t:{integerValue:0}:null}class Jm extends zg{}class Td extends zg{constructor(t){super(),this.elements=t}}function IA(r,t){const e=SA(t);for(const n of r.elements)e.some(i=>Ro(i,n))||e.push(n);return{arrayValue:{values:e}}}class Ad extends zg{constructor(t){super(),this.elements=t}}function CA(r,t){let e=SA(t);for(const n of r.elements)e=e.filter(i=>!Ro(i,n));return{arrayValue:{values:e}}}class Zm extends zg{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function GC(r){return bn(r.integerValue||r.doubleValue)}function SA(r){return Q1(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function MB(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof Td&&i instanceof Td||n instanceof Ad&&i instanceof Ad?xc(n.elements,i.elements,Ro):n instanceof Zm&&i instanceof Zm?Ro(n.Pe,i.Pe):n instanceof Jm&&i instanceof Jm}(r.transform,t.transform)}class LB{constructor(t,e){this.version=t,this.transformResults=e}}class So{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new So}static exists(t){return new So(void 0,t)}static updateTime(t){return new So(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function xm(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class Vg{}function TA(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new RA(r.key,So.none()):new tp(r.key,r.data,So.none());{const e=r.data,n=jr.empty();let i=new Vn(ar.comparator);for(let o of t.fields)if(!i.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?n.delete(o):n.set(o,a),i=i.add(o)}return new Fs(r.key,n,new ai(i.toArray()),So.none())}}function FB(r,t,e){r instanceof tp?function(i,o,a){const s=i.value.clone(),u=XC(i.fieldTransforms,o,a.transformResults);s.setAll(u),o.convertToFoundDocument(a.version,s).setHasCommittedMutations()}(r,t,e):r instanceof Fs?function(i,o,a){if(!xm(i.precondition,o))return void o.convertToUnknownDocument(a.version);const s=XC(i.fieldTransforms,o,a.transformResults),u=o.data;u.setAll(AA(i)),u.setAll(s),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function md(r,t,e,n){return r instanceof tp?function(o,a,s,u){if(!xm(o.precondition,a))return s;const c=o.value.clone(),d=QC(o.fieldTransforms,u,a);return c.setAll(d),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),null}(r,t,e,n):r instanceof Fs?function(o,a,s,u){if(!xm(o.precondition,a))return s;const c=QC(o.fieldTransforms,u,a),d=a.data;return d.setAll(AA(o)),d.setAll(c),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),s===null?null:s.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(p=>p.field))}(r,t,e,n):function(o,a,s){return xm(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):s}(r,t,e)}function zB(r,t){let e=null;for(const n of r.fieldTransforms){const i=t.data.field(n.field),o=EA(n.transform,i||null);o!=null&&(e===null&&(e=jr.empty()),e.set(n.field,o))}return e||null}function KC(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&xc(n,i,(o,a)=>MB(o,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class tp extends Vg{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Fs extends Vg{constructor(t,e,n,i,o=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function AA(r){const t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}}),t}function XC(r,t,e){const n=new Map;Vt(r.length===e.length);for(let i=0;i<e.length;i++){const o=r[i],a=o.transform,s=t.data.field(o.field);n.set(o.field,PB(a,s,e[i]))}return n}function QC(r,t,e){const n=new Map;for(const i of r){const o=i.transform,a=e.data.field(i.field);n.set(i.field,OB(o,a,t))}return n}class RA extends Vg{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class VB extends Vg{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BB{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(t.key)&&FB(o,t,n[i])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=md(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=md(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=xA();return this.mutations.forEach(i=>{const o=t.get(i.key),a=o.overlayedDocument;let s=this.applyToLocalView(a,o.mutatedFields);s=e.has(i.key)?null:s;const u=TA(a,s);u!==null&&n.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(ut.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),It())}isEqual(t){return this.batchId===t.batchId&&xc(this.mutations,t.mutations,(e,n)=>KC(e,n))&&xc(this.baseMutations,t.baseMutations,(e,n)=>KC(e,n))}}class tb{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){Vt(t.mutations.length===n.length);let i=function(){return AB}();const o=t.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new tb(t,e,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UB{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jB{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sn,kt;function WB(r){switch(r){default:return it();case Ee.CANCELLED:case Ee.UNKNOWN:case Ee.DEADLINE_EXCEEDED:case Ee.RESOURCE_EXHAUSTED:case Ee.INTERNAL:case Ee.UNAVAILABLE:case Ee.UNAUTHENTICATED:return!1;case Ee.INVALID_ARGUMENT:case Ee.NOT_FOUND:case Ee.ALREADY_EXISTS:case Ee.PERMISSION_DENIED:case Ee.FAILED_PRECONDITION:case Ee.ABORTED:case Ee.OUT_OF_RANGE:case Ee.UNIMPLEMENTED:case Ee.DATA_LOSS:return!0}}function kA(r){if(r===void 0)return wa("GRPC error has no .code"),Ee.UNKNOWN;switch(r){case Sn.OK:return Ee.OK;case Sn.CANCELLED:return Ee.CANCELLED;case Sn.UNKNOWN:return Ee.UNKNOWN;case Sn.DEADLINE_EXCEEDED:return Ee.DEADLINE_EXCEEDED;case Sn.RESOURCE_EXHAUSTED:return Ee.RESOURCE_EXHAUSTED;case Sn.INTERNAL:return Ee.INTERNAL;case Sn.UNAVAILABLE:return Ee.UNAVAILABLE;case Sn.UNAUTHENTICATED:return Ee.UNAUTHENTICATED;case Sn.INVALID_ARGUMENT:return Ee.INVALID_ARGUMENT;case Sn.NOT_FOUND:return Ee.NOT_FOUND;case Sn.ALREADY_EXISTS:return Ee.ALREADY_EXISTS;case Sn.PERMISSION_DENIED:return Ee.PERMISSION_DENIED;case Sn.FAILED_PRECONDITION:return Ee.FAILED_PRECONDITION;case Sn.ABORTED:return Ee.ABORTED;case Sn.OUT_OF_RANGE:return Ee.OUT_OF_RANGE;case Sn.UNIMPLEMENTED:return Ee.UNIMPLEMENTED;case Sn.DATA_LOSS:return Ee.DATA_LOSS;default:return it()}}(kt=Sn||(Sn={}))[kt.OK=0]="OK",kt[kt.CANCELLED=1]="CANCELLED",kt[kt.UNKNOWN=2]="UNKNOWN",kt[kt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kt[kt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kt[kt.NOT_FOUND=5]="NOT_FOUND",kt[kt.ALREADY_EXISTS=6]="ALREADY_EXISTS",kt[kt.PERMISSION_DENIED=7]="PERMISSION_DENIED",kt[kt.UNAUTHENTICATED=16]="UNAUTHENTICATED",kt[kt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kt[kt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kt[kt.ABORTED=10]="ABORTED",kt[kt.OUT_OF_RANGE=11]="OUT_OF_RANGE",kt[kt.UNIMPLEMENTED=12]="UNIMPLEMENTED",kt[kt.INTERNAL=13]="INTERNAL",kt[kt.UNAVAILABLE=14]="UNAVAILABLE",kt[kt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qB(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB=new Du([4294967295,4294967295],0);function YC(r){const t=qB().encode(r),e=new eA;return e.update(t),new Uint8Array(e.digest())}function JC(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new Du([e,n],0),new Du([i,o],0)]}class nb{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new id(`Invalid padding: ${e}`);if(n<0)throw new id(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new id(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new id(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=Du.fromNumber(this.Te)}Ee(t,e,n){let i=t.add(e.multiply(Du.fromNumber(n)));return i.compare(HB)===1&&(i=new Du([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;const e=YC(t),[n,i]=JC(e);for(let o=0;o<this.hashCount;o++){const a=this.Ee(n,i,o);if(!this.de(a))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new nb(o,i,e);return n.forEach(s=>a.insert(s)),a}insert(t){if(this.Te===0)return;const e=YC(t),[n,i]=JC(e);for(let o=0;o<this.hashCount;o++){const a=this.Ee(n,i,o);this.Ae(a)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class id extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(t,e,n,i,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,np.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Bg(ut.min(),i,new hn(At),ba(),It())}}class np{constructor(t,e,n,i,o){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new np(n,e,It(),It(),It())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}}class NA{constructor(t,e){this.targetId=t,this.me=e}}class DA{constructor(t,e,n=ur.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class ZC{constructor(){this.fe=0,this.ge=eS(),this.pe=ur.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=It(),e=It(),n=It();return this.ge.forEach((i,o)=>{switch(o){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:it()}}),new np(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=eS()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,Vt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class $B{constructor(t){this.Le=t,this.Be=new Map,this.ke=ba(),this.qe=Qf(),this.Qe=Qf(),this.Ke=new hn(At)}$e(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.je(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.De(t.resumeToken));break;default:it()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.je(i)&&e(i)})}Je(t){const e=t.targetId,n=t.me.count,i=this.Ye(e);if(i){const o=i.target;if(Tw(o))if(n===0){const a=new Qe(o.path);this.We(e,a,vr.newNoDocument(a,ut.min()))}else Vt(n===1);else{const a=this.Ze(e);if(a!==n){const s=this.Xe(t),u=s?this.et(s,t,a):1;if(u!==0){this.He(e);const c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,c)}}}}}Xe(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:o=0}=e;let a,s;try{a=Ss(n).toUint8Array()}catch(u){if(u instanceof lA)return bc("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{s=new nb(a,i,o)}catch(u){return bc(u instanceof id?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return s.Te===0?null:s}et(t,e,n){return e.me.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let i=0;return n.forEach(o=>{const a=this.Le.nt(),s=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(s)||(this.We(e,o,null),i++)}),i}it(t){const e=new Map;this.Be.forEach((o,a)=>{const s=this.Ye(a);if(s){if(o.current&&Tw(s.target)){const u=new Qe(s.target.path);this.st(u).has(a)||this.ot(a,u)||this.We(a,u,vr.newNoDocument(u,t))}o.be&&(e.set(a,o.ve()),o.Ce())}});let n=It();this.Qe.forEach((o,a)=>{let s=!0;a.forEachWhile(u=>{const c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)}),s&&(n=n.add(o))}),this.ke.forEach((o,a)=>a.setReadTime(t));const i=new Bg(t,e,this.Ke,this.ke,n);return this.ke=ba(),this.qe=Qf(),this.Qe=Qf(),this.Ke=new hn(At),i}Ue(t,e){if(!this.je(t))return;const n=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const i=this.ze(t);this.ot(t,e)?i.Fe(e,1):i.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Be.get(t);return e||(e=new ZC,this.Be.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new Vn(At),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Vn(At),this.qe=this.qe.insert(t,e)),e}je(t){const e=this.Ye(t)!==null;return e||Me("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ut(t)}He(t){this.Be.set(t,new ZC),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}ot(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Qf(){return new hn(Qe.comparator)}function eS(){return new hn(Qe.comparator)}const GB={asc:"ASCENDING",desc:"DESCENDING"},KB={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},XB={and:"AND",or:"OR"};class QB{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Rw(r,t){return r.useProto3Json||Og(t)?t:{value:t}}function eg(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function OA(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function YB(r,t){return eg(r,t.toTimestamp())}function To(r){return Vt(!!r),ut.fromTimestamp(function(e){const n=Cs(e);return new zn(n.seconds,n.nanos)}(r))}function rb(r,t){return kw(r,t).canonicalString()}function kw(r,t){const e=function(i){return new on(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function PA(r){const t=on.fromString(r);return Vt(VA(t)),t}function Nw(r,t){return rb(r.databaseId,t.path)}function D0(r,t){const e=PA(t);if(e.get(1)!==r.databaseId.projectId)throw new $e(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new $e(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new Qe(LA(e))}function MA(r,t){return rb(r.databaseId,t)}function JB(r){const t=PA(r);return t.length===4?on.emptyPath():LA(t)}function Dw(r){return new on(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function LA(r){return Vt(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function tS(r,t,e){return{name:Nw(r,t),fields:e.value.mapValue.fields}}function ZB(r,t){let e;if("targetChange"in t){t.targetChange;const n=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:it()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=function(c,d){return c.useProto3Json?(Vt(d===void 0||typeof d=="string"),ur.fromBase64String(d||"")):(Vt(d===void 0||d instanceof Buffer||d instanceof Uint8Array),ur.fromUint8Array(d||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,s=a&&function(c){const d=c.code===void 0?Ee.UNKNOWN:kA(c.code);return new $e(d,c.message||"")}(a);e=new DA(n,i,o,s||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const i=D0(r,n.document.name),o=To(n.document.updateTime),a=n.document.createTime?To(n.document.createTime):ut.min(),s=new jr({mapValue:{fields:n.document.fields}}),u=vr.newFoundDocument(i,o,a,s),c=n.targetIds||[],d=n.removedTargetIds||[];e=new _m(c,d,u.key,u)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const i=D0(r,n.document),o=n.readTime?To(n.readTime):ut.min(),a=vr.newNoDocument(i,o),s=n.removedTargetIds||[];e=new _m([],s,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const i=D0(r,n.document),o=n.removedTargetIds||[];e=new _m([],o,i,null)}else{if(!("filter"in t))return it();{t.filter;const n=t.filter;n.targetId;const{count:i=0,unchangedNames:o}=n,a=new jB(i,o),s=n.targetId;e=new NA(s,a)}}return e}function eU(r,t){let e;if(t instanceof tp)e={update:tS(r,t.key,t.value)};else if(t instanceof RA)e={delete:Nw(r,t.key)};else if(t instanceof Fs)e={update:tS(r,t.key,t.data),updateMask:lU(t.fieldMask)};else{if(!(t instanceof VB))return it();e={verify:Nw(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(o,a){const s=a.transform;if(s instanceof Jm)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Td)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Ad)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof Zm)return{fieldPath:a.field.canonicalString(),increment:s.Pe};throw it()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:YB(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:it()}(r,t.precondition)),e}function tU(r,t){return r&&r.length>0?(Vt(t!==void 0),r.map(e=>function(i,o){let a=i.updateTime?To(i.updateTime):To(o);return a.isEqual(ut.min())&&(a=To(o)),new LB(a,i.transformResults||[])}(e,t))):[]}function nU(r,t){return{documents:[MA(r,t.path)]}}function rU(r,t){const e={structuredQuery:{}},n=t.path;let i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=MA(r,i);const o=function(c){if(c.length!==0)return zA(ko.create(c,"and"))}(t.filters);o&&(e.structuredQuery.where=o);const a=function(c){if(c.length!==0)return c.map(d=>function(f){return{field:nc(f.field),direction:aU(f.dir)}}(d))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);const s=Rw(r,t.limit);return s!==null&&(e.structuredQuery.limit=s),t.startAt&&(e.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{ct:e,parent:i}}function iU(r){let t=JB(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let i=null;if(n>0){Vt(n===1);const d=e.from[0];d.allDescendants?i=d.collectionId:t=t.child(d.collectionId)}let o=[];e.where&&(o=function(p){const f=FA(p);return f instanceof ko&&pA(f)?f.getFilters():[f]}(e.where));let a=[];e.orderBy&&(a=function(p){return p.map(f=>function(y){return new Ym(rc(y.field),function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(e.orderBy));let s=null;e.limit&&(s=function(p){let f;return f=typeof p=="object"?p.value:p,Og(f)?null:f}(e.limit));let u=null;e.startAt&&(u=function(p){const f=!!p.before,g=p.values||[];return new Qm(g,f)}(e.startAt));let c=null;return e.endAt&&(c=function(p){const f=!p.before,g=p.values||[];return new Qm(g,f)}(e.endAt)),_B(t,i,a,o,s,"F",u,c)}function oU(r,t){const e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return it()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function FA(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=rc(e.unaryFilter.field);return Fn.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=rc(e.unaryFilter.field);return Fn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=rc(e.unaryFilter.field);return Fn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=rc(e.unaryFilter.field);return Fn.create(a,"!=",{nullValue:"NULL_VALUE"});default:return it()}}(r):r.fieldFilter!==void 0?function(e){return Fn.create(rc(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return it()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return ko.create(e.compositeFilter.filters.map(n=>FA(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return it()}}(e.compositeFilter.op))}(r):it()}function aU(r){return GB[r]}function sU(r){return KB[r]}function uU(r){return XB[r]}function nc(r){return{fieldPath:r.canonicalString()}}function rc(r){return ar.fromServerFormat(r.fieldPath)}function zA(r){return r instanceof Fn?function(e){if(e.op==="=="){if(jC(e.value))return{unaryFilter:{field:nc(e.field),op:"IS_NAN"}};if(UC(e.value))return{unaryFilter:{field:nc(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(jC(e.value))return{unaryFilter:{field:nc(e.field),op:"IS_NOT_NAN"}};if(UC(e.value))return{unaryFilter:{field:nc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nc(e.field),op:sU(e.op),value:e.value}}}(r):r instanceof ko?function(e){const n=e.getFilters().map(i=>zA(i));return n.length===1?n[0]:{compositeFilter:{op:uU(e.op),filters:n}}}(r):it()}function lU(r){const t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function VA(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(t,e,n,i,o=ut.min(),a=ut.min(),s=ur.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=s,this.expectedCount=u}withSequenceNumber(t){return new cs(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new cs(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new cs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new cs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cU{constructor(t){this.ht=t}}function hU(r){const t=iU({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Aw(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dU{constructor(){this.ln=new pU}addToCollectionParentIndex(t,e){return this.ln.add(e),ve.resolve()}getCollectionParents(t,e){return ve.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return ve.resolve()}deleteFieldIndex(t,e){return ve.resolve()}deleteAllFieldIndexes(t){return ve.resolve()}createTargetIndexes(t,e){return ve.resolve()}getDocumentsMatchingTarget(t,e){return ve.resolve(null)}getIndexType(t,e){return ve.resolve(0)}getFieldIndexes(t,e){return ve.resolve([])}getNextCollectionGroupToUpdate(t){return ve.resolve(null)}getMinOffset(t,e){return ve.resolve(Is.min())}getMinOffsetFromCollectionGroup(t,e){return ve.resolve(Is.min())}updateCollectionGroup(t,e,n){return ve.resolve()}updateIndexEntries(t,e){return ve.resolve()}}class pU{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Vn(on.comparator),o=!i.has(n);return this.index[e]=i.add(n),o}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Vn(on.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Br{static withCacheSize(t){return new Br(t,Br.DEFAULT_COLLECTION_PERCENTILE,Br.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Br.DEFAULT_COLLECTION_PERCENTILE=10,Br.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Br.DEFAULT=new Br(41943040,Br.DEFAULT_COLLECTION_PERCENTILE,Br.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Br.DISABLED=new Br(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new Ic(0)}static Qn(){return new Ic(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rS([r,t],[e,n]){const i=At(r,e);return i===0?At(t,n):i}class fU{constructor(t){this.Gn=t,this.buffer=new Vn(rS),this.zn=0}jn(){return++this.zn}Hn(t){const e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();rS(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class mU{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(t){Me("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Gc(e)?Me("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await $c(e)}await this.Yn(3e5)})}}class gU{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return ve.resolve(Dg.oe);const n=new fU(e);return this.Zn.forEachTarget(t,i=>n.Hn(i.sequenceNumber)).next(()=>this.Zn.er(t,i=>n.Hn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Zn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(Me("LruGarbageCollector","Garbage collection skipped; disabled"),ve.resolve(nS)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(Me("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nS):this.tr(t,e))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let n,i,o,a,s,u,c;const d=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(Me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(t,i))).next(p=>(n=p,s=Date.now(),this.removeTargets(t,n,e))).next(p=>(o=p,u=Date.now(),this.removeOrphanedDocuments(t,n))).next(p=>(c=Date.now(),ec()<=Et.DEBUG&&Me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-d}ms
	Determined least recently used ${i} in `+(s-a)+`ms
	Removed ${o} targets in `+(u-s)+`ms
	Removed ${p} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),ve.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:p})))}}function vU(r,t){return new gU(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(){this.changes=new Yu(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,vr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?ve.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wU{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&md(n.mutation,i,ai.empty(),zn.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,It()).next(()=>n))}getLocalViewOfDocuments(t,e,n=It()){const i=Su();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(o=>{let a=rd();return o.forEach((s,u)=>{a=a.insert(s,u.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){const n=Su();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,It()))}populateOverlays(t,e,n){const i=[];return n.forEach(o=>{e.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(t,i).next(o=>{o.forEach((a,s)=>{e.set(a,s)})})}computeViews(t,e,n,i){let o=ba();const a=fd(),s=function(){return fd()}();return e.forEach((u,c)=>{const d=n.get(c.key);i.has(c.key)&&(d===void 0||d.mutation instanceof Fs)?o=o.insert(c.key,c):d!==void 0?(a.set(c.key,d.mutation.getFieldMask()),md(d.mutation,c,d.mutation.getFieldMask(),zn.now())):a.set(c.key,ai.empty())}),this.recalculateAndSaveOverlays(t,o).next(u=>(u.forEach((c,d)=>a.set(c,d)),e.forEach((c,d)=>{var p;return s.set(c,new wU(d,(p=a.get(c))!==null&&p!==void 0?p:null))}),s))}recalculateAndSaveOverlays(t,e){const n=fd();let i=new hn((a,s)=>a-s),o=It();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(const s of a)s.keys().forEach(u=>{const c=e.get(u);if(c===null)return;let d=n.get(u)||ai.empty();d=s.applyToLocalView(c,d),n.set(u,d);const p=(i.get(s.batchId)||It()).add(u);i=i.insert(s.batchId,p)})}).next(()=>{const a=[],s=i.getReverseIterator();for(;s.hasNext();){const u=s.getNext(),c=u.key,d=u.value,p=xA();d.forEach(f=>{if(!o.has(f)){const g=TA(e.get(f),n.get(f));g!==null&&p.set(f,g),o=o.add(f)}}),a.push(this.documentOverlayCache.saveOverlays(t,c,p))}return ve.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return Qe.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):EB(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(o=>{const a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-o.size):ve.resolve(Su());let s=-1,u=o;return a.next(c=>ve.forEach(c,(d,p)=>(s<p.largestBatchId&&(s=p.largestBatchId),o.get(d)?ve.resolve():this.remoteDocumentCache.getEntry(t,d).next(f=>{u=u.insert(d,f)}))).next(()=>this.populateOverlays(t,c,o)).next(()=>this.computeViews(t,u,c,It())).next(d=>({batchId:s,changes:bA(d)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Qe(e)).next(n=>{let i=rd();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){const o=e.collectionGroup;let a=rd();return this.indexManager.getCollectionParents(t,o).next(s=>ve.forEach(s,u=>{const c=function(p,f){return new Mg(f,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,u.child(o));return this.getDocumentsMatchingCollectionQuery(t,c,n,i).next(d=>{d.forEach((p,f)=>{a=a.insert(p,f)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,o,i))).next(a=>{o.forEach((u,c)=>{const d=c.getKey();a.get(d)===null&&(a=a.insert(d,vr.newInvalidDocument(d)))});let s=rd();return a.forEach((u,c)=>{const d=o.get(u);d!==void 0&&md(d.mutation,c,ai.empty(),zn.now()),Fg(e,c)&&(s=s.insert(u,c))}),s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xU{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return ve.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:To(i.createTime)}}(e)),ve.resolve()}getNamedQuery(t,e){return ve.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(i){return{name:i.name,query:hU(i.bundledQuery),readTime:To(i.readTime)}}(e)),ve.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U{constructor(){this.overlays=new hn(Qe.comparator),this.Er=new Map}getOverlay(t,e){return ve.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Su();return ve.forEach(e,i=>this.getOverlay(t,i).next(o=>{o!==null&&n.set(i,o)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,o)=>{this.Tt(t,e,o)}),ve.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.Er.get(n);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Er.delete(n)),ve.resolve()}getOverlaysForCollection(t,e,n){const i=Su(),o=e.length+1,a=new Qe(e.child("")),s=this.overlays.getIteratorFrom(a);for(;s.hasNext();){const u=s.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===o&&u.largestBatchId>n&&i.set(u.getKey(),u)}return ve.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let o=new hn((c,d)=>c-d);const a=this.overlays.getIterator();for(;a.hasNext();){const c=a.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>n){let d=o.get(c.largestBatchId);d===null&&(d=Su(),o=o.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const s=Su(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>s.set(c,d)),!(s.size()>=i)););return ve.resolve(s)}Tt(t,e,n){const i=this.overlays.get(n.key);if(i!==null){const a=this.Er.get(i.largestBatchId).delete(n.key);this.Er.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new UB(e,n));let o=this.Er.get(e);o===void 0&&(o=It(),this.Er.set(e,o)),this.Er.set(e,o.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(){this.sessionToken=ur.EMPTY_BYTE_STRING}getSessionToken(t){return ve.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,ve.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(){this.dr=new Vn(Kn.Ar),this.Rr=new Vn(Kn.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(t,e){const n=new Kn(t,e);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.gr(new Kn(t,e))}pr(t,e){t.forEach(n=>this.removeReference(n,e))}yr(t){const e=new Qe(new on([])),n=new Kn(e,t),i=new Kn(e,t+1),o=[];return this.Rr.forEachInRange([n,i],a=>{this.gr(a),o.push(a.key)}),o}wr(){this.dr.forEach(t=>this.gr(t))}gr(t){this.dr=this.dr.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){const e=new Qe(new on([])),n=new Kn(e,t),i=new Kn(e,t+1);let o=It();return this.Rr.forEachInRange([n,i],a=>{o=o.add(a.key)}),o}containsKey(t){const e=new Kn(t,0),n=this.dr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class Kn{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return Qe.comparator(t.key,e.key)||At(t.br,e.br)}static Vr(t,e){return At(t.br,e.br)||Qe.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new Vn(Kn.Ar)}checkEmpty(t){return ve.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){const o=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new BB(o,e,n,i);this.mutationQueue.push(a);for(const s of i)this.vr=this.vr.add(new Kn(s.key,o)),this.indexManager.addToCollectionParentIndex(t,s.key.path.popLast());return ve.resolve(a)}lookupMutationBatch(t,e){return ve.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.Fr(n),o=i<0?0:i;return ve.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ve.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(t){return ve.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Kn(e,0),i=new Kn(e,Number.POSITIVE_INFINITY),o=[];return this.vr.forEachInRange([n,i],a=>{const s=this.Cr(a.br);o.push(s)}),ve.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Vn(At);return e.forEach(i=>{const o=new Kn(i,0),a=new Kn(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([o,a],s=>{n=n.add(s.br)})}),ve.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let o=n;Qe.isDocumentKey(o)||(o=o.child(""));const a=new Kn(new Qe(o),0);let s=new Vn(At);return this.vr.forEachWhile(u=>{const c=u.key.path;return!!n.isPrefixOf(c)&&(c.length===i&&(s=s.add(u.br)),!0)},a),ve.resolve(this.Mr(s))}Mr(t){const e=[];return t.forEach(n=>{const i=this.Cr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){Vt(this.Or(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.vr;return ve.forEach(e.mutations,i=>{const o=new Kn(i.key,e.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.vr=n})}Ln(t){}containsKey(t,e){const n=new Kn(e,0),i=this.vr.firstAfterOrEqual(n);return ve.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,ve.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Cr(t){const e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CU{constructor(t){this.Nr=t,this.docs=function(){return new hn(Qe.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),o=i?i.size:0,a=this.Nr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ve.resolve(n?n.document.mutableCopy():vr.newInvalidDocument(e))}getEntries(t,e){let n=ba();return e.forEach(i=>{const o=this.docs.get(i);n=n.insert(i,o?o.document.mutableCopy():vr.newInvalidDocument(i))}),ve.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let o=ba();const a=e.path,s=new Qe(a.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:c,value:{document:d}}=u.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||tB(eB(d),n)<=0||(i.has(d.key)||Fg(e,d))&&(o=o.insert(d.key,d.mutableCopy()))}return ve.resolve(o)}getAllFromCollectionGroup(t,e,n,i){it()}Lr(t,e){return ve.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new SU(this)}getSize(t){return ve.resolve(this.size)}}class SU extends yU{constructor(t){super(),this.hr=t}applyChanges(t){const e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.hr.addEntry(t,i)):this.hr.removeEntry(n)}),ve.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU{constructor(t){this.persistence=t,this.Br=new Yu(e=>Y1(e),J1),this.lastRemoteSnapshotVersion=ut.min(),this.highestTargetId=0,this.kr=0,this.qr=new ib,this.targetCount=0,this.Qr=Ic.qn()}forEachTarget(t,e){return this.Br.forEach((n,i)=>e(i)),ve.resolve()}getLastRemoteSnapshotVersion(t){return ve.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ve.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),ve.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.kr&&(this.kr=e),ve.resolve()}Un(t){this.Br.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Qr=new Ic(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,ve.resolve()}updateTargetData(t,e){return this.Un(e),ve.resolve()}removeTargetData(t,e){return this.Br.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,ve.resolve()}removeTargets(t,e,n){let i=0;const o=[];return this.Br.forEach((a,s)=>{s.sequenceNumber<=e&&n.get(s.targetId)===null&&(this.Br.delete(a),o.push(this.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),ve.waitFor(o).next(()=>i)}getTargetCount(t){return ve.resolve(this.targetCount)}getTargetData(t,e){const n=this.Br.get(e)||null;return ve.resolve(n)}addMatchingKeys(t,e,n){return this.qr.mr(e,n),ve.resolve()}removeMatchingKeys(t,e,n){this.qr.pr(e,n);const i=this.persistence.referenceDelegate,o=[];return i&&e.forEach(a=>{o.push(i.markPotentiallyOrphaned(t,a))}),ve.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),ve.resolve()}getMatchingKeysForTargetId(t,e){const n=this.qr.Sr(e);return ve.resolve(n)}containsKey(t,e){return ve.resolve(this.qr.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{constructor(t,e){this.Kr={},this.overlays={},this.$r=new Dg(0),this.Ur=!1,this.Ur=!0,this.Wr=new EU,this.referenceDelegate=t(this),this.Gr=new TU(this),this.indexManager=new dU,this.remoteDocumentCache=function(i){return new CU(i)}(n=>this.referenceDelegate.zr(n)),this.serializer=new cU(e),this.jr=new xU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new _U,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Kr[t.toKey()];return n||(n=new IU(e,this.referenceDelegate),this.Kr[t.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,n){Me("MemoryPersistence","Starting transaction:",t);const i=new AU(this.$r.next());return this.referenceDelegate.Hr(),n(i).next(o=>this.referenceDelegate.Jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Yr(t,e){return ve.or(Object.values(this.Kr).map(n=>()=>n.containsKey(t,e)))}}class AU extends rB{constructor(t){super(),this.currentSequenceNumber=t}}class ob{constructor(t){this.persistence=t,this.Zr=new ib,this.Xr=null}static ei(t){return new ob(t)}get ti(){if(this.Xr)return this.Xr;throw it()}addReference(t,e,n){return this.Zr.addReference(n,e),this.ti.delete(n.toString()),ve.resolve()}removeReference(t,e,n){return this.Zr.removeReference(n,e),this.ti.add(n.toString()),ve.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),ve.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach(i=>this.ti.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(o=>this.ti.add(o.toString()))}).next(()=>n.removeTargetData(t,e))}Hr(){this.Xr=new Set}Jr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ve.forEach(this.ti,n=>{const i=Qe.fromPath(n);return this.ni(t,i).next(o=>{o||e.removeEntry(i,ut.min())})}).next(()=>(this.Xr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ni(t,e).next(n=>{n?this.ti.delete(e.toString()):this.ti.add(e.toString())})}zr(t){return 0}ni(t,e){return ve.or([()=>ve.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}}class tg{constructor(t,e){this.persistence=t,this.ri=new Yu(n=>aB(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=vU(this,e)}static ei(t,e){return new tg(t,e)}Hr(){}Jr(t){return ve.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){const e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}nr(t){let e=0;return this.er(t,n=>{e++}).next(()=>e)}er(t,e){return ve.forEach(this.ri,(n,i)=>this.ir(t,n,i).next(o=>o?ve.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.Lr(t,a=>this.ir(t,a,e).next(s=>{s||(n++,o.removeEntry(a,ut.min()))})).next(()=>o.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),ve.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),ve.resolve()}removeReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),ve.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),ve.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=wm(t.data.value)),e}ir(t,e,n){return ve.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const i=this.ri.get(e);return ve.resolve(i!==void 0&&i>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Wi=n,this.Gi=i}static zi(t,e){let n=It(),i=It();for(const o of e.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new ab(t,e.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kU{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return l3()?8:iB(wr())>0?6:4}()}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,n,i){const o={result:null};return this.Xi(t,e).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.es(t,e,i,n).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new RU;return this.ts(t,e,a).next(s=>{if(o.result=s,this.Hi)return this.ns(t,e,a,s.size)})}).next(()=>o.result)}ns(t,e,n,i){return n.documentReadCount<this.Ji?(ec()<=Et.DEBUG&&Me("QueryEngine","SDK will not create cache indexes for query:",tc(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),ve.resolve()):(ec()<=Et.DEBUG&&Me("QueryEngine","Query:",tc(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Yi*i?(ec()<=Et.DEBUG&&Me("QueryEngine","The SDK decides to create cache indexes for query:",tc(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Co(e))):ve.resolve())}Xi(t,e){if($C(e))return ve.resolve(null);let n=Co(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Aw(e,null,"F"),n=Co(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(o=>{const a=It(...o);return this.Zi.getDocuments(t,a).next(s=>this.indexManager.getMinOffset(t,n).next(u=>{const c=this.rs(e,s);return this.ss(e,c,a,u.readTime)?this.Xi(t,Aw(e,null,"F")):this.os(t,c,e,u)}))})))}es(t,e,n,i){return $C(e)||i.isEqual(ut.min())?ve.resolve(null):this.Zi.getDocuments(t,n).next(o=>{const a=this.rs(e,o);return this.ss(e,a,n,i)?ve.resolve(null):(ec()<=Et.DEBUG&&Me("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),tc(e)),this.os(t,a,e,ZV(i,-1)).next(s=>s))})}rs(t,e){let n=new Vn(yA(t));return e.forEach((i,o)=>{Fg(t,o)&&(n=n.add(o))}),n}ss(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ts(t,e,n){return ec()<=Et.DEBUG&&Me("QueryEngine","Using full collection scan to execute query:",tc(e)),this.Zi.getDocumentsMatchingQuery(t,e,Is.min(),n)}os(t,e,n,i){return this.Zi.getDocumentsMatchingQuery(t,n,i).next(o=>(e.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NU{constructor(t,e,n,i){this.persistence=t,this._s=e,this.serializer=i,this.us=new hn(At),this.cs=new Yu(o=>Y1(o),J1),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(n)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new bU(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.us))}}function DU(r,t,e,n){return new NU(r,t,e,n)}async function UA(r,t){const e=lt(r);return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(o=>(i=o,e.Ps(t),e.mutationQueue.getAllMutationBatches(n))).next(o=>{const a=[],s=[];let u=It();for(const c of i){a.push(c.batchId);for(const d of c.mutations)u=u.add(d.key)}for(const c of o){s.push(c.batchId);for(const d of c.mutations)u=u.add(d.key)}return e.localDocuments.getDocuments(n,u).next(c=>({Ts:c,removedBatchIds:a,addedBatchIds:s}))})})}function OU(r,t){const e=lt(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=t.batch.keys(),o=e.hs.newChangeBuffer({trackRemovals:!0});return function(s,u,c,d){const p=c.batch,f=p.keys();let g=ve.resolve();return f.forEach(y=>{g=g.next(()=>d.getEntry(u,y)).next(x=>{const b=c.docVersions.get(y);Vt(b!==null),x.version.compareTo(b)<0&&(p.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),d.addEntry(x)))})}),g.next(()=>s.mutationQueue.removeMutationBatch(u,p))}(e,n,t,o).next(()=>o.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(s){let u=It();for(let c=0;c<s.mutationResults.length;++c)s.mutationResults[c].transformResults.length>0&&(u=u.add(s.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function jA(r){const t=lt(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function PU(r,t){const e=lt(r),n=t.snapshotVersion;let i=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=e.hs.newChangeBuffer({trackRemovals:!0});i=e.us;const s=[];t.targetChanges.forEach((d,p)=>{const f=i.get(p);if(!f)return;s.push(e.Gr.removeMatchingKeys(o,d.removedDocuments,p).next(()=>e.Gr.addMatchingKeys(o,d.addedDocuments,p)));let g=f.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(p)!==null?g=g.withResumeToken(ur.EMPTY_BYTE_STRING,ut.min()).withLastLimboFreeSnapshotVersion(ut.min()):d.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(d.resumeToken,n)),i=i.insert(p,g),function(x,b,_){return x.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(f,g,d)&&s.push(e.Gr.updateTargetData(o,g))});let u=ba(),c=It();if(t.documentUpdates.forEach(d=>{t.resolvedLimboDocuments.has(d)&&s.push(e.persistence.referenceDelegate.updateLimboDocument(o,d))}),s.push(MU(o,a,t.documentUpdates).next(d=>{u=d.Is,c=d.Es})),!n.isEqual(ut.min())){const d=e.Gr.getLastRemoteSnapshotVersion(o).next(p=>e.Gr.setTargetsMetadata(o,o.currentSequenceNumber,n));s.push(d)}return ve.waitFor(s).next(()=>a.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,u,c)).next(()=>u)}).then(o=>(e.us=i,o))}function MU(r,t,e){let n=It(),i=It();return e.forEach(o=>n=n.add(o)),t.getEntries(r,n).next(o=>{let a=ba();return e.forEach((s,u)=>{const c=o.get(s);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(s)),u.isNoDocument()&&u.version.isEqual(ut.min())?(t.removeEntry(s,u.readTime),a=a.insert(s,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),a=a.insert(s,u)):Me("LocalStore","Ignoring outdated watch update for ",s,". Current version:",c.version," Watch version:",u.version)}),{Is:a,Es:i}})}function LU(r,t){const e=lt(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function FU(r,t){const e=lt(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Gr.getTargetData(n,t).next(o=>o?(i=o,ve.resolve(i)):e.Gr.allocateTargetId(n).next(a=>(i=new cs(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Gr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=e.us.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.us=e.us.insert(n.targetId,n),e.cs.set(t,n.targetId)),n})}async function Ow(r,t,e){const n=lt(r),i=n.us.get(t),o=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",o,a=>n.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Gc(a))throw a;Me("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.us=n.us.remove(t),n.cs.delete(i.target)}function iS(r,t,e){const n=lt(r);let i=ut.min(),o=It();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,c,d){const p=lt(u),f=p.cs.get(d);return f!==void 0?ve.resolve(p.us.get(f)):p.Gr.getTargetData(c,d)}(n,a,Co(t)).next(s=>{if(s)return i=s.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(a,s.targetId).next(u=>{o=u})}).next(()=>n._s.getDocumentsMatchingQuery(a,t,e?i:ut.min(),e?o:It())).next(s=>(zU(n,CB(t),s),{documents:s,ds:o})))}function zU(r,t,e){let n=r.ls.get(t)||ut.min();e.forEach((i,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.ls.set(t,n)}class oS{constructor(){this.activeTargetIds=NB()}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class VU{constructor(){this._o=new oS,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,n){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new oS,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BU{uo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){Me("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.To)t(0)}Po(){Me("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.To)t(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yf=null;function O0(){return Yf===null?Yf=function(){return 268435456+Math.round(2147483648*Math.random())}():Yf++,"0x"+Yf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jU{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr="WebChannelConnection";class WU extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+e.host,this.Mo=`projects/${i}/databases/${o}`,this.xo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${o}`}Oo(e,n,i,o,a){const s=O0(),u=this.No(e,n.toUriEncodedString());Me("RestConnection",`Sending RPC '${e}' ${s}:`,u,i);const c={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(c,o,a),this.Bo(e,u,c,i).then(d=>(Me("RestConnection",`Received RPC '${e}' ${s}: `,d),d),d=>{throw bc("RestConnection",`RPC '${e}' ${s} failed with error: `,d,"url: ",u,"request:",i),d})}ko(e,n,i,o,a,s){return this.Oo(e,n,i,o,a)}Lo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Hc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((o,a)=>e[a]=o),i&&i.headers.forEach((o,a)=>e[a]=o)}No(e,n){const i=UU[e];return`${this.Fo}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Bo(t,e,n,i){const o=O0();return new Promise((a,s)=>{const u=new tA;u.setWithCredentials(!0),u.listenOnce(nA.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case ym.NO_ERROR:const d=u.getResponseJson();Me(mr,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(d)),a(d);break;case ym.TIMEOUT:Me(mr,`RPC '${t}' ${o} timed out`),s(new $e(Ee.DEADLINE_EXCEEDED,"Request time out"));break;case ym.HTTP_ERROR:const p=u.getStatus();if(Me(mr,`RPC '${t}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let f=u.getResponseJson();Array.isArray(f)&&(f=f[0]);const g=f==null?void 0:f.error;if(g&&g.status&&g.message){const y=function(b){const _=b.toLowerCase().replace(/_/g,"-");return Object.values(Ee).indexOf(_)>=0?_:Ee.UNKNOWN}(g.status);s(new $e(y,g.message))}else s(new $e(Ee.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new $e(Ee.UNAVAILABLE,"Connection failed."));break;default:it()}}finally{Me(mr,`RPC '${t}' ${o} completed.`)}});const c=JSON.stringify(i);Me(mr,`RPC '${t}' ${o} sending request:`,i),u.send(e,"POST",c,n,15)})}qo(t,e,n){const i=O0(),o=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=oA(),s=iA(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Lo(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const d=o.join("");Me(mr,`Creating RPC '${t}' stream ${i}: ${d}`,u);const p=a.createWebChannel(d,u);let f=!1,g=!1;const y=new jU({Eo:b=>{g?Me(mr,`Not sending because RPC '${t}' stream ${i} is closed:`,b):(f||(Me(mr,`Opening RPC '${t}' stream ${i} transport.`),p.open(),f=!0),Me(mr,`RPC '${t}' stream ${i} sending:`,b),p.send(b))},Ao:()=>p.close()}),x=(b,_,C)=>{b.listen(_,T=>{try{C(T)}catch(D){setTimeout(()=>{throw D},0)}})};return x(p,nd.EventType.OPEN,()=>{g||(Me(mr,`RPC '${t}' stream ${i} transport opened.`),y.So())}),x(p,nd.EventType.CLOSE,()=>{g||(g=!0,Me(mr,`RPC '${t}' stream ${i} transport closed`),y.Do())}),x(p,nd.EventType.ERROR,b=>{g||(g=!0,bc(mr,`RPC '${t}' stream ${i} transport errored:`,b),y.Do(new $e(Ee.UNAVAILABLE,"The operation could not be completed")))}),x(p,nd.EventType.MESSAGE,b=>{var _;if(!g){const C=b.data[0];Vt(!!C);const T=C,D=(T==null?void 0:T.error)||((_=T[0])===null||_===void 0?void 0:_.error);if(D){Me(mr,`RPC '${t}' stream ${i} received error:`,D);const O=D.status;let z=function(A){const N=Sn[A];if(N!==void 0)return kA(N)}(O),I=D.message;z===void 0&&(z=Ee.INTERNAL,I="Unknown error status: "+O+" with message "+D.message),g=!0,y.Do(new $e(z,I)),p.close()}else Me(mr,`RPC '${t}' stream ${i} received:`,C),y.vo(C)}}),x(s,rA.STAT_EVENT,b=>{b.stat===Ew.PROXY?Me(mr,`RPC '${t}' stream ${i} detected buffering proxy`):b.stat===Ew.NOPROXY&&Me(mr,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.bo()},0),y}}function P0(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ug(r){return new QB(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{constructor(t,e,n=1e3,i=1.5,o=6e4){this.li=t,this.timerId=e,this.Qo=n,this.Ko=i,this.$o=o,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();const e=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),i=Math.max(0,e-n);i>0&&Me("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),t())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(t,e,n,i,o,a,s,u){this.li=t,this.Yo=n,this.Zo=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new WA(t,e)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(t){this.l_(),this.stream.send(t)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(t,e){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,t!==4?this.r_.reset():e&&e.code===Ee.RESOURCE_EXHAUSTED?(wa(e.toString()),wa("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===Ee.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.po(e)}P_(){}auth(){this.state=1;const t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Xo===e&&this.I_(n,i)},n=>{t(()=>{const i=new $e(Ee.UNKNOWN,"Fetching auth token failed: "+n.message);return this.E_(i)})})}I_(t,e){const n=this.T_(this.Xo);this.stream=this.d_(t,e),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{n(()=>this.E_(i))}),this.stream.onMessage(i=>{n(()=>++this.n_==1?this.A_(i):this.onNext(i))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}E_(t){return Me("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget(()=>this.Xo===t?e():(Me("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class qU extends qA{constructor(t,e,n,i,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=o}d_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();const e=ZB(this.serializer,t),n=function(o){if(!("targetChange"in o))return ut.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?ut.min():a.readTime?To(a.readTime):ut.min()}(t);return this.listener.R_(e,n)}V_(t){const e={};e.database=Dw(this.serializer),e.addTarget=function(o,a){let s;const u=a.target;if(s=Tw(u)?{documents:nU(o,u)}:{query:rU(o,u).ct},s.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){s.resumeToken=OA(o,a.resumeToken);const c=Rw(o,a.expectedCount);c!==null&&(s.expectedCount=c)}else if(a.snapshotVersion.compareTo(ut.min())>0){s.readTime=eg(o,a.snapshotVersion.toTimestamp());const c=Rw(o,a.expectedCount);c!==null&&(s.expectedCount=c)}return s}(this.serializer,t);const n=oU(this.serializer,t);n&&(e.labels=n),this.c_(e)}m_(t){const e={};e.database=Dw(this.serializer),e.removeTarget=t,this.c_(e)}}class HU extends qA{constructor(t,e,n,i,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=o}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(t,e){return this.connection.qo("Write",t,e)}A_(t){return Vt(!!t.streamToken),this.lastStreamToken=t.streamToken,Vt(!t.writeResults||t.writeResults.length===0),this.listener.p_()}onNext(t){Vt(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();const e=tU(t.writeResults,t.commitTime),n=To(t.commitTime);return this.listener.y_(n,e)}w_(){const t={};t.database=Dw(this.serializer),this.c_(t)}g_(t){const e={streamToken:this.lastStreamToken,writes:t.map(n=>eU(this.serializer,n))};this.c_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new $e(Ee.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,n,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Oo(t,kw(e,n),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new $e(Ee.UNKNOWN,o.toString())})}ko(t,e,n,i,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,s])=>this.connection.ko(t,kw(e,n),i,a,s,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===Ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new $e(Ee.UNKNOWN,a.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class GU{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(t){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,t==="Online"&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(wa(e),this.C_=!1):Me("OnlineStateTracker",e)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(t,e,n,i,o){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=o,this.Q_.uo(a=>{n.enqueueAndForget(async()=>{Ju(this)&&(Me("RemoteStore","Restarting streams for network reachability change."),await async function(u){const c=lt(u);c.k_.add(4),await rp(c),c.K_.set("Unknown"),c.k_.delete(4),await jg(c)}(this))})}),this.K_=new GU(n,i)}}async function jg(r){if(Ju(r))for(const t of r.q_)await t(!0)}async function rp(r){for(const t of r.q_)await t(!1)}function HA(r,t){const e=lt(r);e.B_.has(t.targetId)||(e.B_.set(t.targetId,t),cb(e)?lb(e):Kc(e).s_()&&ub(e,t))}function sb(r,t){const e=lt(r),n=Kc(e);e.B_.delete(t),n.s_()&&$A(e,t),e.B_.size===0&&(n.s_()?n.a_():Ju(e)&&e.K_.set("Unknown"))}function ub(r,t){if(r.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ut.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Kc(r).V_(t)}function $A(r,t){r.U_.xe(t),Kc(r).m_(t)}function lb(r){r.U_=new $B({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>r.B_.get(t)||null,nt:()=>r.datastore.serializer.databaseId}),Kc(r).start(),r.K_.F_()}function cb(r){return Ju(r)&&!Kc(r).i_()&&r.B_.size>0}function Ju(r){return lt(r).k_.size===0}function GA(r){r.U_=void 0}async function XU(r){r.K_.set("Online")}async function QU(r){r.B_.forEach((t,e)=>{ub(r,t)})}async function YU(r,t){GA(r),cb(r)?(r.K_.O_(t),lb(r)):r.K_.set("Unknown")}async function JU(r,t,e){if(r.K_.set("Online"),t instanceof DA&&t.state===2&&t.cause)try{await async function(i,o){const a=o.cause;for(const s of o.targetIds)i.B_.has(s)&&(await i.remoteSyncer.rejectListen(s,a),i.B_.delete(s),i.U_.removeTarget(s))}(r,t)}catch(n){Me("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ng(r,n)}else if(t instanceof _m?r.U_.$e(t):t instanceof NA?r.U_.Je(t):r.U_.Ge(t),!e.isEqual(ut.min()))try{const n=await jA(r.localStore);e.compareTo(n)>=0&&await function(o,a){const s=o.U_.it(a);return s.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const d=o.B_.get(c);d&&o.B_.set(c,d.withResumeToken(u.resumeToken,a))}}),s.targetMismatches.forEach((u,c)=>{const d=o.B_.get(u);if(!d)return;o.B_.set(u,d.withResumeToken(ur.EMPTY_BYTE_STRING,d.snapshotVersion)),$A(o,u);const p=new cs(d.target,u,c,d.sequenceNumber);ub(o,p)}),o.remoteSyncer.applyRemoteEvent(s)}(r,e)}catch(n){Me("RemoteStore","Failed to raise snapshot:",n),await ng(r,n)}}async function ng(r,t,e){if(!Gc(t))throw t;r.k_.add(1),await rp(r),r.K_.set("Offline"),e||(e=()=>jA(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Me("RemoteStore","Retrying IndexedDB access"),await e(),r.k_.delete(1),await jg(r)})}function KA(r,t){return t().catch(e=>ng(r,e,t))}async function Wg(r){const t=lt(r),e=As(t);let n=t.L_.length>0?t.L_[t.L_.length-1].batchId:-1;for(;ZU(t);)try{const i=await LU(t.localStore,n);if(i===null){t.L_.length===0&&e.a_();break}n=i.batchId,ej(t,i)}catch(i){await ng(t,i)}XA(t)&&QA(t)}function ZU(r){return Ju(r)&&r.L_.length<10}function ej(r,t){r.L_.push(t);const e=As(r);e.s_()&&e.f_&&e.g_(t.mutations)}function XA(r){return Ju(r)&&!As(r).i_()&&r.L_.length>0}function QA(r){As(r).start()}async function tj(r){As(r).w_()}async function nj(r){const t=As(r);for(const e of r.L_)t.g_(e.mutations)}async function rj(r,t,e){const n=r.L_.shift(),i=tb.from(n,t,e);await KA(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await Wg(r)}async function ij(r,t){t&&As(r).f_&&await async function(n,i){if(function(a){return WB(a)&&a!==Ee.ABORTED}(i.code)){const o=n.L_.shift();As(n).__(),await KA(n,()=>n.remoteSyncer.rejectFailedWrite(o.batchId,i)),await Wg(n)}}(r,t),XA(r)&&QA(r)}async function sS(r,t){const e=lt(r);e.asyncQueue.verifyOperationInProgress(),Me("RemoteStore","RemoteStore received new credentials");const n=Ju(e);e.k_.add(3),await rp(e),n&&e.K_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),await jg(e)}async function oj(r,t){const e=lt(r);t?(e.k_.delete(2),await jg(e)):t||(e.k_.add(2),await rp(e),e.K_.set("Unknown"))}function Kc(r){return r.W_||(r.W_=function(e,n,i){const o=lt(e);return o.b_(),new qU(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Ro:XU.bind(null,r),mo:QU.bind(null,r),po:YU.bind(null,r),R_:JU.bind(null,r)}),r.q_.push(async t=>{t?(r.W_.__(),cb(r)?lb(r):r.K_.set("Unknown")):(await r.W_.stop(),GA(r))})),r.W_}function As(r){return r.G_||(r.G_=function(e,n,i){const o=lt(e);return o.b_(),new HU(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:tj.bind(null,r),po:ij.bind(null,r),p_:nj.bind(null,r),y_:rj.bind(null,r)}),r.q_.push(async t=>{t?(r.G_.__(),await Wg(r)):(await r.G_.stop(),r.L_.length>0&&(Me("RemoteStore",`Stopping write stream with ${r.L_.length} pending writes`),r.L_=[]))})),r.G_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(t,e,n,i,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=o,this.deferred=new ha,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,o){const a=Date.now()+n,s=new hb(t,e,a,i,o);return s.start(n),s}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $e(Ee.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function db(r,t){if(wa("AsyncQueue",`${t}: ${r}`),Gc(r))return new $e(Ee.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{static emptySet(t){return new pc(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||Qe.comparator(e.key,n.key):(e,n)=>Qe.comparator(e.key,n.key),this.keyedMap=rd(),this.sortedSet=new hn(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof pc)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const i=e.getNext().key,o=n.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new pc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uS{constructor(){this.z_=new hn(Qe.comparator)}track(t){const e=t.doc.key,n=this.z_.get(e);n?t.type!==0&&n.type===3?this.z_=this.z_.insert(e,t):t.type===3&&n.type!==1?this.z_=this.z_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.z_=this.z_.remove(e):t.type===1&&n.type===2?this.z_=this.z_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):it():this.z_=this.z_.insert(e,t)}j_(){const t=[];return this.z_.inorderTraversal((e,n)=>{t.push(n)}),t}}class Cc{constructor(t,e,n,i,o,a,s,u,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=s,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,o){const a=[];return e.forEach(s=>{a.push({type:0,doc:s})}),new Cc(t,e,pc.emptySet(e),a,n,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Lg(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(t=>t.Z_())}}class sj{constructor(){this.queries=lS(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(e,n){const i=lt(e),o=i.queries;i.queries=lS(),o.forEach((a,s)=>{for(const u of s.J_)u.onError(n)})})(this,new $e(Ee.ABORTED,"Firestore shutting down"))}}function lS(){return new Yu(r=>vA(r),Lg)}async function YA(r,t){const e=lt(r);let n=3;const i=t.query;let o=e.queries.get(i);o?!o.Y_()&&t.Z_()&&(n=2):(o=new aj,n=t.Z_()?0:1);try{switch(n){case 0:o.H_=await e.onListen(i,!0);break;case 1:o.H_=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(a){const s=db(a,`Initialization of query '${tc(t.query)}' failed`);return void t.onError(s)}e.queries.set(i,o),o.J_.push(t),t.ea(e.onlineState),o.H_&&t.ta(o.H_)&&pb(e)}async function JA(r,t){const e=lt(r),n=t.query;let i=3;const o=e.queries.get(n);if(o){const a=o.J_.indexOf(t);a>=0&&(o.J_.splice(a,1),o.J_.length===0?i=t.Z_()?0:1:!o.Y_()&&t.Z_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function uj(r,t){const e=lt(r);let n=!1;for(const i of t){const o=i.query,a=e.queries.get(o);if(a){for(const s of a.J_)s.ta(i)&&(n=!0);a.H_=i}}n&&pb(e)}function lj(r,t,e){const n=lt(r),i=n.queries.get(t);if(i)for(const o of i.J_)o.onError(e);n.queries.delete(t)}function pb(r){r.X_.forEach(t=>{t.next()})}var Pw,cS;(cS=Pw||(Pw={})).na="default",cS.Cache="cache";class ZA{constructor(t,e,n){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(t){if(!this.options.includeMetadataChanges){const n=[];for(const i of t.docChanges)i.type!==3&&n.push(i);t=new Cc(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache||!this.Z_())return!0;const n=e!=="Offline";return(!this.options.ua||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}oa(t){if(t.docChanges.length>0)return!0;const e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}aa(t){t=Cc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==Pw.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(t){this.key=t}}class tR{constructor(t){this.key=t}}class cj{constructor(t,e){this.query=t,this.da=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=It(),this.mutatedKeys=It(),this.Va=yA(t),this.ma=new pc(this.Va)}get fa(){return this.da}ga(t,e){const n=e?e.pa:new uS,i=e?e.ma:this.ma;let o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((d,p)=>{const f=i.get(d),g=Fg(this.query,p)?p:null,y=!!f&&this.mutatedKeys.has(f.key),x=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let b=!1;f&&g?f.data.isEqual(g.data)?y!==x&&(n.track({type:3,doc:g}),b=!0):this.ya(f,g)||(n.track({type:2,doc:g}),b=!0,(u&&this.Va(g,u)>0||c&&this.Va(g,c)<0)&&(s=!0)):!f&&g?(n.track({type:0,doc:g}),b=!0):f&&!g&&(n.track({type:1,doc:f}),b=!0,(u||c)&&(s=!0)),b&&(g?(a=a.add(g),o=x?o.add(d):o.delete(d)):(a=a.delete(d),o=o.delete(d)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const d=this.query.limitType==="F"?a.last():a.first();a=a.delete(d.key),o=o.delete(d.key),n.track({type:1,doc:d})}return{ma:a,pa:n,ss:s,mutatedKeys:o}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){const o=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;const a=t.pa.j_();a.sort((d,p)=>function(g,y){const x=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return it()}};return x(g)-x(y)}(d.type,p.type)||this.Va(d.doc,p.doc)),this.wa(n),i=i!=null&&i;const s=e&&!i?this.Sa():[],u=this.Ra.size===0&&this.current&&!i?1:0,c=u!==this.Aa;return this.Aa=u,a.length!==0||c?{snapshot:new Cc(this.query,t.ma,o,a,t.mutatedKeys,u===0,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:s}:{ba:s}}ea(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new uS,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.da.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach(e=>this.da=this.da.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.da=this.da.delete(e)),this.current=t.current)}Sa(){if(!this.current)return[];const t=this.Ra;this.Ra=It(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});const e=[];return t.forEach(n=>{this.Ra.has(n)||e.push(new tR(n))}),this.Ra.forEach(n=>{t.has(n)||e.push(new eR(n))}),e}va(t){this.da=t.ds,this.Ra=It();const e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return Cc.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}}class hj{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class dj{constructor(t){this.key=t,this.Fa=!1}}class pj{constructor(t,e,n,i,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Ma={},this.xa=new Yu(s=>vA(s),Lg),this.Oa=new Map,this.Na=new Set,this.La=new hn(Qe.comparator),this.Ba=new Map,this.ka=new ib,this.qa={},this.Qa=new Map,this.Ka=Ic.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}}async function fj(r,t,e=!0){const n=sR(r);let i;const o=n.xa.get(t);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Ca()):i=await nR(n,t,e,!0),i}async function mj(r,t){const e=sR(r);await nR(e,t,!0,!1)}async function nR(r,t,e,n){const i=await FU(r.localStore,Co(t)),o=i.targetId,a=r.sharedClientState.addLocalQueryTarget(o,e);let s;return n&&(s=await gj(r,t,o,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&HA(r.remoteStore,i),s}async function gj(r,t,e,n,i){r.Ua=(p,f,g)=>async function(x,b,_,C){let T=b.view.ga(_);T.ss&&(T=await iS(x.localStore,b.query,!1).then(({documents:I})=>b.view.ga(I,T)));const D=C&&C.targetChanges.get(b.targetId),O=C&&C.targetMismatches.get(b.targetId)!=null,z=b.view.applyChanges(T,x.isPrimaryClient,D,O);return dS(x,b.targetId,z.ba),z.snapshot}(r,p,f,g);const o=await iS(r.localStore,t,!0),a=new cj(t,o.ds),s=a.ga(o.documents),u=np.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),c=a.applyChanges(s,r.isPrimaryClient,u);dS(r,e,c.ba);const d=new hj(t,e,a);return r.xa.set(t,d),r.Oa.has(e)?r.Oa.get(e).push(t):r.Oa.set(e,[t]),c.snapshot}async function vj(r,t,e){const n=lt(r),i=n.xa.get(t),o=n.Oa.get(i.targetId);if(o.length>1)return n.Oa.set(i.targetId,o.filter(a=>!Lg(a,t))),void n.xa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Ow(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&sb(n.remoteStore,i.targetId),Mw(n,i.targetId)}).catch($c)):(Mw(n,i.targetId),await Ow(n.localStore,i.targetId,!0))}async function yj(r,t){const e=lt(r),n=e.xa.get(t),i=e.Oa.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),sb(e.remoteStore,n.targetId))}async function wj(r,t,e){const n=Sj(r);try{const i=await function(a,s){const u=lt(a),c=zn.now(),d=s.reduce((g,y)=>g.add(y.key),It());let p,f;return u.persistence.runTransaction("Locally write mutations","readwrite",g=>{let y=ba(),x=It();return u.hs.getEntries(g,d).next(b=>{y=b,y.forEach((_,C)=>{C.isValidDocument()||(x=x.add(_))})}).next(()=>u.localDocuments.getOverlayedDocuments(g,y)).next(b=>{p=b;const _=[];for(const C of s){const T=zB(C,p.get(C.key).overlayedDocument);T!=null&&_.push(new Fs(C.key,T,cA(T.value.mapValue),So.exists(!0)))}return u.mutationQueue.addMutationBatch(g,c,_,s)}).next(b=>{f=b;const _=b.applyToLocalDocumentSet(p,x);return u.documentOverlayCache.saveOverlays(g,b.batchId,_)})}).then(()=>({batchId:f.batchId,changes:bA(p)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,s,u){let c=a.qa[a.currentUser.toKey()];c||(c=new hn(At)),c=c.insert(s,u),a.qa[a.currentUser.toKey()]=c}(n,i.batchId,e),await ip(n,i.changes),await Wg(n.remoteStore)}catch(i){const o=db(i,"Failed to persist write");e.reject(o)}}async function rR(r,t){const e=lt(r);try{const n=await PU(e.localStore,t);t.targetChanges.forEach((i,o)=>{const a=e.Ba.get(o);a&&(Vt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Fa=!0:i.modifiedDocuments.size>0?Vt(a.Fa):i.removedDocuments.size>0&&(Vt(a.Fa),a.Fa=!1))}),await ip(e,n,t)}catch(n){await $c(n)}}function hS(r,t,e){const n=lt(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const i=[];n.xa.forEach((o,a)=>{const s=a.view.ea(t);s.snapshot&&i.push(s.snapshot)}),function(a,s){const u=lt(a);u.onlineState=s;let c=!1;u.queries.forEach((d,p)=>{for(const f of p.J_)f.ea(s)&&(c=!0)}),c&&pb(u)}(n.eventManager,t),i.length&&n.Ma.R_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function bj(r,t,e){const n=lt(r);n.sharedClientState.updateQueryState(t,"rejected",e);const i=n.Ba.get(t),o=i&&i.key;if(o){let a=new hn(Qe.comparator);a=a.insert(o,vr.newNoDocument(o,ut.min()));const s=It().add(o),u=new Bg(ut.min(),new Map,new hn(At),a,s);await rR(n,u),n.La=n.La.remove(o),n.Ba.delete(t),fb(n)}else await Ow(n.localStore,t,!1).then(()=>Mw(n,t,e)).catch($c)}async function xj(r,t){const e=lt(r),n=t.batch.batchId;try{const i=await OU(e.localStore,t);oR(e,n,null),iR(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await ip(e,i)}catch(i){await $c(i)}}async function _j(r,t,e){const n=lt(r);try{const i=await function(a,s){const u=lt(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,s).next(p=>(Vt(p!==null),d=p.keys(),u.mutationQueue.removeMutationBatch(c,p))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,s)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(n.localStore,t);oR(n,t,e),iR(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await ip(n,i)}catch(i){await $c(i)}}function iR(r,t){(r.Qa.get(t)||[]).forEach(e=>{e.resolve()}),r.Qa.delete(t)}function oR(r,t,e){const n=lt(r);let i=n.qa[n.currentUser.toKey()];if(i){const o=i.get(t);o&&(e?o.reject(e):o.resolve(),i=i.remove(t)),n.qa[n.currentUser.toKey()]=i}}function Mw(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.Oa.get(t))r.xa.delete(n),e&&r.Ma.Wa(n,e);r.Oa.delete(t),r.isPrimaryClient&&r.ka.yr(t).forEach(n=>{r.ka.containsKey(n)||aR(r,n)})}function aR(r,t){r.Na.delete(t.path.canonicalString());const e=r.La.get(t);e!==null&&(sb(r.remoteStore,e),r.La=r.La.remove(t),r.Ba.delete(e),fb(r))}function dS(r,t,e){for(const n of e)n instanceof eR?(r.ka.addReference(n.key,t),Ej(r,n)):n instanceof tR?(Me("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,t),r.ka.containsKey(n.key)||aR(r,n.key)):it()}function Ej(r,t){const e=t.key,n=e.path.canonicalString();r.La.get(e)||r.Na.has(n)||(Me("SyncEngine","New document in limbo: "+e),r.Na.add(n),fb(r))}function fb(r){for(;r.Na.size>0&&r.La.size<r.maxConcurrentLimboResolutions;){const t=r.Na.values().next().value;r.Na.delete(t);const e=new Qe(on.fromString(t)),n=r.Ka.next();r.Ba.set(n,new dj(e)),r.La=r.La.insert(e,n),HA(r.remoteStore,new cs(Co(Z1(e.path)),n,"TargetPurposeLimboResolution",Dg.oe))}}async function ip(r,t,e){const n=lt(r),i=[],o=[],a=[];n.xa.isEmpty()||(n.xa.forEach((s,u)=>{a.push(n.Ua(u,t,e).then(c=>{var d;if((c||e)&&n.isPrimaryClient){const p=c?!c.fromCache:(d=e==null?void 0:e.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;n.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(c){i.push(c);const p=ab.zi(u.targetId,c);o.push(p)}}))}),await Promise.all(a),n.Ma.R_(i),await async function(u,c){const d=lt(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>ve.forEach(c,f=>ve.forEach(f.Wi,g=>d.persistence.referenceDelegate.addReference(p,f.targetId,g)).next(()=>ve.forEach(f.Gi,g=>d.persistence.referenceDelegate.removeReference(p,f.targetId,g)))))}catch(p){if(!Gc(p))throw p;Me("LocalStore","Failed to update sequence numbers: "+p)}for(const p of c){const f=p.targetId;if(!p.fromCache){const g=d.us.get(f),y=g.snapshotVersion,x=g.withLastLimboFreeSnapshotVersion(y);d.us=d.us.insert(f,x)}}}(n.localStore,o))}async function Ij(r,t){const e=lt(r);if(!e.currentUser.isEqual(t)){Me("SyncEngine","User change. New user:",t.toKey());const n=await UA(e.localStore,t);e.currentUser=t,function(o,a){o.Qa.forEach(s=>{s.forEach(u=>{u.reject(new $e(Ee.CANCELLED,a))})}),o.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await ip(e,n.Ts)}}function Cj(r,t){const e=lt(r),n=e.Ba.get(t);if(n&&n.Fa)return It().add(n.key);{let i=It();const o=e.Oa.get(t);if(!o)return i;for(const a of o){const s=e.xa.get(a);i=i.unionWith(s.view.fa)}return i}}function sR(r){const t=lt(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=rR.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cj.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=bj.bind(null,t),t.Ma.R_=uj.bind(null,t.eventManager),t.Ma.Wa=lj.bind(null,t.eventManager),t}function Sj(r){const t=lt(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=xj.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_j.bind(null,t),t}class rg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ug(t.databaseInfo.databaseId),this.sharedClientState=this.za(t),this.persistence=this.ja(t),await this.persistence.start(),this.localStore=this.Ha(t),this.gcScheduler=this.Ja(t,this.localStore),this.indexBackfillerScheduler=this.Ya(t,this.localStore)}Ja(t,e){return null}Ya(t,e){return null}Ha(t){return DU(this.persistence,new kU,t.initialUser,this.serializer)}ja(t){return new BA(ob.ei,this.serializer)}za(t){return new VU}async terminate(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}rg.provider={build:()=>new rg};class Tj extends rg{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){Vt(this.persistence.referenceDelegate instanceof tg);const n=this.persistence.referenceDelegate.garbageCollector;return new mU(n,t.asyncQueue,e)}ja(t){const e=this.cacheSizeBytes!==void 0?Br.withCacheSize(this.cacheSizeBytes):Br.DEFAULT;return new BA(n=>tg.ei(n,e),this.serializer)}}class Lw{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>hS(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ij.bind(null,this.syncEngine),await oj(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new sj}()}createDatastore(t){const e=Ug(t.databaseInfo.databaseId),n=function(o){return new WU(o)}(t.databaseInfo);return function(o,a,s,u){return new $U(o,a,s,u)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(n,i,o,a,s){return new KU(n,i,o,a,s)}(this.localStore,this.datastore,t.asyncQueue,e=>hS(this.syncEngine,e,0),function(){return aS.p()?new aS:new BU}())}createSyncEngine(t,e){return function(i,o,a,s,u,c,d){const p=new pj(i,o,a,s,u,c);return d&&(p.$a=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(i){const o=lt(i);Me("RemoteStore","RemoteStore shutting down."),o.k_.add(5),await rp(o),o.Q_.shutdown(),o.K_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(e=this.eventManager)===null||e===void 0||e.terminate()}}Lw.provider={build:()=>new Lw};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):wa("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout(()=>{this.muted||t(e)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aj{constructor(t,e,n,i,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=gr.UNAUTHENTICATED,this.clientId=sA.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,async a=>{Me("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(Me("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ha;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=db(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function M0(r,t){r.asyncQueue.verifyOperationInProgress(),Me("FirestoreClient","Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await UA(t.localStore,i),n=i)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function pS(r,t){r.asyncQueue.verifyOperationInProgress();const e=await Rj(r);Me("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>sS(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>sS(t.remoteStore,i)),r._onlineComponents=t}async function Rj(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Me("FirestoreClient","Using user provided OfflineComponentProvider");try{await M0(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(i){return i.name==="FirebaseError"?i.code===Ee.FAILED_PRECONDITION||i.code===Ee.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;bc("Error using user provided cache. Falling back to memory cache: "+e),await M0(r,new rg)}}else Me("FirestoreClient","Using default OfflineComponentProvider"),await M0(r,new Tj(void 0));return r._offlineComponents}async function lR(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Me("FirestoreClient","Using user provided OnlineComponentProvider"),await pS(r,r._uninitializedComponentsProvider._online)):(Me("FirestoreClient","Using default OnlineComponentProvider"),await pS(r,new Lw))),r._onlineComponents}function kj(r){return lR(r).then(t=>t.syncEngine)}async function cR(r){const t=await lR(r),e=t.eventManager;return e.onListen=fj.bind(null,t.syncEngine),e.onUnlisten=vj.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=mj.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=yj.bind(null,t.syncEngine),e}function Nj(r,t,e={}){const n=new ha;return r.asyncQueue.enqueueAndForget(async()=>function(o,a,s,u,c){const d=new uR({next:f=>{d.eu(),a.enqueueAndForget(()=>JA(o,p));const g=f.docs.has(s);!g&&f.fromCache?c.reject(new $e(Ee.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&f.fromCache&&u&&u.source==="server"?c.reject(new $e(Ee.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),p=new ZA(Z1(s.path),d,{includeMetadataChanges:!0,ua:!0});return YA(o,p)}(await cR(r),r.asyncQueue,t,e,n)),n.promise}function Dj(r,t,e={}){const n=new ha;return r.asyncQueue.enqueueAndForget(async()=>function(o,a,s,u,c){const d=new uR({next:f=>{d.eu(),a.enqueueAndForget(()=>JA(o,p)),f.fromCache&&u.source==="server"?c.reject(new $e(Ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),p=new ZA(s,d,{includeMetadataChanges:!0,ua:!0});return YA(o,p)}(await cR(r),r.asyncQueue,t,e,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fS=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dR(r,t,e){if(!e)throw new $e(Ee.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Oj(r,t,e,n){if(t===!0&&n===!0)throw new $e(Ee.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function mS(r){if(!Qe.isDocumentKey(r))throw new $e(Ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function gS(r){if(Qe.isDocumentKey(r))throw new $e(Ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function mb(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":it()}function xa(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new $e(Ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=mb(r);throw new $e(Ee.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new $e(Ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new $e(Ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Oj("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hR((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new $e(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new $e(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new $e(Ee.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class qg{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vS({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $e(Ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new $e(Ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vS(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new qV;switch(n.type){case"firstParty":return new KV(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new $e(Ee.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=fS.get(e);n&&(Me("ComponentProvider","Removing Datastore"),fS.delete(e),n.terminate())}(this),Promise.resolve()}}function Pj(r,t,e,n={}){var i;const o=(r=xa(r,qg))._getSettings(),a=`${t}:${e}`;if(o.host!=="firestore.googleapis.com"&&o.host!==a&&bc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),n.mockUserToken){let s,u;if(typeof n.mockUserToken=="string")s=n.mockUserToken,u=gr.MOCK_USER;else{s=n3(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);const c=n.mockUserToken.sub||n.mockUserToken.user_id;if(!c)throw new $e(Ee.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new gr(c)}r._authCredentials=new HV(new aA(s,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Hg(this.firestore,t,this._query)}}class Hr{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vs(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Hr(this.firestore,t,this._key)}}class vs extends Hg{constructor(t,e,n){super(t,e,Z1(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Hr(this.firestore,null,new Qe(t))}withConverter(t){return new vs(this.firestore,t,this._path)}}function Mj(r,t,...e){if(r=Bn(r),dR("collection","path",t),r instanceof qg){const n=on.fromString(t,...e);return gS(n),new vs(r,null,n)}{if(!(r instanceof Hr||r instanceof vs))throw new $e(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(on.fromString(t,...e));return gS(n),new vs(r.firestore,null,n)}}function Ou(r,t,...e){if(r=Bn(r),arguments.length===1&&(t=sA.newId()),dR("doc","path",t),r instanceof qg){const n=on.fromString(t,...e);return mS(n),new Hr(r,null,new Qe(n))}{if(!(r instanceof Hr||r instanceof vs))throw new $e(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(on.fromString(t,...e));return mS(n),new Hr(r.firestore,r instanceof vs?r.converter:null,new Qe(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS{constructor(t=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new WA(this,"async_queue_retry"),this.fu=()=>{const n=P0();n&&Me("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=t;const e=P0();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.Eu){this.Eu=!0,this.Vu=t||!1;const e=P0();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.Eu)return new Promise(()=>{});const e=new ha;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Iu.push(t),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!Gc(t))throw t;Me("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(t){const e=this.gu.then(()=>(this.Ru=!0,t().catch(n=>{this.Au=n,this.Ru=!1;const i=function(a){let s=a.message||"";return a.stack&&(s=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),s}(n);throw wa("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.Ru=!1,n))));return this.gu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.mu.indexOf(t)>-1&&(e=0);const i=hb.createAndSchedule(this,t,e,n,o=>this.Su(o));return this.du.push(i),i}pu(){this.Au&&it()}verifyOperationInProgress(){}async bu(){let t;do t=this.gu,await t;while(t!==this.gu)}Du(t){for(const e of this.du)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then(()=>{this.du.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(const e of this.du)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.bu()})}Cu(t){this.mu.push(t)}Su(t){const e=this.du.indexOf(t);this.du.splice(e,1)}}class op extends qg{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new yS,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new yS(t),this._firestoreClient=void 0,await t}}}function Lj(r,t){const e=typeof r=="object"?r:f2(),n=typeof r=="string"?r:"(default)",i=z1(e,"firestore").getImmediate({identifier:n});if(!i._initialized){const o=e3("firestore");o&&Pj(i,...o)}return i}function gb(r){if(r._terminated)throw new $e(Ee.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Fj(r),r._firestoreClient}function Fj(r){var t,e,n;const i=r._freezeSettings(),o=function(s,u,c,d){return new lB(s,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,hR(d.experimentalLongPollingOptions),d.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Aj(r._authCredentials,r._appCheckCredentials,r._queue,o,r._componentsProvider&&function(s){const u=s==null?void 0:s._online.build();return{_offline:s==null?void 0:s._offline.build(u),_online:u}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Sc(ur.fromBase64String(t))}catch(e){throw new $e(Ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Sc(ur.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new $e(Ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ar(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new $e(Ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new $e(Ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return At(this._lat,t._lat)||At(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zj=/^__.*__$/;class Vj{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Fs(t,this.data,this.fieldMask,e,this.fieldTransforms):new tp(t,this.data,e,this.fieldTransforms)}}class pR{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Fs(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function fR(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw it()}}class bb{constructor(t,e,n,i,o,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,o===void 0&&this.Fu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new bb(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;const n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:n,Nu:!1});return i.Lu(t),i}Bu(t){var e;const n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:n,Nu:!1});return i.Fu(),i}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return ig(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Lu(this.path.get(t))}Lu(t){if(t.length===0)throw this.qu("Document fields must not be empty");if(fR(this.Mu)&&zj.test(t))throw this.qu('Document fields cannot begin and end with "__"')}}class Bj{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ug(t)}$u(t,e,n,i=!1){return new bb({Mu:t,methodName:e,Ku:n,path:ar.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mR(r){const t=r._freezeSettings(),e=Ug(r._databaseId);return new Bj(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Uj(r,t,e,n,i,o={}){const a=r.$u(o.merge||o.mergeFields?2:0,t,e,i);xb("Data must be an object, but it was:",a,n);const s=gR(n,a);let u,c;if(o.merge)u=new ai(a.fieldMask),c=a.fieldTransforms;else if(o.mergeFields){const d=[];for(const p of o.mergeFields){const f=Fw(t,p,e);if(!a.contains(f))throw new $e(Ee.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);yR(d,f)||d.push(f)}u=new ai(d),c=a.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,c=a.fieldTransforms;return new Vj(new jr(s),u,c)}class Gg extends vb{_toFieldTransform(t){if(t.Mu!==2)throw t.Mu===1?t.qu(`${this._methodName}() can only appear at the top level of your update data`):t.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Gg}}function jj(r,t,e,n){const i=r.$u(1,t,e);xb("Data must be an object, but it was:",i,n);const o=[],a=jr.empty();Ls(n,(u,c)=>{const d=_b(t,u,e);c=Bn(c);const p=i.Bu(d);if(c instanceof Gg)o.push(d);else{const f=Kg(c,p);f!=null&&(o.push(d),a.set(d,f))}});const s=new ai(o);return new pR(a,s,i.fieldTransforms)}function Wj(r,t,e,n,i,o){const a=r.$u(1,t,e),s=[Fw(t,n,e)],u=[i];if(o.length%2!=0)throw new $e(Ee.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<o.length;f+=2)s.push(Fw(t,o[f])),u.push(o[f+1]);const c=[],d=jr.empty();for(let f=s.length-1;f>=0;--f)if(!yR(c,s[f])){const g=s[f];let y=u[f];y=Bn(y);const x=a.Bu(g);if(y instanceof Gg)c.push(g);else{const b=Kg(y,x);b!=null&&(c.push(g),d.set(g,b))}}const p=new ai(c);return new pR(d,p,a.fieldTransforms)}function Kg(r,t){if(vR(r=Bn(r)))return xb("Unsupported field value:",t,r),gR(r,t);if(r instanceof vb)return function(n,i){if(!fR(i.Mu))throw i.qu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Nu&&t.Mu!==4)throw t.qu("Nested arrays are not supported");return function(n,i){const o=[];let a=0;for(const s of n){let u=Kg(s,i.ku(a));u==null&&(u={nullValue:"NULL_VALUE"}),o.push(u),a++}return{arrayValue:{values:o}}}(r,t)}return function(n,i){if((n=Bn(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return DB(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const o=zn.fromDate(n);return{timestampValue:eg(i.serializer,o)}}if(n instanceof zn){const o=new zn(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:eg(i.serializer,o)}}if(n instanceof yb)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Sc)return{bytesValue:OA(i.serializer,n._byteString)};if(n instanceof Hr){const o=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(o))throw i.qu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:rb(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof wb)return function(a,s){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw s.qu("VectorValues must only contain numeric values.");return eb(s.serializer,u)})}}}}}}(n,i);throw i.qu(`Unsupported field value: ${mb(n)}`)}(r,t)}function gR(r,t){const e={};return uA(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ls(r,(n,i)=>{const o=Kg(i,t.Ou(n));o!=null&&(e[n]=o)}),{mapValue:{fields:e}}}function vR(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof zn||r instanceof yb||r instanceof Sc||r instanceof Hr||r instanceof vb||r instanceof wb)}function xb(r,t,e){if(!vR(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){const n=mb(e);throw n==="an object"?t.qu(r+" a custom object"):t.qu(r+" "+n)}}function Fw(r,t,e){if((t=Bn(t))instanceof $g)return t._internalPath;if(typeof t=="string")return _b(r,t);throw ig("Field path arguments must be of type string or ",r,!1,void 0,e)}const qj=new RegExp("[~\\*/\\[\\]]");function _b(r,t,e){if(t.search(qj)>=0)throw ig(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new $g(...t.split("."))._internalPath}catch{throw ig(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function ig(r,t,e,n,i){const o=n&&!n.isEmpty(),a=i!==void 0;let s=`Function ${t}() called with invalid data`;e&&(s+=" (via `toFirestore()`)"),s+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${n}`),a&&(u+=` in document ${i}`),u+=")"),new $e(Ee.INVALID_ARGUMENT,s+r+u)}function yR(r,t){return r.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(t,e,n,i,o){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Hr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Hj(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(bR("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class Hj extends wR{data(){return super.data()}}function bR(r,t){return typeof t=="string"?_b(r,t):t instanceof $g?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $j(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new $e(Ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gj{convertValue(t,e="none"){switch(Ts(t)){case 0:return null;case 1:return t.booleanValue;case 2:return bn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ss(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw it()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ls(t,(i,o)=>{n[i]=this.convertValue(o,e)}),n}convertVectorValue(t){var e,n,i;const o=(i=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>bn(a.doubleValue));return new wb(o)}convertGeoPoint(t){return new yb(bn(t.latitude),bn(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Pg(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Id(t));default:return null}}convertTimestamp(t){const e=Cs(t);return new zn(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=on.fromString(t);Vt(VA(n));const i=new Cd(n.get(1),n.get(3)),o=new Qe(n.popFirst(5));return i.isEqual(e)||wa(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kj(r,t,e){let n;return n=r?r.toFirestore(t):t,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class xR extends wR{constructor(t,e,n,i,o,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Em(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(bR("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Em extends xR{data(t={}){return super.data(t)}}class Xj{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new od(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Em(this._firestore,this._userDataWriter,n.key,n,new od(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new $e(Ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(s=>{const u=new Em(i._firestore,i._userDataWriter,s.doc.key,s.doc,new od(i._snapshot.mutatedKeys.has(s.doc.key),i._snapshot.fromCache),i.query.converter);return s.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(s=>o||s.type!==3).map(s=>{const u=new Em(i._firestore,i._userDataWriter,s.doc.key,s.doc,new od(i._snapshot.mutatedKeys.has(s.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,d=-1;return s.type!==0&&(c=a.indexOf(s.doc.key),a=a.delete(s.doc.key)),s.type!==1&&(a=a.add(s.doc),d=a.indexOf(s.doc.key)),{type:Qj(s.type),doc:u,oldIndex:c,newIndex:d}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Qj(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return it()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(r){r=xa(r,Hr);const t=xa(r.firestore,op);return Nj(gb(t),r._key).then(e=>Zj(t,r,e))}class _R extends Gj{constructor(t){super(),this.firestore=t}convertBytes(t){return new Sc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Hr(this.firestore,null,e)}}function Yj(r){r=xa(r,Hg);const t=xa(r.firestore,op),e=gb(t),n=new _R(t);return $j(r._query),Dj(e,r._query).then(i=>new Xj(t,n,r,i))}function Jj(r,t,e){r=xa(r,Hr);const n=xa(r.firestore,op),i=Kj(r.converter,t);return ER(n,[Uj(mR(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,So.none())])}function zw(r,t,e,...n){r=xa(r,Hr);const i=xa(r.firestore,op),o=mR(i);let a;return a=typeof(t=Bn(t))=="string"||t instanceof $g?Wj(o,"updateDoc",r._key,t,e,n):jj(o,"updateDoc",r._key,t),ER(i,[a.toMutation(r._key,So.exists(!0))])}function ER(r,t){return function(n,i){const o=new ha;return n.asyncQueue.enqueueAndForget(async()=>wj(await kj(n),i,o)),o.promise}(gb(r),t)}function Zj(r,t,e){const n=e.docs.get(t._key),i=new _R(r);return new xR(r,i,t._key,n,new od(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(i){Hc=i})(Wc),yc(new Vu("firestore",(n,{instanceIdentifier:i,options:o})=>{const a=n.getProvider("app").getImmediate(),s=new op(new $V(n.getProvider("auth-internal")),new QV(n.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new $e(Ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cd(c.options.projectId,d)}(a,i),a);return o=Object.assign({useFetchStreams:e},o),s._setSettings(o),s},"PUBLIC").setMultipleInstances(!0)),gs(MC,"4.7.5",t),gs(MC,"4.7.5","esm2017")})();const eW={apiKey:"AIzaSyCuPtzyna9DGXlmqZ03dRy1uujcnbmOpy4",authDomain:"cloud-quiz-app-dca39.firebaseapp.com",projectId:"cloud-quiz-app-dca39",storageBucket:"cloud-quiz-app-dca39.firebasestorage.app",messagingSenderId:"28227889552",appId:"1:28227889552:web:7a009da7852be6739c6b15"},IR=p2(eW),da=jV(IR),ys=Lj(IR),tW=()=>{const[r,t]=fe.useState(null),[e,n]=fe.useState([]),[i,o]=fe.useState(!0);fe.useEffect(()=>{const u=Nz(da,async d=>{if(d){const p=Ou(ys,"users",d.uid),f=await Eb(p);if(f.exists()){const g=f.data();t({...d,points:g.points||0,username:g.username||"unknown"})}}else t(null)});return(async()=>{const d=await Yj(Mj(ys,"users")),p=[];d.forEach(f=>{p.push({id:f.id,...f.data()})}),p.sort((f,g)=>g.points-f.points),n(p),o(!1)})(),()=>u()},[]);const a=async()=>{await W2(da)},s={position:"relative",top:r?"0px":"60px"};return _e.jsxs("div",{className:"home-container",children:[_e.jsx("header",{className:"header",children:_e.jsxs("div",{className:"header-content",children:[_e.jsx("h2",{children:"CloudQuest"}),r?_e.jsx("button",{className:"logout-button",onClick:a,children:"ログアウト"}):_e.jsx(bo,{to:"/login",className:"login-link",children:"ログイン"})]})}),r&&_e.jsxs("div",{className:"user-info",children:[_e.jsxs(bo,{to:"/accountSettings",children:["アカウント設定はこちらから →",_e.jsx("br",{})]}),_e.jsxs("span",{children:[r.username||"unknown"," ",r.points,"P"]})]}),_e.jsx("h2",{className:"ranking-title",style:s,children:"総合ランキング"}),_e.jsx("div",{className:"ranking-container",style:s,children:i?_e.jsx("p",{children:"読み込み中..."}):_e.jsx("ul",{className:"ranking-list",children:e.map((u,c)=>_e.jsxs("li",{className:`ranking-item ${c===0?"top-ranking-1":c===1?"top-ranking-2":c===2?"top-ranking-3":""}`,children:[_e.jsx("span",{children:c+1}),_e.jsx("span",{children:u.username||"unknown"}),_e.jsxs("span",{children:[u.points,"P"]})]},u.id))})}),r?_e.jsx(bo,{to:"/quiz",className:"quiz-button",children:"クイズに挑戦"}):_e.jsx(bo,{to:"/Login",className:"quiz-button",style:s,children:"まずはログインしよう"})]})};var L0={},mu={};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var CR=function(r,t){return(CR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])})(r,t)};function to(r,t){function e(){this.constructor=r}CR(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Ue(r,t,e,n){return new(e||(e=Promise))(function(i,o){function a(c){try{u(n.next(c))}catch(d){o(d)}}function s(c){try{u(n.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):new e(function(d){d(c.value)}).then(a,s)}u((n=n.apply(r,[])).next())})}function je(r,t){var e,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,n&&(i=2&d[0]?n.return:d[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,d[1])).done)return i;switch(n=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return a.label++,{value:d[1],done:!1};case 5:a.label++,n=d[1],d=[0];continue;case 7:d=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){a=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){a.label=d[1];break}if(d[0]===6&&a.label<i[1]){a.label=i[1],i=d;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(d);break}i[2]&&a.ops.pop(),a.trys.pop();continue}d=t.call(r,a)}catch(p){d=[6,p],n=0}finally{e=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,c])}}}var SR=function(){function r(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(t,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},r.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},this.urlFlags[t]!=null){var i=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+i+"."),this.set(t,i)}},r.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},r.prototype.getNumber=function(t){return this.get(t)},r.prototype.getBool=function(t){return this.get(t)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(t,e){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)},r.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},r.prototype.setFlags=function(t){this.flags=Object.assign({},t)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,n,i=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return function(u,c,d){u[decodeURIComponent(c)]=decodeURIComponent(d||"")}(n,a[0],a[1]),a.join("=")}),n);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var a=o.split(":"),s=a[0],u=a[1];t.urlFlags[s]=function(c,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+c+".")}(s,u)})}},r}();function he(){return Ib}var Ib=null,Tc=new Map;function TR(r,t){var e=Cb(r,t);return Tc.get(e)}function Vw(r){for(var t=Tc.entries(),e=[];;){var n=t.next(),i=n.done,o=n.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===r&&e.push(s)}return e}function Bw(r){var t=r.kernelName,e=r.backendName,n=Cb(t,e);if(Tc.has(n))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");Tc.set(n,r)}function nW(r,t){var e=Cb(r,t);if(!Tc.has(e))throw new Error("The kernel '"+r+"' for backend '"+t+"' is not registered");Tc.delete(e)}function Cb(r,t){return t+"_"+r}function wS(r){for(var t=r.length,e=0,n=0;t>0;)n=Math.random()*t|0,e=r[--t],r[t]=r[n],r[n]=e}function og(r,t,e){return Math.max(r,Math.min(t,e))}function Sb(r){return r%2==0?r:r+1}function AR(r){for(var t=0,e=0;e<r.length;e++)t+=r[e];return t}function W(r,t){if(!r)throw new Error(typeof t=="string"?t:t())}function Nt(r,t,e){e===void 0&&(e=""),W(Qn(r,t),function(){return e+" Shapes "+r+" and "+t+" must match"})}function Zu(r){W(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function _a(r,t,e){if(t===void 0&&(t=[]),e===void 0&&(e=!1),t==null&&(t=[]),Array.isArray(r)||or(r)&&!e)for(var n=0;n<r.length;++n)_a(r[n],t,e);else t.push(r);return t}function He(r){if(r.length===0)return 1;for(var t=r[0],e=1;e<r.length;e++)t*=r[e];return t}function Qn(r,t){if(r===t)return!0;if(r==null||t==null||r.length!==t.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function mn(r){return r%1==0}function RR(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var t=Math.exp(2*r);return(t-1)/(t+1)}function ag(r){var t=Math.ceil(Math.sqrt(r));return[t,Math.ceil(r/t)]}function Pu(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function Uw(r,t,e){return t===void 0&&(t=function(n){return 0}),new Promise(function(n,i){var o=0,a=function(){if(r())n();else{var s=t(++o);e!=null&&o>=e?i():setTimeout(a,s)}};a()})}function kR(r,t){for(var e=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)e*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+r);return r}if(e===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var o=r.slice();return o[n]=t/e,o}function Jn(r,t){var e=t.length;return W((r=r==null?t.map(function(n,i){return i}):[].concat(r)).every(function(n){return n>=-e&&n<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+r}),W(r.every(function(n){return mn(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?e+n:n})}function ls(r,t){for(var e=[],n=[],i=t!=null&&Array.isArray(t)&&t.length===0,o=t==null||i?null:Jn(t,r).sort(),a=0,s=0;s<r.length;++s){if(o!=null){if(o[a]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(o[a]==null||o[a]>s)&&r[s]===1&&(e.push(r[s]),n.push(s)),o[a]<=s&&a++}r[s]!==1&&(e.push(r[s]),n.push(s))}return{newShape:e,keptDims:n}}function Rd(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else{if(r!=="bool")throw new Error("Unknown data type "+r);e=new Uint8Array(t)}return e}function kd(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else if(r==="bool")e=new Uint8Array(t);else{if(r!=="string")throw new Error("Unknown data type "+r);e=new Array(t)}return e}function NR(r,t){for(var e=0;e<r.length;e++){var n=r[e];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+t+" being uploaded contains "+n+".")}}function DR(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function OR(r,t){return t!=="complex64"&&(t!=="float32"||r==="complex64")&&(t!=="int32"||r==="float32"||r==="complex64")&&(t!=="bool"||r!=="bool")}function or(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function Tb(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function PR(r){if(r==null)return 0;var t=0;return r.forEach(function(e){return t+=e.length}),t}function hs(r){return typeof r=="string"||r instanceof String}function MR(r){return typeof r=="boolean"}function LR(r){return typeof r=="number"}function Xc(r){return Array.isArray(r)?Xc(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":LR(r)?"float32":hs(r)?"string":MR(r)?"bool":"float32"}function Rs(r){return!!(r&&r.constructor&&r.call&&r.apply)}function sg(r,t){for(var e=t;e<r;++e)if(r%e==0)return e;return r}function zs(r){var t=r.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=r[t-1];for(var n=t-3;n>=0;--n)e[n]=e[n+1]*r[n+1];return e}function Ab(r,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=_a(r)),e&&NR(r,t),function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"}(r,t))return r;if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+t)}function jw(r,t){if(r.length===0)return t[0];var e=r.reduce(function(n,i){return n*i});if(e===0)return[];if(e!==t.length)throw new Error("["+r+"] does not match the input size.");return function n(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],c=0;c<u;c++)s[c]=a[i+c];else{u=o[0];var d=o.slice(1),p=d.reduce(function(f,g){return f*g});for(c=0;c<u;c++)s[c]=n(i+c*p,d,a)}return s}(0,r,t)}function Rb(r,t){for(var e=Qc(r,t),n=0;n<e.length;n++)e[n]=1;return e}function Qc(r,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+t)}function $i(){return he().platform.now()}function kb(r){r.forEach(function(t){W(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function FR(r,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",he().platform.encode(r,t)}function Nd(r,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",he().platform.decode(r,t)}var Ge=Object.freeze({shuffle:wS,clamp:og,nearestLargerEven:Sb,sum:AR,randUniform:function(r,t){var e=Math.random();return t*e+(1-e)*r},distSquared:function(r,t){for(var e=0,n=0;n<r.length;n++){var i=Number(r[n])-Number(t[n]);e+=i*i}return e},assert:W,assertShapesMatch:Nt,assertNonNull:Zu,flatten:_a,sizeFromShape:He,isScalarShape:function(r){return r.length===0},arraysEqual:Qn,isInt:mn,tanh:RR,sizeToSquarishShape:ag,createShuffledIndices:function(r){for(var t=new Uint32Array(r),e=0;e<r;++e)t[e]=e;return wS(t),t},rightPad:Pu,repeatedTry:Uw,inferFromImplicitShape:kR,parseAxisParam:Jn,squeezeShape:ls,getTypedArrayFromDType:Rd,getArrayFromDType:kd,checkConversionForErrors:NR,isValidDtype:DR,hasEncodingLoss:OR,isTypedArray:or,bytesPerElement:Tb,bytesFromStringArray:PR,isString:hs,isBoolean:MR,isNumber:LR,inferDtype:Xc,isFunction:Rs,nearestDivisor:sg,computeStrides:zs,toTypedArray:Ab,toNestedArray:jw,makeOnesTypedArray:Rb,makeZerosTypedArray:Qc,now:$i,assertNonNegativeIntegerDimensions:kb,fetch:function(r,t){return he().platform.fetch(r,t)},encodeString:FR,decodeString:Nd}),rW=function(){function r(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new iW)}return r.prototype.profileKernel=function(t,e,n){var i,o=this,a=this.backendTimer.time(function(){i=n()});return i.forEach(function(s){s.data().then(function(u){(function(c,d,p){if(d!=="float32")return!1;for(var f=0;f<c.length;f++){var g=c[f];if(isNaN(g)||!isFinite(g))return console.warn("Found "+g+" in the result of '"+p+"'"),!0}})(u,s.dtype,t),a.then(function(c){var d="";c.getExtraProfileInfo!=null&&(d=c.getExtraProfileInfo()),o.logger.logKernelProfile(t,s,u,c.kernelMs,e,d)})})}),i},r}(),iW=function(){function r(){}return r.prototype.logKernelProfile=function(t,e,n,i,o,a){var s=Pu(i+"ms",9),u=Pu(t,25),c=e.rank,d=e.size,p=Pu(e.shape.toString(),14),f="";for(var g in o){var y=o[g].shape,x=y.length;f+=g+": "+x+"D "+(x>0?y:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+p+"	%c"+d+"	%c"+f+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),bS=20,Gh=3,F0=7;function oW(r,t,e,n){var i=zs(t),o=function(c,d,p,f){var g=He(d),y=f[f.length-1],x=new Array(y).fill(0),b=d.length,_=p==="complex64"?Xh(c):c;if(b>1)for(var C=0;C<g/y;C++)for(var T=C*y,D=0;D<y;D++)x[D]=Math.max(x[D],Kh(_[T+D],0,p).length);return x}(r,t,e,i),a=t.length,s=function c(d,p,f,g,y,x){x===void 0&&(x=!0);var b=f==="complex64"?2:1,_=p[0],C=p.length;if(C===0){if(f==="complex64"){var T=Xh(d);return[Kh(T[0],0,f)]}return f==="bool"?[zR(d[0])]:[d[0].toString()]}if(C===1){if(_>bS){var D=Gh*b,O=Array.from(d.slice(0,D)),z=Array.from(d.slice(_-Gh*b,_));return f==="complex64"&&(O=Xh(O),z=Xh(z)),["["+O.map(function(ee,H){return Kh(ee,y[H],f)}).join(", ")+", ..., "+z.map(function(ee,H){return Kh(ee,y[_-Gh+H],f)}).join(", ")+"]"]}var I=f==="complex64"?Xh(d):Array.from(d);return["["+I.map(function(ee,H){return Kh(ee,y[H],f)}).join(", ")+"]"]}var S=p.slice(1),A=g.slice(1),N=g[0]*b,P=[];if(_>bS){for(var M=0;M<Gh;M++){var F=M*N,G=F+N;P.push.apply(P,c(d.slice(F,G),S,f,A,y,!1))}P.push("...");for(var M=_-Gh;M<_;M++){var F=M*N,G=F+N;P.push.apply(P,c(d.slice(F,G),S,f,A,y,M===_-1))}}else for(var M=0;M<_;M++){var F=M*N,G=F+N;P.push.apply(P,c(d.slice(F,G),S,f,A,y,M===_-1))}var Z=C===2?",":"";P[0]="["+P[0]+Z;for(var M=1;M<P.length-1;M++)P[M]=" "+P[M]+Z;for(var Y=`,
`,M=2;M<C;M++)Y+=`
`;return P[P.length-1]=" "+P[P.length-1]+"]"+(x?"":Y),P}(r,t,e,i,o),u=["Tensor"];return n&&(u.push("  dtype: "+e),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function Kh(r,t,e){return Pu(Array.isArray(r)?parseFloat(r[0].toFixed(F0))+" + "+parseFloat(r[1].toFixed(F0))+"j":hs(r)?"'"+r+"'":e==="bool"?zR(r):parseFloat(r.toFixed(F0)).toString(),t)}function zR(r){return r===0?"false":"true"}function Xh(r){for(var t=[],e=0;e<r.length;e+=2)t.push([r[e],r[e+1]]);return t}var Ac=function(){function r(t,e,n){var i=this;if(this.dtype=e,this.shape=t.slice(),this.size=He(t),n!=null){var o=n.length;W(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||kd(e,this.size),this.strides=zs(t)}return r.prototype.set=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),W(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(n);this.values[o]=t},r.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var n=0,i=0,o=t;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[n]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]},r.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},r.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return wo().makeTensor(this.values,this.shape,this.dtype)},r}(),wo=null,de=null,VR=null,Ut=function(){function r(t,e,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=He(t),this.strides=zs(t),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),W(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},r.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},r.prototype.as4D=function(t,e,n,i){return this.throwIfDisposed(),this.reshape([t,e,n,i])},r.prototype.as5D=function(t,e,n,i,o){return this.throwIfDisposed(),this.reshape([t,e,n,i,o])},r.prototype.asType=function(t){return this.throwIfDisposed(),de.cast(this,t)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ue(this,void 0,void 0,function(){var t;return je(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,de.buffer(this.shape,this.dtype,t)]}})})},r.prototype.bufferSync=function(){return de.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ue(this,void 0,void 0,function(){var t;return je(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,jw(this.shape,t)]}})})},r.prototype.arraySync=function(){return jw(this.shape,this.dataSync())},r.prototype.data=function(){return Ue(this,void 0,void 0,function(){var t,e;return je(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=wo().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(i){return Nd(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var t=wo().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(e){return Nd(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},r.prototype.bytes=function(){return Ue(this,void 0,void 0,function(){var t;return je(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,wo().read(this.dataId)];case 1:return t=e.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(wo().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(t){return t===void 0&&(t=!1),de.print(this,t)},r.prototype.reshape=function(t){return this.throwIfDisposed(),de.reshape(this,t)},r.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},r.prototype.expandDims=function(t){return t===void 0&&(t=0),de.expandDims(this,t)},r.prototype.cumsum=function(t,e,n){return t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1),de.cumsum(this,t,e,n)},r.prototype.squeeze=function(t){return this.throwIfDisposed(),de.squeeze(this,t)},r.prototype.clone=function(){return this.throwIfDisposed(),de.clone(this)},r.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),de.oneHot(this,t,e,n)},r.prototype.toString=function(t){return t===void 0&&(t=!1),oW(this.dataSync(),this.shape,this.dtype,t)},r.prototype.tile=function(t){return this.throwIfDisposed(),de.tile(this,t)},r.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),de.gather(this,t,e)},r.prototype.matMul=function(t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!1),this.throwIfDisposed(),de.matMul(this,t,e,n)},r.prototype.dot=function(t){return this.throwIfDisposed(),de.dot(this,t)},r.prototype.norm=function(t,e,n){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),de.norm(this,t,e,n)},r.prototype.slice=function(t,e){return this.throwIfDisposed(),de.slice(this,t,e)},r.prototype.reverse=function(t){return this.throwIfDisposed(),de.reverse(this,t)},r.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof r&&(t=[t]),de.concat([this].concat(t),e)},r.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),de.split(this,t,e)},r.prototype.stack=function(t,e){return e===void 0&&(e=0),de.stack([this,t],e)},r.prototype.unstack=function(t){return t===void 0&&(t=0),de.unstack(this,t)},r.prototype.pad=function(t,e){return e===void 0&&(e=0),de.pad(this,t,e)},r.prototype.batchNormalization=function(t,e,n,i,o){return n===void 0&&(n=.001),VR("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,i,n)},r.prototype.batchNorm=function(t,e,n,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),de.batchNorm(this,t,e,n,i,o)},r.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.all(this,t,e)},r.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.any(this,t,e)},r.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.logSumExp(this,t,e)},r.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.sum(this,t,e)},r.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.prod(this,t,e)},r.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.mean(this,t,e)},r.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.min(this,t,e)},r.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),de.max(this,t,e)},r.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),de.argMin(this,t)},r.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),de.argMax(this,t)},r.prototype.cast=function(t){return this.throwIfDisposed(),de.cast(this,t)},r.prototype.add=function(t){return this.throwIfDisposed(),de.add(this,t)},r.prototype.addStrict=function(t){return this.throwIfDisposed(),de.addStrict(this,t)},r.prototype.atan2=function(t){return this.throwIfDisposed(),de.atan2(this,t)},r.prototype.sub=function(t){return this.throwIfDisposed(),de.sub(this,t)},r.prototype.subStrict=function(t){return this.throwIfDisposed(),de.subStrict(this,t)},r.prototype.pow=function(t){return this.throwIfDisposed(),de.pow(this,t)},r.prototype.powStrict=function(t){return this.throwIfDisposed(),de.powStrict(this,t)},r.prototype.mul=function(t){return this.throwIfDisposed(),de.mul(this,t)},r.prototype.mulStrict=function(t){return this.throwIfDisposed(),de.mulStrict(this,t)},r.prototype.div=function(t){return this.throwIfDisposed(),de.div(this,t)},r.prototype.floorDiv=function(t){return this.throwIfDisposed(),de.floorDiv(this,t)},r.prototype.divStrict=function(t){return this.throwIfDisposed(),de.divStrict(this,t)},r.prototype.minimum=function(t){return this.throwIfDisposed(),de.minimum(this,t)},r.prototype.minimumStrict=function(t){return this.throwIfDisposed(),de.minimumStrict(this,t)},r.prototype.maximum=function(t){return this.throwIfDisposed(),de.maximum(this,t)},r.prototype.maximumStrict=function(t){return this.throwIfDisposed(),de.maximumStrict(this,t)},r.prototype.mod=function(t){return this.throwIfDisposed(),de.mod(this,t)},r.prototype.modStrict=function(t){return this.throwIfDisposed(),de.modStrict(this,t)},r.prototype.squaredDifference=function(t){return this.throwIfDisposed(),de.squaredDifference(this,t)},r.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),de.squaredDifferenceStrict(this,t)},r.prototype.transpose=function(t){return this.throwIfDisposed(),de.transpose(this,t)},r.prototype.notEqual=function(t){return this.throwIfDisposed(),de.notEqual(this,t)},r.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),de.notEqualStrict(this,t)},r.prototype.less=function(t){return this.throwIfDisposed(),de.less(this,t)},r.prototype.lessStrict=function(t){return this.throwIfDisposed(),de.lessStrict(this,t)},r.prototype.equal=function(t){return this.throwIfDisposed(),de.equal(this,t)},r.prototype.equalStrict=function(t){return this.throwIfDisposed(),de.equalStrict(this,t)},r.prototype.lessEqual=function(t){return this.throwIfDisposed(),de.lessEqual(this,t)},r.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),de.lessEqualStrict(this,t)},r.prototype.greater=function(t){return this.throwIfDisposed(),de.greater(this,t)},r.prototype.greaterStrict=function(t){return this.throwIfDisposed(),de.greaterStrict(this,t)},r.prototype.greaterEqual=function(t){return this.throwIfDisposed(),de.greaterEqual(this,t)},r.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),de.greaterEqualStrict(this,t)},r.prototype.logicalAnd=function(t){return this.throwIfDisposed(),de.logicalAnd(this,t)},r.prototype.logicalOr=function(t){return this.throwIfDisposed(),de.logicalOr(this,t)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),de.logicalNot(this)},r.prototype.logicalXor=function(t){return this.throwIfDisposed(),de.logicalXor(this,t)},r.prototype.where=function(t,e){return this.throwIfDisposed(),de.where(t,this,e)},r.prototype.neg=function(){return this.throwIfDisposed(),de.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),de.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),de.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),de.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),de.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),de.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),de.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),de.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),de.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),de.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),de.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),de.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),de.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),de.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),de.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),de.abs(this)},r.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),de.clipByValue(this,t,e)},r.prototype.relu=function(){return this.throwIfDisposed(),de.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),de.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),de.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),de.selu(this)},r.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),de.leakyRelu(this,t)},r.prototype.prelu=function(t){return this.throwIfDisposed(),de.prelu(this,t)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),de.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),de.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),de.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),de.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),de.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),de.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),de.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),de.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),de.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),de.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),de.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),de.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),de.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),de.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),de.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),de.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),de.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),de.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),de.round(this)},r.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),de.step(this,t)},r.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),de.softmax(this,t)},r.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),de.logSoftmax(this,t)},r.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),de.image.resizeBilinear(this,t,e)},r.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),de.image.resizeNearestNeighbor(this,t,e)},r.prototype.conv1d=function(t,e,n,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),de.conv1d(this,t,e,n,i,o,a)},r.prototype.conv2d=function(t,e,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),de.conv2d(this,t,e,n,i,o,a)},r.prototype.conv2dTranspose=function(t,e,n,i,o){return this.throwIfDisposed(),de.conv2dTranspose(this,t,e,n,i,o)},r.prototype.depthwiseConv2D=function(t,e,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),de.depthwiseConv2d(this,t,e,n,i,o,a)},r.prototype.separableConv2d=function(t,e,n,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),de.separableConv2d(this,t,e,n,i,o,a)},r.prototype.avgPool=function(t,e,n,i){return this.throwIfDisposed(),de.avgPool(this,t,e,n,i)},r.prototype.maxPool=function(t,e,n,i){return this.throwIfDisposed(),de.maxPool(this,t,e,n,i)},r.prototype.localResponseNormalization=function(t,e,n,i){return t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),i===void 0&&(i=.5),de.localResponseNormalization(this,t,e,n,i)},r.prototype.pool=function(t,e,n,i,o){return this.throwIfDisposed(),de.pool(this,t,e,n,i,o)},r.prototype.variable=function(t,e,n){return t===void 0&&(t=!0),this.throwIfDisposed(),wo().makeVariable(this,t,e,n)},r.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),de.unsortedSegmentSum(this,t,e)},r.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),de.batchToSpaceND(this,t,e)},r.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),de.spaceToBatchND(this,t,e)},r.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),de.topk(this,t,e)},r.prototype.stridedSlice=function(t,e,n,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),de.stridedSlice(this,t,e,n,i,o,a,s,u)},r.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),de.depthToSpace(this,t,e)},r.prototype.fft=function(){return this.throwIfDisposed(),de.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),de.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),de.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),de.spectral.irfft(this)},r}();Object.defineProperty(Ut,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var Ww,qw,Hw,$w,Gw,Dd=function(r){function t(e,n,i,o){var a=r.call(this,e.shape,e.dtype,e.dataId,o)||this;return a.trainable=n,a.name=i,a}return to(t,r),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Qn(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");wo().disposeTensor(this),this.dataId=e.dataId,wo().incRef(this,null)},t.prototype.dispose=function(){wo().disposeVariable(this),this.isDisposedInternal=!0},t}(Ut);Object.defineProperty(Dd,Symbol.hasInstance,{value:function(r){return r instanceof Ut&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(Ww||(Ww={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(qw||(qw={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(Hw||(Hw={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}($w||($w={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(Gw||(Gw={}));var aW={float32:$w,int32:qw,bool:Hw,complex64:Gw};function Tn(r,t){if(r==="string"||t==="string"){if(r==="string"&&t==="string")return"string";throw new Error("Can not upcast "+r+" with "+t)}return aW[r][t]}function z0(r){return Tn(r,"int32")}function gn(r,t){if(r.dtype===t.dtype)return[r,t];var e=Tn(r.dtype,t.dtype);return[r.cast(e),t.cast(e)]}function BR(r,t){W(r.dtype===t.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+t.dtype+") input must match"})}function Nb(r){var t=[];return function e(n,i,o){if(n!=null){if(n instanceof Ut)return void i.push(n);if(a=n,!(!Array.isArray(a)&&typeof a!="object")){var a,s=n;for(var u in s){var c=s[u];o.has(c)||(o.add(c),e(c,i,o))}}}}(r,t,new Set),t}var V0,Ao=Object.freeze({makeTypesMatch:gn,assertTypesMatch:BR,isTensorInList:function(r,t){for(var e=0;e<t.length;e++)if(t[e].id===r.id)return!0;return!1},getTensorsInContainer:Nb}),xS=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},r}(),sW=function(){function r(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new xS}return r.prototype.ready=function(){return Ue(this,void 0,void 0,function(){var t,e,n;return je(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),e=0,i.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},r.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},r.prototype.registerBackend=function(t,e,n){return n===void 0&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},r.prototype.setBackend=function(t){return Ue(this,void 0,void 0,function(){var e,n,i;return je(this,function(o){switch(o.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=n,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new rW(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var t=this;Vw(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(t.backendInstance)})},r.prototype.disposeRegisteredKernels=function(t){var e=this;Vw(t).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(e.registry[t])})},r.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(n==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<e.pendingBackendInitId)&&(e.registry[t]=s,e.pendingBackendInit=null,!0)}).catch(function(s){return!(o<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],i=this.initializeBackend(n),o=i.success,a=i.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),i=n.backend,o=this.readSync(e);i.disposeData(e),n.backend=t,t.move(e,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(t,e){var n,i=this,o=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(t,e,n){t();try{var i=n();return e(),i}catch(o){throw e(),o}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],function(i){return{x:function(){return i.toFloat()}}},[]),e},r.prototype.runKernel=function(t,e,n,i,o){return this.runKernelFunc(null,e,null,t,n,i,o)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(t,e,n){var i=this.backend.numDataIds(),o=0;n.forEach(function(u){o+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-e-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},r.prototype.runKernelFunc=function(t,e,n,i,o,a,s){var u,c=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var d,p=[],f=this.isTapeOn(),g=this.state.activeScope!=null?this.state.activeScope.name:"",y=function(T){f&&(p=T.map(function(D){return c.keep(c.clone(D))}))},x=this.state.numBytes,b=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var _,C=TR(i,this.backendName);return d=C!=null?function(){var T=c.backend.numDataIds();_=C.kernelFunc({inputs:e,attrs:o,backend:c.backend});var D=Array.isArray(_)?_:[_];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(g,T,D);var O=D.map(function(I){var S=I.dataId,A=I.shape,N=I.dtype;return c.makeTensorFromDataId(S,A,N)}),z=O.filter(function(I,S){return s[S]});return y(a.slice().concat(z)),O}:function(){var T=c.backend.numDataIds();_=c.tidy(function(){return t(c.backend,y)});var D=Array.isArray(_)?_:[_];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(g,T,D),D},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(g,e,function(){return d()}):d()}),f&&this.addTapeNode(g,e,u,n,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:g,bytesAdded:this.state.numBytes-x,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-b,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(T){return e[T].shape}),outputShapes:u.map(function(T){return T.shape})}),Array.isArray(_)?u:u[0]},r.prototype.makeTensor=function(t,e,n,i){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;var o=t;n==="string"&&hs(t[0])&&(o=t.map(function(d){return FR(d)}));var a=i.write(o,e,n),s=new Ut(e,n,a,this.nextTensorId());if(this.incRef(s,i),n==="string"){var u=this.state.tensorInfo.get(a),c=PR(o);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(t,e,n,i){var o=new Ut(e,n=n||"float32",t,this.nextTensorId());return this.incRef(o,i),o},r.prototype.makeVariable=function(t,e,n,i){e===void 0&&(e=!0),n=n||this.nextVariableId().toString(),i!=null&&i!==t.dtype&&(t=t.asType(i));var o=new Dd(t,e,n,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},r.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(i=t.size*Tb(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Dd||this.track(t)},r.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},r.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},r.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},r.prototype.profile=function(t){return Ue(this,void 0,void 0,function(){var e,n;return je(this,function(i){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(t,e,n,i,o){var a=this,s={id:this.state.nextTapeNodeId++,name:t,inputs:e,outputs:n,saved:o};i!=null&&(s.gradient=function(u){return u=u.map(function(c,d){if(c==null){var p=n[d],f=Qc(p.size,p.dtype);return a.makeTensor(f,p.shape,p.dtype)}return c}),i(u.length>1?u:u[0],o)}),this.state.activeTape.push(s)},r.prototype.keep=function(t){return t.kept=!0,t},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},r.prototype.endScope=function(t){for(var e=this,n=Nb(t),i=new Set(n.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},r.prototype.gradients=function(t,e,n,i){var o=this;if(i===void 0&&(i=!1),W(e.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});W(a instanceof Ut,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,d){for(var p={},f={},g=0;g<c.length;g++)p[c[g].id]=!0;for(g=0;g<u.length;g++){var y=(z=u[g]).inputs;for(var x in y){for(var b=y[x],_=!1,C=0;C<c.length;C++)if(p[b.id]){z.outputs.forEach(function(N){return p[N.id]=!0}),_=!0,f[z.id]=!0;break}if(_)break}}var T={};T[d.id]=!0;var D={};for(g=u.length-1;g>=0;g--)for(y=(z=u[g]).inputs,C=0;C<z.outputs.length;C++)if(T[z.outputs[C].id]){for(var x in y)T[y[x].id]=!0,D[z.id]=!0;break}var O=[];for(g=0;g<u.length;g++){var z;if(f[(z=u[g]).id]&&D[z.id]){var I={};for(var x in z.inputs){var S=z.inputs[x];p[S.id]&&(I[x]=S)}var A=Object.assign({},z);A.inputs=I,A.outputs=z.outputs,O.push(A)}}return O}(this.state.activeTape,e,a);if(!i&&s.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,d={};d[a.id]=n??(u=a.shape,c=Rb(He(u),"float32"),K.makeTensor(c,u,"float32")),function(f,g,y){for(var x=function(_){var C=g[_],T=[];if(C.outputs.forEach(function(I){var S=f[I.id];S!=null?T.push(S):T.push(null)}),C.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+C.name+".");var D=C.gradient(T),O=function(I){if(!(I in D))throw new Error("Cannot backprop through input "+I+". Available gradients found: "+Object.keys(D)+".");var S=y(function(){return D[I]()});if(S.dtype!=="float32")throw new Error("Error in gradient for op "+C.name+". The gradient of input "+I+" must have 'float32' dtype, but has '"+S.dtype+"'");var A=C.inputs[I];if(!Qn(S.shape,A.shape))throw new Error("Error in gradient for op "+C.name+". The gradient of input '"+I+"' has shape '"+S.shape+"', which does not match the shape of the input '"+A.shape+"'");if(f[A.id]==null)f[A.id]=S;else{var N=f[A.id];f[A.id]=N.add(S),N.dispose()}};for(var z in C.inputs)O(z)},b=g.length-1;b>=0;b--)x(b)}(d,s,function(f){return o.tidy(f)});var p=e.map(function(f){return d[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var g in f.saved)f.saved[g].dispose()}),o.state.activeTape=null),{value:a,grads:p}})},r.prototype.customGrad=function(t){var e=this;return W(Rs(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];W(i.every(function(s){return s instanceof Ut}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),e.runKernelFunc(function(s,u){return W((n=t.apply(void 0,i.concat([u]))).value instanceof Ut,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),W(Rs(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(s,u){var c=n.gradFunc(s,u),d=Array.isArray(c)?c:[c];W(d.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),W(d.every(function(f){return f instanceof Ut}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return d.forEach(function(f,g){p[g]=function(){return f}}),p})}},r.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},r.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},r.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},r.prototype.time=function(t){return Ue(this,void 0,void 0,function(){var e,n;return je(this,function(i){switch(i.label){case 0:return e=$i(),[4,this.backend.time(t)];case 1:return(n=i.sent()).wallMs=$i()-e,[2,n]}})})},r.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new xS,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),K=function(){var r=function(){if(V0==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}V0=e}return V0}();if(r._tfengine==null){var t=new SR(r);r._tfengine=new sW(t)}return function(e){Ib=e}(r._tfengine.ENV),wo=function(){return r._tfengine},r._tfengine}();function UR(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var na=he();na.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),na.registerFlag("IS_BROWSER",function(){return UR()}),na.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),na.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),na.registerFlag("PROD",function(){return!1}),na.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return na.getBool("DEBUG")}),na.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),na.registerFlag("IS_TEST",function(){return!1});var Od,oi,ri,bu={},B0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function jR(r,t){bu[r]=t}function Mo(r){r in bu||(bu[r]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=WR(e);return n.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete bu[e]},!1),e===1?n.getContext("webgl",B0)||n.getContext("experimental-webgl",B0):n.getContext("webgl2",B0)}(r));var t=bu[r];return t.isContextLost()?(delete bu[r],Mo(r)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),bu[r])}function WR(r){if(typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Xg(r,t){return[t,r]}function gd(r){var t=He(r);return ag(Math.ceil(t/4))}function ap(r,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(r/2))]}function Db(r,t){var e,n,i,o,a,s,u,c,d,p=r;return he().getNumber("WEBGL_VERSION")===2?(e=p.R32F,n=p.R16F,i=p.RGBA16F,o=p.RGBA32F,a=p.RED,s=4,u=1,c=p.HALF_FLOAT,d=p.FLOAT):(e=r.RGBA,n=r.RGBA,i=r.RGBA,o=p.RGBA,a=r.RGBA,s=4,u=4,c=t!=null?t.HALF_FLOAT_OES:null,d=r.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:d}}function Fe(r,t,e){var n=e();return t&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+HR(i,o))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Od||(Od={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(oi||(oi={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ri||(ri={}));var uW=596e-10,lW=65504;function qR(r){return!!(he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||uW<Math.abs(r)&&Math.abs(r)<lW)}function HR(r,t){switch(t){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Im(r,t,e){return Aa(r,t,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function $R(r,t,e){var n=Aa(r,t,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Fe(r,t,function(){return r.shaderSource(n,e)}),Fe(r,t,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function GR(r,t,e){var n=Aa(r,t,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Fe(r,t,function(){return r.shaderSource(n,e)}),Fe(r,t,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(i,o){var a=cW.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),c=u.length.toString().length+2,d=u.map(function(b,_){return Pu((_+1).toString(),c)+b}),p=0,f=0;f<d.length;f++)p=Math.max(d[f].length,p);var g=d.slice(0,s-1),y=d.slice(s-1,s),x=d.slice(s);console.log(g.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+Pu(y[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(x.join(`
`))}(e,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Cm,Sm,cW=/ERROR: [0-9]+:([0-9]+):/g;function KR(r,t){return Aa(r,t,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function XR(r,t,e){if(Fe(r,t,function(){return r.linkProgram(e)}),r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Tm(r,t,e){if(Fe(r,t,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function QR(r,t,e){var n=Aa(r,t,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Fe(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Fe(r,t,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),n}function YR(r,t,e){var n=Aa(r,t,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Fe(r,t,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),Fe(r,t,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),n}function JR(r,t){return Aa(r,t,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function ZR(r,t){var e=he().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||t<=0){var n="["+r+"x"+t+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>e||t>e)throw n="["+r+"x"+t+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function ek(r,t){return Aa(r,t,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Kw(r,t,e,n,i,o,a,s){var u=r.getAttribLocation(e,n);return u!==-1&&(Fe(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,i)}),Fe(r,t,function(){return r.vertexAttribPointer(u,o,r.FLOAT,!1,a,s)}),Fe(r,t,function(){return r.enableVertexAttribArray(u)}),!0)}function tk(r,t,e,n){ak(r,n),Fe(r,t,function(){return r.activeTexture(r.TEXTURE0+n)}),Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function nk(r,t,e,n){return Aa(r,t,function(){return r.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function rk(r,t,e){return r.getUniformLocation(t,e)}function ik(r,t,e,n,i,o){Fe(r,t,function(){return tk(r,t,n,o)}),Fe(r,t,function(){return r.uniform1i(i,o)})}function Am(r,t,e,n){Fe(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),Fe(r,t,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function Xw(r,t,e){Fe(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Fe(r,t,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function ad(r){var t=r.checkFramebufferStatus(r.FRAMEBUFFER);if(t!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ok(r,t))}function ok(r,t){switch(t){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Aa(r,t,e,n){var i=Fe(r,t,function(){return e()});if(i==null)throw new Error(n);return i}function ak(r,t){var e=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=t+r.TEXTURE0;if(n<r.TEXTURE0||n>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function Pd(r,t){return t===void 0&&(t=2),He(r.slice(0,r.length-t))}function Md(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Rm(r){var t=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(t=[Pd(r)].concat(Md(r))),t}function sk(r,t){var e;t===void 0&&(t=!1);var n=he().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,(r=r.map(function(c,d){return d>=r.length-2?Sb(r[d]):r[d]})).length===1&&(r=[2,r[0]])),r.length!==2){var i=ls(r);r=i.newShape}var o=He(r);if(r.length<=1&&o<=n)return[1,o];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(t){var a=Pd(r),s=2,u=2;return r.length&&(s=(e=Md(r))[0],u=e[1]),ag(o=a*(s/2)*(u/2)).map(function(c){return 2*c})}return ag(o)}function Jf(r){return r%2==0}function sd(r,t){if(Qn(r=r.slice(-2),t=t.slice(-2))||!r.length||!t.length||r[0]===0||r[1]===0||t[0]===0||t[1]===0)return!0;if(r.length!==t.length){var e=r.slice(-1)[0],n=t.slice(-1)[0];if(e===n||Jf(e)&&Jf(n)&&(r[0]===1||t[0]===1))return!0}return r[1]===t[1]&&Jf(r[0])&&Jf(t[0])}function uk(r){if(Cm==null){var t=Mo(r);Cm=t.getParameter(t.MAX_TEXTURE_SIZE)}return Cm}function lk(r){if(Sm==null){var t=Mo(r);Sm=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Sm)}function ck(r){if(r===0)return 0;var t=Mo(r);return Ki(t,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Ki(t,"EXT_disjoint_timer_query")?1:0}function Ki(r,t){return r.getExtension(t)!=null}function Qw(r){try{if(Mo(r)!=null)return!0}catch{return!1}return!1}function hk(r){if(r===0)return!1;var t=Mo(r);if(r===1){if(!Ki(t,"OES_texture_float"))return!1}else if(!Ki(t,"EXT_color_buffer_float"))return!1;return Yw(t)}function dk(r){if(r===0)return!1;var t=Mo(r);if(r!==1){if(Ki(t,"EXT_color_buffer_float"))return Yw(t);if(Ki(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(n,i){var o=Db(n,i),a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0);var u=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(a),n.deleteFramebuffer(s),u}(t,e)}return!1}return!!Ki(t,"OES_texture_float")&&!!Ki(t,"WEBGL_color_buffer_float")&&Yw(t)}function Yw(r){var t=Db(r),e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(e),r.deleteFramebuffer(n),i}function pk(r){return r===2&&Mo(r).fenceSync!=null}var hW=Object.freeze({callAndCheck:Fe,canBeRepresented:qR,getWebGLErrorMessage:HR,getExtensionOrThrow:Im,createVertexShader:$R,createFragmentShader:GR,createProgram:KR,linkProgram:XR,validateProgram:Tm,createStaticVertexBuffer:QR,createStaticIndexBuffer:YR,getNumChannels:function(){return he().getNumber("WEBGL_VERSION")===2?1:4},createTexture:JR,validateTextureSize:ZR,createFramebuffer:ek,bindVertexBufferToProgramAttribute:Kw,bindTextureUnit:tk,unbindTextureUnit:function(r,t,e){ak(r,e),Fe(r,t,function(){return r.activeTexture(r.TEXTURE0+e)}),Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:nk,getProgramUniformLocation:rk,bindTextureToProgramUniformSampler:ik,bindCanvasToFramebuffer:function(r,t){Fe(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Fe(r,t,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Fe(r,t,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:Am,unbindColorTextureFromFramebuffer:Xw,validateFramebuffer:ad,getFramebufferErrorMessage:ok,getBatchDim:Pd,getRowsCols:Md,getShapeAs3D:Rm,getTextureShapeFromLogicalShape:sk,isReshapeFree:sd,getWebGLMaxTextureSize:uk,resetMaxTextureSize:function(){Cm=null},resetMaxTexturesInShader:function(){Sm=null},getMaxTexturesInShader:lk,getWebGLDisjointQueryTimerVersion:ck,hasExtension:Ki,isWebGLVersionEnabled:Qw,isCapableOfRenderingToFloatTexture:hk,isDownloadFloatTextureEnabled:dk,isWebGLFenceEnabled:pk}),nt=he();function dW(){he().set("PROD",!0)}function pW(){he().set("DEBUG",!0)}function fW(){he().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Qg(r){he().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function mW(){K.disposeVariables()}function gW(){return K}function Jw(){return K.memory()}function vW(r){return K.profile(r)}function ue(r,t){return K.tidy(r,t)}function ft(r){Nb(r).forEach(function(t){return t.dispose()})}function No(r){return K.keep(r)}function yW(r){return K.time(r)}function wW(r){return K.setBackend(r)}function bW(){return K.ready()}function xW(){return K.backendName}function _W(r){K.removeBackend(r)}function EW(r){return K.findBackend(r)}function IW(r){return K.findBackendFactory(r)}function CW(r,t,e){return e===void 0&&(e=1),K.registerBackend(r,t,e)}function fk(){return K.backend}function SW(r,t){he().setPlatform(r,t)}function Zw(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];he().getBool("IS_TEST")||console.warn.apply(console,r)}function Do(r,t){var e=r;if(or(r))return t==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(e)||or(e)&&t!=="string";)n.push(e.length),e=e[0];return Array.isArray(r)&&he().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!or(o))return void W(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});W(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),W(o.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"});for(var u=a.slice(1),c=0;c<o.length;++c)i(o[c],u,s.concat(c))}(r,n,[]),n}function _S(r,t,e,n){if(r!=null&&(r!=="numeric"&&r!==t||r==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+n+"' must be "+r+" tensor, but got "+t+" tensor")}function j(r,t,e,n){if(n===void 0&&(n="numeric"),r instanceof Ut)return _S(n,r.dtype,t,e),r;var i=Xc(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),_S(n,i,t,e),r==null||!or(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var o=r==null?"null":r.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=Do(r,i);or(r)||Array.isArray(r)||(r=[r]);var s=i!=="string"?Ab(r,i,he().getBool("DEBUG")):_a(r,[],!0);return K.makeTensor(s,a,i)}function Ld(r,t,e,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(i,o){return j(i,t+"["+o+"]",e)},n)}function Ob(r,t){for(var e=0;e<r.length;++e)if(r[r.length-e-1]!==t-1-e)return!1;return!0}function mk(r,t,e){for(var n=r.length+t.length,i=[],o=0,a=0,s=0;s<n;s++)e.indexOf(s)===-1?i.push(r[o++]):i.push(t[a++]);return i}function ir(r,t){for(var e=[],n=r.length,i=0;i<n;i++)t.indexOf(i)===-1&&e.push(r[i]);return[e,t.map(function(o){return r[o]})]}function li(r,t){return mk(r,t.map(function(e){return 1}),t)}function Ur(r,t,e){W(Ob(t,e),function(){return r+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function no(r,t){if(Ob(r,t))return null;for(var e=[],n=0;n<t;++n)r.indexOf(n)===-1&&e.push(n);return r.forEach(function(i){return e.push(i)}),e}function Yg(r){return r.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function ro(r,t){for(var e=[],n=t-r;n<t;++n)e.push(n);return e}function gk(r,t){var e=r[0].length;r.forEach(function(i,o){W(i.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+e+")"})}),W(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var n=r[0];r.forEach(function(i,o){for(var a=0;a<e;a++)W(a===t||i[a]===n[a],function(){return"Error in concat"+e+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+o+"."})})}function Wu(r,t){for(var e=r[0].slice(),n=1;n<r.length;n++)e[t]+=r[n][t];return e}function X(r){var t=Object.keys(r);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],n=r[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];K.startScope(e);try{var s=n.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),K.endScope(s),s}catch(u){throw K.endScope(null),u}};return Object.defineProperty(i,"name",{value:e,configurable:!0}),i}nt.registerFlag("HAS_WEBGL",function(){return nt.getNumber("WEBGL_VERSION")>0}),nt.registerFlag("WEBGL_VERSION",function(){return Qw(2)?2:Qw(1)?1:0}),nt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return nt.get("WEBGL_VERSION")===2}),nt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),nt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),nt.registerFlag("WEBGL_PACK",function(){return nt.getBool("HAS_WEBGL")}),nt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_PACK_CLIP",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),nt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_PACK_REDUCE",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_CONV_IM2COL",function(){return nt.getBool("WEBGL_PACK")}),nt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return uk(nt.getNumber("WEBGL_VERSION"))}),nt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return lk(nt.getNumber("WEBGL_VERSION"))}),nt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=nt.getNumber("WEBGL_VERSION");return r===0?0:ck(r)}),nt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return nt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),nt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return hk(nt.getNumber("WEBGL_VERSION"))}),nt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!nt.getBool("WEBGL_FORCE_F16_TEXTURES")&&nt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),nt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return dk(nt.getNumber("WEBGL_VERSION"))}),nt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return pk(nt.getNumber("WEBGL_VERSION"))}),nt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return nt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),VR=Qg;var Ln=X({complex_:function(r,t){var e=j(r,"real","complex"),n=j(t,"imag","complex");return Nt(e.shape,n.shape,"real and imag shapes, "+e.shape+" and "+n.shape+", must match in call to tf.complex()."),K.runKernelFunc(function(i){return i.complex(e,n)},{$real:e,$imag:n})}}),Wr=X({real_:function(r){var t=j(r,"input","real");return K.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),Ci=X({imag_:function(r){var t=j(r,"input","imag");return K.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function xn(r,t,e){return Vs(r,t,Do(r,e),e)}function Vs(r,t,e,n){if(n==null&&(n=Xc(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!or(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){kb(t);var i=He(t),o=He(e);W(i===o,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<e.length;++a){var s=e[a],u=a!==e.length-1||s!==He(t.slice(a));W(e[a]===t[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return or(r)||Array.isArray(r)||(r=[r]),t=t||e,r=n!=="string"?Ab(r,n,he().getBool("DEBUG")):_a(r,[],!0),K.makeTensor(r,t,n)}function Ve(r,t){if((or(r)&&t!=="string"||Array.isArray(r))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&or(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Vs(r,[],[],t)}function $r(r,t){Zu(r);var e=Do(r,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Vs(r,null,e,t)}function pa(r,t,e){if(Zu(r),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Do(r,e);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Vs(r,t,n,e)}function Pb(r,t,e){if(Zu(r),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Do(r,e);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Vs(r,t,n,e)}function is(r,t,e){if(Zu(r),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Do(r,e);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Vs(r,t,n,e)}function vk(r,t,e){if(Zu(r),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Do(r,e);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Vs(r,t,n,e)}function yk(r,t,e){if(Zu(r),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Do(r,e);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Vs(r,t=t||n,n,e)}function Mb(r,t,e,n){return t===void 0&&(t=!0),K.makeVariable(r,t,e,n)}function Lo(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=Lo(r,"float32"),n=zt(r,"float32");return Ln(e,n)}var i=Rb(He(r),t);return K.makeTensor(i,r,t)}function zt(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=zt(r,"float32"),n=zt(r,"float32");return Ln(e,n)}var i=Qc(He(r),t);return K.makeTensor(i,r,t)}function Yc(r,t,e){return K.runKernelFunc(function(n){return n.fill(r,t,e)},{})}function Lb(r,t,e){if(e<=0)throw new Error("The number of values should be positive.");return K.runKernelFunc(function(n){return n.linspace(r,t,e)},{})}function Jg(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e===0)throw new Error("Cannot have a step of zero");if(r===t||r<t&&e<0||t<r&&e>1)return zt([0],n);var i=Qc(Math.abs(Math.ceil((t-r)/e)),n);t<r&&e===1&&(e=-1),i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+e;return $r(i,n)}var ci=X({onesLike_:function(r){var t=j(r,"x","onesLike");if(t.dtype==="complex64"){var e=ci(Wr(t)),n=Ct(Ci(t));return Ln(e,n)}return K.runKernelFunc(function(i){return i.onesLike(t)},{$x:t},function(i,o){return{$x:function(){return Ct(i)}}})}}),Ct=X({zerosLike_:function(r){var t=j(r,"x","zerosLike");return K.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,n){return{$x:function(){return Ct(e)}}})}}),br=X({concat_:function(r,t){t===void 0&&(t=0),W(r.length>=1,function(){return"Pass at least one tensor to concat"});var e=Ld(r,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")}),t=Jn(t,e[0].shape)[0];var n=Wu(e.map(function(a){return a.shape}),t);if(He(n)===0)return xn([],n);if((e=e.filter(function(a){return a.size>0})).length===1)return e[0];var i=e.map(function(a){return a.shape});gk(i,t);var o=e;return K.runKernelFunc(function(a){return a.concat(e,t)},o,function(a){var s=i.map(function(u){return u[t]});return fa(a,s,t).map(function(u){return function(){return u}})})}}),Fb=X({concat1d_:function(r){return br(r,0)}}),zb=X({concat2d_:function(r,t){return br(r,t)}}),Vb=X({concat3d_:function(r,t){return br(r,t)}}),Bb=X({concat4d_:function(r,t){return br(r,t)}}),fa=X({split_:function(r,t,e){e===void 0&&(e=0);var n,i=j(r,"x","split");return e=Jn(e,i.shape)[0],typeof t=="number"?(W(i.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(t).fill(i.shape[e]/t)):(W(i.shape[e]===t.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=t),K.runKernelFunc(function(o){return o.split(i,n,e)},{$x:i},function(o){return{$x:function(){return br(o,e)}}})}});function el(r,t){return r(t={exports:{}},t.exports),t.exports}var TW=el(function(r){(function(t,e,n){function i(s){var u,c=this,d=(u=4022871197,function(p){p=p.toString();for(var f=0;f<p.length;f++){var g=.02519603282416938*(u+=p.charCodeAt(f));g-=u=g>>>0,u=(g*=u)>>>0,u+=4294967296*(g-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var p=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=p-(c.c=0|p)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(s),c.s0<0&&(c.s0+=1),c.s1-=d(s),c.s1<0&&(c.s1+=1),c.s2-=d(s),c.s2<0&&(c.s2+=1),d=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new i(s),d=u&&u.state,p=c.next;return p.int32=function(){return 4294967296*c.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.alea=a})(0,r)}),AW=el(function(r){(function(t,e,n){function i(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var p=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^p^p>>>8},s===(0|s)?u.x=s:c+=s;for(var d=0;d<c.length+64;d++)u.x^=0|c.charCodeAt(d),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=c.next,p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xor128=a})(0,r)}),RW=el(function(r){(function(t,e,n){function i(s){var u=this,c="";u.next=function(){var p=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^p^p<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var d=0;d<c.length+64;d++)u.x^=0|c.charCodeAt(d),d==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=c.next,p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xorwow=a})(0,r)}),kW=el(function(r){(function(t,e,n){function i(s){var u=this;u.next=function(){var c,d,p=u.x,f=u.i;return c=p[f],d=(c^=c>>>7)^c<<24,d^=(c=p[f+1&7])^c>>>10,d^=(c=p[f+3&7])^c>>>3,d^=(c=p[f+4&7])^c<<7,c=p[f+7&7],d^=(c^=c<<13)^c<<9,p[f]=d,u.i=f+1&7,d},function(c,d){var p,f=[];if(d===(0|d))f[0]=d;else for(d=""+d,p=0;p<d.length;++p)f[7&p]=f[7&p]<<15^d.charCodeAt(p)+f[p+1&7]<<13;for(;f.length<8;)f.push(0);for(p=0;p<8&&f[p]===0;++p);for(p==8?f[7]=-1:f[p],c.x=f,c.i=0,p=256;p>0;--p)c.next()}(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=c.next,p.quick=p,d&&(d.x&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xorshift7=a})(0,r)}),NW=el(function(r){(function(t,e,n){function i(s){var u=this;u.next=function(){var c,d,p=u.w,f=u.X,g=u.i;return u.w=p=p+1640531527|0,d=f[g+34&127],c=f[g=g+1&127],d^=d<<13,c^=c<<17,d^=d>>>15,c^=c>>>12,d=f[g]=d^c,u.i=g,d+(p^p>>>16)|0},function(c,d){var p,f,g,y,x,b=[],_=128;for(d===(0|d)?(f=d,d=null):(d+="\0",f=0,_=Math.max(_,d.length)),g=0,y=-32;y<_;++y)d&&(f^=d.charCodeAt((y+32)%d.length)),y===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,y>=0&&(x=x+1640531527|0,g=(p=b[127&y]^=f+x)==0?g+1:0);for(g>=128&&(b[127&(d&&d.length||0)]=-1),g=127,y=512;y>0;--y)f=b[g+34&127],p=b[g=g+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,b[g]=f^p;c.w=x,c.X=b,c.i=g}(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=c.next,p.quick=p,d&&(d.X&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xor4096=a})(0,r)}),DW=el(function(r){(function(t,e,n){function i(s){var u=this,c="";u.next=function(){var p=u.b,f=u.c,g=u.d,y=u.a;return p=p<<25^p>>>7^f,f=f-g|0,g=g<<24^g>>>8^y,y=y-p|0,u.b=p=p<<20^p>>>12^f,u.c=f=f-g|0,u.d=g<<16^f>>>16^y,u.a=y-p|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var d=0;d<c.length+20;d++)u.b^=0|c.charCodeAt(d),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=c.next,p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.tychei=a})(0,r)}),xu=el(function(r){(function(t,e){var n,i=this,o=256,a=6,s="random",u=e.pow(o,a),c=e.pow(2,52),d=2*c,p=o-1;function f(_,C,T){var D=[],O=x(function S(A,N){var P,M=[],F=typeof A;if(N&&F=="object")for(P in A)try{M.push(S(A[P],N-1))}catch{}return M.length?M:F=="string"?A:A+"\0"}((C=C==1?{entropy:!0}:C||{}).entropy?[_,b(t)]:_??function(){try{var S;return n&&(S=n.randomBytes)?S=S(o):(S=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(S)),b(S)}catch{var A=i.navigator,N=A&&A.plugins;return[+new Date,i,N,i.screen,b(t)]}}(),3),D),z=new g(D),I=function(){for(var S=z.g(a),A=u,N=0;S<c;)S=(S+N)*o,A*=o,N=z.g(1);for(;S>=d;)S/=2,A/=2,N>>>=1;return(S+N)/A};return I.int32=function(){return 0|z.g(4)},I.quick=function(){return z.g(4)/4294967296},I.double=I,x(b(z.S),t),(C.pass||T||function(S,A,N,P){return P&&(P.S&&y(P,z),S.state=function(){return y(z,{})}),N?(e[s]=S,A):S})(I,O,"global"in C?C.global:this==e,C.state)}function g(_){var C,T=_.length,D=this,O=0,z=D.i=D.j=0,I=D.S=[];for(T||(_=[T++]);O<o;)I[O]=O++;for(O=0;O<o;O++)I[O]=I[z=p&z+_[O%T]+(C=I[O])],I[z]=C;(D.g=function(S){for(var A,N=0,P=D.i,M=D.j,F=D.S;S--;)A=F[P=p&P+1],N=N*o+F[p&(F[P]=F[M=p&M+A])+(F[M]=A)];return D.i=P,D.j=M,N})(o)}function y(_,C){return C.i=_.i,C.j=_.j,C.S=_.S.slice(),C}function x(_,C){for(var T,D=_+"",O=0;O<D.length;)C[p&O]=p&(T^=19*C[p&O])+D.charCodeAt(O++);return b(C)}function b(_){return String.fromCharCode.apply(0,_)}if(e["seed"+s]=f,x(e.random(),t),r.exports){r.exports=f;try{n=require("crypto")}catch{}}})([],Math)});xu.alea=TW,xu.xor128=AW,xu.xorwow=RW,xu.xorshift7=kW,xu.xor4096=NW,xu.tychei=DW;var Zg=xu.alea,Ub=function(){function r(t,e,n,i,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Zg(a.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*o*u,n=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(e)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},r.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},r.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},r}(),OW=function(){function r(t,e,n,i){this.alpha=t,this.beta=1/e,this.dtype=n;var o=i||Math.random();this.randu=Zg(o.toString()),this.randn=new Ub(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var t,e,n,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,e=1-.331*(t=i*i)*t,n=.5*t+this.d*(1-a+Math.log(a)),(o=this.randu())<e||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},r.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},r}(),PW=function(){function r(t,e,n,i){var o=this;if(t===void 0&&(t=0),e===void 0&&(e=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=t,this.range=e-t,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Zg(i)}return r.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function st(r,t,e){return t===void 0&&(t="float32"),t=t||"float32",kb(r),new Ac(r,t,e)}function wk(r,t){t===void 0&&(t=!1),console.log(r.toString(t))}var ev=X({batchToSpaceND_:function(r,t,e){var n=j(r,"x","batchToSpaceND"),i=t.reduce(function(o,a){return o*a});return W(n.rank>=1+t.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+t.length}),W(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),W(n.shape[0]%i==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i}),K.runKernelFunc(function(o){return o.batchToSpaceND(n,t,e)},{$x:n},function(o){return{$x:function(){return o.spaceToBatchND(t,e)}}})}}),tv=X({cast_:function(r,t){var e=j(r,"x","cast");if(!DR(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:t};return K.runKernelFunc(function(i){return i.cast(e,t)},{x:e},function(i){return{x:function(){return i.clone()}}},"Cast",n)}}),bk=X({clone_:function(r){var t=j(r,"x","clone",null);return K.runKernelFunc(function(){return K.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),xk=X({cumsum_:function(r,t,e,n){t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1);var i=j(r,"x","cumsum"),o=no([t|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=ro(1,i.rank)[0],u=K.runKernelFunc(function(c){return c.cumsum(a,s,e,n)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(t,e,!n)}}});return o!=null&&(u=u.transpose(o)),u}}),jb=X({depthToSpace_:function(r,t,e){e===void 0&&(e="NHWC");var n=j(r,"x","depthToSpace"),i=e==="NHWC"?n.shape[1]:n.shape[2],o=e==="NHWC"?n.shape[2]:n.shape[3],a=e==="NHWC"?n.shape[3]:n.shape[1];return W(i*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+`  for depthToSpace with input shape
      `+n.shape}),W(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+` for depthToSpace with input shape
          `+n.shape}),W(a%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+n.shape}),K.runKernelFunc(function(s){return s.depthToSpace(n,t,e)},{$x:n})}}),ii=X({expandDims_:function(r,t){t===void 0&&(t=0);var e=j(r,"x","expandDims",null);W(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var n=e.shape.slice();return t<0&&(W(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),n.splice(t,0,1),sp(e,n)}}),nv=X({eye_:function(r,t,e,n){n===void 0&&(n="float32"),t==null&&(t=r);for(var i=st([r,t],n),o=r<=t?r:t,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(r,t);if(e==null)return s;if(e.length===1)return ws(ii(s,0),[e[0],1,1]);if(e.length===2)return ws(ii(ii(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return ws(ii(ii(ii(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Wb=X({multinomial_:function(r,t,e,n){n===void 0&&(n=!1);var i=j(r,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);e=e||Math.random();var s=a===1?i.as2D(1,-1):i,u=K.runKernelFunc(function(c){return c.multinomial(s,n,t,e)},{logits2D:s});return a===1?u.as1D():u}}),Rc=X({oneHot_:function(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=j(r,"indices","oneHot","int32"),o=i.shape.concat([t]);return i=i.flatten(),K.runKernelFunc(function(a){return a.oneHot(i,t,e,n)},{$indices:i},function(a){return{$indices:function(){return zt(i.shape,"float32")}}}).reshape(o)}}),Bs=X({pad_:function(r,t,e){e===void 0&&(e=0);var n=j(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=t.map(function(o){return o[0]});return K.runKernelFunc(function(o){return o.pad(n,t,e)},{$x:n},function(o){return{$x:function(){return o.slice(i,n.shape)}}})}}),_k=X({pad1d_:function(r,t,e){return e===void 0&&(e=0),W(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Bs(r,[t],e)}}),Ek=X({pad2d_:function(r,t,e){return e===void 0&&(e=0),W(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Bs(r,t,e)}}),Ik=X({pad3d_:function(r,t,e){return e===void 0&&(e=0),W(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Bs(r,t,e)}}),Ck=X({pad4d_:function(r,t,e){return e===void 0&&(e=0),W(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Bs(r,t,e)}}),Sk=X({rand_:function(r,t,e){var n=He(r),i=null;if(e==null||e==="float32")i=new Float32Array(n);else if(e==="int32")i=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);i=new Uint8Array(n)}for(var o=0;o<n;o++)i[o]=t();return K.makeTensor(i,r,e)}}),qb=X({randomNormal_:function(r,t,e,n,i){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new Ub(t,e,n,!1,i),a=st(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Tk=X({randomGamma_:function(r,t,e,n,i){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e==null&&(e=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var o=new OW(t,e,n,i),a=st(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),tl=X({randomUniform_:function(r,t,e,n,i){t===void 0&&(t=0),e===void 0&&(e=1),n===void 0&&(n="float32");for(var o=st(r,n),a=new PW(t,e,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),sp=X({reshape_:function(r,t){var e=j(r,"x","reshape",null);t=kR(t,e.size),W(e.size===He(t),function(){return"new shape and old shape must have the same number of elements."});var n={shape:t};return K.runKernelFunc(function(i){return i.reshape(e,t)},{x:e},function(i){return{x:function(){return i.reshape(e.shape)}}},"Reshape",n)}}),rv=X({spaceToBatchND_:function(r,t,e){var n=j(r,"x","spaceToBatchND");return W(n.rank>=1+t.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+t.length}),W(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),W(n.shape.reduce(function(i,o,a){return a>0&&a<=t.length?i&&(o+e[a-1][0]+e[a-1][1])%t[a-1]==0:i},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),K.runKernelFunc(function(i){return i.spaceToBatchND(n,t,e)},{$x:n},function(i){return{$x:function(){return i.batchToSpaceND(t,e)}}})}}),up=X({squeeze_:function(r,t){var e=j(r,"x","squeeze");return sp(e,ls(e.shape,t).newShape)}}),Ji=X({stack_:function(r,t){t===void 0&&(t=0);var e=Ld(r,"tensors","stack");if(W(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var n=e[0].rank,i=e[0].shape,o=e[0].dtype;W(t<=n,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){Nt(i,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){W(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(s){return s.expandDims(t)});return br(a,t)}}),ws=X({tile_:function(r,t){var e=j(r,"x","tile",null);return W(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."}),K.runKernelFunc(function(n,i){var o=n.tile(e,t);return i([e]),o},{$x:e},function(n,i){var o=i[0];return{$x:function(){var a=Ct(o);if(o.rank===1)for(var s=0;s<t[0];++s)a=a.add(n.slice([s*o.shape[0]],[o.shape[0]]));else if(o.rank===2)for(s=0;s<t[0];++s)for(var u=0;u<t[1];++u)a=a.add(n.slice([s*o.shape[0],u*o.shape[1]],[o.shape[0],o.shape[1]]));else if(o.rank===3)for(s=0;s<t[0];++s)for(u=0;u<t[1];++u)for(var c=0;c<t[2];++c)a=a.add(n.slice([s*o.shape[0],u*o.shape[1],c*o.shape[2]],[o.shape[0],o.shape[1],o.shape[2]]));else{if(o.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+o.rank+" tensors yet.");for(s=0;s<t[0];++s)for(u=0;u<t[1];++u)for(c=0;c<t[2];++c)for(var d=0;d<t[3];++d)a=a.add(n.slice([s*o.shape[0],u*o.shape[1],c*o.shape[2],d*o.shape[3]],[o.shape[0],o.shape[1],o.shape[2],o.shape[3]]))}return a}}})}}),lp=X({truncatedNormal_:function(r,t,e,n,i){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new Ub(t,e,n,!0,i),a=st(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),qu=X({unstack_:function(r,t){t===void 0&&(t=0),t=t||0;var e=j(r,"x","unstack");return W(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length),K.runKernelFunc(function(n){return n.unstack(e,t)},{$x:e},function(n){return{$x:function(){return Ji(n,t)}}})}}),Hb=function(r,t){return Ue(this,void 0,void 0,function(){var e,n,i,o,a,s,u,c,d,p;return je(this,function(f){switch(f.label){case 0:return e=j(r,"x","setdiff1d"),n=j(t,"y","setdiff1d"),W(e.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+n.dtype+")."}),W(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),W(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,e.data()];case 1:return i=f.sent(),[4,n.data()];case 2:for(o=f.sent(),a=new Set(o),s=0,d=0;d<i.length;d++)a.has(i[d])||s++;for(u=new Ac([s],e.dtype),c=new Ac([s],"int32"),d=0,p=0;d<i.length;d++)a.has(i[d])||(u.values[p]=i[d],c.values[p]=d,p++);return[2,[u.toTensor(),c.toTensor()]]}})})};function ug(r,t,e,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(t.slice(0))).push(r[0]/e),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var o=t.length,a=0;a<o;++a)i=i.concat([r[a+1]/t[a],t[a]]);i=i.concat(r.slice(o+1))}return i}function lg(r,t,e){e===void 0&&(e=!0);var n=[];if(e){n.push(t);for(var i=t+1;i<r;++i)i<=2*t?(n.push(i),n.push(i-(t+1))):n.push(i)}else{var o=[],a=[];for(i=1;i<r;++i)i>=2*t+1||i%2==1?a.push(i):o.push(i);n.push.apply(n,o),n.push(0),n.push.apply(n,a)}return n}function cg(r,t,e,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/e):i.push(r[0]*e);for(var o=1;o<r.length;++o)o<=t.length?n?i.push(t[o-1]*r[o]):i.push(r[o]/t[o-1]):i.push(r[o]);return i}function Ak(r,t){for(var e=[0],n=0;n<t;++n)e.push(r[n][0]);return e}function Rk(r,t,e){for(var n=r.slice(0,1),i=0;i<e;++i)n.push(r[i+1]-t[i][0]-t[i][1]);return n}function kk(r,t){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var e=t.shape,n=e[e.length-1],i=1,o=0;o<e.length-1;++o)i*=e[o];var a=r.shape,s=e.slice();s.pop();var u=1;for(o=n;o<r.rank;++o)u*=a[o],s.push(a[o]);var c=zs(r.shape).map(function(d){return d/u}).concat([1]).slice(0,n);return[s,i,u,c]}var Nk=30;function U0(r){return r<=Nk?r:sg(r,Math.floor(Math.sqrt(r)))}function MW(r,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}(function(n,i,o){var a=i.rank>1?i.shape[i.rank-1]:1,s=i.rank>1?i.rank-1:1,u="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+o.shape+", indices.shape: "+i.shape+", shape: "+n+", sliceDim: "+a+", and batchDim: "+s+".";if(o.rank<s)throw new Error(u+" update.rank < "+s+". ");if(n.length<a+(o.rank-s))throw new Error(u+" Output shape length < "+(a+(o.rank-s)));if(o.rank!==s+n.length-a)throw new Error(u+" update.rank != "+(s+n.length-a));for(var c=0;c<s;++c)if(o.shape[c]!==i.shape[c])throw new Error(u+" updates.shape["+c+"] ("+o.shape[c]+") != indices.shape["+c+"] ("+i.shape[c]+").");for(c=0;c<o.rank-s;++c)if(o.shape[c+s]!==n[c+a])throw new Error(u+" updates.shape["+(c+s)+"] ("+o.shape[c+s]+") != shape["+(c+s)+"] ("+n[c+s]+")")})(e,t,r)}function hg(r,t,e){for(var n=t.rank>1?t.shape[t.rank-1]:1,i=e.length,o=1,a=n;a<i;++a)o*=e[a];var s=n<1?1:n;return{sliceRank:n,numUpdates:t.size/s,sliceSize:o,strides:zs(e.slice(0,n)).concat([1]),outputSize:He(e)}}function Dk(r,t,e){W(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+t+" must match the rank of the array ("+r.rank+")."}),W(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."});for(var n=function(o){W(t[o]+e[o]<=r.shape[o],function(){return"Error in slice"+r.rank+"D: begin["+o+"] + size["+o+"] ("+(t[o]+e[o])+") would overflow input.shape["+o+"] ("+r.shape[o]+")"})},i=0;i<r.rank;++i)n(i)}function e1(r){for(var t=[],e=0;r>0;)1&r&&t.push(e),r/=2,e++;return t}function iv(r,t,e){for(var n=[],i=0;i<r.length;i++)n[i]=Math.ceil((t[i]-r[i])/e[i]);return n}function Ok(r,t,e,n,i){var o=t[i],a=e[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=og(0,o,s-1)}function Pk(r,t,e,n,i){var o=t[i],a=e[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=a>0?og(0,o,s):og(-1,o,s-1)}function $b(r,t,e){for(var n=e.length,i=0;i<e.length;i++)if(e[i]>1){n=i;break}for(i=n+1;i<e.length;i++)if(t[i]>0||e[i]!==r[i])return!1;return!0}function Gb(r,t){for(var e=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)e+=r[n]*t[n];return e}var LW=Object.freeze({assertParamsValid:Dk,maskToAxes:e1,computeOutShape:iv,startForAxis:Ok,stopForAxis:Pk,isSliceContinous:$b,computeFlatOffset:Gb});function FW(r){return W(Rs(r),function(){return"The f passed in grad(f) must be a function"}),function(t,e){var n=j(t,"x","tf.grad",null),i=e!=null?j(e,"dy","tf.grad"):null;return K.tidy(function(){var o=K.gradients(function(){return r(n)},[n],i),a=o.value,s=o.grads;return i!=null&&Nt(a.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ov(s),s[0]})}}function zW(r){return W(Rs(r),function(){return"The f passed in grads(f) must be a function"}),function(t,e){W(Array.isArray(t),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=Ld(t,"args","tf.grads",null),i=e!=null?j(e,"dy","tf.grads"):null;return K.tidy(function(){var o=K.gradients(function(){return r.apply(void 0,n)},n,i),a=o.value,s=o.grads;return i!=null&&Nt(a.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ov(s),s})}}function VW(r){return W(Rs(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(t,e){W(t instanceof Ut,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),W(e==null||e instanceof Ut,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=K.gradients(function(){return r(t)},[t],e),i=n.grads,o=n.value;return ov(i),{grad:i[0],value:o}}}function BW(r){return W(Rs(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(t,e){W(Array.isArray(t)&&t.every(function(i){return i instanceof Ut}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),W(e==null||e instanceof Ut,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=K.gradients(function(){return r.apply(void 0,t)},t,e);return e!=null&&Nt(n.value.shape,e.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ov(n.grads),n}}function Mk(r,t){W(Rs(r),function(){return"The f passed in variableGrads(f) must be a function"}),W(t==null||Array.isArray(t)&&t.every(function(d){return d instanceof Dd}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=t!=null;if(!e)for(var n in t=[],K.registeredVariables)t.push(K.registeredVariables[n]);var i=e?t.filter(function(d){return!d.trainable}):null,o=t.length;W((t=t.filter(function(d){return d.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=K.gradients(r,t,null,!0),s=a.value,u=a.grads;W(u.some(function(d){return d!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),W(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return t.forEach(function(d,p){u[p]!=null&&(c[d.name]=u[p])}),i!=null&&i.forEach(function(d){return c[d.name]=null}),{value:s,grads:c}}function Jc(r){return K.customGrad(r)}function ov(r){if(r.filter(function(t){return t==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var nl=X({softmax_:function(r,t){t===void 0&&(t=-1);var e=j(r,"logits","softmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return Jc(function(n,i){var o=n.logSumExp([t],!0),a=n.toFloat().sub(o).exp();return i([a]),{value:a,gradFunc:function(s,u){var c=u[0],d=s.mul(c);return d.sub(d.sum([t],!0).mul(c))}}})(e)}}),av=X({logSoftmax_:function(r,t){t===void 0&&(t=-1);var e=j(r,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Jc(function(n,i){var o=n.max(t,!0),a=n.sub(o),s=a.toFloat().sub(a.exp().sum(t,!0).log());return i([s]),{value:s,gradFunc:function(u,c){var d=c[0].exp();return u.sub(u.sum(t,!0).mul(d))}}})(e)}}),Kb=function(){function r(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},r.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},r.prototype.has=function(t){return this.data.has(t)},r.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),Xb=function(){function r(){}return r.prototype.time=function(t){return ce()},r.prototype.read=function(t){return ce()},r.prototype.readSync=function(t){return ce()},r.prototype.numDataIds=function(){return ce()},r.prototype.disposeData=function(t){return ce()},r.prototype.fromPixels=function(t,e){return ce()},r.prototype.write=function(t,e,n){return ce()},r.prototype.move=function(t,e,n,i){return ce()},r.prototype.memory=function(){return ce()},r.prototype.floatPrecision=function(){return ce()},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(t,e,n,i){return ce()},r.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,ce()},r.prototype.slice=function(t,e,n){return ce()},r.prototype.stridedSlice=function(t,e,n,i){return ce()},r.prototype.unstack=function(t,e){return ce()},r.prototype.reverse=function(t,e){return ce()},r.prototype.concat=function(t,e){return ce()},r.prototype.neg=function(t){return ce()},r.prototype.add=function(t,e){return ce()},r.prototype.addN=function(t){return ce()},r.prototype.subtract=function(t,e){return ce()},r.prototype.multiply=function(t,e){return ce()},r.prototype.realDivide=function(t,e){return ce()},r.prototype.floorDiv=function(t,e){return ce()},r.prototype.sum=function(t,e){return ce()},r.prototype.prod=function(t,e){return ce()},r.prototype.unsortedSegmentSum=function(t,e,n){return ce()},r.prototype.argMin=function(t,e){return ce()},r.prototype.argMax=function(t,e){return ce()},r.prototype.equal=function(t,e){return ce()},r.prototype.notEqual=function(t,e){return ce()},r.prototype.less=function(t,e){return ce()},r.prototype.lessEqual=function(t,e){return ce()},r.prototype.greater=function(t,e){return ce()},r.prototype.greaterEqual=function(t,e){return ce()},r.prototype.logicalNot=function(t){return ce()},r.prototype.logicalAnd=function(t,e){return ce()},r.prototype.logicalOr=function(t,e){return ce()},r.prototype.where=function(t){return ce()},r.prototype.select=function(t,e,n){return ce()},r.prototype.topk=function(t,e,n){return ce()},r.prototype.min=function(t,e){return ce()},r.prototype.minimum=function(t,e){return ce()},r.prototype.mod=function(t,e){return ce()},r.prototype.max=function(t,e){return ce()},r.prototype.maximum=function(t,e){return ce()},r.prototype.all=function(t,e){return ce()},r.prototype.any=function(t,e){return ce()},r.prototype.squaredDifference=function(t,e){return ce()},r.prototype.ceil=function(t){return ce()},r.prototype.floor=function(t){return ce()},r.prototype.round=function(t){return ce()},r.prototype.sign=function(t){return ce()},r.prototype.isNaN=function(t){return ce()},r.prototype.isInf=function(t){return ce()},r.prototype.isFinite=function(t){return ce()},r.prototype.pow=function(t,e){return ce()},r.prototype.exp=function(t){return ce()},r.prototype.expm1=function(t){return ce()},r.prototype.log=function(t){return ce()},r.prototype.log1p=function(t){return ce()},r.prototype.sqrt=function(t){return ce()},r.prototype.rsqrt=function(t){return ce()},r.prototype.square=function(t){return ce()},r.prototype.reciprocal=function(t){return ce()},r.prototype.relu=function(t){return ce()},r.prototype.relu6=function(t){return ce()},r.prototype.prelu=function(t,e){return ce()},r.prototype.elu=function(t){return ce()},r.prototype.eluDer=function(t,e){return ce()},r.prototype.selu=function(t){return ce()},r.prototype.int=function(t){return ce()},r.prototype.clip=function(t,e,n){return ce()},r.prototype.abs=function(t){return ce()},r.prototype.complexAbs=function(t){return ce()},r.prototype.sigmoid=function(t){return ce()},r.prototype.softplus=function(t){return ce()},r.prototype.sin=function(t){return ce()},r.prototype.cos=function(t){return ce()},r.prototype.tan=function(t){return ce()},r.prototype.asin=function(t){return ce()},r.prototype.acos=function(t){return ce()},r.prototype.atan=function(t){return ce()},r.prototype.atan2=function(t,e){return ce()},r.prototype.sinh=function(t){return ce()},r.prototype.cosh=function(t){return ce()},r.prototype.tanh=function(t){return ce()},r.prototype.asinh=function(t){return ce()},r.prototype.acosh=function(t){return ce()},r.prototype.atanh=function(t){return ce()},r.prototype.erf=function(t){return ce()},r.prototype.step=function(t,e){return ce()},r.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,ce()},r.prototype.conv2d=function(t,e,n){return ce()},r.prototype.conv2dDerInput=function(t,e,n){return ce()},r.prototype.conv2dDerFilter=function(t,e,n){return ce()},r.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,ce()},r.prototype.depthwiseConv2D=function(t,e,n){return ce()},r.prototype.depthwiseConv2DDerInput=function(t,e,n){return ce()},r.prototype.depthwiseConv2DDerFilter=function(t,e,n){return ce()},r.prototype.conv3d=function(t,e,n){return ce()},r.prototype.conv3dDerInput=function(t,e,n){return ce()},r.prototype.conv3dDerFilter=function(t,e,n){return ce()},r.prototype.maxPool=function(t,e){return ce()},r.prototype.maxPoolBackprop=function(t,e,n,i){return ce()},r.prototype.avgPool=function(t,e){return ce()},r.prototype.avgPoolBackprop=function(t,e,n){return ce()},r.prototype.avgPool3d=function(t,e){return ce()},r.prototype.avgPool3dBackprop=function(t,e,n){return ce()},r.prototype.maxPool3d=function(t,e){return ce()},r.prototype.maxPool3dBackprop=function(t,e,n,i){return ce()},r.prototype.reshape=function(t,e){return ce()},r.prototype.cast=function(t,e){return ce()},r.prototype.tile=function(t,e){return ce()},r.prototype.pad=function(t,e,n){return ce()},r.prototype.transpose=function(t,e){return ce()},r.prototype.gather=function(t,e,n){return ce()},r.prototype.gatherND=function(t,e){return ce()},r.prototype.scatterND=function(t,e,n){return ce()},r.prototype.batchToSpaceND=function(t,e,n){return ce()},r.prototype.spaceToBatchND=function(t,e,n){return ce()},r.prototype.resizeBilinear=function(t,e,n,i){return ce()},r.prototype.resizeBilinearBackprop=function(t,e,n){return ce()},r.prototype.resizeNearestNeighbor=function(t,e,n,i){return ce()},r.prototype.resizeNearestNeighborBackprop=function(t,e,n){return ce()},r.prototype.batchNormalization=function(t,e,n,i,o,a){return ce()},r.prototype.localResponseNormalization4D=function(t,e,n,i,o){return ce()},r.prototype.LRNGrad=function(t,e,n,i,o,a,s){return ce()},r.prototype.multinomial=function(t,e,n,i){return ce()},r.prototype.oneHot=function(t,e,n,i){return ce()},r.prototype.cumsum=function(t,e,n,i){return ce()},r.prototype.nonMaxSuppression=function(t,e,n,i,o){return ce()},r.prototype.fft=function(t){return ce()},r.prototype.ifft=function(t){return ce()},r.prototype.complex=function(t,e){return ce()},r.prototype.real=function(t){return ce()},r.prototype.imag=function(t){return ce()},r.prototype.cropAndResize=function(t,e,n,i,o,a){return ce()},r.prototype.depthToSpace=function(t,e,n){return ce()},r.prototype.split=function(t,e,n){return ce()},r.prototype.sparseToDense=function(t,e,n,i){return ce()},r.prototype.diag=function(t){return ce()},r.prototype.fill=function(t,e,n){throw new Error("Not yet implemented.")},r.prototype.onesLike=function(t){return ce()},r.prototype.zerosLike=function(t){return ce()},r.prototype.linspace=function(t,e,n){return ce()},r.prototype.dispose=function(){return ce()},r}();function ce(){throw new Error("Not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Tu(r,t){for(var e=r.length,n=[],i=0;i<e;i++){var o=e-1-i,a=r[o]||1;(t[t.length-1-i]||1)>1&&a===1&&n.unshift(o)}return n}function kn(r,t){for(var e=[],n=0;n<t.length;n++){var i=r[r.length-n-1],o=t.length-n-1,a=t[o];(i==null||i===1&&a>1)&&e.unshift(o)}return e}function xt(r,t){for(var e=[],n=Math.max(r.length,t.length),i=0;i<n;i++){var o=r[r.length-i-1];o==null&&(o=1);var a=t[t.length-i-1];if(a==null&&(a=1),o===1)e.unshift(a);else if(a===1)e.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+r+" and "+t+".");e.unshift(o)}}return e}function kc(r,t,e,n,i,o,a){a===void 0&&(a="channelsLast");var s,u=dg(t),c=u[0],d=u[1];if(a==="channelsLast")s=[c,d,r[3],r[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[c,d,r[1],r[1]]}return Us(r,s,e,n,i,o,!1,a)}function Fd(r,t,e,n,i,o,a){a===void 0&&(a="NDHWC");var s,u,c=t1(t),d=c[0],p=c[1],f=c[2];if(a==="NDHWC")u="channelsLast",s=[d,p,f,r[4],r[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[d,p,f,r[1],r[1]]}return zd(r,s,e,n,i,!1,u,o)}function Us(r,t,e,n,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],d=u[1],p=u[2],f=u[3];if(s==="channelsLast")c=r[0],d=r[1],p=r[2],f=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=r[0],f=r[1],d=r[2],p=r[3]}var g,y=t[0],x=t[1],b=t[3],_=dg(e),C=_[0],T=_[1],D=dg(n),O=D[0],z=D[1],I=fc(y,O),S=fc(x,z),A=function(G,Z,Y,ee,H,ie,J,q){var ne,me,Ce;if(typeof G=="number"){var Te=G===0?"VALID":"NUMBER";ne={top:G,bottom:G,left:G,right:G,type:Te};var Re=function(ht,et,Dt,_t,vn){_t==null&&(_t=Qb(ht,et,Dt));var lr=ht[0],dn=ht[1],sn=vd((lr-et+2*_t)/Dt+1,vn);W(mn(sn),function(){return"The output # of rows ("+sn+") must be an integer. Change the stride and/or zero pad parameters"});var Ht=vd((dn-et+2*_t)/Dt+1,vn);return W(mn(Ht),function(){return"The output # of columns ("+Ht+") must be an integer. Change the stride and/or zero pad parameters"}),[sn,Ht]}([Z,Y],ie,ee,G,q);me=Re[0],Ce=Re[1]}else if(G==="same"){me=Math.ceil(Z/ee),Ce=Math.ceil(Y/H);var De=Math.max(0,(me-1)*ee+ie-Z),Oe=Math.max(0,(Ce-1)*H+J-Y),ze=Math.floor(De/2),ct=De-ze,Ze=Math.floor(Oe/2),wt=Oe-Ze;ne={top:ze,bottom:ct,left:Ze,right:wt,type:"SAME"}}else{if(G!=="valid")throw Error("Unknown padding parameter: "+G);ne={top:0,bottom:0,left:0,right:0,type:"VALID"},me=Math.ceil((Z-ie+1)/ee),Ce=Math.ceil((Y-J+1)/H)}return{padInfo:ne,outHeight:me,outWidth:Ce}}(i,d,p,C,T,I,S,o),N=A.padInfo,P=A.outHeight,M=A.outWidth,F=a?b*f:b;return s==="channelsFirst"?g=[c,F,P,M]:s==="channelsLast"&&(g=[c,P,M,F]),{batchSize:c,dataFormat:s,inHeight:d,inWidth:p,inChannels:f,outHeight:P,outWidth:M,outChannels:F,padInfo:N,strideHeight:C,strideWidth:T,filterHeight:y,filterWidth:x,effectiveFilterHeight:I,effectiveFilterWidth:S,dilationHeight:O,dilationWidth:z,inShape:r,outShape:g,filterShape:t}}function zd(r,t,e,n,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],d=u[1],p=u[2],f=u[3],g=u[4];if(a==="channelsLast")c=r[0],d=r[1],p=r[2],f=r[3],g=r[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=r[0],g=r[1],d=r[2],p=r[3],f=r[4]}var y,x=t[0],b=t[1],_=t[2],C=t[4],T=t1(e),D=T[0],O=T[1],z=T[2],I=t1(n),S=I[0],A=I[1],N=I[2],P=fc(x,S),M=fc(b,A),F=fc(_,N),G=function(J,q,ne,me,Ce,Te,Re,De,Oe,ze,ct){var Ze,wt,ht,et;if(typeof J=="number"){var Dt=J===0?"VALID":"NUMBER";Ze={top:J,bottom:J,left:J,right:J,front:J,back:J,type:Dt};var _t=function(bt,Lt,Dn,tn,cr,Wn){cr==null&&(cr=Qb(bt,Lt,tn));var Ti=bt[0],zo=bt[1],Vo=bt[2],Ai=vd((Ti-Lt+2*cr)/tn+1,Wn);W(mn(Ai),function(){return"The output # of depths ("+Ai+") must be an integer. Change the stride and/or zero pad parameters"});var Bo=vd((zo-Lt+2*cr)/tn+1,Wn);W(mn(Bo),function(){return"The output # of rows ("+Bo+") must be an integer. Change the stride and/or zero pad parameters"});var Uo=vd((Vo-Lt+2*cr)/tn+1,Wn);return W(mn(Uo),function(){return"The output # of columns ("+Uo+") must be an integer. Change the stride and/or zero pad parameters"}),[Ai,Bo,Uo,Dn]}([q,ne,me,1],De,1,Ce,J,ct);wt=_t[0],ht=_t[1],et=_t[2]}else if(J==="same"){wt=Math.ceil(q/Ce),ht=Math.ceil(ne/Te),et=Math.ceil(me/Re);var vn=(wt-1)*Ce+De-q,lr=(ht-1)*Te+Oe-ne,dn=(et-1)*Re+ze-me,sn=Math.floor(vn/2),Ht=vn-sn,jn=Math.floor(lr/2),at=lr-jn,En=Math.floor(dn/2),Qt=dn-En;Ze={top:jn,bottom:at,left:En,right:Qt,front:sn,back:Ht,type:"SAME"}}else{if(J!=="valid")throw Error("Unknown padding parameter: "+J);Ze={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},wt=Math.ceil((q-De+1)/Ce),ht=Math.ceil((ne-Oe+1)/Te),et=Math.ceil((me-ze+1)/Re)}return{padInfo:Ze,outDepth:wt,outHeight:ht,outWidth:et}}(i,d,p,f,D,O,z,P,M,F,s),Z=G.padInfo,Y=G.outDepth,ee=G.outHeight,H=G.outWidth,ie=o?C*g:C;return a==="channelsFirst"?y=[c,ie,Y,ee,H]:a==="channelsLast"&&(y=[c,Y,ee,H,ie]),{batchSize:c,dataFormat:a,inDepth:d,inHeight:p,inWidth:f,inChannels:g,outDepth:Y,outHeight:ee,outWidth:H,outChannels:ie,padInfo:Z,strideDepth:D,strideHeight:O,strideWidth:z,filterDepth:x,filterHeight:b,filterWidth:_,effectiveFilterDepth:P,effectiveFilterHeight:M,effectiveFilterWidth:F,dilationDepth:S,dilationHeight:A,dilationWidth:N,inShape:r,outShape:y,filterShape:t}}function Qb(r,t,e,n){n===void 0&&(n=1);var i=fc(t,n);return Math.floor((r[0]*(e-1)-e+i)/2)}function dg(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function t1(r){return typeof r=="number"?[r,r,r]:r}function fc(r,t){return t<=1?r:r+(r-1)*(t-1)}function vd(r,t){if(!t)return r;switch(t){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+t)}}function Hu(r){var t=dg(r),e=t[0],n=t[1],i=t[2];return e===1&&n===1&&i===1}function Ar(r,t){return Hu(r)||Hu(t)}function sv(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Yb(r,t,e){if(t==="complex64"){if(r.dtype==="complex64")return r.clone();var n=zt(r.shape),i=r.toFloat(),o=e.complex(i,n);return n.dispose(),i.dispose(),o}if(!OR(r.dtype,t))return K.makeTensorFromDataId(r.dataId,r.shape,t);if(r.dtype==="complex64"){var a=e.real(r);return o=a.cast(t),a.dispose(),o}if(t==="int32")return e.int(r);if(t==="bool"){var s=Ve(0,r.dtype);return o=e.notEqual(r,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+t)}function pg(r,t){return K.makeTensorFromDataId(r.dataId,t,r.dtype)}function Jb(r,t,e){var n=(t-r)/(e-1),i=Qc(e,"float32");i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return $r(i,"float32")}var UW=Object.freeze({castTensor:Yb,reshapeTensor:pg,linspaceImpl:Jb,upcastType:Tn,axesAreInnerMostDims:Ob,combineLocations:mk,computeOutAndReduceShapes:ir,expandShapeToKeepDim:li,assertAxesAreInnerMostDims:Ur,getAxesPermutation:no,getUndoAxesPermutation:Yg,getInnerMostAxes:ro,getBroadcastDims:Tu,getReductionAxes:kn,assertAndGetBroadcastShape:xt,assertParamsConsistent:gk,computeOutShape:Wu,computePool2DInfo:kc,computePool3DInfo:Fd,computeConv2DInfo:Us,computeConv3DInfo:zd,computeDefaultPad:Qb,tupleValuesAreOne:Hu,eitherStridesOrDilationsAreOne:Ar,convertConv2DDataFormat:sv});function n1(r,t){if(r.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+t.length+".");for(var e=new Float32Array(2*r.length),n=0;n<e.length;n+=2)e[n]=r[n/2],e[n+1]=t[n/2];return e}function ES(r,t){return{real:r[2*t],imag:r[2*t+1]}}function jW(r,t,e,n){r[2*n]=t,r[2*n+1]=e}function WW(r,t,e){var n=(e?2:-2)*Math.PI*(r/t);return{real:Math.cos(n),imag:Math.sin(n)}}function Zb(r,t,e,n,i){for(var o=Array.from(t).map(function(g,y){return{score:g,boxIndex:y}}).filter(function(g){return g.score>i}).sort(function(g,y){return y.score-g.score}),a=[],s=0;s<o.length;s++){var u=o[s],c=u.score,d=u.boxIndex;if(c<i)break;for(var p=!1,f=a.length-1;f>=0;--f)if(qW(r,d,a[f])>=n){p=!0;break}if(!p&&(a.push(d),a.length>=e))break}return $r(a,"int32")}function qW(r,t,e){var n=r.subarray(4*t,4*t+4),i=r.subarray(4*e,4*e+4),o=Math.min(n[0],n[2]),a=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(i[0],i[2]),d=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),g=(s-o)*(u-a),y=(p-c)*(f-d);if(g<=0||y<=0)return 0;var x=Math.max(o,c),b=Math.max(a,d),_=Math.min(s,p),C=Math.min(u,f),T=Math.max(_-x,0)*Math.max(C-b,0);return T/(g+y-T)}function Lk(r,t,e){var n=new Array(r.rank).fill(0),i=r.shape.slice();return t.map(function(o){i[e]=o;var a=r.slice(n,i);return n[e]+=o,a})}function Fk(r,t){for(var e=new Array(r.rank),n=0;n<e.length;n++)e[n]=r.shape[n]*t[n];var i=st(e,r.dtype);for(n=0;n<i.values.length;++n){for(var o=i.indexToLoc(n),a=new Array(r.rank),s=0;s<a.length;s++)a[s]=o[s]%r.shape[s];var u=r.locToIndex(a);i.values[n]=r.values[u]}return i.toTensor()}function zk(r,t,e,n,i){for(var o=t[t.length-1],a=[r.length/o,o],s=a[0],u=a[1],c=Rd(e,s*n),d=Rd("int32",s*n),p=0;p<s;p++){for(var f=p*u,g=r.subarray(f,f+u),y=[],x=0;x<g.length;x++)y.push({value:g[x],index:x});y.sort(function(D,O){return O.value-D.value});var b=p*n,_=c.subarray(b,b+n),C=d.subarray(b,b+n);for(x=0;x<n;x++)_[x]=y[x].value,C[x]=y[x].index}var T=t.slice();return T[T.length-1]=n,[xn(c,T,e),xn(d,T,"int32")]}function ex(r,t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(n);var i=st(r,"int32"),o=st([e.length,r.length],"int32");for(n=0;n<e.length;n++){var a=i.indexToLoc(e[n]),s=n*r.length;o.values.set(a,s)}return o.toTensor()}var HW=function(){return function(r,t){this.outputShape=[],this.outputShape=r,this.variableNames=t.map(function(i,o){return"T"+o});var e=[];this.variableNames.forEach(function(i){e.push("float v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `}}(),$W=function(){return function(r,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=t.map(function(i,o){return"T"+o});var e=[];this.variableNames.forEach(function(i){e.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `}}(),GW=function(){return function(r,t,e){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,o=r.inSize,a=Math.ceil(o/n);e||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=t==="max"?">":"<",u=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}();function Vk(r,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return r+"."+e})}function qr(r,t){return t===1?[r]:Vk(r,t)}function yr(){var r,t,e,n,i,o,a,s,u,c;return he().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",t="in",e="out",n="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",t="attribute",e="varying",n="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:t,varyingVs:e,varyingFs:n,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Au(r,t,e){e===void 0&&(e="index");var n=zs(t);return n.map(function(i,o){return"int "+r[o]+" = "+e+" / "+i+"; "+(o===n.length-1?"int "+r[o+1]+" = "+e+" - "+r[o]+" * "+i:"index -= "+r[o]+" * "+i)+";"}).join("")}function tx(r){var t=zs(r).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var Bk=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function KW(r,t,e,n){var i=[];r.forEach(function(g){var y=He(g.shapeInfo.logicalShape);g.shapeInfo.isUniform?i.push("uniform float "+g.name+(y>1?"["+y+"]":"")+";"):(i.push("uniform sampler2D "+g.name+";"),i.push("uniform int offset"+g.name+";"))});var o,a,s=i.join(`
`),u=r.map(function(g){return function(y,x,b){b===void 0&&(b=!1);var _="";_+=b?Uk(y):ic(y);var C=y.shapeInfo.logicalShape,T=x.logicalShape;return C.length<=T.length&&(_+=b?function(D,O){var z,I=D.name,S=I.charAt(0).toUpperCase()+I.slice(1),A="get"+S+"AtOutCoords",N=D.shapeInfo.logicalShape.length,P=O.logicalShape.length,M=Tu(D.shapeInfo.logicalShape,O.logicalShape),F=Xt(P),G=P-N,Z=["x","y","z","w","u","v"];z=N===0?"":P<2&&M.length>=1?"coords = 0;":M.map(function(ne){return"coords."+Z[ne+G]+" = 0;"}).join(`
`);var Y="";Y=P<2&&N>0?"coords":D.shapeInfo.logicalShape.map(function(ne,me){return"coords."+Z[me+G]}).join(", ");var ee="return outputValue;",H=He(D.shapeInfo.logicalShape)===1,ie=He(O.logicalShape)===1;if(N!==1||H||ie){if(H&&!ie)ee=P===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(M.length){var J=N-2,q=N-1;M.indexOf(J)>-1&&M.indexOf(q)>-1?ee="return vec4(outputValue.x);":M.indexOf(J)>-1?ee="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":M.indexOf(q)>-1&&(ee="return vec4(outputValue.xx, outputValue.zz);")}}else ee=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+A+`() {
      `+F+` coords = getOutputCoords();
      `+z+`
      vec4 outputValue = get`+S+"("+Y+`);
      `+ee+`
    }
  `}(y,x):function(D,O){var z=D.name,I=z.charAt(0).toUpperCase()+z.slice(1),S="get"+I+"AtOutCoords",A=O.texShape,N=D.shapeInfo.texShape,P=D.shapeInfo.logicalShape.length,M=O.logicalShape.length;if(!D.shapeInfo.isUniform&&P===M&&D.shapeInfo.flatOffset==null&&Qn(N,A))return`
      float `+S+`() {
        return sampleTexture(`+z+`, resultUV);
      }
    `;var F,G=Xt(M),Z=Tu(D.shapeInfo.logicalShape,O.logicalShape),Y=M-P,ee=["x","y","z","w","u","v"];F=P===0?"":M<2&&Z.length>=1?"coords = 0;":Z.map(function(ie){return"coords."+ee[ie+Y]+" = 0;"}).join(`
`);var H="";return H=M<2&&P>0?"coords":D.shapeInfo.logicalShape.map(function(ie,J){return"coords."+ee[J+Y]}).join(", "),`
    float `+S+`() {
      `+G+` coords = getOutputCoords();
      `+F+`
      return get`+I+"("+H+`);
    }
  `}(y,x)),_}(g,t,n)}).join(`
`),c=t.texShape,d=yr(),p=function(g){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+g.texture2D+`(textureSampler, uv).r;
    }
  `}(d),f=function(g){return g.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+g.varyingFs+` vec2 resultUV;
    `+g.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+g.defineSpecialNaN+`
    `+g.defineSpecialInf+`
    `+g.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+XW+`
    `+QW+`
    `+YW+`
  `}(d);return t.isPacked?(o=function(g,y){switch(g.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(D,O){var z=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];return z[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+z[1]+`.0);
      }
    `:z[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+z[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+z[0]+", "+z[1]+`));
      return 2 * (resTexRC.x * `+z[1]+` + resTexRC.y);
    }
  `}(0,y);case 2:return function(D,O){var z=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];if(Qn(D,O))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+z[0]+", "+z[1]+`));
      }
    `;var I=Math.ceil(D[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+z[0]+", "+z[1]+`));

      int index = resTexRC.x * `+z[1]+` + resTexRC.y;
      int r = 2 * (index / `+I+`);
      int c = imod(index, `+I+`) * 2;

      return ivec2(r, c);
    }
  `}(g,y);case 3:return x=g,b=y,_=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],C=Math.ceil(x[2]/2),T=C*Math.ceil(x[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      int b = index / `+T+`;
      index -= b * `+T+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(D,O){for(var z=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)],I=Math.ceil(D[D.length-1]/2),S=I*Math.ceil(D[D.length-2]/2),A=S,N="",P="b, r, c",M=2;M<D.length-1;M++)A*=D[D.length-M-1],N=`
      int b`+M+" = index / "+A+`;
      index -= b`+M+" * "+A+`;
    `+N,P="b"+M+", "+P;return`
    ivec`+D.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+z[0]+", "+z[1]+`));
      int index = resTexRC.x * `+z[1]+` + resTexRC.y;

      `+N+`

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+I+`);
      int c = imod(index, `+I+`) * 2;

      return ivec`+D.length+"("+P+`);
    }
  `}(g,y)}var x,b,_,C,T}(t.logicalShape,c),a=function(g){return`
    void setOutput(vec4 val) {
      `+g.output+` = val;
    }
  `}(d)):(o=function(g,y){switch(g.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(_,C){return C[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return resTexRC.x * `+C[1]+` + resTexRC.y;
    }
  `}(0,y);case 2:return function(_,C){return Qn(_,C)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `:_[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:_[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = index / `+_[1]+`;
      int c = index - r * `+_[1]+`;
      return ivec2(r, c);
    }
  `}(g,y);case 3:return x=y,b=Au(["r","c","d"],g),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+b+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(_,C){var T=Au(["r","c","d","d2"],_);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      `+T+`
      return ivec4(r, c, d, d2);
    }
  `}(g,y);case 5:return function(_,C){var T=Au(["r","c","d","d2","d3"],_);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+C[0]+`,
                             `+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+T+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(g,y);case 6:return function(_,C){var T=Au(["r","c","d","d2","d3","d4"],_);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+T+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(g,y);default:throw new Error(g.length+"-D output sampling is not yet supported")}var x,b}(t.logicalShape,c),a=function(g){return`
    void setOutput(float val) {
      `+g.output+` = vec4(val, 0, 0, 0);
    }
  `}(d)),n&&(f+=JW),[f,p,a,s,o,u,e].join(`
`)}function ic(r){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var o=e.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=e.shapeInfo.texShape,c=u[0],d=u[1],p=gu(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+c+", "+d+", "+p+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(e){var n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Yl(e)+`
      }
    `;var o=e.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=gu(n);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(e){var n=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=e.shapeInfo.texShape;if(a!=null&&Qn(n,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var c=ls(n),d=c.newShape,p=c.keptDims,f=d;if(f.length<n.length){var g=oc(e,f);return`
      `+ic(g)+`
      float `+o+`(int row, int col) {
        return `+o+"("+ac(["row","col"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+Yl(e)+`
      }
    `;var y=a[0],x=a[1],b=gu(i);return x===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+b+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+y+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:y===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+b+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+x+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+b+`;
    vec2 uv = uvFromFlat(`+y+", "+x+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(r);case 3:return function(e){var n=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[1]*n[2],s=n[2],u=ls(n),c=u.newShape,d=u.keptDims,p=c;if(p.length<n.length){var f=oc(e,p);return`
        `+ic(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+ac(["row","col","depth"],d)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Yl(e)+`
      }
    `;var g=e.shapeInfo.texShape,y=g[0],x=g[1],b=e.shapeInfo.flatOffset;if(x===a&&b==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+x+".0, "+y+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(x===s&&b==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+x+".0, "+y+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var _=gu(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+_+`;
        vec2 uv = uvFromFlat(`+y+", "+x+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(r);case 4:return function(e){var n=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[3],s=n[2]*a,u=n[1]*s,c=ls(n),d=c.newShape,p=c.keptDims;if(d.length<n.length){var f=oc(e,d);return`
      `+ic(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+ac(["row","col","depth","depth2"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Yl(e)+`
      }
    `;var g=e.shapeInfo.flatOffset,y=e.shapeInfo.texShape,x=y[0],b=y[1];if(b===u&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+x+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(b===a&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+x+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=gu(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+x+", "+b+", index + "+_+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 5:return function(e){var n=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[4],s=n[3]*a,u=n[2]*s,c=n[1]*u,d=ls(n),p=d.newShape,f=d.keptDims;if(p.length<n.length){var g=oc(e,p);return`
      `+ic(g)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+ac(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Yl(e)+`
      }
    `;var y=e.shapeInfo.flatOffset,x=e.shapeInfo.texShape,b=x[0],_=x[1];if(_===c&&y==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+b+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(_===a&&y==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+b+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var C=gu(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+C+`;
      vec2 uv = uvFromFlat(`+b+", "+_+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 6:return function(e){var n=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=ls(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var c=oc(e,s);return`
      `+ic(c)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+ac(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var d=n[5],p=n[4]*d,f=n[3]*p,g=n[2]*f,y=n[1]*g;if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+y+", "+g+", "+f+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+d+`, 1)));
        `+Yl(e)+`
      }
    `;var x=e.shapeInfo.flatOffset,b=e.shapeInfo.texShape,_=b[0],C=b[1];if(C===y&&x==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+g+", "+f+", "+p+", "+d+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+_+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(C===d&&x==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+_+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var T=gu(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+y+" + col * "+g+" + depth * "+f+` +
          depth2 * `+p+" + depth3 * "+d+" + depth4 + "+T+`;
      vec2 uv = uvFromFlat(`+_+", "+C+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Uk(r){var t,e,n;switch(r.shapeInfo.logicalShape.length){case 0:return t=r.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),n=yr(),`
    vec4 `+e+`() {
      return `+n.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=yr();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+o+`, uv);
    }
  `}(r);case 2:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=u[0],d=u[1],p=yr();if(u!=null&&Qn(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+d+".0, "+c+`.0);

        return `+p.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],g=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+g+", "+f[0]+", "+f[1]+`, row, col);
      return `+p.texture2D+"("+a+`, uv);
    }
  `}(r);case 3:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var d=o.slice(1),p=oc(i,d);return`
        `+Uk(p)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+ac(["b","row","col"],[1,2])+`);
        }
      `}var f=c[0],g=c[1],y=Math.ceil(o[2]/2),x=y*Math.ceil(o[1]/2),b=yr();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+g+", "+x+", "+y+`, b, row, col);
      return `+b.texture2D+"("+a+`, uv);
    }
  `}(r);default:return function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,d=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],p=d[0],f=d[1],g=Math.ceil(o[a-1]/2),y=g*Math.ceil(o[a-2]/2),x="int b, int row, int col",b="b * "+y+" + (row / 2) * "+g+" + (col / 2)",_=2;_<a-1;_++)x="int b"+_+", "+x,y*=o[a-_-1],b="b"+_+" * "+y+" + "+b;var C=yr();return`
    vec4 `+u+"("+x+`) {
      int index = `+b+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+p+`);
      return `+C.texture2D+"("+s+`, uv);
    }
  `}(r)}}var XW=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,QW=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,YW=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,JW=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function gu(r){return"offset"+r}function Yl(r){var t=r.name,e=He(r.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Xt(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function oc(r,t){var e=JSON.parse(JSON.stringify(r));return e.shapeInfo.logicalShape=t,e}function ac(r,t){return t.map(function(e){return r[e]}).join(", ")}var ZW=function(){return function(r,t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,W(r.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var i=r[r.length-1],o=Math.ceil(i/t);this.outputShape=r.slice(0,-1),o>1&&this.outputShape.push(o),n||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,d=Xt(c),p=qr("coords",c);if(o===1){var f=Xt(s=c+1);a=`
        `+f+" sourceLocR = "+f+"("+p.join()+`, 0);
        ++`+p[c-1]+`;
        `+f+" sourceLocG = "+f+"("+p.join()+`, 0);
        ++`+p[c-2]+`;
        `+f+" sourceLocA = "+f+"("+p.join()+`, 0);
        --`+p[c-1]+`;
        `+f+" sourceLocB = "+f+"("+p.join()+`, 0);
        --`+p[c-2]+";"}else s=c,a=`
        `+d+` sourceLocR = coords;
        ++`+p[c-1]+`;
        `+d+` sourceLocG = coords;
        ++`+p[c-2]+`;
        `+d+` sourceLocA = coords;
        --`+p[c-1]+`;
        `+d+` sourceLocB = coords;
        --`+p[c-2]+";";var g=["x","y","z","w","u","v"].slice(0,s),y="."+g[s-1],x=g.map(function(S){return"int "+S}),b=qr("sourceLocR",s-1).concat("inIdx.r"),_=qr("sourceLocG",s-1).concat("inIdx.g"),C=qr("sourceLocB",s-1).concat("inIdx.b"),T=qr("sourceLocA",s-1).concat("inIdx.a"),D=e==="max"?"greaterThan":"lessThan",O=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+_.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+T.join()+")));",z=`vec4(
            getAChannel(`+b.join()+`),
            hasNextCol ? getAChannel(`+_.join()+`) : 0.,
            hasNextRow ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+T.join()+") : 0.)",I=n?"":`
      float getBestIndicesAChannel(`+x.join()+`) {
        return getChannel(getBestIndicesA(`+g.join()+`),
                                          vec2(`+g.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+x.join()+`) {
        return getChannel(getA(`+g.join()+`),
                               vec2(`+g.slice(-2).join()+`));
      }
      `+I+`
      void main() {
        `+d+` coords = getOutputCoords();
        bool hasNextCol = `+p[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+p[c-2]+" < "+(u[c-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+y+", sourceLocG"+y+`,
          sourceLocB`+y+", sourceLocA"+y+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+z+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+O+`
          vec4 candidate = `+z+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+D+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}(),e6=function(){return function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterHeight,u=r.effectiveFilterWidth,c=s-1-r.padInfo.top,d=u-1-r.padInfo.left,p=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}(),t6=function(){return function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,g=d-1-r.padInfo.front,y=p-1-r.padInfo.top,x=f-1-r.padInfo.left,b=1/(t*e*n);this.userCode=`
      const ivec3 pads = ivec3(`+g+", "+y+", "+x+`);
      const float avgMultiplier = float(`+b+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),n6=function(){return function(r,t,e,n,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],xt(r,t),xt(r,e);var a="0.0";n!=null&&(xt(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(xt(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),r6=function(){return function(r,t,e,n,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xt(r,t),xt(r,e);var a="vec4(0.0)";n!=null&&(xt(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(xt(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),i6="return areal * breal - aimag * bimag;",o6="return areal * bimag + aimag * breal;",IS=function(){return function(r,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xt(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),j0="return a + b;",W0="return a - b;",CS="return a * b;",jk="return (a < 0.) ? b * a : a;",fn=function(){return function(r,t,e){this.variableNames=["A","B"],this.outputShape=xt(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),Wk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,ra=function(){return function(r,t,e,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xt(t,e);var i=this.outputShape.length,o="";if(n)if(i===0||He(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Xt(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=qr("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `}}(),a6=function(){function r(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(n.minLoc,t),i.gl.uniform1f(n.maxLoc,e)}},r}(),s6=function(){function r(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(n.minLoc,t),i.gl.uniform1f(n.maxLoc,e)}},r}(),u6=function(){return function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),l6=function(){return function(r){this.outputShape=[],this.outputShape=Wu(r,1),this.variableNames=r.map(function(s,u){return"T"+u});var t=new Array(r.length-1);t[0]=r[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+r[e][1];var n=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var i=t[e-1];n.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+i+"));")}var o=t.length,a=t[t.length-1];n.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `}}(),c6=function(){return function(r,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Wu(r,t);var e=this.outputShape,n=e.length,i=Xt(n),o=qr("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(b,_){return"T"+_});var s=new Array(r.length-1);s[0]=r[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][t];var c=a[t],d=a.slice(-2),p=a.join(),f="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+d.join()+`));
        }`;for(u=1;u<s.length;u++){var g=s[u-1];f+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Zf(a,c,g)+`),
            vec2(`+Zf(d,c,g)+`));
        }`}var y=s.length,x=s[s.length-1];f+=`
        return getChannel(
          getT`+y+"("+Zf(a,c,x)+`),
          vec2(`+Zf(d,c,x)+"));",this.userCode=`
      float getValue(`+a.map(function(b){return"int "+b})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[n-1]+" = "+o[n-1]+` + 1;
        if (`+o[n-1]+" < "+e[n-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[n-2]+" = "+o[n-2]+` + 1;
        if (`+o[n-2]+" < "+e[n-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[n-1]+" = "+o[n-1]+` - 1;
        if (`+o[n-2]+" < "+e[n-2]+` &&
            `+o[n-1]+" < "+e[n-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}}();function Zf(r,t,e){var n=r.indexOf(t);return r.map(function(i,o){return o===n?i+" - "+e:i}).join()}var h6=function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),d6=function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dataFormat==="channelsLast",a=t-1-r.padInfo.top,s=e-1-r.padInfo.left,u=o?1:2,c=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+d+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),p6=function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,o=r.padInfo.top,a=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+o+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+a+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),f6=function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=t-1-r.padInfo.front,u=e-1-r.padInfo.top,c=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),m6=function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),g6=function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=t-1-r.padInfo.top,a=e-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),SS=function(){return function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.padInfo.top,o=r.padInfo.left,a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,d=r.filterHeight,p=r.filterWidth,f=4*Math.floor(r.inChannels/4),g=r.inChannels%4,y=r.dataFormat==="channelsLast",x=y?1:2,b=y?2:3,_=y?3:1,C="",T="";e&&(C=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,T="result = activation(result);");var D=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+_+`];

        ivec2 xRCCorner =
            ivec2(coords[`+x+"], coords["+b+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+y+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(g===1)+`) {

              if (`+y+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(g===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+y+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(g===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+y+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+D+`
        `+T+`
        setOutput(result);
      }
    `}}(),v6=function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var t=r.padInfo.front,e=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,d=r.filterDepth,p=r.filterHeight,f=r.filterWidth,g=4*Math.floor(r.inChannels/4),y=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+d+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+g+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(y===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+g+`) *
                  getW(wF, wR, wC, `+g+`, d2);
              } else if (`+(y===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+g+`),
                  getX(batch, xF, xR, xC, `+g+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+g+`, d2),
                  getW(wF, wR, wC, `+g+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(y===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+g+`),
                  getX(batch, xF, xR, xC, `+g+` + 1),
                  getX(batch, xF, xR, xC, `+g+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+g+`, d2),
                  getW(wF, wR, wC, `+g+` + 1, d2),
                  getW(wF, wR, wC, `+g+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),TS=function(){return function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.inHeight,o=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,d=r.dilationHeight,p=r.dilationWidth,f=r.filterHeight,g=r.filterWidth,y=r.outChannels/r.inChannels,x="",b="";e&&(x=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,b="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+y+`;
        int q = d2 - d1 * `+y+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+_+`
        `+b+`
        setOutput(result);
      }
    `}}(),AS=function(){return function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var i=r.inHeight,o=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,d=r.dilationHeight,p=r.dilationWidth,f=r.filterHeight,g=r.filterWidth,y=g,x="int xR; int xC; int xCOffset;",b=0;b<f;b++)for(var _=0;_<g;_++)x+=`
          vec4 xTexelR`+b+"C"+2*_+` = vec4(0.);
          vec4 wR`+b+"C"+_+` = vec4(0.);
          vec4 xR`+b+"C"+_+" = vec4(0.);";for(b=0;b<f;b++)for(var C=0;C<y;C++){if(x+=`
          xR = xRCorner + `+b*d+`;
          xC = xCCorner + `+(_=2*C)*p+`;
        `,c===1){if(_<g&&(x+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+b+"C"+_+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+b+"C"+_+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+b+"C"+_+" = vec4(previous.zw, xTexelR"+b+"C"+_+`.xy);
                } else {
                  xR`+b+"C"+_+" = vec4(0, 0, xTexelR"+b+"C"+_+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+b+"C"+_+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+b+"C"+_+` = vec4(0.);
                }

                xR`+b+"C"+_+" = xTexelR"+b+"C"+_+`;
              `,_+1<g)){var T=s%2==0?Sb(p):p;p%2==0&&s%2==1||p%2!=0&&s%2!=1?(x+=`
                  xCOffset = xC + `+s%2+" + "+T+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+b+"C"+(_+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(x+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+b+"C"+_+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+b+"C"+_+` = vec4(0.);
                    }
                  `),x+=`
                  xR`+b+"C"+(_+1)+` = vec4(
                    xTexelR`+b+"C"+_+".zw, xTexelR"+b+"C"+(_+2)+`.xy);
                `):x+=`
                  xCOffset = xC + `+T+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+b+"C"+(_+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+b+"C"+(_+1)+" = xTexelR"+b+"C"+(_+2)+`;
                `}}else _<g&&(x+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(x+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+b+"C"+_+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+b+"C"+_+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+b+"C"+(_+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+b+"C"+(_+2)+` = vec4(0.);
                }

                xR`+b+"C"+_+` = vec4(
                  xTexelR`+b+"C"+_+".zw, xTexelR"+b+"C"+(_+2)+`.zw);
              `,_+1<g&&(x+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+b+"C"+(_+1)+" = vec4(xTexelR"+b+"C"+(_+2)+`.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+b+"C"+_+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+b+"C"+_+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+b+"C"+(_+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+b+"C"+(_+2)+` = vec4(0.);
                }

                xR`+b+"C"+_+` = vec4(
                  xTexelR`+b+"C"+_+".xy, xTexelR"+b+"C"+(_+2)+`.xy);
              `,_+1<g&&(x+=`
                  xR`+b+"C"+(_+1)+` = vec4(
                    xTexelR`+b+"C"+_+".zw, xTexelR"+b+"C"+(_+2)+`.zw);
                `)),x+="}");_<g&&(x+=`
            vec4 wTexelR`+b+"C"+_+" = getW("+b+", "+_+`, d1, q);
            wR`+b+"C"+_+" = vec4(wTexelR"+b+"C"+_+".xz, wTexelR"+b+"C"+_+`.xz);
          `,_+1<g&&(x+=`
              vec4 wTexelR`+b+"C"+(_+1)+" = getW("+b+", "+(_+1)+`, d1, q);
              wR`+b+"C"+(_+1)+` =
                vec4(wTexelR`+b+"C"+(_+1)+".xz, wTexelR"+b+"C"+(_+1)+".xz);"))}for(b=0;b<f;b++)for(_=0;_<g;_++)x+="dotProd += xR"+b+"C"+_+" * wR"+b+"C"+_+";";var D="",O="";e&&(D=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,O="result = activation(result);");var z=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+D+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+x+`

        vec4 result = dotProd;
        `+z+`
        `+O+`
        setOutput(result);
      }
    `}}(),y6=function(){return function(r,t,e,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=r[0],a=r[1],s=r[2],u=r[3],c=t[0],d=e[0],p=e[1];this.outputShape=[c,d,p,u];var f=n==="bilinear"?1:0,g=[a-1+".0",s-1+".0"],y=g[0],x=g[1],b=d>1?[""+(a-1)/(d-1),"(y2-y1) * height_ratio","y1*"+y+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+y],_=b[0],C=b[1],T=b[2],D=p>1?[""+(s-1)/(p-1),"(x2-x1) * width_ratio","x1*"+x+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+x],O=D[0],z=D[1],I=D[2];this.userCode=`
      const float height_ratio = float(`+_+`);
      const float width_ratio = float(`+O+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+C+`;
        float width_scale = `+z+`;

        float in_y = `+T+`;
        if( in_y < 0.0 || in_y > `+y+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+I+`;
        if( in_x < 0.0 || in_x > `+x+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}(),w6=function(){return function(r,t,e){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],o=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Xt(n)+` coords = getOutputCoords();
        int end = `+RS(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+RS(n,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function RS(r,t){if(r===1)return""+t;if(r===2)return t+".y";if(r===3)return t+".z";if(r===4)return t+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var b6=function(){return function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Od.DENSE;var t=gd(r),e=yr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Au(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `}}(),x6=function(){return function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Od.DENSE;var t=gd(r),e=yr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Au(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `}}(),_6=function(){function r(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),E6=function(){return function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}(),I6=function(){return function(r){this.variableNames=["A"],this.outTexUsage=oi.DOWNLOAD;var t=yr();this.outputShape=r,this.userCode=`
      `+Bk+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `}}(),C6=function(){return function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=oi.DOWNLOAD;var t=yr();this.outputShape=r,this.userCode=`
      `+Bk+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `}}(),S6=function(){return function(r,t,e){e===void 0&&(e=!1),this.variableNames=["A"];var n=yr(),i=t[0],o=t[1];this.outputShape=r;var a="result";e&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+tx(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}}(),T6=function(){return function(r,t,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=yr(),i=t[0],o=t[1];this.outputShape=r;var a="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var d=2*u+c;a+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+r[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+r[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+d+`] = values[0];
              } else if(offset == 1) {
                result[`+d+`] = values[1];
              } else if(offset == 2) {
                result[`+d+`] = values[2];
              } else {
                result[`+d+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+tx(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+n.output+" = "+s+`;
      }
    `}}(),A6="return real * expR - imag * expI;",R6="return real * expI + imag * expR;",kS=function(){return function(r,t,e){this.variableNames=["real","imag"];var n=t[1];this.outputShape=t;var i=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=e?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),k6=function(){function r(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,i){e.valueLoc==null&&(e.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(e.valueLoc,t)}},r}(),N6=function(){return function(r){this.variableNames=["A"];var t=yr(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),D6=function(){return function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=yr(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+e+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `}}(),O6=function(){return function(r,t,e){this.variableNames=["A","indices"];var n=r.slice();n[e]=t,this.outputShape=n,this.rank=n.length;var i=Xt(this.rank),o=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],p=0;p<a.length;p++)p===s?d.push("int(getIndices("+c[p]+"))"):d.push(""+c[p]);return d.join()}(r,e);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}}(),P6=function(){return function(r,t,e){this.sliceDim=r,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var n=Xt(t.length),i=Xt(e.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function qk(r,t){var e=yr();return $R(r,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Hk(r,t){return QR(r,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function $k(r,t){return YR(r,t,new Uint16Array([0,1,2,2,1,3]))}function cp(r,t,e,n,i,o,a){ZR(e,n);var s=JR(r,t),u=r.TEXTURE_2D;return Fe(r,t,function(){return r.bindTexture(u,s)}),Fe(r,t,function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Fe(r,t,function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Fe(r,t,function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Fe(r,t,function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Fe(r,t,function(){return r.texImage2D(u,0,i,e,n,0,o,a,null)}),Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function Gk(r,t,e,n,i){var o=Xg(e,n);return cp(r,t,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function Kk(r,t,e,n,i){var o=Xg(e,n);return cp(r,t,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Xk(r,t,e,n,i){var o=Xg(e,n);return cp(r,t,o[0],o[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function Qk(r,t,e,n,i){var o=ap(e,n);return cp(r,t,o[0],o[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function Yk(r,t,e,n,i){var o=ap(e,n);return cp(r,t,o[0],o[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function Jk(r,t,e,n){return Fe(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Kw(r,t,e,"clipSpacePos",n,3,20,0)&&Kw(r,t,e,"uv",n,2,20,12)}function Zk(r,t,e,n,i,o,a){var s,u,c;Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)}),o instanceof Uint8Array?(s=new Uint8Array(n*i*4),u=r.UNSIGNED_BYTE,c=r.RGBA):(s=new Float32Array(n*i*4),u=r.FLOAT,c=a.internalFormatPackedFloat),s.set(o),Fe(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,c,n,i,0,r.RGBA,u,s)}),Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function eN(r,t,e,n){Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)}),n.data instanceof Uint8Array?Fe(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):Fe(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),Fe(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function tN(r,t,e,n,i){var o=r.createBuffer();Fe(r,t,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,o)});var a=16*e*n;return Fe(r,t,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,a,r.STREAM_READ)}),Fe(r,t,function(){return r.readPixels(0,0,n,e,r.RGBA,r.FLOAT,0)}),Fe(r,t,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),o}function nN(r,t,e){var n=r,i=new Float32Array(e);return n.bindBuffer(n.PIXEL_PACK_BUFFER,t),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function rN(r,t,e,n,i){var o=Xg(e,n),a=o[0],s=o[1],u=new Uint8Array(e*n*4);return Fe(r,t,function(){return r.readPixels(0,0,a,s,i.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function iN(r,t,e,n,i,o,a,s){var u=r,c=new Float32Array(function(d,p){var f=ap(d,p);return f[0]*f[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function oN(r,t,e,n){var i=new Float32Array(e*n*4);return Fe(r,t,function(){return r.readPixels(0,0,n,e,r.RGBA,r.FLOAT,i)}),i}var M6=Object.freeze({createVertexShader:qk,createVertexBuffer:Hk,createIndexBuffer:$k,createFloat32MatrixTexture:Gk,createFloat16MatrixTexture:Kk,createUnsignedBytesMatrixTexture:Xk,createPackedMatrixTexture:Qk,createFloat16PackedMatrixTexture:Yk,bindVertexProgramAttributeStreams:Jk,uploadDenseMatrixToTexture:Zk,uploadPixelDataToTexture:eN,createBufferFromOutputTexture:tN,downloadFloat32MatrixFromBuffer:nN,downloadByteEncodedFloatMatrixFromOutputTexture:rN,downloadPackedMatrixFromBuffer:iN,downloadMatrixFromPackedOutputTexture:oN}),aN=function(){function r(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=he().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,jR(e,t)):this.gl=Mo(e),he().getNumber("WEBGL_VERSION")===1)this.textureFloatExtension=Im(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),this.textureHalfFloatExtension=Im(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float");else if(Ki(this.gl,"EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float");else{if(!Ki(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Hk(this.gl,this.debug),this.indexBuffer=$k(this.gl,this.debug),this.framebuffer=ek(this.gl,this.debug),this.textureConfig=Db(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return he().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Fe(e,this.debug,function(){return e.finish()}),Fe(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Fe(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Fe(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Fe(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Fe(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),Gk(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),Kk(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),Xk(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),eN(this.gl,this.debug,t,e)},r.prototype.uploadDenseMatrixToTexture=function(t,e,n,i){this.throwIfDisposed(),Zk(this.gl,this.debug,t,e,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Yk(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Qk(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(Xw(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Fe(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var i=this;return this.downloadMatrixDriver(t,function(){return rN(i.gl,i.debug,e,n,i.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,i,o,a){return iN(this.gl,t,0,0,0,o,a,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return nN(this.gl,t,e)},r.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var i=tN(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},r.prototype.createFence=function(t){var e,n,i=this;if(he().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=a}else he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var i=this;return this.downloadMatrixDriver(t,function(){return oN(i.gl,i.debug,e,n)})},r.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=GR(e,this.debug,t),i=qk(e,this.debug),o=KR(e,this.debug);return Fe(e,this.debug,function(){return e.attachShader(o,i)}),Fe(e,this.debug,function(){return e.attachShader(o,n)}),XR(e,this.debug,o),this.debug&&Tm(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Jk(e,this.debug,this.program,this.vertexBuffer)),o},r.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&Fe(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},r.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Tm(this.gl,this.debug,this.program),Fe(this.gl,this.debug,function(){return e.gl.useProgram(t)})},r.prototype.getUniformLocation=function(t,e,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?nk(this.gl,this.debug,t,e):rk(this.gl,t,e)},r.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Fe(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},r.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},r.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),ik(this.gl,this.debug,this.program,t,e,n)},r.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},r.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var i=ap(e,n),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(t,o,a)},r.prototype.setOutputMatrixWriteRegion=function(t,e,n,i){this.setOutputMatrixWriteRegionDriver(n,t,i,e)},r.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Tm(this.gl,this.debug,this.program),ad(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Fe(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Fe(this.gl,this.debug,function(){return t.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Im(this.gl,this.debug,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},r.prototype.endQuery=function(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(t){return Ue(this,void 0,void 0,function(){var e=this;return je(this,function(n){switch(n.label){case 0:return[4,Uw(function(){return e.disposed||e.isQueryAvailable(t,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},r.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var t=function(n){for(var i=0;i<n.length;++i){var o=n[i]();if(!o)break}return i-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},r.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Uw(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Am(this.gl,this.debug,t,this.framebuffer),this.debug&&ad(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Am(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ad(this.gl)):Xw(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var i=this.gl;Am(i,this.debug,t,this.framebuffer),this.debug&&ad(i),this.outputTexture=t,Fe(i,this.debug,function(){return i.viewport(0,0,e,n)}),Fe(i,this.debug,function(){return i.scissor(0,0,e,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,i){var o=this;this.throwIfDisposed(),Fe(this.gl,this.debug,function(){return o.gl.scissor(t,e,n,i)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function NS(r,t){if(r.length!==t.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+t.length+" inputs");r.forEach(function(e,n){var i=e.logicalShape,o=t[n],a=o.shape;if(!Qn(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var s=e.texShape,u=o.isUniform?null:o.texData.texShape;if(!Qn(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var L6=function(){return function(r,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=e.filterWidth,i=e.inChannels,o=e.strideWidth,a=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,d=e.dilationHeight,p=e.dataFormat,f=s.left,g=s.top,y=i*n,x=yr(),b=p==="channelsLast",_=b?0:1,C=b?1:2,T="",D=0;D<=1;D++)for(var O=0;O<=1;O++)T+=`
          blockIndex = rc.y + `+O+`;
          pos = rc.x + `+D+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+g+`;
            d0 = offsetY + `+d+" * (pos / "+y+`);

            if(d0 < `+t[_]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+y+".) / "+i+`.));

              if(d1 < `+t[C]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+b+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*D+O)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*D+O)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+T+`

        `+x.output+` = result;
      }
    `}}(),F6=function(){return function(r,t,e,n,i){this.variableNames=["x"],this.outputShape=[];var o,a=t,s=r[3]-1;this.outputShape=r;var u="float("+e+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `}}(),z6=function(){return function(r,t,e,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=t,this.bias=e,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),V6=function(){return function(r,t,e,n,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=t,s=r[3]-1;this.outputShape=r;var u="float("+e+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `}}(),B6=function(){return function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideHeight,e=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,o=r.effectiveFilterWidth,a=i-1-r.padInfo.top,s=o-1-r.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),U6=function(){return function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,i=r.dilationDepth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterDepth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=s-1-r.padInfo.front,p=u-1-r.padInfo.top,f=c-1-r.padInfo.left,g=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+g+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),q0=function(){return function(r,t,e,n,i,o,a){e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=e?r[1]:r[2],u=Math.ceil(s/2),c=e?"i * 2, rc.y":"rc.y, i * 2",d=n?"rc.z, i * 2":"i * 2, rc.z",p=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";o&&(g=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,y="result = activation(result);");var x=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+d+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+f[0]+`);
          result += (`+p[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+x+`

        `+y+`

        setOutput(result);
      }
    `}}(),j6=function(){function r(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,i){e.seedLoc==null&&(e.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(e.seedLoc,t)}},r}(),W6=function(){return function(r,t,e,n){this.variableNames=["indices"],this.outputShape=[r,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+e+`),
                      float(index == coords.y)));
      }
    `}}(),q6=function(){return function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var t=r.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=qr("rc",t),n=Xt(t),i=function(s,u,c){if(s===1)return"rc > "+u[0];for(var d="",p=s-2;p<s;p++)d+=c[p]+" >= "+u[p],p<s-1&&(d+="||");return d}(t,r,e),o=function(s,u,c,d){if(s===1)return"";var p=d.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `}(t,r[r.length-1],r[r.length-2],e),a=function(s,u){var c=s.length,d=function(p,f){for(var g=[],y=0;y<=1;y++)for(var x=0;x<=1;x++){for(var b=(y===0?"r":"rp1")+", "+(x===0?"c":"cp1"),_=2;_<p;_++)b=f[f.length-1-_]+","+b;g.push(b)}return g}(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+d[0]+`),
          cEdge ? 0. : getA(`+d[1]+`),
          rEdge ? 0. : getA(`+d[2]+`),
          rEdge || cEdge ? 0. : getA(`+d[3]+")"}(r,e);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}}}(),H6=function(){return function(r,t,e){this.variableNames=["x"],this.outputShape=t.map(function(u,c){return u[0]+r[c]+u[1]});var n=r.length,i=Xt(n),o=t.map(function(u){return u[0]}).join(","),a=t.map(function(u,c){return u[0]+r[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),$6=function(){return function(r,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(b,_){return b[0]+r[_]+b[1]});for(var n=r.length,i=Xt(n),o=t.map(function(b){return b[0]}).join(","),a=t.map(function(b,_){return b[0]+r[_]}).join(","),s=qr("rc",n),u=qr("source",n),c=s[n-1]+" < "+this.outputShape[n-1],d=n===1?"source":"vec2("+u.slice(-2).join()+")",p=[i+" rc = outputLoc;",s[n-1]+` += 1;
       if(`+c+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+s[n-2]+` += 1;
       if(`+s[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+s[n-1]+` += 1;
         if(`+c+") {"],f=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",g="",y=0,x=n===1?2:4;y<x;y++)g+=`
        `+p[y]+`
        if (`+f+`) {
          result[`+y+"] = float("+e+`);
        } else {
          `+i+` source = rc - start;
          result[`+y+"] = getChannel(getX("+u.join()+"), "+d+`);
        }
      `;g+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+g+`
        setOutput(result);
      }
    `}}(),H0=function(){return function(r,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left;this.outputShape=r.outShape;var f=t==="avg",g="0.0";if(f||(g="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+d+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(y="avgValue / count");var x=4*Math.floor(n/4),b=n%4,_=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+d+", "+p+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+x+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+_+`
          }

          int xC = xCCorner + `+x+`;
          if (`+(b===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+_+`
          } else if (`+(b===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+_+`
          } else if (`+(b===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+_+`
          }
        }
        setOutput(`+y+`);
      }
    `}}}(),$0=function(){return function(r,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,g=r.padInfo.front,y=r.padInfo.top,x=r.padInfo.left;this.outputShape=r.outShape;var b=t==="avg",_="0.0";if(b||(_="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+a+`);
        const ivec3 pads = ivec3(`+g+", "+y+", "+x+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+p+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var C=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(C="avgValue / count");var T=4*Math.floor(n/4),D=n%4,O=`
      if (`+b+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+g+", "+y+", "+x+`);
      const float initializationValue = `+_+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+_+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+T+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+O+`
            }

            int xC = xCCorner + `+T+`;
            if (`+(D===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+O+`
            } else if (`+(D===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+O+`
            } else if (`+(D===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+O+`
            }
          }
          setOutput(`+C+`);
        }
      }
    `}}}(),G6=function(){return function(r,t){this.variableNames=["x"];var e=r.windowSize,n=r.batchSize,i=r.inSize,o=Math.ceil(i/e);this.outputShape=[n,o];var a="0.0",s="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",s="min"):t==="max"&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var c=4*Math.floor(e/4),d=e%4,p=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var g="";i%e>0&&(g=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+g+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(d===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+u+`);
      }
    `}}(),K6=function(){return function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),e+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Au(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+tx(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+e+`

        setOutput(result);
      }
    `}}(),X6=function(){return function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],c=[e&&s>1?i-1:i,e&&u>1?o-1:o],d=[e&&s>1?s-1:s,e&&u>1?u-1:u],p=c[0]/d[0],f=c[1]/d[1],g=1/p,y=1/f,x=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+g+`);
        const float invWidthScale = float(`+y+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+b+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),Q6=function(){return function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,t,e,s];var u=[n&&t>1?o-1:o,n&&e>1?a-1:a],c=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),Y6=function(){return function(r,t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,t,e,s];var u=[n&&t>1?o-1:o,n&&e>1?a-1:a],c=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}(),J6=function(){return function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],c=[e&&s>1?i-1:i,e&&u>1?o-1:o],d=[e&&s>1?s-1:s,e&&u>1?u-1:u],p=c[0]/d[0],f=c[1]/d[1],g=1/p,y=1/f,x=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+g+`);
        const float invWidthScale = float(`+y+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+b+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+d[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+d[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),Z6=function(){return function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,t,e,s];var u=[n&&t>1?o-1:o,n&&e>1?a-1:a],c=[n&&t>1?t-1:t,n&&e>1?e-1:e],d=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+d+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),e5=function(){return function(r,t){this.variableNames=["x"];var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,e!==1){var n=r.map(function(o,a){return function(s){return t.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=Xt(e);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `}}(),t5=function(){return function(r,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=r;var n=qr("rc",e),i=n[e-1]+" + 1 < "+this.outputShape[e-1],o=n[e-2]+" + 1 < "+this.outputShape[e-2],a=Xt(e);function s(u){var c=r.map(function(d,p){return function(f,g){return t.indexOf(f)!==-1&&r[f]!==1?r[f]+" - "+g[f]+" - 1":""+g[f]}(p,u)});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(n.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",s(u)}(n.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(n.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `}}(),DS=function(){return function(r,t,e,n,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Xt(i.length),u=Xt(o.length),c="";e===1?c="i":e===2&&(c="i, j");var d="getIndices("+c+")",p="";n===1?p="i":n===2&&(p="i, coords[1]");var f="getUpdates("+p+")",g=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+d+`);
              flattenedIndex += index * `+g+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),n5=function(){return function(r,t){this.variableNames=["x","segmentIds"];var e=r.windowSize,n=r.batchSize,i=r.inSize,o=r.numSegments,a=o*Math.ceil(i/e);this.outputShape=[n,a];var s=4*Math.floor(e/4),u=e%4,c=`
        sumValue += dot(values, segFilter);
    `,d="";i%e>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var p="";i%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `}}(),r5=function(){return function(r,t,e){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)i="resRC",n="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+o[u]),u<r&&a.push(""+o[u]);n=a.join(),i=s.join()}var c=Xt(e);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}}(),i5=function(){function r(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=Xt(this.rank),i="uniform int start["+this.rank+"];",o=function(a){if(a===1)return"sourceLoc";if(a<=6)return G0.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);e=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+t.map(function(a,s){return"sourceLoc."+G0[s]+" = start["+s+"] + coords."+G0[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+e+`
        setOutput(getSource(`+o+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,i){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(i,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r}(),G0=["x","y","z","w","u","v"],o5=function(){function r(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=Xt(this.rank),n=qr("coords",this.rank),i=qr("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(d,p){return"start["+p+"]"}).join()+");":t.map(function(d,p){return i[p]+" = "+n[p]+" + start["+p+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,i){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(i,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r}(),a5=function(){return function(r,t,e){this.variableNames=["x"],this.outputShape=e;var n=e.length,i=Xt(e.length),o=Xt(e.length),a="";if(n===1)a="coords * strides + begin";else{var s=0;a=e.map(function(u,c){return s++,e.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+r+`);
      `+i+" strides = "+i+"("+t+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `}}(),s5=function(){function r(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(t,e,n){var i,o=OS(e,n),a=PS(t,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===ri.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===ri.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===ri.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===ri.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===ri.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(i),i},r.prototype.releaseTexture=function(t,e,n,i){if(this.freeTextures!=null){var o=PS(e,OS(n,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(n){t.gpgpu.deleteMatrixTexture(n)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(i){t.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function OS(r,t){if(r===oi.UPLOAD)return ri.PACKED_2X2_FLOAT32;if(r===oi.RENDER||r==null)return function(e){return he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?ri.PACKED_2X2_FLOAT32:ri.UNPACKED_FLOAT32:e?ri.PACKED_2X2_FLOAT16:ri.UNPACKED_FLOAT16}(t);if(r===oi.DOWNLOAD||r===oi.PIXELS)return ri.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function PS(r,t,e){return r[0]+"_"+r[1]+"_"+t+"_"+e}var u5=function(){return function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[n]*t[n];this.outputShape=e,this.rank=e.length;var i=Xt(this.rank),o=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],d=0;d<a.length;d++)c.push("imod("+u[d]+", "+a[d]+")");return c.join()}(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}}(),l5=function(){return function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];this.outputShape=e,this.rank=e.length;var i=Xt(this.rank),o=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),d=0;d<a.length;d++)c[a[d]]=u[d];return c.join()}(t);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}}(),c5=function(){return function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Xt(this.rank),o=Vk("rc",this.rank),a=new Array(this.rank);for(n=0;n<t.length;n++)a[t[n]]=o[n];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `}}(),nx=1.7580993408473768,rx=1.0507009873554805,pt=function(){return function(r,t){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),io="if (isnan(x)) return x;",h5="return x;",MS="return abs(x);",sN=io+`
  return (x < 0.0) ? 0.0 : x;
`,uN=io+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,lN="return (x >= 0.0) ? x : (exp(x) - 1.0);",d5=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+nx+`;
  float scale = `+rx+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,LS="return -x;",FS="return ceil(x);",zS="return floor(x);",VS="return exp(x);",BS="return exp(x) - 1.0;",p5=io+`
  return sin(x);
`,f5=io+`
  return cos(x);
`,m5=io+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,g5=io+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,v5=io+`
  return atan(x);
`,y5=io+"return log(x + sqrt(x * x + 1.0));",w5=io+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,b5=io+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,em="return x;",x5="return x;",cN=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hN=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,dN=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Qh=function(){return function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),_5=function(){return function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var t=r.length,e=qr("rc",t),n=Xt(t),i=function(s,u){if(s===1)return"rc";for(var c="",d=0;d<s;d++)c+=u[d],d<s-1&&(c+=",");return c}(t,e),o=e.slice(-2),a=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `}}(),tm={};function nm(r,t){if(t===void 0&&(t=!1),r==="linear")return t?x5:h5;if(r==="relu")return t?cN:sN;if(r==="elu")return t?dN:lN;if(r==="relu6")return t?hN:uN;if(r==="prelu")return t?Wk:jk;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var E5=600,pN=function(r){function t(e){var n,i=r.call(this)||this;if(i.gpgpu=e,i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!he().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var o=Mo(he().getNumber("WEBGL_VERSION"));i.binaryCache=((n=he().getNumber("WEBGL_VERSION"))in tm||(tm[n]={}),tm[n]),i.gpgpu=new aN(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=e.gl.canvas;return i.textureManager=new s5(i.gpgpu),i.numMBBeforeWarning=he().global.screen==null?1024:he().global.screen.height*he().global.screen.width*window.devicePixelRatio*E5/1024/1024,i.texData=new Kb(i,K),i}return to(t,r),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.fromPixels=function(e,n){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var i=typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement,o=e.data instanceof Uint8Array,a=typeof ImageData<"u"&&e instanceof ImageData,s=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,c=s?[e.videoWidth,e.videoHeight]:[e.width,e.height],d=c[0],p=c[1],f=[p,d],g=[p,d,n];if(!(i||o||a||s||u))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);(u||s)&&(this.fromPixels2DContext==null&&(this.fromPixels2DContext=WR(he().getNumber("WEBGL_VERSION")).getContext("2d")),this.fromPixels2DContext.canvas.width=d,this.fromPixels2DContext.canvas.height=p,this.fromPixels2DContext.drawImage(e,0,0,d,p),e=this.fromPixels2DContext.canvas);var y,x,b=this.makeTensorInfo(f,"int32");return this.texData.get(b.dataId).usage=oi.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(b.dataId),e),he().getBool("WEBGL_PACK")?(y=new D6(g),x=this.compileAndRun(y,[b])):(y=new N6(g),x=this.compileAndRun(y,[b])),this.disposeData(b.dataId),x},t.prototype.write=function(e,n,i){if(he().getBool("DEBUG")&&this.checkNumericalProblems(e),i==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:n,dtype:i,values:e,usage:oi.UPLOAD}),o},t.prototype.move=function(e,n,i,o){if(he().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:o,values:n,usage:oi.UPLOAD})},t.prototype.readSync=function(e){var n=this.texData.get(e),i=n.values,o=n.dtype,a=n.complexTensors,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var d=void 0;d=c?new Qh(u,em):new pt(u,em);var p=this.runWebGLProgram(d,[{dataId:e,shape:u,dtype:o}],o),f=this.readSync(p.dataId);return this.disposeData(p.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return i;var g,y,x=this.activeTimers!=null;return x&&(g=$i()),o==="complex64"?y=n1(a.real.dataSync(),a.imag.dataSync()):y=this.getValuesFromTexture(e),x&&(this.downloadWaitMs+=$i()-g),this.convertAndCacheOnCPU(e,y)},t.prototype.read=function(e){return Ue(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p,f,g,y,x,b,_,C,T,D,O,z,I,S;return je(this,function(A){switch(A.label){case 0:if(this.pendingRead.has(e))return n=this.pendingRead.get(e),[2,new Promise(function(N){return n.push(N)})];if(i=this.texData.get(e),o=i.values,a=i.shape,s=i.slice,u=i.dtype,c=i.complexTensors,d=i.isPacked,s!=null)return p=void 0,p=d?new Qh(a,em):new pt(a,em),f=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:u}],u),g=this.read(f.dataId),this.disposeData(f.dataId),[2,g];if(o!=null)return[2,this.convertAndCacheOnCPU(e)];if(!he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&he().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return y=null,u!=="complex64"&&he().get("WEBGL_BUFFER_SUPPORTED")&&(x=this.decode(e),b=this.texData.get(x.dataId),y=(S=this.gpgpu).createBufferFromTexture.apply(S,[b.texture].concat(gd(a)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:A.sent(),A.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return C=A.sent(),T=C[0],D=C[1],_=n1(T,D),[3,5];case 4:y==null?_=this.getValuesFromTexture(e):(O=He(a),_=this.gpgpu.downloadFloat32MatrixFromBuffer(y,O)),A.label=5;case 5:return x!=null&&this.disposeData(x.dataId),z=this.convertAndCacheOnCPU(e,_),I=this.pendingRead.get(e),this.pendingRead.delete(e),I.forEach(function(N){return N(z)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,z]}})})},t.prototype.checkNumericalProblems=function(e){if(e!=null)for(var n=0;n<e.length;n++){var i=e[n];if(!qR(i))throw he().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var n,i=this.texData.get(e),o=i.shape,a=i.dtype,s=i.isPacked,u=He(o);if(he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),d=this.texData.get(c.dataId),p=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[d.texture].concat(gd(o))).subarray(0,u);return this.disposeData(c.dataId),p}var f=he().getBool("WEBGL_PACK")&&s===!0,g=f?Rm(o):o,y=f?new C6(g):new I6(g),x=this.runWebGLProgram(y,[{shape:g,dtype:a,dataId:e}],"float32"),b=this.texData.get(x.dataId),_=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(b.texture,b.texShape[0],b.texShape[1]).subarray(0,u);return this.disposeData(x.dataId),_},t.prototype.time=function(e){return Ue(this,void 0,void 0,function(){var n,i,o,a,s,u,c;return je(this,function(d){switch(d.label){case 0:return n=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,e(),a=_a(this.activeTimers.map(function(p){return p.query})).filter(function(p){return p!=null}),s=_a(this.activeTimers.map(function(p){return p.name})).filter(function(p){return p!=null}),this.activeTimers=n,o&&(this.programTimersStack=null),[4,Promise.all(a)];case 1:return u=d.sent(),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:AR(u),getExtraProfileInfo:function(){return u.map(function(p,f){return{name:s[f],ms:p}}).map(function(p){return p.name+": "+p.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:$i(),endMs:null}},t.prototype.endTimer=function(e){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=$i(),e)},t.prototype.getQueryTime=function(e){return Ue(this,void 0,void 0,function(){var n;return je(this,function(i){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(n=e).endMs-n.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var n=this.texData.get(e).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var n=this.texData.get(e),i=n.texture,o=n.dtype,a=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,d=c&&c.origDataId||e,p=this.dataRefCount.get(d);p>1?this.dataRefCount.set(d,p-1):(this.dataRefCount.delete(d),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return he().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=K.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,n){var i=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&e.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<n})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,n){var i=this.makeOutput(e.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:K.keep(e.clone()),imag:K.keep(n.clone())},i},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,n,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,n,i);if(He(i)===0)return xn([],i,e.dtype);var o=this.texData.get(e.dataId).isPacked,a=$b(e.shape,n,i);if(o||!a){var s=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new o5(i):new i5(i),u=s.getCustomSetupFunc(n);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,n,i)},t.prototype.shallowSlice=function(e,n,i){var o=this.texData.get(e.dataId),a=this.makeOutput(i,e.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=e.dtype;var u=Gb(n,e.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},t.prototype.stridedSlice=function(e,n,i,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,n,i,o);var a=iv(n,i,o);if(a.some(function(u){return u===0}))return xn([],a);var s=new a5(n,o,a);return this.compileAndRun(s,[e])},t.prototype.reverse=function(e,n){var i=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t5(e.shape,n):new e5(e.shape,n);return this.compileAndRun(i,[e])},t.prototype.concat=function(e,n){if(e[0].dtype==="complex64"){var i=e.map(function(g){return Wr(g)}),o=e.map(function(g){return Ci(g)});return Ln(this.concat(i,n),this.concat(o,n))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,n);if(e.length===1)return e[0];if(e.length>he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),n),u=this.concat(e.slice(a),n);return this.concat([s,u],n)}if(he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new c6(e.map(function(g){return g.shape}),n);return this.compileAndRun(c,e)}var d=Wu(e.map(function(g){return g.shape}),n),p=e.map(function(g){return g.as2D(-1,He(g.shape.slice(n)))}),f=new l6(p.map(function(g){return g.shape}));return this.compileAndRun(f,p).reshape(d)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,LS,e.dtype);var n=new pt(e.shape,LS);return this.compileAndRun(n,[e])},t.prototype.batchMatMul=function(e,n,i,o){var a=i?e.shape[2]:e.shape[1],s=o?n.shape[1]:n.shape[2],u=i?e.shape[1]:e.shape[2],c=e.shape[0];if((a===1||s===1)&&u>1e3){i&&(e=e.transpose([0,2,1])),o&&(n=n.transpose([0,2,1]));var d=s===1?e:e.as3D(c,u,1),p=s===1?2:1,f=s===1?n.as3D(c,1,u):n;return this.multiply(d,f).sum(p,!0)}var g=Tn(e.dtype,n.dtype),y=new q0(e.shape,[c,a,s],i,o);return this.compileAndRun(y,[e,n],g)},t.prototype.fusedBatchMatMul=function(e){var n=e.a,i=e.b,o=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,d=o?n.shape[2]:n.shape[1],p=a?i.shape[1]:i.shape[2],f=n.shape[0],g=Tn(n.dtype,i.dtype),y=s!=null,x=c!=null,b=u?nm(u,!0):null,_=new q0(n.shape,[f,d,p],o,a,y,b,x),C=[n,i];return s&&C.push(s),c&&C.push(c),this.compileAndRun(_,C,g)},t.prototype.multiply=function(e,n){if(e.dtype==="complex64"){var i=this.texData.get(e.dataId),o=this.texData.get(n.dataId),a=new IS(i6,e.shape,n.shape),s=new IS(o6,e.shape,n.shape),u=[this.makeComplexComponentTensorInfo(e,i.complexTensors.real),this.makeComplexComponentTensorInfo(e,i.complexTensors.imag),this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],c=this.compileAndRun(a,u),d=this.compileAndRun(s,u),p=this.complex(c,d);return c.dispose(),d.dispose(),p}if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.multiply(e,n);if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,CS,e.dtype);var f=new fn(CS,e.shape,n.shape);return this.compileAndRun(f,[e,n],e.dtype)},t.prototype.batchNormalization=function(e,n,i,o,a,s){var u=[e,n,i],c=null;s!=null&&(c=s.shape,u.push(s));var d=null;if(a!=null&&(d=a.shape,u.push(a)),he().getBool("WEBGL_PACK_NORMALIZATION")){var p=new r6(e.shape,n.shape,i.shape,c,d,o);return this.compileAndRun(p,u)}var f=new n6(e.shape,n.shape,i.shape,c,d,o);return this.compileAndRun(f,u)},t.prototype.localResponseNormalization4D=function(e,n,i,o,a){var s=he().getBool("WEBGL_PACK_NORMALIZATION")?new V6(e.shape,n,i,o,a):new F6(e.shape,n,i,o,a);return this.compileAndRun(s,[e])},t.prototype.LRNGrad=function(e,n,i,o,a,s,u){var c=new z6(n.shape,o,a,s,u);return this.compileAndRun(c,[n,i,e])},t.prototype.tile=function(e,n){if(e.dtype==="string"){var i=this.readSync(e.dataId).map(function(a){return Nd(a)});return Fk(st(e.shape,e.dtype,i),n)}var o=new u5(e.shape,n);return this.compileAndRun(o,[e])},t.prototype.pad=function(e,n,i){var o=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $6(e.shape,n,i):new H6(e.shape,n,i);return this.compileAndRun(o,[e])},t.prototype.transpose=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,n);var i=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new c5(e.shape,n):new l5(e.shape,n);return this.compileAndRun(i,[e])},t.prototype.gather=function(e,n,i){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.gather(e,n,i);var o=new O6(e.shape,n.size,i);return this.compileAndRun(o,[e,n])},t.prototype.batchToSpaceND=function(e,n,i){W(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=n.reduce(function(p,f){return p*f}),a=ug(e.shape,n,o),s=lg(a.length,n.length),u=cg(e.shape,n,o),c=Ak(i,n.length),d=Rk(u,i,n.length);return e.reshape(a).transpose(s).reshape(u).slice(c,d)},t.prototype.spaceToBatchND=function(e,n,i){W(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=n.reduce(function(f,g){return f*g}),a=[[0,0]];a.push.apply(a,i);for(var s=1+n.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=ug(u.shape,n,o,!1),d=lg(c.length,n.length,!1),p=cg(u.shape,n,o,!1);return u.reshape(c).transpose(d).reshape(p)},t.prototype.reduce=function(e,n,i){var o=e.shape[0],a=e.shape[1],s=U0(a),u=new G6({windowSize:s,inSize:a,batchSize:o},n),c=this.compileAndRun(u,[e],i);return c.shape[1]===1?c:this.reduce(c,n,i)},t.prototype.argReduce=function(e,n,i){i===void 0&&(i=null);var o=e.shape[0],a=e.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=U0(a),u=new GW({windowSize:s,inSize:a,batchSize:o},n,i==null),c=[e];i!=null&&c.push(i);var d=this.compileAndRun(u,c,"int32");return d.shape[1]===1?d:this.argReduce(e,n,d)},t.prototype.argReducePacked=function(e,n,i){i===void 0&&(i=null);var o=i!=null?i.shape:e.shape,a=U0(o[o.length-1]),s=new ZW(o,a,n,i==null),u=i==null?[e]:[e,i],c=this.compileAndRun(s,u,"int32");return c.rank===e.rank?this.argReducePacked(e,n,c):c},t.prototype.sum=function(e,n){Ur("sum",n,e.rank);var i=ir(e.shape,n),o=i[0],a=He(i[1]),s=e.as2D(-1,a),u=z0(e.dtype);return this.reduce(s,"sum",u).reshape(o)},t.prototype.prod=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,n);var i=ir(e.shape,n),o=i[0],a=He(i[1]),s=e.as2D(-1,a),u=z0(e.dtype);return this.reduce(s,"prod",u).reshape(o)},t.prototype.unsortedSegmentSum=function(e,n,i){var o=0,a=no([o],e.rank),s=e;a!=null&&(s=e.transpose(a),o=ro(1,e.rank)[0]);var u=function(g,y,x){for(var b=[],_=g.length,C=0;C<_;C++)C!==y?b.push(g[C]):b.push(x);return b}(s.shape,o,i),c=He([s.shape[o]]),d=s.as2D(-1,c),p=z0(e.dtype),f=this.segOpCompute(d,"unsortedSegmentSum",n,p,i).reshape(u);return a!=null&&(f=f.transpose(Yg(a))),f},t.prototype.segOpCompute=function(e,n,i,o,a){var s=e.shape[0],u=e.shape[1],c=function(f,g){var y,x=!1;for(f<=Nk?(y=f,x=!0):y=sg(f,Math.floor(Math.sqrt(f)));!x;)y>g||y===f?x=!0:y=sg(f,y+1);return y}(u,a),d=new n5({windowSize:c,inSize:u,batchSize:s,numSegments:a},n),p=this.compileAndRun(d,[e,i],o);return p.shape[1]===a?p:(i=Jg(0,a).tile([u/c]),this.segOpCompute(p,n,i,o,a))},t.prototype.argMinMaxReduce=function(e,n,i){var o=[n];if(Ur("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,e.rank),!he().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=ir(e.shape,o),s=a[0],u=He(a[1]),c=e.as2D(-1,u);return this.argReduce(c,i).reshape(s)}return this.argReducePacked(e,i)},t.prototype.argMin=function(e,n){return this.argMinMaxReduce(e,n,"min")},t.prototype.argMax=function(e,n){return this.argMinMaxReduce(e,n,"max")},t.prototype.cumsum=function(e,n,i,o){if(n!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+n);var a=new w6(e.shape,i,o);return this.compileAndRun(a,[e])},t.prototype.equal=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(equal(a, b));
`,"bool");var i=new fn("return float(a == b);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.notEqual=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(notEqual(a, b));
`,"bool");var i=new fn("return float(a != b);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.less=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.less(e,n);if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(lessThan(a, b));
`,"bool");var i=new fn("return float(a < b);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.lessEqual=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new fn("return float(a <= b);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.greater=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.greater(e,n);if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new fn("return float(a > b);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.greaterEqual=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new fn("return float(a >= b);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.logicalNot=function(e){var n=new pt(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[e])},t.prototype.logicalAnd=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new fn("return float(a >= 1.0 && b >= 1.0);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.logicalOr=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new fn("return float(a >= 1.0 || b >= 1.0);",e.shape,n.shape);return this.compileAndRun(i,[e,n],"bool")},t.prototype.select=function(e,n,i){var o=new r5(e.rank,n.shape,n.rank);return this.compileAndRun(o,[e,n,i],Tn(n.dtype,i.dtype))},t.prototype.where=function(e){Zw("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=e.dataSync();return ex(e.shape,n)},t.prototype.topk=function(e,n,i){return zk(e.dataSync(),e.shape,e.dtype,n)},t.prototype.min=function(e,n){Ur("min",n,e.rank);var i=ir(e.shape,n),o=i[0],a=He(i[1]),s=e.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},t.prototype.minimum=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.minimum(e,n);var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.mod=function(e,n){var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new fn(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.max=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,n);Ur("max",n,e.rank);var i=ir(e.shape,n),o=i[0],a=He(i[1]),s=e.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},t.prototype.maximum=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.maximum(e,n);var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.all=function(e,n){Ur("all",n,e.rank);var i=ir(e.shape,n),o=i[0],a=He(i[1]),s=e.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},t.prototype.any=function(e,n){Ur("any",n,e.rank);var i=ir(e.shape,n),o=i[0],a=He(i[1]),s=e.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},t.prototype.squaredDifference=function(e,n){var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra("return (a - b) * (a - b);",e.shape,n.shape):new fn("return (a - b) * (a - b);",e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.realDivide=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new fn(`
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,n.shape);return this.compileAndRun(i,[e,n],"float32")},t.prototype.floorDiv=function(e,n){if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new fn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,n.shape);return this.compileAndRun(i,[e,n],"int32")},t.prototype.add=function(e,n){if(e.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(e,n,j0);if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.add(e,n);var i=Tn(e.dtype,n.dtype);if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,j0,i);var o=new fn(j0,e.shape,n.shape);return this.compileAndRun(o,[e,n],i)},t.prototype.packedUnaryOp=function(e,n,i){var o=new Qh(e.shape,n);return this.compileAndRun(o,[e],i)},t.prototype.packedBinaryOp=function(e,n,i,o,a){a===void 0&&(a=!1);var s=new ra(i,e.shape,n.shape,a);return this.compileAndRun(s,[e,n],o)},t.prototype.complexSeparableBinaryOp=function(e,n,i){var o=this,a=this.texData.get(e.dataId),s=this.texData.get(n.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var g=f[0],y=f[1],x=o.makeComplexComponentTensorInfo(e,g),b=o.makeComplexComponentTensorInfo(n,y),_=new fn(i,e.shape,n.shape);return o.compileAndRun(_,[x,b],Tn(g.dtype,y.dtype))}),c=u[0],d=u[1],p=this.complex(c,d);return c.dispose(),d.dispose(),p},t.prototype.makeComplexComponentTensorInfo=function(e,n){return{dataId:n.dataId,dtype:n.dtype,shape:e.shape}},t.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>he().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),i=this.addN(e.slice(0,n)),o=this.addN(e.slice(n));return this.addN([i,o])}var a=e.map(function(c){return c.dtype}).reduce(function(c,d){return Tn(c,d)}),s=e.map(function(c){return c.shape}),u=he().getBool("WEBGL_PACK")?new $W(e[0].shape,s):new HW(e[0].shape,s);return this.compileAndRun(u,e,a)},t.prototype.subtract=function(e,n){if(e.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(e,n,W0);if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.subtract(e,n);var i=Tn(e.dtype,n.dtype);if(he().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,W0,e.dtype);var o=new fn(W0,e.shape,n.shape);return this.compileAndRun(o,[e,n],i)},t.prototype.pow=function(e,n){var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new fn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,n.shape),o=Tn(e.dtype,n.dtype);return this.compileAndRun(i,[e,n],o)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,FS,e.dtype);var n=new pt(e.shape,FS);return this.compileAndRun(n,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,zS,e.dtype);var n=new pt(e.shape,zS);return this.compileAndRun(n,[e])},t.prototype.sign=function(e){var n=new pt(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[e])},t.prototype.isNaN=function(e){var n=new pt(e.shape,"return float(isnan(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.isInf=function(e){var n=new pt(e.shape,"return float(isinf(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.isFinite=function(e){var n=new pt(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.round=function(e){var n=new pt(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,VS,e.dtype);var n=new pt(e.shape,VS);return this.compileAndRun(n,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,BS,e.dtype);var n=new pt(e.shape,BS);return this.compileAndRun(n,[e])},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var n=new pt(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[e])},t.prototype.log1p=function(e){var n=new pt(e.shape,"return log(1.0 + x);");return this.compileAndRun(n,[e])},t.prototype.sqrt=function(e){var n=new pt(e.shape,"return sqrt(x);");return this.compileAndRun(n,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var n=new pt(e.shape,"return inversesqrt(x);");return this.compileAndRun(n,[e])},t.prototype.reciprocal=function(e){var n=new pt(e.shape,"return 1.0 / x;");return this.compileAndRun(n,[e])},t.prototype.relu=function(e){var n;return n=he().getBool("WEBGL_PACK")?new Qh(e.shape,cN):new pt(e.shape,sN),this.compileAndRun(n,[e])},t.prototype.relu6=function(e){var n;return n=he().getBool("WEBGL_PACK")?new Qh(e.shape,hN):new pt(e.shape,uN),this.compileAndRun(n,[e])},t.prototype.prelu=function(e,n){var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(Wk,e.shape,n.shape):new fn(jk,e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.elu=function(e){if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dN,e.dtype);var n=new pt(e.shape,lN);return this.compileAndRun(n,[e])},t.prototype.eluDer=function(e,n){var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,n.shape):new fn("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.selu=function(e){var n=new pt(e.shape,d5);return this.compileAndRun(n,[e])},t.prototype.int=function(e){var n=new pt(e.shape,"return float(int(x));");return this.compileAndRun(n,[e],"int32")},t.prototype.clip=function(e,n,i){var o,a=(o=he().getBool("WEBGL_PACK_CLIP")?new s6(e.shape):new a6(e.shape)).getCustomSetupFunc(n,i);return this.compileAndRun(o,[e],null,a)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,MS,e.dtype);var n=new pt(e.shape,MS);return this.compileAndRun(n,[e])},t.prototype.complexAbs=function(e){var n=this.texData.get(e.dataId),i=new u6(e.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)];return this.compileAndRun(i,o)},t.prototype.sigmoid=function(e){var n=new pt(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[e])},t.prototype.softplus=function(e){var n=new pt(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[e])},t.prototype.sin=function(e){var n=new pt(e.shape,p5);return this.compileAndRun(n,[e])},t.prototype.cos=function(e){var n=new pt(e.shape,f5);return this.compileAndRun(n,[e])},t.prototype.tan=function(e){var n=new pt(e.shape,"return tan(x);");return this.compileAndRun(n,[e])},t.prototype.asin=function(e){var n=new pt(e.shape,m5);return this.compileAndRun(n,[e])},t.prototype.acos=function(e){var n=new pt(e.shape,g5);return this.compileAndRun(n,[e])},t.prototype.atan=function(e){var n=new pt(e.shape,v5);return this.compileAndRun(n,[e])},t.prototype.atan2=function(e,n){var i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ra(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,n.shape);return this.compileAndRun(i,[e,n])},t.prototype.sinh=function(e){var n=new pt(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[e])},t.prototype.cosh=function(e){var n=new pt(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[e])},t.prototype.tanh=function(e){var n=new pt(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[e])},t.prototype.asinh=function(e){var n=new pt(e.shape,y5);return this.compileAndRun(n,[e])},t.prototype.acosh=function(e){var n=new pt(e.shape,w5);return this.compileAndRun(n,[e])},t.prototype.atanh=function(e){var n=new pt(e.shape,b5);return this.compileAndRun(n,[e])},t.prototype.erf=function(e){var n=new pt(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[e])},t.prototype.step=function(e,n){var i=new pt(e.shape,function(o){return o===void 0&&(o=0),io+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(n));return this.compileAndRun(i,[e])},t.prototype.conv2dByMatMul=function(e,n,i,o,a,s){var u=e.shape,c=this.texData.get(e.dataId),d=i.inChannels,p=u[0]*u[1]*u[2],f=i.outChannels,g=i.dataFormat==="channelsLast",y=(p===1||f===1)&&d>1e3,x=u[2]%2!=0&&!!c.isPacked;if(y||!he().getBool("WEBGL_LAZILY_UNPACK")||!he().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!x){var b=g?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],_=this.reshape(e,[1,b,i.inChannels]),C=this.reshape(n,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:_,b:C,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var T=g?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),D={dataId:e.dataId,shape:[1,T,i.inChannels],dtype:e.dtype},O=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,W(sd(c.shape,D.shape),function(){return"packed reshape "+c.shape+" to "+D.shape+" isn't free"});var z=this.reshape(n,[1,i.inChannels,i.outChannels]),I=this.fusedBatchMatMul({a:D,b:z,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),S=this.texData.get(I.dataId);return W(S.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=O,S.shape=i.outShape,K.makeTensorFromDataId(I.dataId,i.outShape,I.dtype)},t.prototype.conv2dWithIm2Row=function(e,n,i,o,a,s){var u=i.filterWidth,c=i.filterHeight,d=i.inChannels,p=i.outWidth,f=i.outHeight,g=i.dataFormat==="channelsLast",y=u*c*d,x=f*p,b=[y,x],_=e.squeeze([0]),C=n.reshape([1,y,-1]),T=new L6(b,_.shape,i),D=this.compileAndRun(T,[_]).reshape([1,b[0],b[1]]),O=o!=null,z=s!=null,I=a?nm(a,!0):null,S=new q0(D.shape,[1,x,i.outChannels],!0,!1,O,I,z),A=[D,C];o&&A.push(o),z&&A.push(s);var N=this.compileAndRun(S,A);return g?N.reshape([1,f,p,i.outChannels]):N.reshape([1,i.outChannels,f,p])},t.prototype.fusedConv2d=function(e){var n=e.input,i=e.filter,o=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,i,o,a,s,u);if(he().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,i,o,a,s,u);var c=a!=null,d=u!=null,p=s?nm(s,!1):null,f=new SS(o,c,p,d),g=[n,i];return a&&g.push(a),u&&g.push(u),this.compileAndRun(f,g)},t.prototype.conv2d=function(e,n,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(e,n,i);if(he().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,n,i);var o=new SS(i);return this.compileAndRun(o,[e,n])},t.prototype.conv2dDerInput=function(e,n,i){var o=new d6(i);return this.compileAndRun(o,[e,n])},t.prototype.conv2dDerFilter=function(e,n,i){var o=new h6(i);return this.compileAndRun(o,[e,n])},t.prototype.fusedDepthwiseConv2D=function(e){var n,i=e.input,o=e.filter,a=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,d=he().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,p=u?nm(u,d):null,f=[i,o],g=s!=null,y=c!=null;return g&&f.push(s),y&&f.push(c),d?(n=new AS(a,g,p,y),this.compileAndRun(n,f)):(n=new TS(a,g,p,y),this.compileAndRun(n,f))},t.prototype.depthwiseConv2D=function(e,n,i){var o;return he().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new AS(i),this.compileAndRun(o,[e,n])):(o=new TS(i),this.compileAndRun(o,[e,n]))},t.prototype.depthwiseConv2DDerInput=function(e,n,i){var o=new g6(i);return this.compileAndRun(o,[e,n])},t.prototype.depthwiseConv2DDerFilter=function(e,n,i){var o=new m6(i);return this.compileAndRun(o,[e,n])},t.prototype.conv3d=function(e,n,i){var o=new v6(i);return this.compileAndRun(o,[e,n])},t.prototype.conv3dDerInput=function(e,n,i){var o=new f6(i);return this.compileAndRun(o,[e,n])},t.prototype.conv3dDerFilter=function(e,n,i){var o=new p6(i);return this.compileAndRun(o,[e,n])},t.prototype.maxPool=function(e,n){var i=new H0(n,"max",!1);return this.compileAndRun(i,[e])},t.prototype.avgPool=function(e,n){var i=new H0(n,"avg",!1);return this.compileAndRun(i,[e],"float32")},t.prototype.maxPoolBackprop=function(e,n,i,o){var a=new H0(o,"max",!0),s=this.compileAndRun(a,[n]),u=new B6(o),c=this.compileAndRun(u,[e,s],n.dtype);return s.dispose(),c},t.prototype.avgPoolBackprop=function(e,n,i){var o=new e6(i);return this.compileAndRun(o,[e],n.dtype)},t.prototype.cast=function(e,n){return Yb(e,n,this)},t.prototype.unstack=function(e,n){for(var i=e.shape[n],o=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==n&&(o[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[n]=1;var d=new Array(i);for(s=0;s<d.length;s++)u[n]=s,d[s]=this.slice(e,u,c).reshape(o);return d},t.prototype.avgPool3d=function(e,n){var i=new $0(n,"avg",!1);return this.compileAndRun(i,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,n,i){var o=new t6(i);return this.compileAndRun(o,[e],n.dtype)},t.prototype.maxPool3d=function(e,n){var i=new $0(n,"max",!1);return this.compileAndRun(i,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,n,i,o){var a=new $0(o,"max",!0),s=this.compileAndRun(a,[n]),u=new U6(o),c=this.compileAndRun(u,[e,s],n.dtype);return s.dispose(),c},t.prototype.reshape=function(e,n){var i=this.texData.get(e.dataId);if(i.isPacked&&!sd(e.shape,n)&&(i.texture===null||!sd(i.shape,n))){var o=this.packedReshape(e,n);return K.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return pg(e,n)},t.prototype.resizeBilinear=function(e,n,i,o){var a=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Y6(e.shape,n,i,o):new Q6(e.shape,n,i,o);return this.compileAndRun(a,[e])},t.prototype.resizeBilinearBackprop=function(e,n,i){var o=new X6(e,n,i);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighbor=function(e,n,i,o){var a=new Z6(e.shape,n,i,o);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,n,i){var o=new J6(e,n,i);return this.compileAndRun(o,[e])},t.prototype.multinomial=function(e,n,i,o){var a=n?e:nl(e),s=a.shape[0],u=a.shape[1],c=new j6(s,u,i),d=c.getCustomSetupFunc(o);return this.compileAndRun(c,[a],"int32",d)},t.prototype.oneHot=function(e,n,i,o){var a=new W6(e.size,n,i,o);return this.compileAndRun(a,[e])},t.prototype.diag=function(e){var n=new E6(e.size);return this.compileAndRun(n,[e])},t.prototype.nonMaxSuppression=function(e,n,i,o,a){return Zw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Zb(e.dataSync(),n.dataSync(),i,o,a)},t.prototype.cropAndResize=function(e,n,i,o,a,s){var u=new y6(e.shape,n.shape,o,a,s);return this.compileAndRun(u,[e,n,i])},t.prototype.depthToSpace=function(e,n,i){W(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var o=e.shape[0],a=i==="NHWC"?e.shape[1]:e.shape[2],s=i==="NHWC"?e.shape[2]:e.shape[3],u=i==="NHWC"?e.shape[3]:e.shape[1],c=a*n,d=s*n,p=u/(n*n),f=new _6(i==="NHWC"?[o,c,d,p]:[o,p,c,d],n,i);return this.compileAndRun(f,[e])},t.prototype.split=function(e,n,i){return Lk(e,n,i)},t.prototype.scatterND=function(e,n,i){var o=hg(0,e,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,c=o.strides,d=o.outputSize,p=[d/u,u],f=e.reshape([s,a]),g=n.reshape([s,u]);if(d===0)return pg(xn([]),i);var y=Ve(0),x=new DS(s,a,f.rank,g.rank,c,p);return this.compileAndRun(x,[g,f,y]).reshape(i)},t.prototype.sparseToDense=function(e,n,i,o){var a=hg(0,e,i),s=a.sliceRank,u=a.numUpdates,c=a.strides,d=a.outputSize,p=new DS(u,s,e.rank,n.rank,c,[d,1],!1);return this.compileAndRun(p,[n,e,o]).reshape(i)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,n){var i=this.texData.get(e.dataId),o=new kS(A6,e.shape,n),a=new kS(R6,e.shape,n),s=[this.makeComplexComponentTensorInfo(e,i.complexTensors.real),this.makeComplexComponentTensorInfo(e,i.complexTensors.imag)],u=this.compileAndRun(o,s),c=this.compileAndRun(a,s),d=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),d},t.prototype.gatherND=function(e,n){var i=n.shape,o=i[i.length-1],a=kk(e,n),s=a[0],u=a[1],c=a[2],d=a[3],p=n.reshape([u,o]),f=e.reshape([e.size/c,c]),g=new P6(o,d,[u,c]);return this.compileAndRun(g,[f,p]).reshape(s)},t.prototype.fill=function(e,n,i){if((i=i||Xc(n))==="string"){var o=kd(i,He(e));return o.fill(n),K.makeTensor(o,e,i,this)}var a=new k6(e,n),s=a.getCustomSetupFunc(n);return this.compileAndRun(a,[],i,s)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},t.prototype.linspace=function(e,n,i){return Jb(e,n,i)},t.prototype.makeTensorInfo=function(e,n){var i=this.write(null,e,n);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:n}},t.prototype.makeOutput=function(e,n){var i=this.makeTensorInfo(e,n).dataId;return K.makeTensorFromDataId(i,e,n,this)},t.prototype.unpackTensor=function(e){var n=new _5(e.shape);return this.runWebGLProgram(n,[e],e.dtype)},t.prototype.packTensor=function(e){var n=new q6(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,n){var i=[Pd(e.shape)].concat(Md(e.shape)),o={dtype:e.dtype,shape:i,dataId:e.dataId},a=[Pd(n)].concat(Md(n)),s=new K6(a,i),u=this.runWebGLProgram(s,[o],e.dtype,null,!0);return{dataId:u.dataId,shape:n,dtype:u.dtype}},t.prototype.decode=function(e){var n,i=this.texData.get(e),o=i.isPacked,a=i.shape,s=i.dtype,u=Rm(a);return n=o?new x6(u):new b6(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(n,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,n,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(e.outputShape,i),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Od.DENSE){var d=gd(e.outputShape);c.texShape=d.map(function(T){return 2*T})}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),He(u.shape)===0)return c.values=Rd(u.dtype,0),u;var p=[],f=n.map(function(T){if(T.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var D=s.texData.get(T.dataId);if(D.texture==null){if(!e.packedInputs&&He(T.shape)<=he().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:T.shape,texData:null,isUniform:!0,uniformValues:D.values};e.packedInputs&&(D.isPacked=!0,D.shape=T.shape)}else if(!!D.isPacked!=!!e.packedInputs)T=D.isPacked?s.unpackTensor(T):s.packTensor(T),p.push(T),D=s.texData.get(T.dataId);else if(D.isPacked&&!sd(D.shape,T.shape)){var O=T,z=T.shape;T.shape=D.shape,T=s.packedReshape(T,z),p.push(T),D=s.texData.get(T.dataId),O.shape=z}return s.uploadToGPU(T.dataId),{shape:T.shape,texData:D,isUniform:!1}});this.uploadToGPU(u.dataId);var g,y={shape:u.shape,texData:c,isUniform:!1},x=function(T,D,O){var z="";D.concat(O).forEach(function(A){var N=A.texData!=null&&A.texData.slice!=null&&A.texData.slice.flatOffset>0,P=A.isUniform?"uniform":A.texData.texShape;z+=A.shape+"_"+P+"_"+N});var I=T.userCode,S=T.constructor.name;return S+="_"+z+"_"+I}(e,f,y),b=this.getAndSaveBinary(x,function(){return function(T,D,O,z){var I=D.userCode,S=O.map(function(H,ie){var J={logicalShape:H.shape,texShape:H.isUniform?null:H.texData.texShape,isUniform:H.isUniform,isPacked:!H.isUniform&&H.texData.isPacked,flatOffset:null};return H.texData!=null&&H.texData.slice!=null&&H.texData.slice.flatOffset>0&&(J.flatOffset=H.texData.slice.flatOffset),{name:D.variableNames[ie],shapeInfo:J}}),A=S.map(function(H){return H.shapeInfo}),N={logicalShape:z.shape,texShape:z.texData.texShape,isUniform:!1,isPacked:z.texData.isPacked,flatOffset:null},P=KW(S,N,I,D.packedInputs),M=T.createProgram(P),F=null,G=T.getUniformLocation(M,"NAN",!1);he().getNumber("WEBGL_VERSION")===1&&(F=T.getUniformLocation(M,"INFINITY",!1));for(var Z={},Y=0;Y<D.variableNames.length;Y++){var ee=D.variableNames[Y];Z[ee]=T.getUniformLocation(M,ee,!1),Z["offset"+ee]=T.getUniformLocation(M,"offset"+ee,!1)}return{program:D,source:P,webGLProgram:M,uniformLocations:Z,inShapeInfos:A,outShapeInfo:N,infLoc:F,nanLoc:G}}(s.gpgpu,e,f,y)}),_=this.activeTimers!=null;if(_&&(g=this.startTimer()),function(T,D,O,z,I){NS(D.inShapeInfos,O),NS([D.outShapeInfo],[z]);var S=z.texData.texture,A=z.texData.texShape;z.texData.isPacked?T.setOutputPackedMatrixTexture(S,A[0],A[1]):T.setOutputMatrixTexture(S,A[0],A[1]),T.setProgram(D.webGLProgram),he().getNumber("WEBGL_VERSION")===1&&D.infLoc!==null&&T.gl.uniform1f(D.infLoc,1/0),D.nanLoc!==null&&T.gl.uniform1f(D.nanLoc,NaN),O.forEach(function(N,P){var M=D.program.variableNames[P],F=D.uniformLocations[M],G=D.uniformLocations["offset"+M];if(F!=null)if(N.isUniform)if(He(N.shape)<2)T.gl.uniform1f(F,N.uniformValues[0]);else{var Z=N.uniformValues;Z instanceof Float32Array||(Z=new Float32Array(Z)),T.gl.uniform1fv(F,Z)}else N.texData.slice!=null&&G!=null&&T.gl.uniform1i(G,N.texData.slice.flatOffset),T.setInputMatrixTexture(N.texData.texture,F,P)}),I!=null&&I(T,D.webGLProgram),T.executeProgram()}(this.gpgpu,b,f,y,o),p.forEach(function(T){return s.disposeData(T.dataId)}),_&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)})),!he().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){var C=this.unpackTensor(u);return this.disposeData(u.dataId),C}return u},t.prototype.compileAndRun=function(e,n,i,o,a){a===void 0&&(a=!1),i=i||n[0].dtype;var s=this.runWebGLProgram(e,n,i,o,a);return K.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ue(function(){if(!he().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=he().getBool("DEBUG");he().set("DEBUG",!1);var i=e.abs(Ve(1e-8)).dataSync()[0];if(he().set("DEBUG",n),i>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var n,i=this.texData.get(e),o=i.shape,a=i.dtype,s=i.values,u=i.texture,c=i.usage,d=i.isPacked;if(u==null){var p,f=this.activeTimers!=null;f&&(p=$i());var g=i.texShape;if(g==null&&(g=sk(o,d),i.texShape=g),s!=null){var y=Rm(o),x=void 0,b=g[1],_=g[0],C=s instanceof Uint8Array;d?(b=(n=ap(g[0],g[1]))[0],_=n[1],x=new T6(y,[_,b],C)):x=new S6(y,[_,b],C);var T=this.makeTensorInfo([_,b],a);this.texData.get(T.dataId).usage=C?oi.PIXELS:oi.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(T.dataId),b,_,s);var D=this.runWebGLProgram(x,[T],a,null,!0),O=this.texData.get(D.dataId);i.texture=O.texture,i.texShape=O.texShape,i.isPacked=O.isPacked,i.usage=O.usage,this.disposeData(T.dataId),this.texData.delete(D.dataId),i.values=null,f&&(this.uploadWaitMs+=$i()-p)}else{var z=this.acquireTexture(g,c,a,d);i.texture=z}}},t.prototype.convertAndCacheOnCPU=function(e,n){var i=this.texData.get(e),o=i.dtype;return this.releaseGPUData(e),n!=null&&(i.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(n,o)),i.values},t.prototype.acquireTexture=function(e,n,i,o){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,n,o)},t.prototype.computeBytes=function(e,n){return e[0]*e[1]*Tb(n)},t}(Xb);UR()&&K.registerBackend("webgl",function(){return new pN},2);var ix=X({square_:function(r){var t=j(r,"x","square"),e=[t];return K.runKernelFunc(function(n,i){return i([t]),n.square(t)},{x:t},function(n,i){var o=i[0];return{x:function(){return n.mul(o.toFloat().mul(2))}}},"Square",{},e,[])}}),ks=X({abs_:function(r){var t=j(r,"x","abs");return t.dtype==="complex64"?K.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):K.runKernelFunc(function(e,n){var i=e.abs(t);return n([t]),i},{x:t},function(e,n){var i=n[0];return{x:function(){return e.mul(i.toFloat().step(-1))}}},"Abs")}}),ox=X({acos_:function(r){var t=j(r,"x","acos");return K.runKernelFunc(function(e,n){var i=e.acos(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.divStrict(Ve(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),ax=X({acosh_:function(r){var t=j(r,"x","acosh");return K.runKernelFunc(function(e,n){var i=e.acosh(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),sx=X({asin_:function(r){var t=j(r,"x","asin");return K.runKernelFunc(function(e,n){var i=e.asin(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.divStrict(Ve(1).sub(i.toFloat().square()).sqrt())}}})}}),ux=X({asinh_:function(r){var t=j(r,"x","asinh");return K.runKernelFunc(function(e,n){var i=e.asinh(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.divStrict(Ve(1).add(i.toFloat().square()).sqrt())}}})}}),lx=X({atan_:function(r){var t=j(r,"x","atan");return K.runKernelFunc(function(e,n){var i=e.atan(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.toFloat().square().add(1))}}})}}),cx=X({atanh_:function(r){var t=j(r,"x","atanh");return K.runKernelFunc(function(e,n){var i=e.atanh(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(Ve(1).sub(i.toFloat().square()))}}})}}),hx=X({ceil_:function(r){var t=j(r,"x","ceil");return K.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),Rr=X({clipByValue_:function(r,t,e){var n=j(r,"x","clipByValue");return W(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."}),K.runKernelFunc(function(i,o){var a=i.clip(n,t,e);return o([n]),a},{$x:n},function(i,o){var a=o[0];return{$x:function(){return i.where(a.greaterEqual(t).logicalAnd(a.lessEqual(e)),Ct(i))}}})}}),dx=X({cos_:function(r){var t=j(r,"x","cos");return K.runKernelFunc(function(e,n){var i=e.cos(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return i.toFloat().sin().neg().mul(e)}}})}}),px=X({cosh_:function(r){var t=j(r,"x","cosh");return K.runKernelFunc(function(e,n){var i=e.cosh(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(e)}}})}}),fx=X({erf_:function(r){var t=j(r,"x","erf");return W(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),K.runKernelFunc(function(e,n){var i=e.erf(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),mx=X({exp_:function(r){var t=j(r,"x","exp");return K.runKernelFunc(function(e,n){var i=e.exp(t);return n([i]),i},{$x:t},function(e,n){return{$x:function(){return e.mulStrict(n[0])}}})}}),gx=X({expm1_:function(r){var t=j(r,"x","expm1");return K.runKernelFunc(function(e,n){var i=e.expm1(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.mul(i.exp())}}})}}),uv=X({floor_:function(r){var t=j(r,"x","floor");return K.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),Ea=X({log_:function(r){var t=j(r,"x","log");return K.runKernelFunc(function(e,n){var i=e.log(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.toFloat())}}})}}),vx=X({log1p_:function(r){var t=j(r,"x","log1p");return K.runKernelFunc(function(e,n){var i=e.log1p(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.add(1))}}})}}),fN=X({logSigmoid_:function(r){var t=j(r,"x","logSigmoid");return K.runKernelFunc(function(e,n){var i=e.softplus(t.neg()).neg();return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.mul(i.neg().sigmoid())}}})}}),rl=X({neg_:function(r){var t=j(r,"x","neg");return K.runKernelFunc(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}}),yx=X({reciprocal_:function(r){var t=j(r,"x","reciprocal");return K.runKernelFunc(function(e,n){var i=e.reciprocal(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.square().neg())}}})}}),wx=X({round_:function(r){var t=j(r,"x","round");return K.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),lv=X({rsqrt_:function(r){var t=j(r,"x","rsqrt");return K.runKernelFunc(function(e,n){var i=e.rsqrt(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.pow(1.5).mul(2)).neg()}}})}}),cv=X({sigmoid_:function(r){var t=j(r,"x","sigmoid");return K.runKernelFunc(function(e,n){var i=e.sigmoid(t);return n([i]),i},{x:t},function(e,n){var i=n[0];return{x:function(){return e.mul(i.mul(Ve(1).sub(i)))}}},"Sigmoid")}}),bx=X({sign_:function(r){var t=j(r,"x","sign");return K.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),mN=X({isNaN_:function(r){var t=j(r,"x","isNaN");return K.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),gN=X({isInf_:function(r){var t=j(r,"x","isInf");return K.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),vN=X({isFinite_:function(r){var t=j(r,"x","isFinite");return K.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ct(e)}}})}}),xx=X({sin_:function(r){var t=j(r,"x","sin");return K.runKernelFunc(function(e,n){var i=e.sin(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return i.toFloat().cos().mul(e)}}})}}),_x=X({sinh_:function(r){var t=j(r,"x","sinh");return K.runKernelFunc(function(e,n){var i=e.sinh(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(e)}}})}}),hp=X({softplus_:function(r){var t=j(r,"x","softplus");return K.runKernelFunc(function(e,n){var i=e.softplus(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.mul(i.sigmoid())}}})}}),dp=X({sqrt_:function(r){var t=j(r,"x","sqrt");return K.runKernelFunc(function(e,n){var i=e.sqrt(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.toFloat().sqrt().mul(2))}}})}}),yN=X({step_:function(r,t){t===void 0&&(t=0);var e=j(r,"x","step");return K.runKernelFunc(function(n){return n.step(e,t)},{$x:e},function(n){return{$x:function(){return Ct(n)}}})}}),Ex=X({tan_:function(r){var t=j(r,"x","tan");return K.runKernelFunc(function(e,n){var i=e.tan(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.div(i.cos().square())}}})}}),hv=X({tanh_:function(r){var t=j(r,"x","tanh");return K.runKernelFunc(function(e,n){var i=e.tanh(t);return n([i]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return Ve(1).sub(i.square()).mulStrict(e)}}})}});function wN(r,t,e,n,i,o){var a,s,u=j(r,"x","batchNorm"),c=j(t,"mean","batchNorm"),d=j(e,"variance","batchNorm");return i!=null&&(a=j(i,"scale","batchNorm")),n!=null&&(s=j(n,"offset","batchNorm")),W(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),W(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),W(d.rank===2||d.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."}),a!=null&&W(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&W(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),pp(u,c,d,s,a,o)}function bN(r,t,e,n,i,o){var a,s,u=j(r,"x","batchNorm"),c=j(t,"mean","batchNorm"),d=j(e,"variance","batchNorm");return i!=null&&(a=j(i,"scale","batchNorm")),n!=null&&(s=j(n,"offset","batchNorm")),W(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),W(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),W(d.rank===3||d.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."}),a!=null&&W(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&W(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),pp(u,c,d,s,a,o)}function xN(r,t,e,n,i,o){var a,s,u=j(r,"x","batchNorm"),c=j(t,"mean","batchNorm"),d=j(e,"variance","batchNorm");return i!=null&&(a=j(i,"scale","batchNorm")),n!=null&&(s=j(n,"offset","batchNorm")),W(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),W(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),W(d.rank===4||d.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."}),a!=null&&W(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&W(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),pp(u,c,d,s,a,o)}function pp(r,t,e,n,i,o){o==null&&(o=.001);var a,s,u,c=j(r,"x","batchNorm"),d=j(t,"mean","batchNorm"),p=j(e,"variance","batchNorm");i!=null&&(a=j(i,"scale","batchNorm")),n!=null&&(s=j(n,"offset","batchNorm")),W(d.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),W(s==null||d.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),W(a==null||d.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var f=[c,d,p,a];return K.runKernelFunc(function(g,y){var x=g.batchNormalization(u,rm(d),rm(p),o,rm(a),rm(s));return y([c,d,p,a]),x},{x:c,mean:d,variance:p,scale:a,offset:s},function(g,y){var x=y,b=x[0],_=x[1],C=x[2],T=x[3],D=T??Ve(1),O=kn(_.shape,u.shape),z=[];if(_.rank===1){for(var I=0;I<u.shape.length-1;++I)z.push(u.shape[I]);z.push(1)}var S=b.sub(_),A=g.mul(D),N=lv(C.add(Ve(o))),P=N.mul(N).mul(N).mul(Ve(-.5));return{x:function(){return _.rank===1?g.mul(ws(N.as4D(1,1,1,_.shape[0]),z)).mul(D).reshape(b.shape):g.mul(N).mul(D).reshape(b.shape)},mean:function(){var M=N.mul(Ve(-1)).mul(A);return _.rank===1&&(M=M.sum(O)),M.reshape(_.shape)},variance:function(){var M=P.mul(S).mul(A);return _.rank===1&&(M=M.sum(O)),M.reshape(_.shape)},scale:function(){var M=S.mul(N),F=g.mul(M);return _.rank===1&&(F=F.sum(O)),F.reshape(_.shape)},offset:function(){var M=g;return _.rank===1&&(M=M.sum(O)),M.reshape(_.shape)}}},"BatchNormalization",{varianceEpsilon:o},f).reshape(c.shape)}function rm(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function dv(){Qg("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var _N=X({batchNormalization2d_:function(r,t,e,n,i,o){return n===void 0&&(n=.001),dv(),wN(r,t,e,o,i,n)}}),EN=X({batchNormalization3d_:function(r,t,e,n,i,o){return n===void 0&&(n=.001),dv(),bN(r,t,e,o,i,n)}}),IN=X({batchNormalization4d_:function(r,t,e,n,i,o){return n===void 0&&(n=.001),dv(),xN(r,t,e,o,i,n)}}),CN=X({batchNormalization_:function(r,t,e,n,i,o){return n===void 0&&(n=.001),dv(),pp(r,t,e,o,i,n)}}),Ix=X({batchNorm_:pp}),Cx=X({batchNorm2d_:wN}),Sx=X({batchNorm3d_:bN}),Tx=X({batchNorm4d_:xN}),Ra=X({logicalAnd_:function(r,t){var e=j(r,"a","logicalAnd","bool"),n=j(t,"b","logicalAnd","bool");return xt(e.shape,n.shape),K.runKernelFunc(function(i){return i.logicalAnd(e,n)},{$a:e,$b:n})}}),Ax=X({logicalNot_:function(r){var t=j(r,"x","logicalNot","bool");return K.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),pv=X({logicalOr_:function(r,t){var e=j(r,"a","logicalOr","bool"),n=j(t,"b","logicalOr","bool");return xt(e.shape,n.shape),K.runKernelFunc(function(i){return i.logicalOr(e,n)},{$a:e,$b:n})}}),SN=X({logicalXor_:function(r,t){var e=j(r,"a","logicalXor","bool"),n=j(t,"b","logicalXor","bool");return xt(e.shape,n.shape),pv(r,t).logicalAnd(Ra(r,t).logicalNot())}}),Ia=X({where_:function(r,t,e){var n=j(t,"a","where"),i=j(e,"b","where"),o=j(r,"condition","where","bool");return Nt(n.shape,i.shape,"Error in where: "),o.rank===1?W(o.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Nt(o.shape,i.shape,"Error in where: "),K.runKernelFunc(function(a,s){var u=a.select(o,n,i);return s([o]),u},{$condition:o,$a:n,$b:i},function(a,s){var u=s[0];return{$condition:function(){return Ct(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),fv=function(r){return Ue(this,void 0,void 0,function(){var t,e,n;return je(this,function(i){switch(i.label){case 0:return[4,(t=j(r,"condition","whereAsync","bool")).data()];case 1:return e=i.sent(),n=ex(t.shape,e),r!==t&&t.dispose(),[2,n]}})})},yt=X({add_:function(r,t){var e,n=j(r,"a","add"),i=j(t,"b","add");e=gn(n,i),n=e[0],i=e[1];var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a){return a.add(n,i)},{a:n,b:i},function(a){return{a:function(){var s=a,u=kn(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=kn(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}},"Add")}}),Rx=X({addN_:function(r){W(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),W(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var t=r.map(function(i,o){return j(i,"tensors"+o,"addN")}),e=t[0];t.forEach(function(i){if(i.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(i){if(!Qn(i.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=t;return K.runKernelFunc(function(i){return i.addN(t)},n,function(i){var o={};return t.forEach(function(a,s){o[s]=function(){return i.clone()}}),o})}}),TN=X({addStrict_:function(r,t){var e=j(r,"a","addStrict"),n=j(t,"b","addStrict");return Nt(e.shape,n.shape,"Error in addStrict: "),e.add(n)}}),kx=X({atan2_:function(r,t){var e,n=j(r,"a","atan2"),i=j(t,"b","atan2");e=gn(n,i),n=e[0],i=e[1];var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a,s){var u=a.atan2(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],c=s[1];return{$a:function(){var d=yt(u.square(),c.square()),p=a.mul(c.div(d)),f=kn(u.shape,o);return f.length>0&&(p=p.sum(f)),p.reshape(u.shape)},$b:function(){var d=yt(u.square(),c.square()),p=rl(a.mul(u.div(d))),f=kn(c.shape,o);return f.length>0&&(p=p.sum(f)),p.reshape(c.shape)}}})}}),xr=X({div_:function(r,t){var e,n=j(r,"a","div"),i=j(t,"b","div");if(e=gn(n,i),n=e[0],i=e[1],n.dtype==="int32"&&i.dtype==="int32")return mv(n,i);var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a,s){var u=a.realDivide(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){var d=a.div(c.toFloat()),p=kn(u.shape,o);return p.length>0?d.sum(p).reshape(u.shape):d},b:function(){var d=a.mul(u.toFloat()),p=kn(c.shape,o);p.length>0&&(d=d.sum(p).reshape(c.shape));var f=c.square();return d.div(f.toFloat()).neg()}}},"Div")}}),AN=X({divStrict_:function(r,t){var e=j(r,"a","div"),n=j(t,"b","div");return Nt(e.shape,n.shape,"Error in divideStrict: "),e.div(n)}}),mv=X({floorDiv_:function(r,t){var e,n=j(r,"a","floorDiv"),i=j(t,"b","floorDiv");e=gn(n,i),n=e[0],i=e[1];var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a,s){var u=a.floorDiv(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],c=s[1];return{$a:function(){var d=a.div(c.toFloat()),p=kn(u.shape,o);return p.length>0?d.sum(p).reshape(u.shape):d},$b:function(){var d=a.mul(u.toFloat()),p=kn(c.shape,o);p.length>0&&(d=d.sum(p).reshape(c.shape));var f=c.square();return d.div(f.toFloat()).neg()}}})}}),Fo=X({maximum_:function(r,t){var e,n=j(r,"a","maximum"),i=j(t,"b","maximum");return e=gn(n,i),n=e[0],i=e[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),xt(n.shape,i.shape),K.runKernelFunc(function(o,a){var s=o.maximum(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.greaterEqual(u).toFloat())},$b:function(){return o.mul(s.less(u).toFloat())}}})}}),RN=X({maximumStrict_:function(r,t){var e=j(r,"a","maximumStrict"),n=j(t,"b","maximumStrict");return Nt(e.shape,n.shape,"Error in maximumStrict: "),e.maximum(n)}}),Zc=X({minimum_:function(r,t){var e,n=j(r,"a","minimum"),i=j(t,"b","minimum");return e=gn(n,i),n=e[0],i=e[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),xt(n.shape,i.shape),K.runKernelFunc(function(o,a){var s=o.minimum(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.lessEqual(u).toFloat())},$b:function(){return o.mul(s.greater(u).toFloat())}}})}}),kN=X({minimumStrict_:function(r,t){var e=j(r,"a","minimumStrict"),n=j(t,"b","minimumStrict");return Nt(e.shape,n.shape,"Error in minimumStrict: "),e.minimum(n)}}),Nx=X({mod_:function(r,t){var e,n=j(r,"a","mod"),i=j(t,"b","mod");e=gn(n,i),n=e[0],i=e[1];var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a,s){var u=a.mod(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],c=s[1];return{$a:function(){var d=kn(u.shape,o);return d.length>0?a.sum(d).reshape(u.shape):a},$b:function(){var d=a.mul(u.div(c).floor().neg()),p=kn(c.shape,o);return p.length>0?d.sum(p).reshape(c.shape):d}}})}}),NN=X({modStrict_:function(r,t){var e=j(r,"a","modStrict"),n=j(t,"b","modStrict");return Nt(e.shape,n.shape,"Error in modStrict: "),e.mod(n)}}),ot=X({mul_:function(r,t){var e,n=j(r,"a","mul"),i=j(t,"b","mul");e=gn(n,i),n=e[0],i=e[1];var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a,s){var u=a.multiply(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){var d=a.mul(c.toFloat()),p=kn(u.shape,o);return p.length>0?d.sum(p).reshape(u.shape):d},b:function(){var d=a.mul(u.toFloat()),p=kn(c.shape,o);return p.length>0?d.sum(p).reshape(c.shape):d}}},"Mul")}}),gv=X({mulStrict_:function(r,t){var e=j(r,"a","mul"),n=j(t,"b","mul");return Nt(e.shape,n.shape,"Error in multiplyStrict: "),e.mul(n)}}),Nc=X({pow_:function(r,t){var e=j(r,"base","pow"),n=j(t,"exp","pow"),i=xt(e.shape,n.shape);return r=e.cast(Tn(e.dtype,n.dtype)),t=n.cast(Tn(e.dtype,n.dtype)),K.runKernelFunc(function(o,a){var s=o.pow(e,n);return a([e,n,s]),s},{$base:e,$exp:n},function(o,a){var s=a[0],u=a[1],c=a[2];return{$base:function(){var d=u.toFloat(),p=o.mul(d.mul(s.pow(d.sub(Ve(1))))),f=kn(s.shape,i);return f.length>0&&(p=p.sum(f)),p.reshape(s.shape)},$exp:function(){var d=s.greater(0),p=s.log().where(d,Ct(s)),f=o.mul(c.mul(p)),g=kn(u.shape,i);return g.length>0&&(f=f.sum(g)),f.reshape(u.shape)}}})}}),DN=X({powStrict_:function(r,t){return Nt(r.shape,t.shape,"Error in powStrict: "),r.pow(t)}}),Dx=X({squaredDifference_:function(r,t){var e,n=j(r,"a","squaredDifference"),i=j(t,"b","squaredDifference");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o,a){var s=o.squaredDifference(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1],c=Ve(2);return{$a:function(){return o.mul(s.sub(u).mul(c))},$b:function(){return o.mul(u.sub(s).mul(c))}}})}}),ON=X({squaredDifferenceStrict_:function(r,t){var e=j(r,"a","squaredDifferenceStrict"),n=j(t,"b","squaredDifferenceStrict");return Nt(e.shape,n.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(n)}}),Yn=X({sub_:function(r,t){var e,n=j(r,"a","sub"),i=j(t,"b","sub");e=gn(n,i),n=e[0],i=e[1];var o=xt(n.shape,i.shape);return K.runKernelFunc(function(a){return a.subtract(n,i)},{a:n,b:i},function(a){return{a:function(){var s=a,u=kn(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=kn(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}},"Sub")}}),PN=X({subStrict_:function(r,t){var e=j(r,"a","subStrict"),n=j(t,"b","subStrict");return Nt(e.shape,n.shape,"Error in subStrict: "),e.sub(n)}}),il=X({equal_:function(r,t){var e,n=j(r,"a","equal"),i=j(t,"b","equal");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o){return o.equal(n,i)},{$a:n,$b:i})}}),MN=X({equalStrict_:function(r,t){var e=j(r,"a","equalStrict"),n=j(t,"b","equalStrict");return Nt(e.shape,n.shape,"Error in equalStrict: "),e.equal(n)}}),eh=X({greater_:function(r,t){var e,n=j(r,"a","greater"),i=j(t,"b","greater");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o){return o.greater(n,i)},{$a:n,$b:i})}}),fp=X({greaterEqual_:function(r,t){var e,n=j(r,"a","greaterEqual"),i=j(t,"b","greaterEqual");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o,a){var s=o.greaterEqual(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return Ct(s)},$b:function(){return Ct(u)}}})}}),LN=X({greaterEqualStrict_:function(r,t){var e=j(r,"a","greaterEqualStrict"),n=j(t,"b","greaterEqualStrict");return Nt(e.shape,n.shape,"Error in greaterEqualStrict: "),e.greaterEqual(n)}}),FN=X({greaterStrict_:function(r,t){var e=j(r,"a","greaterStrict"),n=j(t,"b","greaterStrict");return Nt(e.shape,n.shape,"Error in greaterStrict: "),e.greater(n)}}),Ox=X({less_:function(r,t){var e,n=j(r,"a","less"),i=j(t,"b","less");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o){return o.less(n,i)},{$a:n,$b:i})}}),Px=X({lessEqual_:function(r,t){var e,n=j(r,"a","lessEqual"),i=j(t,"b","lessEqual");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o){return o.lessEqual(n,i)},{$a:n,$b:i})}}),zN=X({lessEqualStrict_:function(r,t){var e=j(r,"a","lessEqualStrict"),n=j(t,"b","lessEqualStrict");return Nt(e.shape,n.shape,"Error in lessEqualStrict: "),e.lessEqual(n)}}),VN=X({lessStrict_:function(r,t){var e=j(r,"a","lessStrict"),n=j(t,"b","lessStrict");return Nt(e.shape,n.shape,"Error in lessStrict: "),e.less(n)}}),Dc=X({notEqual_:function(r,t){var e,n=j(r,"a","notEqual"),i=j(t,"b","notEqual");return e=gn(n,i),n=e[0],i=e[1],xt(n.shape,i.shape),K.runKernelFunc(function(o){return o.notEqual(n,i)},{$a:n,$b:i})}}),BN=X({notEqualStrict_:function(r,t){var e=j(r,"a","notEqualStrict"),n=j(t,"b","notEqualStrict");return Nt(e.shape,n.shape,"Error in notEqualStrict: "),e.notEqual(n)}});function US(r,t){for(var e=[],n=r;n<t;++n)e.push(n);return e}function jS(r){for(var t=[],e=0;e<r.length;++e)for(var n=0;n<r[e].length;++n)t.push(r[e][n]);return t}var th=X({gather_:function(r,t,e){e===void 0&&(e=0);var n=j(r,"x","gather"),i=j(t,"indices","gather","int32");e=Jn(e,n.shape)[0];var o=function(a,s,u){for(var c=a.shape[u],d=[],p=1,f=1,g=0;g<u;g++)d.push(a.shape[g]),p*=a.shape[g];for(g=0;g<s.rank;g++)d.push(s.shape[g]);for(g=u+1;g<a.rank;g++)d.push(a.shape[g]),f*=a.shape[g];return{batchSize:p,sliceSize:f,dimSize:c,outputShape:d}}(n,i,e);return K.runKernelFunc(function(a,s){var u=a.gather(n,i.flatten(),e);return s([i]),u},{$x:n},function(a,s){var u=s[0];return{$x:function(){var c=n.shape,d=u.size,p=c.slice(0,e),f=p.length,g=c.slice(e,c.length).slice(1),y=g.length,x=US(0,f),b=US(f+1,f+1+y),_=jS([p,[d],g]),C=a.reshape(_),T=u.reshape([d]),D=jS([[f],x,b]),O=C.transpose(D),z=Mx(O,T,n.shape[e]),I=Yg(D);return z=z.transpose(I)}}}).reshape(o.outputShape)}}),Mx=X({unsortedSegmentSum_:function(r,t,e){var n=j(r,"x","unsortedSegmentSum"),i=j(t,"segmentIds","unsortedSegmentSum","int32");return W(mn(e),function(){return"numSegments must be of dtype int"}),K.runKernelFunc(function(o,a){var s=o.unsortedSegmentSum(n,i,e);return a([i]),s},{$x:n},function(o,a){var s=a[0];return{$x:function(){return function(u,c){for(var d=Fo(c,Ct(c)),p=th(u,d),f=fp(c,Ve(0,"int32")),g=p.rank-f.rank,y=0;y<g;++y)f=ii(f,y+1);f=Ra(f,Lo(p.shape,"bool"));var x=Ct(p);return Ia(f,p,x)}(o,s)}}})}}),UN=function(r,t,e){return Ue(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p,f,g,y,x;return je(this,function(b){switch(b.label){case 0:for(n=j(r,"tensor","boolMask"),i=j(t,"mask","boolMask","bool"),o=e??0,a=i.rank,s=n.shape,W(a>0,function(){return"mask cannot be scalar"}),Nt(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+a;c++)u*=s[c];return d=s.slice(0,o).concat([u],s.slice(o+a)),p=n.reshape(d),f=i.reshape([-1]),[4,fv(f)];case 1:return g=b.sent(),y=g.squeeze([1]),x=th(p,y,o),r!==n&&n.dispose(),t!==i&&i.dispose(),y.dispose(),p.dispose(),f.dispose(),g.dispose(),[2,x]}})})};function jN(r,t,e,n,i,o,a){o===void 0&&(o="NHWC"),W(r.length===t.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"});var s=r,u=t,c=!1;t.rank===3&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,r[0],r[1],r[2]]),W(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),W(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),W(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var d=o==="NHWC"?s[3]:s[1],p=o==="NHWC"?u.shape[3]:u.shape[1];W(d===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+e.shape[2]+"."}),W(p===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+e.shape[3]+"."}),a!=null&&W(mn(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var f=sv(o),g=Us(s,e.shape,n,1,i,a,!1,f),y=K.runKernelFunc(function(x,b){var _=x.conv2dDerInput(u,e,g);return b([e,u]),_},{dy4D:u,filter:e},function(x,b){var _=b[0],C=b[1];return{dy4D:function(){return ol(x,_,n,i,o,1,a)},filter:function(){return Lx(x,C,_.shape,n,i,o,a)}}});return c?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}function K0(r){var t=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(r),e=t[0],n=t[1],i=t[2];return e===1&&n===1&&i===1}function WN(r,t,e,n,i){W(r.length===t.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"});var o=r,a=t,s=!1;t.rank===4&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),o=[1,r[0],r[1],r[2],r[3]]);var u=o[4],c=a.shape[4];W(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),W(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),W(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),W(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),W(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var d=zd(o,e.shape,n,1,i),p=K.runKernelFunc(function(f){return f.conv3dDerInput(a,e,d)},{dy5D:a});return s?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var vv=X({conv1d_:function(r,t,e,n,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=j(r,"x","conv1d"),u=j(t,"filter","conv1d"),c=s,d=!1;s.rank===2&&(d=!0,c=s.as3D(1,s.shape[0],s.shape[1])),W(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),W(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&W(mn(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),W(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),W(Ar(e,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+o+"'"}),W(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),g=ol(f,p,[1,e],n,"NHWC",[1,o],a);return d?g.as2D(g.shape[2],g.shape[3]):g.as3D(g.shape[0],g.shape[2],g.shape[3])}}),ol=X({conv2d_:function(r,t,e,n,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=j(r,"x","conv2d"),u=j(t,"filter","conv2d"),c=s,d=!1;s.rank===3&&(d=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),W(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),W(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&W(mn(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var p=i==="NHWC"?c.shape[3]:c.shape[1];W(p===u.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+u.shape[2]+"."}),W(Ar(e,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"});var f=sv(i),g=Us(c.shape,u.shape,e,o,n,a,!1,f),y=K.runKernelFunc(function(x,b){var _=x.conv2d(c,u,g);return b([u,c]),_},{x:c,$filter:u},function(x,b){var _=b,C=_[0],T=_[1];return W(Hu(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return qN(T.shape,x,C,e,n,i)},$filter:function(){return Lx(T,x,C.shape,e,n,i)}}});return d?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),yv=X({conv3d_:function(r,t,e,n,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=j(r,"x","conv3d"),s=j(t,"filter","conv3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),W(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),W(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),W(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),W(function(f,g){return K0(f)||K0(g)}(e,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),W(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var d=zd(u.shape,s.shape,e,o,n),p=K.runKernelFunc(function(f,g){var y=f.conv3d(u,s,d);return g([u,s]),y},{x:u,$filter:s},function(f,g){W(K0(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var y=g[0],x=g[1];return{x:function(){return WN(y.shape,f,x,e,n)},$filter:function(){return function(b,_,C,T,D){var O=b;b.rank===4&&(O=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]));var z=_;z.rank===4&&(z=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),W(O.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+O.shape+"."}),W(z.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+z.shape+"."}),W(C.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+C+"."}),W(O.shape[4]===C[3],function(){return"Error in conv3dDerFilter: depth of input "+O.shape[4]+") must match input depth in filter ("+C[3]+"."}),W(z.shape[4]===C[4],function(){return"Error in conv3dDerFilter: depth of dy ("+z.shape[4]+") must match output depth for filter ("+C[4]+")."});var I=zd(O.shape,C,T,1,D);return K.runKernelFunc(function(S){return S.conv3dDerFilter(O,z,I)},{x5D:O,dy5D:z})}(y,f,x.shape,e,n)}}});return c?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Lx=X({conv2dDerFilter_:function(r,t,e,n,i,o,a){o===void 0&&(o="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),W(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),W(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),W(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c=o==="NHWC"?s.shape[3]:s.shape[1],d=o==="NHWC"?u.shape[3]:u.shape[1];W(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),W(d===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+e[3]+")."}),a!=null&&W(mn(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var p=sv(o),f=Us(s.shape,e,n,1,i,a,!1,p);return K.runKernelFunc(function(g){return g.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),qN=X({conv2dDerInput_:jN}),nh=X({depthwiseConv2d_:function(r,t,e,n,i,o,a){o===void 0&&(o=[1,1]);var s=j(r,"x","depthwiseConv2d"),u=j(t,"filter","depthwiseConv2d"),c=s,d=!1;s.rank===3&&(d=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),W(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),W(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),W(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),W(Ar(e,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),a!=null&&W(mn(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var p=Us(c.shape,u.shape,e,o,n,a,!0),f=K.runKernelFunc(function(g,y){var x=g.depthwiseConv2D(c,u,p);return y([c,u]),x},{x:c,$filter:u},function(g,y){W(Hu(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var x=y[0],b=y[1];return{x:function(){return HN(x.shape,g,b,p)},$filter:function(){return $N(x,g,b.shape,p)}}});return d?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),HN=X({depthwiseConv2dDerInput_:function(r,t,e,n){var i=t,o=!1;t.rank===3&&(o=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=K.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,e,n)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),$N=X({depthwiseConv2dDerFilter_:function(r,t,e,n){var i=r;r.rank===3&&(i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t;return o.rank===3&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),K.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(i,o,n)},{x4D:i,dy4D:o})}}),Fx=X({separableConv2d_:function(r,t,e,n,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=j(r,"x","separableConv2d"),u=j(t,"depthwiseFilter","separableConv2d"),c=j(e,"pointwiseFilter","separableConv2d"),d=s,p=!1;if(s.rank===3&&(p=!0,d=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");W(d.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),W(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),W(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),W(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),W(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],g=u.shape[3];W(c.shape[2]===f*g,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*g+", but got "+c.shape[2]+"."});var y=nh(d,u,n,i,a,o),x=ol(y,c,1,"valid",a);return p?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),wv=X({conv2dTranspose_:function(r,t,e,n,i,o){return jN(e,j(r,"x","conv2dTranspose"),j(t,"filter","conv2dTranspose"),n,i,"NHWC",o)}}),GN=X({conv3dTranspose_:function(r,t,e,n,i){return WN(e,j(r,"x","conv3dTranspose"),j(t,"filter","conv3dTranspose"),n,i)}}),bv=X({matMul_:function(r,t,e,n){var i;e===void 0&&(e=!1),n===void 0&&(n=!1);var o=j(r,"a","matMul"),a=j(t,"b","matMul");i=gn(o,a),o=i[0],a=i[1];var s=e?o.shape[o.rank-2]:o.shape[o.rank-1],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=e?o.shape[o.rank-1]:o.shape[o.rank-2],d=n?a.shape[a.rank-2]:a.shape[a.rank-1],p=o.shape.slice(0,-2),f=a.shape.slice(0,-2),g=He(p),y=He(f);W(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),W(Qn(p,f),function(){return"Error in matMul: outer dimensions ("+p+") and ("+f+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),W(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+e+" and transposeB="+n+" must match."});var x=o.shape.slice(0,-2).concat([c,d]),b=e?o.as3D(g,s,c):o.as3D(g,c,s),_=n?a.as3D(y,d,u):a.as3D(y,u,d),C={transposeA:e,transposeB:n};return K.runKernelFunc(function(T,D){var O=T.batchMatMul(b,_,e,n);return D([b,_]),O},{a:b,b:_},function(T,D){var O=D,z=O[0],I=O[1];return e||n?!e&&n?{a:function(){return T.matMul(I,!1,!1)},b:function(){return T.matMul(z,!0,!1)}}:e&&!n?{a:function(){return I.matMul(T,!1,!0)},b:function(){return z.matMul(T,!1,!1)}}:{a:function(){return I.matMul(T,!0,!0)},b:function(){return T.matMul(z,!0,!0)}}:{a:function(){return T.matMul(I,!1,!0)},b:function(){return z.matMul(T,!0,!1)}}},"BatchMatMul",C).reshape(x)}}),KN=X({dot_:function(r,t){var e=j(r,"t1","dot"),n=j(t,"t2","dot");W(!(e.rank!==1&&e.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+n.rank+"."});var i=e.rank===1?e.size:e.shape[1],o=n.rank===1?n.size:n.shape[0];return W(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),e.rank===1&&n.rank===1?e.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():e.rank===1&&n.rank===2?e.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():e.rank===2&&n.rank===1?e.matMul(n.as2D(-1,1)).as1D():e.matMul(n.as2D(n.shape[0],n.shape[1]))}}),XN=X({outerProduct_:function(r,t){var e=j(r,"v1","outerProduct"),n=j(t,"v2","outerProduct");return W(e.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+n.rank+"."}),e.as2D(-1,1).matMul(n.as2D(1,-1))}}),Oo=X({reverse_:function(r,t){var e=j(r,"x","reverse");if(e.rank===0)return e.clone();var n=Jn(t,e.shape);return K.runKernelFunc(function(i){return i.reverse(e,n)},{$x:e},function(i){return{$x:function(){return i.reverse(n)}}}).reshapeAs(e)}}),QN=X({reverse1d_:function(r){var t=j(r,"x","reverse");return W(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Oo(t,0)}}),YN=X({reverse2d_:function(r,t){var e=j(r,"x","reverse");return W(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Oo(e,t)}}),JN=X({reverse3d_:function(r,t){var e=j(r,"x","reverse");return W(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Oo(e,t)}}),ZN=X({reverse4d_:function(r,t){var e=j(r,"x","reverse");return W(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Oo(e,t)}});function eD(r,t,e,n,i,o){var a=j(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),W(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),W(Ar(e,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"}),o!=null&&W(mn(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=kc(s.shape,t,e,n,i,o),d=K.runKernelFunc(function(p,f){var g=p.maxPool(s,c);return f([s,g]),g},{x:s},function(p,f){var g=f[0],y=f[1];return{x:function(){return function(x,b,_,C,T,D,O,z){var I=j(x,"dy","maxPoolBackprop"),S=j(b,"input","maxPoolBackprop"),A=j(_,"output","maxPoolBackprop");W(S.rank===I.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+I.rank+")"}),W(Ar(T,D),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+T+" and dilations '"+D+"'"}),W(I.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."}),W(S.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."});var N=kc(S.shape,C,T,D,O,z);return K.runKernelFunc(function(P){return P.maxPoolBackprop(I,S,A,N)},{$dy:I,$input:S})}(p,g,y,t,e,n,i)}}});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function tD(r,t,e,n,i,o){var a=j(r,"x","avgPool","float32");W(Ar(e,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),W(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&W(mn(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=kc(s.shape,t,e,n,i,o),d=K.runKernelFunc(function(p){return p.avgPool(s,c)},{x:s},function(p){return{x:function(){return function(f,g,y,x,b,_){var C=j(f,"dy","avgPoolBackprop"),T=j(g,"input","avgPoolBackprop");W(T.rank===C.rank,function(){return"Rank of input ("+T.rank+") does not match rank of dy ("+C.rank+")"}),W(Ar(x,b),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+b+"'"});var D=T,O=C,z=!1;T.rank===3&&(z=!0,D=T.as4D(1,T.shape[0],T.shape[1],T.shape[2]),O=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),W(O.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+O.rank+"."}),W(D.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+D.rank+"."});var I=kc(D.shape,y,x,b,_),S=K.runKernelFunc(function(A){return A.avgPoolBackprop(O,D,I)},{dy4D:O,input4D:D});return z?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}(p,s,t,e,n,i)}}});return d=d.cast(a.dtype),u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var xv=X({maxPool_:function(r,t,e,n,i){return eD(r,t,e,1,n,i)}}),_v=X({avgPool_:function(r,t,e,n,i){return tD(r,t,e,1,n,i)}}),nD=X({pool_:function(r,t,e,n,i,o){i==null&&(i=[1,1]),o==null&&(o=1),n===0&&(n="valid");var a=j(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),W(Ar(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,d=kc(s.shape,t,o,i,n),p=[d.dilationHeight,d.dilationWidth];c=n==="same"?function(D,O){var z=D.map(function(A,N){return A+(A-1)*(O[N]-1)}).map(function(A){return A-1}),I=z.map(function(A){return Math.floor(A/2)}),S=z.map(function(A,N){return A-I[N]});return z.map(function(A,N){return[I[N],S[N]]})}([d.filterHeight,d.filterWidth],p):[[0,0],[0,0]];var f=p[0]===1&&p[1]===1,g=function(D,O,z){var I=z.map(function(G){return G[0]}),S=z.map(function(G){return G[1]}),A=D.concat(I,S),N=O.map(function(G,Z){return(G-A[Z]%G)%G}),P=S.map(function(G,Z){return G+N[Z]}),M=O.map(function(G,Z){return[I[Z],P[Z]]}),F=O.map(function(G,Z){return[0,N[Z]]});return[M,F]}([d.inHeight,d.inWidth],p,c),y=g[0],x=g[1],b=f?n:"valid",_=f?s:rv(s,p,y),C=(e==="avg"?function(){return tD(_,t,o,1,b)}:function(){return eD(_,t,o,1,b)})(),T=f?C:ev(C,p,x);return u?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),Ev=X({maxPool3d_:function(r,t,e,n,i,o,a){o===void 0&&(o="NDHWC");var s=j(r,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),W(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),W(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),W(Ar(e,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),i!=null&&W(mn(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var d=Fd(u.shape,t,e,a,n,i,o),p=K.runKernelFunc(function(f,g){var y=f.maxPool3d(u,d);return g([u,y]),y},{x:u},function(f,g){var y=g[0],x=g[1];return{x:function(){return function(b,_,C,T,D,O,z,I){var S=j(b,"dy","maxPool3dBackprop"),A=j(_,"input","maxPool3dBackprop"),N=j(C,"output","maxPool3dBackprop"),P=S,M=A,F=N,G=!1;A.rank===4&&(G=!0,P=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),M=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3]),F=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),W(P.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+P.rank+"."}),W(M.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),W(F.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+F.rank+"."}),O==null&&(O=[1,1,1]),W(Ar(D,O),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+D+" and dilations '"+O+"'"}),I!=null&&W(mn(z),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+I+" but got pad "+z+"."});var Z=Fd(M.shape,T,D,O,z,I),Y=K.runKernelFunc(function(ee){return ee.maxPool3dBackprop(P,M,F,Z)},{dy5D:P,input5D:M});return G?Y.as4D(Y.shape[1],Y.shape[2],Y.shape[3],Y.shape[4]):Y}(f,y,x,t,e,a,n,i)}}});return c?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Iv=X({avgPool3d_:function(r,t,e,n,i,o,a){o===void 0&&(o="NDHWC");var s=j(r,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),W(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),W(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),W(Ar(e,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),i!=null&&W(mn(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var d=Fd(u.shape,t,e,a,n,i,o),p=K.runKernelFunc(function(f){return f.avgPool3d(u,d)},{x:u},function(f){return{x:function(){return function(g,y,x,b,_,C,T){var D=j(g,"dy","avgPool3dBackprop"),O=j(y,"input","avgPool3dBackprop"),z=D,I=O,S=!1;O.rank===4&&(S=!0,z=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),I=O.as5D(1,O.shape[0],O.shape[1],O.shape[2],O.shape[3])),W(z.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+z.rank+"."}),W(I.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+I.rank+"."}),_==null&&(_=[1,1,1]),W(Ar(b,_),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+_+"'"}),T!=null&&W(mn(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+C+"."});var A=Fd(I.shape,x,b,_,C,T),N=K.runKernelFunc(function(P){return P.avgPool3dBackprop(z,I,A)},{dy5D:z,input5D:I});return S?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N}(f,u,t,e,a,n,i)}}});return p=p.cast(u.dtype),c?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),hi=X({slice_:function(r,t,e){var n,i,o=j(r,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof t=="number"?[t].concat(new Array(o.rank-1).fill(0)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(0)):t.slice()).forEach(function(u){W(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=e==null?new Array(o.rank).fill(-1):typeof e=="number"?[e].concat(new Array(o.rank-1).fill(-1)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(W(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),o.shape[c]-n[c])}),Dk(o,n,i);var a=o.shape,s={begin:n,size:i};return K.runKernelFunc(function(u){return u.slice(o,n,i)},{x:o},function(u){for(var c=[],d=0;d<u.rank;d++)c.push([n[d],a[d]-n[d]-i[d]]);return{x:function(){return u.pad(c)}}},"Slice",s)}}),mp=X({slice1d_:function(r,t,e){var n=j(r,"x","slice1d");return W(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),hi(n,[t],[e])}}),Cv=X({slice2d_:function(r,t,e){var n=j(r,"x","slice2d");return W(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),hi(n,t,e)}}),gp=X({slice3d_:function(r,t,e){var n=j(r,"x","slice3d");return W(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),hi(n,t,e)}}),Oc=X({slice4d_:function(r,t,e){var n=j(r,"x","slice4d");return W(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),hi(n,t,e)}});function rD(r,t,e,n,i){return t.rank<e.rank&&(t=t.reshape(li(t.shape,n))),r.rank<e.rank&&(r=r.reshape(li(r.shape,n))),{$x:function(){var o=r.mul(e.equal(t).cast(r.dtype));return i==null?o:o.transpose(i)}}}var Sv=X({all_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","all","bool"),i=Jn(t,n.shape),o=i,a=no(o,n.rank);a!=null&&(n=n.transpose(a),o=ro(o.length,n.rank));var s=K.runKernelFunc(function(c){return c.all(n,o)},{$x:n});if(e){var u=li(s.shape,i);return s.reshape(u)}return s}}),Vd=X({any_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","any","bool"),i=Jn(t,n.shape),o=i,a=no(o,n.rank);a!=null&&(n=n.transpose(a),o=ro(o.length,n.rank));var s=K.runKernelFunc(function(c){return c.any(n,o)},{$x:n});if(e){var u=li(s.shape,i);return s.reshape(u)}return s}}),Bd=X({argMax_:function(r,t){t===void 0&&(t=0);var e=j(r,"x","argMax");t==null&&(t=0);var n=Jn(t,e.shape),i=no(n,e.rank);return i!=null&&(e=e.transpose(i),n=ro(n.length,e.rank)),K.runKernelFunc(function(o,a){var s=o.argMax(e,n[0]);return a([e]),s},{$x:e},function(o,a){var s=a[0];return{$x:function(){return Ct(s)}}})}}),zx=X({argMin_:function(r,t){t===void 0&&(t=0);var e=j(r,"x","argMin");t==null&&(t=0);var n=Jn(t,e.shape),i=no(n,e.rank);return i!=null&&(e=e.transpose(i),n=ro(n.length,e.rank)),K.runKernelFunc(function(o,a){var s=o.argMin(e,n[0]);return a([e]),s},{$x:e},function(o,a){var s=a[0];return{$x:function(){return Ct(s)}}})}}),iD=X({logSumExp_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","logSumExp"),i=Jn(t,n.shape),o=n.max(i,!0),a=n.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(e){var u=li(s.shape,i);return s.reshape(u)}return s}}),Ns=X({max_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","max"),i=n,o=Jn(t,n.shape),a=o,s=no(a,n.rank);s!=null&&(n=n.transpose(s),a=ro(a.length,n.rank));var u=K.runKernelFunc(function(d,p){var f=d.max(n,a);return p([i,f]),f},{$x:n},function(d,p){return rD(d,p[1],p[0],o,s)});if(e){var c=li(u.shape,o);u=u.reshape(c)}return u}}),_n=X({mean_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","mean"),i=Jn(t,n.shape),o=He(ir(n.shape,i)[1]);return Jc(function(a){var s=Ve(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(t,e),gradFunc:function(u){var c=a.shape.slice();return i.forEach(function(d){c[d]=1}),u.reshape(c).mul(Lo(a.shape,"float32")).div(o)}}})(n)}}),Tv=X({min_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","min"),i=n,o=Jn(t,n.shape),a=o,s=no(a,n.rank);s!=null&&(n=n.transpose(s),a=ro(a.length,n.rank));var u=K.runKernelFunc(function(d,p){var f=d.min(n,a);return p([i,f]),f},{$x:n},function(d,p){return rD(d,p[1],p[0],o,s)});if(e){var c=li(u.shape,o);u=u.reshape(c)}return u}}),vp=X({moments_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=Jn(t,(r=j(r,"x","moments")).shape),i=r.mean(n,e),o=i.shape;e||(o=li(i.shape,n));var a=r.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(n,e)}}}),Gr=X({sum_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=Jn(t,n.shape);return Jc(function(o){var a=no(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=ro(s.length,o.rank));var c=K.runKernelFunc(function(p){return p.sum(u,s)},{permutedX:u});if(e){var d=li(c.shape,i);c=c.reshape(d)}return{value:c,gradFunc:function(p){var f=o.shape.slice();return i.forEach(function(g){f[g]=1}),p.reshape(f).mul(Lo(o.shape,"float32"))}}})(n)}}),Av=X({prod_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=j(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=Jn(t,n.shape),o=no(i,n.rank),a=i,s=n;o!=null&&(s=n.transpose(o),a=ro(a.length,n.rank));var u=K.runKernelFunc(function(d){return d.prod(s,a)},{permutedX:s});if(e){var c=li(u.shape,i);u=u.reshape(c)}return u}}),rh=X({elu_:function(r){var t=j(r,"x","elu");return K.runKernelFunc(function(e,n){var i=e.elu(t);return n([i]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return K.runKernelFunc(function(o){return o.eluDer(e,i)},{dy:e,y:i})}}})}}),Rv=X({leakyRelu_:function(r,t){t===void 0&&(t=.2);var e=j(r,"x","leakyRelu");return Fo(Ve(t).mul(e),e)}}),kv=X({prelu_:function(r,t){var e=j(r,"x","prelu"),n=j(t,"alpha","prelu");return K.runKernelFunc(function(i,o){var a=i.prelu(e,n);return o([e,n]),a},{x:e,alpha:n},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return Ia(u,i,i.mul(s))},alpha:function(){var c=Ia(u,Ct(i),i.mul(a)),d=kn(s.shape,i.shape);return d.length>0&&(c=c.sum(d)),c.reshape(s.shape)}}},"Prelu")}}),js=X({relu_:function(r){var t=j(r,"x","relu");return t.dtype==="bool"?t.toInt():K.runKernelFunc(function(e,n){var i=e.relu(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){return e.mulStrict(i.step().toFloat())}}})}}),Vx=X({relu6_:function(r){var t=j(r,"x","relu6");return t.dtype==="bool"?t.toInt():K.runKernelFunc(function(e,n){var i=e.relu6(t);return n([t]),i},{$x:t},function(e,n){var i=n[0],o=i.lessEqual(6).mul(i.step());return{$x:function(){return e.mulStrict(o.toFloat())}}})}}),Nv=X({selu_:function(r){var t=j(r,"x","selu");return K.runKernelFunc(function(e,n){var i=e.selu(t);return n([t]),i},{$x:t},function(e,n){var i=n[0];return{$x:function(){var o=i.greater(Ve(0)),a=Ve(nx),s=Ve(rx),u=e.mul(s),c=e.mul(a).mul(i.toFloat().exp());return Ia(o,u,c)}}})}}),an=X({transpose_:function(r,t){var e=j(r,"x","transpose");return t==null&&(t=e.shape.map(function(n,i){return i}).reverse()),W(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(n){W(n>=0&&n<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1?e.clone():K.runKernelFunc(function(n){return n.transpose(e,t)},{$x:e},function(n){var i=Yg(t);return{$x:function(){return n.transpose(i)}}})}}),Bx=X({localResponseNormalization_:function(r,t,e,n,i){t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),i===void 0&&(i=.5);var o=j(r,"x","localResponseNormalization");W(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),W(mn(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=K.runKernelFunc(function(c,d){var p=c.localResponseNormalization4D(a,t,e,n,i);return d([a,p]),p},{x4D:a},function(c,d){var p=d[0],f=d[1];return{x4D:function(){return K.runKernelFunc(function(g){return g.LRNGrad(c,p,f,t,e,n,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Ux=X({norm_:function(r,t,e,n){t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1);var i=function s(u,c,d){if(d===void 0&&(d=null),u.rank===0)return u.abs();if(u.rank!==1&&d===null)return s(u.reshape([-1]),c,d);if(u.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(c===1)return u.abs().sum(d);if(c===1/0)return u.abs().max(d);if(c===-1/0)return u.abs().min(d);if(c==="euclidean"||c===2)return u.abs().pow(Ve(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(d)&&d.length===2){if(c===1)return u.abs().sum(d[0]).max(d[1]-1);if(c===1/0)return u.abs().sum(d[1]).max(d[0]);if(c===-1/0)return u.abs().sum(d[1]).min(d[0]);if(c==="fro"||c==="euclidean")return u.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+d)}(r=j(r,"x","norm"),t,e),o=i.shape;if(n){var a=Jn(e,r.shape);o=li(i.shape,a)}return i.reshape(o)}}),oD=X({basicLSTMCell_:function(r,t,e,n,i,o){var a=j(r,"forgetBias","basicLSTMCell"),s=j(t,"lstmKernel","basicLSTMCell"),u=j(e,"lstmBias","basicLSTMCell"),c=j(n,"data","basicLSTMCell"),d=j(i,"c","basicLSTMCell"),p=j(o,"h","basicLSTMCell"),f=c.concat(p,1).matMul(s).add(u),g=f.shape[0],y=f.shape[1]/4,x=[g,y],b=f.slice([0,0],x),_=f.slice([0,y],x),C=f.slice([0,2*y],x),T=f.slice([0,3*y],x),D=b.sigmoid().mulStrict(_.tanh()).addStrict(d.mulStrict(a.add(C).sigmoid())),O=D.tanh().mulStrict(T.sigmoid());return[D,O]}}),aD=X({multiRNNCell_:function(r,t,e,n){for(var i=j(t,"data","multiRNNCell"),o=Ld(e,"c","multiRNNCell"),a=Ld(n,"h","multiRNNCell"),s=i,u=[],c=0;c<r.length;c++){var d=r[c](s,o[c],a[c]);u.push(d[0]),u.push(d[1]),s=d[1]}var p=[],f=[];for(c=0;c<u.length;c+=2)p.push(u[c]),f.push(u[c+1]);return[p,f]}}),sD=X({movingAverage_:function(r,t,e,n,i){i===void 0&&(i=!0);var o=j(r,"v","movingAverage"),a=j(t,"x","movingAverage"),s=j(e,"decay","movingAverage");BR(o,a),W(Qn(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Ve(1),c=u.sub(s),d=a.sub(o).mul(c);if(i){W(n!=null,function(){return"When using zeroDebias: true, step is required."});var p=j(n,"step","movingAverage");d=d.div(u.sub(Nc(s,p)))}return o.add(d)}}),jx=X({stridedSlice_:function(r,t,e,n,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),n==null&&(n=new Array(t.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var c=j(r,"x","stridedSlice"),d=e1(s),p=c.shape.slice();d.forEach(function(b){t[b]=0,e[b]=1,p.splice(b,0,1)}),c=c.reshape(p);for(var f=0;f<c.rank;f++)t[f]=Ok(i,t,n,c.shape,f),e[f]=Pk(o,e,n,c.shape,f),n[f]=n[f]||1;var g=e1(u);g.forEach(function(b){e[b]=t[b]+1,n[b]=1});var y=iv(t,e,n),x=y.filter(function(b,_){return g.indexOf(_)===-1});return n.every(function(b){return b===1})?hi(c,t,y).reshape(x):K.runKernelFunc(function(b){return b.stridedSlice(c,t,e,n)},{$x:c}).reshape(x)}}),Wx=X({topk_:function(r,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var n=j(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var o=K.runKernelFunc(function(a){return a.topk(n,t,e)},{$x:n});return{values:o[0],indices:o[1]}}}),qx=X({scatterND_:function(r,t,e){var n=j(r,"indices","scatterND","int32"),i=j(t,"updates","scatterND");return MW(i,n,e),K.runKernelFunc(function(o){return o.scatterND(n,i,e)},{$indices:n,$updates:i})}}),yp=X({fft_:function(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return K.runKernelFunc(function(i){return i.fft(n)},{input:r}).reshape(r.shape)}}),Pc=X({ifft_:function(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return K.runKernelFunc(function(i){return i.ifft(n)},{input:r}).reshape(r.shape)}}),wp=X({rfft_:function(r,t){W(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var e,n=r.shape[r.shape.length-1],i=r.size/n;if(t!=null&&t<n){var o=r.shape.map(function(_){return 0}),a=r.shape.map(function(_){return _});a[r.shape.length-1]=t,e=r.slice(o,a),n=t}else if(t!=null&&t>n){var s=r.shape.map(function(_){return _});s[r.shape.length-1]=t-n,e=r.concat(zt(s),r.shape.length-1),n=t}else e=r;var u=e.zerosLike(),c=Ln(e,u).as2D(i,n),d=yp(c),p=Math.floor(n/2)+1,f=Wr(d),g=Ci(d),y=f.split([p,n-p],f.shape.length-1),x=g.split([p,n-p],g.shape.length-1),b=e.shape.slice();return b[e.shape.length-1]=p,Ln(y[0],x[0]).reshape(b)}}),Dv=X({irfft_:function(r){var t=r.shape[r.shape.length-1],e=r.size/t;if(t<=2){var n=r.as2D(e,t),i=Pc(n);return Wr(i)}var o=[e,2*(t-1)],a=Wr(r).as2D(e,t),s=Ci(r).as2D(e,t),u=a.slice([0,1],[e,t-2]).reverse(1),c=s.slice([0,1],[e,t-2]).reverse(1).mul(Ve(-1)),d=a.concat(u,1),p=s.concat(c,1);return n=Ln(d,p).as2D(o[0],o[1]),i=Pc(n),Wr(i)}}),uD=Object.freeze({fft:yp,ifft:Pc,rfft:wp,irfft:Dv}),Ov=X({sparseToDense_:function(r,t,e,n){n===void 0&&(n=0);var i=j(r,"sparseIndices","sparseToDense","int32"),o=j(t,"sparseValues","sparseToDense"),a=j(n,"defaultValue","sparseToDense",o.dtype);return function(s,u,c,d){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var p=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");var g=u.size;if(u.rank!==0&&(u.rank!==1||g!==p))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+p+"]");if(u.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,e,a),K.runKernelFunc(function(s){return s.sparseToDense(i,o,e,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),Hx=X({gatherND_:function(r,t){var e=j(t,"indices","gatherND","int32"),n=j(r,"x","gatherND");return K.runKernelFunc(function(i){return i.gatherND(n,e)},{$x:n,$indices:e})}}),lD=X({diag_:function(r){var t=j(r,"x","diag").flatten(),e=r.shape.concat(r.shape);return K.runKernelFunc(function(n){return n.diag(t)},{$x:t}).reshape(e)}}),$x=X({dropout_:function(r,t,e,n){var i=j(r,"x","dropout");if(W(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),W(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return r instanceof Ut?i.clone():i;var o=function(u,c){if(c==null)return u.shape.slice();if(Qn(u.shape,c))return c;if(u.shape.length===c.length){for(var d=[],p=0;p<u.shape.length;p++)c[p]==null&&u.shape[p]!=null?d.push(u.shape[p]):d.push(c[p]);return d}return c}(i,e),a=1-t,s=tl(o,0,1,"float32",n).add(a).floor().div(a);return i.mul(s)}});function cD(r,t,e){for(var n=1-r%2,i=new Float32Array(r),o=0;o<r;++o){var a=2*Math.PI*o/(r+n-1);i[o]=t-e*Math.cos(a)}return $r(i,"float32")}var Pv=X({hannWindow_:function(r){return cD(r,.5,.5)}}),Gx=X({hammingWindow_:function(r){return cD(r,.54,.46)}}),Mv=X({frame_:function(r,t,e,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var o=0,a=[];o+t<=r.size;)a.push(hi(r,o,t)),o+=e;if(n)for(;o<r.size;){var s=o+t-r.size,u=br([hi(r,o,t-s),Yc([s],i)]);a.push(u),o+=e}return a.length===0?pa([],[0,t]):br(a).as2D(a.length,t)}}),Kx=X({stft_:function(r,t,e,n,i){var o;i===void 0&&(i=Pv),n==null&&(o=t,n=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=Mv(r,t,e),s=ot(a,i(t)),u=[],c=0;c<a.shape[0];c++)u.push(wp(s.slice([c,0],[1,t]),n));return br(u)}}),hD=Object.freeze({hannWindow:Pv,hammingWindow:Gx,frame:Mv,stft:Kx}),sr,dD=function(r,t,e){return e===void 0&&(e=1),Ue(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p,f,g,y,x,b;return je(this,function(_){switch(_.label){case 0:return n=j(r,"predictions","inTopK"),i=j(t,"targets","inTopK"),W(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),W(n.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank}),Nt(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=n.shape[n.shape.length-1],W(e>0&&e<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+e}),[4,n.data()];case 1:return a=_.sent(),[4,i.data()];case 2:for(s=_.sent(),u=[a.length/o,o],d=u[1],p=Rd("bool",c=u[0]),f=0;f<c;f++){for(g=f*d,y=a.subarray(g,g+d),x=[],b=0;b<y.length;b++)x.push({value:y[b],index:b});for(x.sort(function(C,T){return T.value-C.value}),p[f]=0,b=0;b<e;b++)if(x[b].index===s[f]){p[f]=1;break}}return r!==n&&n.dispose(),t!==i&&i.dispose(),[2,xn(p,i.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(sr||(sr={}));var I5=X({absoluteDifference_:function(r,t,e,n){n===void 0&&(n=sr.SUM_BY_NONZERO_WEIGHTS);var i=j(r,"labels","absoluteDifference"),o=j(t,"predictions","absoluteDifference"),a=null;e!=null&&(a=j(e,"weights","absoluteDifference")),Nt(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return ka(s,a,n)}}),ka=X({computeWeightedLoss_:function(r,t,e){e===void 0&&(e=sr.SUM_BY_NONZERO_WEIGHTS);var n=j(r,"losses","computeWeightedLoss"),i=null;t!=null&&(i=j(t,"weights","computeWeightedLoss"));var o=i==null?n:n.mul(i);if(e===sr.NONE)return o;if(e===sr.SUM)return o.sum();if(e===sr.MEAN){if(i==null)return o.mean();var a=n.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(Ve(a)):s}if(e===sr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Ve(n.size));var u=i.mul(Lo(n.shape)).notEqual(Ve(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+e)}}),C5=X({cosineDistance_:function(r,t,e,n,i){i===void 0&&(i=sr.SUM_BY_NONZERO_WEIGHTS);var o=j(r,"labels","cosineDistance"),a=j(t,"predictions","cosineDistance"),s=null;n!=null&&(s=j(n,"weights","cosineDistance")),Nt(o.shape,a.shape,"Error in cosineDistance: ");var u=Ve(1).sub(o.mul(a).sum(e,!0));return ka(u,s,i)}}),S5=X({hingeLoss_:function(r,t,e,n){n===void 0&&(n=sr.SUM_BY_NONZERO_WEIGHTS);var i=j(r,"labels","hingeLoss"),o=j(t,"predictions","hingeLoss"),a=null;e!=null&&(a=j(e,"weights","hingeLoss")),Nt(i.shape,o.shape,"Error in hingeLoss: ");var s=Ve(1);i=Ve(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return ka(u,a,n)}}),T5=X({huberLoss_:function(r,t,e,n,i){n===void 0&&(n=1),i===void 0&&(i=sr.SUM_BY_NONZERO_WEIGHTS);var o=j(r,"labels","huberLoss"),a=j(t,"predictions","huberLoss"),s=null;e!=null&&(s=j(e,"weights","huberLoss")),Nt(o.shape,a.shape,"Error in huberLoss: ");var u=Ve(n),c=a.sub(o).abs(),d=Zc(c,u),p=c.sub(d),f=Ve(.5).mul(d.square()).add(u.mul(p));return ka(f,s,i)}}),A5=X({logLoss_:function(r,t,e,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=sr.SUM_BY_NONZERO_WEIGHTS);var o=j(r,"labels","logLoss"),a=j(t,"predictions","logLoss"),s=null;e!=null&&(s=j(e,"weights","logLoss")),Nt(o.shape,a.shape,"Error in logLoss: ");var u=Ve(1),c=Ve(n),d=o.mul(a.add(c).log()).neg().sub(u.sub(o).mul(u.sub(a).add(c).log()));return ka(d,s,i)}}),R5=X({meanSquaredError_:function(r,t,e,n){n===void 0&&(n=sr.SUM_BY_NONZERO_WEIGHTS);var i=j(r,"labels","meanSquaredError"),o=j(t,"predictions","meanSquaredError"),a=null;e!=null&&(a=j(e,"weights","meanSquaredError")),Nt(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return ka(s,a,n)}}),k5=X({sigmoidCrossEntropy_:function(r,t,e,n,i){n===void 0&&(n=0),i===void 0&&(i=sr.SUM_BY_NONZERO_WEIGHTS);var o=j(r,"multiClassLabels","sigmoidCrossEntropy"),a=j(t,"logits","sigmoidCrossEntropy"),s=null;if(e!=null&&(s=j(e,"weights","sigmoidCrossEntropy")),Nt(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Ve(n),c=Ve(1),d=Ve(.5);o=o.mul(c.sub(u)).add(d.mul(u))}var p=function(f,g){var y=j(f,"labels","sigmoidCrossEntropyWithLogits"),x=j(g,"logits","sigmoidCrossEntropyWithLogits");Nt(y.shape,x.shape,"Error in sigmoidCrossEntropyWithLogits: ");var b=x.relu(),_=x.mul(y),C=x.abs().neg().exp().log1p();return b.sub(_).add(C)}(o,a);return ka(p,s,i)}}),N5=X({softmaxCrossEntropy_:function(r,t,e,n,i){n===void 0&&(n=0),i===void 0&&(i=sr.SUM_BY_NONZERO_WEIGHTS);var o=j(r,"onehotLabels","softmaxCrossEntropy"),a=j(t,"logits","softmaxCrossEntropy"),s=null;if(e!=null&&(s=j(e,"weights","softmaxCrossEntropy")),Nt(o.shape,a.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Ve(n),c=Ve(1),d=Ve(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(d))}var p=function(f,g,y){if(y===void 0&&(y=-1),y===-1&&(y=g.rank-1),y!==g.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+g.rank+" and dim was "+y);return Jc(function(x,b,_){var C=b.logSumExp([y],!0),T=b.toFloat().sub(C);return _([x,T]),{value:T.mul(x).neg().sum([y]),gradFunc:function(D,O){var z=O[0],I=O[1],S=li(D.shape,[y]);return[D.reshape(S).mul(z.toFloat().sub(I.exp())),D.reshape(S).mul(I.exp().sub(z.toFloat()))]}}})(f,g)}(o,a);return ka(p,s,i)}}),pD=Object.freeze({get Reduction(){return sr},absoluteDifference:I5,computeWeightedLoss:ka,cosineDistance:C5,hingeLoss:S5,huberLoss:T5,logLoss:A5,meanSquaredError:R5,sigmoidCrossEntropy:k5,softmaxCrossEntropy:N5});function WS(r,t){return t===void 0&&(t=!1),K.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var e=r.shape[0],n=r.shape[1],i=nv(e),o=r.clone(),a=pa([[1]],[1,1]),s=a.clone(),u=e>=n?n:e,c=function(p){var f,g=o,y=s,x=i;f=K.tidy(function(){var b=o.slice([p,p],[e-p,1]),_=b.norm(),C=o.slice([p,p],[1,1]),T=pa([[-1]]).where(C.greater(0),pa([[1]])),D=C.sub(T.mul(_)),O=b.div(D);s=O.shape[0]===1?a.clone():a.concat(O.slice([1,0],[O.shape[0]-1,O.shape[1]]),0);var z=T.matMul(D).div(_).neg(),I=o.slice([p,0],[e-p,n]),S=z.mul(s);if(p===0)o=I.sub(S.matMul(s.transpose().matMul(I)));else{var A=I.sub(S.matMul(s.transpose().matMul(I)));o=o.slice([0,0],[p,n]).concat(A,0)}var N=i.slice([0,p],[e,i.shape[1]-p]);if(p===0)i=N.sub(N.matMul(s).matMul(S.transpose()));else{var P=N.sub(N.matMul(s).matMul(S.transpose()));i=i.slice([0,0],[e,p]).concat(P,1)}return[s,o,i]}),s=f[0],o=f[1],i=f[2],ft([g,y,x])},d=0;d<u;++d)c(d);return!t&&e>n&&(i=i.slice([0,0],[e,n]),o=o.slice([0,0],[n,n])),[i,o]})}var D5=X({gramSchmidt_:function(r){var t;if(Array.isArray(r)){t=!1,W(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=r[0].shape[0],n=function(u){W(r[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+e+")"})},i=1;i<r.length;++i)n(i)}else t=!0,r=fa(r,r.shape[0],0).map(function(u){return up(u,[0])});W(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var o=[],a=r,s=function(u){o.push(K.tidy(function(){var c=a[u];if(u>0)for(var d=0;d<u;++d){var p=Gr(o[d].mulStrict(c)).mul(o[d]);c=c.sub(p)}return c.div(Ux(c,"euclidean"))}))};for(i=0;i<r.length;++i)s(i);return t?Ji(o,0):o}}),O5=X({qr_:function(r,t){if(t===void 0&&(t=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return WS(r,t);var e=r.shape.slice(0,r.shape.length-2).reduce(function(a,s){return a*s}),n=qu(r.reshape([e,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],o=[];return n.forEach(function(a){var s=WS(a,t),u=s[0],c=s[1];i.push(u),o.push(c)}),[Ji(i,0).reshape(r.shape),Ji(o,0).reshape(r.shape)]}}),Xx=Object.freeze({gramSchmidt:D5,qr:O5});function fD(r,t,e,n,i){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY);var o=r.shape[0];return e=Math.min(e,o),W(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),W(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),W(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),W(t.rank===1,function(){return"scores must be a 1D tensor"}),W(t.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]}),{maxOutputSize:e,iouThreshold:n,scoreThreshold:i}}var P5=X({resizeBilinear_:function(r,t,e){e===void 0&&(e=!1);var n=j(r,"images","resizeBilinear");W(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),W(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=t[0],s=t[1],u=K.runKernelFunc(function(c,d){return d([i]),c.resizeBilinear(i,a,s,e)},{batchImages:i},function(c,d){return{batchImages:function(){return K.runKernelFunc(function(p){return p.resizeBilinearBackprop(c,d[0],e)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),M5=X({resizeNearestNeighbor_:function(r,t,e){e===void 0&&(e=!1);var n=j(r,"images","resizeNearestNeighbor");W(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),W(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),W(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=t[0],s=t[1],u=K.runKernelFunc(function(c,d){return d([i]),c.resizeNearestNeighbor(i,a,s,e)},{batchImages:i},function(c,d){return{batchImages:function(){return K.runKernelFunc(function(p){return p.resizeNearestNeighborBackprop(c,d[0],e)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),L5=X({nonMaxSuppression_:function(r,t,e,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=j(r,"boxes","nonMaxSuppression"),a=j(t,"scores","nonMaxSuppression"),s=fD(o,a,e,n,i);return e=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,K.runKernelFunc(function(u){return u.nonMaxSuppression(o,a,e,n,i)},{$boxes:o})}}),F5=function(r,t,e,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Ue(this,void 0,void 0,function(){var o,a,s,u,c,d,p;return je(this,function(f){switch(f.label){case 0:return o=j(r,"boxes","nonMaxSuppressionAsync"),a=j(t,"scores","nonMaxSuppressionAsync"),s=fD(o,a,e,n,i),e=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=f.sent(),c=u[0],d=u[1],p=Zb(c,d,e,n,i),o!==r&&o.dispose(),a!==t&&a.dispose(),[2,p]}})})},z5=X({cropAndResize_:function(r,t,e,n,i,o){var a=j(r,"image","cropAndResize","float32"),s=j(t,"boxes","cropAndResize","float32"),u=j(e,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=s.shape[0];return W(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),W(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),W(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),W(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),W(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),W(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),K.runKernelFunc(function(d,p){return d.cropAndResize(a,s,u,n,i,o)},{$image:a,$boxes:s})}}),Mu=Object.freeze({resizeBilinear:P5,resizeNearestNeighbor:M5,nonMaxSuppression:L5,nonMaxSuppressionAsync:F5,cropAndResize:z5}),Qx=function(r,t){return!(r>0)&&(t==="linear"||t==="relu")},Yx=function(r,t,e){if(e==null||e==="linear")return r;if(e==="relu")return r.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Jx=function(r,t){var e=t,n=kn(r.shape,t.shape);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},Zx=function(r,t,e){if(t==="linear")return r;if(t==="relu")return js(r);if(t==="elu")return rh(r);if(t==="relu6")return Vx(r);if(t==="prelu")return kv(r,e);throw new Error("Unknown fused activation "+t+".")},V5=X({matMul_:function(r){var t,e=r.a,n=r.b,i=r.transposeA,o=i!==void 0&&i,a=r.transposeB,s=a!==void 0&&a,u=r.bias,c=r.activation,d=c===void 0?"linear":c,p=r.preluActivationWeights;if(Qx(K.state.gradientDepth,d)===!1){var f=bv(e,n,o,s);return u!=null&&(f=yt(f,u)),Zx(f,d,p)}var g=j(e,"a","fused matMul"),y=j(n,"b","fused matMul");t=gn(g,y),g=t[0],y=t[1];var x=o?g.shape[g.rank-2]:g.shape[g.rank-1],b=s?y.shape[y.rank-1]:y.shape[y.rank-2],_=o?g.shape[g.rank-1]:g.shape[g.rank-2],C=s?y.shape[y.rank-2]:y.shape[y.rank-1],T=g.shape.slice(0,-2),D=y.shape.slice(0,-2),O=He(T),z=He(D);W(g.rank>=2&&y.rank>=2&&g.rank===y.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+g.rank+" and "+y.rank+"."}),W(Qn(T,D),function(){return"Error in fused matMul: outer dimensions ("+T+") and ("+D+") of Tensors with shapes "+g.shape+" and "+y.shape+" must match."}),W(x===b,function(){return"Error in fused matMul: inner shapes ("+x+") and ("+b+") of Tensors with shapes "+g.shape+" and "+y.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var I,S,A=g.shape.slice(0,-2).concat([_,C]),N=o?g.as3D(O,x,_):g.as3D(O,_,x),P=s?y.as3D(z,C,b):y.as3D(z,b,C);u!=null&&xt(A,(I=gn(I=j(u,"bias","fused matMul"),g)[0]).shape),p!=null&&(S=j(p,"prelu weights","fused matMul"));var M={$a:N,$b:P};return u!=null&&(M.$bias=I),p!=null&&(M.$preluActivationWeights=S),K.runKernelFunc(function(F,G){var Z=F.fusedBatchMatMul({a:N,b:P,transposeA:o,transposeB:s,bias:I,activation:d,preluActivationWeights:S});return G([N,P,Z]),Z},M,function(F,G){var Z=G[0],Y=G[1],ee=G[2],H=Yx(F,ee,d),ie={};return u!=null&&(ie={$bias:function(){return Jx(I,H)}}),Object.assign(o||s?!o&&s?{$a:function(){return H.matMul(Y,!1,!1)},$b:function(){return H.matMul(Z,!0,!1)}}:o&&!s?{$a:function(){return Y.matMul(H,!1,!0)},$b:function(){return Z.matMul(H,!1,!1)}}:{$a:function(){return Y.matMul(H,!0,!0)},$b:function(){return H.matMul(Z,!0,!0)}}:{$a:function(){return H.matMul(Y,!1,!0)},$b:function(){return Z.matMul(H,!0,!1)}},ie)}).reshape(A)}}),B5=X({conv2d_:function(r){var t=r.x,e=r.filter,n=r.strides,i=r.pad,o=r.dataFormat,a=o===void 0?"NHWC":o,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,d=r.bias,p=r.activation,f=p===void 0?"linear":p,g=r.preluActivationWeights;if(f=f||"linear",Qx(K.state.gradientDepth,f)===!1){var y=ol(t,e,n,i,a,u,c);return d!=null&&(y=yt(y,d)),Zx(y,f,g)}var x=j(t,"x","conv2d"),b=j(e,"filter","conv2d"),_=x,C=!1;x.rank===3&&(C=!0,_=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),W(_.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+_.rank+"."}),W(b.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+b.rank+"."}),c!=null&&W(mn(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),W(_.shape[3]===b.shape[2],function(){return"Error in conv2d: depth of input ("+_.shape[3]+") must match input depth for filter "+b.shape[2]+"."}),W(Ar(n,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),W(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var T,D,O=Us(_.shape,b.shape,n,u,i,c);d!=null&&(T=gn(T=j(d,"bias","fused conv2d"),x)[0],xt(O.outShape,T.shape)),g!=null&&(D=j(g,"prelu weights","fused conv2d"));var z={x:_,$filter:b};d!=null&&(z.$bias=T),g!=null&&(z.$preluActivationWeights=D);var I=K.runKernelFunc(function(S,A){var N=S.fusedConv2d({input:_,filter:b,convInfo:O,bias:T,activation:f,preluActivationWeights:D});return A([b,_,N]),N},z,function(S,A){var N=A,P=N[0],M=N[1],F=N[2],G=Yx(S,F,f);W(Hu(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var Z={};return d!=null&&(Z={$bias:function(){return Jx(T,G)}}),Object.assign({x:function(){return qN(M.shape,G,P,n,i)},$filter:function(){return Lx(M,G,P.shape,n,i)}},Z)});return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),U5=X({depthwiseConv2d_:function(r){var t=r.x,e=r.filter,n=r.strides,i=r.pad,o=r.dataFormat,a=o===void 0?"NHWC":o,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,d=r.bias,p=r.activation,f=p===void 0?"linear":p,g=r.preluActivationWeights;if(Qx(K.state.gradientDepth,f)===!1){var y=nh(t,e,n,i,a,u,c);return d!=null&&(y=yt(y,d)),Zx(y,f,g)}var x=j(t,"x","depthwiseConv2d"),b=j(e,"filter","depthwiseConv2d"),_=x,C=!1;x.rank===3&&(C=!0,_=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),W(_.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+_.rank+"."}),W(b.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+b.rank+"."}),W(_.shape[3]===b.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+_.shape[3]+") must match the inChannels dimension in filter "+b.shape[2]+"."}),u==null&&(u=[1,1]),W(Ar(n,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),c!=null&&W(mn(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var T,D,O=Us(_.shape,b.shape,n,u,i,c,!0);d!=null&&(T=gn(T=j(d,"bias","fused conv2d"),x)[0],xt(O.outShape,T.shape)),g!=null&&(D=j(g,"prelu weights","fused depthwiseConv2d"));var z={x:_,$filter:b};d!=null&&(z.$bias=T),g!=null&&(z.$preluActivationWeights=D);var I=K.runKernelFunc(function(S,A){var N=S.fusedDepthwiseConv2D({input:_,filter:b,convInfo:O,bias:T,activation:f,preluActivationWeights:D});return A([_,b,N]),N},z,function(S,A){W(Hu(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=A[0],P=A[1],M=A[2],F=Yx(S,M,f),G={};return d!=null&&(G={$bias:function(){return Jx(T,F)}}),Object.assign({x:function(){return HN(N.shape,F,P,O)},$filter:function(){return $N(N,F,P.shape,O)}},G)});return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),Mc=Object.freeze({matMul:V5,conv2d:B5,depthwiseConv2d:U5}),j5=Object.freeze({image:Mu,linalg:Xx,losses:pD,spectral:uD,fused:Mc,signal:hD,square:ix,conv1d:vv,conv2d:ol,conv3d:yv,depthwiseConv2d:nh,separableConv2d:Fx,conv2dTranspose:wv,conv3dTranspose:GN,op:X,batchNormalization2d:_N,batchNormalization3d:EN,batchNormalization4d:IN,batchNormalization:CN,batchNorm:Ix,batchNorm2d:Cx,batchNorm3d:Sx,batchNorm4d:Tx,booleanMaskAsync:UN,complex:Ln,real:Wr,imag:Ci,concat:br,concat1d:Fb,concat2d:zb,concat3d:Vb,concat4d:Bb,split:fa,matMul:bv,dot:KN,outerProduct:XN,reverse:Oo,reverse1d:QN,reverse2d:YN,reverse3d:JN,reverse4d:ZN,maxPool:xv,avgPool:_v,pool:nD,maxPool3d:Ev,avgPool3d:Iv,slice:hi,slice1d:mp,slice2d:Cv,slice3d:gp,slice4d:Oc,abs:ks,acos:ox,acosh:ax,asin:sx,asinh:ux,atan:lx,atanh:cx,ceil:hx,clipByValue:Rr,cos:dx,cosh:px,erf:fx,exp:mx,expm1:gx,floor:uv,log:Ea,log1p:vx,logSigmoid:fN,neg:rl,reciprocal:yx,round:wx,rsqrt:lv,sigmoid:cv,sign:bx,isNaN:mN,isInf:gN,isFinite:vN,sin:xx,sinh:_x,softplus:hp,sqrt:dp,step:yN,tan:Ex,tanh:hv,all:Sv,any:Vd,argMax:Bd,argMin:zx,logSumExp:iD,max:Ns,mean:_n,min:Tv,moments:vp,sum:Gr,prod:Av,equal:il,equalStrict:MN,greater:eh,greaterEqual:fp,greaterEqualStrict:LN,greaterStrict:FN,less:Ox,lessEqual:Px,lessEqualStrict:zN,lessStrict:VN,notEqual:Dc,notEqualStrict:BN,add:yt,addN:Rx,addStrict:TN,atan2:kx,div:xr,divStrict:AN,floorDiv:mv,maximum:Fo,maximumStrict:RN,minimum:Zc,minimumStrict:kN,mod:Nx,modStrict:NN,mul:ot,mulStrict:gv,pow:Nc,powStrict:DN,squaredDifference:Dx,squaredDifferenceStrict:ON,sub:Yn,subStrict:PN,elu:rh,leakyRelu:Rv,prelu:kv,relu:js,relu6:Vx,selu:Nv,logicalAnd:Ra,logicalNot:Ax,logicalOr:pv,logicalXor:SN,where:Ia,whereAsync:fv,buffer:st,print:wk,batchToSpaceND:ev,cast:tv,clone:bk,cumsum:xk,depthToSpace:jb,expandDims:ii,eye:nv,multinomial:Wb,oneHot:Rc,pad:Bs,pad1d:_k,pad2d:Ek,pad3d:Ik,pad4d:Ck,rand:Sk,randomNormal:qb,randomGamma:Tk,randomUniform:tl,reshape:sp,spaceToBatchND:rv,squeeze:up,stack:Ji,tile:ws,truncatedNormal:lp,unstack:qu,setdiff1dAsync:Hb,fill:Yc,linspace:Lb,ones:Lo,range:Jg,scalar:Ve,tensor:xn,tensor1d:$r,tensor2d:pa,tensor3d:Pb,tensor4d:is,tensor5d:vk,tensor6d:yk,variable:Mb,zeros:zt,onesLike:ci,zerosLike:Ct,transpose:an,softmax:nl,logSoftmax:av,localResponseNormalization:Bx,norm:Ux,gather:th,unsortedSegmentSum:Mx,basicLSTMCell:oD,multiRNNCell:aD,movingAverage:sD,stridedSlice:jx,topk:Wx,scatterND:qx,fft:yp,ifft:Pc,rfft:wp,irfft:Dv,sparseToDense:Ov,gatherND:Hx,diag:lD,dropout:$x,hannWindow:Pv,hammingWindow:Gx,frame:Mv,stft:Kx,inTopKAsync:dD});function ye(r,t){Array.isArray(r)||(r=[r]),r.forEach(function(e){e!=null&&W(e.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function X0(r,t,e,n){if(e==="linear")return r.linear(t);if(e==="relu")return r.relu(t);if(e==="elu")return r.elu(t);if(e==="relu6")return r.relu6(t);if(e==="prelu")return r.prelu(t,n);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var W5=function(r){function t(){var e=r.call(this)||this;if(e.blockSize=48,e.firstUse=!0,he().get("IS_BROWSER")){var n=typeof OffscreenCanvas<"u"?new OffscreenCanvas(300,150):typeof document<"u"?document.createElement("canvas"):null;n!==null&&(e.fromPixels2DContext=n.getContext("2d"))}return e.data=new Kb(e,K),e}return to(t,r),t.prototype.write=function(e,n,i){this.firstUse&&(this.firstUse=!1,he().get("IS_NODE")&&Zw(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`));var o={};return this.data.set(o,{values:e,dtype:i}),o},t.prototype.move=function(e,n,i,o){this.data.set(e,{values:n,dtype:o})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.fromPixels=function(e,n){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var i,o,a=e.data instanceof Uint8Array,s=typeof ImageData<"u"&&e instanceof ImageData,u=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement,c=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,d=u?[e.videoWidth,e.videoHeight]:[e.width,e.height],p=d[0],f=d[1];if(he().get("IS_NODE")&&e.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(e.getContext!=null)i=e.getContext("2d").getImageData(0,0,p,f).data;else if(s||a)i=e.data;else{if(!c&&!u)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=p,this.fromPixels2DContext.canvas.height=f,this.fromPixels2DContext.drawImage(e,0,0,p,f),i=this.fromPixels2DContext.getImageData(0,0,p,f).data}if(n===4)o=new Int32Array(i);else{var g=p*f;o=new Int32Array(g*n);for(var y=0;y<g;y++)for(var x=0;x<n;++x)o[y*n+x]=i[4*y+x]}return Pb(o,[f,p,n],"int32")},t.prototype.read=function(e){return Ue(this,void 0,void 0,function(){return je(this,function(n){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var n=this.data.get(e),i=n.dtype,o=n.complexTensors;return i==="complex64"?n1(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var n=this.readSync(e.dataId),i=n;if(e.dtype==="string")try{i=n.map(function(o){return Nd(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return st(e.shape,e.dtype,i)},t.prototype.makeOutput=function(e,n,i){var o=this.write(e,n,i);return K.makeTensorFromDataId(o,n,i,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var n=this.data.get(e).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Ue(this,void 0,void 0,function(){var n;return je(this,function(i){return n=$i(),e(),[2,{kernelMs:$i()-n}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,n){var i=this.makeOutput(null,e.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:K.keep(e.clone()),imag:K.keep(n.clone())},i},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,n,i){if(ye(e,"slice"),$b(e.shape,n,i)){var o=Gb(n,e.strides),a=He(i);return xn(this.readSync(e.dataId).subarray(o,o+a),i,e.dtype)}for(var s=st(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var d=s.indexToLoc(c).map(function(p,f){return p+n[f]});s.values[c]=u.get.apply(u,d)}return s.toTensor()},t.prototype.stridedSlice=function(e,n,i,o){ye(e,"stridedSlice");var a=iv(n,i,o);if(a.some(function(g){return g===0}))return xn([],a);for(var s=st(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var d=s.indexToLoc(c),p=new Array(d.length),f=0;f<p.length;f++)p[f]=d[f]*o[f]+n[f];s.set.apply(s,[u.get.apply(u,p)].concat(d))}return s.toTensor()},t.prototype.diag=function(e){for(var n=this.readSync(e.dataId),i=st([e.size,e.size],e.dtype),o=i.values,a=0;a<n.length;a++)o[a*e.size+a]=n[a];return i.toTensor()},t.prototype.unstack=function(e,n){for(var i=e.shape[n],o=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==n&&(o[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[n]=1;var d=new Array(i);for(s=0;s<d.length;s++)u[n]=s,d[s]=this.slice(e,u,c).reshape(o);return d},t.prototype.reverse=function(e,n){ye(e,"reverse");for(var i=st(e.shape,e.dtype),o=this.bufferSync(e),a=function(u){var c=i.indexToLoc(u),d=c.slice();n.forEach(function(p){return d[p]=e.shape[p]-1-d[p]}),i.set.apply(i,[o.get.apply(o,d)].concat(c))},s=0;s<i.size;s++)a(s);return i.toTensor()},t.prototype.concat=function(e,n){var i=this;if(e[0].dtype==="complex64"){var o=e.map(function(g){return Wr(g)}),a=e.map(function(g){return Ci(g)});return Ln(this.concat(o,n),this.concat(a,n))}var s=e.map(function(g){var y=He(g.shape.slice(n));return g.as2D(-1,y)}),u=Wu(s.map(function(g){return g.shape}),1),c=st(u,e[0].dtype).values;if(s[0].shape[0]===1){var d=0;s.forEach(function(g){c.set(i.readSync(g.dataId),d),d+=g.size})}else{var p=0;s.forEach(function(g){for(var y=i.readSync(g.dataId),x=0,b=0;b<g.shape[0];++b)for(var _=b*u[1]+p,C=0;C<g.shape[1];++C)c[_+C]=y[x++];p+=g.shape[1]})}var f=Wu(e.map(function(g){return g.shape}),n);return xn(c,f,e[0].dtype)},t.prototype.neg=function(e){return ye(e,"neg"),this.multiply(Ve(-1),e)},t.prototype.add=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),function(i,o,a,s){return{real:i+a,imag:o+s}}):this.broadcastedBinaryOp(e,n,Tn(e.dtype,n.dtype),function(i,o){return i+o})},t.prototype.addN=function(e){var n=this;ye(e,"addN");for(var i=e.map(function(d){return n.readSync(d.dataId)}),o=st(e[0].shape,e[0].dtype),a=o.values,s=0;s<e.length;s++)for(var u=i[s],c=0;c<a.length;c++)a[c]+=u[c];return o.toTensor()},t.prototype.subtract=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),function(i,o,a,s){return{real:i-a,imag:o-s}}):this.broadcastedBinaryOp(e,n,Tn(e.dtype,n.dtype),function(i,o){return i-o})},t.prototype.pow=function(e,n){return ye([e,n],"pow"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){return Math.pow(i,o)})},t.prototype.batchMatMul=function(e,n,i,o){ye([e,n],"matMul");for(var a=i?e.shape[1]:e.shape[2],s=i?e.shape[2]:e.shape[1],u=o?n.shape[1]:n.shape[2],c=e.shape[0],d=this.readSync(e.dataId),p=this.readSync(n.dataId),f=i?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],g=f[0],y=f[1],x=f[2],b=o?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],_=b[0],C=b[1],T=b[2],D=s*u,O=st([c,s,u],e.dtype),z=O.values,I=this.blockSize,S=0;S<c;S++)for(var A=0;A<s;A+=I)for(var N=0;N<u;N+=I)for(var P=0;P<a;P+=I)for(var M=Math.min(A+I,s),F=Math.min(N+I,u),G=Math.min(P+I,a),Z=A;Z<M;Z++)for(var Y=N;Y<F;Y++){for(var ee=0,H=P;H<G;H++)ee+=d[S*g+Z*y+H*x]*p[H*_+Y*C+S*T];z[S*D+(Z*u+Y)]+=ee}return O.toTensor()},t.prototype.fusedBatchMatMul=function(e){var n=e.a,i=e.b,o=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,d=this.batchMatMul(n,i,o,a);return s&&(d=this.add(d,s)),u&&(d=X0(this,d,u,c)),d},t.prototype.multiply=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}}):this.broadcastedBinaryOp(e,n,Tn(e.dtype,n.dtype),function(i,o){return i*o})},t.prototype.realDivide=function(e,n){return ye([e,n],"realDivide"),this.broadcastedBinaryOp(e,n,"float32",function(i,o){return i/o})},t.prototype.floorDiv=function(e,n){return ye([e,n],"floorDiv"),this.broadcastedBinaryOp(e,n,"int32",function(i,o){return Math.floor(i/o)})},t.prototype.sum=function(e,n){ye(e,"sum"),Ur("sum",n,e.rank);for(var i=ir(e.shape,n),o=i[0],a=i[1],s=zt(o,Tn(e.dtype,"int32")),u=He(a),c=this.readSync(s.dataId),d=this.readSync(e.dataId),p=0;p<c.length;++p){for(var f=p*u,g=0,y=0;y<u;++y)g+=d[f+y];c[p]=g}return s},t.prototype.prod=function(e,n){ye(e,"sum");for(var i=ir(e.shape,n),o=i[0],a=i[1],s=zt(o,Tn(e.dtype,"int32")),u=He(a),c=this.readSync(s.dataId),d=this.readSync(e.dataId),p=0;p<c.length;++p){for(var f=p*u,g=1,y=0;y<u;++y)g*=d[f+y];c[p]=g}return s},t.prototype.unsortedSegmentSum=function(e,n,i){ye(e,"unsortedSegmentSum");for(var o=[],a=e.rank-n.rank,s=0;s<a;++s)n=n.expandDims(s+1);for(s=0;s<i;++s){var u=Ve(s,"int32"),c=il(u,n).asType("float32").mul(e).sum(0);o.push(c)}return Ji(o)},t.prototype.argMin=function(e,n){ye(e,"argMin");var i=[n];Ur("argMin",i,e.rank);for(var o=ir(e.shape,i),a=o[0],s=o[1],u=zt(a,"int32"),c=He(s),d=this.readSync(u.dataId),p=this.readSync(e.dataId),f=0;f<d.length;++f){for(var g=f*c,y=p[g],x=0,b=0;b<c;++b){var _=p[g+b];_<y&&(y=_,x=b)}d[f]=x}return u},t.prototype.argMax=function(e,n){ye(e,"argMax");var i=[n];Ur("argMax",i,e.rank);for(var o=ir(e.shape,i),a=o[0],s=o[1],u=zt(a,"int32"),c=He(s),d=this.readSync(u.dataId),p=this.readSync(e.dataId),f=0;f<d.length;++f){for(var g=f*c,y=p[g],x=0,b=0;b<c;++b){var _=p[g+b];_>y&&(y=_,x=b)}d[f]=x}return u},t.prototype.cumsum=function(e,n,i,o){if(ye(e,"cumsum"),n!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+n);for(var a=Tn(e.dtype,"int32"),s=zt(e.shape,a),u=this.readSync(s.dataId),c=this.readSync(e.dataId),d=e.shape[e.rank-1],p=o?function(b,_){return b+d-_-1}:function(b,_){return b+_},f=0;f<c.length;f+=d)for(var g=0;g<d;g++){var y=p(f,g);if(g===0)u[y]=i?0:c[y];else{var x=p(f,g-1);u[y]=i?c[x]+u[x]:c[y]+u[x]}}return s},t.prototype.equal=function(e,n){return ye([e,n],"equal"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i===o?1:0})},t.prototype.notEqual=function(e,n){return ye([e,n],"notEqual"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i!==o?1:0})},t.prototype.less=function(e,n){return ye([e,n],"less"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i<o?1:0})},t.prototype.lessEqual=function(e,n){return ye([e,n],"lessEqual"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i<=o?1:0})},t.prototype.greater=function(e,n){return ye([e,n],"greater"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i>o?1:0})},t.prototype.greaterEqual=function(e,n){return ye([e,n],"greaterEqual"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i>=o?1:0})},t.prototype.logicalNot=function(e){ye(e,"logicalNot");for(var n=this.readSync(e.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n[o]?0:1;return this.makeOutput(i,e.shape,"bool")},t.prototype.logicalAnd=function(e,n){return ye([e,n],"logicalAnd"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i&&o})},t.prototype.logicalOr=function(e,n){return ye([e,n],"logicalOr"),this.broadcastedBinaryOp(e,n,"bool",function(i,o){return i||o})},t.prototype.select=function(e,n,i){ye([e,n,i],"select");for(var o=this.readSync(e.dataId),a=this.readSync(n.dataId),s=this.readSync(i.dataId),u=zt(n.shape,Tn(n.dtype,i.dtype)),c=this.readSync(u.dataId),d=0,p=e.rank===0||e.rank>1||n.rank===1?1:He(n.shape.slice(1)),f=0;f<o.length;f++)for(var g=0;g<p;g++)o[f]===1?c[d++]=a[f]:c[d++]=s[f];return u},t.prototype.where=function(e){ye([e],"where");var n=this.readSync(e.dataId);return ex(e.shape,n)},t.prototype.topk=function(e,n,i){return ye(e,"topk"),zk(this.readSync(e.dataId),e.shape,e.dtype,n)},t.prototype.min=function(e,n){ye(e,"min"),Ur("min",n,e.rank);for(var i=ir(e.shape,n),o=i[0],a=i[1],s=zt(o,e.dtype),u=He(a),c=this.readSync(s.dataId),d=this.readSync(e.dataId),p=0;p<c.length;++p){for(var f=p*u,g=d[f],y=0;y<u;++y){var x=d[f+y];x<g&&(g=x)}c[p]=g}return s},t.prototype.minimum=function(e,n){return ye([e,n],"minimum"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){return Math.min(i,o)})},t.prototype.mod=function(e,n){return ye([e,n],"mod"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o})},t.prototype.max=function(e,n){ye(e,"max"),Ur("max",n,e.rank);for(var i=ir(e.shape,n),o=i[0],a=i[1],s=zt(o,e.dtype),u=He(a),c=this.readSync(s.dataId),d=this.readSync(e.dataId),p=0;p<c.length;++p){for(var f=p*u,g=d[f],y=0;y<u;++y){var x=d[f+y];x>g&&(g=x)}c[p]=g}return s},t.prototype.maximum=function(e,n){return ye([e,n],"maximum"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){return Math.max(i,o)})},t.prototype.all=function(e,n){ye(e,"all"),Ur("all",n,e.rank);for(var i=ir(e.shape,n),o=i[0],a=i[1],s=zt(o,e.dtype),u=He(a),c=this.readSync(s.dataId),d=this.readSync(e.dataId),p=0;p<c.length;++p){for(var f=p*u,g=d[f],y=0;y<u;++y){var x=d[f+y];g=g&&x}c[p]=g}return s},t.prototype.any=function(e,n){ye(e,"any"),Ur("any",n,e.rank);for(var i=ir(e.shape,n),o=i[0],a=i[1],s=zt(o,e.dtype),u=He(a),c=this.readSync(s.dataId),d=this.readSync(e.dataId),p=0;p<c.length;++p){for(var f=p*u,g=d[f],y=0;y<u;++y){var x=d[f+y];g=g||x}c[p]=g}return s},t.prototype.squaredDifference=function(e,n){return ye([e,n],"squaredDifference"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){var a=i-o;return a*a})},t.prototype.ceil=function(e){ye(e,"ceil");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.ceil(n[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.floor=function(e){ye(e,"floor");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.floor(n[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.sign=function(e){ye(e,"x");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)n[o]<0?i[o]=-1:n[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,e.shape,"float32")},t.prototype.isNaN=function(e){ye(e,"x");for(var n=this.readSync(e.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Number.isNaN(n[o])&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},t.prototype.isInf=function(e){ye(e,"x");for(var n=this.readSync(e.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Math.abs(n[o])===1/0&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},t.prototype.isFinite=function(e){ye(e,"x");for(var n=this.readSync(e.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Number.isFinite(n[o])&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},t.prototype.round=function(e){ye(e,"round");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=Math.floor(n[o]);n[o]-a<.5?i[o]=Math.floor(n[o]):n[o]-a>.5?i[o]=Math.ceil(n[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,e.shape,"float32")},t.prototype.exp=function(e){ye(e,"exp");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.exp(n[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.expm1=function(e){ye(e,"expm1");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.expm1(n[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.log=function(e){ye(e,"log");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.log(a)}return this.makeOutput(i,e.shape,"float32")},t.prototype.log1p=function(e){ye(e,"log1p");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.log1p(a)}return this.makeOutput(i,e.shape,"float32")},t.prototype.sqrt=function(e){ye(e,"sqrt");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,e.shape,"float32")},t.prototype.rsqrt=function(e){ye(e,"rsqrt");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,e.shape,"float32")},t.prototype.reciprocal=function(e){ye(e,"reciprocal");for(var n=this.readSync(e.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=1/n[o];return this.makeOutput(i,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){ye(e,"relu");for(var n=zt(e.shape,e.dtype),i=this.readSync(n.dataId),o=this.readSync(e.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return n},t.prototype.relu6=function(e){ye(e,"relu");for(var n=zt(e.shape,e.dtype),i=this.readSync(n.dataId),o=this.readSync(e.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return n},t.prototype.prelu=function(e,n){return ye([e,n],"prelu"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){return i<0?o*i:i})},t.prototype.elu=function(e){ye(e,"elu");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=i[o];n[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(n,e.shape,"float32")},t.prototype.eluDer=function(e,n){ye([e,n],"eluDer");for(var i=new Float32Array(n.size),o=this.readSync(n.dataId),a=this.readSync(e.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,n.shape,"float32")},t.prototype.selu=function(e){ye(e,"selu");for(var n=nx,i=rx,o=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:n*(Math.exp(u)-1)}return this.makeOutput(o,e.shape,"float32")},t.prototype.clip=function(e,n,i){ye(e,"clip");for(var o=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<n?n:u}return this.makeOutput(o,e.shape,"float32")},t.prototype.abs=function(e){for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.abs(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<e.size;++o){var a=i[2*o],s=i[2*o+1];n[o]=Math.hypot(a,s)}return this.makeOutput(n,e.shape,"float32")},t.prototype.int=function(e){ye(e,"int");for(var n=new Int32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=i[o];return this.makeOutput(n,e.shape,"int32")},t.prototype.sigmoid=function(e){ye(e,"sigmoid");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(n,e.shape,"float32")},t.prototype.softplus=function(e){ye(e,"softplus");for(var n=Math.log(11920928955078125e-23)+2,i=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var s=o[a]>-n,u=o[a]<n,c=Math.exp(o[a]),d=void 0;d=u?c:s?o[a]:Math.log(1+c),i[a]=d}return this.makeOutput(i,e.shape,"float32")},t.prototype.sin=function(e){ye(e,"sin");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.sin(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.cos=function(e){ye(e,"cos");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.cos(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.tan=function(e){ye(e,"tan");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.tan(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.asin=function(e){ye(e,"asin");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.asin(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.acos=function(e){ye(e,"acos");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.acos(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atan=function(e){ye(e,"atan");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.atan(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atan2=function(e,n){return ye([e,n],"atan2"),this.broadcastedBinaryOp(e,n,e.dtype,function(i,o){return Math.atan2(i,o)})},t.prototype.sinh=function(e){ye(e,"sinh");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.sinh(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.cosh=function(e){ye(e,"cosh");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.cosh(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.tanh=function(e){ye(e,"tanh");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=RR(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.asinh=function(e){ye(e,"asinh");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.asinh(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.acosh=function(e){ye(e,"acosh");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.acosh(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atanh=function(e){ye(e,"atanh");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.atanh(i[o]);return this.makeOutput(n,e.shape,"float32")},t.prototype.erf=function(e){ye(e,"erf");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);n[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(n,e.shape,"float32")},t.prototype.step=function(e,n){n===void 0&&(n=0),ye(e,"step");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:n}return this.makeOutput(i,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var n=e.input,i=e.filter,o=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(n,i,o);return a&&(c=this.add(c,a)),s&&(c=X0(this,c,s,u)),c},t.prototype.conv2d=function(e,n,i){ye([e,n],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,d=i.padInfo.top,p=i.dataFormat==="channelsLast",f=st(i.outShape,e.dtype),g=e.strides[0],y=p?e.strides[1]:e.strides[2],x=p?e.strides[2]:1,b=p?1:e.strides[1],_=f.strides[0],C=p?f.strides[1]:f.strides[2],T=p?f.strides[2]:1,D=p?1:f.strides[1],O=this.readSync(e.dataId),z=this.readSync(n.dataId),I=f.values,S=0;S<i.batchSize;++S)for(var A=S*g,N=S*_,P=0;P<i.outHeight;++P)for(var M=N+P*C,F=P*i.strideHeight-d,G=0;G<o;G++){var Z=F+G*s;if(!(Z<0||Z>=i.inHeight))for(var Y=G*n.strides[0],ee=A+Z*y,H=0;H<i.outWidth;++H)for(var ie=M+H*T,J=H*i.strideWidth-c,q=0;q<a;q++){var ne=J+q*u;if(!(ne<0||ne>=i.inWidth))for(var me=ee+ne*x,Ce=Y+q*n.strides[1],Te=0;Te<i.inChannels;++Te){for(var Re=O[me+Te*b],De=0;De<i.outChannels;++De)I[ie+De*D]+=Re*z[Ce+De];Ce+=i.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(e,n,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,c=i.dilationHeight,d=i.dilationWidth,p=i.padInfo.front,f=i.padInfo.left,g=i.padInfo.top,y=st(i.outShape,e.dtype),x=this.readSync(e.dataId),b=this.readSync(n.dataId),_=y.values,C=0;C<i.batchSize;++C)for(var T=C*e.strides[0],D=C*y.strides[0],O=0;O<i.outDepth;++O)for(var z=D+O*y.strides[1],I=O*i.strideDepth-p,S=0;S<o;S++){var A=I+S*u;if(!(A<0||A>=i.inDepth))for(var N=S*n.strides[0],P=T+A*e.strides[1],M=0;M<i.outHeight;++M)for(var F=z+M*y.strides[2],G=M*i.strideHeight-g,Z=0;Z<a;Z++){var Y=G+Z*c;if(!(Y<0||Y>=i.inHeight))for(var ee=N+Z*n.strides[1],H=P+Y*e.strides[2],ie=0;ie<i.outWidth;++ie)for(var J=F+ie*i.outChannels,q=ie*i.strideWidth-f,ne=0;ne<s;ne++){var me=q+ne*d;if(!(me<0||me>=i.inWidth))for(var Ce=ee+ne*n.strides[2],Te=H+me*i.inChannels,Re=Ce,De=0;De<i.inChannels;++De){for(var Oe=x[Te+De],ze=0;ze<i.outChannels;++ze)_[J+ze]+=Oe*b[Re+ze];Re+=i.outChannels}}}}return y.toTensor()},t.prototype.conv2dDerInput=function(e,n,i){ye([e,n],"conv2dDerInput");for(var o=st(i.inShape,"float32"),a=o.values,s=this.readSync(e.dataId),u=this.readSync(n.dataId),c=n.strides,d=c[0],p=c[1],f=c[2],g=i.batchSize,y=i.filterHeight,x=i.filterWidth,b=i.inChannels,_=i.inHeight,C=i.inWidth,T=i.outChannels,D=i.outHeight,O=i.outWidth,z=i.strideHeight,I=i.strideWidth,S=i.dataFormat,A=y-1-i.padInfo.top,N=x-1-i.padInfo.left,P=S==="channelsLast",M=o.strides[0],F=P?o.strides[1]:o.strides[2],G=P?o.strides[2]:1,Z=P?1:o.strides[1],Y=e.strides[0],ee=P?e.strides[1]:e.strides[2],H=P?e.strides[2]:1,ie=P?1:e.strides[1],J=0;J<g;++J)for(var q=0;q<b;++q)for(var ne=0;ne<_;++ne)for(var me=ne-A,Ce=Math.max(0,Math.ceil(me/z)),Te=Math.min(D,(y+me)/z),Re=0;Re<C;++Re){for(var De=Re-N,Oe=Math.max(0,Math.ceil(De/I)),ze=Math.min(O,(x+De)/I),ct=0,Ze=Ce;Ze<Te;++Ze)for(var wt=Ze*z-me,ht=Oe;ht<ze;++ht)for(var et=Y*J+ee*Ze+H*ht,Dt=d*(y-1-wt)+p*(x-1-(ht*I-De))+f*q,_t=0;_t<T;++_t)ct+=s[et+ie*_t]*u[Dt+_t];a[M*J+F*ne+G*Re+Z*q]=ct}return o.toTensor()},t.prototype.conv3dDerInput=function(e,n,i){for(var o=st(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],c=s[1],d=s[2],p=s[3],f=this.readSync(e.dataId),g=e.strides,y=g[0],x=g[1],b=g[2],_=g[3],C=this.readSync(n.dataId),T=n.strides,D=T[0],O=T[1],z=T[2],I=T[3],S=i.batchSize,A=i.filterDepth,N=i.filterHeight,P=i.filterWidth,M=i.inChannels,F=i.inDepth,G=i.inHeight,Z=i.inWidth,Y=i.outChannels,ee=i.outDepth,H=i.outHeight,ie=i.outWidth,J=i.strideDepth,q=i.strideHeight,ne=i.strideWidth,me=A-1-i.padInfo.front,Ce=N-1-i.padInfo.top,Te=P-1-i.padInfo.left,Re=0;Re<S;++Re)for(var De=0;De<M;++De)for(var Oe=0;Oe<F;++Oe)for(var ze=Oe-me,ct=Math.max(0,Math.ceil(ze/J)),Ze=Math.min(ee,(A+ze)/J),wt=0;wt<G;++wt)for(var ht=wt-Ce,et=Math.max(0,Math.ceil(ht/q)),Dt=Math.min(H,(N+ht)/q),_t=0;_t<Z;++_t){for(var vn=_t-Te,lr=Math.max(0,Math.ceil(vn/ne)),dn=Math.min(ie,(P+vn)/ne),sn=0,Ht=ct;Ht<Ze;++Ht)for(var jn=Ht*J-ze,at=et;at<Dt;++at)for(var En=at*q-ht,Qt=lr;Qt<dn;++Qt)for(var bt=y*Re+x*Ht+b*at+_*Qt,Lt=D*(A-1-jn)+O*(N-1-En)+z*(P-1-(Qt*ne-vn))+I*De,Dn=0;Dn<Y;++Dn)sn+=f[bt+Dn]*C[Lt+Dn];a[u*Re+c*Oe+d*wt+p*_t+De]=sn}return o.toTensor()},t.prototype.conv2dDerFilter=function(e,n,i){ye([e,n],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,c=i.dataFormat==="channelsLast",d=st(i.filterShape,"float32"),p=i.padInfo.left,f=i.padInfo.top,g=this.bufferSync(e),y=this.bufferSync(n),x=0;x<s;++x)for(var b=Math.max(0,Math.ceil((f-x)/o)),_=Math.min(i.outHeight,(i.inHeight+f-x)/o),C=0;C<u;++C)for(var T=Math.max(0,Math.ceil((p-C)/a)),D=Math.min(i.outWidth,(i.inWidth+p-C)/a),O=0;O<i.inChannels;++O)for(var z=0;z<i.outChannels;++z){for(var I=0,S=0;S<i.batchSize;++S)for(var A=b;A<_;++A)for(var N=x+A*o-f,P=T;P<D;++P){var M=C+P*a-p;I+=c?g.get(S,N,M,O)*y.get(S,A,P,z):g.get(S,O,N,M)*y.get(S,z,A,P)}d.set(I,x,C,O,z)}return d.toTensor()},t.prototype.conv3dDerFilter=function(e,n,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,c=i.filterHeight,d=i.filterWidth,p=st(i.filterShape,"float32"),f=p.values,g=p.strides,y=g[0],x=g[1],b=g[2],_=g[3],C=this.readSync(n.dataId),T=n.strides,D=T[0],O=T[1],z=T[2],I=T[3],S=this.readSync(e.dataId),A=e.strides,N=A[0],P=A[1],M=A[2],F=A[3],G=i.padInfo.front,Z=i.padInfo.left,Y=i.padInfo.top,ee=0;ee<u;++ee)for(var H=Math.max(0,Math.ceil((G-ee)/o)),ie=Math.min(i.outDepth,(i.inDepth+G-ee)/o),J=ee*y,q=0;q<c;++q)for(var ne=Math.max(0,Math.ceil((Y-q)/a)),me=Math.min(i.outHeight,(i.inHeight+Y-q)/a),Ce=q*x+J,Te=0;Te<d;++Te)for(var Re=Math.max(0,Math.ceil((Z-Te)/s)),De=Math.min(i.outWidth,(i.inWidth+Z-Te)/s),Oe=Te*b+Ce,ze=0;ze<i.inChannels;++ze)for(var ct=ze*_+Oe,Ze=0;Ze<i.outChannels;++Ze){for(var wt=0,ht=0;ht<i.batchSize;++ht)for(var et=ht*N,Dt=ht*D,_t=H;_t<ie;++_t)for(var vn=(ee+_t*o-G)*P+et,lr=_t*O+Dt,dn=ne;dn<me;++dn)for(var sn=(q+dn*a-Y)*M+vn,Ht=dn*z+lr,jn=Re;jn<De;++jn){var at=jn*I+Ht;wt+=S[(Te+jn*s-Z)*F+sn+ze]*C[at+Ze]}f[ct+Ze]=wt}return p.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var n=e.input,i=e.filter,o=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(n,i,o);return a&&(c=this.add(c,a)),s&&(c=X0(this,c,s,u)),c},t.prototype.depthwiseConv2D=function(e,n,i){ye([e,n],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,d=i.padInfo.top,p=i.outChannels/i.inChannels,f=st(i.outShape,e.dtype),g=this.readSync(e.dataId),y=this.readSync(n.dataId),x=f.values,b=0;b<i.batchSize;++b)for(var _=b*e.strides[0],C=b*f.strides[0],T=0;T<i.outHeight;++T)for(var D=C+T*f.strides[1],O=T*i.strideHeight-c,z=0;z<o;++z){var I=O+z*s;if(!(I<0||I>=i.inHeight))for(var S=z*n.strides[0],A=_+I*e.strides[1],N=0;N<i.outWidth;++N)for(var P=D+N*f.strides[2],M=N*i.strideWidth-d,F=0;F<a;++F){var G=M+F*u;if(!(G<0||G>=i.inWidth))for(var Z=S+F*n.strides[1],Y=A+G*i.inChannels,ee=P,H=Z,ie=0;ie<i.inChannels;++ie){for(var J=g[Y+ie],q=0;q<p;++q)x[ee+q]+=J*y[H+q];ee+=p,H+=p}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,n,i){ye([e,n],"depthwiseConv2DDerInput");for(var o=st(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],c=s[1],d=s[2],p=this.readSync(e.dataId),f=e.strides,g=f[0],y=f[1],x=f[2],b=this.readSync(n.dataId),_=n.strides,C=_[0],T=_[1],D=_[2],O=i.batchSize,z=i.filterHeight,I=i.filterWidth,S=i.inChannels,A=i.inHeight,N=i.inWidth,P=i.outChannels,M=i.outHeight,F=i.outWidth,G=i.strideHeight,Z=i.strideWidth,Y=z-1-i.padInfo.top,ee=I-1-i.padInfo.left,H=P/S,ie=0;ie<O;++ie)for(var J=0;J<S;++J)for(var q=0;q<A;++q)for(var ne=q-Y,me=Math.max(0,Math.ceil(ne/G)),Ce=Math.min(M,(z+ne)/G),Te=0;Te<N;++Te){for(var Re=Te-ee,De=Math.max(0,Math.ceil(Re/Z)),Oe=Math.min(F,(I+Re)/Z),ze=0,ct=me;ct<Ce;++ct)for(var Ze=ct*G-ne,wt=De;wt<Oe;++wt)for(var ht=g*ie+y*ct+x*wt,et=C*(z-1-Ze)+T*(I-1-(wt*Z-Re))+D*J,Dt=0;Dt<H;++Dt)ze+=p[ht+(J*H+Dt)]*b[et+Dt];a[u*ie+c*q+d*Te+J]=ze}return o.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,n,i){ye([e,n],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,c=st(i.filterShape,"float32"),d=i.padInfo.left,p=i.padInfo.top,f=i.outChannels/i.inChannels,g=this.bufferSync(e),y=this.bufferSync(n),x=0;x<s;++x)for(var b=Math.max(0,Math.ceil((p-x)/o)),_=Math.min(i.outHeight,(i.inHeight+p-x)/o),C=0;C<u;++C)for(var T=Math.max(0,Math.ceil((d-C)/a)),D=Math.min(i.outWidth,(i.inWidth+d-C)/a),O=0;O<i.outChannels;++O){for(var z=Math.trunc(O/f),I=O%f,S=0,A=0;A<i.batchSize;++A)for(var N=b;N<_;++N)for(var P=x+N*o-p,M=T;M<D;++M){var F=C+M*a-d;S+=g.get(A,P,F,z)*y.get(A,N,M,O)}c.set(S,x,C,z,I)}return c.toTensor()},t.prototype.tile=function(e,n){return ye(e,"tile"),Fk(this.bufferSync(e),n)},t.prototype.pad=function(e,n,i){ye(e,"pad");var o=n.map(function(f,g){return f[0]+e.shape[g]+f[1]}),a=n.map(function(f){return f[0]}),s=this.bufferSync(e),u=st(o,e.dtype);i!==0&&u.values.fill(i);for(var c=0;c<e.size;c++){var d=s.indexToLoc(c),p=d.map(function(f,g){return f+a[g]});u.set.apply(u,[s.get.apply(s,d)].concat(p))}return u.toTensor()},t.prototype.transpose=function(e,n){ye(e,"transpose");for(var i=new Array(e.rank),o=0;o<i.length;o++)i[o]=e.shape[n[o]];var a=this.readSync(e.dataId),s=st(i,e.dtype),u=this.bufferSync(e);for(o=0;o<e.size;++o){for(var c=u.indexToLoc(o),d=new Array(c.length),p=0;p<d.length;p++)d[p]=c[n[p]];var f=s.locToIndex(d);s.values[f]=a[o]}return s.toTensor()},t.prototype.gather=function(e,n,i){ye([e,n],"gather");var o=e.shape.slice(),a=this.readSync(n.dataId);o[i]=a.length;for(var s=st(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var d=s.indexToLoc(c),p=d.slice();p[i]=a[d[i]];var f=u.locToIndex(p);s.values[c]=u.values[f]}return s.toTensor()},t.prototype.batchToSpaceND=function(e,n,i){ye([e],"batchToSpaceND");var o=n.reduce(function(p,f){return p*f}),a=ug(e.shape,n,o),s=lg(a.length,n.length),u=cg(e.shape,n,o),c=Ak(i,n.length),d=Rk(u,i,n.length);return e.reshape(a).transpose(s).reshape(u).slice(c,d)},t.prototype.spaceToBatchND=function(e,n,i){ye([e],"spaceToBatchND");var o=n.reduce(function(f,g){return f*g}),a=[[0,0]];a.push.apply(a,i);for(var s=1+n.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=ug(u.shape,n,o,!1),d=lg(c.length,n.length,!1),p=cg(u.shape,n,o,!1);return u.reshape(c).transpose(d).reshape(p)},t.prototype.pool=function(e,n,i){ye(e,"pool");for(var o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.top,f=n.padInfo.left,g=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(e.dataId),x=st(n.outShape,e.dtype),b=x.values,_=n.outShape[1]*n.outShape[2]*n.outShape[3],C=n.outShape[2]*n.outShape[3],T=n.outShape[3],D=0;D<n.batchSize;++D)for(var O=D*_,z=D*e.strides[0],I=0;I<n.inChannels;++I)for(var S=0;S<n.outHeight;++S)for(var A=S*o-p,N=Math.max(0,A),P=Math.min(n.inHeight,c+A),M=O+S*C,F=0;F<n.outWidth;++F){for(var G=F*a-f,Z=Math.max(0,G),Y=Math.min(n.inWidth,d+G),ee=g,H=0,ie=0,J=N;J<P;J+=s){for(var q=z+J*e.strides[1],ne=Z;ne<Y;ne+=u){var me=y[q+ne*e.strides[2]+I];i==="max"&&me>ee?ee=me:i==="avg"&&(H+=me,ie++)}if(isNaN(ee))break}b[M+F*T+I]=i==="avg"?H/ie:ee}return x.toTensor()},t.prototype.maxPool=function(e,n){return this.pool(e,n,"max")},t.prototype.maxPoolPositions=function(e,n){for(var i=st(n.outShape,"int32"),o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.top,f=n.padInfo.left,g=this.bufferSync(e),y=0;y<n.batchSize;++y)for(var x=0;x<n.inChannels;++x)for(var b=0;b<n.outHeight;++b){for(var _=b*o-p,C=_;C<0;)C+=s;for(var T=Math.min(n.inHeight,c+_),D=0;D<n.outWidth;++D){for(var O=D*a-f,z=O;z<0;)z+=u;for(var I=Math.min(n.inWidth,d+O),S=Number.NEGATIVE_INFINITY,A=-1,N=C;N<T;N+=s)for(var P=N-_,M=z;M<I;M+=u){var F=M-O,G=g.get(y,N,M,x);G>S&&(S=G,A=P*d+F)}i.set(A,y,b,D,x)}}return i.toTensor()},t.prototype.maxPoolBackprop=function(e,n,i,o){ye([n,i],"maxPoolBackprop");for(var a=this.maxPoolPositions(n,o),s=o.strideHeight,u=o.strideWidth,c=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterHeight,f=o.effectiveFilterWidth,g=f-1-o.padInfo.left,y=p-1-o.padInfo.top,x=st(n.shape,"float32"),b=this.bufferSync(a),_=this.bufferSync(e),C=0;C<o.batchSize;++C)for(var T=0;T<o.inChannels;++T)for(var D=0;D<o.inHeight;++D)for(var O=0;O<o.inWidth;++O){for(var z=D-y,I=O-g,S=0,A=0;A<p;A+=c){var N=(z+A)/s;if(!(N<0||N>=o.outHeight||Math.floor(N)!==N))for(var P=0;P<f;P+=d){var M=(I+P)/u;if(!(M<0||M>=o.outWidth||Math.floor(M)!==M)){var F=p*f-1-b.get(C,N,M,T)===A*f+P?1:0;F!==0&&(S+=_.get(C,N,M,T)*F)}}}x.set(S,C,D,O,T)}return x.toTensor()},t.prototype.avgPoolBackprop=function(e,n,i){ye([e,n],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,c=i.dilationHeight,d=i.dilationWidth,p=i.effectiveFilterHeight,f=i.effectiveFilterWidth,g=f-1-i.padInfo.left,y=p-1-i.padInfo.top,x=st(n.shape,"float32"),b=1/(s*u),_=this.bufferSync(e),C=0;C<i.batchSize;++C)for(var T=0;T<i.inChannels;++T)for(var D=0;D<i.inHeight;++D)for(var O=0;O<i.inWidth;++O){for(var z=D-y,I=O-g,S=0,A=0;A<p;A+=c){var N=(z+A)/o;if(!(N<0||N>=i.outHeight||Math.floor(N)!==N))for(var P=0;P<f;P+=d){var M=(I+P)/a;M<0||M>=i.outWidth||Math.floor(M)!==M||(S+=_.get(C,N,M,T))}}x.set(S*b,C,D,O,T)}return x.toTensor()},t.prototype.pool3d=function(e,n,i){ye(e,"pool3d");for(var o=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,d=n.dilationWidth,p=n.effectiveFilterDepth,f=n.effectiveFilterHeight,g=n.effectiveFilterWidth,y=n.padInfo.front,x=n.padInfo.top,b=n.padInfo.left,_=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=this.readSync(e.dataId),T=st(n.outShape,e.dtype),D=T.values,O=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],z=n.outShape[2]*n.outShape[3]*n.outShape[4],I=n.outShape[3]*n.outShape[4],S=n.outShape[4],A=0;A<n.batchSize;++A)for(var N=A*O,P=A*e.strides[0],M=0;M<n.inChannels;++M)for(var F=0;F<n.outDepth;++F){for(var G=F*o-y,Z=G;Z<0;)Z+=u;for(var Y=Math.min(n.inDepth,p+G),ee=N+F*z,H=0;H<n.outHeight;++H){for(var ie=H*a-x,J=ie;J<0;)J+=c;for(var q=Math.min(n.inHeight,f+ie),ne=ee+H*I,me=0;me<n.outWidth;++me){for(var Ce=me*s-b,Te=Ce;Te<0;)Te+=d;for(var Re=Math.min(n.inWidth,g+Ce),De=ne+me*S,Oe=_,ze=0,ct=0,Ze=Z;Ze<Y;Ze+=u){for(var wt=P+Ze*e.strides[1],ht=J;ht<q;ht+=c){for(var et=wt+ht*e.strides[2],Dt=Te;Dt<Re;Dt+=d){var _t=C[et+Dt*e.strides[3]+M];if(i==="max"&&_t>Oe?Oe=_t:i==="avg"&&(ze+=_t,ct++),isNaN(Oe))break}if(isNaN(Oe))break}if(isNaN(Oe))break}D[De+M]=i==="avg"?ze/ct:Oe}}}return T.toTensor()},t.prototype.avgPool3d=function(e,n){return ye(e,"avgPool3d"),this.pool3d(e,n,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,n,i){ye([e,n],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,c=i.filterHeight,d=i.filterWidth,p=i.dilationDepth,f=i.dilationHeight,g=i.dilationWidth,y=i.effectiveFilterDepth,x=i.effectiveFilterHeight,b=i.effectiveFilterWidth,_=y-1-i.padInfo.front,C=b-1-i.padInfo.left,T=x-1-i.padInfo.top,D=st(n.shape,"float32"),O=1/(u*c*d),z=this.bufferSync(e),I=0;I<i.batchSize;++I)for(var S=0;S<i.inChannels;++S)for(var A=0;A<i.inDepth;++A)for(var N=0;N<i.inHeight;++N)for(var P=0;P<i.inWidth;++P){for(var M=A-_,F=N-T,G=P-C,Z=0,Y=0;Y<y;Y+=p){var ee=(M+Y)/o;if(!(ee<0||ee>=i.outDepth||Math.floor(ee)!==ee))for(var H=0;H<x;H+=f){var ie=(F+H)/a;if(!(ie<0||ie>=i.outHeight||Math.floor(ie)!==ie))for(var J=0;J<b;J+=g){var q=(G+J)/s;q<0||q>=i.outWidth||Math.floor(q)!==q||(Z+=z.get(I,ee,ie,q,S))}}}D.set(Z*O,I,A,N,P,S)}return D.toTensor()},t.prototype.maxPool3d=function(e,n){return ye(e,"maxPool3d"),this.pool3d(e,n,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,n){for(var i=st(n.outShape,"int32"),o=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,d=n.dilationWidth,p=n.effectiveFilterDepth,f=n.effectiveFilterHeight,g=n.effectiveFilterWidth,y=n.padInfo.front,x=n.padInfo.top,b=n.padInfo.left,_=this.bufferSync(e),C=0;C<n.batchSize;++C)for(var T=0;T<n.inChannels;++T)for(var D=0;D<n.outDepth;++D){for(var O=D*o-y,z=O;z<0;)z+=u;for(var I=Math.min(n.inDepth,p+O),S=0;S<n.outHeight;++S){for(var A=S*a-x,N=A;N<0;)N+=c;for(var P=Math.min(n.inHeight,f+A),M=0;M<n.outWidth;++M){for(var F=M*s-b,G=F;G<0;)G+=d;for(var Z=Math.min(n.inWidth,g+F),Y=Number.NEGATIVE_INFINITY,ee=-1,H=z;H<I;H+=u)for(var ie=H-O,J=N;J<P;J+=c)for(var q=J-A,ne=G;ne<Z;ne+=d){var me=ne-F,Ce=_.get(C,H,J,ne,T);Ce>=Y&&(Y=Ce,ee=ie*f*g+q*f+me)}i.set(ee,C,D,S,M,T)}}}return i.toTensor()},t.prototype.maxPool3dBackprop=function(e,n,i,o){ye([n,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(n,o),s=o.strideDepth,u=o.strideHeight,c=o.strideWidth,d=o.dilationDepth,p=o.dilationHeight,f=o.dilationWidth,g=o.effectiveFilterDepth,y=o.effectiveFilterHeight,x=o.effectiveFilterWidth,b=g-1-o.padInfo.front,_=x-1-o.padInfo.left,C=y-1-o.padInfo.top,T=st(n.shape,"float32"),D=this.bufferSync(a),O=this.bufferSync(e),z=0;z<o.batchSize;++z)for(var I=0;I<o.inChannels;++I)for(var S=0;S<o.inDepth;++S)for(var A=0;A<o.inHeight;++A)for(var N=0;N<o.inWidth;++N){for(var P=S-b,M=A-C,F=N-_,G=0,Z=0;Z<g;Z+=d){var Y=(P+Z)/s;if(!(Y<0||Y>=o.outDepth||Math.floor(Y)!==Y))for(var ee=0;ee<y;ee+=p){var H=(M+ee)/u;if(!(H<0||H>=o.outHeight||Math.floor(H)!==H))for(var ie=0;ie<x;ie+=f){var J=(F+ie)/c;if(!(J<0||J>=o.outWidth||Math.floor(J)!==J)){var q=g*y*x-1-D.get(z,Y,H,J,I)===Z*y*x+ee*x+ie?1:0;q!==0&&(G+=O.get(z,Y,H,J,I)*q)}}}}T.set(G,z,S,A,N,I)}return T.toTensor()},t.prototype.cast=function(e,n){return Yb(e,n,this)},t.prototype.reshape=function(e,n){return pg(e,n)},t.prototype.avgPool=function(e,n){return ye(e,"avgPool"),this.pool(e,n,"avg").toFloat()},t.prototype.resizeBilinear=function(e,n,i,o){ye(e,"resizeBilinear");for(var a=e.shape,s=a[0],u=a[1],c=a[2],d=a[3],p=this.readSync(e.dataId),f=new Float32Array(He([s,n,i,d])),g=[o&&n>1?u-1:u,o&&i>1?c-1:c],y=[o&&n>1?n-1:n,o&&i>1?i-1:i],x=0,b=g[0]/y[0],_=g[1]/y[1],C=0;C<s;C++)for(var T=0;T<n;T++)for(var D=b*T,O=Math.floor(D),z=D-O,I=Math.min(u-1,Math.ceil(D)),S=C*e.strides[0]+O*e.strides[1],A=C*e.strides[0]+I*e.strides[1],N=0;N<i;N++)for(var P=_*N,M=Math.floor(P),F=P-M,G=Math.min(c-1,Math.ceil(P)),Z=S+M*e.strides[2],Y=A+M*e.strides[2],ee=S+ +G*e.strides[2],H=A+G*e.strides[2],ie=0;ie<d;ie++){var J=p[Z+ie],q=p[Y+ie],ne=J+(p[ee+ie]-J)*F,me=ne+(q+(p[H+ie]-q)*F-ne)*z;f[x++]=me}return xn(f,[s,n,i,d])},t.prototype.resizeBilinearBackprop=function(e,n,i){ye([e,n],"resizeBilinearBackprop");for(var o=n.shape,a=o[0],s=o[1],u=o[2],c=o[3],d=e.shape,p=d[1],f=d[2],g=new Float32Array(a*s*u*c),y=[i&&p>1?s-1:s,i&&f>1?u-1:u],x=[i&&p>1?p-1:p,i&&f>1?f-1:f],b=y[0]/x[0],_=y[1]/x[1],C=this.readSync(e.dataId),T=0,D=0;D<a;D++)for(var O=D*n.strides[0],z=0;z<p;z++)for(var I=z*b,S=Math.floor(I),A=Math.min(Math.ceil(I),s-1),N=O+S*n.strides[1],P=O+A*n.strides[1],M=I-S,F=1-M,G=0;G<f;G++)for(var Z=G*_,Y=Math.floor(Z),ee=Math.min(Math.ceil(Z),u-1),H=Z-Y,ie=1-H,J=N+Y*n.strides[2],q=N+ee*n.strides[2],ne=P+Y*n.strides[2],me=P+ee*n.strides[2],Ce=F*ie,Te=F*H,Re=M*ie,De=M*H,Oe=0;Oe<c;Oe++){var ze=C[T++];g[J+Oe]+=ze*Ce,g[q+Oe]+=ze*Te,g[ne+Oe]+=ze*Re,g[me+Oe]+=ze*De}return is(g,[a,u,s,c],n.dtype)},t.prototype.resizeNearestNeighbor=function(e,n,i,o){ye(e,"resizeNearestNeighbor");for(var a=e.shape,s=a[0],u=a[1],c=a[2],d=a[3],p=this.readSync(e.dataId),f=new Float32Array(s*n*i*d),g=[o&&n>1?u-1:u,o&&i>1?c-1:c],y=[o&&n>1?n-1:n,o&&i>1?i-1:i],x=g[0]/y[0],b=g[1]/y[1],_=0,C=0;C<s;C++)for(var T=C*e.strides[0],D=0;D<n;D++)for(var O=x*D,z=T+Math.min(u-1,o?Math.round(O):Math.floor(O))*e.strides[1],I=0;I<i;I++)for(var S=b*I,A=z+Math.min(c-1,o?Math.round(S):Math.floor(S))*e.strides[2],N=0;N<d;N++){var P=p[A+N];f[_++]=P}return xn(f,[s,n,i,d],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,n,i){ye([e,n],"resizeNearestNeighborBackprop");for(var o=n.shape,a=o[0],s=o[1],u=o[2],c=o[3],d=e.shape,p=d[1],f=d[2],g=new Float32Array(a*s*u*c),y=this.readSync(e.dataId),x=[i&&p>1?s-1:s,i&&f>1?u-1:u],b=[i&&p>1?p-1:p,i&&f>1?f-1:f],_=x[0]/b[0],C=x[1]/b[1],T=1/_,D=1/C,O=2*Math.ceil(T)+2,z=2*Math.ceil(D)+2,I=0;I<a;I++)for(var S=I*n.strides[0],A=0;A<s;A++)for(var N=S+A*n.strides[1],P=Math.floor(A*T),M=Math.floor(P-O/2),F=0;F<u;F++)for(var G=N+F*n.strides[2],Z=Math.floor(F*D),Y=Math.floor(Z-z/2),ee=0;ee<c;ee++){for(var H=0,ie=0;ie<O;ie++){var J=ie+M;if(!(J<0||J>=p)){var q=S+J*e.strides[1],ne=J*_;if(A===Math.min(s-1,i?Math.round(ne):Math.floor(ne)))for(var me=0;me<z;me++){var Ce=me+Y;if(!(Ce<0||Ce>=f)){var Te=q+Ce*e.strides[2],Re=Ce*C;F===Math.min(u-1,i?Math.round(Re):Math.floor(Re))&&(H+=y[Te+ee])}}}}g[G+ee]=H}return is(g,n.shape,n.dtype)},t.prototype.batchNormalization=function(e,n,i,o,a,s){ye([e,n,i,a,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(n.dataId),d=this.readSync(i.dataId),p=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),g=new Float32Array(u.length),y=f.length,x=p.length,b=d.length,_=c.length,C=0,T=0,D=0,O=0,z=0;z<u.length;++z)g[z]=f[C++]+(u[z]-c[T++])*p[D++]/Math.sqrt(d[O++]+o),C>=y&&(C=0),T>=_&&(T=0),D>=x&&(D=0),O>=b&&(O=0);return is(g,e.shape)},t.prototype.localResponseNormalization4D=function(e,n,i,o,a){ye(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),d=e.size,p=new Float32Array(d);function f(b){for(var _=b%s,C=b-_+Math.max(0,_-n),T=b-_+Math.min(_+n,u),D=0;C<=T;C++){var O=c[C];D+=O*O}return D}for(var g=0;g<d;g++){var y=f(g),x=c[g]*Math.pow(i+o*y,-a);p[g]=x}return is(p,e.shape)},t.prototype.LRNGrad=function(e,n,i,o,a,s,u){ye(e,"LRNGrad");for(var c=e.shape[3],d=this.readSync(e.dataId),p=this.readSync(n.dataId),f=this.readSync(i.dataId),g=new Float32Array(e.size),y=e.size,x=0;x<y;x++){for(var b=x%c,_=x-b+Math.max(0,b-o),C=x-b+Math.min(c,b+o+1),T=0,D=_;D<C;D++)T+=Math.pow(p[D],2);for(T=s*T+a,D=_;D<C;D++){var O=-2*s*u*p[D]*f[x]/T;x===D&&(O+=Math.pow(T,-u)),O*=d[x],g[D]+=O}}return is(g,e.shape)},t.prototype.multinomial=function(e,n,i,o){ye(e,"multinomial");for(var a=n?e:nl(e),s=a.shape[0],u=a.shape[1],c=zt([s,i],"int32"),d=this.readSync(c.dataId),p=this.readSync(a.dataId),f=0;f<s;++f){var g=f*u,y=new Float32Array(u-1);y[0]=p[g];for(var x=1;x<y.length;++x)y[x]=y[x-1]+p[g+x];for(var b=Zg(o.toString()),_=f*i,C=0;C<i;++C){var T=b();d[_+C]=y.length;for(var D=0;D<y.length;D++)if(T<y[D]){d[_+C]=D;break}}}return c},t.prototype.oneHot=function(e,n,i,o){ye(e,"oneHot");var a=new Float32Array(e.size*n);a.fill(o);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<n&&(a[u*n+s[u]]=i);return pa(a,[e.size,n],"int32")},t.prototype.nonMaxSuppression=function(e,n,i,o,a){return ye(e,"nonMaxSuppression"),Zb(this.readSync(e.dataId),this.readSync(n.dataId),i,o,a)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,n){for(var i=e.shape[0],o=e.shape[1],a=st(e.shape,"float32"),s=st(e.shape,"float32"),u=Wr(e).as2D(i,o),c=Ci(e).as2D(i,o),d=0;d<i;d++)for(var p=u.slice([d,0],[1,o]),f=c.slice([d,0],[1,o]),g=Ln(p,f),y=this.readSync(this.fftImpl(g,n).dataId),x=0;x<o;x++){var b=ES(y,x);a.values[d*o+x]=b.real,s.values[d*o+x]=b.imag}return Ln(a.toTensor(),s.toTensor()).as2D(i,o)},t.prototype.fftImpl=function(e,n){var i=e.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,n).as2D(e.shape[0],e.shape[1]);return n&&(a=Ln(Wr(a).div(Ve(o)),Ci(a).div(Ve(o)))),a}var s=this.readSync(e.dataId),u=function(c){for(var d=new Float32Array(c.length/2),p=new Float32Array(c.length/2),f=0;f<c.length;f+=2)d[f/2]=c[f],p[f/2]=c[f+1];return{real:d,imag:p}}(this.fourierTransformByMatmul(s,o,n));return Ln(u.real,u.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return(e&e-1)==0},t.prototype.fftRadix2=function(e,n,i){if(n===1)return e;var o=this.readSync(e.dataId),a=n/2,s=function(_){for(var C=Math.ceil(_.length/4),T=new Float32Array(C),D=new Float32Array(C),O=0;O<_.length;O+=4)T[Math.floor(O/4)]=_[O],D[Math.floor(O/4)]=_[O+1];return{real:T,imag:D}}(o),u=Ln(s.real,s.imag).as1D(),c=function(_){for(var C=Math.floor(_.length/4),T=new Float32Array(C),D=new Float32Array(C),O=2;O<_.length;O+=4)T[Math.floor(O/4)]=_[O],D[Math.floor(O/4)]=_[O+1];return{real:T,imag:D}}(o),d=Ln(c.real,c.imag).as1D();u=this.fftRadix2(u,a,i),d=this.fftRadix2(d,a,i);var p=function(_,C){for(var T=new Float32Array(_/2),D=new Float32Array(_/2),O=0;O<Math.ceil(_/2);O++){var z=(C?2:-2)*Math.PI*(O/_);T[O]=Math.cos(z),D[O]=Math.sin(z)}return{real:T,imag:D}}(n,i),f=Ln(p.real,p.imag).mul(d),g=u.add(f),y=u.sub(f),x=Wr(g).concat(Wr(y)),b=Ci(g).concat(Ci(y));return Ln(x,b).as1D()},t.prototype.fourierTransformByMatmul=function(e,n,i){for(var o=new Float32Array(2*n),a=0;a<n;a++){for(var s=0,u=0,c=0;c<n;c++){var d=WW(a*c,n,i),p=ES(e,c);s+=p.real*d.real-p.imag*d.imag,u+=p.real*d.imag+p.imag*d.real}i&&(s/=n,u/=n),jW(o,s,u,a)}return o},t.prototype.depthToSpace=function(e,n,i){W(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),W(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var o=e.shape[0],a=e.shape[1],s=e.shape[2],u=e.shape[3],c=a*n,d=s*n,p=u/(n*n),f=this.readSync(e.dataId),g=new Float32Array(o*c*d*p),y=0,x=0;x<o;++x)for(var b=0;b<c;++b)for(var _=Math.floor(b/n),C=b%n,T=0;T<d;++T)for(var D=Math.floor(T/n),O=(C*n+T%n)*p,z=0;z<p;++z){var I=z+O+u*(D+s*(_+a*x));g[y++]=f[I]}return is(g,[o,c,d,p])},t.prototype.broadcastedBinaryOp=function(e,n,i,o){var a=xt(e.shape,n.shape),s=st(a,i),u=this.readSync(e.dataId),c=this.readSync(n.dataId),d=Tu(e.shape,a),p=Tu(n.shape,a),f=s.values;if(d.length+p.length===0)for(var g=0;g<f.length;++g)f[g]=o(u[g%u.length],c[g%c.length]);else{var y=this.bufferSync(e),x=this.bufferSync(n),b=function(_){var C=s.indexToLoc(_),T=C.slice(-e.rank);d.forEach(function(I){return T[I]=0});var D=y.locToIndex(T),O=C.slice(-n.rank);p.forEach(function(I){return O[I]=0});var z=x.locToIndex(O);f[_]=o(u[D],c[z])};for(g=0;g<f.length;++g)b(g)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,n,i){var o=xt(e.shape,n.shape),a=st(o,"float32"),s=st(o,"float32"),u=this.readSync(e.dataId),c=this.readSync(n.dataId),d=Tu(e.shape,o),p=Tu(n.shape,o),f=a.values,g=s.values;if(d.length+p.length===0)for(var y=0;y<f.length;y++){var x=y%u.length,b=y%c.length,_=i(u[2*x],u[2*x+1],c[2*b],c[2*b+1]);f[y]=_.real,g[y]=_.imag}else{var C=this.bufferSync(this.data.get(e.dataId).complexTensors.real),T=this.bufferSync(this.data.get(n.dataId).complexTensors.real),D=function(O){var z=a.indexToLoc(O),I=z.slice(-e.rank);d.forEach(function(M){return I[M]=0});var S=C.locToIndex(I),A=z.slice(-n.rank);p.forEach(function(M){return A[M]=0});var N=T.locToIndex(A),P=i(u[2*S],u[2*S+1],c[2*N],c[2*N+1]);f[O]=P.real,g[O]=P.imag};for(y=0;y<f.length;y++)D(y)}return this.complex(a.toTensor(),s.toTensor())},t.prototype.split=function(e,n,i){return Lk(e,n,i)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,n,i,o,a,s){for(var u=e.shape,c=u[0],d=u[1],p=u[2],f=u[3],g=n.shape[0],y=o[0],x=o[1],b=st([g,y,x,f],e.dtype),_=this.readSync(n.dataId),C=this.readSync(i.dataId),T=this.readSync(e.dataId),D=e.strides,O=b.strides,z=0;z<g;z++){var I=4*z,S=_[I],A=_[I+1],N=_[I+2],P=_[I+3],M=C[z];if(!(M>=c))for(var F=y>1?(N-S)*(d-1)/(y-1):0,G=x>1?(P-A)*(p-1)/(x-1):0,Z=0;Z<y;Z++){var Y=y>1?S*(d-1)+Z*F:.5*(S+N)*(d-1);if(Y<0||Y>d-1)for(var ee=0;ee<x;ee++)for(var H=0;H<f;H++){var ie=H+ee*O[2]+Z*O[1]+z*O[0];b.values[ie]=s}else if(a==="bilinear"){var J=Math.floor(Y),q=Math.ceil(Y),ne=Y-J;for(ee=0;ee<x;ee++)if((Ze=x>1?A*(p-1)+ee*G:.5*(A+P)*(p-1))<0||Ze>p-1)for(H=0;H<f;H++)ie=H+ee*O[2]+Z*O[1]+z*O[0],b.values[ie]=s;else{var me=Math.floor(Ze),Ce=Math.ceil(Ze),Te=Ze-me;for(H=0;H<f;H++){var Re=T[ie=H+me*D[2]+J*D[1]+M*D[0]],De=T[ie=H+Ce*D[2]+J*D[1]+M*D[0]],Oe=T[ie=H+me*D[2]+q*D[1]+M*D[0]],ze=Re+(De-Re)*Te,ct=Oe+(T[ie=H+Ce*D[2]+q*D[1]+M*D[0]]-Oe)*Te;ie=H+ee*O[2]+Z*O[1]+z*O[0],b.values[ie]=ze+(ct-ze)*ne}}}else for(ee=0;ee<x;++ee){var Ze;if((Ze=x>1?A*(p-1)+ee*G:.5*(A+P)*(p-1))<0||Ze>p-1)for(H=0;H<f;H++)ie=H+ee*O[2]+Z*O[1]+z*O[0],b.values[ie]=s;else{var wt=Math.round(Ze),ht=Math.round(Y);for(H=0;H<f;H++){var et=H+wt*D[2]+ht*D[1]+M*D[0],Dt=H+ee*O[2]+Z*O[1]+z*O[0];b.values[Dt]=T[et]}}}}}return b.toTensor()},t.prototype.sparseToDense=function(e,n,i,o){var a=hg(0,e,i),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,d=a.strides,p=a.outputSize;return this.scatter(e,n,i,p,c,u,s,d,o,!1)},t.prototype.gatherND=function(e,n){var i=n.shape,o=i[i.length-1],a=kk(e,n),s=a[0],u=a[1],c=a[2],d=a[3];if(u===0)return xn([],s,e.dtype);for(var p=new Ac([u,c],e.dtype),f=this.readSync(n.dataId),g=this.readSync(e.dataId),y=0;y<u;y++){for(var x=[],b=0,_=0;_<o;_++){var C=f[y*o+_];b+=C*d[_],x.push(C)}if(b<0||b>=e.size/c)throw new Error("Invalid indices: "+x+" does not index into "+e.shape);for(var T=0;T<c;T++)p.values[y*c+T]=g[b*c+T]}return p.toTensor().reshape(s)},t.prototype.scatterND=function(e,n,i){var o=hg(0,e,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,c=o.strides,d=o.outputSize,p=Ve(0);return this.scatter(e,n,i,d,u,s,a,c,p,!0)},t.prototype.fill=function(e,n,i){var o=kd(i=i||Xc(n),He(e));return o.fill(n),K.makeTensor(o,e,i,this)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var n=kd(e.dtype,He(e.shape));return this.makeOutput(n,e.shape,e.dtype)},t.prototype.linspace=function(e,n,i){return Jb(e,n,i)},t.prototype.scatter=function(e,n,i,o,a,s,u,c,d,p){var f=[o/a,a],g=this.readSync(e.dataId),y=this.readSync(n.dataId);if(o===0)return xn([],i,n.dtype);var x=new Ac(f,n.dtype);x.values.fill(this.readSync(d.dataId)[0]);for(var b=0;b<s;b++){for(var _=[],C=0,T=0;T<u;T++){var D=g[b*u+T];_.push(D),C+=D*c[T]}if(C<0||C>=o/a)throw new Error("Invalid indices: "+_+" does not index into "+i);for(var O=0;O<a;O++)p?x.values[C*a+O]+=y[b*a+O]:x.values[C*a+O]=n.rank===0?y[0]:y[b*a+O]}return x.toTensor().reshape(i)},t}(Xb);K.registerBackend("cpu",function(){return new W5},1),Bw({kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t.x,i=e;ye(n,"square");for(var o=i.data.get(n.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}}),Bw({kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t.x,i=e,o=new pt(n.shape,"return x * x;");return i.runWebGLProgram(o,[n],n.dtype)}});var q5=function(){function r(){}return r.prototype.fetch=function(t,e){return fetch(t,e)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},r.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},r}();he().get("IS_BROWSER")&&he().setPlatform("browser",new q5);var Q0,H5=function(){return require("node-fetch")},$5=function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(t,e){return he().global.fetch!=null?he().global.fetch(t,e):(Q0==null&&(Q0=H5()),Q0(t,e))},r.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},r.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},r.prototype.decode=function(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)},r}();he().get("IS_NODE")&&he().setPlatform("node",new $5);var r1={float32:4,int32:4,uint16:2,uint8:1,bool:1},fg=4;function mD(r,t){for(var e={},n=0,i=function(s){var u=s.name,c=s.dtype,d=s.shape,p=He(d),f=void 0;if("quantization"in s){var g=s.quantization;if(g.dtype!=="uint8"&&g.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+g.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var y=r1[g.dtype],x=r.slice(n,n+p*y),b=g.dtype==="uint8"?new Uint8Array(x):new Uint16Array(x);if(c==="float32")f=Float32Array.from(b,function(z){return z*g.scale+g.min});else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(b,function(z){return Math.round(z*g.scale+g.min)})}n+=p*y}else if(c==="string"){var _=He(s.shape);f=[];for(var C=0;C<_;C++){var T=new Uint32Array(r.slice(n,n+fg))[0];n+=fg;var D=new Uint8Array(r.slice(n,n+T));f.push(D),n+=T}}else{var O=r1[c];if(x=r.slice(n,n+p*O),c==="float32")f=new Float32Array(x);else if(c==="int32")f=new Int32Array(x);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(x)}n+=p*O}e[u]=xn(f,d,c)},o=0,a=t;o<a.length;o++)i(a[o]);return e}function G5(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var t=0,e=[];r.forEach(function(o){if(t+=o.byteLength,e.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var n=new Uint8Array(t),i=0;return e.forEach(function(o){n.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),n.buffer}var i1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function qS(r){return i1?Buffer.byteLength(r):new Blob([r]).size}function e_(r){var t=0;r.forEach(function(i){t+=i.byteLength});var e=new Uint8Array(t),n=0;return r.forEach(function(i){e.set(new Uint8Array(i),n),n+=i.byteLength}),e.buffer}function HS(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var t=r.split("/");return t[t.length-1]}function bp(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:qS(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:qS(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var si=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(t){r.getInstance().saveRouters.push(t)},r.registerLoadRouter=function(t){r.getInstance().loadRouters.push(t)},r.getSaveHandlers=function(t){return r.getHandlers(t,"save")},r.getLoadHandlers=function(t,e){return r.getHandlers(t,"load",e)},r.getHandlers=function(t,e,n){var i=[];return(e==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(o){var a=o(t,n);a!==null&&i.push(a)}),i},r}(),mc="://",bs=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(t,e){W(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(mc)&&(t=t.slice(0,t.indexOf(mc))),W(t.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();W(n.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),n.managers[t]=e},r.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function km(r){if(r.indexOf(mc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+bs.getSchemes().join(","));return{scheme:r.split(mc)[0],path:r.split(mc)[1]}}function $S(r,t,e){return e===void 0&&(e=!1),Ue(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p;return je(this,function(f){switch(f.label){case 0:return W(r!==t,function(){return"Old path and new path are the same: '"+r+"'"}),W((n=si.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),W(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),i=n[0],W((o=si.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),W(o.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+t+"."}),a=o[0],s=km(r).scheme,u=km(r).path,c=s===km(r).scheme,[4,i.load()];case 1:return d=f.sent(),e&&c?[4,bs.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(d)];case 4:return p=f.sent(),!e||c?[3,6]:[4,bs.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var Ru="models_store",ds="model_info_store";function gD(){if(!he().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window,t=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function o1(r){var t=r.result;t.createObjectStore(Ru,{keyPath:"modelPath"}),t.createObjectStore(ds,{keyPath:"modelPath"})}var gc=function(){function r(t){if(this.indexedDB=gD(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return r.prototype.save=function(t){return Ue(this,void 0,void 0,function(){return je(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},r.prototype.load=function(){return Ue(this,void 0,void 0,function(){return je(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(i,o){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return o1(a)},a.onsuccess=function(){var s=a.result;if(e==null){var u=s.transaction(Ru,"readonly"),c=u.objectStore(Ru).get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),o(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(c.result.modelArtifacts)},c.onerror=function(x){return s.close(),o(c.error)},u.oncomplete=function(){return s.close()}}else{var d,p=bp(e),f=s.transaction(ds,"readwrite"),g=f.objectStore(ds),y=g.put({modelPath:n.modelPath,modelArtifactsInfo:p});y.onsuccess=function(){var x=(d=s.transaction(Ru,"readwrite")).objectStore(Ru).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:p});x.onsuccess=function(){return i({modelArtifactsInfo:p})},x.onerror=function(b){var _=(g=f.objectStore(ds)).delete(n.modelPath);_.onsuccess=function(){return s.close(),o(x.error)},_.onerror=function(C){return s.close(),o(x.error)}}},y.onerror=function(x){return s.close(),o(y.error)},f.oncomplete=function(){d==null?s.close():d.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},r.URL_SCHEME="indexeddb://",r}(),GS=function(r){return he().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(gc.URL_SCHEME)?(t=r.slice(gc.URL_SCHEME.length),new gc(t)):null;var t};si.registerSaveRouter(GS),si.registerLoadRouter(GS);var K5=function(){function r(){this.indexedDB=gD()}return r.prototype.listModels=function(){return Ue(this,void 0,void 0,function(){var t=this;return je(this,function(e){return[2,new Promise(function(n,i){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return o1(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(ds,"readonly"),u=s.objectStore(ds).getAll();u.onsuccess=function(){for(var c={},d=0,p=u.result;d<p.length;d++){var f=p[d];c[f.modelPath]=f.modelArtifactsInfo}n(c)},u.onerror=function(c){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},r.prototype.removeModel=function(t){return Ue(this,void 0,void 0,function(){var e=this;return je(this,function(n){var i;return t=(i=t).startsWith(gc.URL_SCHEME)?i.slice(gc.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return o1(s)},s.onsuccess=function(){var u,c=s.result,d=c.transaction(ds,"readwrite"),p=d.objectStore(ds),f=p.get(t);f.onsuccess=function(){if(f.result==null)return c.close(),a(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var g=p.delete(t),y=function(){var x=(u=c.transaction(Ru,"readwrite")).objectStore(Ru).delete(t);x.onsuccess=function(){return o(f.result.modelArtifactsInfo)},x.onerror=function(b){return a(f.error)}};g.onsuccess=y,g.onerror=function(x){return y(),c.close(),a(f.error)}},f.onerror=function(g){return c.close(),a(f.error)},d.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},r}();if(he().getBool("IS_BROWSER"))try{bs.registerManager(gc.URL_SCHEME,new K5)}catch{}var aa="/",sc="tensorflowjs_models",vD="info",X5="model_topology",Q5="weight_specs",Y5="weight_data",J5="model_metadata";function yD(r){return{info:[sc,r,vD].join(aa),topology:[sc,r,X5].join(aa),weightSpecs:[sc,r,Q5].join(aa),weightData:[sc,r,Y5].join(aa),modelMetadata:[sc,r,J5].join(aa)}}function Z5(r){var t=r.split(aa);if(t.length<3)throw new Error("Invalid key format: "+r);return t.slice(1,t.length-1).join(aa)}var vc=function(){function r(t){if(!he().getBool("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=yD(this.modelPath)}return r.prototype.save=function(t){return Ue(this,void 0,void 0,function(){var e,n,i;return je(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),i=bp(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(a=t.weightData,i1?Buffer.from(a).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(a))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}var a;return[2]})})},r.prototype.load=function(){return Ue(this,void 0,void 0,function(){var t,e,n,i,o,a,s;return je(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(i1){var d=Buffer.from(c,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var p=atob(c),f=new Uint8Array(p.length),g=0;g<p.length;++g)f.set([p.charCodeAt(g)],g);return f.buffer}(s),[2,e]})})},r.URL_SCHEME="localstorage://",r}(),KS=function(r){return he().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(vc.URL_SCHEME)?(t=r.slice(vc.URL_SCHEME.length),new vc(t)):null;var t};si.registerSaveRouter(KS),si.registerLoadRouter(KS);var eq=function(){function r(){W(he().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),W(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Ue(this,void 0,void 0,function(){var t,e,n,i,o,a;return je(this,function(s){for(t={},e=sc+aa,n=aa+vD,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(e)&&o.endsWith(n)&&(a=Z5(o),t[a]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},r.prototype.removeModel=function(t){return Ue(this,void 0,void 0,function(){var e,n;return je(this,function(i){var o;if(t=(o=t).startsWith(vc.URL_SCHEME)?o.slice(vc.URL_SCHEME.length):o,e=yD(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},r}();if(he().getBool("IS_BROWSER"))try{bs.registerManager(vc.URL_SCHEME,new eq)}catch{}var tq="model",nq=".json",rq=".weights.bin";function XS(r){return new Promise(function(t){return setTimeout(t)}).then(r)}var Y0=function(){function r(t){if(!he().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(r.URL_SCHEME)&&(t=t.slice(r.URL_SCHEME.length)),t!=null&&t.length!==0||(t=tq),this.modelTopologyFileName=t+nq,this.weightDataFileName=t+rq}return r.prototype.save=function(t){return Ue(this,void 0,void 0,function(){var e,n,i,o,a,s;return je(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,XS(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,XS(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:bp(t)}]}})})},r.URL_SCHEME="downloads://",r}(),iq=function(){function r(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return r.prototype.load=function(){return Ue(this,void 0,void 0,function(){var t,e,n=this;return je(this,function(i){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(o,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),d=c.modelTopology;if(d!=null){e.length===0&&o({modelTopology:d});var p=c.weightsManifest;if(p!=null){var f;try{f=n.checkManifestAndWeightFiles(p,e)}catch(b){return void a(b)}var g=[],y=[],x=[];p.forEach(function(b){b.paths.forEach(function(_){y.push(_),x.push(null)}),g.push.apply(g,b.weights)}),p.forEach(function(b){b.paths.forEach(function(_){var C=new FileReader;C.onload=function(T){var D=T.target.result,O=y.indexOf(_);x[O]=D,x.indexOf(null)===-1&&o({modelTopology:d,weightSpecs:g,weightData:e_(x)})},C.onerror=function(T){return a("Failed to weights data from file of path '"+_+"'.")},C.readAsArrayBuffer(f[_])})})}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},r.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],i=e.map(function(u){return HS(u.name)}),o={},a=0,s=t;a<s.length;a++)s[a].paths.forEach(function(u){var c=HS(u);if(n.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(n.push(c),i.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");o[u]=e[i.indexOf(c)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},r}();function QS(r,t,e,n){(function(o){W(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(r),function(o,a){W(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),W(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),W(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(e=e??0,n=n??1);var i=0;return Promise.all(r.map(function(o){return o.then(function(a){var s=e+ ++i/r.length*(n-e);return t(s),a}),o}))}function wD(r,t){return Ue(this,void 0,void 0,function(){var e,n,i,o,a,s,u,c,d;return je(this,function(p){switch(p.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?he().platform.fetch:t.fetchFunc,n=r.map(function(f){return e(f,t.requestInit,{isBinary:!0})}),i=0,o=.5,t.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return a=p.sent(),[3,4];case 2:return[4,QS(n,t.onProgress,i,o)];case 3:a=p.sent(),p.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,c=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return d=p.sent(),[3,8];case 6:return[4,QS(s,t.onProgress,u,c)];case 7:d=p.sent(),p.label=8;case 8:return[2,d]}})})}function YS(r){var t=this;return function(e,n,i){return n===void 0&&(n=""),Ue(t,void 0,void 0,function(){var o,a,s,u,c,d,p,f,g,y;return je(this,function(x){switch(x.label){case 0:if(o=e.map(function(){return!1}),a={},s=i!=null?i.map(function(){return!1}):[],u=[],e.forEach(function(b,_){var C=0;b.weights.forEach(function(T){var D="quantization"in T?T.quantization.dtype:T.dtype,O=r1[D]*He(T.shape),z=function(){o[_]=!0,a[_]==null&&(a[_]=[]),a[_].push({manifestEntry:T,groupOffset:C,sizeBytes:O})};i!=null?i.forEach(function(I,S){I===T.name&&(z(),s[S]=!0)}):z(),u.push(T.name),C+=O})}),!s.every(function(b){return b}))throw c=i.filter(function(b,_){return!s[_]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return d=o.reduce(function(b,_,C){return _&&b.push(C),b},[]),p=[],d.forEach(function(b){e[b].paths.forEach(function(_){var C=n+(n.endsWith("/")?"":"/")+_;p.push(C)})}),[4,r(p)];case 1:return f=x.sent(),g={},y=0,d.forEach(function(b){for(var _=e[b].paths.length,C=0,T=0;T<_;T++)C+=f[y+T].byteLength;for(var D=new ArrayBuffer(C),O=new Uint8Array(D),z=0,I=0;I<_;I++){var S=new Uint8Array(f[y+I]);O.set(S,z),z+=S.byteLength}a[b].forEach(function(A){var N=mD(D.slice(A.groupOffset,A.groupOffset+A.sizeBytes),[A.manifestEntry]);for(var P in N)g[P]=N[P]}),y+=_}),[2,g]}})})}}si.registerSaveRouter(function(r){return he().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Y0.URL_SCHEME)?(t=r.slice(Y0.URL_SCHEME.length),t===void 0&&(t="model"),new Y0(t)):null;var t});var bD=function(){function r(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(W(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=he().platform.fetch,W(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&W(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return r.prototype.save=function(t){return Ue(this,void 0,void 0,function(){var e,n,i,o;return je(this,function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:bp(t),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},r.prototype.load=function(){return Ue(this,void 0,void 0,function(){var t,e,n,i,o,a,s,u;return je(this,function(c){switch(c.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=c.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,t.json()];case 3:return e=c.sent(),[3,5];case 4:throw c.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=e.modelTopology,o=e.weightsManifest,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:u=c.sent(),a=u[0],s=u[1],c.label=7;case 7:return[2,{modelTopology:i,weightSpecs:a,weightData:s}]}})})},r.prototype.loadWeights=function(t){return Ue(this,void 0,void 0,function(){var e,n,i,o,a,s,u,c,d,p,f;return je(this,function(g){switch(g.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(y){var x=y.lastIndexOf("/"),b=y.lastIndexOf("?"),_=y.substring(0,x),C=b>x?y.substring(b):"";return[_+"/",C]}(e),i=n[0],o=n[1],a=this.weightPathPrefix||i,s=[],u=0,c=t;u<c.length;u++)d=c[u],s.push.apply(s,d.weights);return p=[],t.forEach(function(y){y.paths.forEach(function(x){p.push(a+x+o)})}),[4,wD(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=g.sent(),[2,[s,e_(f)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function a1(r){return r.match(bD.URL_SCHEME_REGEX)!=null}var JS=function(r,t){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(e){return a1(e)}):a1(r))?s1(r,{onProgress:t}):null};function s1(r,t){return new bD(r,t)}si.registerSaveRouter(JS),si.registerLoadRouter(JS);var J0=function(){function r(t){this.modelArtifacts=t}return r.prototype.load=function(){return Ue(this,void 0,void 0,function(){return je(this,function(t){return[2,this.modelArtifacts]})})},r}(),oq=function(){function r(t){this.saveHandler=t}return r.prototype.save=function(t){return Ue(this,void 0,void 0,function(){return je(this,function(e){return[2,this.saveHandler(t)]})})},r}(),ui=Object.freeze({browserFiles:function(r){return new iq(r)},browserHTTPRequest:function(r,t){return s1(r,t)},concatenateArrayBuffers:e_,decodeWeights:mD,encodeWeights:function(r,t){return Ue(this,void 0,void 0,function(){var e,n,i,o,a,s=this;return je(this,function(u){switch(u.label){case 0:for(e=[],n=[],i=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),o=function(c){var d=i[c],p=Array.isArray(r)?r[c].tensor:r[d];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+p.dtype);var f={name:d,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var g=new Promise(function(y){return Ue(s,void 0,void 0,function(){var x,b,_,C,T,D,O;return je(this,function(z){switch(z.label){case 0:return[4,p.bytes()];case 1:for(x=z.sent(),b=x.reduce(function(I,S){return I+S.length},0)+fg*x.length,_=new Uint8Array(b),C=0,T=0;T<x.length;T++)D=x[T],O=new Uint8Array(new Uint32Array([D.length]).buffer),_.set(O,C),C+=fg,_.set(D,C),C+=D.length;return y(_),[2]}})})});n.push(g)}else n.push(p.data());t!=null&&(f.group=t),e.push(f)},a=0;a<i.length;++a)o(a);return[4,Promise.all(n)];case 1:return[2,{data:G5(u.sent()),specs:e}]}})})},fromMemory:function(r,t,e,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new J0(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new J0({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new J0({modelTopology:r,weightSpecs:t,weightData:e,trainingConfig:n}))},getLoadHandlers:function(r,t){return si.getLoadHandlers(r,t)},getModelArtifactsInfoForJSON:bp,getSaveHandlers:function(r){return si.getSaveHandlers(r)},http:s1,isHTTPScheme:a1,loadWeights:function(r,t,e,n){return t===void 0&&(t=""),Ue(this,void 0,void 0,function(){return je(this,function(i){return[2,YS(function(o){return wD(o,{requestInit:n})})(r,t,e)]})})},registerLoadRouter:function(r){return si.registerLoadRouter(r)},registerSaveRouter:function(r){return si.registerSaveRouter(r)},weightsLoaderFactory:YS,withSaveHandler:function(r){return new oq(r)},copyModel:function(r,t){return Ue(this,void 0,void 0,function(){return je(this,function(e){return[2,$S(r,t,!1)]})})},listModels:function(){return Ue(this,void 0,void 0,function(){var r,t,e,n,i,o,a;return je(this,function(s){switch(s.label){case 0:r=bs.getSchemes(),t={},e=0,n=r,s.label=1;case 1:return e<n.length?(i=n[e],[4,bs.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())t[i+mc+a]=o[a];s.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(r,t){return Ue(this,void 0,void 0,function(){return je(this,function(e){return[2,$S(r,t,!0)]})})},removeModel:function(r){return Ue(this,void 0,void 0,function(){var t;return je(this,function(e){return t=km(r),[2,bs.getManager(t.scheme).removeModel(t.path)]})})}}),aq=X({confusionMatrix_:function(r,t,e){var n=j(r,"labels","confusionMatrix"),i=j(t,"predictions","confusionMatrix");W(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),W(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),W(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),W(n.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),W(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var o=Rc(n.asType("int32"),e),a=Rc(i.asType("int32"),e);return o.transpose().matMul(a).asType("int32")}}),sq=Object.freeze({confusionMatrix:aq}),uq=X({fromPixels_:function(r,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");var e=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(e&&e&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");return K.fromPixels(r,t)}}),xD=Object.freeze({toPixels:function(r,t){return Ue(this,void 0,void 0,function(){var e,n,i,o,a,s,u,c,d,p,f,g,y,x,b,_,C,T,D,O,z,I,S;return je(this,function(A){switch(A.label){case 0:if(e=j(r,"img","toPixels"),r instanceof Ut||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(n=e.shape.slice(0,2),i=n[0],o=n[1],(a=e.rank===2?1:e.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,e.data()];case 1:return s=A.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(d=A.sent(),p=d[0],f=d[1],g=p[0],y=f[0],u.dispose(),c.dispose(),e.dtype==="float32"){if(g<0||y>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+g+" - "+y+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(g<0||y>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+g+" - "+y+"].")}for(x=e.dtype==="float32"?255:1,b=new Uint8ClampedArray(o*i*4),_=0;_<i*o;++_)C=void 0,T=void 0,D=void 0,O=void 0,a===1?(C=s[_]*x,T=s[_]*x,D=s[_]*x,O=255):a===3?(C=s[3*_]*x,T=s[3*_+1]*x,D=s[3*_+2]*x,O=255):a===4&&(C=s[4*_]*x,T=s[4*_+1]*x,D=s[4*_+2]*x,O=s[4*_+3]*x),b[0+(z=4*_)]=Math.round(C),b[z+1]=Math.round(T),b[z+2]=Math.round(D),b[z+3]=Math.round(O);return t!=null&&(t.width=o,t.height=i,I=t.getContext("2d"),S=new ImageData(b,o,i),I.putImageData(S,0,0)),e!==r&&e.dispose(),[2,b]}})})},fromPixels:uq}),_D=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(t,e){return new t(e)},r}(),ED=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(t){r.getMap().classNameMap[t.className]=[t,t.fromConfig]},r}();function Ws(r){W(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),W(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),W(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),ED.register(r)}var be=Object.freeze({Serializable:_D,SerializationMap:ED,registerClass:Ws}),lq=.001,ID=.1;function Z0(){return K.backend.floatPrecision()===32?lq:ID}function ew(r,t,e){var n=!0;if((or(r)||or(t))&&(n=!1),or(r)&&or(t)&&(n=!0),n){var i=r.constructor.name,o=t.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(r)&&Array.isArray(t)){var a=Do(r),s=Do(t);if(!Qn(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=or(r)?r:_a(r),c=or(t)?t:_a(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+`.
Actual:   `+u+`.
Expected: `+c+".");for(var d=0;d<c.length;++d){var p=u[d],f=c[d];if(!e(p,f))throw new Error("Arrays differ: actual["+d+"] = "+p+", expected["+d+"] = "+f+`.
Actual:   `+u+`.
Expected: `+c+".")}}function tw(r,t,e){return!isFinite(r)&&!isFinite(t)||!(isNaN(r)||isNaN(t)||Math.abs(r-t)>e)}var cq=Object.freeze({TEST_EPSILON_FLOAT16:ID,expectArraysClose:function(r,t,e){return e==null&&(e=Z0()),ew(r,t,function(n,i){return tw(n,i,e)})},testEpsilon:Z0,expectPromiseToFail:function(r,t){r().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(r,t){var e=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return hs(r)||hs(r[0])||hs(t)||hs(t[0])?ew(r,e,function(n,i){return n==i}):ew(r,t,function(n,i){return tw(n,i,0)})},expectNumbersClose:function(r,t,e){if(e==null&&(e=Z0()),!tw(r,t,e))throw new Error("Numbers differ: actual === "+r+", expected === "+t)},expectValuesInRange:function(r,t,e){for(var n=0;n<r.length;n++)if(r[n]<t||r[n]>e)throw new Error("Value out of range:"+r[n]+" low: "+t+", high: "+e)},expectArrayBuffersEqual:function(r,t){expect(new Float32Array(r)).toEqual(new Float32Array(t))}}),CD="1.3.1",hq=Object.freeze({gpgpu_util:M6,webgl_util:hW,forceHalfFloat:function(){he().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:pN,setWebGLContext:jR,GPGPUContext:aN}),Na=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return to(t,r),t.prototype.minimize=function(e,n,i){n===void 0&&(n=!1);var o=this.computeGradients(e,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ft(s),n?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,n){return Mk(e,n)},t.prototype.dispose=function(){this.iterations_!=null&&ft(this.iterations_)},t.prototype.saveIterations=function(){return Ue(this,void 0,void 0,function(){return je(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ve(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return je(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){return je(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return Ue(this,void 0,void 0,function(){var n;return je(this,function(i){switch(i.label){case 0:return n=this,[4,e[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,e.slice(1)]}})})},t}(_D);Object.defineProperty(Na,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var t_=function(r){function t(e,n,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=K.backend.epsilon()),o}return to(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var a=K.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:ue(function(){return Ct(a).variable(!1)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:ue(function(){return Ct(a).variable(!1)})});var s=Array.isArray(e)?e[o].tensor:e[i];if(s!=null){var u=n.accumulatedGrads[o].variable,c=n.accumulatedUpdates[o].variable;ue(function(){var d=u.mul(n.rho).add(s.square().mul(1-n.rho)),p=c.add(n.epsilon).sqrt().div(u.add(n.epsilon).sqrt()).mul(s),f=c.mul(n.rho).add(p.square().mul(1-n.rho));u.assign(d),c.assign(f);var g=p.mul(-n.learningRate).add(a);a.assign(g)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ft(this.accumulatedGrads.map(function(e){return e.variable})),ft(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){var e;return je(this,function(n){switch(n.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){var n;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),n=e.length/2,this.accumulatedGrads=e.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.rho,n.epsilon)},t.className="Adadelta",t}(Na);Ws(t_);var n_=function(r){function t(e,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=e,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return to(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var a=K.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:ue(function(){return Yc(a.shape,n.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[o].tensor:e[i];if(s!=null){var u=n.accumulatedGrads[o].variable;ue(function(){var c=u.add(s.square());u.assign(c);var d=s.div(c.add(K.backend.epsilon()).sqrt()).mul(-n.learningRate).add(a);a.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&ft(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedGrads=e.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,n){return new e(n.learningRate,n.initialAccumulatorValue)},t.className="Adagrad",t}(Na);Ws(n_);var r_=function(r){function t(e,n,i,o){o===void 0&&(o=null);var a=r.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],ue(function(){a.accBeta1=Ve(n).variable(),a.accBeta2=Ve(i).variable()}),o==null&&(a.epsilon=K.backend.epsilon()),a}return to(t,r),t.prototype.applyGradients=function(e){var n=this,i=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);ue(function(){var o=Yn(1,n.accBeta1),a=Yn(1,n.accBeta2);i.forEach(function(s,u){var c=K.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ue(function(){return Ct(c).variable(!1)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:ue(function(){return Ct(c).variable(!1)})});var d=Array.isArray(e)?e[u].tensor:e[s];if(d!=null){var p=n.accumulatedFirstMoment[u].variable,f=n.accumulatedSecondMoment[u].variable,g=p.mul(n.beta1).add(d.mul(1-n.beta1)),y=f.mul(n.beta2).add(d.square().mul(1-n.beta2)),x=g.div(o),b=y.div(a);p.assign(g),f.assign(y);var _=x.div(b.sqrt().add(n.epsilon)).mul(-n.learningRate).add(c);c.assign(_)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ft(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&ft(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){var e;return je(this,function(n){switch(n.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){var n,i=this;return je(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),ue(function(){i.accBeta1.assign(Nc(i.beta1,i.iterations_+1)),i.accBeta2.assign(Nc(i.beta2,i.iterations_+1))}),n=e.length/2,this.accumulatedFirstMoment=e.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)},t.className="Adam",t}(Na);Ws(r_);var i_=function(r){function t(e,n,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=r.call(this)||this;return s.learningRate=e,s.beta1=n,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ue(function(){s.iteration=Ve(0).variable(),s.accBeta1=Ve(n).variable()}),o==null&&(s.epsilon=K.backend.epsilon()),s}return to(t,r),t.prototype.applyGradients=function(e){var n=this,i=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);ue(function(){var o=Yn(1,n.accBeta1),a=xr(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach(function(s,u){var c=K.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ct(c).variable(!1)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Ct(c).variable(!1)});var d=Array.isArray(e)?e[u].tensor:e[s];if(d!=null){var p=n.accumulatedFirstMoment[u].variable,f=n.accumulatedWeightedInfNorm[u].variable,g=p.mul(n.beta1).add(d.mul(1-n.beta1)),y=f.mul(n.beta2),x=d.abs(),b=y.maximum(x);p.assign(g),f.assign(b);var _=a.div(o).mul(g.div(b.add(n.epsilon))).add(c);c.assign(_)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ft(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&ft(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return je(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){return je(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},t.className="Adamax",t}(Na);Ws(i_);var Lv=function(r){function t(e){var n=r.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return to(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var a=Array.isArray(e)?e[o].tensor:e[i];if(a!=null){var s=K.registeredVariables[i];ue(function(){var u=n.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=No(Ve(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,n){return new e(n.learningRate)},t.className="SGD",t}(Na);Ws(Lv);var o_=function(r){function t(e,n,i){i===void 0&&(i=!1);var o=r.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=i,o.accumulations=[],o.m=Ve(o.momentum),o}return to(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var a=K.registeredVariables[i];n.accumulations[o]==null&&(n.accumulations[o]={originalName:i+"/momentum",variable:ue(function(){return Ct(a).variable(!1)})});var s=n.accumulations[o].variable,u=Array.isArray(e)?e[o].tensor:e[i];u!=null&&ue(function(){var c,d=n.m.mul(s).add(u);c=n.useNesterov?n.c.mul(u.add(d.mul(n.m))).add(a):n.c.mul(d).add(a),s.assign(d),a.assign(c)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ft(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulations=e.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)},t.className="Momentum",t}(Lv);Ws(o_);var a_=function(r){function t(e,n,i,o,a){n===void 0&&(n=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=r.call(this)||this;return s.learningRate=e,s.decay=n,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=K.backend.epsilon()),s}return to(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var a=K.registeredVariables[i];n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:ue(function(){return Ct(a).variable(!1)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:ue(function(){return Ct(a).variable(!1)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:ue(function(){return Ct(a).variable(!1)})});var s=Array.isArray(e)?e[o].tensor:e[i];if(s!=null){var u=n.accumulatedMeanSquares[o].variable,c=n.accumulatedMoments[o].variable;ue(function(){var d=u.mul(n.decay).add(s.square().mul(1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,f=p.mul(n.decay).add(s.mul(1-n.decay)),g=c.mul(n.momentum).add(s.mul(n.learningRate).div(d.sub(f.square().add(n.epsilon)).sqrt()));u.assign(d),p.assign(f),c.assign(g);var y=a.sub(g);a.assign(y)}else{var x=u.mul(n.decay).add(s.square().mul(1-n.decay));g=c.mul(n.momentum).add(s.mul(n.learningRate).div(x.add(n.epsilon).sqrt())),u.assign(x),c.assign(g),y=a.sub(g),a.assign(y)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ft(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ft(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&ft(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){var e;return je(this,function(n){switch(n.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},t.prototype.setWeights=function(e){return Ue(this,void 0,void 0,function(){var n;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),n=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*n,3*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},t.className="RMSProp",t}(Na);Ws(a_);var vu=function(){function r(){}return r.sgd=function(t){return new Lv(t)},r.momentum=function(t,e,n){return n===void 0&&(n=!1),new o_(t,e,n)},r.rmsprop=function(t,e,n,i,o){return e===void 0&&(e=.9),n===void 0&&(n=0),i===void 0&&(i=null),o===void 0&&(o=!1),new a_(t,e,n,i,o)},r.adam=function(t,e,n,i){return t===void 0&&(t=.001),e===void 0&&(e=.9),n===void 0&&(n=.999),i===void 0&&(i=null),new r_(t,e,n,i)},r.adadelta=function(t,e,n){return t===void 0&&(t=.001),e===void 0&&(e=.95),n===void 0&&(n=null),new t_(t,e,n)},r.adamax=function(t,e,n,i,o){return t===void 0&&(t=.002),e===void 0&&(e=.9),n===void 0&&(n=.999),i===void 0&&(i=null),o===void 0&&(o=0),new i_(t,e,n,i,o)},r.adagrad=function(t,e){return e===void 0&&(e=.1),new n_(t,e)},r}(),_u={sgd:vu.sgd,momentum:vu.momentum,adadelta:vu.adadelta,adagrad:vu.adagrad,rmsprop:vu.rmsprop,adamax:vu.adamax,adam:vu.adam},dq=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()};function Nm(){return new Promise(function(r){return dq(function(){return r()})})}de=j5;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var SD=function(r,t){return(SD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])})(r,t)};function ge(r,t){function e(){this.constructor=r}SD(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var nw,ud=function(){return(ud=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i]);return r}).apply(this,arguments)};function rt(r,t,e,n){return new(e||(e=Promise))(function(i,o){function a(c){try{u(n.next(c))}catch(d){o(d)}}function s(c){try{u(n.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):new e(function(d){d(c.value)}).then(a,s)}u((n=n.apply(r,[])).next())})}function Ye(r,t){var e,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,n&&(i=2&d[0]?n.return:d[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,d[1])).done)return i;switch(n=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return a.label++,{value:d[1],done:!1};case 5:a.label++,n=d[1],d=[0];continue;case 7:d=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){a=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){a.label=d[1];break}if(d[0]===6&&a.label<i[1]){a.label=i[1],i=d;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(d);break}i[2]&&a.ops.pop(),a.trys.pop();continue}d=t.call(r,a)}catch(p){d=[6,p],n=0}finally{e=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,c])}}}function An(){return nw==null&&(nw=fk().epsilon()),nw}function Zi(){return"channelsLast"}var Eu=function(r){function t(e){var n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return ge(t,r),t}(Error),xo=function(r){function t(e){var n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return ge(t,r),t}(Error),re=function(r){function t(e){var n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return ge(t,r),t}(Error),mt=function(r){function t(e){var n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return ge(t,r),t}(Error),pq=function(r){function t(e){var n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return ge(t,r),t}(Error);(function(r){function t(e){var n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return ge(t,r),t})(Error);function $u(r,t){if(Array.isArray(r)){for(var e=[],n=0;n<t;n++)e=e.concat(r);return e}return(e=new Array(t)).fill(r),e}function yo(r,t){if(!r)throw new pq(t)}function ZS(r,t){for(var e=0,n=0,i=r;n<i.length;n++)i[n]===t&&e++;return e}function Sr(r){return r.length===1?r[0]:r}function Kt(r){return Array.isArray(r)?r:[r]}function oa(r){var t=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Cu(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(t,e){return e.toUpperCase()})}var Ii={};function s_(r){if(r==null)return null;var t={};return t.className=r.getClassName(),t.config=r.getConfig(),t}function u1(r){if(r!=null&&typeof r=="object")if(Array.isArray(r))r.forEach(function(o){return u1(o)});else for(var t=0,e=Object.keys(r);t<e.length;t++){var n=e[t],i=r[n];i!=null&&typeof i=="object"&&(Array.isArray(i)||i.type!=="ndarray"||typeof i.value!="number"?u1(i):r[n]=i.value)}}function xp(r,t,e,n,i){var o,a,s;if(t===void 0&&(t={}),e===void 0&&(e={}),n===void 0&&(n="object"),i===void 0&&(i=!1),typeof r=="string"){var u=r,c=void 0;if(u in e)c=e[u];else if(u in Ii)c=Ii[u];else if((c=t[u])==null)throw new re("Unknown "+n+": "+r+`. This may be due to one of the following reasons:
1. The `+n+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+n+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return c}var d=r;if(d.className==null||d.config==null)throw new re(n+": Improper config format: "+JSON.stringify(d)+`.
'className' and 'config' must set.`);var p=d.className,f=void 0,g=void 0;if(p in e?(f=(o=e[p])[0],g=o[1]):p in Ii?(f=(a=Ii.className)[0],g=a[1]):p in t&&(f=(s=t[p])[0],g=s[1]),f==null)throw new re("Unknown "+n+": "+p+`. This may be due to one of the following reasons:
1. The `+n+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+n+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(g!=null){for(var y={},x=0,b=Object.keys(Ii);x<b.length;x++)y[z=b[x]]=Ii[z];for(var _=0,C=Object.keys(e);_<C.length;_++)y[z=C[_]]=e[z];d.config.customObjects=y;for(var T=ud({},Ii),D=0,O=Object.keys(e);D<O.length;D++){var z=O[D];Ii[z]=e[z]}u1(d.config);var I=g(f,d.config,e,i);return Ii=ud({},T),I}T=ud({},Ii);for(var S=0,A=Object.keys(e);S<A.length;S++)z=A[S],Ii[z]=e[z];return I=new f(d.config),Ii=ud({},T),I}function fq(r,t){return r<t?-1:r>t?1:0}function im(r,t){return-1*fq(r,t)}function xs(r){if(r==null)return r;for(var t=[],e=0,n=r;e<n.length;e++){var i=n[e];t.indexOf(i)===-1&&t.push(i)}return t}function mq(r){if(r==null)throw new re("Invalid value in obj: "+JSON.stringify(r));for(var t in r)if(r.hasOwnProperty(t))return!1;return!0}function ih(r,t,e){if(e!=null&&r.indexOf(e)<0)throw new re(e+" is not a valid "+t+".  Valid values are "+r+" or null/undefined.")}function u_(r,t,e,n){return n===void 0&&(n=1/0),yo(e>=0),yo(n>=e),Array.isArray(r)&&r.length>=e&&r.length<=n&&r.every(function(i){return typeof i===t})}function kr(r,t){Array.isArray(r)?(Ge.assert(r.length>0,function(){return t+" is unexpectedly an empty array."}),r.forEach(function(e,n){return kr(e,"element "+(n+1)+" of "+t)})):Ge.assert(Number.isInteger(r)&&r>0,function(){return"Expected "+t+" to be a positive integer, but got "+TD(r)+"."})}function TD(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(t){return TD(t)}).join(",")+"]":typeof r=="string"?'"'+r+'"':""+r}function gq(r,t){var e,n=Ge.now();return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=Ge.now();return a-n<t?e:(n=a,e=r.apply(void 0,i))}}function AD(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}function l_(r,t){return ue(function(){return dp(Gr(gv(r,r),t,!0))})}var _p=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.getConfig=function(){return{}},t}(be.Serializable),RD=function(r){function t(e){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=e.maxValue!=null?e.maxValue:n.defaultMaxValue,n.axis=e.axis!=null?e.axis:n.defaultAxis,n}return ge(t,r),t.prototype.apply=function(e){var n=this;return ue(function(){var i=l_(e,n.axis),o=Rr(i,0,n.maxValue);return ot(e,xr(o,yt(An(),i)))})},t.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},t.className="MaxNorm",t}(_p);be.registerClass(RD);var kD=function(r){function t(e){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=e.axis!=null?e.axis:n.defaultAxis,n}return ge(t,r),t.prototype.apply=function(e){var n=this;return ue(function(){return xr(e,yt(An(),l_(e,n.axis)))})},t.prototype.getConfig=function(){return{axis:this.axis}},t.className="UnitNorm",t}(_p);be.registerClass(kD);var ND=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return js(e)},t.className="NonNeg",t}(_p);be.registerClass(ND);var DD=function(r){function t(e){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=e.minValue!=null?e.minValue:n.defaultMinValue,n.maxValue=e.maxValue!=null?e.maxValue:n.defaultMaxValue,n.rate=e.rate!=null?e.rate:n.defaultRate,n.axis=e.axis!=null?e.axis:n.defaultAxis,n}return ge(t,r),t.prototype.apply=function(e){var n=this;return ue(function(){var i=l_(e,n.axis),o=yt(ot(n.rate,Rr(i,n.minValue,n.maxValue)),ot(1-n.rate,i));return ot(e,xr(o,yt(An(),i)))})},t.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},t.className="MinMaxNorm",t}(_p);be.registerClass(DD);var eT={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function jt(r){return s_(r)}function tT(r,t){return t===void 0&&(t={}),xp(r,be.SerializationMap.getMap().classNameMap,t,"constraint")}function Rn(r){return r==null?null:typeof r=="string"?tT({className:r in eT?eT[r]:r,config:{}}):r instanceof _p?r:tT(r)}function vq(r){return new RD(r)}function yq(r){return new kD(r)}function wq(){return new ND}function bq(r){return new DD(r)}var xq=Object.freeze({maxNorm:vq,unitNorm:yq,nonNeg:wq,minMaxNorm:bq}),_q=["channelsFirst","channelsLast"],Eq=["valid","same","causal"],Iq=["max","avg"],Cq=["sum","mul","concat","ave"],Jl=new Map;function Nn(r){ih(_q,"DataFormat",r)}function Si(r){ih(Eq,"PaddingMode",r)}function OD(r){ih(Iq,"PoolMode",r)}var yd=[],nT="/";function Lu(r,t){yd.push(r);try{var e=t();return yd.pop(),e}catch(n){throw yd.pop(),n}}function Sq(){return yd.length===0?"":yd.join(nT)+nT}function PD(r){if(!LD(r))throw new Error("Not a valid tensor name: '"+r+"'");return Sq()+r}function MD(r){if(!LD(r))throw new Error("Not a valid tensor name: '"+r+"'");Jl.has(r)||Jl.set(r,0);var t=Jl.get(r);if(Jl.set(r,Jl.get(r)+1),t>0){var e=r+"_"+t;return Jl.set(e,1),e}return r}var Tq=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function LD(r){return!!r.match(Tq)}function Aq(r){return r===parseInt(r.toString(),10)}function _s(r,t,e){t==null&&(t=0),e==null&&(e=r.length);for(var n=1,i=t;i<e;++i)n*=r[i];return n}function FD(r){return r=Array.isArray(r)?new Float32Array(r):r,$r(r)}function Lc(r){return Tv(FD(r)).dataSync()[0]}function Ds(r){return Ns(FD(r)).dataSync()[0]}function eo(r,t){if(t<r)throw new re("end ("+t+") < begin ("+r+") is forbidden.");for(var e=[],n=r;n<t;++n)e.push(n);return e}function Ep(r,t){return r.asType(t)}function Ip(r,t){t===void 0&&(t=-1);var e=r.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),r.reshape(e)}function Rq(r,t){return ue(function(){if(r.shape.length!==2)throw new re("repeat() expects a rank-2 tensor, but received a rank-"+r.shape.length+" tensor.");return l1(Ip(r,1),[1,t,1])})}function kq(r){var t=[_s(r.shape)];return r.reshape(t)}function Nq(r){if(r.rank<=1)throw new re("batchFlatten requires a minimum rank of 2. Got rank: "+r.rank+".");var t=[r.shape[0],_s(r.shape,1)];return r.reshape(t)}function Fu(r,t,e){return ue(function(){switch(r.rank){case 1:return mp(r,t,e);case 2:return Cv(r,[t,0],[e,r.shape[1]]);case 3:return gp(r,[t,0,0],[e,r.shape[1],r.shape[2]]);case 4:return Oc(r,[t,0,0,0],[e,r.shape[1],r.shape[2],r.shape[3]]);case 5:return hi(r,[t,0,0,0,0],[e,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return hi(r,[t,0,0,0,0,0],[e,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new re("sliceAlongFirstAxis() received an unsupported tensor rank: "+r.rank)}})}function rw(r,t,e){return ue(function(){switch(r.rank){case 1:return mp(r,t,e);case 2:return Cv(r,[0,t],[r.shape[0],e]);case 3:return gp(r,[0,0,t],[r.shape[0],r.shape[1],e]);case 4:return Oc(r,[0,0,0,t],[r.shape[0],r.shape[1],r.shape[2],e]);default:throw new re("sliceAlongLastAxis() received an unsupported tensor rank: "+r.rank)}})}function om(r,t,e,n){return ue(function(){switch(r.rank){case 1:return mp(r,t,e);case 2:switch(n){case 1:return Fu(r,t,e);case 2:return rw(r,t,e);default:throw new re("The axis is not within the rank of the tensor "+n)}case 3:switch(n){case 1:return Fu(r,t,e);case 2:return gp(r,[0,t,0],[r.shape[0],e,r.shape[2]]);case 3:return rw(r,t,e);default:throw new re("The axis is not within the rank of the tensor "+n)}case 4:switch(n){case 1:return Fu(r,t,e);case 2:return Oc(r,[0,t,0,0],[r.shape[0],e,r.shape[2],r.shape[3]]);case 3:return Oc(r,[0,0,t,0],[r.shape[0],r.shape[1],e,r.shape[3]]);case 4:return rw(r,t,e);default:throw new re("The axis is not within the rank of the tensor "+n)}default:throw new re("sliceAlongLastAxis() received an unsupported tensor rank: "+r.rank)}})}function zD(r,t){var e;return t===void 0&&(t=-1),t<0&&(t=(e=r[0].rank)!==0?e:0),t===r[0].rank&&(t=-1),br(r,t)}function rT(r,t){switch(r.rank){case 1:return Fb([r,t]);case 2:return zb([r,t],0);case 3:return Vb([r,t],0);case 4:return Bb([r,t],0);default:throw new re("concatAlongFirstAxis() received an unsupported tensor rank: "+r.rank)}}function l1(r,t){if(Array.isArray(t)||(t=[t]),r.rank!==t.length)throw new re("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+r.rank+")");return ws(r,t)}function Fv(r,t,e,n,i){return t===void 0&&(t=0),e===void 0&&(e=1),qb(r,t,e,n,i)}function ma(r,t,e,n){if(r.rank<2||t.rank<2)throw new mt("dot requires both inputs to be rank >= 2 but got x shape = "+r.shape+" and y shape = "+t.shape);if(t.rank>=3&&r.shape.slice(-1)[0]!==(d=t.shape.slice(-2)[0]))throw new mt("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+r.shape+" and  y shape = "+t.shape);if(r.rank===2&&t.rank===2){var i=!1,o=!1;return Mc.matMul({a:r,b:t,transposeA:i,transposeB:o,bias:n?c1(r.rank,n,Zi()):null,activation:e})}var a=r.shape.slice(),s=a.pop();r=r.reshape([-1,s]);var u=t.shape.slice(),c=u.pop(),d=u.pop(),p=u.concat([c]),f=Array.from({length:t.rank},function(y,x){return x===0?t.rank-2:x<=t.rank-2?x-1:x});t=t.transpose(f).reshape([d,-1]);var g=a.concat(p);return i=!1,o=!1,Mc.matMul({a:r,b:t,transposeA:i,transposeB:o,bias:n?c1(r.rank,n,Zi()):null,activation:e}).reshape(g)}function VD(r,t,e){return ue(function(){return t=Array.isArray(t)?$r(t,"int32"):t.toInt(),th(r,t,e)})}function Cp(r){return gv(r,r)}function c1(r,t,e){var n=t.shape;if(t.rank!==1&&t.rank!==r)throw new re("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+r);if(r===5){if(e==="channelsFirst")return n.length===1?t.reshape([1,n[0],1,1,1]):t.reshape([1,n[3],n[0],n[1],n[2]]);if(e==="channelsLast")return n.length===1?t.reshape([1,1,1,1,n[0]]):t.reshape([1].concat(n))}else if(r===4){if(e==="channelsFirst")return n.length===1?t.reshape([1,n[0],1,1]):t.reshape([1,n[2],n[0],n[1]]);if(e==="channelsLast")return n.length===1?t.reshape([1,1,1,n[0]]):t.reshape([1].concat(n))}else if(r===3){if(e==="channelsFirst")return n.length===1?t.reshape([1,n[0],1]):t.reshape([1,n[1],n[0]]);if(e==="channelsLast")return n.length===1?t.reshape([1,1,n[0]]):t.reshape([1].concat(n))}else if(r<3)return t;throw new re("Unsupported input rank by biasAdd: "+t.rank)}function Da(r,t,e){return ue(function(){return e==null&&(e=Zi()),Nn(e),r.add(c1(r.rank,t,e))})}function Dq(r,t){if(t===void 0&&(t=1),t!==1)throw new mt("Support for alpha values other than 1 ("+t+") is not implemented yet.");return rh(r)}function Oq(r){return ue(function(){return xr(r,ks(r).add(1))})}function BD(r,t,e,n){return ue(function(){return $x(r,t,e,n)})}function Pq(r){return ue(function(){var t=yt(.5,ot(.2,r));return Rr(t,0,1)})}function Fc(r,t,e){return e===void 0&&(e=!1),e?r():t()}var Mq=["fanIn","fanOut","fanAvg"],Lq=["normal","uniform","truncatedNormal"];function Fq(r){ih(Mq,"FanMode",r)}function zq(r){ih(Lq,"Distribution",r)}var oo=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t}(be.Serializable),UD=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e,n){return zt(e,n)},t.className="Zeros",t}(oo);be.registerClass(UD);var c_=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e,n){return Lo(e,n)},t.className="Ones",t}(oo);be.registerClass(c_);var jD=function(r){function t(e){var n=r.call(this)||this;if(typeof e!="object")throw new re("Expected argument of type ConstantConfig but got "+e);if(e.value===void 0)throw new re("config must have value set but got "+e);return n.value=e.value,n}return ge(t,r),t.prototype.apply=function(e,n){var i=this;return ue(function(){return ot(Ve(i.value),Lo(e,n))})},t.prototype.getConfig=function(){return{value:this.value}},t.className="Constant",t}(oo);be.registerClass(jD);var WD=function(r){function t(e){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return ge(t,r),t.prototype.apply=function(e,n){return tl(e,this.minval,this.maxval,n)},t.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},t.className="RandomUniform",t}(oo);be.registerClass(WD);var qD=function(r){function t(e){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return ge(t,r),t.prototype.apply=function(e,n){if((n=n||"float32")!=="float32"&&n!=="int32")throw new mt("randomNormal does not support dType "+n+".");return Fv(e,this.mean,this.stddev,n,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="RandomNormal",t}(oo);be.registerClass(qD);var HD=function(r){function t(e){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return ge(t,r),t.prototype.apply=function(e,n){if((n=n||"float32")!=="float32"&&n!=="int32")throw new mt("truncatedNormal does not support dType "+n+".");return lp(e,this.mean,this.stddev,n,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="TruncatedNormal",t}(oo);be.registerClass(HD);var $D=function(r){function t(e){var n=r.call(this)||this;return n.gain=e.gain!=null?e.gain:1,n}return ge(t,r),t.prototype.apply=function(e,n){var i=this;return ue(function(){if(e.length!==2||e[0]!==e[1])throw new re("Identity matrix initializer can only be used for 2D square matrices.");return ot(i.gain,nv(e[0]))})},t.prototype.getConfig=function(){return{gain:this.gain}},t.className="Identity",t}(oo);function Vq(r,t){var e,n;if(t===void 0&&(t="channelsLast"),Nn(t),r.length===2)e=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1)if(t==="channelsFirst"){var i=_s(r,2);e=r[1]*i,n=r[0]*i}else t==="channelsLast"&&(i=_s(r,0,r.length-2),e=r[r.length-2]*i,n=r[r.length-1]*i);else{var o=_s(r);e=Math.sqrt(o),n=Math.sqrt(o)}return[e,n]}be.registerClass($D);var Kr=function(r){function t(e){var n=r.call(this)||this;if(e.scale<0)throw new re("scale must be a positive float. Got: "+e.scale);return n.scale=e.scale==null?1:e.scale,n.mode=e.mode==null?"fanIn":e.mode,Fq(n.mode),n.distribution=e.distribution==null?"normal":e.distribution,zq(n.distribution),n.seed=e.seed,n}return ge(t,r),t.prototype.apply=function(e,n){var i=Vq(e),o=i[0],a=i[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,o):this.mode==="fanOut"?s/=Math.max(1,a):s/=Math.max(1,(o+a)/2),this.distribution==="normal"){var u=Math.sqrt(s);if((n=n||"float32")!=="float32"&&n!=="int32")throw new mt(this.getClassName()+" does not support dType "+n+".");return lp(e,0,u,n,this.seed)}var c=Math.sqrt(3*s);return tl(e,-c,c,n)},t.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},t.className="VarianceScaling",t}(oo);be.registerClass(Kr);var h_=function(r){function t(e){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})||this}return ge(t,r),t.prototype.getClassName=function(){return Kr.className},t.className="GlorotUniform",t}(Kr);be.registerClass(h_);var d_=function(r){function t(e){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})||this}return ge(t,r),t.prototype.getClassName=function(){return Kr.className},t.className="GlorotNormal",t}(Kr);be.registerClass(d_);var p_=function(r){function t(e){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})||this}return ge(t,r),t.prototype.getClassName=function(){return Kr.className},t.className="HeNormal",t}(Kr);be.registerClass(p_);var f_=function(r){function t(e){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})||this}return ge(t,r),t.prototype.getClassName=function(){return Kr.className},t.className="HeUniform",t}(Kr);be.registerClass(f_);var m_=function(r){function t(e){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})||this}return ge(t,r),t.prototype.getClassName=function(){return Kr.className},t.className="LeCunNormal",t}(Kr);be.registerClass(m_);var g_=function(r){function t(e){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})||this}return ge(t,r),t.prototype.getClassName=function(){return Kr.className},t.className="LeCunNormal",t}(Kr);be.registerClass(g_);var GD=function(r){function t(e){var n=r.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=e.gain==null?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,n.seed!=null)throw new mt("Random seed is not implemented for Orthogonal Initializer yet.");return n}return ge(t,r),t.prototype.apply=function(e,n){var i=this;return ue(function(){if(e.length!==2)throw new mt("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+e[0]*e[1]+") elements: Slowness may result.");var o=Fv(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),a=Xx.gramSchmidt(o);return e[0]>e[1]&&(a=a.transpose()),ot(i.gain,a)})},t.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},t.className="Orthogonal",t}(oo);be.registerClass(GD);var iT={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function oT(r,t){return t===void 0&&(t={}),xp(r,be.SerializationMap.getMap().classNameMap,t,"initializer")}function Pt(r){return s_(r)}function Zt(r){if(typeof r=="string"){var t=r in iT?iT[r]:r;if(t==="GlorotNormal")return new d_;if(t==="GlorotUniform")return new h_;if(t==="HeNormal")return new p_;if(t==="HeUniform")return new f_;if(t==="LeCunNormal")return new m_;if(t==="LeCunUniform")return new g_;var e={};return e.className=t,e.config={},oT(e)}return r instanceof oo?r:oT(r)}function Bq(){return new UD}function Uq(){return new c_}function jq(r){return new jD(r)}function Wq(r){return new WD(r)}function qq(r){return new qD(r)}function Hq(r){return new HD(r)}function $q(r){return new $D(r)}function Gq(r){return new Kr(r)}function Kq(r){return new h_(r)}function Xq(r){return new d_(r)}function Qq(r){return new p_(r)}function Yq(r){return new f_(r)}function Jq(r){return new m_(r)}function Zq(r){return new g_(r)}function e9(r){return new GD(r)}var t9=Object.freeze({zeros:Bq,ones:Uq,constant:jq,randomUniform:Wq,randomNormal:qq,truncatedNormal:Hq,identity:$q,varianceScaling:Gq,glorotUniform:Kq,glorotNormal:Xq,heNormal:Qq,heUniform:Yq,leCunNormal:Jq,leCunUniform:Zq,orthogonal:e9}),n9=0;function KD(){return n9++}var am={};function zv(r){return r===void 0&&(r=""),r in am||(am[r]=0),am[r]+=1,r+am[r].toString()}function h1(r){return Array.isArray(r)&&Array.isArray(r[0])}function mg(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function dt(r){var t;if(Array.isArray(r)){if(r.length!==1)throw new re("Expected Tensor length to be 1; got "+r.length);t=r[0]}else t=r;return t}function qt(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return(r=r)[0];throw new re("Expected exactly 1 Shape; got "+r.length)}return r}function gg(r){for(var t=0,e=0,n=r;e<n.length;e++){var i=n[e];i.shape.length===0?t+=1:t+=i.shape.reduce(function(o,a){return o*a})}return t}var aT="Variable",XD=function(){function r(t,e,n,i,o){e===void 0&&(e="float32"),n===void 0&&(n=aT),i===void 0&&(i=!0),o===void 0&&(o=null),this.dtype=e??"float32",this.shape=t.shape,this.id=KD(),n=n??aT,this.originalName=PD(n),this.name=MD(this.originalName),this.trainable_=i,this.constraint=o,this.val=Mb(t,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(t){return this.assertNotDisposed(),r9(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.trainable_=t,this.val.trainable=t},enumerable:!0,configurable:!0}),r}();function r9(r,t){if(r.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(t.shape))}function d1(r){return r.map(function(t){return t.read()})}function v_(r){r.forEach(function(t){t[0].write(t[1])})}var Xn=function(){return function(r){this.dtype=r.dtype,this.shape=r.shape,r.shape!=null?this.ndim=r.shape.length:this.ndim=r.ndim,this.maxNDim=r.maxNDim,this.minNDim=r.minNDim,this.axes=r.axes||{}}}(),Xi=function(){return function(r,t,e,n,i,o,a){this.dtype=r,this.shape=t,this.sourceLayer=e,this.inputs=n,this.callArgs=i,this.outputTensorIndex=a,this.id=KD(),o!=null&&(this.originalName=PD(o),this.name=MD(this.originalName)),this.rank=t.length}}(),i9=0,Vv=function(){function r(t,e){this.callArgs=e,this.id=i9++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(var n=0,i=t.inboundLayers;n<i.length;n++){var o=i[n];o!=null&&o.outboundNodes.push(this)}t.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){for(var t=[],e=0,n=this.inboundLayers;e<n.length;e++){var i=n[e];i!=null?t.push(i.name):t.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r}(),o9=0,St=function(r){function t(e){var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=o9++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var i=e.name;if(!i){var o=n.getClassName();i=oa(o)+"_"+zv(o)}if(n.name=i,n.trainable_=e.trainable==null||e.trainable,e.inputShape!=null||e.batchInputShape!=null){var a=void 0;if(e.batchInputShape!=null)a=e.batchInputShape;else if(e.inputShape!=null){var s=null;e.batchSize!=null&&(s=e.batchSize),a=[s].concat(e.inputShape)}n.batchInputShape=a;var u=e.dtype;u==null&&(u=e.inputDType),u==null&&(u="float32"),n.dtype=u}return e.weights!=null?n.initialWeights=e.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return ge(t,r),t.nodeKey=function(e,n){return e.name+"_ib-"+n.toString()},t.prototype.getNodeAtIndex=function(e,n){if(this.inboundNodes.length===0)throw new xo("The layer has never been called and thus has no defined "+n+".");if(this.inboundNodes.length<=e)throw new re("Asked to get "+n+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},t.prototype.getInputAt=function(e){return Sr(this.getNodeAtIndex(e,"input").inputTensors)},t.prototype.getOutputAt=function(e){return Sr(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(t.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Eu("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Eu("Layer "+this.name+" is not connected, no input to return.");return Sr(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Eu("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Eu("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Sr(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),t.prototype.calculateLosses=function(){return this.losses.map(function(e){return e()})},Object.defineProperty(t.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach(function(n){return n.trainable=e}),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(e){return e.trainable}):[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(e){return!e.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},t.prototype.assertInputCompatibility=function(e){if(e=Kt(e),this.inputSpec!=null&&this.inputSpec.length!==0){var n=Kt(this.inputSpec);if(e.length!==n.length)throw new re("Layer "+this.name+" expects "+n.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var i=0;i<e.length;i++){var o=e[i],a=n[i];if(a!=null){var s=o.rank;if(a.ndim!=null&&s!==a.ndim)throw new re("Input "+i+" is incompatible with layer "+this.name+": expected ndim="+a.ndim+", found ndim="+s);if(a.maxNDim!=null&&s>a.maxNDim)throw new re("Input "+i+" is incompatible with layer "+this.name+": expected max_ndim="+a.maxNDim+", found ndim="+s);if(a.minNDim!=null&&s<a.minNDim)throw new re("Input "+i+" is incompatible with layer "+this.name+": expected min_ndim="+a.minNDim+", found ndim="+s+".");if(a.dtype!=null&&o.dtype!==a.dtype)throw new re("Input "+i+" is incompatible with layer "+this.name+" : expected dtype="+a.dtype+", found dtype="+o.dtype+".");if(a.axes){var u=o.shape;for(var c in a.axes){var d=Number(c),p=a.axes[c],f=d>=0?u[d]:u[u.length+d];if(p!=null&&[p,null].indexOf(f)===-1)throw new re("Input "+i+" is incompatible with layer "+this.name+": expected axis "+d+" of input shape to have value "+p+" but got shape "+u+".")}}if(a.shape!=null)for(var g=0;g<a.shape.length;++g){var y=a.shape[g],x=o.shape[g];if(y!=null&&x!=null&&y!==x)throw new re("Input "+i+" is incompatible with layer "+this.name+": expected shape="+a.shape+", found shape="+o.shape+".")}}}}},t.prototype.call=function(e,n){return e},t.prototype.invokeCallHook=function(e,n){this._callHook!=null&&this._callHook(e,n)},t.prototype.setCallHook=function(e){this._callHook=e},t.prototype.clearCallHook=function(){this._callHook=null},t.prototype.apply=function(e,n){var i=this;n=n||{},this.assertNotDisposed();for(var o=Kt(e),a=!0,s=0,u=o;s<u.length;s++)if(!(u[s]instanceof Xi)){a=!1;break}for(var c=!0,d=0,p=o;d<p.length;d++)if(p[d]instanceof Xi){c=!1;break}if(a===c)throw new re("Arguments to apply() must be all SymbolicTensors or all Tensors");return Lu(this.name,function(){if(!i.built){i.assertInputCompatibility(e);for(var f=[],g=0,y=Kt(e);g<y.length;g++){var x=y[g];f.push(x.shape)}i.build(Sr(f)),i.built=!0,i.initialWeights&&i.setWeights(i.initialWeights),i._refCount===null&&c&&(i._refCount=1)}if(i.assertInputCompatibility(e),c){for(var b=[],_=0,C=Kt(z=i.call(e,n));_<C.length;_++){var T=C[_];o.indexOf(T)!==-1&&(T=T.clone()),b.push(T)}if(z=Sr(b),i.activityRegularizer!=null)throw new mt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return z}var D=a9(e),O=i.computeOutputShape(D),z=void 0,I=s9(e);if(i.warnOnIncompatibleInputShape(Array.isArray(e)?D[0]:D),z=O!=null&&O.length>0&&Array.isArray(O[0])?O.map(function(S,A){return new Xi(I,S,i,Kt(e),n,i.name,A)}):new Xi(I,O,i,Kt(e),n,i.name),i.addInboundNode(e,z,null,null,D,O,n),i._refCount++,i.activityRegularizer!=null)throw new mt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return z})},t.prototype.warnOnIncompatibleInputShape=function(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var n=!1;this.batchInputShape.forEach(function(i,o){i!=null&&e[o]!=null&&e[o]!==i&&(n=!0)}),n&&console.warn("The shape of the input tensor ("+JSON.stringify(e)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(t.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Eu("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var e=[],n=0,i=this.inboundNodes;n<i.length;n++){var o=i[n],a=JSON.stringify(o.outputShapes);e.indexOf(a)===-1&&e.push(a)}if(e.length===1){var s=this.inboundNodes[0].outputShapes;return Array.isArray(s)&&Array.isArray(s[0])&&s.length===1?s[0]:s}throw new Eu("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),t.prototype.countParams=function(){if(!this.built)throw new xo("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return gg(this.weights)},t.prototype.build=function(e){this.built=!0},t.prototype.getWeights=function(e){return e===void 0&&(e=!1),d1(e?this.trainableWeights:this.weights)},t.prototype.setWeights=function(e){var n=this;ue(function(){var i=n.weights;if(i.length!==e.length)throw new re('You called setWeights(weights) on layer "'+n.name+'" with a weight list of length '+e.length+", but the layer was expecting "+i.length+" weights. Provided weights: "+e+"...");if(i.length!==0){for(var o=[],a=d1(i),s=0;s<a.length;++s){var u=a[s],c=i[s],d=e[s];if(!Ge.arraysEqual(u.shape,d.shape))throw new re("Layer weight shape "+u.shape+" not compatible with provided weight shape "+d.shape);o.push([c,d])}v_(o)}})},t.prototype.addWeight=function(e,n,i,o,a,s,u){if(this._addedWeightNames.indexOf(e)!==-1)throw new re("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),i==null&&(i="float32"),this.fastWeightInitDuringBuild&&(o=Zt("zeros"));var c=o.apply(n,i),d=new XD(c,i,e,s,u);return c.dispose(),a!=null&&this.addLoss(function(){return a.apply(d.read())}),s==null&&(s=!0),s?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d},t.prototype.setFastWeightInitDuringBuild=function(e){this.fastWeightInitDuringBuild=e},t.prototype.addLoss=function(e){var n;e==null||Array.isArray(e)&&e.length===0||(e=Kt(e),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,e))},t.prototype.computeOutputShape=function(e){return e},t.prototype.computeMask=function(e,n){var i=this;if(!this.supportsMasking){if(n!=null){if(!Array.isArray(n))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");n.forEach(function(o){if(o!=null)throw new TypeError("Layer "+i.name+" does not support masking, but was passed an inputMask.")})}return null}return n},t.prototype.addInboundNode=function(e,n,i,o,a,s,u){u===void 0&&(u=null);var c=Kt(e);n=Kt(n),i=Kt(i),o=Kt(o),a=mg(a),s=mg(s);for(var d=[],p=[],f=[],g=0,y=c;g<y.length;g++){var x=y[g];d.push(x.sourceLayer),p.push(x.nodeIndex),f.push(x.tensorIndex)}new Vv({outboundLayer:this,inboundLayers:d,nodeIndices:p,tensorIndices:f,inputTensors:c,outputTensors:n,inputMasks:i,outputMasks:o,inputShapes:a,outputShapes:s},u);for(var b=0;b<n.length;b++)n[b].sourceLayer=this,n[b].nodeIndex=this.inboundNodes.length-1,n[b].tensorIndex=b},t.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e},t.prototype.disposeWeights=function(){return this.weights.forEach(function(e){return e.dispose()}),this.weights.length},t.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var e=0;return--this._refCount==0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}},t}(be.Serializable);function a9(r){for(var t=[],e=0,n=r=Kt(r);e<n.length;e++){var i=n[e];t.push(i.shape)}return Sr(t)}function s9(r){return"float32"}function QD(r,t,e){if((t==null||e!=null&&e>0)&&(t=r.sourceLayer,e=r.nodeIndex),t.inboundNodes.length===0)return[r];var n=t.inboundNodes[e];if(n.inboundLayers.length===0)return n.inputTensors;for(var i=[],o=0;o<n.inboundLayers.length;o++)for(var a=0,s=QD(n.inputTensors[o],n.inboundLayers[o],n.nodeIndices[o]);a<s.length;a++){var u=s[a];i.indexOf(u)===-1&&i.push(u)}return i}var sT,Sp=function(r){function t(e){var n=r.call(this,{dtype:e.dtype,name:e.name!=null?e.name:zv("input").toString()})||this;if(e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new re("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var i=e.batchInputShape;if(i==null){if(e.inputShape==null)throw new re("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");i=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new re("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var o=e.dtype||"float32";n.batchInputShape=i,n.dtype=o,n.inputSpec=[{shape:i}];var a=new Xi(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new Vv({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[i],outputShapes:[i]}),n}return ge(t,r),t.prototype.apply=function(e,n){throw new re("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},t.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},t.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},t.className="InputLayer",t}(St);function YD(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new re("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=r.batchShape;r.shape!=null&&t==null&&(t=[null].concat(r.shape));var e=r.dtype;return e==null&&(e="float32"),new Sp({batchInputShape:t,name:r.name,dtype:e,sparse:r.sparse}).inboundNodes[0].outputTensors[0]}function rs(r){return rt(this,void 0,void 0,function(){var t,e,n,i,o,a,s,u;return Ye(this,function(c){switch(c.label){case 0:if(r==null)return[2];for(i in t=[],e=[],n=[],r)typeof(o=r[i])!="number"&&(a=o,t.push(a.data()),e.push(i),n.push(a));return t.length>0?[4,Promise.all(t)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)r[e[u]]=s[u][0];ft(n),c.label=2;case 2:return[2]}})})}function JD(r){if(r!=null)for(var t in r){var e=r[t];typeof e!="number"&&e.dispose()}}be.registerClass(Sp),function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"}(sT||(sT={}));var u9=125,zc=function(){function r(){this.validationData=null}return r.prototype.setParams=function(t){this.params=t},r.prototype.onEpochBegin=function(t,e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(t,e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(t,e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(t,e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(t){return rt(this,void 0,void 0,function(){return Ye(this,function(e){return[2]})})},r.prototype.onTrainEnd=function(t){return rt(this,void 0,void 0,function(){return Ye(this,function(e){return[2]})})},r.prototype.setModel=function(t){},r}(),ZD=function(){function r(t,e){e===void 0&&(e=10),t==null&&(t=[]),this.callbacks=t,this.queueLength=e}return r.prototype.append=function(t){this.callbacks.push(t)},r.prototype.setParams=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setParams(t)},r.prototype.setModel=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setModel(t)},r.prototype.onEpochBegin=function(t,e){return rt(this,void 0,void 0,function(){var n,i;return Ye(this,function(o){switch(o.label){case 0:e==null&&(e={}),n=0,i=this.callbacks,o.label=1;case 1:return n<i.length?[4,i[n].onEpochBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onEpochEnd=function(t,e){return rt(this,void 0,void 0,function(){var n,i;return Ye(this,function(o){switch(o.label){case 0:e==null&&(e={}),n=0,i=this.callbacks,o.label=1;case 1:return n<i.length?[4,i[n].onEpochEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onBatchBegin=function(t,e){return rt(this,void 0,void 0,function(){var n,i;return Ye(this,function(o){switch(o.label){case 0:e==null&&(e={}),n=0,i=this.callbacks,o.label=1;case 1:return n<i.length?[4,i[n].onBatchBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onBatchEnd=function(t,e){return rt(this,void 0,void 0,function(){var n,i;return Ye(this,function(o){switch(o.label){case 0:e==null&&(e={}),n=0,i=this.callbacks,o.label=1;case 1:return n<i.length?[4,i[n].onBatchEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onTrainBegin=function(t){return rt(this,void 0,void 0,function(){var e,n;return Ye(this,function(i){switch(i.label){case 0:t==null&&(t={}),e=0,n=this.callbacks,i.label=1;case 1:return e<n.length?[4,n[e].onTrainBegin(t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},r.prototype.onTrainEnd=function(t){return rt(this,void 0,void 0,function(){var e,n;return Ye(this,function(i){switch(i.label){case 0:t==null&&(t={}),e=0,n=this.callbacks,i.label=1;case 1:return e<n.length?[4,n[e].onTrainEnd(t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},r}(),l9=function(r){function t(){return r.call(this)||this}return ge(t,r),t.prototype.onEpochBegin=function(e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return this.seen=0,this.totals={},[2]})})},t.prototype.onBatchEnd=function(e,n){return rt(this,void 0,void 0,function(){var i,o,a,s,u=this;return Ye(this,function(c){for(s in n==null&&(n={}),i=n.size==null?0:n.size,this.seen+=i,o=function(d){var p=n[d];if(typeof p=="number")a.totals.hasOwnProperty(d)||(a.totals[d]=0),a.totals[d]=a.totals[d]+p*i;else{var f=void 0;d in a.totals?f=a.totals[d]:a.totals[d]=0;var g=ue(function(){return yt(u.totals[d],ot(p,i))});a.totals[d]=g,f!=null&&f.dispose()}},a=this,n)o(s);return[2]})})},t.prototype.onEpochEnd=function(e,n){return rt(this,void 0,void 0,function(){var i,o,a,s,u,c=this;return Ye(this,function(d){if(n!=null)for(i=function(p){if(o.totals[p]==null)return"continue";typeof o.totals[p]=="number"?n[p]=o.totals[p]/o.seen:ue(function(){var f=ot(xr(1,c.seen),c.totals[p]);n[p]=f,c.totals[p].dispose(),No(n[p])})},o=this,a=0,s=this.params.metrics;a<s.length;a++)u=s[a],i(u);return[2]})})},t}(zc),eO=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.onTrainBegin=function(e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return this.epoch=[],this.history={},[2]})})},t.prototype.onEpochEnd=function(e,n){return rt(this,void 0,void 0,function(){var i;return Ye(this,function(o){for(i in n==null&&(n={}),this.epoch.push(e),n)this.history[i]==null&&(this.history[i]=[]),this.history[i].push(n[i]);return[2]})})},t.prototype.syncData=function(){return rt(this,void 0,void 0,function(){var e,n,i,o,a,s,u,c,d;return Ye(this,function(p){switch(p.label){case 0:for(o in e=[],n=[],i=[],this.history)for(a=this.history[o],s=0;s<a.length;++s)typeof a[s]!="number"&&(u=a[s],e.push(u.data()),n.push(o),i.push(s));return[4,Promise.all(e)];case 1:for(c=p.sent(),d=0;d<c.length;++d)this.history[n[d]][i[d]].dispose(),this.history[n[d]][i[d]]=c[d][0];return[2]}})})},t}(zc),tO=function(r){function t(e,n){var i=r.call(this)||this;if(i.currentEpoch=0,i.yieldEvery=n||"auto",i.yieldEvery==="auto"&&(i.yieldEvery=u9),i.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Ge.isNumber(i.yieldEvery)&&(i.maybeWait=gq(i.maybeWait.bind(i),i.yieldEvery)),i.trainBegin=e.onTrainBegin,i.trainEnd=e.onTrainEnd,i.epochBegin=e.onEpochBegin,i.epochEnd=e.onEpochEnd,i.batchBegin=e.onBatchBegin,i.batchEnd=e.onBatchEnd,i.yield=e.onYield,i}return ge(t,r),t.prototype.maybeWait=function(e,n,i){return rt(this,void 0,void 0,function(){var o;return Ye(this,function(a){switch(a.label){case 0:return o=[],this.yield==null?[3,2]:[4,rs(i)];case 1:a.sent(),o.push(this.yield(e,n,i)),a.label=2;case 2:return o.push(Nm()),[4,Promise.all(o)];case 3:return a.sent(),[2]}})})},t.prototype.onEpochBegin=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){switch(i.label){case 0:return this.currentEpoch=e,this.epochBegin==null?[3,3]:[4,rs(n)];case 1:return i.sent(),[4,this.epochBegin(e,n)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.onEpochEnd=function(e,n){return rt(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return i=[],this.epochEnd==null?[3,2]:[4,rs(n)];case 1:o.sent(),i.push(this.epochEnd(e,n)),o.label=2;case 2:return this.yieldEvery==="epoch"&&i.push(Nm()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},t.prototype.onBatchBegin=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){switch(i.label){case 0:return this.batchBegin==null?[3,3]:[4,rs(n)];case 1:return i.sent(),[4,this.batchBegin(e,n)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.onBatchEnd=function(e,n){return rt(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return i=[],this.batchEnd==null?[3,2]:[4,rs(n)];case 1:o.sent(),i.push(this.batchEnd(e,n)),o.label=2;case 2:return this.yieldEvery==="batch"?i.push(Nm()):Ge.isNumber(this.yieldEvery)&&i.push(this.maybeWait(this.currentEpoch,e,n)),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},t.prototype.onTrainBegin=function(e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,rs(e)];case 1:return n.sent(),[4,this.trainBegin(e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.onTrainEnd=function(e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,rs(e)];case 1:return n.sent(),[4,this.trainEnd(e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t}(zc);function nO(r,t){return r==null&&(r={}),r instanceof zc?[r]:Array.isArray(r)&&r[0]instanceof zc?r:Kt(r).map(function(e){return new tO(e,t)})}var rO=function(){function r(){}return r.registerCallbackConstructor=function(t,e){Ge.assert(t>=0&&Number.isInteger(t),function(){return"Verbosity level is expected to be an integer >= 0, but got "+t}),r.checkForDuplicate(e),r.constructors[t]==null&&(r.constructors[t]=[]),r.constructors[t].push(e)},r.checkForDuplicate=function(t){for(var e in r.constructors)r.constructors[+e].forEach(function(n){if(n===t)throw new re("Duplicate callback constructor.")})},r.clear=function(){r.constructors={}},r.createCallbacks=function(t){var e=[];for(var n in r.constructors){var i=+n;t>=i&&e.push.apply(e,r.constructors[i])}return e.map(function(o){return new o})},r.constructors={},r}();function iO(r,t,e,n,i,o,a,s,u){var c=new eO,d=[new l9].concat(rO.createCallbacks(t));r!=null&&d.push.apply(d,r),d.push(c);var p=new ZD(d);return p.setParams({epochs:e,initialEpoch:n,samples:i,steps:o,batchSize:a,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function Qi(r,t,e){return t===void 0&&(t={}),e===void 0&&(e=!1),xp(r,be.SerializationMap.getMap().classNameMap,t,"layer",e)}function vg(r,t){return ue(function(){r.dtype!=="float32"&&(r=r.asType("float32"));var e=Gr(Cp(r),t,!0),n=Yc(e.shape,An()),i=dp(Fo(e,n));return xr(r,i)})}function al(r,t){return ue(function(){return _n(Cp(Yn(t,r)),-1)})}function Bv(r,t){return ue(function(){return _n(ks(Yn(t,r)),-1)})}function oh(r,t){return ue(function(){var e=Yn(r,t),n=Rr(ks(r),An(),Number.MAX_VALUE),i=ks(xr(e,n));return ot(100,_n(i,-1))})}function c9(r,t){return ue(function(){var e=Rr(t,An(),Number.MAX_VALUE),n=Ea(yt(1,e)),i=Rr(r,An(),Number.MAX_VALUE),o=Ea(yt(1,i));return _n(Cp(Yn(n,o)),-1)})}function h9(r,t){return ue(function(){var e=Fo(0,Yn(1,ot(r,t)));return _n(Cp(e),-1)})}function d9(r,t){return ue(function(){var e=Fo(0,Yn(1,ot(r,t)));return _n(e,-1)})}function p9(r,t){return ue(function(){var e=Gr(ot(r,t),-1),n=Ns(ot(Yn(1,r),t),-1);return Fo(0,yt(1,Yn(n,e)))})}function f9(r,t){return ue(function(){var e=Math.log(2),n=Yn(t,r),i=Yn(yt(n,hp(ot(-2,n))),e);return _n(i,-1)})}function Ud(r,t,e){return e===void 0&&(e=!1),ue(function(){if(e)t=nl(t);else{var n=Gr(t,t.shape.length-1,!0);t=xr(t,n)}return t=Rr(t,An(),1-An()),rl(Gr(ot(r.toFloat(),Ea(t)),t.shape.length-1))})}function yg(r,t){return ue(function(){var e=uv(kq(r)).toInt(),n=(t=Rr(t,An(),1-An())).shape;return Ud(Rc(e,n[n.length-1]).reshape(n),t,!1)})}function m9(r,t){if(!Ge.arraysEqual(r.shape,t.shape))throw new re("logits and labels must have the same shape, but got shapes "+JSON.stringify(r.shape)+" and "+JSON.stringify(t.shape));return ue(function(){var e=t.relu(),n=t.abs().neg();return e.sub(t.mul(r)).add(n.exp().log1p())})}function Uv(r,t){return ue(function(){var e;return e=Rr(t,An(),1-An()),e=Ea(xr(e,Yn(1,e))),_n(m9(r,e),-1)})}function g9(r,t){return ue(function(){var e=Rr(r,An(),1),n=Rr(t,An(),1);return Gr(ot(r,Ea(xr(e,n))),-1)})}function v9(r,t){return ue(function(){var e=Ea(yt(An(),t));return _n(Yn(t,ot(r,e)),-1)})}function y_(r,t){return ue(function(){var e=vg(r,-1),n=vg(t,-1),i=ot(e,n);return rl(Gr(i,-1))})}var wg={meanSquaredError:al,meanAbsoluteError:Bv,meanAbsolutePercentageError:oh,meanSquaredLogarithmicError:c9,squaredHinge:h9,hinge:d9,categoricalHinge:p9,logcosh:f9,categoricalCrossentropy:Ud,sparseCategoricalCrossentropy:yg,binaryCrossentropy:Uv,kullbackLeiblerDivergence:g9,poisson:v9,cosineProximity:y_};function iw(r){if(typeof r=="string"){if(r in wg)return wg[r];var t="Unknown loss "+r;throw r.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss "+r+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new re(t)}return r}function w_(r,t){return ue(function(){var e=ot(.5,ci(t)),n=Ep(eh(t,e),r.dtype);return _n(il(r,n),-1)})}function b_(r,t){return ue(function(){return Ep(il(Bd(r,-1),Bd(t,-1)),"float32")})}function oO(r,t){return ue(function(){return Ra(r.equal(1),t.equal(1)).sum().cast("float32")})}function y9(r,t){return ue(function(){return Ra(r.equal(1),t.equal(0)).sum().cast("float32")})}function w9(r,t){return ue(function(){return Ra(r.equal(0),t.equal(1)).sum().cast("float32")})}function aO(r,t){return ue(function(){var e=oO(r,t),n=w9(r,t),i=e.add(n);return Ia(eh(i,0),e.div(i),0).cast("float32")})}function b9(r,t){return ue(function(){var e=oO(r,t),n=y9(r,t),i=e.add(n);return Ia(eh(i,0),e.div(i),0).cast("float32")})}function sO(r,t){return Uv(r,t)}function uO(r,t){return r.rank===t.rank&&(r=r.squeeze([r.rank-1])),(t=t.argMax(-1)).dtype!==r.dtype&&(t=t.asType(r.dtype)),il(r,t).asType("float32")}var x9=al,_9=al,E9=Bv,I9=Bv,C9=oh,S9=oh,x_=Ud,T9=y_,lO=yg,bg={binaryAccuracy:w_,categoricalAccuracy:b_,precision:aO,categoricalCrossentropy:x_,sparseCategoricalCrossentropy:lO,mse:x9,MSE:_9,mae:E9,MAE:I9,mape:C9,MAPE:S9,cosine:T9};function A9(r){if(typeof r=="string"&&r in bg)return bg[r];if(typeof r!="string"&&r!=null)return r;throw new re("Unknown metric "+r)}function sm(r){if(yo(r!==null,"Unknown LossOrMetricFn "+r),typeof r=="string")return r;for(var t=void 0,e=0,n=Object.keys(wg);e<n.length;e++){var i=n[e];if(wg[i]===r){t=i;break}}if(t!==void 0)return t;for(var o=0,a=Object.keys(bg);o<a.length;o++)if(i=a[o],bg[i]===r){t=i;break}return t!==void 0?t:r.name}function R9(r){var t={Adagrad:function(){return _u.adagrad(.01)},Adadelta:function(){return _u.adadelta(1,.95,An())},Adam:function(){return _u.adam(.001,.9,.999,An())},Adamax:function(){return _u.adamax(.002,.9,.999,An(),0)},RMSProp:function(){return _u.rmsprop(.001,.9,0,An())},SGD:function(){return _u.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,r in t)return t[r]();throw new re("Unknown Optimizer "+r)}var uT=1048576;function lT(r,t,e){if(e===void 0&&(e=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!p1(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){var n=JSON.stringify(r);n.length>uT&&console.warn('User-defined metadata of model "'+t+'" is too large in size (length='+n.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+uT+".")}}function p1(r){if(r===null)return!0;if(typeof r=="object"){if(Object.getPrototypeOf(r)===Object.prototype){for(var t=0,e=Object.keys(r);t<e.length;t++){var n=e[t];if(typeof n!="string"||!p1(r[n]))return!1}return!0}if(Array.isArray(r)){for(var i=0,o=r;i<o.length;i++)if(!p1(o[i]))return!1;return!0}return!1}var a=typeof r;return a==="string"||a==="number"||a==="boolean"}function k9(r,t,e,n){n===void 0&&(n=console.log);var i,o=D9(r),a=["Layer (type)","Output shape","Param #"];if(o?(t=t||65,e=e||[.45,.85,1]):(t=t||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(function(f){return Math.floor(t*f)})),!o)for(var s in a.push("Receives inputs"),i=[],r.nodesByDepth)i.push.apply(i,r.nodesByDepth[s]);n("_".repeat(t)),xg(a,e,n),n("=".repeat(t));for(var u=r.layers,c=0;c<u.length;++c)o?O9(u[c],e,n):P9(u[c],e,i,n),n((c===u.length-1?"=":"_").repeat(t));r.checkTrainableWeightsConsistency();var d=N9(r),p=gg(r.nonTrainableWeights);n("Total params: "+(d+p)),n("Trainable params: "+d),n("Non-trainable params: "+p),n("_".repeat(t))}function N9(r){return r.collectedTrainableWeights!=null?gg(r.collectedTrainableWeights):gg(r.trainableWeights)}function D9(r){var t=!0,e=[],n=[];for(var i in r.nodesByDepth)e.push(r.nodesByDepth[i]);for(var o=0,a=e;o<a.length;o++){var s=a[o];if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){t=!1;break}n.push.apply(n,s)}if(t)for(var u=0,c=r.layers;u<c.length;u++){for(var d=!1,p=0,f=c[u].inboundNodes;p<f.length;p++){var g=f[p];if(n.indexOf(g)!==-1){if(d){t=!1;break}d=!0}}if(!t)break}return t}function xg(r,t,e){e===void 0&&(e=console.log);for(var n="",i=0;i<r.length;++i)i>0&&(n=n.slice(0,n.length-1)+" "),n=(n+=r[i]).slice(0,t[i]),n+=" ".repeat(t[i]-n.length);e(n)}function O9(r,t,e){var n;try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}xg([r.name+" ("+r.getClassName()+")",n,r.countParams().toString()],t,e)}function P9(r,t,e,n){var i;try{i=JSON.stringify(r.outputShape)}catch{i="multiple"}for(var o=[],a=0,s=r.inboundNodes;a<s.length;a++){var u=s[a];if(!(e!=null&&e.length>0&&e.indexOf(u)===-1))for(var c=0;c<u.inboundLayers.length;++c){var d=u.inboundLayers[c].name,p=u.nodeIndices[c],f=u.tensorIndices[c];o.push(d+"["+p+"]["+f+"]")}}var g=r.name,y=r.getClassName(),x=o.length===0?"":o[0];for(xg([g+" ("+y+")",i,r.countParams().toString(),x],t,n),c=1;c<o.length;++c)xg(["","","",o[c]],t,n)}function cO(r,t,e){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&t===0&&typeof e=="string"}function jd(r,t){if(r===null)return null;if(typeof r=="string")return Cu(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var e=[],n=r.length,i=0;i<n;++i){var o=r[i];cO(t,i,o)?e.push(o):e.push(jd(o,t))}return e}for(var a={},s=0,u=Object.keys(r);s<u.length;s++){var c=u[s],d=r[c];if(c==="name"&&typeof d=="string")a[c]=d;else{var p=Cu(c);a[p]=jd(d,p)}}return a}function f1(r,t){if(r==null)return null;if(typeof r=="string")return oa(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var e=[],n=r.length,i=0;i<n;++i){var o=r[i];cO(t,i,o)?e.push(o):e.push(f1(o,t))}return e}for(var a={},s=0,u=Object.keys(r);s<u.length;s++){var c=u[s],d=r[c],p=oa(c);a[p]=c!=="name"&&c!=="className"||typeof d!="string"?f1(d,c):d}return a}var jv="1.3.1";function M9(r,t){if(r.dtype==null||r.dtype===t.dtype)return t;try{return tv(t,r.dtype)}catch{throw new re("The dtype of the feed ("+t.dtype+") can not be cast to the dtype of the key '"+r.name+"' ("+r.dtype+").")}}var lc=function(){function r(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof r)for(var e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(var n=0,i=t;n<i.length;n++){var o=i[n];this.add(o.key,o.value)}}}return r.prototype.add=function(t,e,n){if(this.id2Value[t.id]!=null)throw new re("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=M9(t,e),this.name2Id[t.name]=t.id,n!=null&&(this.id2Mask[t.id]=n),this},r.prototype.addFeed=function(t){this.add(t.key,t.value)},r.prototype.hasKey=function(t){return this.id2Value[t.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(t){if(t instanceof Xi){if(this.id2Value[t.id]==null)throw new re("Nonexistent key: "+t.name);return this.id2Value[t.id]}var e=this.name2Id[t];if(e==null)throw new re("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]},r.prototype.getMask=function(t){if(t instanceof Xi){if(this.id2Value[t.id]==null)throw new re("Nonexistent key: "+t.name);return this.id2Mask[t.id]}var e=this.name2Id[t];if(e==null)throw new re("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]},r.prototype.disposeMasks=function(){this.id2Mask!=null&&ft(this.id2Mask)},r}(),ow={},cT={};function ld(r,t,e,n){for(var i=e!=null&&e.training,o=Array.isArray(r),a=o?r:[r],s=a.map(function(J){return J.name}),u=[],c=t.names(),d=0,p=s;d<p.length;d++){var f=p[d];c.indexOf(f)!==-1?u.push(t.getValue(f)):u.push(null)}var g,y,x=s.join(",")+"|"+t.names().join(",");if(ow[x]==null){var b=L9(a,t);g=b.sorted,y=b.recipientCounts,ow[x]=g,cT[x]=y}g=ow[x],y={},i||Object.assign(y,cT[x]);for(var _=new lc(t),C=0;C<g.length;++C){var T=g[C],D=T.sourceLayer;if(!(D instanceof Sp)){for(var O=[],z=[],I=[],S=!1,A=0,N=T.inputs;A<N.length;A++){var P=N[A],M=_.getValue(P),F=_.getMask(P);O.push(M),z.push(F),F!=null&&(S=!0),i||(y[P.name]--,y[P.name]!==0||t.hasKey(P)||s.indexOf(P.name)!==-1||M.isDisposed||P.sourceLayer.stateful===!0||I.push(M))}S&&((e=e||{}).mask=z[0]);var G=Kt(D.apply(O,e)),Z=null;D.supportsMasking&&(Z=D.computeMask(O,z));for(var Y=z9(T),ee=Array.isArray(Y)?Y:[Y],H=0;H<ee.length;++H){_.hasKey(ee[H])||_.add(ee[H],G[H],Array.isArray(Z)?Z[0]:Z);var ie=s.indexOf(ee[H].name);ie!==-1&&(u[ie]=G[H])}i||ft(I)}}return _.disposeMasks(),o?u:u[0]}function L9(r,t){Ge.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var e=[],n={};if(r.length===1){var i=hT(r[0],t);e=i.sorted,n=i.recipientMap}else for(var o=new Set,a=0,s=r;a<s.length;a++){for(var u=hT(s[a],t),c=u.sorted,d=u.recipientMap,p=0,f=c;p<f.length;p++){var g=f[p];o.has(g.name)||(e.push(g),o.add(g.name))}var y=function(b){n[b]==null&&(n[b]=new Set),d[b].forEach(function(_){return n[b].add(_)})};for(var x in d)y(x)}return{sorted:e,recipientCounts:F9(n)}}function F9(r){var t={};for(var e in r)t[e]=r[e].size;return t}function hT(r,t){for(var e=new Set,n=[],i={},o=0,a=t.names();o<a.length;o++){var s=a[o];e.add(s)}var u=[],c=[];for(u.push(r);u.length>0;){var d=u[u.length-1];if(e.has(d.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(d.inputs.length===0||p)u.pop(),n.push(d),e.add(d.name),p&&c.pop();else{c.push(u.length-1);for(var f=0,g=d.inputs;f<g.length;f++){var y=g[f];i[y.name]==null&&(i[y.name]=new Set),i[y.name].add(d.name),e.has(y.name)||u.push(y)}}}}return{sorted:n,recipientMap:i}}function z9(r){var t;if(r.sourceLayer.inboundNodes.length===1)t=r.sourceLayer.output;else{for(var e=null,n=0;n<r.sourceLayer.inboundNodes.length;++n)for(var i=0,o=r.sourceLayer.inboundNodes[n].outputTensors;i<o.length;i++)if(o[i].id===r.id){e=n;break}t=r.sourceLayer.getOutputAt(e)}return t}var V9=function(r){function t(e){var n=r.call(this,{})||this;if(n.containerNodes=new Set,n.name=e.name,n.name==null){var i=n.getClassName().toLowerCase();n.name=zv(i)}if(n.supportsMasking=!1,n.trainable_=!0,Array.isArray(e.inputs)?n.inputs=e.inputs.slice():n.inputs=[e.inputs],Array.isArray(e.outputs)?n.outputs=e.outputs.slice():n.outputs=[e.outputs],xs(n.inputs).length!==n.inputs.length)throw new re("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+n.inputs.map(function(at){return at.name}));xs(n.outputs).length!==n.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+n.outputs.map(function(at){return at.name})),n.inputLayers=[],n.inputLayersNodeIndices=[],n.inputLayersTensorIndices=[],n.outputLayers=[],n.outputLayersNodeIndices=[],n.outputLayersTensorIndices=[],n.layers=[],n.internalContainerRefs=[];for(var o=0,a=n.outputs;o<a.length;o++){var s=(N=a[o]).sourceLayer,u=N.nodeIndex,c=N.tensorIndex;n.outputLayers.push(s),n.outputLayersNodeIndices.push(u),n.outputLayersTensorIndices.push(c)}for(var d=0,p=n.inputs;d<p.length;d++)s=(N=p[d]).sourceLayer,u=N.nodeIndex,c=N.tensorIndex,yo(u===0,"input layer has >1 nodes"),yo(c===0,"input layer has >1 tensors"),n.inputLayers.push(s),n.inputLayersNodeIndices.push(u),n.inputLayersTensorIndices.push(c);n.inputNames=[],n.outputNames=[],n.feedInputShapes=[],n.feedInputNames=[],n.feedOutputNames=[];for(var f=0;f<n.inputLayers.length;f++){if(!((s=n.inputLayers[f])instanceof Sp))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+e.inputs+". Input "+f+" (0-based) originates from layer type "+s.getClassName()+".");n.inputNames.push(s.name),n.feedInputShapes.push(s.batchInputShape),n.feedInputNames.push(s.name)}for(var g=0,y=n.outputLayers;g<y.length;g++)s=y[g],n.outputNames.push(s.name);n.internalInputShapes=n.inputs.map(function(at){return at.shape}),n.internalOutputShapes=n.outputs.map(function(at){return at.shape});for(var x={},b={},_={},C={},T={},D=[],O=function(at,En,Qt,bt,Lt,Dn){bt!=null&&Lt!=null&&Dn!=null||(bt=at.sourceLayer,Lt=at.nodeIndex,Dn=at.tensorIndex);var tn=bt.inboundNodes[Lt];if(Qt.indexOf(tn)!==-1)throw new xo("The tensor "+at.name+' at layer "'+bt.name+'" is part of a cycle.');if(En.indexOf(tn)===-1){n.containerNodes.add(t.nodeKey(bt,Lt)),bt.id in T||(T[bt.id]=Object.keys(T).length),Qt.indexOf(tn)===-1&&Qt.push(tn);for(var cr=tn.inboundLayers.length,Wn=0;Wn<cr;Wn++){var Ti=tn.inputTensors[Wn],zo=tn.inboundLayers[Wn],Vo=tn.nodeIndices[Wn],Ai=tn.tensorIndices[Wn];O(Ti,En,Qt,zo,Vo,Ai)}for(En.push(tn);Qt.indexOf(tn)>=0;)Qt.splice(Qt.indexOf(tn),1);D.push(tn)}},z=[],I=[],S=0,A=n.outputs;S<A.length;S++){var N=A[S];O(N,z,I)}for(var P=0,M=D.slice().reverse();P<M.length;P++){b[(et=M[P]).id]=et,et.id in x||(x[et.id]=0);var F=x[et.id],G=_[et.outboundLayer.id]==null?0:_[et.outboundLayer.id];for(F=Math.max(F,G),_[et.outboundLayer.id]=F,C[et.outboundLayer.id]=et.outboundLayer,x[et.id]=F,f=0;f<et.inboundLayers.length;f++){var Z=et.inboundLayers[f],Y=(u=et.nodeIndices[f],Z.inboundNodes[u]),ee=x[Y.id]==null?0:x[Y.id];x[Y.id]=Math.max(F+1,ee),b[Y.id]=Y}}var H={};for(var ie in x)(F=x[ie])in H||(H[F]=[]),H[F].push(b[ie]);var J={};for(var q in _)(F=_[q])in J||(J[F]=[]),J[F].push(C[q]);var ne=Object.keys(J).map(function(at){return parseInt(at,10)}).sort(im);n.layers=[];for(var me=0,Ce=ne;me<Ce.length;me++){var Te=J[F=Ce[me]];Te.sort(function(at,En){var Qt=T[at.id],bt=T[En.id];return Qt<bt?-1:Qt>bt?1:0});for(var Re=0,De=Te;Re<De.length;Re++)(s=De[Re])instanceof t&&n.internalContainerRefs.push(s),n.layers.push(s)}n.layersByDepth=J,ne=Object.keys(H).map(function(at){return parseInt(at,10)}).sort(im);for(var Oe=n.inputs.slice(),ze=[],ct=0,Ze=ne;ct<Ze.length;ct++)for(var wt=0,ht=H[F=Ze[ct]];wt<ht.length;wt++){var et;if((s=(et=ht[wt]).outboundLayer)!=null){for(var Dt=0,_t=et.inputTensors;Dt<_t.length;Dt++)if(N=_t[Dt],Oe.indexOf(N)===-1)throw new xo("Graph disconnected: cannot obtain value for tensor "+N+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+ze);for(var vn=0,lr=et.outputTensors;vn<lr.length;vn++)N=lr[vn],Oe.push(N);ze.push(s.name)}}n.nodesByDepth=H;for(var dn=n.layers.map(function(at){return at.name}),sn=function(at){var En=dn.filter(function(Qt){return Qt===at}).length;if(En!==1)throw new xo('The name "'+at+'" is used '+En+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(dn))},Ht=0,jn=dn;Ht<jn.length;Ht++)sn(jn[Ht]);return n.outboundNodes=[],n.inboundNodes=[],new Vv({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:n.inputs,outputTensors:n.outputs,inputMasks:n.inputs.map(function(at){return null}),outputMasks:n.outputs.map(function(at){return null}),inputShapes:n.inputs.map(function(at){return at.shape}),outputShapes:n.outputs.map(function(at){return at.shape})}),n.built=!0,n._refCount=1,n}return ge(t,r),t.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var n=0,i=this.layers;n<i.length;n++){var o=i[n];e.numDisposedVariables+=o.dispose().numDisposedVariables}for(var a=0,s=this.internalContainerRefs;a<s.length;a++){var u=s[a];e.numDisposedVariables+=u.dispose().numDisposedVariables}}return e.refCountAfterDispose=this._refCount,e},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.layers.forEach(function(n){n._trainableWeights.forEach(function(i){return i.trainable=e})}),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new re("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],n=0,i=this.layers;n<i.length;n++){var o=i[n];e=e.concat(o.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],n=0,i=this.layers;n<i.length;n++){var o=i[n];e.push.apply(e,o.nonTrainableWeights)}if(!this.trainable){for(var a=[],s=0,u=this.layers;s<u.length;s++)o=u[s],a.push.apply(a,o.trainableWeights);return a.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.loadWeights=function(e,n){n===void 0&&(n=!0);for(var i={},o=0,a=0,s=this.layers;a<s.length;a++)for(var u=0,c=s[a].weights;u<c.length;u++){var d=c[u];if(i[d.originalName]!=null)throw new re("Duplicate weight name: "+d.originalName);i[d.originalName]=d,o++}var p=[];for(var f in e){if(i[f]!=null)p.push([i[f],e[f]]);else if(n)throw new re("Provided weight data has no target variable: "+f);delete i[f]}if(n){var g=[];for(var y in i)g.push(y);if(g.length>0)throw new re(g.length+" of "+o+" weights are not set: "+g)}v_(p)},t.prototype.updatedConfig=function(){var e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion="tfjs-layers "+jv,n.backend="TensorFlow.js",n},t.prototype.toJSON=function(e,n){n===void 0&&(n=!0);var i=f1(this.updatedConfig());return n?JSON.stringify(i):i},t.prototype.call=function(e,n){var i=this;return ue(function(){e=Kt(e);for(var o=new lc,a=0;a<i.inputs.length;++a)o.add(i.inputs[a],e[a]);return ld(i.outputs,o,n)})},t.prototype.computeMask=function(e,n){var i=this;return ue(function(){var o;return e=Kt(e),o=n==null?$u(null,e.length):Kt(n),i.runInternalGraph(e,o)[1]})},t.prototype.computeOutputShape=function(e){var n=mg(e);if(n.length!==this.inputLayers.length)throw new re("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var i={},o=0;o<n.length;o++){var a=this.inputLayers[o],s=n[o];i[A=a.name+"_0_0"]=s}var u=Object.keys(this.nodesByDepth).map(function(P){return parseInt(P,10)}).sort(im);if(u.length>1)for(var c=0,d=u;c<d.length;c++)for(var p=d[c],f=0,g=this.nodesByDepth[p];f<g.length;f++){var y=g[f];if(a=y.outboundLayer,this.inputLayers.map(function(P){return P.id}).indexOf(a.id)===-1){for(var x=[],b=0;b<y.inboundLayers.length;b++){var _=y.inboundLayers[b],C=y.nodeIndices[b],T=y.tensorIndices[b],D=i[A=_.name+"_"+C+"_"+T];x.push(D)}var O=mg(a.computeOutputShape(Sr(x))),z=a.inboundNodes.indexOf(y);for(b=0;b<O.length;b++)i[A=a.name+"_"+z+"_"+b]=O[b]}}var I=[],S=[];for(o=0;o<this.outputLayers.length;o++){a=this.outputLayers[o],z=this.outputLayersNodeIndices[o],T=this.outputLayersTensorIndices[o];var A=a.name+"_"+z+"_"+T;S.push(A)}for(o=0;o<S.length;o++){var N=S[o];yo(N in i),I.push(i[N])}return Sr(I)},t.prototype.runInternalGraph=function(e,n){n==null&&(n=$u(null,e.length));for(var i={},o=0;o<this.inputs.length;++o){var a=this.inputs[o],s=e[o],u=n[o];i[a.id]=[s,u]}for(var c=0,d=Object.keys(this.nodesByDepth).map(function(J){return parseInt(J,10)}).sort(im);c<d.length;c++)for(var p=d[c],f=0,g=this.nodesByDepth[p];f<g.length;f++){for(var y=g[f],x=y.outboundLayer,b=y.inputTensors,_=y.outputTensors,C=new Array,T=0,D=b;T<D.length;T++)(a=D[T]).id in i&&C.push(i[a.id]);if(C.length===b.length){var O={},z=void 0,I=void 0,S=void 0,A=void 0;if(y.callArgs!=null&&(O=y.callArgs),C.length===1){var N=C[0],P=N[0],M=N[1];O.mask==null&&(O.mask=M),S=Kt(x.call(P,O)),A=Kt(x.computeMask(P,M)),z=[P],I=[M]}else z=C.map(function(J){return J[0]}),I=C.map(function(J){return J[1]}),O.mask==null&&(O.mask=I),S=Kt(x.call(z,O)),A=Kt(x.computeMask(z,I));if(x.activityRegularizer)throw new mt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(o=0;o<_.length;++o)a=_[o],s=S[o],u=A[o],i[a.id]=[s,u]}}for(var F=[],G=[],Z=[],Y=0,ee=this.outputs;Y<ee.length;Y++){yo((a=ee[Y]).id in i,"Could not compute output "+a.name+" : "+a.id);var H=i[a.id],ie=H[0];u=H[1],Z.push(ie.shape),F.push(ie),G.push(u)}return[F,G,Z]},t.prototype.buildNodeConversionMap=function(e){for(var n,i={},o=0,a=this.layers;o<a.length;o++){var s=a[o];n=s instanceof t?1:0;for(var u=0;u<s.inboundNodes.length;u++){var c=t.nodeKey(s,u);this.containerNodes.has(c)&&(i[c]=n,n+=1)}}return i},t.prototype.getLayer=function(e,n){if(n!=null){if(this.layers.length<=n)throw new re("Was asked to retrieve layer at index "+n+", but model only has "+this.layers.length+" layer(s).");return this.layers[n]}if(e==null)throw new re("Provide either a layer name or layer index");for(var i=0,o=this.layers;i<o.length;i++){var a=o[i];if(a.name===e)return a}throw new re("No such layer: "+e)},t.prototype.calculateLosses=function(){var e=this;return ue(function(){for(var n=[],i=0,o=e.layers;i<o.length;i++)for(var a=o[i],s=0;s<a.inboundNodes.length;++s){var u=t.nodeKey(a,s);e.containerNodes.has(u)&&n.push.apply(n,a.calculateLosses())}return n})},t.prototype.getConfig=function(){for(var e={name:this.name},n=this.buildNodeConversionMap(this.layers),i=[],o=0,a=this.layers;o<a.length;o++){for(var s=(O=a[o]).getClassName(),u=O.getConfig(),c=[],d=0;d<O.inboundNodes.length;d++){var p=O.inboundNodes[d],f=t.nodeKey(O,d),g={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),g=p.callArgs}catch{console.warn("Layer "+O.name+" was passed non-serializable keyword arguments: "+p.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),g={}}if(p.inboundLayers.length>0){for(var y=[],x=0;x<p.inboundLayers.length;x++){var b=p.inboundLayers[x],_=p.nodeIndices[x],C=p.tensorIndices[x];(I=n[t.nodeKey(b,_)])==null&&(I=0),y.push([b.name,I,C,g])}c.push(y)}}}var T={};T.name=O.name,T.className=s,T.config=u,T.inboundNodes=c,i.push(T)}e.layers=i;var D=[];for(x=0;x<this.inputLayers.length;x++){var O=this.inputLayers[x];_=this.inputLayersNodeIndices[x],f=t.nodeKey(O,_),this.containerNodes.has(f)&&((I=n[f])!==null&&I!==void 0||(I=0),C=this.inputLayersTensorIndices[x],D.push([O.name,I,C]))}e.inputLayers=D;var z=[];for(x=0;x<this.outputLayers.length;x++)if(O=this.outputLayers[x],_=this.outputLayersNodeIndices[x],f=t.nodeKey(O,_),this.containerNodes.has(f)){var I;(I=n[f])!==null&&I!==void 0||(I=0),C=this.outputLayersTensorIndices[x],z.push([O.name,I,C])}return e.outputLayers=z,e},t.fromConfig=function(e,n,i,o){o===void 0&&(o=!1);var a={},s={};function u(Y,ee){Y.name in s?s[Y.name].push(ee):s[Y.name]=[ee]}function c(Y,ee){for(var H,ie=[],J=0,q=ee;J<q.length;J++){var ne=q[J],me=ne[0],Ce=ne[1],Te=ne[2];if(H=ne[3]==null?{}:ne[3],!(me in a))return void u(Y,ee);var Re=a[me];if(Re.inboundNodes.length<=Ce)return void u(Y,ee);var De=Re.inboundNodes[Ce];ie.push(De.outputTensors[Te])}ie.length>0&&Y.apply(Sr(ie),H)}function d(Y){var ee=Y.name,H=Qi(Y,n.customObjects!=null?n.customObjects:{});H.setFastWeightInitDuringBuild(o),a[ee]=H,Y.inboundNodes.forEach(function(ie){if(!(ie instanceof Array))throw new re("Corrupted configuration, expected array for nodeData: "+ie);u(H,ie)})}for(var p=n.name,f=n.layers,g=0,y=f;g<y.length;g++)d(_=y[g]);for(;!mq(s);)for(var x=0,b=f;x<b.length;x++){var _=b[x];if((Z=a[_.name]).name in s){var C=s[Z.name];delete s[Z.name];for(var T=0,D=C;T<D.length;T++)c(Z,D[T])}}for(var O=[],z=[],I=0,S=n.inputLayers;I<S.length;I++){var A=(_=S[I])[0],N=_[1],P=_[2];yo(A in a);var M=(Z=a[A]).inboundNodes[N].outputTensors;O.push(M[P])}for(var F=0,G=n.outputLayers;F<G.length;F++){A=(_=G[F])[0],N=_[1],P=_[2],yo(A in a);var Z;M=(Z=a[A]).inboundNodes[N].outputTensors,z.push(M[P])}return new e({inputs:O,outputs:z,name:p})},Object.defineProperty(t.prototype,"stateful",{get:function(){if(this._stateful)throw new re("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,n=this.layers;e<n.length;e++)if(n[e].stateful)return!0;return!1},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){var e=this;ue(function(){e.layers.forEach(function(n){n.stateful&&n.resetStates()})})},t}(St);function B9(r,t,e){var n=t.length;if(r==null||Array.isArray(r)&&r.length===0)return t.map(function(o){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&t[0]in r?[r[t[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided "+e+" is an array of "+r.length+" element(s), but the model has "+n+" outputs. Make sure a set of weights is provided for each model output.");return r}if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var i=[];return t.forEach(function(o){o in r?i.push(r[o]):i.push(null)}),i}throw new Error("The model has multiple ("+n+") outputs, so "+e+" must be either an array with "+n+" elements or an object with "+t+" keys. Provided "+e+" not understood: "+JSON.stringify(r))}function hO(r,t){return B9(r,t,"classWeight")}function dO(r,t,e,n){return rt(this,void 0,void 0,function(){var i,o,a,s,u;return Ye(this,function(c){switch(c.label){case 0:return e==null?[3,2]:(i=ue(function(){if(r.shape.length===1)return r.clone();if(r.shape.length===2){if(r.shape[1]>1)return r.argMax(1);if(r.shape[1]===1)return r.reshape([r.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+r.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+r.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),s=(a=Array).from,[4,i.data()]);case 1:return o=s.apply(a,[c.sent()]),ft(i),u=[],o.forEach(function(d){if(e[d]==null)throw new Error("classWeight must contain all classes in the training data. The class "+d+" exists in the data but not in classWeight");u.push(e[d])}),[2,$r(u,"float32")];case 2:return[2,null]}})})}function U9(r,t){return ot(r,t)}var j9=32;function pO(r,t){var e,n,i=t;e=i.xs,n=i.ys,Ge.assert(e!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t});var o=dT("input",r.inputNames,e),a=dT("output",r.outputNames,n),s=o[0].shape[0];Ge.assert(o.length===r.inputs.length,function(){return"LayersModel has "+r.inputs.length+" inputs, but the dataset provides "+o.length+" inputs.  (Expected input keys: "+JSON.stringify(r.inputNames)+")"}),Ge.assert(a.length===r.outputs.length,function(){return"LayersModel has "+r.outputs.length+" outputs, but the dataset provides "+a.length+" outputs.  (Expected output keys: "+JSON.stringify(r.outputNames)+")"});var u=function(f){Ge.assert(o[f].shape[0]===s,function(){return"Batch size mismatch: input "+r.inputNames[f]+" has "+o[f].shape[0]+"; expected  "+s+" based on input "+r.inputNames[0]+"."})};for(var c in o)u(c);var d=function(f){Ge.assert(a[f].shape[0]===s,function(){return"Batch size mismatch: output "+r.outputNames[f]+" has "+a[f].shape[0]+"; expected  "+s+" based on input "+r.inputNames[0]+"."})};for(var p in a)d(p);return{xs:o,ys:a}}function dT(r,t,e){if(e instanceof Ut)return[e];if(Array.isArray(e))return Ge.assert(e.length===t.length,function(){return"Received an array of "+e.length+" Tensors, but expected "+t.length+" to match the "+r+" keys "+t+"."}),e;for(var n=[],i=0,o=t;i<o.length;i++){var a=o[i];if(e[a]==null)throw new re("The feature data generated by the dataset lacks the required "+r+" key '"+a+"'.");n.push(e[a])}return n}function W9(r){if(r.length===3)throw new mt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function q9(r,t,e){return rt(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p,f,g,y,x,b,_,C,T,D,O,z,I,S,A,N,P,M,F,G,Z,Y,ee,H,ie,J;return Ye(this,function(q){switch(q.label){case 0:if(n=e.batchesPerEpoch!=null,Ge.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),Ge.assert(e!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),Ge.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+e.epochs}),Ge.assert(!n||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+e.batchesPerEpoch}),Ge.assert(e.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,q.label=1;case 1:return q.trys.push([1,,26,27]),i=e.validationData!=null,o=void 0,a=void 0,i&&(pT(e.validationData)?Ge.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+e.validationBatches}):(s=W9(e.validationData),o=s.xs,a=s.ys)),u=r.makeTrainFunction(),c=r.getDedupedMetricsNames(),d=void 0,d=i?c.slice().concat(c.map(function(ne){return"val_"+ne})):c.slice(),p=nO(e.callbacks,e.yieldEvery),f=e.verbose==null?1:e.verbose,g=iO(p,f,e.epochs,null,null,H9(t,e),null,i,d),y=g.callbackList,x=g.history,y.setModel(r),r.history=x,[4,y.onTrainBegin()];case 2:return q.sent(),r.stopTraining_=!1,b=e.initialEpoch==null?0:e.initialEpoch,[4,t.iterator()];case 3:_=q.sent(),q.label=4;case 4:return b<e.epochs?(C={},[4,y.onEpochBegin(b)]):[3,23];case 5:return q.sent(),T=0,D=0,n?[3,7]:[4,t.iterator()];case 6:_=q.sent(),q.label=7;case 7:return!n||T<e.batchesPerEpoch?[4,_.next()]:[3,21];case 8:return O=q.sent(),n&&O.done?(console.warn("You provided `batchesPerEpoch` as "+e.batchesPerEpoch+", but your dataset iterator ran out of data after "+T+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+e.batchesPerEpoch*e.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):O.value==null?[3,15]:(z=pO(r,O.value),I=z.xs,S=z.ys,(A={}).batch=D,A.size=I[0].shape[0],[4,y.onBatchBegin(D,A)]);case 9:if(q.sent(),N=[],e.classWeight==null)return[3,13];P=hO(e.classWeight,r.outputNames),J=0,q.label=10;case 10:return J<P.length?(F=(M=N).push,[4,dO(S[J],null,P[J])]):[3,13];case 11:F.apply(M,[q.sent()]),q.label=12;case 12:return++J,[3,10];case 13:for(G=I.concat(S).concat(N),Z=u(G),ft(G),J=0;J<c.length;++J)Y=c[J],ee=Z[J],A[Y]=ee,No(ee);return[4,y.onBatchEnd(D,A)];case 14:q.sent(),JD(A),D++,T++,q.label=15;case 15:return(n?T>=e.batchesPerEpoch:O.done)?i?(H=void 0,pT(e.validationData)?(ie=Kt,[4,r.evaluateDataset(e.validationData,{batches:e.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return H=ie.apply(void 0,[q.sent()]),[3,18];case 17:H=Kt(r.evaluate(o,a,{batchSize:e.validationBatchSize==null?j9:e.validationBatchSize,verbose:0})),q.label=18;case 18:for(J=0;J<r.metricsNames.length;++J)C["val_"+r.metricsNames[J]]=H[J];q.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,y.onEpochEnd(b,C)];case 22:return q.sent(),b++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,y.onTrainEnd()];case 24:return q.sent(),[4,r.history.syncData()];case 25:return q.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function H9(r,t){var e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(r.size)&&(e=r.size),e}function pT(r){return typeof r.iterator=="function"}function $9(r){return typeof r.next=="function"}function G9(r,t,e){return rt(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p,f;return Ye(this,function(g){switch(g.label){case 0:if(n=(e=e||{}).batches!=null,i=r.testFunction,o=[],e.verbose>0)throw new mt("Verbose mode is not implemented yet.");return Ge.assert(!n||e.batches>0&&Number.isInteger(e.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(e.batches)}),$9(t)?(s=t,[3,3]):[3,1];case 1:return[4,t.iterator()];case 2:s=g.sent(),g.label=3;case 3:a=s,u=0,c=0,d=function(){var y;return Ye(this,function(x){switch(x.label){case 0:return[4,a.next()];case 1:return y=x.sent(),o=ue(function(){if(y.value){var b=pO(r,y.value),_=b.xs,C=b.ys,T=_.concat(C),D=ue(function(){return i(T)});if(ft(T),c===0)for(var O=0;O<D.length;++O)o.push(Ve(0));var z=T[0].shape[0],I=function(S){var A=D[S],N=o[S];o[S]=ue(function(){return yt(o[S],ot(z,A))}),c>0&&ft(N)};for(O=0;O<D.length;++O)I(O);ft(D),u+=z,++c}return o}),y.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+e.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},g.label=4;case 4:return!n||c<e.batches?[5,d()]:[3,6];case 5:return g.sent()==="break"?[3,6]:[3,4];case 6:for(p=0;p<o.length;++p)f=o[p],o[p]=xr(o[p],u),ft(f);return[2,Sr(o)]}})})}function m1(r){Ge.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got "+r})}function cd(r,t,e){return r==null?[null]:Array.isArray(r)?r.map(function(n){return Fu(n,t,e-t)}):Fu(r,t,e-t)}function __(r,t){return ue(function(){return r==null?null:Array.isArray(r)?r.map(function(e){return __(e,t)}):VD(r,t.dtype==="int32"?t:t.toInt())})}function g1(r,t){for(var e=[],n=0,i=null;n<r;)(i=n+t)>=r&&(i=r),e.push([n,i]),n=i;return e}function K9(r,t,e,n,i,o,a,s,u,c,d,p,f,g,y){return rt(this,void 0,void 0,function(){var x,b,_,C,T,D,O,z;return Ye(this,function(I){switch(I.label){case 0:return i==null&&(i=32),o==null&&(o=1),d==null&&(d=!0),f==null&&(f=0),x=!1,u!=null&&c!=null&&(x=!0),y!=null,(b=r.checkNumSamples(e,i,g,"steps_per_epoch"))!=null&&(_=eo(0,b)),a==null&&(a=1),C=iO(s,a,o,f,b,g,i,x,p),T=C.callbackList,D=C.history,T.setModel(r),r.history=D,[4,T.onTrainBegin()];case 1:I.sent(),r.stopTraining_=!1,O=function(S){var A,N,P,M,F;return Ye(this,function(G){switch(G.label){case 0:return[4,T.onEpochBegin(S)];case 1:if(G.sent(),A={},g==null)return[3,2];case 2:if(d==="batch")throw new mt("batch shuffling is not implemneted yet");d&&Ge.shuffle(_),N=$r(_),P=g1(b,i),M=function(Z){var Y;return Ye(this,function(ee){switch(ee.label){case 0:return Y={},[4,T.onBatchBegin(Z,Y)];case 1:return ee.sent(),ue(function(){var H=P[Z][0],ie=P[Z][1],J=Fu(N,H,ie-H);Y.batch=Z,Y.size=ie-H;for(var q=__(e,J),ne=t(q),me=0;me<n.length;++me){var Ce=n[me],Te=ne[me];Y[Ce]=Te,No(Te)}if(Z===P.length-1&&x){var Re=r.testLoop(u,c,i);for(me=0;me<n.length;++me)Ce=n[me],Te=Re[me],No(Te),A["val_"+Ce]=Te}}),[4,T.onBatchEnd(Z,Y)];case 2:return ee.sent(),JD(Y),r.stopTraining_?[2,"break"]:[2]}})},F=0,G.label=3;case 3:return F<P.length?[5,M(F)]:[3,6];case 4:if(G.sent()==="break")return[3,6];G.label=5;case 5:return++F,[3,3];case 6:N.dispose(),G.label=7;case 7:return[4,T.onEpochEnd(S,A)];case 8:return G.sent(),r.stopTraining_?[2,"break"]:[2]}})},z=f,I.label=2;case 2:return z<o?[5,O(z)]:[3,5];case 3:if(I.sent()==="break")return[3,5];I.label=4;case 4:return++z,[3,2];case 5:return[4,T.onTrainEnd()];case 6:return I.sent(),[4,r.history.syncData()];case 7:return I.sent(),[2,r.history]}})})}function X9(r,t,e,n){return n===void 0&&(n={}),rt(this,void 0,void 0,function(){var i,o,a,s,u,c,d,p,f,g,y,x,b,_,C,T,D,O,z,I,S,A;return Ye(this,function(N){switch(N.label){case 0:if(r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,N.label=1;case 1:return N.trys.push([1,,7,8]),m1(p=n.batchSize==null?32:n.batchSize),f=!1,[4,r.standardizeUserData(t,e,n.sampleWeight,n.classWeight,f,p)];case 2:if(g=N.sent(),i=g[0],o=g[1],d=g[2],y=!1,x=void 0,!(n.validationData!=null&&n.validationData.length>0))return[3,4];if(y=!0,n.validationData.length!==2)throw n.validationData.length===3?new mt("validationData including sample weights is not supported yet."):new re("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+n.validationData+" is invalid.");return a=n.validationData[0],s=n.validationData[1],b=!0,[4,r.standardizeUserData(a,s,null,null,b,p)];case 3:return _=N.sent(),u=_[0],c=_[1],x=u.concat(c),[3,5];case 4:n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1?(y=!0,C=Math.floor(i[0].shape[0]*(1-n.validationSplit)),T=i[0].shape[0],u=cd(i,C,T),i=cd(i,0,C),c=cd(o,C,T),o=cd(o,0,C),x=u.concat(c)):n.validationSteps!=null&&(y=!0),N.label=5;case 5:return D=i.concat(o).concat(d),r.checkTrainableWeightsConsistency(),O=r.makeTrainFunction(),z=r.getDedupedMetricsNames(),I=void 0,S=void 0,y?(r.makeTestFunction(),I=r.testFunction,S=z.slice().concat(z.map(function(P){return"val_"+P}))):(I=null,x=[],S=z.slice()),A=nO(n.callbacks,n.yieldEvery),[4,K9(r,O,D,z,p,n.epochs,n.verbose,A,I,x,n.shuffle,S,n.initialEpoch,null,null)];case 6:return[2,N.sent()];case 7:return r.isTraining=!1,ku(i,t),ku(o,e),ku(u,a),ku(c,s),d!=null&&ft(d),[7];case 8:return[2]}})})}function fO(r){var t=[];r instanceof Ut&&(r=[r]);for(var e=0;e<r.length;++e){var n=r[e];if(n.rank===1)t.push(Ip(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(n)}}return t}function ku(r,t){if(r!=null){var e=[];if(t instanceof Ut)e.push(t.id);else if(Array.isArray(t))t.forEach(function(u){return e.push(u.id)});else if(t!=null)for(var n in t){var i=t[n];e.push(i.id)}var o=[];if(r instanceof Ut)e.indexOf(r.id)===-1&&o.push(r);else if(Array.isArray(r))r.forEach(function(u){e.indexOf(u.id)===-1&&o.push(u)});else if(r!=null)for(var a in r){var s=r[a];e.indexOf(s.id)===-1&&o.push(s)}o.forEach(function(u){u.isDisposed||u.dispose()})}}function Q9(r){return r instanceof Ut}function v1(r){return Array.isArray(r)}function fT(r){return!Q9(r)&&!v1(r)}function mT(r,t,e,n,i){if(i===void 0&&(i=""),t==null||t.length===0){if(r!=null){var o=!1;if(v1(r)&&r.length>0)o=!0;else if(fT(r)){for(var a in r)if(r.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new re("Error when checking model "+i+" expected no data, but got "+r)}return[]}if(r==null)return t.map(function(b){return null});var s;if(fT(r)){r=r,s=[];for(var u=0,c=t;u<c.length;u++){var d=c[u];if(r[d]==null)throw new re('No data provided for "'+d+'". Need data for each key in: '+t);s.push(r[d])}}else if(v1(r)){if((r=r).length!==t.length)throw new re("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+r);s=r}else{if(r=r,t.length>1)throw new re("The model "+i+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+r.shape);s=[r]}if(s=fO(s),e!=null){for(var p=0;p<t.length;++p)if(e[p]!=null){var f=s[p];if(f.shape.length!==e[p].length)throw new re("Error when checking "+i+": expected "+t[p]+" to have "+e[p].length+" dimension(s). but got array with shape "+f.shape);for(var g=0;g<e[p].length;++g)if(g!==0||n){var y=f.shape[g],x=e[p][g];if(x!=null&&x>=0&&y!==x)throw new re("Error when checking "+i+": expected "+t[p]+" to have shape ["+e[p]+"], but got array with shape ["+f.shape+"].")}}}return s}function Y9(r,t,e){var n=xs(r.map(function(o){return o.shape[0]}));n.sort();var i=xs(t.map(function(o){return o.shape[0]}));if(i.sort(),n.length>1)throw new re("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(r.map(function(o){return o.shape})));if(i.length>1)throw new re("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(o){return o.shape})));if(n.length>0&&i.length>0&&!Ge.arraysEqual(n,i))throw new re("Input Tensors should have the same number of samples as target Tensors. Found "+n[0]+" input sample(s) and "+i[0]+" target sample(s).")}function J9(r,t,e){for(var n=[al,Uv,Ud],i=0;i<r.length;++i){var o=r[i],a=t[i],s=e[i];if(a!=null){if(a===Ud&&o.shape[o.shape.length-1]===1)throw new re("You are passing a target array of shape "+o.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(a)!==-1)for(var u=o.shape.slice(1),c=s.slice(1),d=0;d<u.length;++d){var p=u[d],f=c[d];if(f!=null&&p!==f)throw new re("A target Tensor with shape "+o.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}function gT(r,t,e,n,i){var o;if(n===void 0&&(n=!0),i===void 0&&(i=""),Array.isArray(r)){if(r.length!==t.length)throw new re("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+r.length+" Tensors(s).");o=r}else{if(t.length>1)throw new re("The model expects "+t.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(r.shape)+".");o=[r]}if(e!=null){for(var a=0;a<t.length;++a)if(e[a]!=null){var s=o[a];if(s.shape.length!==e[a].length)throw new re("Error when checking "+i+": expected "+t[a]+" to have "+e[a].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<e[a].length;++u)if(u!==0||n){var c=s.shape[u],d=e[a][u];if(d!=null&&d!==c)throw new re("Error when checking "+i+": expected "+t[a]+" to have shape "+JSON.stringify(e[a])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}}function Z9(r,t){if(r==null||Array.isArray(r)&&r.length===0)return t.map(function(u){return[]});var e;if(typeof r=="string"||typeof r=="function")e=[r];else{if(!Array.isArray(r)&&typeof r!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+r);e=r}if(Array.isArray(e))return t.map(function(u){return e});for(var n=[],i=0,o=t;i<o.length;i++){var a=o[i],s=e.hasOwnProperty(a)?e[a]:[];Array.isArray(s)||(s=[s]),n.push(s)}return n}var eH="layers-model",zu=function(r){function t(e){var n=r.call(this,e)||this;return n.isTraining=!1,n}return ge(t,r),t.prototype.summary=function(e,n,i){if(i===void 0&&(i=console.log),!this.built)throw new re("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");k9(this,e,n,i)},t.prototype.compile=function(e){var n=this;if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=R9(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Na))throw new re("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var i=[];if(Array.isArray(e.loss)||typeof e.loss=="string"||typeof e.loss=="function")if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new re("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var o=e.loss;i=o.map(function(b){return iw(b)})}else{var a=iw(e.loss);this.outputs.forEach(function(b){i.push(a)})}else{for(var s in e.loss=e.loss,e.loss)if(this.outputNames.indexOf(s)===-1)throw new re('Unknown entry in loss dictionary: "'+s+'". Only expected the following keys: '+this.outputNames);for(var u=0,c=this.outputNames;u<c.length;u++){var d=c[u];e.loss[d]==null&&console.warn('Output "'+d+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+d+" during training"),i.push(iw(e.loss[d]))}}this.lossFunctions=i,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var p=0;p<this.outputs.length;++p){var f=this.internalOutputShapes[p],g=this.outputNames[p];this.feedOutputNames.push(g),this.feedOutputShapes.push(f),this.feedLossFns.push(this.lossFunctions[p])}var y=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Lu("loss",function(){for(var b=0;b<n.outputs.length;++b)if(y.indexOf(b)===-1){var _=n.lossFunctions[b];n.outputs.length>1&&(n.metricsTensors.push([_,b]),n.metricsNames.push(n.outputNames[b]+"_loss"))}});var x=Z9(e.metrics,this.outputNames);Lu("metric",function(){for(var b=function(C){if(y.indexOf(C)!==-1)return"continue";(function(T){for(var D,O,z,I=function(N){if(typeof N=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(N)!==-1){var P=n.internalOutputShapes[C];P[P.length-1]===1||n.lossFunctions[C]===Uv?["accuracy","acc"].indexOf(N)!==-1?O=w_:["crossentropy","ce"].indexOf(N)!==-1&&(O=sO):n.lossFunctions[C]===yg?["accuracy","acc"].indexOf(N)!==-1?O=uO:["crossentropy","ce"].indexOf(N)!==-1&&(O=lO):["accuracy","acc"].indexOf(N)!==-1?O=b_:["crossentropy","ce"].indexOf(N)!==-1&&(O=x_);var M=void 0;["accuracy","acc"].indexOf(N)!==-1?M="acc":["crossentropy","ce"].indexOf(N)!==-1&&(M="ce"),z=O,D=""+M}else{var F=A9(N);z=F,D=""+sm(N)}var G;Lu(D,function(){G=z}),function(Z,Y,ee){n.outputNames.length>1&&(Y=n.outputNames[Z]+"_"+Y),n.metricsNames.push(Y),n.metricsTensors.push([ee,Z])}(C,D,G)},S=0,A=T;S<A.length;S++)I(A[S])})(x[C])},_=0;_<n.outputs.length;++_)b(_)}),this.collectedTrainableWeights=this.trainableWeights},t.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},t.prototype.evaluate=function(e,n,i){i===void 0&&(i={});var o=i.batchSize==null?32:i.batchSize;m1(o);var a=this.standardizeUserDataXY(e,n,!0,o);try{var s=a[0].concat(a[1]);this.makeTestFunction();var u=this.testFunction;return Sr(this.testLoop(u,s,o,i.verbose,i.steps))}finally{ku(a[0],e),ku(a[1],n)}},t.prototype.evaluateDataset=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){return this.makeTestFunction(),[2,G9(this,e,n)]})})},t.prototype.checkNumSamples=function(e,n,i,o){var a;if(o===void 0&&(o="steps"),i!=null){if(a=null,n!=null)throw new re("If "+o+" is set, batchSize must be null or undefined.Got batchSize = "+n)}else{if(e==null)throw new re("Either the input data should have a defined shape, or "+o+" shoud be specified.");a=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return a},t.prototype.execute=function(e,n){if(Array.isArray(n)&&n.length===0)throw new re("`outputs` is an empty Array, which is not allowed.");var i=Array.isArray(n),o=i?n:[n],a=this.retrieveSymbolicTensors(o),s=new lc;if(e instanceof Ut&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new re("The number of inputs provided ("+e.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var u=0;u<this.inputs.length;++u)s.add(this.inputs[u],e[u])}else for(var c=0,d=this.inputs;c<d.length;c++){var p=d[c],f=e[p.name];if(f==null)throw new re("No value is provided for the model's input "+p.name);s.add(p,f)}var g=ld(a,s);return i?g:g[0]},t.prototype.retrieveSymbolicTensors=function(e){for(var n=$u(null,e.length),i=e.length,o=0,a=this.layers;o<a.length;o++){for(var s=a[o],u=Array.isArray(s.output)?s.output:[s.output],c=u.map(function(g){return g.name}),d=0;d<e.length;++d){var p=c.indexOf(e[d]);if(p!==-1&&(n[d]=u[p],i--),i===0)break}if(i===0)break}if(i>0){var f=[];throw n.forEach(function(g,y){g==null&&f.push(e[y])}),new re("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(f))}return n},t.prototype.predictLoop=function(e,n,i){var o=this;return n===void 0&&(n=32),i===void 0&&(i=!1),ue(function(){var a=o.checkNumSamples(e);if(i)throw new mt("Verbose predictLoop() is not implemented yet.");for(var s=g1(a,n),u=o.outputs.map(function(p){return[]}),c=function(p){ue(function(){var f=s[p][0],g=s[p][1],y=cd(e,f,g),x=[];if(Array.isArray(y))for(var b=0;b<y.length;++b)x.push({key:o.inputs[b],value:y[b]});else x.push({key:o.inputs[0],value:y});var _=new lc(x);return ld(o.outputs,_)}).forEach(function(f,g){return u[g].push(f)})},d=0;d<s.length;++d)c(d);return Sr(u.map(function(p){return br(p,0)}))})},t.prototype.predict=function(e,n){n===void 0&&(n={});var i=fO(e);gT(i,this.inputNames,this.feedInputShapes,!1);try{var o=n.batchSize==null?32:n.batchSize;return m1(o),this.predictLoop(i,o)}finally{ku(i,e)}},t.prototype.predictOnBatch=function(e){gT(e,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)},t.prototype.standardizeUserDataXY=function(e,n,i,o){if(this.optimizer_==null)throw new xo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s];this.feedLossFns[s]===yg?a.push(u.slice(0,u.length-1).concat([1])):a.push(u)}if(Y9(e=mT(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=mT(n,this.feedOutputNames,a,!1,"target")),J9(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&e[0].shape[0]%o!=0)throw new re("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+o+". Found: "+e[0].shape[0]+" sample(s).");return[e,n]},t.prototype.standardizeUserData=function(e,n,i,o,a,s){return a===void 0&&(a=!0),rt(this,void 0,void 0,function(){var u,c,d,p,f,g,y,x;return Ye(this,function(b){switch(b.label){case 0:if(u=this.standardizeUserDataXY(e,n,a,s),c=u[0],d=u[1],i!=null)throw new Error("sample weight is not supported yet.");if(p=null,o==null)return[3,4];f=hO(o,this.outputNames),p=[],g=0,b.label=1;case 1:return g<f.length?(x=(y=p).push,[4,dO(d[g],null,f[g])]):[3,4];case 2:x.apply(y,[b.sent()]),b.label=3;case 3:return++g,[3,1];case 4:return[2,[c,d,p]]}})})},t.prototype.testLoop=function(e,n,i,o,a){var s=this;return o===void 0&&(o=0),ue(function(){var u=s.checkNumSamples(n,i,a,"steps"),c=[];if(o>0)throw new mt("Verbose mode is not implemented yet.");if(a!=null)throw new mt("steps mode in testLoop() is not implemented yet");for(var d=g1(u,i),p=$r(eo(0,u)),f=0;f<d.length;++f){var g=d[f][0],y=d[f][1],x=Fu(p,g,y-g),b=__(n,x),_=e(b);if(f===0)for(var C=0;C<_.length;++C)c.push(Ve(0));for(C=0;C<_.length;++C){var T=_[C];c[C]=yt(c[C],ot(y-g,T))}}for(C=0;C<c.length;++C)c[C]=xr(c[C],u);return c})},t.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,n=[],i=0;i<e.length;++i){var o=e[i],a=o;ZS(e,o)>1&&(a+="_"+ZS(e.slice(0,i),o)),n.push(a)}return n},t.prototype.makeTrainFunction=function(){var e=this;return function(n){var i=[],o=n.slice(0,e.inputs.length),a=n.slice(e.inputs.length,e.inputs.length+e.outputs.length),s=n.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),u=[],c=e.collectedTrainableWeights.map(function(d){return d.read()});return[e.optimizer_.minimize(function(){for(var d=[],p=0;p<e.inputs.length;++p)d.push({key:e.inputs[p],value:o[p]});var f,g=new lc(d),y=ld(e.outputs,g,{training:!0});for(p=0;p<e.lossFunctions.length;++p){var x=(0,e.lossFunctions[p])(a[p],y[p]);s[p]!=null&&(x=U9(x,s[p]));var b=_n(x);i.push(b),f=p===0?x:yt(f,x)}for(p=0;p<e.metricsTensors.length;++p){var _=void 0;if(e.outputs.length>1&&p<e.outputs.length)_=i[p];else{var C=e.metricsTensors[p][0],T=e.metricsTensors[p][1];_=_n(C(a[T],y[T]))}No(_),u.push(_)}return f=_n(f),e.calculateLosses().forEach(function(D){f=yt(f,D)}),f},!0,c)].concat(u)}},t.prototype.makeTestFunction=function(){var e=this;this.testFunction=function(n){return ue(function(){for(var i,o=[],a=n.slice(0,e.inputs.length),s=n.slice(e.inputs.length,e.inputs.length+e.outputs.length),u=[],c=0;c<e.inputs.length;++c)u.push({key:e.inputs[c],value:a[c]});var d=new lc(u),p=ld(e.outputs,d);for(c=0;c<e.lossFunctions.length;++c){var f=e.lossFunctions[c],g=_n(f(s[c],p[c]));i=c===0?g:yt(i,g),o.push(i)}for(c=0;c<e.metricsTensors.length;++c){var y=e.metricsTensors[c][0],x=e.metricsTensors[c][1],b=_n(y(s[x],p[x]));o.push(b)}return o})}},t.prototype.fit=function(e,n,i){return i===void 0&&(i={}),rt(this,void 0,void 0,function(){return Ye(this,function(o){return[2,X9(this,e,n,i)]})})},t.prototype.fitDataset=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){return[2,q9(this,e,n)]})})},t.prototype.trainOnBatch=function(e,n){return rt(this,void 0,void 0,function(){var i,o,a,s,u,c,d,p,f;return Ye(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(e,n)];case 1:i=g.sent(),o=i[0],a=i[1],s=this.makeTrainFunction(),u=s(o.concat(a)),c=[],d=0,p=u,g.label=2;case 2:return d<p.length?[4,p[d].data()]:[3,5];case 3:f=g.sent(),c.push(f[0]),g.label=4;case 4:return d++,[3,2];case 5:return ft(u),[2,Sr(c)]}})})},t.prototype.getNamedWeights=function(e){for(var n=[],i=e!=null&&e.trainableOnly,o=i?this.trainableWeights:this.weights,a=this.getWeights(i),s=0;s<o.length;++s)i&&!o[s].trainable||n.push({name:o[s].originalName,tensor:a[s]});return n},Object.defineProperty(t.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=r.prototype.dispose.call(this);if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=Jw().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-Jw().numTensors}return e},t.prototype.getLossIdentifiers=function(){var e;if(typeof this.loss=="string")e=oa(this.loss);else if(Array.isArray(this.loss)){for(var n=0,i=this.loss;n<i.length;n++)if(typeof i[n]!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(function(d){return oa(d)})}else{var o=Object.keys(this.loss);e={};for(var a=this.loss,s=0,u=o;s<u.length;s++){var c=u[s];if(typeof a[c]!="string")throw new Error("Serialization of non-string loss is not supported.");e[c]=oa(a[c])}}return e},t.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[oa(sm(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(i){return oa(sm(i))});var e={};for(var n in this.metrics)e[n]=oa(sm(this.metrics[n]));return e},t.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},t.prototype.loadTrainingConfig=function(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n,i,o=Qi(jd(e.optimizer_config));if(typeof e.loss=="string")n=Cu(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(function(s){return Cu(s)});else if(e.loss!=null)for(var a in n={},e.loss)n[a]=Cu(e.loss[a]);if(Array.isArray(e.metrics))i=e.metrics.map(function(s){return Cu(s)});else if(e.metrics!=null)for(var a in i={},e.metrics)i[a]=Cu(e.metrics[a]);this.compile({loss:n,metrics:i,optimizer:o})},t.prototype.save=function(e,n){return rt(this,void 0,void 0,function(){var i,o,a,s,u,c,d,p,f,g,y,x,b,_;return Ye(this,function(C){switch(C.label){case 0:if(typeof e=="string"){if((i=ui.getSaveHandlers(e)).length===0)throw new re("Cannot find any save handlers for URL '"+e+"'");if(i.length>1)throw new re("Found more than one ("+i.length+") save handlers for URL '"+e+"'");e=i[0]}if(e.save==null)throw new re("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,ui.encodeWeights(this.getNamedWeights(n))];case 1:return o=C.sent(),a=!1,s=null,u=this.toJSON(s,a),c={modelTopology:u,format:eH,generatedBy:"TensorFlow.js tfjs-layers v"+jv,convertedBy:null},n!=null&&n.includeOptimizer&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),d="optimizer",x=(y=ui).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,x.apply(y,[C.sent(),d])];case 3:p=C.sent(),f=p.data,g=p.specs,(_=o.specs).push.apply(_,g),o.data=ui.concatenateArrayBuffers([o.data,f]),C.label=4;case 4:return this.userDefinedMetadata!=null&&(b=!0,lT(this.userDefinedMetadata,this.name,b),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=o.data,c.weightSpecs=o.specs,[2,e.save(c)]}})})},t.prototype.setUserDefinedMetadata=function(e){lT(e,this.name),this.userDefinedMetadata=e},t.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},t.className="Model",t}(V9);function tH(r,t){return rt(this,void 0,void 0,function(){var e,n,i,o,a,s,u,c;return Ye(this,function(d){switch(d.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),(e=(r=r).modelTopology).model_config!=null&&(e=e.model_config),n=jd(e),i=Qi(n,t),r.weightsManifest==null?[3,2]:[4,ui.loadWeights(r.weightsManifest,r.pathPrefix,i.weights.map(function(p){return p.originalName}))];case 1:for(o=d.sent(),a={},s=0,u=i.weights;s<u.length;s++)c=u[s],a[c.originalName]=o[c.originalName];i.loadWeights(a),ft(o),d.label=2;case 2:return[2,i]}})})}function nH(r,t){return rt(this,void 0,void 0,function(){var e;return Ye(this,function(n){if(t==null&&(t={}),typeof r=="string"){if((e=ui.getLoadHandlers(r,t.onProgress)).length===0)e.push(ui.browserHTTPRequest(r,t));else if(e.length>1)throw new re("Found more than one ("+e.length+") load handlers for URL '"+r+"'");r=e[0]}return[2,rH(r,void 0,t)]})})}function rH(r,t,e){return rt(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p;return Ye(this,function(f){switch(f.label){case 0:if(e==null&&(e={}),r.load==null)throw new re("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=f.sent(),(i=n.modelTopology).model_config!=null&&(i=i.model_config),o=e.strict==null||e.strict,a=n.weightData!=null&&n.weightSpecs!=null&&o,s=Qi(jd(i),t,a),(u=n.trainingConfig)!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new re("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=iH(n.weightData,n.weightSpecs),d=c.modelWeights,p=c.optimizerWeights,s.loadWeights(d,o),s.optimizer!=null&&p.length>0?[4,s.optimizer.setWeights(p)]:[3,3];case 2:f.sent(),f.label=3;case 3:ft(d),ft(p.map(function(g){return g.tensor})),f.label=4;case 4:return[2,s]}})})}function iH(r,t){var e=ui.decodeWeights(r,t),n={},i=[];return t.forEach(function(o){o.group==="optimizer"?i.push({name:o.name,tensor:e[o.name]}):n[o.name]=e[o.name]}),{modelWeights:n,optimizerWeights:i}}be.registerClass(zu);var E_=function(r){function t(e){var n=r.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},n.trainable=!0,n.built=!1,n.name=e.name!=null?e.name:zv("sequential_"),e.layers!=null)for(var i=0,o=e.layers;i<o.length;i++){var a=o[i];n.add(a)}return n}return ge(t,r),t.prototype.checkShape=function(e){if(e.inboundNodes[0].outputTensors[0].shape.some(function(n){return n<0}))throw new re("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")},t.prototype.add=function(e){var n,i=e instanceof t||e instanceof zu;if(i){if((n=e).outputs.length!==1)throw new re("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(n.inputs.length!==1)throw new re("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new re("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var o=YD({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(o)}if(i)this.outputs=n.outputs,this.inputs=n.inputs;else{if(e.inboundNodes.length!==1)throw new re("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(e.inboundNodes[0].outputTensors.length!==1)throw new re("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=QD(this.outputs[0])}this.inboundNodes=[],new Vv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:$u(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},t.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},t.prototype.call=function(e,n){return this.model==null&&this.build(),this.model.call(e,n)},t.prototype.build=function(e){if(qt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new zu({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},t.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},t.prototype.summary=function(e,n,i){i===void 0&&(i=console.log),this.built||this.build(),r.prototype.summary.call(this,e,n,i)},t.prototype.setWeights=function(e){this.model==null&&this.build(),this.model.setWeights(e)},t.prototype.evaluate=function(e,n,i){if(i===void 0&&(i={}),!this.built)throw new xo("The model needs to be compiled before being used.");return this.model.evaluate(e,n,i)},t.prototype.evaluateDataset=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){if(!this.built)throw new xo("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(e,n)]})})},t.prototype.predict=function(e,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(e,n)},t.prototype.predictOnBatch=function(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)},t.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(t.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e},enumerable:!0,configurable:!0}),t.prototype.fit=function(e,n,i){return i===void 0&&(i={}),rt(this,void 0,void 0,function(){return Ye(this,function(o){if(!this.built)throw new xo("The model needs to be compiled before being used.");return[2,this.model.fit(e,n,i)]})})},t.prototype.fitDataset=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){if(!this.built)throw new xo("The model needs to be compiled before being used.");return[2,this.model.fitDataset(e,n)]})})},t.prototype.trainOnBatch=function(e,n){return rt(this,void 0,void 0,function(){return Ye(this,function(i){return[2,this.model.trainOnBatch(e,n)]})})},t.fromConfig=function(e,n,i,o){var a;o===void 0&&(o=!1);var s={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new re("Legacy serialization format not supported yet.");a=n}else Ge.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),a=n.layers,delete n.layers,s=n;var u=new e(s);if(!(u instanceof t))throw new mt("Sequential.fromConfig called on non-Sequential input: "+u);for(var c=0,d=a;c<d.length;c++){var p=Qi(d[c],void 0,o);o&&p.setFastWeightInitDuringBuild(!0),u.add(p)}return u},Object.defineProperty(t.prototype,"stopTraining",{get:function(){if(this.model==null)throw new re("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(this.model==null)throw new re("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){for(var e=[],n=0,i=this.layers;n<i.length;n++){var o=i[n],a={};a.className=o.getClassName(),a.config=o.getConfig(),e.push(a)}return{name:this.name,layers:e}},t.className="Sequential",t}(zu);function oH(r){return new zu(r)}function aH(r){return new E_(r)}function sH(r,t){return t==null&&(t={}),nH(r,t)}function mO(r){return YD(r)}function uH(r,t){rO.registerCallbackConstructor(r,t)}be.registerClass(E_);var pi=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.getConfig=function(){return{}},t}(be.Serializable),lH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e,n){return n===void 0&&(n=1),Dq(e,n)},t.className="elu",t}(pi);be.registerClass(lH);var cH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return Nv(e)},t.className="selu",t}(pi);be.registerClass(cH);var hH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return js(e)},t.className="relu",t}(pi);be.registerClass(hH);var dH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return ue(function(){return Zc(6,js(e))})},t.className="relu6",t}(pi);be.registerClass(dH);var pH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return e},t.className="linear",t}(pi);be.registerClass(pH);var fH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return cv(e)},t.className="sigmoid",t}(pi);be.registerClass(fH);var mH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return Pq(e)},t.className="hardSigmoid",t}(pi);be.registerClass(mH);var gH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return hp(e)},t.className="softplus",t}(pi);be.registerClass(gH);var vH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return Oq(e)},t.className="softsign",t}(pi);be.registerClass(vH);var yH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e){return hv(e)},t.className="tanh",t}(pi);be.registerClass(yH);var gO=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e,n){return n===void 0&&(n=-1),nl(e,n)},t.className="softmax",t}(pi);be.registerClass(gO);var wH=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.apply=function(e,n){return n===void 0&&(n=-1),av(e,n)},t.className="logSoftmax",t}(pi);function di(r){return r.getClassName()}function aw(r,t){return t===void 0&&(t={}),xp(r,be.SerializationMap.getMap().classNameMap,t,"activation")}function Os(r){var t;return r==null?aw(t={className:"linear",config:{}}):typeof r=="string"?((t={}).className=r,t.config={},aw(t)):r instanceof pi?r:aw(r)}function I_(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+r)}be.registerClass(wH);var vO=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t}(be.Serializable),Wv=function(r){function t(e){var n=r.call(this)||this;return I_(e),n.l1=e==null||e.l1==null?.01:e.l1,n.l2=e==null||e.l2==null?.01:e.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return ge(t,r),t.prototype.apply=function(e){var n=this;return ue(function(){var i=zt([1]);return n.hasL1&&(i=yt(i,Gr(ot(n.l1,ks(e))))),n.hasL2&&(i=yt(i,Gr(ot(n.l2,Cp(e))))),i.asScalar()})},t.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},t.fromConfig=function(e,n){return new e({l1:n.l1,l2:n.l2})},t.className="L1L2",t}(vO);function bH(r){return I_(r),new Wv({l1:r!=null?r.l1:null,l2:0})}function xH(r){return I_(r),new Wv({l2:r!=null?r.l2:null,l1:0})}be.registerClass(Wv);var vT={l1l2:"L1L2"};function gt(r){return s_(r)}function yT(r,t){return t===void 0&&(t={}),xp(r,be.SerializationMap.getMap().classNameMap,t,"regularizer")}function en(r){return r==null?null:typeof r=="string"?yT({className:r in vT?vT[r]:r,config:{}}):r instanceof vO?r:yT(r)}var yO=function(r){function t(e){var n=r.call(this,e??{})||this;return n.supportsMasking=!0,e!=null&&(n.maxValue=e.maxValue),n}return ge(t,r),t.prototype.call=function(e,n){e=dt(e);var i=js(e);return this.maxValue!=null&&(i=Rr(i,0,this.maxValue)),i},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="ReLU",t}(St);be.registerClass(yO);var wO=function(r){function t(e){var n=r.call(this,e??{})||this;return n.DEFAULT_ALPHA=.3,e==null&&(e={}),n.alpha=e.alpha==null?n.DEFAULT_ALPHA:e.alpha,n}return ge(t,r),t.prototype.call=function(e,n){var i=dt(e);return Rv(i,this.alpha)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="LeakyReLU",t}(St);be.registerClass(wO);var bO=function(r){function t(e){var n=r.call(this,e??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),n.supportsMasking=!0,n.alphaInitializer=Zt(e.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=en(e.alphaRegularizer),n.alphaConstraint=Rn(e.alphaConstraint),e.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(e.sharedAxes))n.sharedAxes=e.sharedAxes;else{if(typeof e.sharedAxes!="number")throw new re("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);n.sharedAxes=[e.sharedAxes]}return n}return ge(t,r),t.prototype.build=function(e){var n=(e=qt(e)).slice(1);if(this.sharedAxes!=null)for(var i=0,o=this.sharedAxes;i<o.length;i++)n[(s=o[i])-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(this.sharedAxes!=null)for(var s=1;s<e.length;++s)a[s]=e[s];this.inputSpec=[new Xn({ndim:e.length,axes:a})],this.built=!0},t.prototype.call=function(e,n){return e=dt(e),kv(e,this.alpha.read())},t.prototype.getConfig=function(){var e={alphaInitializer:Pt(this.alphaInitializer),alphaRegularizer:gt(this.alphaRegularizer),alphaConstraint:jt(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="PReLU",t}(St);be.registerClass(bO);var xO=function(r){function t(e){var n=r.call(this,e??{})||this;if(n.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==n.DEFAULT_ALPHA)throw new mt("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return n.alpha=e.alpha==null?n.DEFAULT_ALPHA:e.alpha,n}return ge(t,r),t.prototype.call=function(e,n){var i=dt(e);return rh(i)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="ELU",t}(St);be.registerClass(xO);var _O=function(r){function t(e){var n=r.call(this,e??{})||this;return n.DEFAULT_THETA=1,e==null&&(e={}),n.theta=e.theta==null?n.DEFAULT_THETA:e.theta,n}return ge(t,r),t.prototype.call=function(e,n){var i=dt(e);return i.mul(Ep(i.greater(this.theta),"float32"))},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="ThresholdedReLU",t}(St);be.registerClass(_O);var EO=function(r){function t(e){var n=r.call(this,e??{})||this;return n.DEFAULT_AXIS=1,e==null&&(e={}),n.softmax=new gO().apply,n.axis=e.axis==null?n.DEFAULT_AXIS:e.axis,n}return ge(t,r),t.prototype.call=function(e,n){var i=dt(e);return this.softmax(i,this.axis)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Softmax",t}(St);function sw(r,t,e){if(typeof r=="number")return $u(r,t);if(r.length!==t)throw new re("The "+e+" argument must be an integer or tuple of "+t+" integers. Received: "+r.length+" elements.");for(var n=0;n<t;++n){var i=r[n];if(!Aq(i))throw new re("The "+e+" argument must be an integer or tuple of "+t+" integers. Received: "+JSON.stringify(r)+" including a non-integer number "+i)}return r}function ga(r,t,e,n,i){return i===void 0&&(i=1),r==null?r:(o=e==="same"?r:r-(t+(t-1)*(i-1))+1,Math.floor((o+n-1)/n));var o}function um(r,t,e,n){if(r==null)return null;if(n==="valid")r=r*t+Ds([e-t,0]);else{if(n!=="same")throw new re("Unsupport padding mode: "+n+".");r*=t}return r}function C_(r,t){return ue(function(){return Nn(t),t==="channelsFirst"?an(r,[0,2,3,1]):r})}function IO(r,t){return ue(function(){return Nn(t),t==="channelsFirst"?an(r,[0,2,3,4,1]):r})}function _H(r,t,e,n,i,o,a){return n===void 0&&(n=1),i===void 0&&(i="valid"),a===void 0&&(a=1),ue(function(){if(o==null&&(o=Zi()),Nn(o),r.shape.length!==3)throw new re("The input of a conv1dWithBias operation should be 3, but is "+r.shape.length+" instead.");if(t.shape.length!==3)throw new re("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(e!=null&&e.shape.length!==1)throw new re("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if(o==="channelsFirst"&&(r=an(r,[0,2,1])),i==="causal")throw new mt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=vv(r,t,n,i==="same"?"same":"valid","NWC",a);return e!=null&&(s=Da(s,e)),s})}function wT(r,t,e,n,i,o,a,s){return n===void 0&&(n=[1,1]),i===void 0&&(i="valid"),s===void 0&&(s=null),ue(function(){if(o==null&&(o=Zi()),Nn(o),r.rank!==3&&r.rank!==4)throw new re("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+r.rank+".");if(t.rank!==3&&t.rank!==4)throw new re("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+r.rank+".");var u=C_(r,o);if(i==="causal")throw new mt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Mc.conv2d({x:u,filter:t,strides:n,pad:i==="same"?"same":"valid",dilations:a,dataFormat:"NHWC",bias:e,activation:s}),o==="channelsFirst"&&(u=an(u,[0,3,1,2])),u})}function EH(r,t,e,n,i,o,a){return n===void 0&&(n=[1,1,1]),i===void 0&&(i="valid"),ue(function(){if(o==null&&(o=Zi()),Nn(o),r.rank!==4&&r.rank!==5)throw new re("conv3dWithBias expects input to be of rank 4 or 5, but received "+r.rank+".");if(t.rank!==4&&t.rank!==5)throw new re("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+r.rank+".");var s=IO(r,o);if(i==="causal")throw new mt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=yv(s,t,n,i==="same"?"same":"valid","NDHWC",a),e!=null&&(s=Da(s,e)),o==="channelsFirst"&&(s=an(s,[0,4,1,2,3])),s})}be.registerClass(EO);var CO=function(r){function t(e,n){var i=r.call(this,n)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(n),i.rank=e,kr(i.rank,"rank"),i.rank!==1&&i.rank!==2&&i.rank!==3)throw new mt("Convolution layer for rank other than 1, 2, or 3 ("+i.rank+") is not implemented yet.");if(i.kernelSize=sw(n.kernelSize,e,"kernelSize"),i.strides=sw(n.strides==null?1:n.strides,e,"strides"),i.padding=n.padding==null?"valid":n.padding,Si(i.padding),i.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Nn(i.dataFormat),i.activation=Os(n.activation),i.useBias=n.useBias==null||n.useBias,i.biasInitializer=Zt(n.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=Rn(n.biasConstraint),i.biasRegularizer=en(n.biasRegularizer),i.activityRegularizer=en(n.activityRegularizer),i.dilationRate=sw(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),i.rank===1&&Array.isArray(i.dilationRate)&&i.dilationRate.length!==1)throw new re("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(i.rank===2){if(typeof i.dilationRate=="number")i.dilationRate=[i.dilationRate,i.dilationRate];else if(i.dilationRate.length!==2)throw new re("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate))}else if(i.rank===3){if(typeof i.dilationRate=="number")i.dilationRate=[i.dilationRate,i.dilationRate,i.dilationRate];else if(i.dilationRate.length!==3)throw new re("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(i.dilationRate))}return i}return ge(t,r),t.verifyArgs=function(e){if(yo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!u_(e.kernelSize,"number",1,3))throw new re("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(e.kernelSize)+".")},t.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:di(this.activation),useBias:this.useBias,biasInitializer:Pt(this.biasInitializer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),biasConstraint:jt(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t}(St),qv=function(r){function t(e,n){var i=r.call(this,e,n)||this;return i.kernel=null,t.verifyArgs(n),i.filters=n.filters,kr(i.filters,"filters"),i.kernelInitializer=Zt(n.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=Rn(n.kernelConstraint),i.kernelRegularizer=en(n.kernelRegularizer),i}return ge(t,r),t.prototype.build=function(e){var n;e=qt(e);var i=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[i]==null)throw new re("The channel dimension of the input should be defined. Found "+e[i]);var o=e[i],a=this.kernelSize.concat([o,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[i]=o,n)}],this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){var o;e=dt(e);var a=i.bias==null?null:i.bias.read(),s=AD(i.activation.getClassName());if(s!=null&&i.rank===2)o=wT(e,i.kernel.read(),a,i.strides,i.padding,i.dataFormat,i.dilationRate,s);else{if(i.rank===1)o=_H(e,i.kernel.read(),a,i.strides[0],i.padding,i.dataFormat,i.dilationRate[0]);else if(i.rank===2)o=wT(e,i.kernel.read(),a,i.strides,i.padding,i.dataFormat,i.dilationRate);else{if(i.rank!==3)throw new mt("convolutions greater than 3D are not implemented yet.");o=EH(e,i.kernel.read(),a,i.strides,i.padding,i.dataFormat,i.dilationRate)}i.activation!=null&&(o=i.activation.apply(o))}return o})},t.prototype.computeOutputShape=function(e){e=qt(e);for(var n=[],i=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2),o=0;o<i.length;++o){var a=ga(i[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);n.push(a)}var s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n)).push(this.filters):(s.push(this.filters),s=s.concat(n)),s},t.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:Pt(this.kernelInitializer),kernelRegularizer:gt(this.kernelRegularizer),kernelConstraint:jt(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.verifyArgs=function(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new re("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))},t}(CO),S_=function(r){function t(e){var n=r.call(this,2,e)||this;return t.verifyArgs(e),n}return ge(t,r),t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return delete e.rank,e},t.verifyArgs=function(e){if(typeof e.kernelSize!="number"&&!u_(e.kernelSize,"number",1,2))throw new re("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv2D",t}(qv);be.registerClass(S_);var SO=function(r){function t(e){var n=r.call(this,3,e)||this;return t.verifyArgs(e),n}return ge(t,r),t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return delete e.rank,e},t.verifyArgs=function(e){if(typeof e.kernelSize!="number"&&(!Array.isArray(e.kernelSize)||e.kernelSize.length!==1&&e.kernelSize.length!==3))throw new re("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv3D",t}(qv);be.registerClass(SO);var TO=function(r){function t(e){var n=r.call(this,e)||this;if(n.inputSpec=[new Xn({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new re("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return ge(t,r),t.prototype.build=function(e){var n;if((e=qt(e)).length!==4)throw new re("Input should have rank 4; Received input shape: "+JSON.stringify(e));var i=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[i]==null)throw new re("The channel dimension of the inputs should be defined. Found `None`.");var o=e[i],a=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Xn({ndim:4,axes:(n={},n[i]=o,n)})],this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){var o=dt(e);if(o.shape.length!==4)throw new re("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+o.shape.length);var a,s,u=o.shape,c=u[0];i.dataFormat==="channelsFirst"?(a=2,s=3):(a=1,s=2);var d=u[a],p=u[s],f=i.kernelSize[0],g=i.kernelSize[1],y=i.strides[0],x=i.strides[1],b=[c,um(d,y,f,i.padding),um(p,x,g,i.padding),i.filters];i.dataFormat!=="channelsLast"&&(o=an(o,[0,2,3,1]));var _=wv(o,i.kernel.read(),b,i.strides,i.padding);return i.dataFormat!=="channelsLast"&&(_=an(_,[0,3,1,2])),i.bias!=null&&(_=Da(_,i.bias.read(),i.dataFormat)),i.activation!=null&&(_=i.activation.apply(_)),_})},t.prototype.computeOutputShape=function(e){var n,i,o,a=(e=qt(e)).slice();this.dataFormat==="channelsFirst"?(n=1,i=2,o=3):(n=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],d=this.strides[1];return a[n]=this.filters,a[i]=um(a[i],c,s,this.padding),a[o]=um(a[o],d,u,this.padding),a},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return delete e.dilationRate,e},t.className="Conv2DTranspose",t}(S_);be.registerClass(TO);var IH=function(r){function t(e,n){var i=r.call(this,e,n)||this;if(i.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",i.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",i.depthwiseKernel=null,i.pointwiseKernel=null,n.filters==null)throw new re("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new re("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new re("SeparableConv"+i.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return i.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,i.depthwiseInitializer=Zt(n.depthwiseInitializer||i.DEFAULT_DEPTHWISE_INITIALIZER),i.depthwiseRegularizer=en(n.depthwiseRegularizer),i.depthwiseConstraint=Rn(n.depthwiseConstraint),i.pointwiseInitializer=Zt(n.depthwiseInitializer||i.DEFAULT_POINTWISE_INITIALIZER),i.pointwiseRegularizer=en(n.pointwiseRegularizer),i.pointwiseConstraint=Rn(n.pointwiseConstraint),i}return ge(t,r),t.prototype.build=function(e){var n;if((e=qt(e)).length<this.rank+2)throw new re("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var i=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[i]==null||e[i]<0)throw new re("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[i]));for(var o=e[i],a=this.kernelSize.concat([o,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(o*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",a,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new Xn({ndim:this.rank+2,axes:(n={},n[i]=o,n)})],this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){var o;if(e=dt(e),i.rank===1)throw new mt("1D separable convolution is not implemented yet.");return i.rank===2&&(i.dataFormat==="channelsFirst"&&(e=an(e,[0,2,3,1])),o=Fx(e,i.depthwiseKernel.read(),i.pointwiseKernel.read(),i.strides,i.padding,i.dilationRate,"NHWC")),i.useBias&&(o=Da(o,i.bias.read(),i.dataFormat)),i.activation!=null&&(o=i.activation.apply(o)),i.dataFormat==="channelsFirst"&&(o=an(o,[0,3,1,2])),o})},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Pt(this.depthwiseInitializer),e.pointwiseInitializer=Pt(this.pointwiseInitializer),e.depthwiseRegularizer=gt(this.depthwiseRegularizer),e.pointwiseRegularizer=gt(this.pointwiseRegularizer),e.depthwiseConstraint=jt(this.depthwiseConstraint),e.pointwiseConstraint=jt(this.pointwiseConstraint),e},t.className="SeparableConv",t}(qv),AO=function(r){function t(e){return r.call(this,2,e)||this}return ge(t,r),t.className="SeparableConv2D",t}(IH);be.registerClass(AO);var RO=function(r){function t(e){var n=r.call(this,1,e)||this;return t.verifyArgs(e),n.inputSpec=[{ndim:3}],n}return ge(t,r),t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},t.verifyArgs=function(e){if(typeof e.kernelSize!="number"&&!u_(e.kernelSize,"number",1,1))throw new re("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv1D",t}(qv);be.registerClass(RO);var kO=function(r){function t(e){var n=r.call(this,e)||this;return typeof e.cropping=="number"?n.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?n.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:n.cropping=e.cropping,n.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,n.inputSpec=[{ndim:4}],n}return ge(t,r),t.prototype.computeOutputShape=function(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},t.prototype.call=function(e,n){var i=this;return ue(function(){return e=dt(e),i.dataFormat==="channelsLast"?om(om(e,i.cropping[0][0],e.shape[1]-i.cropping[0][0]-i.cropping[0][1],2),i.cropping[1][0],e.shape[2]-i.cropping[1][1]-i.cropping[1][0],3):om(om(e,i.cropping[0][0],e.shape[2]-i.cropping[0][0]-i.cropping[0][1],3),i.cropping[1][0],e.shape[3]-i.cropping[1][1]-i.cropping[1][0],4)})},t.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Cropping2D",t}(St);be.registerClass(kO);var NO=function(r){function t(e){var n=r.call(this,e)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=e.size==null?n.DEFAULT_SIZE:e.size,n.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,n}return ge(t,r),t.prototype.computeOutputShape=function(e){if(this.dataFormat==="channelsFirst"){var n=e[2]==null?null:this.size[0]*e[2],i=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,i]}return n=e[1]==null?null:this.size[0]*e[1],i=e[2]==null?null:this.size[1]*e[2],[e[0],n,i,e[3]]},t.prototype.call=function(e,n){var i=this;return ue(function(){var o=dt(e),a=o.shape;if(i.dataFormat==="channelsFirst"){o=an(o,[0,2,3,1]);var s=i.size[0]*a[2],u=i.size[1]*a[3],c=o.resizeNearestNeighbor([s,u]);return an(c,[0,3,1,2])}return s=i.size[0]*a[1],u=i.size[1]*a[2],o.resizeNearestNeighbor([s,u])})},t.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="UpSampling2D",t}(St);function CH(r,t,e,n,i,o){return e===void 0&&(e=[1,1]),n===void 0&&(n="valid"),ue(function(){i==null&&(i=Zi()),Nn(i);var a=C_(r,i);if(r.rank!==4)throw new re("Input for depthwiseConv2d is required to be 4-D, but is instead "+r.rank+"-D");if(t.rank!==4)throw new re("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return a=nh(a,t,e,n==="same"?"same":"valid","NHWC",o),i==="channelsFirst"&&(a=an(a,[0,3,1,2])),a})}be.registerClass(NO);var DO=function(r){function t(e){var n=r.call(this,2,e)||this;return n.depthwiseKernel=null,n.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,n.depthwiseInitializer=Zt(e.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Rn(e.depthwiseConstraint),n.depthwiseRegularizer=en(e.depthwiseRegularizer),n}return ge(t,r),t.prototype.build=function(e){if((e=qt(e)).length<4)throw new re("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new re("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[n]+").");var i=e[n],o=[this.kernelSize[0],this.kernelSize[1],i,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[i*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){var o=CH(e=dt(e),i.depthwiseKernel.read(),i.strides,i.padding,i.dataFormat,null);return i.useBias&&(o=Da(o,i.bias.read(),i.dataFormat)),i.activation!=null&&(o=i.activation.apply(o)),o})},t.prototype.computeOutputShape=function(e){e=qt(e);var n=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=ga(n,this.kernelSize[0],this.padding,this.strides[0]),s=ga(i,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],o,a,s]:[e[0],a,s,o]},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Pt(this.depthwiseInitializer),e.depthwiseRegularizer=gt(this.depthwiseRegularizer),e.depthwiseConstraint=jt(this.depthwiseRegularizer),e},t.className="DepthwiseConv2D",t}(CO);be.registerClass(DO);var OO=function(r){function t(e){var n=r.call(this,e)||this;return n.rate=Math.max(Math.min(e.rate,1),0),n.noiseShape=e.noiseShape,n.seed=e.seed,n.supportsMasking=!0,n}return ge(t,r),t.prototype.getNoiseShape=function(e){if(this.noiseShape==null)return this.noiseShape;for(var n=e.shape,i=[],o=0;o<this.noiseShape.length;++o)i.push(this.noiseShape[o]==null?n[o]:this.noiseShape[o]);return i},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e);if(0<i.rate&&i.rate<1){var a=n.training!=null&&n.training,s=i.getNoiseShape(o);return Fc(function(){return BD(o,i.rate,s,i.seed)},function(){return o},a)}return e})},t.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.prototype.dispose=function(){return r.prototype.dispose.call(this)},t.className="Dropout",t}(St);be.registerClass(OO);var PO=function(r){function t(e){var n=r.call(this,e)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){var i=null;e.batchSize!=null&&(i=e.batchSize),n.batchInputShape=[i,e.inputDim]}return n.units=e.units,kr(n.units,"units"),n.activation=Os(e.activation),e.useBias!=null&&(n.useBias=e.useBias),n.kernelInitializer=Zt(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Zt(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Rn(e.kernelConstraint),n.biasConstraint=Rn(e.biasConstraint),n.kernelRegularizer=en(e.kernelRegularizer),n.biasRegularizer=en(e.biasRegularizer),n.activityRegularizer=en(e.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return ge(t,r),t.prototype.build=function(e){var n,i=(e=qt(e))[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[i,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=i,n)}],this.built=!0},t.prototype.computeOutputShape=function(e){var n=(e=qt(e)).slice();return n[n.length-1]=this.units,n},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o,a=dt(e),s=AD(i.activation.getClassName());return s!=null?o=ma(a,i.kernel.read(),s,i.bias?i.bias.read():null):(o=ma(a,i.kernel.read()),i.bias!=null&&(o=Da(o,i.bias.read())),i.activation!=null&&(o=i.activation.apply(o))),o})},t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),biasConstraint:jt(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Dense",t}(St);be.registerClass(PO);var MO=function(r){function t(e){var n=r.call(this,e||{})||this;return n.inputSpec=[{minNDim:3}],n}return ge(t,r),t.prototype.computeOutputShape=function(e){for(var n=0,i=(e=qt(e)).slice(1);n<i.length;n++)if(i[n]==null)throw new re('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],_s(e,1)]},t.prototype.call=function(e,n){var i=this;return ue(function(){return i.invokeCallHook(e,n),Nq(dt(e))})},t.className="Flatten",t}(St);be.registerClass(MO);var LO=function(r){function t(e){var n=r.call(this,e)||this;return n.supportsMasking=!0,n.activation=Os(e.activation),n}return ge(t,r),t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e);return i.activation.apply(o)})},t.prototype.getConfig=function(){var e={activation:di(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Activation",t}(St);be.registerClass(LO);var FO=function(r){function t(e){var n=r.call(this,e)||this;return n.n=e.n,n.inputSpec=[{ndim:2}],n}return ge(t,r),t.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},t.prototype.call=function(e,n){var i=this;return ue(function(){return Rq(e=dt(e),i.n)})},t.prototype.getConfig=function(){var e={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="RepeatVector",t}(St);be.registerClass(FO);var zO=function(r){function t(e){var n=r.call(this,e)||this;n.targetShape=e.targetShape;for(var i=0;i<n.targetShape.length;++i)n.isUnknown(n.targetShape[i])&&(n.targetShape[i]=null);return n}return ge(t,r),t.prototype.isUnknown=function(e){return e<0||e==null},t.prototype.fixUnknownDimension=function(e,n){for(var i="Total size of new array must be unchanged.",o=n.slice(),a=1,s=null,u=0;u<o.length;++u){var c=o[u];if(this.isUnknown(c)){if(s!==null)throw new re("Can only specifiy one unknown dimension.");s=u}else a*=c}var d=_s(e);if(s!==null){if(a===0||d%a!=0)throw new re(i);o[s]=d/a}else if(d!==a)throw new re(i);return o},t.prototype.computeOutputShape=function(e){for(var n=!1,i=0;i<e.length;++i)if(this.isUnknown(e[i])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e),a=o.shape,s=a.slice(0,1).concat(i.fixUnknownDimension(a.slice(1),i.targetShape));return o.reshape(s)})},t.prototype.getConfig=function(){var e={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Reshape",t}(St);be.registerClass(zO);var VO=function(r){function t(e){var n=r.call(this,e)||this;if(e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var i=eo(1,e.dims.length+1);if(!Ge.arraysEqual(e.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=e.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Xn({ndim:n.dims.length+1})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){var n=(e=qt(e)).slice();return this.dims.forEach(function(i,o){n[o+1]=e[i]}),n},t.prototype.call=function(e,n){return an(dt(e),this.dimsIncludingBatch)},t.prototype.getConfig=function(){var e={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Permute",t}(St);be.registerClass(VO);var BO=function(r){function t(e){var n=r.call(this,e??{})||this;return n.supportsMasking=!0,n.maskValue=e!=null?e.maskValue==null?0:e.maskValue:0,n}return ge(t,r),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,e),n},t.prototype.computeMask=function(e,n){var i=dt(e);return Vd(Dc(i,this.maskValue),-1)},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e),a=Vd(Dc(o,i.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})},t.className="Masking",t}(St);be.registerClass(BO);var UO=function(r){function t(e){var n=r.call(this,e)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){var i=null;e.batchSize!=null&&(i=e.batchSize),e.inputLength==null?n.batchInputShape=[i,null]:n.batchInputShape=[i].concat(Kt(e.inputLength))}return n.inputDim=e.inputDim,kr(n.inputDim,"inputDim"),n.outputDim=e.outputDim,kr(n.outputDim,"outputDim"),n.embeddingsInitializer=Zt(e.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=en(e.embeddingsRegularizer),n.activityRegularizer=en(e.activityRegularizer),n.embeddingsConstraint=Rn(e.embeddingsConstraint),n.maskZero=e.maskZero,n.supportsMasking=e.maskZero,n.inputLength=e.inputLength,n}return ge(t,r),t.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},t.prototype.warnOnIncompatibleInputShape=function(e){},t.prototype.computeMask=function(e,n){var i=this;return ue(function(){return i.maskZero?(e=dt(e),Dc(e,Ct(e))):null})},t.prototype.computeOutputShape=function(e){if(e=qt(e),this.inputLength==null)return e.concat([this.outputDim]);var n=Kt(this.inputLength);if(n.length!==e.length-1)throw new re('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var i=0,o=0;o<n.length;++o){var a=n[o],s=e[o+1];if(a!=null&&s!=null&&a!==s)throw new re('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);a==null&&(n[i]=s),i++}return[e[0]].concat(n,[this.outputDim])},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e);return o.dtype!=="int32"&&(o=Ep(o,"int32")),VD(i.embeddings.read(),o.as1D()).reshape(qt(i.computeOutputShape(o.shape)))})},t.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Pt(this.embeddingsInitializer),embeddingsRegularizer:gt(this.embeddingsRegularizer),activityRegularizer:gt(this.activityRegularizer),embeddingsConstraint:jt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Embedding",t}(St);be.registerClass(UO);var sl=function(r){function t(e){var n=r.call(this,e||{})||this;return n.supportsMasking=!0,n}return ge(t,r),t.prototype.mergeFunction=function(e){throw new mt},t.prototype.computeElementwiseOpOutputShape=function(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;for(var i=e.slice(0,e.length-n.length),o=0;o<n.length;++o){var a=e[e.length-n.length+o],s=n[o];if(a==null||s==null||a<0||s<0)i.push(null);else if(a===1)i.push(s);else if(s===1)i.push(a);else{if(a!==s)throw new re("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));i.push(a)}}return i},t.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[qt(e)]),(e=e).length<2)throw new re("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var n=[],i=0,o=e;i<o.length;i++)(u=o[i])!=null&&u[0]!==null&&n.push(u[0]);if((n=xs(n)).length>1)throw new re("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var a=e[0]==null?null:e[0].slice(1),s=1;s<e.length;++s){var u=e[s]==null?null:e[s].slice(1);a=this.computeElementwiseOpOutputShape(a,u)}var c=e.map(function(d){return d.length});e.indexOf(null)===-1&&xs(c).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){if(e=e,i.reshapeRequired){var o=[],a=e.map(function(S){return S.rank});if(a.indexOf(null)===-1){for(var s=Ds(a),u=0,c=e;u<c.length;u++){for(var d=(x=c[u]).rank,p=0;p<s-d;++p)x=Ip(x,1);o.push(x)}return i.mergeFunction(o)}for(var f=!1,g=0,y=e;g<y.length;g++){var x;if((d=(x=y[g]).rank)==null){var b=x.shape,_=b[0],C=b.slice(1).concat([_]),T=x.reshape([_].concat(_s(b.slice(1))));T=(T=an(T,[1,0])).reshape(C),o.push(T),f=!0}else if(d>1){var D=eo(1,d).concat([0]);o.push(an(x,D)),f=!0}else o.push(x)}var O=i.mergeFunction(o),z=O.rank;if(f)if(z==null){var I=O.shape;C=[_=I[I.length-1]].concat(I.slice(0,I.length-1)),O=an(O.reshape([-1,_]),[1,0]).reshape(C)}else z>1&&(D=[z-1].concat(eo(0,z-1)),O=an(O,D));return O}return i.mergeFunction(e)})},t.prototype.computeOutputShape=function(e){var n;n=(e=e)[0]==null?null:e[0].slice(1);for(var i=1;i<e.length;++i){var o=e[i]==null?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}for(var a=[],s=0,u=e;s<u.length;s++)(o=u[s])!=null&&o[0]!==null&&a.push(o[0]);return n=(a=xs(a)).length===1?a.concat(n):[null].concat(n)},t.prototype.computeMask=function(e,n){return ue(function(){if(n==null)return null;if(!Array.isArray(n))throw new re("`mask` should be an Array");if(!Array.isArray(e))throw new re("`inputs` should be an Array");if(n.length!==e.length)throw new re("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+e.length+" vs "+n.length+")");if(n.every(function(a){return a==null}))return null;for(var i=(n=n.map(function(a){return a==null?a:ii(a,0)}))[0],o=1;o<n.length-1;++o)i=Ra(i,n[o]);return i})},t}(St),jO=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.mergeFunction=function(e){return ue(function(){for(var n=e[0].clone(),i=1;i<e.length;++i)n=yt(n,e[i]);return n})},t.className="Add",t}(sl);be.registerClass(jO);var WO=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.mergeFunction=function(e){return ue(function(){for(var n=e[0].clone(),i=1;i<e.length;++i)n=ot(n,e[i]);return n})},t.className="Multiply",t}(sl);be.registerClass(WO);var qO=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.mergeFunction=function(e){return ue(function(){for(var n=e[0].clone(),i=1;i<e.length;++i)n=yt(n,e[i]);return ot(1/e.length,n)})},t.className="Average",t}(sl);be.registerClass(qO);var HO=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.mergeFunction=function(e){return ue(function(){for(var n=e[0],i=1;i<e.length;++i)n=Fo(n,e[i]);return n})},t.className="Maximum",t}(sl);be.registerClass(HO);var $O=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.mergeFunction=function(e){return ue(function(){for(var n=e[0],i=1;i<e.length;++i)n=Zc(n,e[i]);return n})},t.className="Minimum",t}(sl);be.registerClass($O);var GO=function(r){function t(e){var n=r.call(this,e)||this;return n.DEFAULT_AXIS=-1,e==null&&(e={}),n.axis=e.axis==null?n.DEFAULT_AXIS:e.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return ge(t,r),t.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||e.length===1)throw new re("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var n=!0,i=0,o=e=e;i<o.length;i++)if((f=o[i])!=null){n=!1;break}if(!n){for(var a=[],s=0;s<e.length;++s){var u=e[s].slice();u.splice(this.axis,1);for(var c=!1,d=0,p=a;d<p.length;d++){var f=p[d];if(Ge.arraysEqual(f,u)){c=!0;break}}c||a.push(u)}if(a.length>1)throw new re("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},t.prototype.mergeFunction=function(e){var n=this;return ue(function(){return zD(e,n.axis)})},t.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new re("A `Concatenate` layer should be called on a list of inputs.");for(var n=e,i=n[0].slice(),o=this.axis<0?i.length+this.axis:this.axis,a=0,s=n.slice(1);a<s.length;a++){var u=s[a];if(i[o]==null||u[o]==null){i[o]=null;break}i[o]+=u[o]}return i},t.prototype.computeMask=function(e,n){var i=this;if(n==null)return null;if(!Array.isArray(n))throw new re("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new re("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new re("Mismatch in the length of mask ("+n.length+") and the legnth of inputs ("+e.length+")");return ue(function(){var o=!0;if(n.forEach(function(c){c==null||(o=!1)}),o)return null;for(var a=[],s=0;s<e.length;++s)n[s]==null?a.push(ci(e[s]).asType("bool")):n[s].rank<e[s].rank?a.push(ii(n[s],-1)):a.push(n[s]);var u=br(a,i.axis);return Sv(u,-1,!1)})},t.prototype.getConfig=function(){var e={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Concatenate",t}(sl);function Yh(r,t){for(;r<0;)r+=t;return r}function SH(r,t,e){if(r.shape.length>3||t.shape.length>3)throw new mt("batchDot is not implemented for tensors of 4D or higher rank yet");if(Ge.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+r.shape.length}),Ge.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+t.shape.length}),typeof e=="number"&&(e=[e,e]),r.dtype==="complex64"||t.dtype==="complex64")throw new mt("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,i=t.shape.length;e==null&&(e=[n-1,i-2]);var o=e;return ue(function(){var a,s;if(n>i){a=n-i;for(var u=[],c=0;c<a;++c)u.push(1);t=t.reshape(t.shape.concat(u))}else if(i>n){for(a=i-n,u=[],c=0;c<a;++c)u.push(1);r=r.reshape(r.shape.concat(u))}else a=0;if(r.shape.length===2&&t.shape.length===2)s=o[0]===o[1]?r.mulStrict(t).sum(o[0]):r.transpose([1,0]).mulStrict(t).sum(o[1]);else{var d=o[0]!==r.shape.length-1,p=o[1]===t.shape.length-1;s=r.matMul(t,d,p)}if(a>0){var f=void 0,g=[];for(c=f=n>i?n+i-3:n-1;c<f+a;++c)g.push(c);s=s.squeeze(g)}return s.shape.length===1&&(s=s.expandDims(1)),s})}be.registerClass(GO);var KO=function(r){function t(e){var n=r.call(this,e)||this;return n.axes=e.axes,n.normalize=e.normalize!=null&&e.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return ge(t,r),t.prototype.build=function(e){Ge.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=e[0],i=e[1];if(n.length>3||i.length>3)throw new mt("Dot layer does not support tensors of 4D or higher rank yet.");var o=this.interpretAxes(n,i);if(n[o[0]]!==i[o[1]])throw new re("Dimension incompatibility: "+n[o[0]]+" !== "+i[o[1]])},t.prototype.mergeFunction=function(e){if(e.length!==2)throw new re("A `Dot` layer must be called on exactly 2 inputs, but received "+e.length+" input(s).");var n,i=e[0],o=e[1];return n=Array.isArray(this.axes)?this.axes.map(function(a,s){return Yh(a,e[s].shape.length)}):[Yh(this.axes,i.shape.length),Yh(this.axes,o.shape.length)],this.normalize&&(i=vg(i,n[0]),o=vg(o,n[1])),SH(i,o,n)},t.prototype.interpretAxes=function(e,n){return Array.isArray(this.axes)?this.axes:[Yh(this.axes,e.length),Yh(this.axes,n.length)]},t.prototype.computeOutputShape=function(e){Ge.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=e[0].slice(),i=e[1].slice();if(n.length>3||i.length>3)throw new mt("Dot layer does not support tensors of 4D or higher rank yet.");var o=this.interpretAxes(n,i);n.splice(o[0],1),i.splice(o[1],1),i.splice(0,1);var a=n.concat(i);return a.length===1&&a.push(1),a},t.prototype.computeMask=function(e,n){return null},t.prototype.getConfig=function(){var e={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="Dot",t}(sl);be.registerClass(KO);var XO=function(r){function t(e){var n=r.call(this,e)||this;return n.supportsMasking=!0,n.stddev=e.stddev,n}return ge(t,r),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,e),n},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e);return Fc(function(){return Fv(o.shape,0,i.stddev).add(o)},function(){return o},n.training||!1)})},t.className="GaussianNoise",t}(St);be.registerClass(XO);var QO=function(r){function t(e){var n=r.call(this,e)||this;return n.supportsMasking=!0,n.rate=e.rate,n}return ge(t,r),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,e),n},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n);var o=dt(e);return i.rate>0&&i.rate<1?Fc(function(){var a=Math.sqrt(i.rate/(1-i.rate));return o.mul(Fv(o.shape,1,a))},function(){return o},n.training||!1):o})},t.className="GaussianDropout",t}(St);be.registerClass(QO);var YO=function(r){function t(e){var n=r.call(this,e)||this;return n.supportsMasking=!0,n.rate=e.rate,n.noiseShape=e.noiseShape,n}return ge(t,r),t.prototype._getNoiseShape=function(e){return this.noiseShape||dt(e).shape},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,e),n},t.prototype.call=function(e,n){var i=this;return ue(function(){if(i.rate<1&&i.rate>0){var o=i._getNoiseShape(e);return Fc(function(){var a=dt(e),s=-1.7580993408473766,u=fp(tl(o),i.rate);u=Ep(u,"float32");var c=Math.pow((1-i.rate)*(1+i.rate*Math.pow(s,2)),-.5),d=-c*s*i.rate;return a.mul(u).add(u.add(-1).mul(s)).mul(c).add(d)},function(){return dt(e)},n.training||!1)}return e})},t.className="AlphaDropout",t}(St);function Wd(r,t,e,n,i,o){var a;if(o===void 0&&(o=.001),r.rank===2)a=Cx(r,t,e,n,i,o);else if(r.rank===3)a=Sx(r,t,e,n,i,o);else{if(r.rank!==4)throw new mt("batchNormalization is not implemented for array of rank "+r.rank+" yet");a=Tx(r,t,e,n,i,o)}return a}function TH(r,t,e,n,i){return i===void 0&&(i=.001),ue(function(){var o=vp(r,n),a=o.mean,s=o.variance;return[Wd(r,a,s,e,t,i),a,s]})}function AH(r,t,e,n,i){return i===void 0&&(i=.001),ue(function(){for(var o=vp(r,n),a=o.mean,s=o.variance,u=[],c=0,d=eo(0,r.rank);c<d.length;c++){var p=d[c];n.indexOf(p)!==-1?u.push(1):u.push(r.shape[p])}var f=a.reshape(u),g=s.reshape(u),y=t==null?null:t.reshape(u),x=e==null?null:e.reshape(u);return[Wd(r,f,g,x,y,i),a,s]})}function RH(r,t,e,n,i){return i===void 0&&(i=.001),Ge.arraysEqual(n.slice().sort(),eo(0,r.rank-1))?TH(r,t,e,n,i):AH(r,t,e,n,i)}be.registerClass(YO);var JO=function(r){function t(e){var n=this;return e==null&&(e={}),(n=r.call(this,e)||this).supportsMasking=!0,n.axis=e.axis==null?-1:e.axis,n.momentum=e.momentum==null?.99:e.momentum,n.epsilon=e.epsilon==null?.001:e.epsilon,n.center=e.center==null||e.center,n.scale=e.scale==null||e.scale,n.betaInitializer=Zt(e.betaInitializer||"zeros"),n.gammaInitializer=Zt(e.gammaInitializer||"ones"),n.movingMeanInitializer=Zt(e.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Zt(e.movingVarianceInitializer||"ones"),n.betaConstraint=Rn(e.betaConstraint),n.gammaConstraint=Rn(e.gammaConstraint),n.betaRegularizer=en(e.betaRegularizer),n.gammaRegularizer=en(e.gammaRegularizer),n}return ge(t,r),t.prototype.build=function(e){var n;e=qt(e);var i=this.axis>=0?this.axis:this.axis+e.length,o=e[i];if(o==null)throw new re("Axis "+i+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new Xn({ndim:e.length,axes:(n={},n[i]=o,n)})];var a=[o];this.scale&&(this.gamma=this.addWeight("gamma",a,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",a,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",a,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",a,null,this.movingVarianceInitializer,null,!1),this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){var o=n.training!=null&&n.training,a=dt(e),s=a.shape,u=s.length,c=eo(0,u),d=i.axis>=0?i.axis:i.axis+u;c.splice(d,1);var p=$u(1,u);p[d]=s[d];var f=c.slice();f.sort();var g=!Ge.arraysEqual(f,eo(0,u).slice(0,u-1));if(!o)return function(){if(g){var T=i.movingMean.read().reshape(p),D=i.movingVariance.read().reshape(p),O=i.center?i.beta.read().reshape(p):null,z=i.scale?i.gamma.read().reshape(p):null;return Wd(a,T,D,O,z,i.epsilon)}return Wd(a,i.movingMean.read(),i.movingVariance.read(),i.beta==null?null:i.beta.read(),i.gamma==null?null:i.gamma.read(),i.epsilon)}();var y=RH(a,i.gamma.read(),i.beta.read(),c,i.epsilon),x=y[0],b=y[1],_=y[2],C=function(T,D,O){ue(function(){var z=1-O,I=T.read(),S=I.sub(D).mul(z);T.write(I.sub(S))})};return C(i.movingMean,b,i.momentum),C(i.movingVariance,_,i.momentum),x})},t.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pt(this.betaInitializer),gammaInitializer:Pt(this.gammaInitializer),movingMeanInitializer:Pt(this.movingMeanInitializer),movingVarianceInitializer:Pt(this.movingVarianceInitializer),betaRegularizer:gt(this.betaRegularizer),gammaRegularizer:gt(this.gammaRegularizer),betaConstraint:jt(this.betaConstraint),gammaConstraint:jt(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="BatchNormalization",t}(St);be.registerClass(JO);var ZO=function(r){function t(e){var n=this;if(e==null&&(e={}),(n=r.call(this,e)||this).axis=e.axis==null?-1:e.axis,typeof n.axis=="number"){if(!Number.isInteger(n.axis))throw new Error("Expected axis to be an integer, but received "+n.axis)}else{if(!Array.isArray(n.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(n.axis));for(var i=0,o=n.axis;i<o.length;i++){var a=o[i];if(!Number.isInteger(a))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(n.axis))}}return n.epsilon=e.epsilon==null?.001:e.epsilon,n.center=e.center==null||e.center,n.scale=e.scale==null||e.scale,n.betaInitializer=Zt(e.betaInitializer||"zeros"),n.gammaInitializer=Zt(e.gammaInitializer||"ones"),n.betaRegularizer=en(e.betaRegularizer),n.gammaRegularizer=en(e.gammaRegularizer),n.supportsMasking=!0,n}return ge(t,r),t.prototype.build=function(e){var n=(e=qt(e)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(var o=0,a=this.axis;o<a.length;o++){var s=a[o];if(s<0||s>=n)throw new Error("Invalid axis: "+s)}if(this.axis.length!==xs(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var u=this.axis.map(function(c){return e[c]});this.scale?this.gamma=this.addWeight("gamma",u,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",u,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},t.prototype.call=function(e,n){var i=this,o=dt(e),a=o.shape,s=a.length;return ue(function(){for(var u=vp(o,i.axis,!0),c=u.mean,d=u.variance,p=$u(1,s),f=0,g=i.axis;f<g.length;f++){var y=g[f];p[y]=a[y]}for(var x=function(O){return O!=null&&O.shape.length!==s&&i.axis!==[s-1]?O.reshape(p):O},b=x(i.gamma.read()),_=x(i.beta.read()),C=[],T=[],D=0;D<s;++D)i.axis.indexOf(D)!==-1?(C.push(a[D]),T.push(1)):(C.push(1),T.push(a[D]));return c=c.tile(C),d=d.tile(C),b=b.tile(T),_=_.tile(T),Wd(o,c,d,_,b,i.epsilon)})},t.prototype.getConfig=function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pt(this.betaInitializer),gammaInitializer:Pt(this.gammaInitializer),betaRegularizer:gt(this.betaRegularizer),gammaRegularizer:gt(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="LayerNormalization",t}(St);function kH(r,t,e){return ue(function(){if(r.rank!==4)throw new re("temporalPadding expects input tensor to be 4-D, but received a "+r.rank+"-D tensor.");if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new re("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=Zi()),e!=="channelsLast"&&e!=="channelsFirst")throw new re("Unknown data format: "+e+". Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return n=e==="channelsFirst"?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Bs(r,n)})}be.registerClass(ZO);var eP=function(r){function t(e){var n=this;if(e==null&&(e={}),(n=r.call(this,e)||this).dataFormat=e.dataFormat==null?Zi():e.dataFormat,e.padding==null)n.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")n.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new re("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var i=void 0,o=void 0;if(typeof e.padding[0]=="number")i=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new re("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(i=e.padding[0],e.padding[1].length!==2)throw new re("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");o=e.padding[1]}n.padding=[i,o]}return n.inputSpec=[new Xn({ndim:4})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){var n,i;return e=qt(e),this.dataFormat==="channelsFirst"?(n=e[2]!=null&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,i=e[3]!=null&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],n,i]):(n=e[1]!=null&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,i=e[2]!=null&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],n,i,e[3]])},t.prototype.call=function(e,n){var i=this;return ue(function(){return kH(dt(e),i.padding,i.dataFormat)})},t.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="ZeroPadding2D",t}(St);function Hv(r,t,e,n,i,o){return ue(function(){var a;Nn(i),OD(o),Si(n),e==null&&(e=[1,1]),n==null&&(n="valid"),i==null&&(i=Zi()),o==null&&(o="max"),r=C_(r,i);var s=n==="same"?"same":"valid";return a=o==="max"?xv(r,t,e,s):_v(r,t,e,s),i==="channelsFirst"&&(a=an(a,[0,3,1,2])),a})}function tP(r,t,e,n,i,o){return ue(function(){var a;Nn(i),OD(o),Si(n),e==null&&(e=[1,1,1]),n==null&&(n="valid"),i==null&&(i=Zi()),o==null&&(o="max"),r=IO(r,i);var s=n==="same"?"same":"valid";return a=o==="max"?Ev(r,t,e,s):Iv(r,t,e,s),i==="channelsFirst"&&(a=an(a,[0,4,1,2,3])),a})}be.registerClass(eP);var nP=function(r){function t(e){var n=this;if(e.poolSize==null&&(e.poolSize=2),n=r.call(this,e)||this,typeof e.poolSize=="number")n.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||e.poolSize.length!==1||typeof e.poolSize[0]!="number")throw new re("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));n.poolSize=e.poolSize}if(kr(n.poolSize,"poolSize"),e.strides==null)n.strides=n.poolSize;else if(typeof e.strides=="number")n.strides=[e.strides];else{if(!Array.isArray(e.strides)||e.strides.length!==1||typeof e.strides[0]!="number")throw new re("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));n.strides=e.strides}return kr(n.strides,"strides"),n.padding=e.padding==null?"valid":e.padding,Si(n.padding),n.inputSpec=[new Xn({ndim:3})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){var n=ga((e=qt(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]},t.prototype.call=function(e,n){var i=this;return ue(function(){i.invokeCallHook(e,n),e=Ip(dt(e),2);var o=i.poolingFunction(dt(e),[i.poolSize[0],1],[i.strides[0],1],i.padding,"channelsLast");return up(o,[2])})},t.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t}(St),rP=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.poolingFunction=function(e,n,i,o,a){return Nn(a),Si(o),Hv(e,n,i,o,a,"max")},t.className="MaxPooling1D",t}(nP);be.registerClass(rP);var iP=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.poolingFunction=function(e,n,i,o,a){return Nn(a),Si(o),Hv(e,n,i,o,a,"avg")},t.className="AveragePooling1D",t}(nP);be.registerClass(iP);var oP=function(r){function t(e){var n=this;if(e.poolSize==null&&(e.poolSize=[2,2]),(n=r.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new re("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides];return kr(n.poolSize,"poolSize"),kr(n.strides,"strides"),n.padding=e.padding==null?"valid":e.padding,n.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nn(n.dataFormat),Si(n.padding),n.inputSpec=[new Xn({ndim:4})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){e=qt(e);var n=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=ga(n,this.poolSize[0],this.padding,this.strides[0]),i=ga(i,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,i]:[e[0],n,i,e[3]]},t.prototype.call=function(e,n){var i=this;return ue(function(){return i.invokeCallHook(e,n),i.poolingFunction(dt(e),i.poolSize,i.strides,i.padding,i.dataFormat)})},t.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t}(St),aP=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.poolingFunction=function(e,n,i,o,a){return Nn(a),Si(o),Hv(e,n,i,o,a,"max")},t.className="MaxPooling2D",t}(oP);be.registerClass(aP);var sP=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.poolingFunction=function(e,n,i,o,a){return Nn(a),Si(o),Hv(e,n,i,o,a,"avg")},t.className="AveragePooling2D",t}(oP);be.registerClass(sP);var uP=function(r){function t(e){var n=this;if(e.poolSize==null&&(e.poolSize=[2,2,2]),(n=r.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new re("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides,e.strides];return kr(n.poolSize,"poolSize"),kr(n.strides,"strides"),n.padding=e.padding==null?"valid":e.padding,n.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nn(n.dataFormat),Si(n.padding),n.inputSpec=[new Xn({ndim:5})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){e=qt(e);var n=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=ga(n,this.poolSize[0],this.padding,this.strides[0]),i=ga(i,this.poolSize[1],this.padding,this.strides[1]),o=ga(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,i,o]:[e[0],n,i,o,e[4]]},t.prototype.call=function(e,n){var i=this;return ue(function(){return i.invokeCallHook(e,n),i.poolingFunction(dt(e),i.poolSize,i.strides,i.padding,i.dataFormat)})},t.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t}(St),lP=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.poolingFunction=function(e,n,i,o,a){return Nn(a),Si(o),tP(e,n,i,o,a,"max")},t.className="MaxPooling3D",t}(uP);be.registerClass(lP);var cP=function(r){function t(e){return r.call(this,e)||this}return ge(t,r),t.prototype.poolingFunction=function(e,n,i,o,a){return Nn(a),Si(o),tP(e,n,i,o,a,"avg")},t.className="AveragePooling3D",t}(uP);be.registerClass(cP);var hP=function(r){function t(e){var n=r.call(this,e)||this;return n.inputSpec=[new Xn({ndim:3})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){return[e[0],e[2]]},t.prototype.call=function(e,n){throw new mt},t}(St),dP=function(r){function t(e){return r.call(this,e||{})||this}return ge(t,r),t.prototype.call=function(e,n){return ue(function(){var i=dt(e);return _n(i,1)})},t.className="GlobalAveragePooling1D",t}(hP);be.registerClass(dP);var pP=function(r){function t(e){return r.call(this,e||{})||this}return ge(t,r),t.prototype.call=function(e,n){return ue(function(){var i=dt(e);return Ns(i,1)})},t.className="GlobalMaxPooling1D",t}(hP);be.registerClass(pP);var fP=function(r){function t(e){var n=r.call(this,e)||this;return n.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nn(n.dataFormat),n.inputSpec=[new Xn({ndim:4})],n}return ge(t,r),t.prototype.computeOutputShape=function(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]},t.prototype.call=function(e,n){throw new mt},t.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t}(St),mP=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.call=function(e,n){var i=this;return ue(function(){var o=dt(e);return i.dataFormat==="channelsLast"?_n(o,[1,2]):_n(o,[2,3])})},t.className="GlobalAveragePooling2D",t}(fP);be.registerClass(mP);var gP=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t.prototype.call=function(e,n){var i=this;return ue(function(){var o=dt(e);return i.dataFormat==="channelsLast"?Ns(o,[1,2]):Ns(o,[2,3])})},t.className="GlobalMaxPooling2D",t}(fP);function vP(r,t,e,n){if(Array.isArray(r)){if(t!=null||e!=null)throw new re("When inputs is an array, neither initialState or constants should be provided");n!=null&&(e=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(t=r.slice(1,r.length)),r=r[0]}function i(o){return o==null||Array.isArray(o)?o:[o]}return{inputs:r,initialState:t=i(t),constants:e=i(e)}}function yP(r,t,e,n,i,o,a,s){return n===void 0&&(n=!1),a===void 0&&(a=!1),s===void 0&&(s=!1),ue(function(){var u=t.shape.length;if(u<3)throw new re("Input should be at least 3D, but is "+u+"D.");var c=[1,0].concat(eo(2,u));t=an(t,c),o!=null,a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&((i=i.asType("bool").asType("float32")).rank===u-1&&(i=ii(i,-1)),i=an(i,c)),n&&(t=Oo(t,0),i!=null&&(i=Oo(i,0)));var d,p,f=[],g=e,y=t.shape[0],x=qu(t);i!=null&&(p=qu(i));for(var b,_=function(T){var D=x[T],O=ue(function(){return r(D,g)});if(i==null)d=O[0],g=O[1];else{var z=ue(function(){var I=p[T],S=ci(I).sub(I);return{output:O[0].mul(I).addStrict(g[0].mul(S)),newStates:g.map(function(A,N){return O[1][N].mul(I).addStrict(A.mul(S))})}});d=z.output,g=z.newStates}s&&f.push(d)},C=0;C<y;++C)_(C);return s&&(b=Ji(f,1)),[d,b,g]})}be.registerClass(gP);var ul=function(r){function t(e){var n,i=r.call(this,e)||this;if(e.cell==null)throw new re("cell property is missing for the constructor of RNN.");if((n=Array.isArray(e.cell)?new k_({cells:e.cell}):e.cell).stateSize==null)throw new re("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return i.cell=n,i.returnSequences=e.returnSequences!=null&&e.returnSequences,i.returnState=e.returnState!=null&&e.returnState,i.goBackwards=e.goBackwards!=null&&e.goBackwards,i._stateful=e.stateful!=null&&e.stateful,i.unroll=e.unroll!=null&&e.unroll,i.supportsMasking=!0,i.inputSpec=[new Xn({ndim:3})],i.stateSpec=null,i.states_=null,i.numConstants=null,i.keptStates=[],i}return ge(t,r),t.prototype.getStates=function(){return this.states_==null?eo(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(e){return null}):this.states_},t.prototype.setStates=function(e){this.states_=e},t.prototype.computeOutputShape=function(e){h1(e)&&(e=e[0]),e=e;var n=this.cell.stateSize;Array.isArray(n)||(n=[n]);var i,o=n[0];if(i=this.returnSequences?[e[0],e[1],o]:[e[0],o],this.returnState){for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push([e[0],c])}return[i].concat(a)}return i},t.prototype.computeMask=function(e,n){var i=this;return ue(function(){Array.isArray(n)&&(n=n[0]);var o=i.returnSequences?n:null;if(i.returnState){var a=i.states.map(function(s){return null});return[o].concat(a)}return o})},Object.defineProperty(t.prototype,"states",{get:function(){if(this.states_==null){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],i=0;i<e;++i)n.push(null);return n}return this.states_},set:function(e){this.states_=e},enumerable:!0,configurable:!0}),t.prototype.build=function(e){if(this.numConstants!=null)throw new mt("Constants support is not implemented in RNN yet.");h1(e)&&(e=e[0]),e=e;var n=this.stateful?e[0]:null,i=e[e.length-1];this.inputSpec[0]=new Xn({shape:[n,null,i]});var o,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),o=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!Ge.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new re("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=o.map(function(s){return new Xn({shape:[null,s]})});this.stateful&&this.resetStates()},t.prototype.resetStates=function(e,n){var i=this;n===void 0&&(n=!1),ue(function(){if(!i.stateful)throw new Eu("Cannot call resetStates() on an RNN Layer that is not stateful.");var o=i.inputSpec[0].shape[0];if(o==null)throw new re("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(i.states_==null)Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map(function(d){return zt([o,d])}):i.states_=[zt([o,i.cell.stateSize])];else if(e==null)ft(i.states_),i.keptStates!=null&&(ft(i.keptStates),i.keptStates=[]),Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map(function(d){return zt([o,d])}):i.states_[0]=zt([o,i.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==i.states_.length)throw new re("Layer "+i.name+" expects "+i.states_.length+" state(s), but it received "+e.length+" state value(s). Input received: "+e);n===!0?i.keptStates.push(i.states_.slice()):ft(i.states_);for(var a=0;a<i.states_.length;++a){var s=e[a],u=Array.isArray(i.cell.stateSize)?i.cell.stateSize[a]:i.cell.stateSize,c=[o,u];if(!Ge.arraysEqual(s.shape,c))throw new re("State "+a+" is incompatible with layer "+i.name+": expected shape="+c+", received shape="+s.shape);i.states_[a]=s}}i.states_=i.states_.map(function(d){return No(d.clone())})})},t.prototype.apply=function(e,n){var i=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});var a=vP(e,i,o,this.numConstants);e=a.inputs,i=a.initialState,o=a.constants;var s=[],u=[];if(i!=null){n.initialState=i,s=s.concat(i),this.stateSpec=[];for(var c=0,d=i;c<d.length;c++){var p=d[c];this.stateSpec.push(new Xn({shape:p.shape}))}u=u.concat(this.stateSpec)}if(o!=null&&(n.constants=o,s=s.concat(o),this.numConstants=o.length),s[0]instanceof Xi){var f=[e].concat(s),g=this.inputSpec.concat(u),y=this.inputSpec;this.inputSpec=g;var x=r.prototype.apply.call(this,f,n);return this.inputSpec=y,x}return r.prototype.apply.call(this,e,n)},t.prototype.call=function(e,n){var i=this;return ue(function(){var o=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;e=dt(e),s==null&&(s=i.stateful?i.states_:i.getInitialState(e));var u=Array.isArray(i.cell.stateSize)?i.cell.stateSize.length:1;if(s.length!==u)throw new re("RNN Layer has "+u+" state(s) but was passed "+s.length+" initial state(s).");i.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:a},d=yP(function(x,b){var _=i.cell.call([x].concat(b),c);return[_[0],_.slice(1)]},e,s,i.goBackwards,o,null,i.unroll,i.returnSequences),p=d[0],f=d[1],g=d[2];i.stateful&&i.resetStates(g,a);var y=i.returnSequences?f:p;return i.returnState?[y].concat(g):y})},t.prototype.getInitialState=function(e){var n=this;return ue(function(){var i=zt(e.shape);return i=Ip(i=Gr(i,[1,2])),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(o){return o>1?l1(i,[1,o]):i}):n.cell.stateSize>1?[l1(i,[1,n.cell.stateSize])]:[i]})},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(e){r.prototype.setFastWeightInitDuringBuild.call(this,e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)},t.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);var n=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:n};var i=r.prototype.getConfig.call(this);return Object.assign(e,i),e},t.fromConfig=function(e,n,i){i===void 0&&(i={});var o=Qi(n.cell,i);return new e(Object.assign(n,{cell:o}))},t.className="RNN",t}(St);be.registerClass(ul);var Tp=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return ge(t,r),t}(St),T_=function(r){function t(e){var n=r.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,kr(n.units,"units"),n.activation=Os(e.activation==null?n.DEFAULT_ACTIVATION:e.activation),n.useBias=e.useBias==null||e.useBias,n.kernelInitializer=Zt(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Zt(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Zt(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=en(e.kernelRegularizer),n.recurrentRegularizer=en(e.recurrentRegularizer),n.biasRegularizer=en(e.biasRegularizer),n.kernelConstraint=Rn(e.kernelConstraint),n.recurrentConstraint=Rn(e.recurrentConstraint),n.biasConstraint=Rn(e.biasConstraint),n.dropout=Lc([1,Ds([0,e.dropout==null?0:e.dropout])]),n.recurrentDropout=Lc([1,Ds([0,e.recurrentDropout==null?0:e.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return ge(t,r),t.prototype.build=function(e){e=qt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){if((e=e).length!==2)throw new re("SimpleRNNCell expects 2 input Tensors, got "+e.length+".");var o=e[1];e=e[0];var a,s=n.training!=null&&n.training;0<i.dropout&&i.dropout<1&&i.dropoutMask==null&&(i.dropoutMask=Vc(function(){return ci(e)},i.dropout,s)),0<i.recurrentDropout&&i.recurrentDropout<1&&i.recurrentDropoutMask==null&&(i.recurrentDropoutMask=Vc(function(){return ci(o)},i.recurrentDropout,s));var u=i.dropoutMask,c=i.recurrentDropoutMask;a=ma(u!=null?ot(e,u):e,i.kernel.read()),i.bias!=null&&(a=Da(a,i.bias.read())),c!=null&&(o=ot(o,c));var d=yt(a,ma(o,i.recurrentKernel.read()));return i.activation!=null&&(d=i.activation.apply(d)),[d,d]})},t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),recurrentConstraint:jt(this.recurrentConstraint),biasConstraint:jt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="SimpleRNNCell",t}(Tp);be.registerClass(T_);var wP=function(r){function t(e){return e.cell=new T_(e),r.call(this,e)||this}return ge(t,r),t.prototype.call=function(e,n){var i=this;return ue(function(){i.cell.dropoutMask!=null&&(ft(i.cell.dropoutMask),i.cell.dropoutMask=null),i.cell.recurrentDropoutMask!=null&&(ft(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var o=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(i,e,{mask:o,training:a,initialState:s})})},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),recurrentConstraint:jt(this.recurrentConstraint),biasConstraint:jt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=r.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},t.fromConfig=function(e,n){return new e(n)},t.className="SimpleRNN",t}(ul);be.registerClass(wP);var A_=function(r){function t(e){var n=r.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,kr(n.units,"units"),n.activation=Os(e.activation===void 0?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=Os(e.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=e.useBias==null||e.useBias,n.kernelInitializer=Zt(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Zt(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Zt(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=en(e.kernelRegularizer),n.recurrentRegularizer=en(e.recurrentRegularizer),n.biasRegularizer=en(e.biasRegularizer),n.kernelConstraint=Rn(e.kernelConstraint),n.recurrentConstraint=Rn(e.recurrentConstraint),n.biasConstraint=Rn(e.biasConstraint),n.dropout=Lc([1,Ds([0,e.dropout==null?0:e.dropout])]),n.recurrentDropout=Lc([1,Ds([0,e.recurrentDropout==null?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return ge(t,r),t.prototype.build=function(e){var n=(e=qt(e))[e.length-1];this.kernel=this.addWeight("kernel",[n,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){if((e=e).length!==2)throw new re("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var o=n.training!=null&&n.training,a=e[1];e=e[0],0<i.dropout&&i.dropout<1&&i.dropoutMask==null&&(i.dropoutMask=Vc(function(){return ci(e)},i.dropout,o,3)),0<i.recurrentDropout&&i.recurrentDropout<1&&i.recurrentDropoutMask==null&&(i.recurrentDropoutMask=Vc(function(){return ci(a)},i.recurrentDropout,o,3));var s,u,c,d=i.dropoutMask,p=i.recurrentDropoutMask;0<i.dropout&&i.dropout<1&&(e=ot(e,d[0]));var f=ma(e,i.kernel.read());i.useBias&&(f=Da(f,i.bias.read())),0<i.recurrentDropout&&i.recurrentDropout<1&&(a=ot(a,p[0]));var g=i.recurrentKernel.read(),y=fa(g,[2*i.units,i.units],g.rank-1),x=y[0],b=y[1],_=ma(a,x),C=fa(f,3,f.rank-1),T=C[0],D=C[1],O=C[2],z=fa(_,2,_.rank-1),I=z[0],S=z[1];s=i.recurrentActivation.apply(yt(T,I)),u=i.recurrentActivation.apply(yt(D,S));var A=ma(ot(u,a),b);c=i.activation.apply(yt(O,A));var N=yt(ot(s,a),ot(yt(1,rl(s)),c));return[N,N]})},t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),recurrentActivation:di(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),recurrentConstraint:jt(this.recurrentConstraint),biasConstraint:jt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="GRUCell",t}(Tp);be.registerClass(A_);var bP=function(r){function t(e){return e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new A_(e),r.call(this,e)||this}return ge(t,r),t.prototype.call=function(e,n){var i=this;return ue(function(){i.cell.dropoutMask!=null&&(ft(i.cell.dropoutMask),i.cell.dropoutMask=null),i.cell.recurrentDropoutMask!=null&&(ft(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var o=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(i,e,{mask:o,training:a,initialState:s})})},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),recurrentActivation:di(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),recurrentConstraint:jt(this.recurrentConstraint),biasConstraint:jt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},t.fromConfig=function(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)},t.className="GRU",t}(ul);be.registerClass(bP);var R_=function(r){function t(e){var n=r.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,kr(n.units,"units"),n.activation=Os(e.activation===void 0?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=Os(e.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=e.useBias==null||e.useBias,n.kernelInitializer=Zt(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Zt(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Zt(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=en(e.kernelRegularizer),n.recurrentRegularizer=en(e.recurrentRegularizer),n.biasRegularizer=en(e.biasRegularizer),n.kernelConstraint=Rn(e.kernelConstraint),n.recurrentConstraint=Rn(e.recurrentConstraint),n.biasConstraint=Rn(e.biasConstraint),n.dropout=Lc([1,Ds([0,e.dropout==null?0:e.dropout])]),n.recurrentDropout=Lc([1,Ds([0,e.recurrentDropout==null?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return ge(t,r),t.prototype.build=function(e){var n,i,o=(e=qt(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[o,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,s=this.units;i=new((n=function(u){function c(){return u!==null&&u.apply(this,arguments)||this}return ge(c,u),c.prototype.apply=function(d,p){var f=a.apply([s]),g=new c_().apply([s]),y=a.apply([2*s]);return rT(rT(f,g),y)},c}(oo)).className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},t.prototype.call=function(e,n){var i=this;return ue(function(){var o=n.training!=null&&n.training;if((e=e).length!==3)throw new re("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var a=e[1],s=e[2];e=e[0],0<i.dropout&&i.dropout<1&&i.dropoutMask==null&&(i.dropoutMask=Vc(function(){return ci(e)},i.dropout,o,4)),0<i.recurrentDropout&&i.recurrentDropout<1&&i.recurrentDropoutMask==null&&(i.recurrentDropoutMask=Vc(function(){return ci(a)},i.recurrentDropout,o,4));var u,c,d,p,f=i.dropoutMask,g=i.recurrentDropoutMask;0<i.dropout&&i.dropout<1&&(e=ot(e,f[0]));var y=ma(e,i.kernel.read());0<i.recurrentDropout&&i.recurrentDropout<1&&(a=ot(a,g[0])),y=yt(y,ma(a,i.recurrentKernel.read())),i.useBias&&(y=Da(y,i.bias.read()));var x=fa(y,4,y.rank-1),b=x[0],_=x[1],C=x[2],T=x[3];u=i.recurrentActivation.apply(b),c=i.recurrentActivation.apply(_),d=yt(ot(c,s),ot(u,i.activation.apply(C))),p=i.recurrentActivation.apply(T);var D=ot(p,i.activation.apply(d));return[D,D,d]})},t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),recurrentActivation:di(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),recurrentConstraint:jt(this.recurrentConstraint),biasConstraint:jt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.className="LSTMCell",t}(Tp);be.registerClass(R_);var xP=function(r){function t(e){return e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new R_(e),r.call(this,e)||this}return ge(t,r),t.prototype.call=function(e,n){var i=this;return ue(function(){i.cell.dropoutMask!=null&&(ft(i.cell.dropoutMask),i.cell.dropoutMask=null),i.cell.recurrentDropoutMask!=null&&(ft(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var o=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(i,e,{mask:o,training:a,initialState:s})})},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var e={units:this.units,activation:di(this.activation),recurrentActivation:di(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:gt(this.kernelRegularizer),recurrentRegularizer:gt(this.recurrentRegularizer),biasRegularizer:gt(this.biasRegularizer),activityRegularizer:gt(this.activityRegularizer),kernelConstraint:jt(this.kernelConstraint),recurrentConstraint:jt(this.recurrentConstraint),biasConstraint:jt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},t.fromConfig=function(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)},t.className="LSTM",t}(ul);be.registerClass(xP);var k_=function(r){function t(e){var n=r.call(this,e)||this;return n.cells=e.cells,n}return ge(t,r),Object.defineProperty(t.prototype,"stateSize",{get:function(){for(var e=[],n=0,i=this.cells.slice().reverse();n<i.length;n++){var o=i[n];Array.isArray(o.stateSize)?e.push.apply(e,o.stateSize):e.push(o.stateSize)}return e},enumerable:!0,configurable:!0}),t.prototype.call=function(e,n){var i=this;return ue(function(){for(var o=(e=e).slice(1),a=[],s=0,u=i.cells.slice().reverse();s<u.length;s++){var c=u[s];Array.isArray(c.stateSize)?a.push(o.splice(0,c.stateSize.length)):a.push(o.splice(0,1))}a.reverse();for(var d,p=[],f=0;f<i.cells.length;++f)c=i.cells[f],o=a[f],d=f===0?[e[0]].concat(o):[d[0]].concat(o),d=c.call(d,n),p.push(d.slice(1));o=[];for(var g=0,y=p.slice().reverse();g<y.length;g++){var x=y[g];o.push.apply(o,x)}return[d[0]].concat(o)})},t.prototype.build=function(e){var n;h1(e)&&(e=e[0]),e=e,this.cells.forEach(function(i,o){Lu("RNNCell_"+o,function(){i.build(e),n=Array.isArray(i.stateSize)?i.stateSize[0]:i.stateSize,e=[e[0],n]})}),this.built=!0},t.prototype.getConfig=function(){for(var e=[],n=0,i=this.cells;n<i.length;n++){var o=i[n];e.push({className:o.getClassName(),config:o.getConfig()})}var a={cells:e},s=r.prototype.getConfig.call(this);return Object.assign(a,s),a},t.fromConfig=function(e,n,i){i===void 0&&(i={});for(var o=[],a=0,s=n.cells;a<s.length;a++){var u=s[a];o.push(Qi(u,i))}return new e({cells:o})},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],n=0,i=this.cells;n<i.length;n++){var o=i[n];e.push.apply(e,o.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],n=0,i=this.cells;n<i.length;n++){var o=i[n];e.push.apply(e,o.nonTrainableWeights)}if(!this.trainable){for(var a=[],s=0,u=this.cells;s<u.length;s++)o=u[s],a.push.apply(a,o.trainableWeights);return a.concat(e)}return e},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){for(var e=[],n=0,i=this.cells;n<i.length;n++){var o=i[n];e.push.apply(e,o.weights)}return d1(e)},t.prototype.setWeights=function(e){for(var n=[],i=0,o=this.cells;i<o.length;i++)for(var a=o[i],s=a.weights.length,u=e.splice(s),c=0;c<a.weights.length;++c)n.push([a.weights[c],u[c]]);v_(n)},t.className="StackedRNNCells",t}(Tp);function Vc(r,t,e,n){function i(){return BD(r(),t)}if(e===void 0&&(e=null),n===void 0&&(n=1),n>1){for(var o=[],a=0;a<n;a++)o.push(Fc(i,r,e));return o.map(function(s){return No(s.clone())})}return No(Fc(i,r,e).clone())}be.registerClass(k_);var _P=function(r){function t(e){var n=r.call(this,e)||this;return n.layer=e.layer,n}return ge(t,r),t.prototype.build=function(e){this.built=!0},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(e){this.layer!=null&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.layer.getWeights()},t.prototype.setWeights=function(e){this.layer.setWeights(e)},t.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.prototype.setFastWeightInitDuringBuild=function(e){r.prototype.setFastWeightInitDuringBuild.call(this,e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)},t.fromConfig=function(e,n,i){i===void 0&&(i={});var o=Qi(n.layer,i);delete n.layer;var a={layer:o};return Object.assign(a,n),new e(a)},t}(St),EP=function(r){function t(e){var n=r.call(this,e)||this;return n.supportsMasking=!0,n}return ge(t,r),t.prototype.build=function(e){if((e=qt(e)).length<3)throw new re("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,e)},t.prototype.computeOutputShape=function(e){var n=[(e=qt(e))[0]].concat(e.slice(2)),i=this.layer.computeOutputShape(n),o=e[1];return[i[0],o].concat(i.slice(1))},t.prototype.call=function(e,n){var i=this;return ue(function(){return yP(function(o,a){return[dt(i.layer.call(o,n)),[]]},e=dt(e),[],!1,null,null,!1,!0)[1]})},t.className="TimeDistributed",t}(_P);function NH(r){ih(Cq,"BidirectionalMergeMode",r)}be.registerClass(EP);var DH="concat",IP=function(r){function t(e){var n=r.call(this,e)||this,i=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=i,n.forwardLayer=Qi(o),i.goBackwards=i.goBackwards!==!0;var a={};if(a.className=e.layer.getClassName(),a.config=i,n.backwardLayer=Qi(a),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=e.mergeMode===void 0?DH:e.mergeMode,NH(n.mergeMode),e.weights)throw new mt("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n.numConstants=null,n}return ge(t,r),Object.defineProperty(t.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},t.prototype.setWeights=function(e){var n=e.length,i=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,i)),this.backwardLayer.setWeights(e.slice(i))},t.prototype.computeOutputShape=function(e){var n,i,o,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState&&(o=a.slice(1)),n=a[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,i=[n]):i=this.mergeMode==null?[n,n.slice()]:[n],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[n].concat(o).concat(o.slice()):Sr(i)},t.prototype.apply=function(e,n){var i=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});var a=vP(e,i,o,this.numConstants);if(e=a.inputs,i=a.initialState,o=a.constants,Array.isArray(e)&&(i=e.slice(1),e=e[0]),(i==null||i.length===0)&&o==null)return r.prototype.apply.call(this,e,n);var s=[],u=[];if(i!=null){var c=i.length;if(c%2>0)throw new re("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=i,s.push.apply(s,i);var d=i.map(function(C){return new Xn({shape:C.shape})});this.forwardLayer.stateSpec=d.slice(0,c/2),this.backwardLayer.stateSpec=d.slice(c/2),u.push.apply(u,d)}if(o!=null)throw new mt("Support for constants in Bidirectional layers is not implemented yet.");for(var p=s[0]instanceof Xi,f=0,g=s;f<g.length;f++)if(g[f]instanceof Xi!==p)throw new re("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(p){var y=[e].concat(s),x=this.inputSpec.concat(u),b=this.inputSpec;this.inputSpec=x;var _=r.prototype.apply.call(this,y,n);return this.inputSpec=b,_}return r.prototype.apply.call(this,e,n)},t.prototype.call=function(e,n){var i=this;return ue(function(){if(n.mask!=null)throw new mt("The support for masking is not implemented for Bidirectional layers yet.");var o,a,s,u,c=n.initialState;if(c==null)o=i.forwardLayer.call(e,n),a=i.backwardLayer.call(e,n);else{var d=c.slice(0,c.length/2),p=c.slice(c.length/2);o=i.forwardLayer.call(e,Object.assign(n,{initialState:d})),a=i.backwardLayer.call(e,Object.assign(n,{initialState:p}))}return i.returnState&&(Array.isArray(o)&&(s=o.slice(1).concat(a.slice(1))),o=o[0],a=a[0]),i.returnSequences&&(a=Oo(a,1)),i.mergeMode==="concat"?u=zD([o,a]):i.mergeMode==="sum"?u=yt(o,a):i.mergeMode==="ave"?u=ot(.5,yt(o,a)):i.mergeMode==="mul"?u=ot(o,a):i.mergeMode==null&&(u=[o,a]),i.returnState?i.mergeMode==null?u.concat(s):[u].concat(s):u})},t.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},t.prototype.build=function(e){var n=this;Lu(this.forwardLayer.name,function(){n.forwardLayer.build(e)}),Lu(this.backwardLayer.name,function(){n.backwardLayer.build(e)}),this.built=!0},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(e){r.prototype.setFastWeightInitDuringBuild.call(this,e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)},t.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(e,n),e},t.fromConfig=function(e,n){var i=Qi(n.layer);if(delete n.layer,n.numConstants!=null)throw new mt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var o=n;return o.layer=i,new e(o)},t.className="Bidirectional",t}(_P);function OH(r){return new Sp(r)}function PH(r){return new xO(r)}function MH(r){return new yO(r)}function LH(r){return new wO(r)}function FH(r){return new bO(r)}function zH(r){return new EO(r)}function VH(r){return new _O(r)}function BH(r){return new RO(r)}function UH(r){return new S_(r)}function jH(r){return new TO(r)}function WH(r){return new SO(r)}function qH(r){return new AO(r)}function HH(r){return new kO(r)}function $H(r){return new NO(r)}function GH(r){return new DO(r)}function KH(r){return new LO(r)}function XH(r){return new PO(r)}function QH(r){return new OO(r)}function YH(r){return new MO(r)}function JH(r){return new FO(r)}function ZH(r){return new zO(r)}function e$(r){return new VO(r)}function t$(r){return new UO(r)}function n$(r){return new jO(r)}function r$(r){return new qO(r)}function i$(r){return new GO(r)}function o$(r){return new HO(r)}function a$(r){return new $O(r)}function s$(r){return new WO(r)}function u$(r){return new KO(r)}function l$(r){return new JO(r)}function c$(r){return new ZO(r)}function h$(r){return new eP(r)}function N_(r){return new iP(r)}function d$(r){return N_(r)}function p$(r){return N_(r)}function D_(r){return new sP(r)}function f$(r){return D_(r)}function m$(r){return D_(r)}function O_(r){return new cP(r)}function g$(r){return O_(r)}function v$(r){return O_(r)}function y$(r){return new dP(r)}function w$(r){return new mP(r)}function CP(r){return new pP(r)}function SP(r){return new gP(r)}function TP(r){return new rP(r)}function AP(r){return new aP(r)}function b$(r){return new lP(r)}function x$(r){return new bP(r)}function _$(r){return new A_(r)}function E$(r){return new xP(r)}function I$(r){return new R_(r)}function C$(r){return new wP(r)}function S$(r){return new T_(r)}function T$(r){return new ul(r)}function A$(r){return new k_(r)}function R$(r){return new IP(r)}function k$(r){return new EP(r)}be.registerClass(IP);var N$=CP,D$=SP,O$=TP,P$=AP;function M$(r){return new XO(r)}function L$(r){return new QO(r)}function F$(r){return new YO(r)}function z$(r){return new BO(r)}var V$=Object.freeze({inputLayer:OH,elu:PH,reLU:MH,leakyReLU:LH,prelu:FH,softmax:zH,thresholdedReLU:VH,conv1d:BH,conv2d:UH,conv2dTranspose:jH,conv3d:WH,separableConv2d:qH,cropping2D:HH,upSampling2d:$H,depthwiseConv2d:GH,activation:KH,dense:XH,dropout:QH,flatten:YH,repeatVector:JH,reshape:ZH,permute:e$,embedding:t$,add:n$,average:r$,concatenate:i$,maximum:o$,minimum:a$,multiply:s$,dot:u$,batchNormalization:l$,layerNormalization:c$,zeroPadding2d:h$,averagePooling1d:N_,avgPool1d:d$,avgPooling1d:p$,averagePooling2d:D_,avgPool2d:f$,avgPooling2d:m$,averagePooling3d:O_,avgPool3d:g$,avgPooling3d:v$,globalAveragePooling1d:y$,globalAveragePooling2d:w$,globalMaxPooling1d:CP,globalMaxPooling2d:SP,maxPooling1d:TP,maxPooling2d:AP,maxPooling3d:b$,gru:x$,gruCell:_$,lstm:E$,lstmCell:I$,simpleRNN:C$,simpleRNNCell:S$,rnn:T$,stackedRNNCells:A$,bidirectional:R$,timeDistributed:k$,globalMaxPool1d:N$,globalMaxPool2d:D$,maxPool1d:O$,maxPool2d:P$,Layer:St,RNN:ul,RNNCell:Tp,input:mO,gaussianNoise:M$,gaussianDropout:L$,alphaDropout:F$,masking:z$});function B$(r,t){return w_(r,t)}function U$(r,t){return sO(r,t)}function j$(r,t){return uO(r,t)}function W$(r,t){return b_(r,t)}function q$(r,t){return x_(r,t)}function H$(r,t){return aO(r,t)}function $$(r,t){return b9(r,t)}function G$(r,t){return y_(r,t)}function K$(r,t){return Bv(r,t)}function X$(r,t){return oh(r,t)}function Q$(r,t){return oh(r,t)}function Y$(r,t){return oh(r,t)}function J$(r,t){return al(r,t)}function Z$(r,t){return al(r,t)}function eG(r,t){return al(r,t)}var tG=Object.freeze({binaryAccuracy:B$,binaryCrossentropy:U$,sparseCategoricalAccuracy:j$,categoricalAccuracy:W$,categoricalCrossentropy:q$,precision:H$,recall:$$,cosineProximity:G$,meanAbsoluteError:K$,meanAbsolutePercentageError:X$,MAPE:Q$,mape:Y$,meanSquaredError:J$,MSE:Z$,mse:eG}),nG=Object.freeze({modelFromJSON:tH});function rG(r){return new Wv(r)}function iG(r){return bH(r)}function oG(r){return xH(r)}var aG=Object.freeze({l1l2:rG,l1:iG,l2:oG}),RP=function(r){function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.model=null,e}return ge(t,r),t.prototype.setModel=function(e){if(!(e instanceof zu))throw new Error("model must be a LayersModel, not some other Container");this.model=e},t}(zc);function lm(r,t){return r<t}function bT(r,t){return r>t}var kP=function(r){function t(e){var n=r.call(this)||this;if(e==null&&(e={}),e.restoreBestWeights)throw new mt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=e.monitor||"val_loss",n.minDelta=Math.abs(e.minDelta||0),n.patience=e.patience||0,n.verbose=e.verbose||0,n.mode=e.mode||"auto",n.baseline=e.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=lm:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=bT:n.monitorFunc=lm,n.monitorFunc===lm&&(n.minDelta*=-1),n}return ge(t,r),t.prototype.onTrainBegin=function(e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===lm?1/0:-1/0,[2]})})},t.prototype.onEpochEnd=function(e,n){return rt(this,void 0,void 0,function(){var i;return Ye(this,function(o){switch(o.label){case 0:return[4,rs(n)];case 1:return o.sent(),(i=this.getMonitorValue(n))==null?[2]:(this.monitorFunc(i-this.minDelta,this.best)?(this.best=i,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)),[2])}})})},t.prototype.onTrainEnd=function(e){return rt(this,void 0,void 0,function(){return Ye(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},t.prototype.getMonitorValue=function(e){e==null&&(e={});var n=e[this.monitor];return n==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(e)),n},t}(RP);function sG(r){return new kP(r)}var uG={earlyStopping:sG};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ia,xT,y1=function(){return(y1=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i]);return r}).apply(this,arguments)};function Gu(r,t,e,n){return new(e||(e=Promise))(function(i,o){function a(c){try{u(n.next(c))}catch(d){o(d)}}function s(c){try{u(n.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):new e(function(d){d(c.value)}).then(a,s)}u((n=n.apply(r,[])).next())})}function Ku(r,t){var e,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,n&&(i=2&d[0]?n.return:d[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,d[1])).done)return i;switch(n=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return a.label++,{value:d[1],done:!1};case 5:a.label++,n=d[1],d=[0];continue;case 7:d=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){a=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){a.label=d[1];break}if(d[0]===6&&a.label<i[1]){a.label=i[1],i=d;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(d);break}i[2]&&a.ops.pop(),a.trys.pop();continue}d=t.call(r,a)}catch(p){d=[6,p],n=0}finally{e=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,c])}}}(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})(ia||(ia={})),function(r){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))}(xT||(xT={}));var P_={};function lG(r,t){var e={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:t};P_[r]=e}function NP(r){return P_[r]}function cG(r){delete P_[r]}function B(r,t,e,n){var i=t.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,a=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return Tr(t.inputNames[i.inputIndexStart],e,n);if(i.type==="tensors")return t.inputNames.slice(o,a).map(function(c){return Tr(c,e,n)});var s=Array.prototype.slice.call(Tr(t.inputNames.slice(o)[0],e,n).dataSync());return i.type==="number"?s[0]:s}var u=t.attrParams[r];return u&&u.value}function Tr(r,t,e){var n=wd(r),i=n[0],o=n[1],a=e.currentContextIds.find(function(s){return!!t[_g(i,s)]});return a!==void 0?t[_g(i,a)][o]:void 0}function hG(r,t,e){return t[_g(r,e.currentContextId)]}function Dm(r,t){var e=wd(r),n=e[0],i=e[1];return[_g(n,t&&t.currentContextId),i]}function _g(r,t){return t?r+"-"+t:r}function wd(r){var t=r.lastIndexOf(":");return t===-1?[r,0]:[r.substring(0,t),Number(r.substring(t+1))]}function uw(r,t){for(var e=[],n=0;n<r.length;n+=t)e.push(r.slice(n,n+t));return e}var dG=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],pG=Object.freeze({json:dG}),fG=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],mG=Object.freeze({json:fG}),gG=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}],vG=Object.freeze({json:gG}),yG=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}],wG=Object.freeze({json:yG}),bG=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],xG=Object.freeze({json:bG}),_G=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],EG=Object.freeze({json:_G}),IG=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}],CG=Object.freeze({json:IG}),SG=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],TG=Object.freeze({json:SG}),AG=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],RG=Object.freeze({json:AG}),kG=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],NG=Object.freeze({json:kG}),DG=[{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],OG=Object.freeze({json:DG}),PG=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],MG=Object.freeze({json:PG}),LG=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}],FG=Object.freeze({json:LG}),zG=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],VG=Object.freeze({json:zG}),BG=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],UG=Object.freeze({json:BG}),jG=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}],WG=Object.freeze({json:jG}),qG=function(){function r(){var t=[pG,mG,vG,wG,xG,EG,CG,NG,RG,TG,OG,MG,FG,VG,UG,WG],e=[].concat.apply([],t.map(function(n){return n.json}));this.opMappers=e.reduce(function(n,i){return n[i.tfOpName]=i,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),r.prototype.transformGraph=function(t){var e=this,n=[],i=[],o=t.node.reduce(function(c,d){return c[d.name]=e.mapNode(d),d.op==="Placeholder"&&n.push(c[d.name]),d.op==="Const"&&i.push(c[d.name]),c},{}),a=[],s=[],u=Object.keys(o);return u.forEach(function(c){var d=o[c];d.inputNames.forEach(function(p){var f=Dm(p)[0];d.inputs.push(o[f]),o[f].children.push(d)}),d.inputs.length===0&&a.push(d)}),u.forEach(function(c){var d=o[c];d.children.length===0&&s.push(d)}),{nodes:o,inputs:a,outputs:s,weights:i,placeholders:n}},r.prototype.mapNode=function(t){var e=NP(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});var n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(function(i){return i.startsWith("^")?i.substr(1):i}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr};return e.inputs!=null&&(n.inputParams=e.inputs.reduce(function(i,o){return i[o.name]={type:o.type,inputIndexStart:o.start,inputIndexEnd:o.end},i},{})),e.attrs!=null&&(n.attrParams=e.attrs.reduce(function(i,o){var a=o.type,s=void 0;switch(o.type){case"string":(s=w1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=w1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"string[]":(s=S1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=S1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"number":(s=x1(t.attr,o.tfName,o.defaultValue||0))===void 0&&o.tfDeprecatedName&&(s=x1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"number[]":(s=C1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=C1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool":(s=b1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=b1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool[]":(s=A1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=A1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape":(s=I1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=I1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape[]":(s=T1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=T1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype":(s=_1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=_1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype[]":(s=E1(t.attr,o.tfName,o.defaultValue))===void 0&&o.tfDeprecatedName&&(s=E1(t.attr,o.tfDeprecatedName,o.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+o.type+" for op: "+t.op)}return i[o.name]={value:s,type:a},i},{})),n},r}();function HG(r){var t=he().global;if(t.atob!==void 0)return t.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function DP(r,t){var e=Array.isArray(r)?String.fromCharCode.apply(null,r):HG(r);return t?e:e.toLowerCase()}function w1(r,t,e,n){n===void 0&&(n=!1);var i=r[t];return i!=null?DP(i.s,n):e}function b1(r,t,e){var n=r[t];return n?n.b:e}function x1(r,t,e){var n=r[t]||{},i=n.i!=null?n.i:n.f!=null?n.f:e;return typeof i=="number"?i:parseInt(i,10)}function OP(r){switch(typeof r=="string"&&(r=ia[r]),r){case ia.DT_FLOAT:return"float32";case ia.DT_INT32:case ia.DT_INT64:return"int32";case ia.DT_BOOL:return"bool";case ia.DT_DOUBLE:return"float32";case ia.DT_STRING:return"string";default:return null}}function _1(r,t,e){var n=r[t];return n&&n.type?OP(n.type):e}function E1(r,t,e){var n=r[t];return n&&n.list&&n.list.type?n.list.type.map(function(i){return OP(i)}):e}function PP(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(t){return typeof t.size=="number"?t.size:parseInt(t.size,10)}):[]}function I1(r,t,e){var n=r[t];return n&&n.shape?PP(n.shape):e}function C1(r,t,e){var n=r[t];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(i){return typeof i=="number"?i:parseInt(i,10)}):e}function S1(r,t,e,n){n===void 0&&(n=!1);var i=r[t];return i&&i.list&&i.list.s?i.list.s.map(function(o){return DP(o,n)}):e}function T1(r,t,e){var n=r[t];return n&&n.list&&n.list.shape?n.list.shape.map(function(i){return PP(i)}):e}function A1(r,t,e){var n=r[t];return n&&n.list&&n.list.b?n.list.b:e}var $G=function(){function r(t,e,n){var i=this;this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(function(o){return i.getInput(o)}),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce(function(o,a){return o[a]=i.getAttr(a),o},{}))}return r.prototype.getInput=function(t){return Tr(t,this.tensorMap,this.context)},r.prototype.getAttr=function(t,e){var n=this.node.rawAttrs[t];if(n.tensor!=null)return Tr(t,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return x1(this.node.rawAttrs,t,e);if(n.s!=null)return w1(this.node.rawAttrs,t,e);if(n.b!=null)return b1(this.node.rawAttrs,t,e);if(n.shape!=null)return I1(this.node.rawAttrs,t,e);if(n.type!=null)return _1(this.node.rawAttrs,t,e);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return C1(this.node.rawAttrs,t,e);if(n.list.s!=null)return S1(this.node.rawAttrs,t,e);if(n.list.shape!=null)return T1(this.node.rawAttrs,t,e);if(n.list.b!=null)return A1(this.node.rawAttrs,t,e);if(n.list.type!=null)return E1(this.node.rawAttrs,t,e)}return e},r}(),GG=function(r,t,e){switch(r.op){case"BiasAdd":case"AddV2":case"Add":return[yt(B("a",r,t,e),B("b",r,t,e))];case"AddN":return[Rx(B("tensors",r,t,e))];case"FloorMod":case"Mod":return[Nx(B("a",r,t,e),B("b",r,t,e))];case"Mul":return[ot(B("a",r,t,e),B("b",r,t,e))];case"RealDiv":case"Div":return[xr(B("a",r,t,e),B("b",r,t,e))];case"FloorDiv":return[mv(B("a",r,t,e),B("b",r,t,e))];case"Sub":return[Yn(B("a",r,t,e),B("b",r,t,e))];case"Minimum":return[Zc(B("a",r,t,e),B("b",r,t,e))];case"Maximum":return[Fo(B("a",r,t,e),B("b",r,t,e))];case"Pow":return[Nc(B("a",r,t,e),B("b",r,t,e))];case"SquaredDifference":return[Dx(B("a",r,t,e),B("b",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}},KG=function(r,t,e){switch(r.op){case"Abs":case"ComplexAbs":return[ks(B("x",r,t,e))];case"Acos":return[ox(B("x",r,t,e))];case"Acosh":return[ax(B("x",r,t,e))];case"Asin":return[sx(B("x",r,t,e))];case"Asinh":return[ux(B("x",r,t,e))];case"Atan":return[lx(B("x",r,t,e))];case"Atan2":return[kx(B("x",r,t,e),B("y",r,t,e))];case"Atanh":return[cx(B("x",r,t,e))];case"Ceil":return[hx(B("x",r,t,e))];case"Complex":return[Ln(B("real",r,t,e),B("imag",r,t,e))];case"Cos":return[dx(B("x",r,t,e))];case"Cosh":return[px(B("x",r,t,e))];case"Elu":return[rh(B("x",r,t,e))];case"Erf":return[fx(B("x",r,t,e))];case"Exp":return[mx(B("x",r,t,e))];case"Expm1":return[gx(B("x",r,t,e))];case"Floor":return[uv(B("x",r,t,e))];case"Log":return[Ea(B("x",r,t,e))];case"Log1p":return[vx(B("x",r,t,e))];case"Imag":return[Ci(B("x",r,t,e))];case"Neg":return[rl(B("x",r,t,e))];case"Reciprocal":return[yx(B("x",r,t,e))];case"Real":return[Wr(B("x",r,t,e))];case"Relu":return[js(B("x",r,t,e))];case"Round":return[wx(B("x",r,t,e))];case"Selu":return[Nv(B("x",r,t,e))];case"Sigmoid":return[cv(B("x",r,t,e))];case"Sin":return[xx(B("x",r,t,e))];case"Sign":return[bx(B("x",r,t,e))];case"Sinh":return[_x(B("x",r,t,e))];case"Softplus":return[hp(B("x",r,t,e))];case"Sqrt":return[dp(B("x",r,t,e))];case"Square":return[ix(B("x",r,t,e))];case"Tanh":return[hv(B("x",r,t,e))];case"Tan":return[Ex(B("x",r,t,e))];case"Relu6":case"ClipByValue":return[Rr(B("x",r,t,e),B("clipValueMin",r,t,e),B("clipValueMax",r,t,e))];case"Rsqrt":return[lv(Tr(r.inputNames[0],t,e))];case"Prod":return[Av(B("x",r,t,e),B("axes",r,t,e))];case"LeakyRelu":return[Rv(B("x",r,t,e),B("alpha",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}},XG=function(){function r(t,e,n,i,o,a,s){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=i,this.identicalElementShapes=o,this.dynamicSize=a,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=r.nextId++}return Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),r.prototype.clearAndClose=function(){this.tensors.forEach(function(t){return t.tensor.dispose()}),this.tensors=[],this.closed_=!0},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||t>=this.tensors.length)throw new Error("Tried to read from index "+t+", but array size is: "+this.tensors.length);var e=this.tensors[t];if(e.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+t+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor},r.prototype.readMany=function(t){var e=this;return t.map(function(n){return e.read(n)})},r.prototype.write=function(t,e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error("Tried to write to index "+t+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+`,
          because the value dtype is `+e.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=e.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,e.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+t+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been written.");n.tensor=e,n.written=!0,this.tensors[t]=n},r.prototype.writeMany=function(t,e){var n=this;if(t.length!==e.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+t.length+" is not the same as tensors size: "+e.length+".");t.forEach(function(i,o){return n.write(i,e[o])})},r.prototype.gather=function(t,e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+e);if(!t){t=[];for(var n=0;n<this.size();n++)t.push(n)}if(t.length===0)return xn([],[0].concat(this.elementShape));var i=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,i[0].shape,"TensorArray shape mismatch: "),Ji(i,0)},r.prototype.concat=function(t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+t);if(this.size()===0)return xn([],[0].concat(this.elementShape));for(var e=[],n=0;n<this.size();n++)e.push(n);var i=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,i[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+i[0].shape+")"),br(i,0)},r.prototype.scatter=function(t,e){if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var n=Math.max.apply(Math,t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(t,qu(e,0))},r.prototype.split=function(t,e){var n=this;if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);var i=0,o=t.map(function(d){return i+=d});if(i!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+i+", and tensor's shape is: "+e.shape);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+t.length+"), and the TensorArray is not marked as dynamically resizeable");var a=i===0?0:e.size/i,s=[];ue(function(){e=e.reshape([1,i,a]);for(var d=0;d<t.length;++d){var p=[0,d===0?0:o[d-1],0],f=[1,t[d],a];s[d]=hi(e,p,f).reshape(n.elementShape)}return s});for(var u=[],c=0;c<t.length;c++)u[c]=c;this.writeMany(u,s)},r.prototype.assertShapesMatchAllowUndefinedSize=function(t,e,n){n===void 0&&(n=""),Ge.assert(this.shapesEqualAllowUndefinedSize(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})},r.prototype.shapesEqualAllowUndefinedSize=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==-1&&e[n]!==-1&&t[n]!==e[n])return!1;return!0},r.nextId=0,r}();function QG(r,t,e){return Gu(this,void 0,void 0,function(){var n,i,o,a,s,u,c,d,p,f,g,y,x,b,_,C,T,D,O,z,I,S,A,N,P,M,F,G,Z,Y,ee,H,ie,J,q;return Ku(this,function(ne){switch(ne.label){case 0:switch(r.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[B("pred",r,t,e).clone()]];case 2:return n=B("pred",r,t,e),i=B("data",r,t,e),[4,n.data()];case 3:return[2,ne.sent()[0]?[void 0,i.clone()]:[i.clone(),void 0]];case 4:return[2,(o=r.inputNames.find(function(me){return Tr(me,t,e)!==void 0}))?[Tr(o,t,e).clone()]:void 0];case 5:return a=B("frameName",r,t,e),s=B("tensor",r,t,e),e.enterFrame(a),[2,[s.clone()]];case 6:return u=B("tensor",r,t,e),e.exitFrame(),[2,[u.clone()]];case 7:return c=B("tensor",r,t,e),e.nextIteration(),[2,[c.clone()]];case 8:return d=B("size",r,t,e),p=B("dtype",r,t,e),f=B("elementShape",r,t,e),g=B("dynamicSize",r,t,e),y=B("clearAfterRead",r,t,e),x=B("identicalElementShapes",r,t,e),b=B("name",r,t,e),_=new XG(b,p,d,f,x,g,y),e.addTensorArray(_),[2,[Ve(_.id),Ve(1)]];case 9:return C=B("tensorArrayId",r,t,e),T=B("index",r,t,e),D=B("tensor",r,t,e),e.getTensorArray(C).write(T,D),[2,[Ve(1)]];case 10:return O=B("tensorArrayId",r,t,e),z=B("index",r,t,e),[2,[e.getTensorArray(O).read(z)]];case 11:return I=B("tensorArrayId",r,t,e),S=B("indices",r,t,e),A=B("dtype",r,t,e),[2,[e.getTensorArray(I).gather(S,A)]];case 12:return N=B("tensorArrayId",r,t,e),P=B("indices",r,t,e),M=B("tensor",r,t,e),e.getTensorArray(N).scatter(P,M),[2,[Ve(1)]];case 13:return F=B("tensorArrayId",r,t,e),G=e.getTensorArray(F),Z=B("dtype",r,t,e),[2,[G.concat(Z)]];case 14:return Y=B("tensorArrayId",r,t,e),ee=B("tensor",r,t,e),H=B("lengths",r,t,e),e.getTensorArray(Y).split(H,ee),[2,[Ve(1)]];case 15:return ie=B("tensorArrayId",r,t,e),J=e.getTensorArray(ie),[2,[Ve(J.size(),"int32")]];case 16:return q=B("tensorArrayId",r,t,e),e.getTensorArray(q).clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+r.op+" is not implemented")}})})}var YG=function(r,t,e){var n,i;switch(r.op){case"Conv1D":var o=B("stride",r,t,e),a=B("pad",r,t,e),s=B("dataFormat",r,t,e).toUpperCase(),u=B("dilation",r,t,e);return[vv(B("x",r,t,e),B("filter",r,t,e),o,a,s,u)];case"Conv2D":o=B("strides",r,t,e),a=B("pad",r,t,e),s=B("dataFormat",r,t,e).toUpperCase();var c=B("dilations",r,t,e);return[ol(B("x",r,t,e),B("filter",r,t,e),[o[1],o[2]],a,s,[c[1],c[2]])];case"_FusedConv2D":var d=(n=B("fusedOps",r,t,e))[0],p=n[1],f=d==="biasadd",g=p==="prelu",y=d==="fusedbatchnorm",x=B("numArgs",r,t,e);if(f){if(g&&x!==2)throw new Error("Fused Conv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!g&&x!==1)throw new Error("Fused Conv2d with BiasAdd must have one extra argument: bias.")}if(y)throw new Error("Fused Conv2d with FusedBatchNorm is not supported.");o=B("strides",r,t,e),a=B("pad",r,t,e),s=B("dataFormat",r,t,e).toUpperCase(),c=B("dilations",r,t,e);var b=(i=B("args",r,t,e))[0],_=i[1];return[Mc.conv2d({x:B("x",r,t,e),filter:B("filter",r,t,e),strides:[o[1],o[2]],pad:a,dataFormat:s,dilations:[c[1],c[2]],bias:b,activation:p,preluActivationWeights:_})];case"Conv2DBackpropInput":case"Conv2dTranspose":var C=B("outputShape",r,t,e);return o=B("strides",r,t,e),a=B("pad",r,t,e),[wv(B("x",r,t,e),B("filter",r,t,e),C,[o[1],o[2]],a)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return o=B("strides",r,t,e),a=B("pad",r,t,e),c=B("dilations",r,t,e),s=B("dataFormat",r,t,e).toUpperCase(),[nh(B("input",r,t,e),B("filter",r,t,e),[o[1],o[2]],a,s,[c[1],c[2]])];case"Conv3D":return o=B("strides",r,t,e),a=B("pad",r,t,e),s=B("dataFormat",r,t,e).toUpperCase(),c=B("dilations",r,t,e),[yv(B("x",r,t,e),B("filter",r,t,e),[o[1],o[2],o[3]],a,s,[c[1],c[2],c[3]])];case"AvgPool":o=B("strides",r,t,e),a=B("pad",r,t,e);var T=B("kernelSize",r,t,e);return[_v(B("x",r,t,e),[T[1],T[2]],[o[1],o[2]],a)];case"MaxPool":return o=B("strides",r,t,e),a=B("pad",r,t,e),T=B("kernelSize",r,t,e),[xv(B("x",r,t,e),[T[1],T[2]],[o[1],o[2]],a)];case"AvgPool3D":return o=B("strides",r,t,e),a=B("pad",r,t,e),T=B("kernelSize",r,t,e),[Iv(B("x",r,t,e),[T[1],T[2],T[3]],[o[1],o[2],o[3]],a)];case"MaxPool3D":return o=B("strides",r,t,e),a=B("pad",r,t,e),T=B("kernelSize",r,t,e),[Ev(B("x",r,t,e),[T[1],T[2],T[3]],[o[1],o[2],o[3]],a)];default:throw TypeError("Node type "+r.op+" is not implemented")}},JG=function(r,t,e){switch(r.op){case"Fill":var n=B("shape",r,t,e),i=B("dtype",r,t,e),o=B("value",r,t,e);return[Yc(n,o,i)];case"LinSpace":var a=B("start",r,t,e),s=B("stop",r,t,e),u=B("num",r,t,e);return[Lb(a,s,u)];case"Multinomial":var c=B("logits",r,t,e),d=B("numSamples",r,t,e),p=B("seed",r,t,e);return[Wb(c,d,p)];case"OneHot":var f=B("indices",r,t,e),g=B("depth",r,t,e),y=B("onValue",r,t,e),x=B("offValue",r,t,e);return[Rc(f,g,y,x)];case"Ones":return[Lo(B("shape",r,t,e),B("dtype",r,t,e))];case"OnesLike":return[ci(B("x",r,t,e))];case"RandomUniform":return[tl(B("shape",r,t,e),B("minval",r,t,e),B("maxval",r,t,e),B("dtype",r,t,e))];case"Range":a=B("start",r,t,e);var b=B("stop",r,t,e),_=B("step",r,t,e);return[Jg(a,b,_,B("dtype",r,t,e))];case"TruncatedNormal":n=B("shape",r,t,e);var C=B("mean",r,t,e),T=B("stdDev",r,t,e);return p=B("seed",r,t,e),[lp(n,C,T,B("dtype",r,t,e),p)];case"Zeros":return[zt(B("shape",r,t,e),B("dtype",r,t,e))];case"ZerosLike":return[Ct(B("x",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}};function ZG(r,t,e){return Gu(this,void 0,void 0,function(){var n,i,o,a,s;return Ku(this,function(u){switch(u.label){case 0:switch(r.op){case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,3];case"ListDiff":return[3,5]}return[3,6];case 1:return n=B("boxes",r,t,e),i=B("scores",r,t,e),o=B("maxOutputSize",r,t,e),a=B("iouThreshold",r,t,e),s=B("scoreThreshold",r,t,e),[4,Mu.nonMaxSuppressionAsync(n,i,o,a,s)];case 2:return[2,[u.sent()]];case 3:return[4,fv(B("condition",r,t,e).asType("bool"))];case 4:return[2,[u.sent()]];case 5:return[2,Hb(B("x",r,t,e),B("y",r,t,e))];case 6:throw TypeError("Node type "+r.op+" is not implemented")}})})}var eK=function(r,t,e){switch(r.op){case"TopKV2":var n=B("x",r,t,e),i=B("k",r,t,e),o=B("sorted",r,t,e),a=Wx(n,i,o);return[a.values,a.indices];default:throw TypeError("Node type "+r.op+" is not implemented")}},tK=function(r,t,e){switch(r.op){case"Const":return t[r.name];case"PlaceholderWithDefault":var n=B("default",r,t,e);return[Tr(r.name,t,e)||n];case"Placeholder":return[Tr(r.name,t,e)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[B("x",r,t,e).clone()];case"IdentityN":return B("x",r,t,e).map(function(c){return c.clone()});case"Snapshot":return[B("x",r,t,e).clone()];case"Shape":return[$r(B("x",r,t,e).shape,"int32")];case"ShapeN":return B("x",r,t,e).map(function(c){return $r(c.shape)});case"Size":return[Ve(B("x",r,t,e).size,"int32")];case"Rank":return[Ve(B("x",r,t,e).rank,"int32")];case"NoOp":return[];case"Print":var i=B("x",r,t,e),o=B("data",r,t,e),a=B("message",r,t,e),s=B("summarize",r,t,e);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(var u=0;u<o.length;u++)console.log(Array.prototype.slice.call(o[u].dataSync()).slice(0,s));return[i];default:throw TypeError("Node type "+r.op+" is not implemented")}},nK=function(r,t,e){switch(r.op){case"ResizeBilinear":var n=B("images",r,t,e),i=B("size",r,t,e),o=B("alignCorners",r,t,e);return[Mu.resizeBilinear(n,[i[0],i[1]],o)];case"ResizeNearestNeighbor":return n=B("images",r,t,e),i=B("size",r,t,e),o=B("alignCorners",r,t,e),[Mu.resizeNearestNeighbor(n,[i[0],i[1]],o)];case"CropAndResize":var a=B("image",r,t,e),s=B("boxes",r,t,e),u=B("boxInd",r,t,e),c=B("cropSize",r,t,e),d=B("method",r,t,e),p=B("extrapolationValue",r,t,e);return[Mu.cropAndResize(a,s,u,c,d,p)];default:throw TypeError("Node type "+r.op+" is not implemented")}},rK=function(r,t,e){switch(r.op){case"Equal":return[il(B("a",r,t,e),B("b",r,t,e))];case"NotEqual":return[Dc(B("a",r,t,e),B("b",r,t,e))];case"Greater":return[eh(B("a",r,t,e),B("b",r,t,e))];case"GreaterEqual":return[fp(B("a",r,t,e),B("b",r,t,e))];case"Less":return[Ox(B("a",r,t,e),B("b",r,t,e))];case"LessEqual":return[Px(B("a",r,t,e),B("b",r,t,e))];case"LogicalAnd":return[Ra(B("a",r,t,e),B("b",r,t,e))];case"LogicalNot":return[Ax(B("a",r,t,e))];case"LogicalOr":return[pv(B("a",r,t,e),B("b",r,t,e))];case"Select":return[Ia(B("condition",r,t,e),B("a",r,t,e),B("b",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}},iK=function(r,t,e){switch(r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[bv(B("a",r,t,e),B("b",r,t,e),B("transposeA",r,t,e),B("transposeB",r,t,e))];case"Transpose":return[an(B("x",r,t,e),B("perm",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}},oK=function(r,t,e){switch(r.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Ix(B("x",r,t,e),B("mean",r,t,e),B("variance",r,t,e),B("offset",r,t,e),B("scale",r,t,e),B("epsilon",r,t,e))];case"LRN":return[Bx(B("x",r,t,e),B("radius",r,t,e),B("bias",r,t,e),B("alpha",r,t,e),B("beta",r,t,e))];case"Softmax":return[nl(B("x",r,t,e))];case"LogSoftmax":return[av(B("x",r,t,e))];case"SparseToDense":return[Ov(B("sparseIndices",r,t,e),B("outputShape",r,t,e),B("sparseValues",r,t,e),B("defaultValue",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}},aK=function(r,t,e){switch(r.op){case"Max":var n=B("axis",r,t,e),i=B("keepDims",r,t,e);return[Ns(B("x",r,t,e),n,i)];case"Mean":return n=B("axis",r,t,e),i=B("keepDims",r,t,e),[_n(B("x",r,t,e),n,i)];case"Min":return n=B("axis",r,t,e),i=B("keepDims",r,t,e),[Tv(B("x",r,t,e),n,i)];case"Sum":return n=B("axis",r,t,e),i=B("keepDims",r,t,e),[Gr(B("x",r,t,e),n,i)];case"All":return n=B("axis",r,t,e),i=B("keepDims",r,t,e),[Sv(B("x",r,t,e),n,i)];case"Any":return n=B("axis",r,t,e),i=B("keepDims",r,t,e),[Vd(B("x",r,t,e),n,i)];case"ArgMax":return n=B("axis",r,t,e),[Bd(B("x",r,t,e),n)];case"ArgMin":return n=B("axis",r,t,e),[zx(B("x",r,t,e),n)];case"Prod":return n=B("axis",r,t,e),i=B("keepDims",r,t,e),[Av(B("x",r,t,e),n,i)];default:throw TypeError("Node type "+r.op+" is not implemented")}},sK=function(r,t,e){switch(r.op){case"ConcatV2":case"Concat":var n=B("axis",r,t,e),i=B("tensors",r,t,e);return[br(i,n)];case"GatherV2":case"Gather":n=B("axis",r,t,e);var o=B("x",r,t,e),a=B("indices",r,t,e);return[th(o,a.asType("int32"),n)];case"ReverseV2":case"Reverse":return n=B("axis",r,t,e),o=B("x",r,t,e),[Oo(o,n)];case"Slice":var s=B("begin",r,t,e),u=B("size",r,t,e);return[hi(B("x",r,t,e),s,u)];case"StridedSlice":s=B("begin",r,t,e);var c=B("end",r,t,e),d=B("strides",r,t,e),p=B("beginMask",r,t,e),f=B("endMask",r,t,e),g=B("ellipsisMask",r,t,e),y=B("newAxisMask",r,t,e),x=B("shrinkAxisMask",r,t,e),b=B("x",r,t,e);if(s.length===1&&b.shape.length>1)for(var _=1;_<b.shape.length;_++)s.push(0),c.push(b.shape[_]),d.push(d[0]);return[jx(b,s,c,d,p,f,g,y,x)];case"Pack":return ue(function(){var A=B("axis",r,t,e),N=B("tensors",r,t,e),P=N[0].shape,M=N[0].squeeze().shape,F=N.map(function(G){var Z=Ge.arraysEqual(G.shape,P);if(!Z&&!Ge.arraysEqual(G.squeeze().shape,M))throw new Error("the input tensors shape does not match");return Z?G:G.reshape(P)});return[Ji(F,A)]});case"Unpack":return ue(function(){var A=B("axis",r,t,e),N=B("tensor",r,t,e);return qu(N,A)});case"Tile":var C=B("reps",r,t,e);return[ws(B("x",r,t,e),C)];case"Split":case"SplitV":n=B("axis",r,t,e);var T=B("numOrSizeSplits",r,t,e);return fa(B("x",r,t,e),T,n);case"ScatterNd":a=B("indices",r,t,e);var D=B("values",r,t,e),O=B("shape",r,t,e);return[qx(a,D,O)];case"GatherNd":var z=B("x",r,t,e);return a=B("indices",r,t,e),[Hx(z,a)];case"SparseToDense":a=B("sparseIndices",r,t,e),O=B("outputShape",r,t,e);var I=B("sparseValues",r,t,e),S=B("defaultValue",r,t,e);return[Ov(a,I,O,I.dtype===S.dtype?S:S.asType(I.dtype))];default:throw TypeError("Node type "+r.op+" is not implemented")}},uK=function(r,t,e){switch(r.op){case"FFT":return[yp(B("x",r,t,e))];case"IFFT":return[Pc(B("x",r,t,e))];case"RFFT":return[wp(B("x",r,t,e))];case"IRFFT":return[Dv(B("x",r,t,e))];default:throw TypeError("Node type "+r.op+" is not implemented")}},lK=function(r,t,e){switch(r.op){case"Cast":return[tv(B("x",r,t,e),B("dtype",r,t,e))];case"ExpandDims":var n=B("axis",r,t,e);return[ii(B("x",r,t,e),n)];case"Squeeze":return n=B("axis",r,t,e),[up(B("x",r,t,e),n)];case"Reshape":return[sp(B("x",r,t,e),B("shape",r,t,e))];case"PadV2":case"Pad":return[Bs(B("x",r,t,e),uw(B("padding",r,t,e),2),B("constantValue",r,t,e))];case"SpaceToBatchND":var i=B("blockShape",r,t,e),o=uw(B("paddings",r,t,e),2);return[rv(B("x",r,t,e),i,o)];case"BatchToSpaceND":i=B("blockShape",r,t,e);var a=uw(B("crops",r,t,e),2);return[ev(B("x",r,t,e),i,a)];case"DepthToSpace":var s=B("blockSize",r,t,e),u=B("dataFormat",r,t,e).toUpperCase();return[jb(B("x",r,t,e),s,u)];default:throw TypeError("Node type "+r.op+" is not implemented")}};function _T(r,t,e){var n=function(i,o,a){switch(i.category){case"arithmetic":return GG(i,o,a);case"basic_math":return KG(i,o,a);case"control":return QG(i,o,a);case"convolution":return YG(i,o,a);case"creation":return JG(i,o,a);case"dynamic":return ZG(i,o,a);case"evaluation":return eK(i,o,a);case"image":return nK(i,o,a);case"graph":return tK(i,o,a);case"logical":return rK(i,o,a);case"matrices":return iK(i,o,a);case"normalization":return oK(i,o,a);case"reduction":return aK(i,o,a);case"slice_join":return sK(i,o,a);case"spectral":return uK(i,o,a);case"transformation":return lK(i,o,a);case"custom":var s=NP(i.op);if(s&&s.customExecutor)return s.customExecutor(new $G(i,o,a));throw TypeError("Custom op "+i.op+" is not registered.");default:throw TypeError("Unknown op '"+i.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(r,t,e);return n instanceof Promise?n.then(function(i){return[].concat(i)}):[].concat(n)}var ET=function(){function r(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t},r.prototype.contextIdforContexts=function(t){return t?t.map(function(e){return e.id===0&&e.iterationId===0?"":e.frameName+"-"+e.iterationId}).join("/"):""},r.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},r.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},r.prototype.getWeight=function(t){return this.weightMap[t]},r.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},r.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},r}();function IT(r,t,e){for(var n=new Set,i=[],o=null,a=null,s=new Set,u=t.slice();u.length>0;){var c=u.pop();(MP(c)||pK(c))&&o==null&&(a=(o=c).children.map(function(d){return d.name}).filter(function(d){return n.has(d)})),n.add(c.name),e[c.name]==null&&r[c.name]==null&&(c.inputs.length!==0?c.inputs.forEach(function(d){s.has(d.name)||(s.add(d.name),u.push(d))}):i.push(c.name))}return{inputs:r,outputs:t,usedNodes:n,missingInputs:i,dynamicNode:o,syncInputs:a}}function cK(r,t,e){var n=e.usedNodes,i=e.inputs,o=[];Object.keys(i).map(function(c){return r.nodes[c]}).forEach(function(c){n.has(c.name)&&o.push(c)}),r.weights.forEach(function(c){n.has(c.name)&&o.push(c)});for(var a=new Set,s=[];o.length>0;){var u=o.pop();a.add(u.name),t[u.name]||s.push(u),u.children.forEach(function(c){!a.has(c.name)&&n.has(c.name)&&c.inputs.every(function(d){return a.has(d.name)})&&o.push(c)})}return s}var hK=["Switch","Merge","Enter","Exit","NextIteration"],dK=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"];function MP(r){return hK.indexOf(r.op)>=0}function pK(r){return dK.indexOf(r.op)>=0}var fK=function(){function r(t){this.graph=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=t.placeholders,this._outputs=t.outputs}return Object.defineProperty(r.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map(function(n){return t[n].map(function(i){return i.id})});this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.placeholders.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.outputs.map(function(t){return t.name})},enumerable:!0,configurable:!0}),r.prototype.getCompilationKey=function(t,e){var n=t.map(function(o){return o.name}).sort(),i=e.map(function(o){return o.name}).sort();return n.join(this.SEPERATOR)+"--"+i.join(this.SEPERATOR)},r.prototype.compile=function(t,e){var n=IT(t,e,this.weightMap),i=n.missingInputs,o=n.dynamicNode,a=n.syncInputs;if(o!=null)throw new Error("This execution contains the node '"+o.name+"', which has the dynamic op '"+o.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+a+"]");if(i.length>0){var s=e.map(function(c){return c.name}),u=Object.keys(t);throw new Error("Cannot compute the outputs ["+s+"] from the provided inputs ["+u+"]. Missing the following inputs: ["+i+"]")}return cK(this.graph,this.weightMap,n)},r.prototype.execute=function(t,e){var n=this,i=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),this.checkOutputs(e);var o=i.map(function(d){return n.graph.nodes[d]}),a=e.map(function(d){return n.graph.nodes[wd(d)[0]]}),s=this.getCompilationKey(o,a),u=this.compiledMap.get(s);u==null&&(u=this.compile(t,a),this.compiledMap.set(s,u));var c={};return ue(function(){var d=new ET(n._weightMap,c),p=y1({},n.weightMap);Object.keys(t).forEach(function(_){p[_]=[t[_]]});for(var f=n.getFrozenTensorIds(p),g={},y=0;y<u.length;y++){var x=u[y];if(!p[x.name]){var b=_T(x,p,d);if(b instanceof Promise)throw new Error("The execution of the op '"+x.op+"' returned a promise. Please use model.executeAsync() instead.");p[x.name]=b,n.checkTensorForDisposal(x.name,x,p,d,f,e,g)}}return e.map(function(_){return Tr(_,p,d)})})},r.prototype.getFrozenTensorIds=function(t){var e=[].concat.apply([],Object.keys(t).map(function(n){return t[n]}).map(function(n){return n.map(function(i){return i.id})}));return new Set(e)},r.prototype.checkTensorForDisposal=function(t,e,n,i,o,a,s){e.category!=="control"&&a.indexOf(t)===-1&&(n[t].forEach(function(u){u!=null&&(s[u.id]=(s[u.id]||0)+e.children.length)}),e.inputs.forEach(function(u){if(u.category!=="control"){var c=hG(u.name,n,i);c!=null&&c.forEach(function(d){if(d&&!o.has(d.id)){var p=s[d.id];p===1?(d.dispose(),delete s[d.id]):p!=null&&s[d.id]--}})}}))},r.prototype.executeAsync=function(t,e){return Gu(this,void 0,void 0,function(){var n,i,o,a,s,u,c=this;return Ku(this,function(d){switch(d.label){case 0:return this.checkInputs(t),this.checkInputShapeAndType(t),this.checkOutputs(e),n={},i=new ET(this._weightMap,n),[4,this.executeWithControlFlow(t,i,e)];case 1:return o=d.sent(),a=e.map(function(p){return Tr(p,o,i)}),s=new Set(a.map(function(p){return p.id})),u=new Set(Object.keys(t).map(function(p){return t[p].id})),Object.keys(o).forEach(function(p){o[p].forEach(function(f){!f||f.isDisposed||s.has(f.id)||u.has(f.id)||c.weightIds.indexOf(f.id)!==-1||f.dispose()})}),[2,a]}})})},r.prototype.executeWithControlFlow=function(t,e,n){return Gu(this,void 0,void 0,function(){var i,o,a,s,u,c,d,p,f,g,y,x,b,_,C,T,D=this;return Ku(this,function(O){switch(O.label){case 0:i=Object.keys(t),o=i.map(function(z){return D.graph.nodes[z]}),a=n.map(function(z){return D.graph.nodes[wd(z)[0]]}),s=IT(t,a,this.weightMap),u=s.usedNodes,c=s.missingInputs,d=s.dynamicNode,p=s.syncInputs,f=o.concat(this.graph.weights).map(function(z){return{node:z,contexts:e.currentContext}}),g=y1({},this.weightMap),Object.keys(t).forEach(function(z){g[z]=[t[z]]}),y={},x=this.getFrozenTensorIds(g),b={},O.label=1;case 1:return f.length>0?(_=this.processStack(o,f,e,g,b,x,n,y,u),[4,Promise.all(_)]):[3,3];case 2:return O.sent(),[3,1];case 3:if(d==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(C=a.filter(function(z){return!MP(z)&&!Tr(z.name,g,e)}).map(function(z){return z.name})).length>0)throw T="",d!=null&&(T="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+p+"]"),new Error("Cannot compute the outputs ["+C+"] from the provided inputs ["+i+"]. Consider providing the following inputs: ["+c+"]. "+T);return[2,g]}})})},r.prototype.processStack=function(t,e,n,i,o,a,s,u,c){for(var d=this,p=[],f=function(){var y=e.pop();n.currentContext=y.contexts;var x="";if(y.node.op==="Enter"&&B("isConstant",y.node,i,n)&&(x=Dm(y.node.name,n)[0]),t.indexOf(y.node)===-1){var b=_T(y.node,i,n);x||(x=Dm(y.node.name,n)[0]);var _=n.currentContext;b instanceof Promise?p.push(b.then(function(C){return i[x]=C,n.currentContext=_,d.checkTensorForDisposal(x,y.node,i,n,a,s,u),d.processChildNodes(y.node,e,n,i,o,c),C})):(i[x]=b,g.checkTensorForDisposal(x,y.node,i,n,a,s,u),g.processChildNodes(y.node,e,n,i,o,c))}else g.processChildNodes(y.node,e,n,i,o,c)},g=this;e.length>0;)f();return p},r.prototype.processChildNodes=function(t,e,n,i,o,a){t.children.forEach(function(s){var u=Dm(s.name,n)[0];!o[u]&&a.has(s.name)&&(s.op==="Merge"?s.inputNames.some(function(c){return!!Tr(c,i,n)})&&(o[u]=!0,e.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(c){return!!Tr(c,i,n)})&&(o[u]=!0,e.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach(function(e){return t.weightMap[e].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(t){var e=this;Object.keys(t).forEach(function(n){var i=t[n],o=e.graph.nodes[n];if(o.attrParams.shape&&o.attrParams.shape.value){var a=o.attrParams.shape.value,s=a.length===i.shape.length&&i.shape.every(function(u,c){return a[c]===-1||a[c]===u});Ge.assert(s,function(){return"The shape of dict['"+o.name+"'] provided in model.execute(dict) must be ["+a+"], but was ["+i.shape+"]"})}o.attrParams.dtype&&o.attrParams.dtype.value&&Ge.assert(i.dtype===o.attrParams.dtype.value,function(){return"The dtype of dict['"+o.name+"'] provided in model.execute(dict) must be "+o.attrParams.dtype.value+", but was "+i.dtype})})},r.prototype.checkInputs=function(t){var e=this,n=Object.keys(t).filter(function(i){return!e.graph.nodes[i]});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},r.prototype.checkOutputs=function(t){var e=this;t.forEach(function(n){var i=wd(n)[0];if(!e.graph.nodes[i])throw new Error("The output '"+n+"' is not found in the graph")})},r}(),mK="?tfjs-format=file",gK="model.json",LP=function(){function r(t,e){e===void 0&&(e={}),this.modelUrl=t,this.loadOptions=e,this.version="n/a",e==null&&(this.loadOptions={})}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),r.prototype.findIOHandler=function(){var t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=ui.browserHTTPRequest(t,this.loadOptions);else{var e=ui.getLoadHandlers(t,this.loadOptions.onProgress);if(e.length===0)e.push(ui.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error("Found more than one ("+e.length+") load handlers for URL '"+[t]+"'");this.handler=e[0]}},r.prototype.load=function(){return Gu(this,void 0,void 0,function(){var t,e,n;return Ku(this,function(i){switch(i.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return t=i.sent(),e=t.modelTopology,this.version=e.versions.producer+"."+e.versions.minConsumer,n=ui.decodeWeights(t.weightData,t.weightSpecs),this.executor=new fK(qG.Instance.transformGraph(e)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}})})},r.prototype.predict=function(t,e){return this.execute(t,this.outputNodes)},r.prototype.normalizeInputs=function(t){if(!(t instanceof Ut||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+t.length+" input tensors.");return this.inputNodes.reduce(function(e,n,i){return e[n]=t[i],e},{})},r.prototype.normalizeOutputs=function(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]},r.prototype.execute=function(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);var n=this.executor.execute(t,e);return n.length>1?n:n[0]},r.prototype.executeAsync=function(t,e){return Gu(this,void 0,void 0,function(){var n;return Ku(this,function(i){switch(i.label){case 0:return t=this.normalizeInputs(t),e=this.normalizeOutputs(e),[4,this.executor.executeAsync(t,e)];case 1:return[2,(n=i.sent()).length>1?n:n[0]]}})})},r.prototype.convertTensorMapToTensorsMap=function(t){return Object.keys(t).reduce(function(e,n){return e[n]=[t[n]],e},{})},r.prototype.dispose=function(){this.executor.dispose()},r}();function vK(r,t){return t===void 0&&(t={}),Gu(this,void 0,void 0,function(){var e;return Ku(this,function(n){switch(n.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return t==null&&(t={}),t.fromTFHub&&r.load==null&&(r.endsWith("/")||(r+="/"),r=""+r+gK+mK),[4,(e=new LP(r,t)).load()];case 1:return n.sent(),[2,e]}})})}var FP="1.3.1";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zP=function(r,t){return(zP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])})(r,t)};function Ft(r,t){function e(){this.constructor=r}zP(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function ke(r,t,e,n){return new(e||(e=Promise))(function(i,o){function a(c){try{u(n.next(c))}catch(d){o(d)}}function s(c){try{u(n.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):new e(function(d){d(c.value)}).then(a,s)}u((n=n.apply(r,[])).next())})}function Ne(r,t){var e,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,n&&(i=2&d[0]?n.return:d[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,d[1])).done)return i;switch(n=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return a.label++,{value:d[1],done:!1};case 5:a.label++,n=d[1],d=[0];continue;case 7:d=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){a=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){a.label=d[1];break}if(d[0]===6&&a.label<i[1]){a.label=i[1],i=d;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(d);break}i[2]&&a.ops.pop(),a.trys.pop();continue}d=t.call(r,a)}catch(p){d=[6,p],n=0}finally{e=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,c])}}}function ll(r,t){return r(t={exports:{}},t.exports),t.exports}var yK=ll(function(r){(function(t,e,n){function i(a,s){return s.c=a.c,s.s0=a.s0,s.s1=a.s1,s.s2=a.s2,s}function o(a,s){var u=new function(p){var f,g=this,y=(f=4022871197,function(x){x=x.toString();for(var b=0;b<x.length;b++){var _=.02519603282416938*(f+=x.charCodeAt(b));_-=f=_>>>0,f=(_*=f)>>>0,f+=4294967296*(_-=f)}return 23283064365386963e-26*(f>>>0)});g.next=function(){var x=2091639*g.s0+23283064365386963e-26*g.c;return g.s0=g.s1,g.s1=g.s2,g.s2=x-(g.c=0|x)},g.c=1,g.s0=y(" "),g.s1=y(" "),g.s2=y(" "),g.s0-=y(p),g.s0<0&&(g.s0+=1),g.s1-=y(p),g.s1<0&&(g.s1+=1),g.s2-=y(p),g.s2<0&&(g.s2+=1),y=null}(a),c=s&&s.state,d=u.next;return d.int32=function(){return 4294967296*u.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&i(c,u),d.state=function(){return i(u,{})}),d}e&&e.exports?e.exports=o:this.alea=o})(0,r)}),wK=ll(function(r){(function(t,e,n){function i(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s}function o(a,s){var u=new function(p){var f=this,g="";f.x=0,f.y=0,f.z=0,f.w=0,f.next=function(){var x=f.x^f.x<<11;return f.x=f.y,f.y=f.z,f.z=f.w,f.w^=f.w>>>19^x^x>>>8},p===(0|p)?f.x=p:g+=p;for(var y=0;y<g.length+64;y++)f.x^=0|g.charCodeAt(y),f.next()}(a),c=s&&s.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&i(c,u),d.state=function(){return i(u,{})}),d}e&&e.exports?e.exports=o:this.xor128=o})(0,r)}),bK=ll(function(r){(function(t,e,n){function i(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s.v=a.v,s.d=a.d,s}function o(a,s){var u=new function(p){var f=this,g="";f.next=function(){var x=f.x^f.x>>>2;return f.x=f.y,f.y=f.z,f.z=f.w,f.w=f.v,(f.d=f.d+362437|0)+(f.v=f.v^f.v<<4^x^x<<1)|0},f.x=0,f.y=0,f.z=0,f.w=0,f.v=0,p===(0|p)?f.x=p:g+=p;for(var y=0;y<g.length+64;y++)f.x^=0|g.charCodeAt(y),y==g.length&&(f.d=f.x<<10^f.x>>>4),f.next()}(a),c=s&&s.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&i(c,u),d.state=function(){return i(u,{})}),d}e&&e.exports?e.exports=o:this.xorwow=o})(0,r)}),xK=ll(function(r){(function(t,e,n){function i(a,s){return s.x=a.x.slice(),s.i=a.i,s}function o(a,s){a==null&&(a=+new Date);var u=new function(p){var f=this;f.next=function(){var g,y,x=f.x,b=f.i;return g=x[b],y=(g^=g>>>7)^g<<24,y^=(g=x[b+1&7])^g>>>10,y^=(g=x[b+3&7])^g>>>3,y^=(g=x[b+4&7])^g<<7,g=x[b+7&7],y^=(g^=g<<13)^g<<9,x[b]=y,f.i=b+1&7,y},function(g,y){var x,b=[];if(y===(0|y))b[0]=y;else for(y=""+y,x=0;x<y.length;++x)b[7&x]=b[7&x]<<15^y.charCodeAt(x)+b[x+1&7]<<13;for(;b.length<8;)b.push(0);for(x=0;x<8&&b[x]===0;++x);for(x==8?b[7]=-1:b[x],g.x=b,g.i=0,x=256;x>0;--x)g.next()}(f,p)}(a),c=s&&s.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,c&&(c.x&&i(c,u),d.state=function(){return i(u,{})}),d}e&&e.exports?e.exports=o:this.xorshift7=o})(0,r)}),_K=ll(function(r){(function(t,e,n){function i(a,s){return s.i=a.i,s.w=a.w,s.X=a.X.slice(),s}function o(a,s){a==null&&(a=+new Date);var u=new function(p){var f=this;f.next=function(){var g,y,x=f.w,b=f.X,_=f.i;return f.w=x=x+1640531527|0,y=b[_+34&127],g=b[_=_+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,y=b[_]=y^g,f.i=_,y+(x^x>>>16)|0},function(g,y){var x,b,_,C,T,D=[],O=128;for(y===(0|y)?(b=y,y=null):(y+="\0",b=0,O=Math.max(O,y.length)),_=0,C=-32;C<O;++C)y&&(b^=y.charCodeAt((C+32)%y.length)),C===0&&(T=b),b^=b<<10,b^=b>>>15,b^=b<<4,b^=b>>>13,C>=0&&(T=T+1640531527|0,_=(x=D[127&C]^=b+T)==0?_+1:0);for(_>=128&&(D[127&(y&&y.length||0)]=-1),_=127,C=512;C>0;--C)b=D[_+34&127],x=D[_=_+1&127],b^=b<<13,x^=x<<17,b^=b>>>15,x^=x>>>12,D[_]=b^x;g.w=T,g.X=D,g.i=_}(f,p)}(a),c=s&&s.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,c&&(c.X&&i(c,u),d.state=function(){return i(u,{})}),d}e&&e.exports?e.exports=o:this.xor4096=o})(0,r)}),EK=ll(function(r){(function(t,e,n){function i(a,s){return s.a=a.a,s.b=a.b,s.c=a.c,s.d=a.d,s}function o(a,s){var u=new function(p){var f=this,g="";f.next=function(){var x=f.b,b=f.c,_=f.d,C=f.a;return x=x<<25^x>>>7^b,b=b-_|0,_=_<<24^_>>>8^C,C=C-x|0,f.b=x=x<<20^x>>>12^b,f.c=b=b-_|0,f.d=_<<16^b>>>16^C,f.a=C-x|0},f.a=0,f.b=0,f.c=-1640531527,f.d=1367130551,p===Math.floor(p)?(f.a=p/4294967296|0,f.b=0|p):g+=p;for(var y=0;y<g.length+20;y++)f.b^=0|g.charCodeAt(y),f.next()}(a),c=s&&s.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&i(c,u),d.state=function(){return i(u,{})}),d}e&&e.exports?e.exports=o:this.tychei=o})(0,r)}),Iu=ll(function(r){(function(t,e){var n,i=this,o=256,a=6,s="random",u=e.pow(o,a),c=e.pow(2,52),d=2*c,p=o-1;function f(b,_,C){var T=[],D=y(function I(S,A){var N,P=[],M=typeof S;if(A&&M=="object")for(N in S)try{P.push(I(S[N],A-1))}catch{}return P.length?P:M=="string"?S:S+"\0"}((_=_==1?{entropy:!0}:_||{}).entropy?[b,x(t)]:b??function(){try{var I;return n&&(I=n.randomBytes)?I=I(o):(I=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(I)),x(I)}catch{var S=i.navigator,A=S&&S.plugins;return[+new Date,i,A,i.screen,x(t)]}}(),3),T),O=new function(I){var S,A=I.length,N=this,P=0,M=N.i=N.j=0,F=N.S=[];for(A||(I=[A++]);P<o;)F[P]=P++;for(P=0;P<o;P++)F[P]=F[M=p&M+I[P%A]+(S=F[P])],F[M]=S;(N.g=function(G){for(var Z,Y=0,ee=N.i,H=N.j,ie=N.S;G--;)Z=ie[ee=p&ee+1],Y=Y*o+ie[p&(ie[ee]=ie[H=p&H+Z])+(ie[H]=Z)];return N.i=ee,N.j=H,Y})(o)}(T),z=function(){for(var I=O.g(a),S=u,A=0;I<c;)I=(I+A)*o,S*=o,A=O.g(1);for(;I>=d;)I/=2,S/=2,A>>>=1;return(I+A)/S};return z.int32=function(){return 0|O.g(4)},z.quick=function(){return O.g(4)/4294967296},z.double=z,y(x(O.S),t),(_.pass||C||function(I,S,A,N){return N&&(N.S&&g(N,O),I.state=function(){return g(O,{})}),A?(e[s]=I,S):I})(z,D,"global"in _?_.global:this==e,_.state)}function g(b,_){return _.i=b.i,_.j=b.j,_.S=b.S.slice(),_}function y(b,_){for(var C,T=b+"",D=0;D<T.length;)_[p&D]=p&(C^=19*_[p&D])+T.charCodeAt(D++);return x(_)}function x(b){return String.fromCharCode.apply(0,b)}if(e["seed"+s]=f,y(e.random(),t),r.exports){r.exports=f;try{n=require("crypto")}catch{}}})([],Math)});Iu.alea=yK,Iu.xor128=wK,Iu.xorwow=bK,Iu.xorshift7=xK,Iu.xor4096=_K,Iu.tychei=EK;var IK=Iu,VP=IK.alea;function CK(r,t){return Eg(r,t)}function Eg(r,t,e,n){if(e===void 0&&(e=new Map),n===void 0&&(n=new Set),r==null)return null;if(n.has(r))throw new Error("Circular references are not supported.");if(e.has(r))return e.get(r);var i=t(r);if(i.recurse&&i.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(Bc(r)){var o=Array.isArray(r)?[]:{};for(var a in n.add(r),r){var s=Eg(r[a],t,e,n);o[a]=s}return n.delete(r),o}throw new Error("Can't recurse into non-iterable type: "+r)}return e.set(r,i.value),i.value}function SK(r,t){return t===void 0&&(t=UP),BP(r,t)}function BP(r,t,e){e===void 0&&(e=new Set);var n=r[0];if(e.has(n))throw new Error("Circular references are not supported.");var i=t(r);if(i.recurse&&i.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(Bc(n)){var o=Array.isArray(n)?[]:{};e.add(n);var a=function(u){var c=BP(r.map(function(d){return d[u]}),t,e);o[u]=c};for(var s in n)a(s);return e.delete(n),o}throw new Error("Can't recurse into non-iterable type: "+n)}return i.value}function UP(r){return r===null?null:Bc(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function jP(r,t){return ke(this,void 0,void 0,function(){var e,n,i,o,a,s;return Ne(this,function(u){switch(u.label){case 0:e=new Map,Eg(r,t,e),n=0,i=Array.from(e.keys()),u.label=1;case 1:return n<i.length?(o=i[n],(a=e.get(o))instanceof Promise?[4,a]:[3,3]):[3,4];case 2:s=u.sent(),e.set(o,s),u.label=3;case 3:return n++,[3,1];case 4:return[2,Eg(r,t,e)]}})})}function Bc(r){return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof Ut))}function TK(r){return r==null||AK(r)||Array.isArray(r)||typeof r=="object"&&r instanceof Ut||Ge.isTypedArray(r)}function AK(r){return r===null||typeof r!="object"&&typeof r!="function"}function RK(r){return CK(r,kK)}function kK(r){return r instanceof Ut?{value:r.clone(),recurse:!1}:Bc(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var WP=function(){function r(t){if(this.capacity=t,this.begin=0,this.end=0,t==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return r.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},r.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},r.prototype.set=function(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e},r.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];this.push(i)}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},r.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},r.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n},r}(),NK=function(r){function t(){return r.call(this,t.INITIAL_CAPACITY)||this}return Ft(t,r),t.prototype.isFull=function(){return!1},t.prototype.push=function(e){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,e)},t.prototype.unshift=function(e){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,e)},t.prototype.expand=function(){for(var e=2*this.capacity,n=new Array(e),i=this.length(),o=0;o<i;o++)n[o]=this.get(this.wrap(this.begin+o));this.data=n,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=i},t.INITIAL_CAPACITY=32,t}(WP);function qP(r){return new PK(r)}function M_(r){return new MK(r)}function DK(r,t){return new HP(r,t)}function OK(r,t){return t===void 0&&(t=ps.FAIL),new qK(r,t)}var ps,Un=function(){function r(){}return r.prototype.toArray=function(){return ke(this,void 0,void 0,function(){var t,e;return Ne(this,function(n){switch(n.label){case 0:return t=[],[4,this.next()];case 1:e=n.sent(),n.label=2;case 2:return e.done?[3,4]:(t.push(e.value),[4,this.next()]);case 3:return e=n.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.toArrayForTest=function(){return ke(this,void 0,void 0,function(){var t,e,n;return Ne(this,function(i){switch(i.label){case 0:return t=this.prefetch(100),e=[],[4,t.next()];case 1:n=i.sent(),i.label=2;case 2:return n.done?[3,4]:(e.push(n.value),[4,t.next()]);case 3:return n=i.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.resolveFully=function(){return ke(this,void 0,void 0,function(){var t;return Ne(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return t.done?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(t){return ke(this,void 0,void 0,function(){var e,n;return Ne(this,function(i){switch(i.label){case 0:return[4,this.next()];case 1:e=i.sent(),n=t(e.value),i.label=2;case 2:return e.done||!n?[3,4]:[4,this.next()];case 3:return e=i.sent(),n=t(e.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(t){return new jK(this,t)},r.prototype.filter=function(t){return new BK(this,t)},r.prototype.map=function(t){return new UK(this,t)},r.prototype.mapAsync=function(t){return new CT(this,t)},r.prototype.serialMapAsync=function(t){return new CT(this,t).serial()},r.prototype.flatmap=function(t){return new WK(this,t)},r.prototype.forEachAsync=function(t){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.map(t).resolveFully()]})})},r.prototype.serialForEach=function(t){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.serialMapAsync(t).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(t,e){return e===void 0&&(e=!0),new VK(this,t,e)},r.prototype.columnMajorBatch=function(t,e,n){return e===void 0&&(e=!0),n===void 0&&(n=UP),this.rowMajorBatch(t,e).map(function(i){return SK(i,n)})},r.prototype.concatenate=function(t,e){return new HP(qP([this,t]),e)},r.prototype.take=function(t){return t<0||t==null?this:new zK(this,t)},r.prototype.skip=function(t){return t<0||t==null?this:new FK(this,t)},r.prototype.prefetch=function(t){return new $P(this,t)},r.prototype.shuffle=function(t,e){return new HK(this,t,e)},r.prototype.serial=function(){return new LK(this)},r}(),PK=function(r){function t(e){var n=r.call(this)||this;return n.items=e,n.trav=0,n}return Ft(t,r),t.prototype.summary=function(){return"Array of "+this.items.length+" items"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e;return Ne(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(e=this.items[this.trav],this.trav++,[2,{value:RK(e),done:!1}])})})},t}(Un),MK=function(r){function t(e){var n=r.call(this)||this;return n.nextFn=e,n}return Ft(t,r),t.prototype.summary=function(){return"Function call"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: "+n.message,n}return[2]})})},t}(Un),LK=function(r){function t(e){var n=r.call(this)||this;return n.upstream=e,n.lastRead=Promise.resolve({value:null,done:!1}),n}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.upstream.next()]})})},t}(Un),FK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.maxCount=n,i.count=0,i.lastRead=Promise.resolve({value:null,done:!1}),i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){var e;return Ne(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(e=n.sent()).done?[2,e]:(ft(e.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},t}(Un),zK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.maxCount=n,i.count=0,i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Take"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},t}(Un),VK=function(r){function t(e,n,i){i===void 0&&(i=!0);var o=r.call(this)||this;return o.upstream=e,o.batchSize=n,o.enableSmallLastBatch=i,o.lastRead=Promise.resolve({value:null,done:!1}),o}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){var e,n;return Ne(this,function(i){switch(i.label){case 0:e=[],i.label=1;case 1:return e.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(n=i.sent()).done?this.enableSmallLastBatch&&e.length>0?[2,{value:e,done:!1}]:[2,{value:null,done:!0}]:(e.push(n.value),[3,1]);case 3:return[2,{value:e,done:!1}]}})})},t}(Un),BK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.predicate=n,i.lastRead=Promise.resolve({value:null,done:!1}),i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){var e;return Ne(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return(e=n.sent()).done||this.predicate(e.value)?[2,e]:(ft(e.value),[3,0]);case 2:return[2]}})})},t}(Un),UK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.transform=n,i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Map"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e,n,i,o,a,s,u;return Ne(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if((e=c.sent()).done)return[2,{value:null,done:!0}];for(n=Ao.getTensorsInContainer(e.value),i=this.transform(e.value),o=Ao.getTensorsInContainer(i),a=0,s=n;a<s.length;a++)u=s[a],Ao.isTensorInList(u,o)||u.dispose();return[2,{value:i,done:!1}]}})})},t}(Un),jK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.handler=n,i.count=0,i.lastRead=Promise.resolve({value:null,done:!1}),i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){var e;return Ne(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return e=n.sent(),this.handler(e)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},t}(Un),CT=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.transform=n,i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e,n,i,o,a,s,u;return Ne(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:return(e=c.sent()).done?[2,{value:null,done:!0}]:(n=Ao.getTensorsInContainer(e.value),[4,this.transform(e.value)]);case 2:for(i=c.sent(),o=Ao.getTensorsInContainer(i),a=0,s=n;a<s.length;a++)u=s[a],Ao.isTensorInList(u,o)||u.dispose();return[2,{value:i,done:!1}]}})})},t}(Un),L_=function(r){function t(){var e=r.call(this)||this;return e.outputQueue=new NK,e.lastRead=Promise.resolve({value:null,done:!1}),e}return Ft(t,r),t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){switch(e.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return e.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},t}(Un),WK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.transform=n,i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},t.prototype.pump=function(){return ke(this,void 0,void 0,function(){var e,n,i,o,a,s,u;return Ne(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if((e=c.sent()).done)return[2,!1];for(n=Ao.getTensorsInContainer(e.value),i=this.transform(e.value),o=Ao.getTensorsInContainer(i),this.outputQueue.pushAll(i),a=0,s=n;a<s.length;a++)u=s[a],Ao.isTensorInList(u,o)||u.dispose();return[2,!0]}})})},t}(L_),HP=function(r){function t(e,n){var i=r.call(this)||this;return i.baseErrorHandler=n,i.lastRead=null,i.iterator=null,i.moreIterators=e,i}return Ft(t,r),t.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},t.prototype.next=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},t.prototype.readFromChain=function(e){return ke(this,void 0,void 0,function(){var n,i;return Ne(this,function(o){switch(o.label){case 0:return[4,e];case 1:return o.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((n=o.sent()).done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),o.label=3;case 3:return[4,this.iterator.next()];case 4:return(i=o.sent()).done?(this.iterator=null,[2,this.readFromChain(e)]):[2,i]}})})},t}(Un);(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(ps||(ps={}));var qK=function(r){function t(e,n){n===void 0&&(n=ps.FAIL);var i=r.call(this)||this;return i.iterators=e,i.mismatchMode=n,i.count=0,i.currentPromise=null,i}return Ft(t,r),t.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},t.prototype.nextState=function(e){return ke(this,void 0,void 0,function(){function n(s){return s instanceof Un?{value:s.next().then(function(u){return i++,u.done&&o++,u.value}),recurse:!1}:{value:null,recurse:!0}}var i,o,a;return Ne(this,function(s){switch(s.label){case 0:return[4,e];case 1:return s.sent(),i=0,o=0,[4,jP(this.iterators,n)];case 2:if(a=s.sent(),i===o)return[2,{value:null,done:!0}];if(o>0)switch(this.mismatchMode){case ps.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case ps.SHORTEST:return[2,{value:null,done:!0}];case ps.LONGEST:}return this.count++,[2,{value:a,done:!1}]}})})},t.prototype.next=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},t}(Un),$P=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.bufferSize=n,i.buffer=new WP(n),i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},t.prototype.refill=function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}},t.prototype.next=function(){return this.refill(),this.buffer.shift()},t}(Un),HK=function(r){function t(e,n,i){var o=r.call(this,e,n)||this;return o.upstream=e,o.windowSize=n,o.upstreamExhausted=!1,o.random=VP(i||Ge.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return Ft(t,r),t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){return this.lastRead=this.lastRead.then(function(){return e.serialNext()}),[2,this.lastRead]})})},t.prototype.randomInt=function(e){return Math.floor(this.random()*e)},t.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},t.prototype.serialNext=function(){return ke(this,void 0,void 0,function(){var e,n;return Ne(this,function(i){switch(i.label){case 0:this.upstreamExhausted||this.refill(),i.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(e=this.chooseIndex(),[4,this.buffer.shuffleExcise(e)]);case 2:return(n=i.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,n]);case 3:return[2,{value:null,done:!0}]}})})},t}($P),Ap=function(){function r(){this.size=null}return r.prototype.batch=function(t,e){var n=this;e===void 0&&(e=!0);var i=this;return Ge.assert(t>0,function(){return`batchSize needs to be positive, but it is
      `+t}),Vr(function(){return ke(n,void 0,void 0,function(){return Ne(this,function(o){switch(o.label){case 0:return[4,i.iterator()];case 1:return[2,o.sent().columnMajorBatch(t,e,KK)]}})})},this.size===1/0||this.size==null?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t))},r.prototype.concatenate=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){var i,o;return Ne(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return o=(i=a.sent()).concatenate,[4,t.iterator()];case 2:return[2,o.apply(i,[a.sent()])]}})})},this.size===1/0||t.size===1/0?1/0:this.size!=null&&t.size!=null?this.size+t.size:null)},r.prototype.filter=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return ue(function(){return t(o)})})]}})})},this.size===1/0?1/0:null)},r.prototype.forEachAsync=function(t){return ke(this,void 0,void 0,function(){return Ne(this,function(e){switch(e.label){case 0:return[4,this.iterator()];case 1:return[2,e.sent().forEachAsync(t)]}})})},r.prototype.forEach=function(t){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return Qg("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(t)]})})},r.prototype.map=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().map(function(o){return ue(function(){return t(o)})})]}})})},this.size)},r.prototype.mapAsync=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().mapAsync(t)]}})})},this.size)},r.prototype.prefetch=function(t){var e=this;if(t==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().prefetch(t)]}})})},this.size)},r.prototype.repeat=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){var i=this;return Ne(this,function(o){return[2,DK(M_(function(){return ke(i,void 0,void 0,function(){var a;return Ne(this,function(s){switch(s.label){case 0:return a={},[4,n.iterator()];case 1:return[2,(a.value=s.sent(),a.done=!1,a)]}})})}).take(t))]})})},this.size!=null&&t>0?this.size*t:t===0?0:this.size!=null&&(t===void 0||t<0)?1/0:null)},r.prototype.skip=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(t)]}})})},this.size!=null&&t>=0&&this.size>=t?this.size-t:this.size!=null&&(this.size<t||t===void 0||t<0)?0:null)},r.prototype.shuffle=function(t,e,n){var i=this;if(n===void 0&&(n=!0),t==null||t<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var o=this,a=VP(e||Ge.now().toString());return Vr(function(){return ke(i,void 0,void 0,function(){var s;return Ne(this,function(u){switch(u.label){case 0:return s=a.int32(),n&&(s+=a.int32()),[4,o.iterator()];case 1:return[2,u.sent().shuffle(t,s.toString())]}})})},this.size)},r.prototype.take=function(t){var e=this,n=this;return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(t)]}})})},this.size!=null&&this.size>t?t:this.size!=null&&this.size<=t?this.size:null)},r.prototype.toArray=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(t){switch(t.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,t.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(t){switch(t.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,t.sent().toArrayForTest()]}})})},r.MAX_BUFFER_SIZE=1e4,r}();function Vr(r,t){return t===void 0&&(t=null),new(function(e){function n(){var i=e!==null&&e.apply(this,arguments)||this;return i.size=t,i}return Ft(n,e),n.prototype.iterator=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(i){return[2,r()]})})},n}(Ap))}function $K(r){var t=this;return Vr(function(){return ke(t,void 0,void 0,function(){return Ne(this,function(e){return[2,qP(r)]})})},r.length)}function GK(r){var t,e=this;if(!Bc(r))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var i in r)t=t==null?r[i].size:Math.min(t,r[i].size);return Vr(function(){return ke(e,void 0,void 0,function(){return Ne(this,function(o){switch(o.label){case 0:return[4,jP(r,function(a){if(a instanceof Ap)return{value:a.iterator(),recurse:!1};if(Bc(a))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,OK(o.sent(),ps.SHORTEST)]}})})},t)}function KK(r){return r===null?null:TK(r[0])?{value:XK(r),recurse:!1}:{value:null,recurse:!0}}function XK(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof Ut?Ji(r):xn(r)}var GP=function(r){function t(e){var n=r.call(this)||this;return n.input=e,n}return Ft(t,r),t.prototype.iterator=function(){return ke(this,void 0,void 0,function(){var e,n;return Ne(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return e=i.sent(),n=e.decodeUTF8(),[2,n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o})]}})})},t}(Ap),cm='"',Jh=Symbol("out"),ST=Symbol("field"),hm=Symbol("quote"),lw=Symbol("quoteafterquote"),TT=Symbol("quoteinquote"),KP=function(r){function t(e,n){var i=r.call(this)||this;return i.input=e,i.hasHeader=!0,i.fullColumnNames=null,i.columnNamesValidated=!1,i.columnConfigs=null,i.configuredColumnsOnly=!1,i.delimiter=",",i.delimWhitespace=!1,i.base=new GP(e),n||(n={}),i.hasHeader=n.hasHeader!==!1,i.fullColumnNames=n.columnNames,i.columnConfigs=n.columnConfigs,i.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(Ge.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),i.delimWhitespace=!0,i.delimiter=" "):i.delimiter=n.delimiter?n.delimiter:",",i}return Ft(t,r),t.prototype.columnNames=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){switch(e.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:e.sent(),e.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},t.prototype.setColumnNames=function(){return ke(this,void 0,void 0,function(){var e,n,i,o,a,s,u=this;return Ne(this,function(c){switch(c.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(e=c.sent(),!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&e&&Ge.assert(e.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+u.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=e),n=this.fullColumnNames.reduce(function(d,p){return d[p]=d[p]+1||1,d},{}),i=Object.keys(n).filter(function(d){return n[d]>1}),Ge.assert(i.length===0,function(){return"Duplicate column names found: "+i.toString()}),this.columnConfigs){for(o=0,a=Object.keys(this.columnConfigs);o<a.length;o++)if(s=a[o],this.fullColumnNames.indexOf(s)===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},t.prototype.maybeReadHeaderLine=function(){return ke(this,void 0,void 0,function(){var e,n;return Ne(this,function(i){switch(i.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,i.sent().next()];case 2:if((e=i.sent()).done)throw new Error("No data was found for CSV parsing.");return n=e.value,[2,this.parseRow(n,!1)];case 3:return[2,null]}})})},t.prototype.iterator=function(){return ke(this,void 0,void 0,function(){var e,n=this;return Ne(this,function(i){switch(i.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:i.sent(),i.label=2;case 2:return[4,this.base.iterator()];case 3:return e=i.sent(),this.hasHeader&&(e=e.skip(1)),[2,e.map(function(o){return n.makeDataElement(o)})]}})})},t.prototype.makeDataElement=function(e){for(var n=this.parseRow(e),i={},o={},a=0;a<this.fullColumnNames.length;a++){var s=this.fullColumnNames[a],u=this.columnConfigs?this.columnConfigs[s]:null;if(!this.configuredColumnsOnly||u){var c=n[a],d=null;if(c==="")if(u&&u.default!==void 0)d=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column "+s+" is empty in this line: "+e);d=void 0}else{var p=Number(c);if(isNaN(p))d=u&&u.dtype==="bool"?this.getBoolean(c):c;else if(u&&u.dtype)switch(u.dtype){case"float32":d=p;break;case"int32":d=Math.floor(p);break;case"bool":d=this.getBoolean(c);break;default:d=p}else d=p}u&&u.isLabel?o[s]=d:i[s]=d}}return Object.keys(o).length===0?i:{xs:i,ys:o}},t.prototype.getBoolean=function(e){return e==="1"||e.toLowerCase()==="true"?1:0},t.prototype.parseRow=function(e,n){n===void 0&&(n=!0);for(var i=[],o=0,a=e.length,s=Jh,u=0;u<a;u++)switch(s){case Jh:switch(e.charAt(u)){case cm:o=u+1,s=hm;break;case this.delimiter:if(o=u+1,this.delimiter===" "&&this.delimWhitespace)break;i.push(""),s=Jh;break;default:s=ST,o=u}break;case ST:switch(e.charAt(u)){case this.delimiter:i.push(e.substring(o,u)),s=Jh,o=u+1}break;case hm:switch(e.charAt(u)){case cm:s=lw}break;case lw:switch(e.charAt(u)){case this.delimiter:i.push(e.substring(o,u-1)),s=Jh,o=u+1;break;case cm:s=hm;break;default:s=TT}break;case TT:switch(e.charAt(u)){case cm:s=hm}}if(s===lw?i.push(e.substring(o,a-1)):i.push(e.substring(o)),n&&i.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+i);return i},t}(Ap),QK=function(r){function t(e){var n=r.call(this)||this;n.microphoneConfig=e,n.isClosed=!1,n.fftSize=e.fftSize||1024;var i=Math.log2(n.fftSize);if(n.fftSize<0||i<4||i>14||!Number.isInteger(i))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+n.fftSize);if(n.numFrames=e.numFramesPerSpectrogram||43,n.sampleRateHz=e.sampleRateHz,n.columnTruncateLength=e.columnTruncateLength||n.fftSize,n.audioTrackConstraints=e.audioTrackConstraints,n.smoothingTimeConstant=e.smoothingTimeConstant||0,n.includeSpectrogram=e.includeSpectrogram!==!1,n.includeWaveform=e.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return Ft(t,r),t.prototype.summary=function(){return"microphone"},t.create=function(e){return e===void 0&&(e={}),ke(this,void 0,void 0,function(){var n;return Ne(this,function(i){switch(i.label){case 0:if(he().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(n=new t(e)).start()];case 1:return i.sent(),[2,n]}})})},t.prototype.start=function(){return ke(this,void 0,void 0,function(){var e,n,i,o;return Ne(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return e.stream=a.sent(),[3,3];case 2:throw n=a.sent(),new Error("Error thrown while initializing video stream: "+n.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(i=window.AudioContext||window.webkitAudioContext,this.audioContext=new i,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return o=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,o.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e,n,i,o,a;return Ne(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return i=s.sent(),this.includeSpectrogram&&(o=this.flattenQueue(i.freqDataQueue),e=this.getTensorFromAudioDataArray(o,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(a=this.flattenQueue(i.timeDataQueue),n=this.getTensorFromAudioDataArray(a,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:e,waveform:n},done:!1}]}})})},t.prototype.capture=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}})})},t.prototype.getAudioData=function(){return ke(this,void 0,void 0,function(){var e,n,i,o=this;return Ne(this,function(a){return e=[],n=[],i=0,[2,new Promise(function(s){var u=setInterval(function(){o.includeSpectrogram&&(o.analyser.getFloatFrequencyData(o.freqData),o.freqData[0]===-1/0&&s({freqDataQueue:e,timeDataQueue:n}),e.push(o.freqData.slice(0,o.columnTruncateLength))),o.includeWaveform&&(o.analyser.getFloatTimeDomainData(o.timeData),n.push(o.timeData.slice())),++i===o.numFrames&&(clearInterval(u),s({freqDataQueue:e,timeDataQueue:n}))},o.fftSize/o.sampleRateHz*1e3)})]})})},t.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},t.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},t.prototype.getSampleRate=function(){return this.sampleRateHz},t.prototype.flattenQueue=function(e){var n=e[0].length,i=new Float32Array(e.length*n);return e.forEach(function(o,a){return i.set(o,a*n)}),i},t.prototype.getTensorFromAudioDataArray=function(e,n){var i=new Float32Array(Ge.sizeFromShape(n));return i.set(e,i.length-e.length),xn(i,n)},t}(Un),YK=function(r){function t(e,n){var i=r.call(this)||this;if(i.webcamVideoElement=e,i.webcamConfig=n,i.isClosed=!0,i.resize=!1,i.needToResize())if(i.resize=!0,i.cropSize=[i.webcamConfig.resizeHeight,i.webcamConfig.resizeWidth],i.cropBoxInd=$r([0],"int32"),i.webcamConfig.centerCrop){var o=1*i.webcamConfig.resizeWidth/i.webcamVideoElement.width,a=1*i.webcamConfig.resizeHeight/i.webcamVideoElement.height,s=(1-o)/2,u=(1-a)/2,c=s+o,d=a+u;i.cropBox=pa([u,s,d,c],[1,4])}else i.cropBox=pa([0,0,1,1],[1,4]);return i}return Ft(t,r),t.prototype.summary=function(){return"webcam"},t.create=function(e,n){return n===void 0&&(n={}),ke(this,void 0,void 0,function(){var i;return Ne(this,function(o){switch(o.label){case 0:if(he().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}return[4,(i=new t(e,n)).start()];case 1:return o.sent(),[2,i]}})})},t.prototype.start=function(){return ke(this,void 0,void 0,function(){var e,n,i=this;return Ne(this,function(o){switch(o.label){case 0:this.webcamConfig.facingMode&&Ge.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+i.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),o.label=1;case 1:return o.trys.push([1,3,,4]),e=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return e.stream=o.sent(),[3,4];case 3:throw(n=o.sent()).message="Error thrown while initializing video stream: "+n.message,n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(a){console.log(a),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(a){i.webcamVideoElement.onloadedmetadata=function(){a()}})]}})})},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e;return Ne(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{e=xD.fromPixels(this.webcamVideoElement)}catch(i){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(i))}if(!this.resize)return[2,{value:e,done:!1}];try{return[2,{value:this.cropAndResizeFrame(e),done:!1}]}catch(i){throw new Error("Error thrown cropping the video: "+i.message)}finally{e.dispose()}return[2]})})},t.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},t.prototype.cropAndResizeFrame=function(e){var n=this;return ue(function(){var i,o=e.toFloat().expandDims(0),a=(i=Mu.cropAndResize(o,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear")).shape;return i.reshape(a.slice(1))})},t.prototype.capture=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}})})},t.prototype.stop=function(){this.stream.getTracks().forEach(function(e){return e.stop()});try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0},t.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},t}(Un),XP=function(){return function(){}}(),QP=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return Ft(t,r),t.prototype.split=function(e){return new JK(this,e)},t}(Un),JK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.impl=new ZK(e,n),i}return Ft(t,r),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.impl.next()]})})},t}(QP),ZK=function(r){function t(e,n){var i=r.call(this)||this;return i.upstream=e,i.separator=n,i.carryover="",i}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},t.prototype.pump=function(){return ke(this,void 0,void 0,function(){var e,n,i,o,a;return Ne(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((e=s.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((n=e.value.split(this.separator))[0]=this.carryover+n[0],i=0,o=n.slice(0,-1);i<o.length;i++)a=o[i],this.outputQueue.push(a);return this.carryover=n[n.length-1],[2,!0]}})})},t}(L_),e8=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return Ft(t,r),t.prototype.decodeUTF8=function(){return new t8(this)},t}(Un),t8=function(r){function t(e){var n=r.call(this)||this;return n.upstream=e,n.impl=new n8(e),n}return Ft(t,r),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.impl.next()]})})},t}(QP),n8=function(r){function t(e){var n=r.call(this)||this;if(n.upstream=e,he().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var i=require("string_decoder").StringDecoder;n.decoder=new i("utf8")}return n}return Ft(t,r),t.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},t.prototype.pump=function(){return ke(this,void 0,void 0,function(){var e,n,i;return Ne(this,function(o){switch(o.label){case 0:return[4,this.upstream.next()];case 1:return(e=o.sent()).done?[2,!1]:(n=e.value,i=he().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(i),[2,!0])}})})},t}(L_),YP=function(r){function t(e,n){n===void 0&&(n={});var i=r.call(this)||this;return i.file=e,i.options=n,Ge.assert(e instanceof Uint8Array||!!he().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),i.offset=n.offset||0,i.chunkSize=n.chunkSize||1048576,i}return Ft(t,r),t.prototype.summary=function(){return"FileChunks "+this.file},t.prototype.next=function(){return ke(this,void 0,void 0,function(){var e,n,i=this;return Ne(this,function(o){switch(o.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(e=new Promise(function(a,s){var u=i.offset+i.chunkSize;if(i.file instanceof Uint8Array)a(new Uint8Array(i.file.slice(i.offset,u)));else{var c=new FileReader;c.onload=function(p){var f=c.result;if(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),!(f instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));a(f)},c.onabort=function(p){return s(new Error("Aborted"))},c.onerror=function(p){return s(new Error(p.type))};var d=i.file.slice(i.offset,u);c.readAsArrayBuffer(d)}i.offset=u}),n={},[4,e]);case 1:return[2,(n.value=o.sent(),n.done=!1,n)]}})})},t}(e8);function r8(r,t){return t===void 0&&(t={}),ke(this,void 0,void 0,function(){var e,n,i,o,a;return Ne(this,function(s){switch(s.label){case 0:return typeof r=="string"?e=r:(e=r.url,n=i8(r)),[4,Ge.fetch(e,n)];case 1:return(i=s.sent()).ok?(a=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(a.apply(Uint8Array,[void 0,s.sent()])),[2,new YP(o,t)];case 3:throw new Error(i.statusText)}})})}var i8=function(r){return{method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity}};function JP(r){return typeof r=="string"&&r.substr(0,7)==="file://"}var ZP=function(r){function t(e,n){n===void 0&&(n={});var i=r.call(this)||this;return i.input=e,i.options=n,i}return Ft(t,r),t.prototype.iterator=function(){return ke(this,void 0,void 0,function(){var e;return Ne(this,function(n){return JP(this.input)&&he().get("IS_NODE")&&(e=require("fs"),this.input=e.readFileSync(this.input.substr(7))),[2,new YP(this.input,this.options)]})})},t}(XP),eM=function(r){function t(e,n){n===void 0&&(n={});var i=r.call(this)||this;return i.url=e,i.fileOptions=n,i}return Ft(t,r),t.prototype.iterator=function(){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return JP(this.url)?[2,new ZP(this.url,this.fileOptions).iterator()]:[2,r8(this.url,this.fileOptions)]})})},t}(XP);function o8(r,t){return t===void 0&&(t={}),new KP(new eM(r),t)}function a8(r){var t=this,e=M_(r);return Vr(function(){return ke(t,void 0,void 0,function(){return Ne(this,function(n){return[2,e]})})})}function s8(r){var t=this;return Vr(function(){return ke(t,void 0,void 0,function(){var e;return Ne(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return e=n.sent(),[2,M_(function(){return e.next()})]}})})})}function u8(r,t){return ke(this,void 0,void 0,function(){return Ne(this,function(e){return[2,YK.create(r,t)]})})}function l8(r){return ke(this,void 0,void 0,function(){return Ne(this,function(t){return[2,QK.create(r)]})})}var tM="1.3.1";const c8=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:KP,Dataset:Ap,FileDataSource:ZP,TextLineDataset:GP,URLDataSource:eM,array:$K,csv:o8,func:a8,generator:s8,microphone:l8,version_data:tM,webcam:u8,zip:GK},Symbol.toStringTag,{value:"Module"}));var h8="1.3.1",d8={"tfjs-core":CD,"tfjs-data":tM,"tfjs-layers":jv,"tfjs-converter":FP,tfjs:h8};const p8=Object.freeze(Object.defineProperty({__proto__:null,AdadeltaOptimizer:t_,AdagradOptimizer:n_,AdamOptimizer:r_,AdamaxOptimizer:i_,Callback:RP,CallbackList:ZD,CustomCallback:tO,DataStorage:Kb,get ENV(){return Ib},EarlyStopping:kP,Environment:SR,GraphModel:LP,History:eO,InputSpec:Xn,KernelBackend:Xb,LayerVariable:XD,LayersModel:zu,MomentumOptimizer:o_,Optimizer:Na,RMSPropOptimizer:a_,RNN:ul,get Rank(){return Ww},get Reduction(){return sr},SGDOptimizer:Lv,Sequential:E_,SymbolicTensor:Xi,Tensor:Ut,TensorBuffer:Ac,Variable:Dd,abs:ks,acos:ox,acosh:ax,add:yt,addN:Rx,addStrict:TN,all:Sv,any:Vd,argMax:Bd,argMin:zx,asin:sx,asinh:ux,atan:lx,atan2:kx,atanh:cx,avgPool:_v,avgPool3d:Iv,backend:fk,backend_util:UW,basicLSTMCell:oD,batchNorm:Ix,batchNorm2d:Cx,batchNorm3d:Sx,batchNorm4d:Tx,batchNormalization:CN,batchNormalization2d:_N,batchNormalization3d:EN,batchNormalization4d:IN,batchToSpaceND:ev,booleanMaskAsync:UN,browser:xD,buffer:st,callbacks:uG,cast:tv,ceil:hx,clipByValue:Rr,clone:bk,complex:Ln,concat:br,concat1d:Fb,concat2d:zb,concat3d:Vb,concat4d:Bb,constraints:xq,conv1d:vv,conv2d:ol,conv2dTranspose:wv,conv3d:yv,conv3dTranspose:GN,cos:dx,cosh:px,cumsum:xk,customGrad:Jc,data:c8,deprecationWarn:Qg,depthToSpace:jb,depthwiseConv2d:nh,deregisterOp:cG,diag:lD,disableDeprecationWarnings:fW,dispose:ft,disposeVariables:mW,div:xr,divStrict:AN,dot:KN,dropout:$x,elu:rh,enableDebugMode:pW,enableProdMode:dW,engine:gW,env:he,equal:il,equalStrict:MN,erf:fx,exp:mx,expandDims:ii,expm1:gx,eye:nv,fft:yp,fill:Yc,findBackend:EW,findBackendFactory:IW,floor:uv,floorDiv:mv,frame:Mv,fused:Mc,gather:th,gatherND:Hx,getBackend:xW,getKernel:TR,getKernelsForBackend:Vw,grad:FW,grads:zW,greater:eh,greaterEqual:fp,greaterEqualStrict:LN,greaterStrict:FN,hammingWindow:Gx,hannWindow:Pv,ifft:Pc,imag:Ci,image:Mu,inTopKAsync:dD,initializers:t9,input:mO,io:ui,irfft:Dv,isFinite:vN,isInf:gN,isNaN:mN,keep:No,layers:V$,leakyRelu:Rv,less:Ox,lessEqual:Px,lessEqualStrict:zN,lessStrict:VN,linalg:Xx,linspace:Lb,loadGraphModel:vK,loadLayersModel:sH,localResponseNormalization:Bx,log:Ea,log1p:vx,logSigmoid:fN,logSoftmax:av,logSumExp:iD,logicalAnd:Ra,logicalNot:Ax,logicalOr:pv,logicalXor:SN,losses:pD,matMul:bv,math:sq,max:Ns,maxPool:xv,maxPool3d:Ev,maximum:Fo,maximumStrict:RN,mean:_n,memory:Jw,metrics:tG,min:Tv,minimum:Zc,minimumStrict:kN,mod:Nx,modStrict:NN,model:oH,models:nG,moments:vp,movingAverage:sD,mul:ot,mulStrict:gv,multiRNNCell:aD,multinomial:Wb,neg:rl,nextFrame:Nm,norm:Ux,notEqual:Dc,notEqualStrict:BN,oneHot:Rc,ones:Lo,onesLike:ci,op:X,outerProduct:XN,pad:Bs,pad1d:_k,pad2d:Ek,pad3d:Ik,pad4d:Ck,pool:nD,pow:Nc,powStrict:DN,prelu:kv,print:wk,prod:Av,profile:vW,rand:Sk,randomGamma:Tk,randomNormal:qb,randomUniform:tl,range:Jg,ready:bW,real:Wr,reciprocal:yx,registerBackend:CW,registerCallbackConstructor:uH,registerKernel:Bw,registerOp:lG,regularizers:aG,relu:js,relu6:Vx,removeBackend:_W,reshape:sp,reverse:Oo,reverse1d:QN,reverse2d:YN,reverse3d:JN,reverse4d:ZN,rfft:wp,round:wx,rsqrt:lv,scalar:Ve,scatterND:qx,selu:Nv,separableConv2d:Fx,sequential:aH,serialization:be,setBackend:wW,setPlatform:SW,setdiff1dAsync:Hb,sigmoid:cv,sign:bx,signal:hD,sin:xx,sinh:_x,slice:hi,slice1d:mp,slice2d:Cv,slice3d:gp,slice4d:Oc,slice_util:LW,softmax:nl,softplus:hp,spaceToBatchND:rv,sparseToDense:Ov,spectral:uD,split:fa,sqrt:dp,square:ix,squaredDifference:Dx,squaredDifferenceStrict:ON,squeeze:up,stack:Ji,step:yN,stft:Kx,stridedSlice:jx,sub:Yn,subStrict:PN,sum:Gr,tan:Ex,tanh:hv,tensor:xn,tensor1d:$r,tensor2d:pa,tensor3d:Pb,tensor4d:is,tensor5d:vk,tensor6d:yk,tensor_util:Ao,test_util:cq,tidy:ue,tile:ws,time:yW,topk:Wx,train:_u,transpose:an,truncatedNormal:lp,unregisterKernel:nW,unsortedSegmentSum:Mx,unstack:qu,util:Ge,valueAndGrad:VW,valueAndGrads:BW,variable:Mb,variableGrads:Mk,version:d8,version_converter:FP,version_core:CD,version_layers:jv,webgl:hq,where:Ia,whereAsync:fv,zeros:zt,zerosLike:Ct},Symbol.toStringTag,{value:"Module"})),qd=R1(p8);var yu={},AT;function nM(){if(AT)return yu;AT=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(yu,"__esModule",{value:!0}),yu.cropTensor=yu.capture=void 0;var r=qd;function t(n,i){return r.tidy(function(){var o=r.browser.fromPixels(n),a=e(o,i),s=a.expandDims(0);return s.toFloat().div(r.scalar(127)).sub(r.scalar(1))})}yu.capture=t;function e(n,i,o){var a=Math.min(n.shape[0],n.shape[1]),s=n.shape[0]/2,u=s-a/2,c=n.shape[1]/2,d=c-a/2;if(i&&!o){var p=n.slice([u,d,0],[a,a,3]);p=p.reshape([a*a,1,3]);var f=[.2989,.587,.114];return p=r.mul(p,f),p=p.reshape([a,a,3]),p=r.sum(p,-1),p=r.expandDims(p,-1),p}return n.slice([u,d,0],[a,a,3])}return yu.cropTensor=e,yu}var qi={},RT;function rM(){if(RT)return qi;RT=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(qi,"__esModule",{value:!0}),qi.cropTo=qi.resizeMinTo=qi.resizeMaxTo=qi.resize=void 0;var r=function(){return document.createElement("canvas")};function t(o,a,s){s===void 0&&(s=r()),s.width=o.width*a,s.height=o.height*a;var u=s.getContext("2d");return u.drawImage(o,0,0,s.width,s.height),s}qi.resize=t;function e(o,a,s){s===void 0&&(s=r());var u=Math.max(o.width,o.height);return t(o,a/u,s)}qi.resizeMaxTo=e;function n(o,a,s){s===void 0&&(s=r());var u=Math.min(o.width,o.height);return t(o,a/u,s)}qi.resizeMinTo=n;function i(o,a,s,u){s===void 0&&(s=!1),u===void 0&&(u=r());var c=o.width,d=o.height;o instanceof HTMLVideoElement&&(c=o.videoWidth,d=o.videoHeight);var p=Math.min(c,d),f=a/p,g=Math.ceil(c*f),y=Math.ceil(d*f),x=g-a,b=y-a;u.width=u.height=a;var _=u.getContext("2d");return _.drawImage(o,~~(x/2)*-1,~~(b/2)*-1,g,y),s&&(_.scale(-1,1),_.drawImage(u,a*-1,0)),u}return qi.cropTo=i,qi}var Zh={},kT;function iM(){if(kT)return Zh;kT=1;/** @license See the LICENSE file. */Object.defineProperty(Zh,"__esModule",{value:!0}),Zh.version=void 0;var r="0.8.4-alpha2";return Zh.version=r,Zh}var NT;function oM(){return NT||(NT=1,function(r){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var t=mu&&mu.__awaiter||function(I,S,A,N){function P(M){return M instanceof A?M:new A(function(F){F(M)})}return new(A||(A=Promise))(function(M,F){function G(ee){try{Y(N.next(ee))}catch(H){F(H)}}function Z(ee){try{Y(N.throw(ee))}catch(H){F(H)}}function Y(ee){ee.done?M(ee.value):P(ee.value).then(G,Z)}Y((N=N.apply(I,S||[])).next())})},e=mu&&mu.__generator||function(I,S){var A={label:0,sent:function(){if(M[0]&1)throw M[1];return M[1]},trys:[],ops:[]},N,P,M,F;return F={next:G(0),throw:G(1),return:G(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function G(Y){return function(ee){return Z([Y,ee])}}function Z(Y){if(N)throw new TypeError("Generator is already executing.");for(;A;)try{if(N=1,P&&(M=Y[0]&2?P.return:Y[0]?P.throw||((M=P.return)&&M.call(P),0):P.next)&&!(M=M.call(P,Y[1])).done)return M;switch(P=0,M&&(Y=[Y[0]&2,M.value]),Y[0]){case 0:case 1:M=Y;break;case 4:return A.label++,{value:Y[1],done:!1};case 5:A.label++,P=Y[1],Y=[0];continue;case 7:Y=A.ops.pop(),A.trys.pop();continue;default:if(M=A.trys,!(M=M.length>0&&M[M.length-1])&&(Y[0]===6||Y[0]===2)){A=0;continue}if(Y[0]===3&&(!M||Y[1]>M[0]&&Y[1]<M[3])){A.label=Y[1];break}if(Y[0]===6&&A.label<M[1]){A.label=M[1],M=Y;break}if(M&&A.label<M[2]){A.label=M[2],A.ops.push(Y);break}M[2]&&A.ops.pop(),A.trys.pop();continue}Y=S.call(I,A)}catch(ee){Y=[6,ee],P=0}finally{N=M=0}if(Y[0]&5)throw Y[1];return{value:Y[0]?Y[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.loadFromFiles=r.load=r.loadTruncatedMobileNet=r.CustomMobileNet=r.getTopKClasses=r.IMAGE_SIZE=void 0;var n=qd,i=qd,o=nM(),a=rM(),s=iM(),u=1,c="conv_pw_13_relu",d="out_relu",p=.25,f=.35;r.IMAGE_SIZE=224;var g=function(I){return I.packageVersion=I.packageVersion||s.version,I.packageName=I.packageName||"@teachablemachine/image",I.timeStamp=I.timeStamp||new Date().toISOString(),I.userMetadata=I.userMetadata||{},I.modelName=I.modelName||"untitled",I.labels=I.labels||[],I.imageSize=I.imageSize||r.IMAGE_SIZE,I},y=function(I){return!!I&&Array.isArray(I.labels)},x=function(I,S){if(I===1){if(S!==.25&&S!==.5&&S!==.75&&S!==1)return console.warn("Invalid alpha. Options are: 0.25, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",p.toFixed(2)),p}else if(S!==.35&&S!==.5&&S!==.75&&S!==1)return console.warn("Invalid alpha. Options are: 0.35, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",f.toFixed(2)),f;return S},b=function(I){if(I=I||{},I.checkpointUrl&&I.trainingLayer)return(I.alpha||I.version)&&console.warn("Checkpoint URL passed to modelOptions, alpha options are ignored"),[I.checkpointUrl,I.trainingLayer];if(I.version=I.version||u,I.version===1){I.alpha=I.alpha||p,I.alpha=x(I.version,I.alpha),console.log("Loading mobilenet "+I.version+" and alpha "+I.alpha);var S=I.alpha.toFixed(2);return S==="1.00"&&(S="1.0"),["https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_"+S+"_"+r.IMAGE_SIZE+"/model.json",c]}else{if(I.version===2)return I.alpha=I.alpha||f,I.alpha=x(I.version,I.alpha),console.log("Loading mobilenet "+I.version+" and alpha "+I.alpha),["https://storage.googleapis.com/teachable-machine-models/mobilenet_v2_weights_tf_dim_ordering_tf_kernels_"+I.alpha.toFixed(2)+"_"+r.IMAGE_SIZE+"_no_top/model.json",d];throw new Error("MobileNet V"+I.version+" doesn't exist")}},_=function(I){return t(void 0,void 0,void 0,function(){var S,A;return e(this,function(N){switch(N.label){case 0:return typeof I!="string"?[3,3]:[4,fetch(I)];case 1:return A=N.sent(),[4,A.json()];case 2:return S=N.sent(),[3,4];case 3:if(y(I))S=I;else throw new Error("Invalid Metadata provided");N.label=4;case 4:return[2,g(S)]}})})};function C(I,S,A){return A===void 0&&(A=3),t(this,void 0,void 0,function(){var N;return e(this,function(P){switch(P.label){case 0:return[4,S.data()];case 1:return N=P.sent(),[2,n.tidy(function(){A=Math.min(A,N.length);for(var M=[],F=0;F<N.length;F++)M.push({value:N[F],index:F});M.sort(function(ee,H){return H.value-ee.value});for(var G=new Float32Array(A),Z=new Int32Array(A),F=0;F<A;F++)G[F]=M[F].value,Z[F]=M[F].index;for(var Y=[],F=0;F<Z.length;F++)Y.push({className:I[Z[F]],probability:G[F]});return Y})]}})})}r.getTopKClasses=C;var T=function(){function I(S,A){this.model=S,this._metadata=g(A)}return Object.defineProperty(I,"EXPECTED_IMAGE_SIZE",{get:function(){return r.IMAGE_SIZE},enumerable:!1,configurable:!0}),I.prototype.getMetadata=function(){return this._metadata},I.prototype.getTotalClasses=function(){var S=this.model.output,A=S.shape[1];return A},I.prototype.getClassLabels=function(){return this._metadata.labels},I.prototype.predictTopK=function(S,A,N){return A===void 0&&(A=10),N===void 0&&(N=!1),t(this,void 0,void 0,function(){var P,M,F,G=this;return e(this,function(Z){switch(Z.label){case 0:return P=a.cropTo(S,this._metadata.imageSize,N),M=n.tidy(function(){var Y=o.capture(P,G._metadata.grayscale);return G.model.predict(Y)}),[4,C(this._metadata.labels,M,A)];case 1:return F=Z.sent(),i.dispose(M),[2,F]}})})},I.prototype.predict=function(S,A){return A===void 0&&(A=!1),t(this,void 0,void 0,function(){var N,P,M,F,G,Z=this;return e(this,function(Y){switch(Y.label){case 0:return N=a.cropTo(S,this._metadata.imageSize,A),P=n.tidy(function(){var ee=o.capture(N,Z._metadata.grayscale);return Z.model.predict(ee)}),[4,P.data()];case 1:for(M=Y.sent(),F=[],G=0;G<M.length;G++)F.push({className:this._metadata.labels[G],probability:M[G]});return i.dispose(P),[2,F]}})})},I.prototype.dispose=function(){this.truncatedModel.dispose()},I}();r.CustomMobileNet=T;function D(I){return t(this,void 0,void 0,function(){var S,A,N,P,M,F,G,M,F,G;return e(this,function(Z){switch(Z.label){case 0:return S=b(I),A=S[0],N=S[1],[4,n.loadLayersModel(A)];case 1:return P=Z.sent(),I&&I.version===1?(M=P.getLayer(N),F=n.model({inputs:P.inputs,outputs:M.output}),G=n.sequential(),G.add(F),G.add(n.layers.flatten()),[2,G]):(M=P.getLayer(N),F=n.model({inputs:P.inputs,outputs:M.output}),G=n.sequential(),G.add(F),G.add(n.layers.globalAveragePooling2d({})),[2,G])}})})}r.loadTruncatedMobileNet=D;function O(I,S){return t(this,void 0,void 0,function(){var A,N,P;return e(this,function(M){switch(M.label){case 0:return[4,n.loadLayersModel(I)];case 1:return A=M.sent(),S?[4,_(S)]:[3,3];case 2:return P=M.sent(),[3,4];case 3:P=null,M.label=4;case 4:return N=P,[2,new T(A,N)]}})})}r.load=O;function z(I,S,A){return t(this,void 0,void 0,function(){var N,P,M,F;return e(this,function(G){switch(G.label){case 0:return[4,n.loadLayersModel(n.io.browserFiles([I,S]))];case 1:return N=G.sent(),[4,new Response(A).json()];case 2:return P=G.sent(),A?[4,_(P)]:[3,4];case 3:return F=G.sent(),[3,5];case 4:F=null,G.label=5;case 5:return M=F,[2,new T(N,M)]}})})}r.loadFromFiles=z}(mu)),mu}var ni={},Om={exports:{}},f8=Om.exports,DT;function m8(){return DT||(DT=1,function(r){(function(t,e,n){function i(u){var c=this,d=s();c.next=function(){var p=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=p-(c.c=p|0)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(u),c.s0<0&&(c.s0+=1),c.s1-=d(u),c.s1<0&&(c.s1+=1),c.s2-=d(u),c.s2<0&&(c.s2+=1),d=null}function o(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function a(u,c){var d=new i(u),p=c&&c.state,f=d.next;return f.int32=function(){return d.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,p&&(typeof p=="object"&&o(p,d),f.state=function(){return o(d,{})}),f}function s(){var u=4022871197,c=function(d){d=d.toString();for(var p=0;p<d.length;p++){u+=d.charCodeAt(p);var f=.02519603282416938*u;u=f>>>0,f-=u,f*=u,u=f>>>0,f-=u,u+=f*4294967296}return(u>>>0)*23283064365386963e-26};return c}e&&e.exports?e.exports=a:this.alea=a})(f8,r)}(Om)),Om.exports}var Pm={exports:{}},g8=Pm.exports,OT;function v8(){return OT||(OT=1,function(r){(function(t,e,n){function i(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var p=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^p^p>>>8},s===(s|0)?u.x=s:c+=s;for(var d=0;d<c.length+64;d++)u.x^=c.charCodeAt(d)|0,u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xor128=a})(g8,r)}(Pm)),Pm.exports}var Mm={exports:{}},y8=Mm.exports,PT;function w8(){return PT||(PT=1,function(r){(function(t,e,n){function i(s){var u=this,c="";u.next=function(){var p=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(p^p<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var d=0;d<c.length+64;d++)u.x^=c.charCodeAt(d)|0,d==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xorwow=a})(y8,r)}(Mm)),Mm.exports}var Lm={exports:{}},b8=Lm.exports,MT;function x8(){return MT||(MT=1,function(r){(function(t,e,n){function i(s){var u=this;u.next=function(){var d=u.x,p=u.i,f,g;return f=d[p],f^=f>>>7,g=f^f<<24,f=d[p+1&7],g^=f^f>>>10,f=d[p+3&7],g^=f^f>>>3,f=d[p+4&7],g^=f^f<<7,f=d[p+7&7],f=f^f<<13,g^=f^f<<9,d[p]=g,u.i=p+1&7,g};function c(d,p){var f,g=[];if(p===(p|0))g[0]=p;else for(p=""+p,f=0;f<p.length;++f)g[f&7]=g[f&7]<<15^p.charCodeAt(f)+g[f+1&7]<<13;for(;g.length<8;)g.push(0);for(f=0;f<8&&g[f]===0;++f);for(f==8?g[7]=-1:g[f],d.x=g,d.i=0,f=256;f>0;--f)d.next()}c(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,d&&(d.x&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xorshift7=a})(b8,r)}(Lm)),Lm.exports}var Fm={exports:{}},_8=Fm.exports,LT;function E8(){return LT||(LT=1,function(r){(function(t,e,n){function i(s){var u=this;u.next=function(){var d=u.w,p=u.X,f=u.i,g,y;return u.w=d=d+1640531527|0,y=p[f+34&127],g=p[f=f+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,y=p[f]=y^g,u.i=f,y+(d^d>>>16)|0};function c(d,p){var f,g,y,x,b,_=[],C=128;for(p===(p|0)?(g=p,p=null):(p=p+"\0",g=0,C=Math.max(C,p.length)),y=0,x=-32;x<C;++x)p&&(g^=p.charCodeAt((x+32)%p.length)),x===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,x>=0&&(b=b+1640531527|0,f=_[x&127]^=g+b,y=f==0?y+1:0);for(y>=128&&(_[(p&&p.length||0)&127]=-1),y=127,x=4*128;x>0;--x)g=_[y+34&127],f=_[y=y+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,_[y]=g^f;d.w=b,d.X=_,d.i=y}c(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,d&&(d.X&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.xor4096=a})(_8,r)}(Fm)),Fm.exports}var zm={exports:{}},I8=zm.exports,FT;function C8(){return FT||(FT=1,function(r){(function(t,e,n){function i(s){var u=this,c="";u.next=function(){var p=u.b,f=u.c,g=u.d,y=u.a;return p=p<<25^p>>>7^f,f=f-g|0,g=g<<24^g>>>8^y,y=y-p|0,u.b=p=p<<20^p>>>12^f,u.c=f=f-g|0,u.d=g<<16^f>>>16^y,u.a=y-p|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var d=0;d<c.length+20;d++)u.b^=c.charCodeAt(d)|0,u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new i(s),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,d&&(typeof d=="object"&&o(d,c),p.state=function(){return o(c,{})}),p}e&&e.exports?e.exports=a:this.tychei=a})(I8,r)}(zm)),zm.exports}var cw={exports:{}};const S8={},T8=Object.freeze(Object.defineProperty({__proto__:null,default:S8},Symbol.toStringTag,{value:"Module"})),A8=R1(T8);var zT;function R8(){return zT||(zT=1,function(r){(function(t,e){var n=(0,eval)("this"),i=256,o=6,a=52,s="random",u=e.pow(i,o),c=e.pow(2,a),d=c*2,p=i-1,f;function g(D,O,z){var I=[];O=O==!0?{entropy:!0}:O||{};var S=_(b(O.entropy?[D,T(t)]:D??C(),3),I),A=new y(I),N=function(){for(var P=A.g(o),M=u,F=0;P<c;)P=(P+F)*i,M*=i,F=A.g(1);for(;P>=d;)P/=2,M/=2,F>>>=1;return(P+F)/M};return N.int32=function(){return A.g(4)|0},N.quick=function(){return A.g(4)/4294967296},N.double=N,_(T(A.S),t),(O.pass||z||function(P,M,F,G){return G&&(G.S&&x(G,A),P.state=function(){return x(A,{})}),F?(e[s]=P,M):P})(N,S,"global"in O?O.global:this==e,O.state)}e["seed"+s]=g;function y(D){var O,z=D.length,I=this,S=0,A=I.i=I.j=0,N=I.S=[];for(z||(D=[z++]);S<i;)N[S]=S++;for(S=0;S<i;S++)N[S]=N[A=p&A+D[S%z]+(O=N[S])],N[A]=O;(I.g=function(P){for(var M,F=0,G=I.i,Z=I.j,Y=I.S;P--;)M=Y[G=p&G+1],F=F*i+Y[p&(Y[G]=Y[Z=p&Z+M])+(Y[Z]=M)];return I.i=G,I.j=Z,F})(i)}function x(D,O){return O.i=D.i,O.j=D.j,O.S=D.S.slice(),O}function b(D,O){var z=[],I=typeof D,S;if(O&&I=="object")for(S in D)try{z.push(b(D[S],O-1))}catch{}return z.length?z:I=="string"?D:D+"\0"}function _(D,O){for(var z=D+"",I,S=0;S<z.length;)O[p&S]=p&(I^=O[p&S]*19)+z.charCodeAt(S++);return T(O)}function C(){try{var D;return f&&(D=f.randomBytes)?D=D(i):(D=new Uint8Array(i),(n.crypto||n.msCrypto).getRandomValues(D)),T(D)}catch{var O=n.navigator,z=O&&O.plugins;return[+new Date,n,z,n.screen,T(t)]}}function T(D){return String.fromCharCode.apply(0,D)}if(_(e.random(),t),r.exports){r.exports=g;try{f=A8}catch{}}})([],Math)}(cw)),cw.exports}var hw,VT;function k8(){if(VT)return hw;VT=1;var r=m8(),t=v8(),e=w8(),n=x8(),i=E8(),o=C8(),a=R8();return a.alea=r,a.xor128=t,a.xorwow=e,a.xorshift7=n,a.xor4096=i,a.tychei=o,hw=a,hw}var BT;function N8(){if(BT)return ni;BT=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var r=ni&&ni.__extends||function(){var y=function(x,b){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,C){_.__proto__=C}||function(_,C){for(var T in C)C.hasOwnProperty(T)&&(_[T]=C[T])},y(x,b)};return function(x,b){y(x,b);function _(){this.constructor=x}x.prototype=b===null?Object.create(b):(_.prototype=b.prototype,new _)}}(),t=ni&&ni.__awaiter||function(y,x,b,_){function C(T){return T instanceof b?T:new b(function(D){D(T)})}return new(b||(b=Promise))(function(T,D){function O(S){try{I(_.next(S))}catch(A){D(A)}}function z(S){try{I(_.throw(S))}catch(A){D(A)}}function I(S){S.done?T(S.value):C(S.value).then(O,z)}I((_=_.apply(y,x||[])).next())})},e=ni&&ni.__generator||function(y,x){var b={label:0,sent:function(){if(T[0]&1)throw T[1];return T[1]},trys:[],ops:[]},_,C,T,D;return D={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function O(I){return function(S){return z([I,S])}}function z(I){if(_)throw new TypeError("Generator is already executing.");for(;b;)try{if(_=1,C&&(T=I[0]&2?C.return:I[0]?C.throw||((T=C.return)&&T.call(C),0):C.next)&&!(T=T.call(C,I[1])).done)return T;switch(C=0,T&&(I=[I[0]&2,T.value]),I[0]){case 0:case 1:T=I;break;case 4:return b.label++,{value:I[1],done:!1};case 5:b.label++,C=I[1],I=[0];continue;case 7:I=b.ops.pop(),b.trys.pop();continue;default:if(T=b.trys,!(T=T.length>0&&T[T.length-1])&&(I[0]===6||I[0]===2)){b=0;continue}if(I[0]===3&&(!T||I[1]>T[0]&&I[1]<T[3])){b.label=I[1];break}if(I[0]===6&&b.label<T[1]){b.label=T[1],T=I;break}if(T&&b.label<T[2]){b.label=T[2],b.ops.push(I);break}T[2]&&b.ops.pop(),b.trys.pop();continue}I=x.call(y,b)}catch(S){I=[6,S],C=0}finally{_=T=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}};Object.defineProperty(ni,"__esModule",{value:!0}),ni.createTeachable=ni.TeachableMobileNet=void 0;var n=qd,i=qd,o=nM(),a=oM(),s=k8(),u=.15,c=function(y){return typeof y.dataId=="object"&&typeof y.shape=="object"};function d(y,x){var b=new Array(x).fill(0);return b[y]=1,b}function p(y,x){for(var b,_=y.length,C=y.slice(),T=_-1;T>0;T-=1){var D=void 0;x?D=Math.floor(x()*(T+1)):D=Math.floor(Math.random()*(T+1)),b=[C[D],C[T]],C[T]=b[0],C[D]=b[1]}return C}var f=function(y){r(x,y);function x(b,_){var C=y.call(this,n.sequential(),_)||this;return C.totalSamples=0,C.examples=[],C.truncatedModel=b,C}return Object.defineProperty(x.prototype,"asSequentialModel",{get:function(){return this.model},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"isTrained",{get:function(){return!!this.model&&this.model.layers&&this.model.layers.length>2},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"isPrepared",{get:function(){return!!this.trainDataset},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"numClasses",{get:function(){return this._metadata.labels.length},enumerable:!1,configurable:!0}),x.prototype.addExample=function(b,_){return t(this,void 0,void 0,function(){var C,T,D;return e(this,function(O){return C=c(_)?_:o.capture(_,this._metadata.grayscale),T=this.truncatedModel.predict(C),D=T.dataSync(),C.dispose(),T.dispose(),this.examples[b].push(D),this.totalSamples++,[2]})})},x.prototype.predict=function(b,_){return _===void 0&&(_=!1),t(this,void 0,void 0,function(){return e(this,function(C){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,y.prototype.predict.call(this,b,_)]})})},x.prototype.predictTopK=function(b,_,C){return _===void 0&&(_=10),C===void 0&&(C=!1),t(this,void 0,void 0,function(){return e(this,function(T){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,y.prototype.predictTopK.call(this,b,_,C)]})})},x.prototype.prepare=function(){for(var b in this.examples)if(b.length===0)throw new Error("Add some examples before training");var _=this.convertToTfDataset();this.trainDataset=_.trainDataset,this.validationDataset=_.validationDataset},x.prototype.convertToTfDataset=function(){for(var b=0;b<this.examples.length;b++)this.examples[b]=p(this.examples[b],this.seed);for(var _=[],C=[],T=function(A){var N=d(A,D.numClasses),P=D.examples[A].length,M=Math.ceil(u*P),F=P-M,G=D.examples[A].slice(0,F).map(function(Y){return{data:Y,label:N}}),Z=D.examples[A].slice(F).map(function(Y){return{data:Y,label:N}});_=_.concat(G),C=C.concat(Z)},D=this,b=0;b<this.examples.length;b++)T(b);_=p(_,this.seed),C=p(C,this.seed);var O=n.data.array(_.map(function(A){return A.data})),z=n.data.array(C.map(function(A){return A.data})),I=n.data.array(_.map(function(A){return A.label})),S=n.data.array(C.map(function(A){return A.label}));return{trainDataset:n.data.zip({xs:O,ys:I}),validationDataset:n.data.zip({xs:z,ys:S})}},x.prototype.save=function(b,_){return t(this,void 0,void 0,function(){return e(this,function(C){return[2,this.model.save(b,_)]})})},x.prototype.train=function(b,_){return _===void 0&&(_={}),t(this,void 0,void 0,function(){var C,T,D,O,z,I,S,A,N,P=this;return e(this,function(M){switch(M.label){case 0:if(C=_.onTrainEnd||function(){},_.onTrainEnd=function(F){P.__stopTrainingResolve&&(P.__stopTrainingResolve(),P.__stopTrainingResolve=null),C(F)},this.isPrepared||this.prepare(),T=this.getLabels().length,i.util.assert(T===this.numClasses,function(){return"Can not train, has "+T+" labels and "+P.numClasses+" classes"}),D=this.truncatedModel.outputs[0].shape.slice(1),O=n.util.sizeFromShape(D),this.seed?z=n.initializers.varianceScaling({seed:3.14}):z=n.initializers.varianceScaling({}),this.trainingModel=n.sequential({layers:[n.layers.dense({inputShape:[O],units:b.denseUnits,activation:"relu",kernelInitializer:z,useBias:!0}),n.layers.dense({kernelInitializer:z,useBias:!1,activation:"softmax",units:this.numClasses})]}),I=n.train.adam(b.learningRate),this.trainingModel.compile({optimizer:I,loss:"categoricalCrossentropy",metrics:["accuracy"]}),!(b.batchSize>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction");return S=this.trainDataset.batch(b.batchSize),A=this.validationDataset.batch(b.batchSize),[4,this.trainingModel.fitDataset(S,{epochs:b.epochs,validationData:A,callbacks:_})];case 1:return M.sent(),N=n.sequential(),N.add(this.truncatedModel),N.add(this.trainingModel),this.model=N,I.dispose(),[2,this.model]}})})},x.prototype.prepareDataset=function(){for(var b=0;b<this.numClasses;b++)this.examples[b]=[]},x.prototype.setLabel=function(b,_){this._metadata.labels[b]=_},x.prototype.setLabels=function(b){this._metadata.labels=b,this.prepareDataset()},x.prototype.getLabel=function(b){return this._metadata.labels[b]},x.prototype.getLabels=function(){return this._metadata.labels},x.prototype.setName=function(b){this._metadata.modelName=b},x.prototype.getName=function(){return this._metadata.modelName},x.prototype.stopTraining=function(){var b=this,_=new Promise(function(C,T){b.trainingModel.stopTraining=!0,b.__stopTrainingResolve=C});return _},x.prototype.dispose=function(){this.trainingModel.dispose(),y.prototype.dispose.call(this)},x.prototype.calculateAccuracyPerClass=function(){return t(this,void 0,void 0,function(){var b,_,C,T,D,O,z,I,S,A,ee,N,P,M,F,G,Z,Y,ee,H=this;return e(this,function(ie){switch(ie.label){case 0:return b=this.validationDataset.mapAsync(function(J){return t(H,void 0,void 0,function(){return e(this,function(q){return[2,J.xs]})})}),_=this.validationDataset.mapAsync(function(J){return t(H,void 0,void 0,function(){return e(this,function(q){return[2,J.ys]})})}),C=Math.min(_.size,32),T=Math.ceil(_.size/C),D=b.batch(C),O=_.batch(C),[4,D.iterator()];case 1:return z=ie.sent(),[4,O.iterator()];case 2:I=ie.sent(),S=[],A=[],ee=0,ie.label=3;case 3:return ee<T?[4,z.next()]:[3,7];case 4:return N=ie.sent(),P=this.trainingModel.predict(N.value),M=P.argMax(1),S.push(M),[4,I.next()];case 5:F=ie.sent(),G=F.value.argMax(1),A.push(G),N.value.dispose(),P.dispose(),F.value.dispose(),ie.label=6;case 6:return ee++,[3,3];case 7:if(Z=n.concat(A),Y=n.concat(S),T!==1)for(ee=0;ee<S.length;ee++)S[ee].dispose(),A[ee].dispose();return[2,{reference:Z,predictions:Y}]}})})},x.prototype.setSeed=function(b){this.seed=s(b)},x}(a.CustomMobileNet);ni.TeachableMobileNet=f;function g(y,x){return t(this,void 0,void 0,function(){var b;return e(this,function(_){switch(_.label){case 0:return[4,a.loadTruncatedMobileNet(x)];case 1:return b=_.sent(),[2,new f(b,y)]}})})}return ni.createTeachable=g,ni}var Hi={};function Vm(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Vm=function(e){return typeof e}:Vm=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vm(r)}function F_(r,t,e){var n=e.value;if(typeof n!="function")throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(Vm(n)));var i=!1;return{configurable:!0,get:function(){if(i||this===r.prototype||this.hasOwnProperty(t)||typeof n!="function")return n;var a=n.bind(this);return i=!0,Object.defineProperty(this,t,{configurable:!0,get:function(){return a},set:function(u){n=u,delete this[t]}}),i=!1,a},set:function(a){n=a}}}function aM(r){var t;return typeof Reflect<"u"&&typeof Reflect.ownKeys=="function"?t=Reflect.ownKeys(r.prototype):(t=Object.getOwnPropertyNames(r.prototype),typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(r.prototype)))),t.forEach(function(e){if(e!=="constructor"){var n=Object.getOwnPropertyDescriptor(r.prototype,e);typeof n.value=="function"&&Object.defineProperty(r.prototype,e,F_(r,e,n))}}),r}function D8(){return arguments.length===1?aM.apply(void 0,arguments):F_.apply(void 0,arguments)}const O8=Object.freeze(Object.defineProperty({__proto__:null,boundClass:aM,boundMethod:F_,default:D8},Symbol.toStringTag,{value:"Module"})),P8=R1(O8);var UT;function M8(){if(UT)return Hi;UT=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var r=Hi&&Hi.__decorate||function(u,c,d,p){var f=arguments.length,g=f<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,d):p,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(u,c,d,p);else for(var x=u.length-1;x>=0;x--)(y=u[x])&&(g=(f<3?y(g):f>3?y(c,d,g):y(c,d))||g);return f>3&&g&&Object.defineProperty(c,d,g),g},t=Hi&&Hi.__awaiter||function(u,c,d,p){function f(g){return g instanceof d?g:new d(function(y){y(g)})}return new(d||(d=Promise))(function(g,y){function x(C){try{_(p.next(C))}catch(T){y(T)}}function b(C){try{_(p.throw(C))}catch(T){y(T)}}function _(C){C.done?g(C.value):f(C.value).then(x,b)}_((p=p.apply(u,c||[])).next())})},e=Hi&&Hi.__generator||function(u,c){var d={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},p,f,g,y;return y={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function x(_){return function(C){return b([_,C])}}function b(_){if(p)throw new TypeError("Generator is already executing.");for(;d;)try{if(p=1,f&&(g=_[0]&2?f.return:_[0]?f.throw||((g=f.return)&&g.call(f),0):f.next)&&!(g=g.call(f,_[1])).done)return g;switch(f=0,g&&(_=[_[0]&2,g.value]),_[0]){case 0:case 1:g=_;break;case 4:return d.label++,{value:_[1],done:!1};case 5:d.label++,f=_[1],_=[0];continue;case 7:_=d.ops.pop(),d.trys.pop();continue;default:if(g=d.trys,!(g=g.length>0&&g[g.length-1])&&(_[0]===6||_[0]===2)){d=0;continue}if(_[0]===3&&(!g||_[1]>g[0]&&_[1]<g[3])){d.label=_[1];break}if(_[0]===6&&d.label<g[1]){d.label=g[1],g=_;break}if(g&&d.label<g[2]){d.label=g[2],d.ops.push(_);break}g[2]&&d.ops.pop(),d.trys.pop();continue}_=c.call(u,d)}catch(C){_=[6,C],f=0}finally{p=g=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}};Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.Webcam=void 0;var n=P8,i=rM(),o={facingMode:"user",frameRate:24},a=function(u){return u.facingMode=u.facingMode||o.facingMode,u.frameRate=u.frameRate||o.frameRate,u.aspectRatio=u.aspectRatio||o.aspectRatio,u},s=function(){function u(c,d,p){c===void 0&&(c=400),d===void 0&&(d=400),p===void 0&&(p=!1),this.width=c,this.height=d,this.flip=p}return u.prototype.getWebcam=function(c){if(c===void 0&&(c={}),!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");c.width=640;var d=a(c),p=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:d}).then(function(f){return p.srcObject=f,p.addEventListener("loadedmetadata",function(g){var y=p.videoWidth,x=p.videoHeight;p.width=y,p.height=x}),p},function(){return Promise.reject("Could not open your camera. You may have denied access.")})},u.prototype.setup=function(c){return c===void 0&&(c={}),t(this,void 0,void 0,function(){var d;return e(this,function(p){switch(p.label){case 0:return this.webcam?[3,2]:(d=this,[4,this.getWebcam(c)]);case 1:d.webcam=p.sent(),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height),p.label=2;case 2:return[2]}})})},u.prototype.play=function(){var c=this.webcam.play();return c},u.prototype.pause=function(){this.webcam.pause()},u.prototype.stop=function(){this.stopStreamedVideo(this.webcam)},u.prototype.update=function(){this.renderCameraToCanvas()},u.prototype.stopStreamedVideo=function(c){var d=c.srcObject,p=d.getTracks();p.forEach(function(f){f.stop()}),c.srcObject=null},u.prototype.renderCameraToCanvas=function(){if(this.canvas&&this.webcam){var c=this.canvas.getContext("2d");if(this.webcam.videoWidth!==0){var d=i.cropTo(this.webcam,this.width,this.flip);c.drawImage(d,0,0)}}},r([n.default],u.prototype,"getWebcam",null),r([n.default],u.prototype,"setup",null),r([n.default],u.prototype,"play",null),r([n.default],u.prototype,"pause",null),r([n.default],u.prototype,"stop",null),r([n.default],u.prototype,"update",null),r([n.default],u.prototype,"stopStreamedVideo",null),r([n.default],u.prototype,"renderCameraToCanvas",null),u}();return Hi.Webcam=s,Hi}var jT;function L8(){return jT||(jT=1,function(r){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(r,"__esModule",{value:!0});var t=oM();Object.defineProperty(r,"IMAGE_SIZE",{enumerable:!0,get:function(){return t.IMAGE_SIZE}}),Object.defineProperty(r,"CustomMobileNet",{enumerable:!0,get:function(){return t.CustomMobileNet}}),Object.defineProperty(r,"load",{enumerable:!0,get:function(){return t.load}}),Object.defineProperty(r,"loadFromFiles",{enumerable:!0,get:function(){return t.loadFromFiles}}),Object.defineProperty(r,"loadTruncatedMobileNet",{enumerable:!0,get:function(){return t.loadTruncatedMobileNet}});var e=N8();Object.defineProperty(r,"TeachableMobileNet",{enumerable:!0,get:function(){return e.TeachableMobileNet}}),Object.defineProperty(r,"createTeachable",{enumerable:!0,get:function(){return e.createTeachable}});var n=M8();Object.defineProperty(r,"Webcam",{enumerable:!0,get:function(){return n.Webcam}});var i=iM();Object.defineProperty(r,"version",{enumerable:!0,get:function(){return i.version}})}(L0)),L0}var F8=L8(),sM={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},WT=Nu.createContext&&Nu.createContext(sM),z8=["attr","size","title"];function V8(r,t){if(r==null)return{};var e=B8(r,t),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(i=0;i<o.length;i++)n=o[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(e[n]=r[n])}return e}function B8(r,t){if(r==null)return{};var e={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(t.indexOf(n)>=0)continue;e[n]=r[n]}return e}function Ig(){return Ig=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r},Ig.apply(this,arguments)}function qT(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function Cg(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?qT(Object(e),!0).forEach(function(n){U8(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):qT(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function U8(r,t,e){return t=j8(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function j8(r){var t=W8(r,"string");return typeof t=="symbol"?t:t+""}function W8(r,t){if(typeof r!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function uM(r){return r&&r.map((t,e)=>Nu.createElement(t.tag,Cg({key:e},t.attr),uM(t.child)))}function lM(r){return t=>Nu.createElement(q8,Ig({attr:Cg({},r.attr)},t),uM(r.child))}function q8(r){var t=e=>{var{attr:n,size:i,title:o}=r,a=V8(r,z8),s=i||e.size||"1em",u;return e.className&&(u=e.className),r.className&&(u=(u?u+" ":"")+r.className),Nu.createElement("svg",Ig({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,n,a,{className:u,style:Cg(Cg({color:r.color||e.color},e.style),r.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&Nu.createElement("title",null,o),r.children)};return WT!==void 0?Nu.createElement(WT.Consumer,null,e=>t(e)):t(sM)}function H8(r){return lM({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M403.002 217.001C388.998 148.002 328.998 96 256 96c-57.998 0-107.998 32.998-132.998 81.001C63.002 183.002 16 233.998 16 296c0 65.996 53.999 120 120 120h260c55 0 100-45 100-100 0-52.998-40.996-96.001-92.998-98.999zM288 276v76h-64v-76h-68l100-100 100 100h-68z"},child:[]}]})(r)}const $8=()=>{const[r,t]=fe.useState(null),[e,n]=fe.useState(null),[i,o]=fe.useState([]),[a,s]=fe.useState([]),[u,c]=fe.useState(null),[d,p]=fe.useState(0),[f,g]=fe.useState(!1),[y,x]=fe.useState(""),b=Gd(),_="https://teachablemachine.withgoogle.com/models/Y5i61Nfmy/";fe.useEffect(()=>{(async()=>{try{const P=await F8.load(`${_}model.json`,`${_}metadata.json`);t(P)}catch(P){console.error("モデルのロードに失敗しました:",P)}})()},[]),fe.useEffect(()=>{(async()=>{const P=da.currentUser;if(P){const M=Ou(ys,"users",P.uid),F=await Eb(M);F.exists()&&(c({...P,points:F.data().points||0}),p(F.data().points||0))}})()},[]);const C=N=>{const P=N.target.files[0];if(P){const M=URL.createObjectURL(P);n(M)}},T=async()=>{if(r&&e){g(!0);const N=document.createElement("img");N.src=e,N.onload=async()=>{const P=[];for(let G=0;G<5;G++){const Z=await r.predict(N);P.push(Z)}const M={};P.flat().forEach(G=>{M[G.className]||(M[G.className]={total:0,count:0}),M[G.className].total+=G.probability,M[G.className].count+=1});const F=Object.keys(M).map(G=>({className:G,probability:M[G].total/M[G].count}));F.sort((G,Z)=>Z.probability-G.probability),o(F),D(F,F[0].className),g(!1)}}},D=(N,P)=>{const M=N.filter(G=>G.className!==P).slice(0,3).map(G=>G.className),F=[P,...M].sort(()=>Math.random()-.5);s(F)},O=async N=>{var M;const P=(M=i[0])==null?void 0:M.className;N===P?(alert("正解！10ポイント加算！"),x(z(P)),await I(10)):(alert(`不正解…正解は: ${P}`),x(z(P)))},z=N=>({巻雲:`
        <h3>解析結果：巻雲 (Cirrus)</h3>
        <p><strong>別称:</strong> すじ雲</p>
        <p>巻雲は、氷の結晶で構成され、空に細長く広がる白い筋状の雲です。非常に高い場所（約6,000〜13,000m）に現れ、天気が安定しているときによく見られます。</p>
        <p><strong>雑学:</strong> 巻雲が広がると天気が下り坂になることが多いと言われています。</p>
      `,巻積雲:`
        <h3>解析結果：巻積雲 (Cirrocumulus)</h3>
        <p><strong>別称:</strong> うろこ雲、いわし雲</p>
        <p>小さな白い塊が群れをなすように広がる雲で、魚のうろこのように見えることから「うろこ雲」とも呼ばれます。</p>
      `,高層雲:`
        <h3>解析結果：高層雲 (Altostratus)</h3>
        <p>空一面を覆う薄い灰色の雲で、太陽や月の輪郭がぼんやりと見えることがあります。</p>
      `,乱層雲:`
        <h3>解析結果：乱層雲 (Nimbostratus)</h3>
        <p>厚い灰色の雲で、広範囲にわたって降雨や降雪をもたらします。</p>
      `,層積雲:`
        <h3>解析結果：層積雲 (Stratocumulus)</h3>
        <p>大きな塊状の雲で、空の一部または全体を覆うことがあります。</p>
      `,積雲:`
        <h3>解析結果：積雲 (Cumulus)</h3>
        <p>白くてふわふわした綿のような見た目の雲で、天気の良い日に見られることが多いです。</p>
      `,積乱雲:`
        <h3>解析結果：積乱雲 (Cumulonimbus)</h3>
        <p>巨大で縦に発達する雲で、雷雨や突風を伴うことがあります。</p>
      `})[N]||"情報が見つかりません。",I=async N=>{if(u){const P=Ou(ys,"users",u.uid),M=d+N;await zw(P,{points:M}),p(M)}},S=()=>b("/"),A=async()=>{await W2(da)};return _e.jsxs("div",{className:"quiz-container",children:[_e.jsx("header",{className:"header",children:_e.jsxs("div",{className:"header-content",children:[_e.jsx("h2",{children:"CloudQuest"}),u?_e.jsx("button",{className:"logout-button",onClick:A,children:"ログアウト"}):_e.jsx(bo,{to:"/login",className:"login-link",children:"ログイン"})]})}),u&&_e.jsxs("div",{className:"user-info",children:[_e.jsxs(bo,{to:"/accountSettings",children:["アカウント設定はこちらから →",_e.jsx("br",{})]}),_e.jsxs("span",{children:[u.username||"unknown"," ",u.points,"P"]})]}),_e.jsxs("div",{className:"upload-container",children:[_e.jsxs("label",{className:"file-label",children:[_e.jsx("span",{className:"cloud-icon",children:_e.jsx(H8,{})}),f?_e.jsx("p",{className:"loading-text",children:"AIによるクイズ作成中..."}):_e.jsx("p",{className:"upload-text",children:"replace image"}),_e.jsx("input",{type:"file",accept:"image/*",onChange:C})]}),e&&_e.jsx("img",{src:e,alt:"Uploaded"})]}),_e.jsx("button",{onClick:T,disabled:f,children:f?"予測中...":"クイズを開始"}),a.length>0&&_e.jsxs("div",{children:[_e.jsx("h2",{children:"Q. この雲はどれ？"}),a.map((N,P)=>_e.jsx("button",{onClick:()=>O(N),children:N},P))]}),y&&_e.jsx("div",{dangerouslySetInnerHTML:{__html:y}}),_e.jsx("button",{onClick:S,children:"HOMEに戻る"})]})},G8=()=>{const[r,t]=fe.useState(""),[e,n]=fe.useState(""),[i,o]=fe.useState(null),a=Gd(),s=async u=>{u.preventDefault();try{await Sz(da,r,e),a("/")}catch{o("ログインに失敗しました。もう一度お試しください。")}};return _e.jsxs("div",{className:"auth-container",children:[_e.jsx("h2",{children:"ログイン"}),i&&_e.jsx("p",{className:"error-message",children:i}),_e.jsxs("form",{onSubmit:s,className:"auth-form",children:[_e.jsx("input",{type:"email",placeholder:"メールアドレス",value:r,onChange:u=>t(u.target.value),required:!0,className:"auth-input"}),_e.jsx("input",{type:"password",placeholder:"パスワード",value:e,onChange:u=>n(u.target.value),required:!0,className:"auth-input"}),_e.jsx("button",{type:"submit",className:"auth-button",children:"ログイン"})]}),_e.jsxs("p",{className:"auth-link",children:["新規登録が必要ですか？ ",_e.jsx(bo,{to:"/signup",children:"こちら"})," から新規登録できます。"]})]})},K8=()=>{const[r,t]=fe.useState(""),[e,n]=fe.useState(""),[i,o]=fe.useState(null),a=Gd(),s=async u=>{u.preventDefault();try{const d=(await Cz(da,r,e)).user;await Jj(Ou(ys,"users",d.uid),{email:d.email,username:"unknown",points:0}),a("/")}catch{o("新規登録に失敗しました。もう一度お試しください。")}};return _e.jsxs("div",{className:"auth-container",children:[_e.jsx("h2",{children:"新規登録"}),i&&_e.jsx("p",{className:"error-message",children:i}),_e.jsxs("form",{onSubmit:s,className:"auth-form",children:[_e.jsx("input",{type:"email",placeholder:"メールアドレス",value:r,onChange:u=>t(u.target.value),required:!0,className:"auth-input"}),_e.jsx("input",{type:"password",placeholder:"パスワード",value:e,onChange:u=>n(u.target.value),required:!0,className:"auth-input"}),_e.jsx("button",{type:"submit",className:"auth-button",children:"登録"})]}),_e.jsxs("p",{className:"auth-link",children:["すでにアカウントをお持ちですか？ ",_e.jsx(bo,{to:"/login",children:"こちら"})," からログインしてください。"]})]})};function X8(r){return lM({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(r)}const Q8=()=>{const[r,t]=fe.useState(null),[e,n]=fe.useState(""),[i,o]=fe.useState(""),[a,s]=fe.useState(""),[u,c]=fe.useState(""),[d,p]=fe.useState(""),[f,g]=fe.useState(!1),y=Gd();fe.useEffect(()=>{(async()=>{const O=da.currentUser;if(O){t(O);const z=Ou(ys,"users",O.uid),I=await Eb(z);I.exists()&&(n(I.data().username),o(O.email))}})()},[]);const x=async()=>{try{if(g(!0),r){const D=Ou(ys,"users",r.uid);await zw(D,{username:e})}g(!1),alert("ユーザー名が更新されました！")}catch{g(!1),p("ユーザー名の更新に失敗しました。")}},b=async()=>{try{if(g(!0),r&&i!==r.email){await Tz(r,i);const D=Ou(ys,"users",r.uid);await zw(D,{email:i})}g(!1),alert("メールアドレスが更新されました！")}catch{g(!1),p("メールアドレスの更新に失敗しました。")}},_=async()=>{try{if(g(!0),r&&a&&u){const D=da.EmailAuthProvider.credential(r.email,u);await r.reauthenticateWithCredential(D),await Az(r,a)}g(!1),alert("パスワードが更新されました！")}catch{g(!1),p("パスワードの更新に失敗しました。")}},C=()=>{da.signOut(),y("/login")},T=()=>{y(-1)};return _e.jsxs("div",{className:"account-settings-container",children:[_e.jsxs("div",{className:"back-button",onClick:T,children:[_e.jsx(X8,{size:24}),_e.jsx("span",{children:"戻る"})]}),_e.jsx("h2",{children:"アカウント設定"}),d&&_e.jsx("p",{className:"error-message",children:d}),_e.jsxs("div",{className:"form-group",children:[_e.jsx("label",{children:"ユーザー名"}),_e.jsx("input",{type:"text",value:e,onChange:D=>n(D.target.value),placeholder:"新しいユーザー名"}),_e.jsx("button",{onClick:x,disabled:f,children:f?"更新中...":"ユーザー名更新"})]}),_e.jsxs("div",{className:"form-group",children:[_e.jsx("label",{children:"メールアドレス"}),_e.jsx("input",{type:"email",value:i,onChange:D=>o(D.target.value),placeholder:"新しいメールアドレス"}),_e.jsx("button",{onClick:b,disabled:f,children:f?"更新中...":"メールアドレス更新"})]}),_e.jsxs("div",{className:"form-group",children:[_e.jsx("label",{children:"現在のパスワード"}),_e.jsx("input",{type:"password",value:u,onChange:D=>c(D.target.value),placeholder:"現在のパスワード"})]}),_e.jsxs("div",{className:"form-group",children:[_e.jsx("label",{children:"新しいパスワード"}),_e.jsx("input",{type:"password",value:a,onChange:D=>s(D.target.value),placeholder:"新しいパスワード"}),_e.jsx("button",{onClick:_,disabled:f,children:f?"更新中...":"パスワード更新"})]}),_e.jsx("div",{className:"form-group",children:_e.jsx("button",{onClick:C,children:"ログアウト"})})]})},Y8=()=>_e.jsx(FF,{children:_e.jsx("div",{children:_e.jsxs(pF,{children:[_e.jsx(Zl,{path:"/",element:_e.jsx(tW,{})})," ",_e.jsx(Zl,{path:"/quiz",element:_e.jsx($8,{})})," ",_e.jsx(Zl,{path:"/login",element:_e.jsx(G8,{})}),_e.jsx(Zl,{path:"/signup",element:_e.jsx(K8,{})}),_e.jsx(Zl,{path:"/accountSettings",element:_e.jsx(Q8,{})})]})})});_L.createRoot(document.getElementById("root")).render(_e.jsx(fe.StrictMode,{children:_e.jsx(Y8,{})}));
